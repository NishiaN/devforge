<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self' https://cdnjs.cloudflare.com; object-src 'none'; base-uri 'self'; form-action 'self';">
<title>DevForge v9.5 — AI駆動開発 統合プラットフォーム</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" integrity="sha384-+mbV2IY1Zk/X1p/nWllGySJSUN8uMs+gUAN10Or95UBH0fpj6GfKgPmgC5EXieXG" crossorigin="anonymous" onerror="window._noZip=true"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js" integrity="sha384-/TQbtLCAerC3jgaim+N78RZSDYV7ryeoBCVqTuzRrFec2akfBkHS7ACQ3PQhvMVi" crossorigin="anonymous" onerror="window._noMarked=true"></script>
<style>
:root{--bg:#0c0e13;--bg-1:#1e1e2e;--bg-2:#13161d;--bg-3:#1a1e28;--bg-4:#222733;--bg-s:var(--bg-2);--bd:var(--border);--fg:var(--text);--surface:#282e3c;--border:#2e3446;--border-light:#3a4158;--text:#e8ecf4;--text-2:#a4adc0;--text-3:#8090b0;--accent:#3b82f6;--accent-soft:rgba(59,130,246,.12);--accent-2:#22d3ee;--success:#34d399;--warn:#fbbf24;--warn-soft:rgba(251,191,36,.1);--warn-text:#fbbf24;--danger:#f87171;--layer-1:#3b82f6;--layer-2:#8b5cf6;--layer-3:#10b981;--layer-3h:#f59e0b;--layer-4:#ef4444;--layer-5:#06b6d4;--layer-6:#f97316;--layer-7:#a855f7;--chip-bg:#1e2230;--chip-border:#2e3446;--radius:10px;--radius-lg:16px;--mono:"IBM Plex Mono",monospace;--sans:"IBM Plex Sans JP",-apple-system,sans-serif}.compat-fixall{margin-left:auto}.compat-fixlv{margin-left:4px}[data-theme=light]{--bg:#f5f7fa;--bg-1:#e8ecf0;--bg-2:#fff;--bg-3:#edf0f5;--bg-4:#e2e6ed;--bg-s:var(--bg-2);--bd:var(--border);--fg:var(--text);--surface:#d8dce5;--border:#cdd2dc;--border-light:#bfc5d2;--text:#1e222d;--text-2:#4a5168;--text-3:#5c6a82;--accent:#2563eb;--accent-soft:rgba(37,99,235,.08);--accent-2:#0891b2;--success:#059669;--warn:#d97706;--warn-soft:rgba(217,119,6,.06);--warn-text:#b45309;--danger:#dc2626;--layer-1:#2563eb;--layer-2:#7c3aed;--layer-3:#059669;--layer-3h:#d97706;--layer-4:#dc2626;--layer-5:#0891b2;--layer-6:#ea580c;--layer-7:#9333ea;--chip-bg:#e8ecf4;--chip-border:#d0d5e0}*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:var(--sans);background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-light);border-radius:3px}.app{max-width:1440px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}.topbar{display:flex;align-items:center;justify-content:space-between;padding:0 24px;height:50px;border-bottom:1px solid var(--border);background:var(--bg-2);position:sticky;top:0;z-index:100}.topbar-left{display:flex;align-items:center;gap:16px;min-width:0;flex:1}.topbar-brand{display:flex;align-items:center;gap:10px;flex-shrink:0}.topbar-brand svg{width:20px;height:20px}.topbar-brand span{font-weight:700;font-size:14px;letter-spacing:-.03em}.topbar-brand small{font-size:11px;color:var(--text-3);font-weight:400;margin-left:2px}.topbar-right{display:flex;gap:6px;flex-shrink:0}.pstrip{height:3px;background:var(--bg-3);position:sticky;top:50px;z-index:99}.pstrip-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .6s cubic-bezier(.4,0,.2,1);box-shadow:0 0 12px var(--accent)}.btn{padding:7px 16px;border:none;border-radius:7px;font-weight:600;font-size:12px;cursor:pointer;font-family:var(--sans);transition:all .15s;display:inline-flex;align-items:center;gap:5px;white-space:nowrap}.btn-p{background:var(--accent);color:#fff}.btn-p:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.btn-s{background:var(--bg-3);color:var(--text-2);border:1px solid var(--border)}.btn-s:hover{background:var(--bg-4);color:var(--text)}.btn-d{background:var(--success);color:#fff}.btn-d:hover{background:#059669}.btn-g{background:transparent;color:var(--text-3)}.btn-g:hover{color:var(--text)}.btn-sm{padding:5px 12px;font-size:11px}.btn-xs{padding:3px 10px;font-size:10px}.theme-btn{background:none;border:none;font-size:16px;cursor:pointer;padding:4px 8px;border-radius:6px;transition:background .15s;color:var(--text)}.theme-btn:hover{background:var(--bg-3)}.onboard{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;gap:24px;text-align:center}.onboard h1{font-size:28px;font-weight:700;letter-spacing:-.03em;background:linear-gradient(135deg,var(--accent),var(--accent-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.onboard p{color:var(--text-2);font-size:14px;max-width:560px;line-height:1.7}.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:10px;max-width:760px;width:100%}.icard{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);padding:16px;text-align:left}.icard h4{font-size:13px;margin-bottom:4px}.icard p{font-size:11px;color:var(--text-3);line-height:1.5}.pillars-badge{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;max-width:700px}.pbadge{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;background:var(--bg-3);color:var(--text-2);border:1px solid var(--border)}.start-zone{display:flex;flex-direction:column;gap:12px;align-items:center;width:100%;max-width:640px}.nameIn{width:100%;padding:12px 16px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg-3);color:var(--text);font-size:14px;font-family:var(--sans);outline:none;transition:border-color .2s}.nameIn:focus{border-color:var(--accent)}.preset-row{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}.prchip{padding:5px 14px;border-radius:20px;font-size:11px;font-weight:600;background:var(--chip-bg);color:var(--text-2);border:1px solid var(--chip-border);cursor:pointer;transition:all .15s}.prchip:hover{border-color:var(--accent);color:var(--accent)}.prchip.on{background:var(--accent-soft);color:var(--accent);border-color:var(--accent)}.prchip-cmp{background:color-mix(in srgb,var(--warn) 10%,transparent)!important;color:var(--warn)!important;border-color:color-mix(in srgb,var(--warn) 30%,transparent)!important}.cmp-selectors{display:flex;align-items:center;gap:8px;margin-bottom:16px}.cmp-selectors select{flex:1;padding:8px;border-radius:var(--radius);border:1px solid var(--border);background:var(--bg-1);color:var(--text);font-size:12px}.cmp-vs{font-weight:700;color:var(--warn);font-size:13px}.cmp-table{width:100%;font-size:11px;border-collapse:collapse}.cmp-table th{text-align:left;padding:6px 8px;background:var(--bg-3);font-size:11px}.cmp-table td{padding:5px 8px;border-bottom:1px solid var(--border)}.cmp-label{font-weight:600;color:var(--text-3);min-width:70px}.cmp-diff td:not(.cmp-label){background:color-mix(in srgb,var(--warn) 6%,transparent)}.preset-cat-bar{display:flex;flex-wrap:wrap;gap:4px;width:100%;padding:4px 0 8px;justify-content:center}.preset-cat-btn{padding:4px 12px;border-radius:20px;font-size:10px;font-weight:600;background:var(--chip-bg);color:var(--text-3);border:1px solid var(--chip-border);cursor:pointer;transition:all .15s}.preset-cat-btn:hover{border-color:var(--accent);color:var(--accent)}.preset-cat-btn.active{background:var(--accent-soft);color:var(--accent);border-color:var(--accent)}.preset-footer{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;align-items:center;width:100%;padding:8px 0 4px;border-top:1px solid var(--border);margin-top:4px}.preset-storage-notice{width:100%;text-align:center;font-size:10px;color:var(--text-3);padding:4px 0}.ws-outer{display:flex;flex:1;overflow:hidden}.ws{display:flex;flex:1;min-width:0;overflow:hidden}#ws{flex:1;flex-direction:column;overflow:hidden}.sidebar{width:240px;flex-shrink:0;background:var(--bg-2);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transition:width .25s ease,opacity .25s ease}.sidebar.collapsed{width:0;opacity:0;pointer-events:none}.sb-head{display:flex;align-items:center;justify-content:flex-end;padding:6px 8px;border-bottom:1px solid var(--border);flex-shrink:0}.sb-toggle{background:none;border:1px solid var(--border);border-radius:6px;padding:4px 8px;cursor:pointer;font-size:11px;color:var(--text-3);transition:all .15s}.sb-toggle:hover{background:var(--bg-3);color:var(--text)}.sb-body{display:flex;flex-direction:column;flex:1;overflow:hidden}.sb-tabs{display:flex;gap:2px;padding:6px 8px;border-bottom:1px solid var(--border);flex-shrink:0}.sb-tab{flex:1;padding:5px 0;border:none;border-radius:6px;background:none;cursor:pointer;font-size:14px;color:var(--text-3);transition:all .15s}.sb-tab.on{background:var(--bg-3);color:var(--accent)}.sb-tab:hover:not(.on){background:var(--bg-3)}.sb-section{display:flex;flex-direction:column;flex:1;overflow:hidden;padding:8px}.sb-progress{gap:6px}.sb-files{overflow-y:auto;padding:6px}.sb-file-search{margin-bottom:6px}.sb-file-search input{width:100%;box-sizing:border-box;padding:5px 8px;font-size:11px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg-3);color:var(--text);font-family:var(--sans);outline:none}.sb-file-search input:focus{border-color:var(--accent)}.sb-file-tree{list-style:none;font-size:11px;font-family:var(--mono);margin:0;padding:0}.sb-file-tree .ft-section-header{font-size:10px;font-weight:700;color:var(--text-3);padding:6px 4px 2px;letter-spacing:.5px}.sb-file-tree .ft-folder{font-size:11px;color:var(--text-2);padding:2px 4px;font-weight:600}.sb-file-tree .ft-file{padding:1px 4px}.sb-file-tree .ft-file a{color:var(--text-2);text-decoration:none;display:block;padding:2px 4px;border-radius:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sb-file-tree .ft-file a:hover{background:var(--bg-3);color:var(--text)}.sb-file-tree .ft-file.active a{background:color-mix(in srgb,var(--accent) 15%,transparent);color:var(--accent);font-weight:600}.sb-empty{font-size:11px;color:var(--text-3);padding:8px 4px}.sb-key-banner{font-size:10px;font-weight:700;color:var(--success);padding:5px 6px 3px;background:color-mix(in srgb,var(--success) 8%,transparent);border-radius:var(--radius);margin-bottom:4px;letter-spacing:.3px}.sb-key-files{list-style:none;margin:0 0 8px;padding:0;font-size:11px;font-family:var(--mono)}.sb-key-files .ft-file a{color:var(--success);text-decoration:none;display:block;padding:2px 6px;border-radius:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sb-key-files .ft-file a:hover{background:color-mix(in srgb,var(--success) 10%,transparent)}.sb-pillar-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-top:8px;padding:0 2px}.sb-pillar-icon{background:none;border:1px solid var(--border);border-radius:6px;padding:4px 2px;cursor:pointer;font-size:14px;text-align:center;transition:all .2s;line-height:1;width:100%}.sb-pillar-icon:hover{background:var(--bg-3);border-color:var(--accent)}.sb-pillar-icon.inactive{opacity:.3;cursor:default;pointer-events:none}.sb-pillar-icon.processing{border-color:var(--accent);animation:pillarPulse 1s infinite;opacity:1}.sb-pillar-icon.completed{border-color:var(--success);opacity:1}.sb-pillar-icon.completed:hover{background:color-mix(in srgb,var(--success) 10%,transparent)}.sb-iconbar{width:40px;flex-shrink:0;background:var(--bg-2);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 0}.sb-icon-btn{background:none;border:none;border-radius:6px;padding:6px;cursor:pointer;font-size:14px;color:var(--text-3);transition:all .15s;width:32px;height:32px;display:flex;align-items:center;justify-content:center}.sb-icon-btn:hover{background:var(--bg-3);color:var(--text)}.panel-c{flex:1;display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;overflow:hidden}.panel-p{width:50%;display:flex;flex-direction:column;min-width:0;overflow:hidden}.badge{font-size:11px;padding:2px 10px;border-radius:10px;background:var(--accent-soft);color:var(--accent);font-weight:600}.cbody{flex:1;overflow-y:auto;padding:16px 20px;display:flex;flex-direction:column;gap:12px}.izone{border-top:1px solid var(--border);background:var(--bg-2);flex-shrink:0}.msg{display:flex;gap:10px;animation:fadeUp .3s ease}@keyframes fadeUp{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.prev-head{display:flex;align-items:center;gap:8px;padding:12px 20px;border-bottom:1px solid var(--border);background:var(--bg-2)}.prev-head h3{font-size:14px;font-weight:600;flex:1}.prev-tabs{display:flex;gap:2px;background:var(--bg-3);border-radius:8px;padding:2px}.ptab{padding:4px 12px;border-radius:6px;font-size:11px;font-weight:600;color:var(--text-3);cursor:pointer;transition:all .15s;border:none;background:none;font-family:var(--sans)}.ptab.on{background:var(--bg-2);color:var(--text);box-shadow:0 1px 3px #0000001a}.prev-body{flex:1;overflow-y:auto;padding:20px}.prev-body pre{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:16px;font-family:var(--mono);font-size:12px;line-height:1.6;overflow-x:auto;white-space:pre-wrap;word-break:break-word}.file-tree{list-style:none;font-size:12px;font-family:var(--mono)}.ft-search{margin-bottom:8px}.ft-search input{width:100%;padding:6px 10px;font-size:11px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg-2);color:var(--text);font-family:var(--sans);outline:none}.ft-search input:focus{border-color:var(--accent)}.ft-clear-history{text-align:right;padding:2px 8px}.ft-clear-btn{background:none;border:1px solid var(--border);color:var(--text-3);font-size:11px;padding:2px 8px;border-radius:4px;cursor:pointer;opacity:.7;transition:opacity .2s}.ft-clear-btn:hover{opacity:1;color:var(--danger)}.file-tree li{padding:3px 0;color:var(--text-2);cursor:pointer}.file-tree li:hover{color:var(--accent)}.file-tree li.folder{color:var(--warn);font-weight:600}.file-tree li.active{color:var(--accent);font-weight:600}.ft-section-header{font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--text-3);font-weight:700;padding:8px 0 4px;margin-top:8px;cursor:default!important}.ft-section-header:hover{color:var(--text-3)!important}.ft-separator{border-bottom:1px solid var(--border);margin:8px 0!important;padding:0!important;cursor:default!important}.ft-pinned,.ft-recent{position:relative;display:flex;align-items:center;justify-content:space-between;padding:6px 8px!important;background:var(--bg-2);border-radius:6px;margin:2px 0!important;transition:all .15s}.ft-pinned:hover,.ft-recent:hover{background:var(--bg-3)}.ft-pin,.ft-unpin{background:none;border:none;color:var(--text-3);cursor:pointer;font-size:12px;padding:2px 6px;border-radius:4px;transition:all .15s;margin-left:8px}.ft-pin:hover,.ft-unpin:hover{color:var(--accent);background:var(--accent-soft)}.ft-pin-active{color:var(--accent)!important}.tree-item{position:relative;display:flex;align-items:center;justify-content:space-between}.md-rendered{overflow:auto;max-height:calc(100vh - 200px);font-size:12px;line-height:1.6;padding:8px}.md-rendered h1,.md-rendered h2,.md-rendered h3{color:var(--text);margin:16px 0 8px}.md-rendered h1{font-size:16px;border-bottom:1px solid var(--border);padding-bottom:6px}.md-rendered h2{font-size:14px}.md-rendered h3{font-size:13px}.md-rendered p,.md-rendered li{color:var(--text-2);font-size:12px}.md-rendered pre{background:var(--bg-2);padding:10px;border-radius:6px;overflow-x:auto;font-size:11px}.md-rendered code{font-family:var(--mono);font-size:11px;background:var(--bg-2);padding:1px 4px;border-radius:3px}.md-rendered pre code{background:none;padding:0}.md-rendered pre{position:relative}.code-copy-btn{position:absolute;top:4px;right:4px;background:var(--bg-3);border:1px solid var(--border);color:var(--text-3);cursor:pointer;font-size:12px;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .15s;z-index:1}.md-rendered pre:hover .code-copy-btn{opacity:1}.code-copy-btn:hover{background:var(--accent);color:#fff;border-color:var(--accent)}.table-wrapper{position:relative;margin:8px 0}.table-copy-btn{position:absolute;top:4px;right:4px;background:var(--bg-3);border:1px solid var(--border);color:var(--text-3);cursor:pointer;font-size:12px;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .15s;z-index:1}.table-wrapper:hover .table-copy-btn{opacity:1}.table-copy-btn:hover{background:var(--accent);color:#fff;border-color:var(--accent)}.mermaid-copy-btn{position:absolute;top:4px;right:4px;background:var(--bg-3);border:1px solid var(--border);color:var(--text-3);cursor:pointer;font-size:12px;padding:2px 6px;border-radius:4px;opacity:0;transition:opacity .15s;z-index:1}.md-rendered .mermaid:hover .mermaid-copy-btn{opacity:1}.mermaid-copy-btn:hover{background:var(--accent);color:#fff;border-color:var(--accent)}.md-rendered table{width:100%;border-collapse:collapse;font-size:11px;margin:8px 0}.md-rendered th,.md-rendered td{border:1px solid var(--border);padding:4px 8px;text-align:left}.md-rendered th{background:var(--bg-2);font-weight:600;color:var(--text)}.md-rendered .mermaid{position:relative;background:var(--bg-2);padding:16px;border-radius:8px;margin:12px 0;text-align:center;overflow-x:auto}.md-rendered .mermaid svg{max-width:100%}.md-rendered a{color:var(--accent);text-decoration:none;border-bottom:1px dotted var(--accent);cursor:pointer}.md-rendered a:hover{color:var(--text);border-bottom-color:var(--text)}.md-rendered a[target=_blank]:after{content:" \2197";font-size:.8em;opacity:.6}.md-rendered a.link-broken{color:var(--danger);border-bottom-color:var(--danger);opacity:.7}.pillar-tabs{display:flex;gap:2px;flex-wrap:wrap;padding:8px 16px;background:var(--bg-2);border-bottom:1px solid var(--border)}.piltab{padding:4px 10px;border-radius:6px;font-size:10px;font-weight:600;color:var(--text-3);cursor:pointer;border:none;background:none;font-family:var(--sans);transition:all .15s}.piltab.on{background:var(--accent-soft);color:var(--accent)}.piltab:hover{color:var(--text)}.ctx-bar{height:6px;background:var(--bg-4);border-radius:3px;margin-top:8px;overflow:hidden}.ctx-bar-fill{height:100%;border-radius:3px;transition:width .6s}.road-week{font-size:10px;color:var(--text-3);font-weight:600;padding:2px 8px;background:var(--bg-4);border-radius:10px;flex-shrink:0}.mobtabs{display:none;border-bottom:1px solid var(--border);background:var(--bg-2)}.mobtab{flex:1;text-align:center;padding:10px;font-size:12px;font-weight:600;color:var(--text-3);cursor:pointer}.mobtab.on{color:var(--accent);border-bottom:2px solid var(--accent)}.export-summary{display:flex;gap:16px;padding:12px 20px;font-size:12px;font-weight:600;color:var(--text-2);border-bottom:1px solid var(--border);flex-wrap:wrap}.export-summary span{display:flex;align-items:center;gap:4px}.qbar{position:fixed;bottom:16px;left:50%;transform:translate(-50%) translateY(100px);display:flex;gap:4px;padding:8px 12px;background:var(--bg-2);border:1px solid var(--border);border-radius:12px;box-shadow:0 4px 20px #0000004d;z-index:90;align-items:center;opacity:0;transition:all .2s ease-out}.qbar-visible{transform:translate(-50%) translateY(0);opacity:1;animation:qbarSlideUp .2s ease-out}.qbar-hiding{animation:qbarSlideDown .2s ease-out}@keyframes qbarSlideUp{0%{transform:translate(-50%) translateY(100px);opacity:0}to{transform:translate(-50%) translateY(0);opacity:1}}@keyframes qbarSlideDown{0%{transform:translate(-50%) translateY(0);opacity:1}to{transform:translate(-50%) translateY(100px);opacity:0}}.qbar-group{display:flex;gap:4px;align-items:center}.qbar-sep{width:1px;height:20px;background:var(--border);margin:0 4px}.qbar-action{position:relative;display:flex;align-items:center;gap:6px;padding:6px 10px;border:none;border-radius:8px;font-size:11px;font-weight:600;cursor:pointer;background:var(--bg-3);color:var(--text);transition:all .15s;white-space:nowrap}.qbar-action:hover,.qbar-action:focus{background:var(--accent-soft);color:var(--accent);outline:2px solid var(--accent);outline-offset:2px}.qbar-action .qbar-icon{font-size:14px}.qbar-action .qbar-kb{display:none;font-size:9px;color:var(--text-3);margin-left:4px;padding:2px 4px;background:var(--bg-1);border-radius:4px}.qbar-action:hover .qbar-kb{display:inline}.qbar-primary{background:var(--accent);color:#fff;font-weight:700}.qbar-primary:hover,.qbar-primary:focus{background:var(--accent);color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px rgba(var(--accent-rgb),.3)}.qbar-minimize{padding:4px 8px;border:none;background:none;color:var(--text-3);cursor:pointer;font-size:14px;border-radius:6px;transition:all .15s}.qbar-minimize:hover,.qbar-minimize:focus{color:var(--text);background:var(--bg-3);outline:2px solid var(--accent);outline-offset:2px}.qbar-fab{position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--accent);color:#fff;border:none;box-shadow:0 4px 16px #0000004d;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:24px;z-index:90;transition:all .2s;animation:fabBounceIn .3s ease-out}.qbar-fab:hover{transform:scale(1.1);box-shadow:0 6px 20px #0006}.qbar-fab:focus{outline:2px solid white;outline-offset:4px}@keyframes fabBounceIn{0%{transform:scale(0);opacity:0}60%{transform:scale(1.15)}to{transform:scale(1);opacity:1}}.export-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;padding:20px}.export-card{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:20px;text-align:center;cursor:pointer;transition:all .15s}.export-card-danger{border-color:color-mix(in srgb,var(--danger) 25%,transparent);opacity:.7}.export-card-danger:hover{border-color:var(--danger);background:color-mix(in srgb,var(--danger) 6%,transparent);opacity:1}.export-card-regen{border-color:var(--accent);border-style:dashed}.export-card:hover{border-color:var(--accent);transform:translateY(-2px)}.export-card .icon{font-size:32px;margin-bottom:8px}.export-card h4{font-size:13px;margin-bottom:4px}.export-card p{font-size:11px;color:var(--text-3)}.export-hero{position:relative;margin:20px;padding:24px;background:linear-gradient(135deg,var(--accent),color-mix(in srgb,var(--accent) 70%,black));border-radius:12px;cursor:pointer;display:flex;align-items:center;gap:20px;transition:all .2s;box-shadow:0 4px 16px #00000026}.export-hero:hover{transform:translateY(-4px);box-shadow:0 8px 24px #00000040}.export-hero-badge{position:absolute;top:12px;right:12px;background:#fff;color:var(--accent);padding:4px 12px;border-radius:12px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}.export-hero-icon{font-size:48px;flex-shrink:0}.export-hero-content h3{font-size:18px;color:#fff;margin-bottom:6px}.export-hero-content p{font-size:13px;color:#ffffffe6;line-height:1.5}.export-group-label{margin:20px 20px 12px;font-size:12px;font-weight:700;color:var(--text-2);text-transform:uppercase;letter-spacing:1px;display:flex;align-items:center;gap:8px}.export-grid-compact{padding:0 20px 20px}.export-danger-zone{margin:20px;padding:16px;background:color-mix(in srgb,var(--danger) 5%,transparent);border:1px dashed var(--danger);border-radius:8px}.export-danger-label{font-size:11px;font-weight:700;color:var(--danger);margin-bottom:12px;text-transform:uppercase;letter-spacing:.5px;display:flex;align-items:center;gap:6px}.export-danger-zone .export-card{margin:0}.help-overlay{position:fixed;inset:0;background:#0009;z-index:200;display:none;align-items:center;justify-content:center}.help-overlay.show{display:flex}.help-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);width:90vw;max-width:800px;height:80vh;display:flex;overflow:hidden}.help-nav{width:200px;background:var(--bg-3);border-right:1px solid var(--border);overflow-y:auto;padding:12px 0;flex-shrink:0}.help-nav a{display:block;padding:8px 16px;font-size:12px;color:var(--text-2);text-decoration:none;transition:all .15s}.help-nav a:hover{background:var(--bg-4);color:var(--text)}.help-nav a.on{background:var(--accent-soft);color:var(--accent);font-weight:600}.help-search{width:calc(100% - 16px);margin:8px;padding:6px 10px;font-size:11px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg-1,var(--bg));color:var(--text);outline:none}.help-search:focus{border-color:var(--accent)}#helpPopup{position:fixed;z-index:300;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);padding:14px 18px;max-width:340px;box-shadow:0 8px 32px #00000040;font-size:12px;color:var(--text)}#helpPopup h4{font-size:13px;margin-bottom:6px;color:var(--text)}#helpPopup p{font-size:12px;color:var(--text-2);line-height:1.6;margin-bottom:6px}.hp-close{position:absolute;top:6px;right:8px;background:none;border:none;color:var(--text-3);cursor:pointer;font-size:14px;padding:2px 6px;border-radius:4px}.hp-close:hover{background:var(--bg-3);color:var(--text)}.hp-ex{background:var(--bg-3);padding:8px 10px;border-radius:6px;font-size:11px;color:var(--accent);line-height:1.5}.hp-link{display:block;margin-top:8px;font-size:11px;color:var(--accent);text-decoration:none}.hp-link:hover{text-decoration:underline}.help-nav a.dim{opacity:.3;pointer-events:none}.help-tour-btn{display:block;width:calc(100% - 16px);margin:8px;padding:6px 10px;font-size:11px;font-weight:600;background:var(--bg-3);color:var(--text-2);border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;text-align:center;transition:all .15s}.help-tour-btn:hover{background:var(--accent-soft);color:var(--accent);border-color:var(--accent)}mark{background:var(--accent-soft);color:var(--accent);padding:0 2px;border-radius:2px}.help-body{flex:1;overflow-y:auto;padding:24px}.help-body h2{font-size:18px;margin-bottom:12px}.help-body h3{font-size:14px;margin:16px 0 8px;color:var(--accent)}.help-body p{font-size:13px;line-height:1.7;margin-bottom:10px;color:var(--text-2)}.help-body code{font-family:var(--mono);background:var(--bg-3);padding:2px 6px;border-radius:4px;font-size:12px}.help-body table{width:100%;border-collapse:collapse;margin:10px 0;font-size:12px}.help-body th,.help-body td{padding:8px 12px;border:1px solid var(--border);text-align:left}.help-body th{background:var(--bg-3);font-weight:600}.hg-flow{display:flex;align-items:center;gap:6px;padding:10px;background:var(--bg-3);border-radius:8px;margin:8px 0;overflow-x:auto}.hg-n{padding:6px 8px;border-radius:6px;font-size:10px;text-align:center;font-weight:600;line-height:1.4;white-space:nowrap}.hg-a{color:var(--text-3);font-size:12px;flex-shrink:0}.hg-b{background:var(--accent-soft);color:var(--accent);border:1px solid color-mix(in srgb,var(--accent) 25%,transparent)}.hg-c{background:color-mix(in srgb,var(--accent-2) 10%,transparent);color:var(--accent-2);border:1px solid color-mix(in srgb,var(--accent-2) 25%,transparent)}.hg-p{background:color-mix(in srgb,#a855f7 10%,transparent);color:#a855f7;border:1px solid color-mix(in srgb,#a855f7 25%,transparent)}.hg-g{background:color-mix(in srgb,var(--success) 10%,transparent);color:var(--success);border:1px solid color-mix(in srgb,var(--success) 25%,transparent)}.app-footer{text-align:center;padding:16px;font-size:11px;color:var(--text-3);border-top:1px solid var(--border)}@media (max-width:1024px){.panel-p{width:45%}.panel-c{flex:1}.ctx-summary,.model-grid{grid-template-columns:repeat(2,1fr)}.exp-compare{grid-template-columns:1fr}.onboard h1{font-size:24px}.info-grid{grid-template-columns:repeat(2,1fr)}.sidebar{width:200px}}@media (max-width:768px){.topbar{padding:0 12px}.mobtabs{display:flex}.sidebar,.sb-iconbar{display:none}.piltab,.mobtab,.btn-s,.btn-xs,.field-cat-btn,.scale-btn,.preset-mode-btn,.pd-q{min-height:44px}.sb-file-tree .ft-file a{min-height:44px;display:flex;align-items:center;box-sizing:border-box}.export-hero{flex-wrap:wrap}.ws{flex-direction:column}.panel-p{width:100%;display:none}.panel-p.show{display:flex}.panel-c.hide{display:none}.qbar{flex-direction:column;inset:50% 16px auto auto;transform:translateY(-50%) translate(100px)}.qbar-visible{transform:translateY(-50%) translate(0)}.qbar-hiding{animation:qbarSlideRight .2s ease-out}@keyframes qbarSlideRight{0%{transform:translateY(-50%) translate(0)}to{transform:translateY(-50%) translate(100px)}}.qbar-group{flex-direction:column}.qbar-sep{width:20px;height:1px;margin:4px 0}.qbar-action .qbar-label{display:none}.qbar-action{padding:8px}.qbar-action .qbar-kb{display:none!important}.help-modal{flex-direction:column;width:95vw;height:90vh}.help-nav{width:100%;height:auto;max-height:120px;border-right:none;border-bottom:1px solid var(--border);display:flex;overflow-x:auto;padding:8px}.help-nav a{white-space:nowrap}.info-grid{grid-template-columns:1fr 1fr}.onboard h1{font-size:22px}.exp-select{flex-direction:column;gap:8px}.exp-select select{width:100%}.exp-ranking{gap:6px}.exp-rank-row{flex-wrap:wrap}.ctx-summary{grid-template-columns:1fr 1fr}.model-grid{grid-template-columns:1fr}.dash-fbar-name{width:70px;font-size:10px}.dg{padding:8px 10px;margin-bottom:4px}.dg-bar{grid-template-columns:55px 1fr 24px;gap:4px}.dg-lbl{font-size:10px}.dg-track{height:12px}.dg-cnt{font-size:10px}.launch-stats{grid-template-columns:1fr 1fr}.launch-folders{gap:4px}.launch-models{grid-template-columns:1fr 1fr}.launch-tpl{padding:8px}.tech-table th:nth-child(3),.tech-table td:nth-child(3){display:none}.tech-filter{flex-direction:column;gap:6px}.tech-filter select,.tech-filter input{width:100%}.diff-header{flex-direction:column;gap:4px}.diff-body{font-size:10px}.kb-modal{width:95vw;padding:16px}.road-layer h3{font-size:12px;padding:6px 10px}.road-task{font-size:11px;padding:6px 8px}.road-progress{padding:12px}}.spin{animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.tech-table{width:100%;border-collapse:collapse;font-size:11px}.tech-table th{position:sticky;top:0;background:var(--bg-2);padding:6px 8px;text-align:left;font-weight:600;border-bottom:2px solid var(--accent);font-size:10px;text-transform:uppercase;letter-spacing:.05em}.tech-table td{padding:5px 8px;border-bottom:1px solid var(--border)}.tech-table tr:hover{background:var(--bg-3)}.tech-filter{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}.tech-filter select,.tech-filter input{padding:5px 10px;border:1px solid var(--border);border-radius:6px;background:var(--bg-3);color:var(--text);font-size:11px;font-family:var(--sans)}.req-badge{display:inline-block;padding:1px 6px;border-radius:8px;font-size:9px;font-weight:700}.ctx-summary{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}.ctx-stat{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:12px;text-align:center}.ctx-stat .num{font-size:24px;font-weight:700;color:var(--accent)}.ctx-stat .lbl{font-size:10px;color:var(--text-3);margin-top:4px}.model-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}.model-card{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:12px}.model-card h4{font-size:12px;margin-bottom:6px}.model-card .fit{font-size:20px;font-weight:700}.fit-high{color:var(--success)}.fit-mid{color:var(--warn)}.fit-low{color:var(--danger)}.dash-head{margin-bottom:12px}.dash-head h3{font-size:14px;margin-bottom:4px}.dash-head p{font-size:11px;color:var(--text-3)}.dash-h4{font-size:12px;margin-bottom:8px}.dash-h4-mt{font-size:12px;margin:16px 0 8px}.dash-model-ctx{font-size:11px;color:var(--text-3);margin-top:4px}.dash-model-pct{font-size:10px;color:var(--text-3);margin-top:2px}.dash-fbar-row{display:flex;align-items:center;gap:8px;margin-bottom:4px}.dash-fbar{flex:1;height:8px;background:var(--bg-4);border-radius:4px;overflow:hidden}.dash-fbar-fill{height:100%;background:var(--accent);border-radius:4px}.dash-fbar-size{font-size:10px;color:var(--text-3);width:60px;text-align:right}.dg{background:var(--bg-2);border-radius:8px;padding:10px 12px;margin-bottom:6px;border:1px solid var(--border)}.dg-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.dg-nm{font-size:11px;font-weight:600}.dg-sub{font-size:16px;font-weight:700;color:var(--accent)}.dg-bar{display:grid;grid-template-columns:68px 1fr 28px;align-items:center;gap:6px;margin-bottom:3px}.dg-lbl{font-size:11px;color:var(--text-2);text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dg-track{height:14px;background:var(--bg-4);border-radius:3px;overflow:hidden}.dg-fill{height:100%;border-radius:3px;transition:width .4s}.dg-cnt{font-size:11px;font-weight:700;text-align:right}.dg-core .dg-fill{background:linear-gradient(90deg,var(--layer-2),color-mix(in srgb,var(--layer-2) 60%,#fff))}.dg-ai .dg-fill{background:linear-gradient(90deg,var(--accent-2),color-mix(in srgb,var(--accent-2) 60%,#fff))}.dg-infra .dg-fill{background:linear-gradient(90deg,var(--layer-5),color-mix(in srgb,var(--layer-5) 60%,#fff))}.dg-qa .dg-fill{background:linear-gradient(90deg,var(--warn),#fbbf24)}.dg-total{display:flex;justify-content:space-between;align-items:center;margin-top:8px;padding-top:6px;border-top:1px solid var(--border);font-size:11px;color:var(--text-2)}.dg-total strong{font-size:16px;color:var(--text)}.dash-total{font-size:11px;color:var(--text-3);margin-top:6px}.compat-ok{background:var(--bg-2);border:1px solid var(--success);border-radius:var(--radius);padding:10px 12px;font-size:12px;color:var(--success)}.compat-summary{display:flex;gap:12px;margin-bottom:8px;font-size:12px;font-weight:600}.compat-s-ok{color:var(--success)}.compat-s-warn{color:var(--warn)}.compat-s-err{color:var(--danger)}.compat-s-info{color:var(--accent)}.compat-error,.compat-warn,.compat-info{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:var(--radius);font-size:11px;margin-bottom:4px;flex-wrap:wrap}.compat-error{background:color-mix(in srgb,var(--danger) 9%,transparent);border:1px solid color-mix(in srgb,var(--danger) 25%,transparent)}.compat-warn{background:color-mix(in srgb,var(--warn) 9%,transparent);border:1px solid color-mix(in srgb,var(--warn) 25%,transparent)}.compat-info{background:color-mix(in srgb,var(--accent) 9%,transparent);border:1px solid color-mix(in srgb,var(--accent) 25%,transparent)}.compat-icon{font-size:14px;flex-shrink:0}.compat-pair{font-weight:700;font-size:10px;background:var(--bg-3);padding:2px 6px;border-radius:3px;white-space:nowrap}.compat-msg{flex:1;min-width:120px;line-height:1.5}.compat-fix{flex-shrink:0;font-size:10px!important;padding:2px 8px!important}.synergy-card{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:12px}.synergy-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.synergy-label{font-size:13px;font-weight:600}.synergy-score{font-size:28px;font-weight:700;padding:6px 14px;border-radius:8px}.synergy-bar{height:10px;background:var(--bg-4);border-radius:5px;overflow:hidden;margin-bottom:12px}.synergy-bar-fill{height:100%;border-radius:5px;transition:width .6s}.synergy-dims{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}.synergy-dim{display:grid;grid-template-columns:110px 1fr 32px;align-items:center;gap:8px;font-size:11px}.synergy-dim-lbl{color:var(--text-2);text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.synergy-dim-bar{height:12px;background:var(--bg-4);border-radius:3px;overflow:hidden}.synergy-dim-fill{height:100%;border-radius:3px;transition:width .4s}.synergy-dim-val{font-weight:700;text-align:right}.synergy-domain{font-size:11px;color:var(--text-3);padding-top:8px;border-top:1px solid var(--border)}.synergy-domain strong{color:var(--accent)}.fdep-group{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:6px;overflow:hidden}.fdep-header{padding:8px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:12px;font-weight:600;user-select:none;transition:background .15s}.fdep-header:hover{background:var(--bg-4)}.fdep-icon{font-size:10px;width:12px;transition:transform .2s}.fdep-title{flex:1}.fdep-count{font-size:10px;color:var(--text-3);background:var(--bg-4);padding:2px 8px;border-radius:10px}.fdep-body{max-height:0;overflow:hidden;transition:max-height .3s ease}.fdep-body.fdep-open{max-height:500px;padding:8px 12px}.fdep-item{font-size:11px;padding:3px 0;display:flex;align-items:center;gap:4px}.fdep-ind-1{padding-left:16px}.fdep-ind-2{padding-left:32px}.fdep-exists a{color:var(--success);text-decoration:none}.fdep-exists a:hover{text-decoration:underline}.fdep-missing span{color:var(--text-3);opacity:.5}.guide-domain-steps{display:flex;flex-direction:column;gap:8px;margin:12px 0;background:var(--bg-3);padding:12px;border-radius:8px;border:1px solid var(--border)}.guide-step-mini{display:flex;align-items:center;gap:10px;font-size:12px;color:var(--text)}.guide-step-num-mini{width:24px;height:24px;min-width:24px;background:var(--accent);color:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:11px}.guide-ai-recipe{background:var(--bg-3);padding:12px;border-radius:8px;border:1px solid var(--border);margin:12px 0}.guide-ai-recipe h4{font-size:13px;margin-bottom:8px;color:var(--accent)}.guide-recipe-step{font-size:12px;padding:6px 0;color:var(--text-2);border-bottom:1px solid var(--border)}.guide-recipe-step:last-child{border-bottom:none}.guide-adr-intro{font-size:12px;color:var(--text-3);margin-bottom:8px}.guide-adrs{display:flex;flex-direction:column;gap:8px;margin:8px 0}.guide-adr{display:flex;gap:12px;background:var(--bg-3);padding:10px 12px;border-radius:8px;border:1px solid var(--border)}.guide-adr-icon{font-size:20px;min-width:28px}.guide-adr strong{font-size:12px;display:block;margin-bottom:2px;color:var(--text)}.guide-adr p{font-size:11px;color:var(--text-3);margin:0}.dash-backup{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 12px;border-radius:var(--radius);font-size:11px;margin-bottom:8px;flex-wrap:wrap}.dash-backup-red{background:color-mix(in srgb,var(--danger) 9%,transparent);border:1px solid color-mix(in srgb,var(--danger) 25%,transparent);color:var(--danger)}.dash-backup-yellow{background:color-mix(in srgb,var(--warn) 9%,transparent);border:1px solid color-mix(in srgb,var(--warn) 25%,transparent);color:var(--warn)}.dash-guide{background:var(--accent-soft);border:1px solid color-mix(in srgb,var(--accent) 25%,transparent);color:var(--accent)}.guide-action-p{margin-top:16px}.cx-mini{margin-left:6px;font-size:10px;font-weight:700;opacity:.9}.dash-advanced{margin:12px 0;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}.dash-adv-toggle{padding:8px 12px;background:var(--bg-3);cursor:pointer;font-size:12px;font-weight:600;color:var(--text-2);list-style:none;display:block}.dash-adv-toggle::-webkit-details-marker{display:none}.dash-adv-toggle:before{content:"\25b6  ";font-size:10px}details[open]>.dash-adv-toggle:before{content:"\25bc  "}.dash-advanced>summary~*{padding:0 4px}.dash-info{font-size:12px}.dash-center{margin-top:16px;text-align:center}.dash-center .btn{font-size:11px}.fsize-chart{display:flex;flex-direction:column;gap:6px}.fsize-row{display:flex;align-items:center;gap:8px;font-size:11px}.fsize-lbl{min-width:90px;color:var(--text-3);white-space:nowrap;font-weight:600}.fsize-bar-wrap{flex:1;height:10px;background:var(--bg-3);border-radius:5px;overflow:hidden}.fsize-bar{height:100%;border-radius:5px;transition:width .4s}.fsize-val{min-width:50px;text-align:right;color:var(--text-3);font-size:10px}.dash-back{margin-top:8px;text-align:center}.dash-back .btn{font-size:11px}.dash-tfcount{font-size:11px;color:var(--text-3);align-self:center}.dash-tbl-wrap{max-height:60vh;overflow-y:auto}.dash-price{font-size:9px;color:var(--text-3)}.dash-empty{color:var(--text-3);text-align:center;margin-top:40px}.toast-msg{position:fixed;bottom:20px;left:50%;transform:translate(-50%) translateY(0);background:var(--bg-3);color:var(--text);padding:10px 16px;border-radius:8px;font-size:12px;z-index:999;border:1px solid var(--border);box-shadow:0 4px 16px #0003;display:flex;align-items:center;gap:12px;min-width:280px;max-width:480px;animation:toastIn .2s ease-out;transition:all .2s}.toast-msg.toast-success{border-color:var(--success);background:color-mix(in srgb,var(--success) 10%,var(--bg-3))}.toast-msg.toast-error{border-color:var(--danger);background:color-mix(in srgb,var(--danger) 10%,var(--bg-3))}.toast-msg.toast-info{border-color:var(--accent);background:color-mix(in srgb,var(--accent) 8%,var(--bg-3))}.toast-text{flex:1}.toast-action{padding:6px 12px;border:none;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;background:var(--accent);color:#fff;transition:all .15s;white-space:nowrap}.toast-action:hover{background:color-mix(in srgb,var(--accent) 80%,black);transform:translateY(-1px)}.toast-exit{animation:toastOut .2s ease-out;opacity:0;transform:translate(-50%) translateY(20px)}@keyframes toastIn{0%{opacity:0;transform:translate(-50%) translateY(20px)}to{opacity:1;transform:translate(-50%) translateY(0)}}@keyframes toastOut{0%{opacity:1;transform:translate(-50%) translateY(0)}to{opacity:0;transform:translate(-50%) translateY(20px)}}.cmdpalette-overlay{position:fixed;inset:0;background:#0009;backdrop-filter:blur(4px);z-index:1000;display:flex;align-items:flex-start;justify-content:center;padding-top:15vh;animation:fadeIn .15s ease-out}.cmdpalette-box{background:var(--bg-2);border:1px solid var(--border);border-radius:12px;box-shadow:0 8px 32px #0006;width:90%;max-width:600px;max-height:60vh;display:flex;flex-direction:column;animation:cmdSlideDown .2s ease-out}@keyframes cmdSlideDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.cmdpalette-input-wrap{display:flex;align-items:center;gap:12px;padding:16px;border-bottom:1px solid var(--border)}.cmdpalette-icon{font-size:20px}.cmdpalette-input{flex:1;background:var(--bg-1);border:none;border-radius:8px;padding:10px 12px;font-size:14px;color:var(--text);outline:none}.cmdpalette-input:focus{box-shadow:0 0 0 2px var(--accent)}.cmdpalette-results{overflow-y:auto;max-height:50vh;padding:8px}.cmdpalette-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;cursor:pointer;transition:all .1s;margin-bottom:4px}.cmdpalette-item:hover{background:var(--bg-3)}.cmdpalette-item-selected{background:var(--accent-soft);border-left:3px solid var(--accent)}.cmdpalette-item-icon{font-size:16px;width:24px;text-align:center}.cmdpalette-item-label{flex:1;font-size:13px;color:var(--text)}.cmdpalette-item-cat{font-size:10px;text-transform:uppercase;letter-spacing:.5px;color:var(--text-3);background:var(--bg-1);padding:2px 6px;border-radius:4px}.cmdpalette-item-kb{font-size:10px;color:var(--text-3);background:var(--bg-1);padding:4px 6px;border-radius:4px;font-family:monospace;border:1px solid var(--border)}.cmdpalette-empty{text-align:center;padding:40px 20px;color:var(--text-3);font-size:13px}.prev-footer{padding:12px 0;text-align:center;font-size:11px;color:var(--text-3);border-top:1px solid var(--border);margin-top:12px}.dash-total-mt{margin-top:8px}.launch-output{display:none}.tour-title{font-size:14px;margin-bottom:6px}.tour-desc{font-size:12px;color:var(--text-2);line-height:1.6}.tour-acts{display:flex;gap:6px;justify-content:flex-end;margin-top:8px}.gen-spinner{padding:16px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:10px}.gen-spinner-icon{display:inline-block;font-size:24px}.gen-prog-wrap{width:200px}.gen-prog-bar{height:6px;background:var(--bg-3);border-radius:3px;overflow:hidden}.gen-prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--success));border-radius:3px;transition:width .3s;width:0%}.gen-prog-label{font-size:11px;color:var(--text-2);margin-top:6px;font-weight:600}.gen-pillar-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;width:100%;max-width:500px;margin:16px 0}.gen-pillar-card{position:relative;background:var(--bg-2);border:1px solid var(--border);border-radius:8px;padding:12px 8px;text-align:center;transition:all .3s}.gen-pillar-card[data-status=pending]{opacity:.4}.gen-pillar-card[data-status=processing]{border-color:var(--accent);background:color-mix(in srgb,var(--accent) 10%,var(--bg-2));animation:pillarPulse 1s infinite}.gen-pillar-card[data-status=completed]{border-color:var(--success);background:color-mix(in srgb,var(--success) 10%,var(--bg-2));opacity:1}.gen-pillar-icon{font-size:20px;margin-bottom:4px}.gen-pillar-name{font-size:9px;color:var(--text-2);font-weight:600;line-height:1.2}.gen-pillar-check{position:absolute;top:4px;right:4px;font-size:12px;color:var(--success);opacity:0;transition:opacity .2s}.gen-pillar-card[data-status=completed] .gen-pillar-check{opacity:1}@keyframes pillarPulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.complexity-label{font-weight:600}.complexity-sub{font-size:13px;margin-top:2px}.btn-start{padding:12px 40px;font-size:14px}.prev-placeholder{color:var(--text-3);font-size:13px;text-align:center;margin-top:40px}.btn-diff{color:var(--warn)}.tree-item{cursor:pointer}.tree-indent{padding-left:16px}.tree-disabled{opacity:.4}.tree-edited{float:right;font-size:9px;color:var(--warn);margin-right:4px}.tree-gen{float:right;font-size:10px;color:var(--success)}.launch-ok{color:var(--success)}.launch-warn{color:var(--warn)}.road-pct-sub{font-size:12px;font-weight:400;color:var(--text-3)}.road-layer-pct{font-size:10px;font-weight:400;opacity:.7}.road-actions{margin-top:12px;display:flex;gap:8px;justify-content:center}.road-actions .btn{font-size:11px}.exp-compare{display:grid;grid-template-columns:1fr 1fr;gap:12px}.exp-col{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:16px}.exp-col h3{font-size:14px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--border)}.exp-row{display:flex;justify-content:space-between;padding:4px 0;font-size:12px}.exp-row .label{color:var(--text-3)}.exp-row .val{font-weight:600}.exp-verdict{margin-top:12px;padding:12px;background:var(--accent-soft);border:1px solid rgba(59,130,246,.2);border-radius:var(--radius)}.exp-verdict h4{font-size:12px;color:var(--accent);margin-bottom:4px}.exp-verdict p{font-size:11px;color:var(--text-2)}.exp-select{display:flex;gap:8px;margin-bottom:12px}.exp-select select{flex:1;padding:8px 12px;border:1px solid var(--border);border-radius:7px;background:var(--bg-3);color:var(--text);font-size:12px;font-family:var(--sans)}.road-progress{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:16px}.road-progress h4{font-size:12px;margin-bottom:8px}.road-progress-bar{height:12px;background:var(--bg-4);border-radius:6px;overflow:hidden}.road-progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--success));border-radius:6px;transition:width .6s}.road-pct{font-size:20px;font-weight:700;color:var(--accent);margin-top:4px}.road-layer{margin-bottom:20px}.road-layer h3{font-size:13px;color:var(--accent);margin-bottom:8px;padding:6px 10px;background:var(--accent-soft);border-radius:6px;display:inline-block}.road-task{display:flex;align-items:center;gap:8px;font-size:12px;cursor:pointer;transition:background .1s;border-radius:4px;padding:4px 8px}.road-task:hover{background:var(--bg-4)}.road-task input[type=checkbox]{accent-color:var(--accent);width:16px;height:16px;cursor:pointer}.road-task.checked{color:var(--text-3);text-decoration:line-through}.road-week-badge{font-size:9px;padding:2px 6px;background:var(--bg-4);border-radius:8px;color:var(--text-3);margin-left:auto;flex-shrink:0}.road-hrs-badge{font-size:9px;padding:2px 6px;background:var(--accent-soft);border-radius:8px;color:var(--accent);flex-shrink:0}.road-time{font-size:11px;color:var(--text-3);margin-top:6px}.road-time strong{color:var(--text)}.road-milestone{margin-top:8px;padding:6px 12px;background:linear-gradient(90deg,var(--accent-soft),transparent);border-radius:6px;font-size:12px;font-weight:600;color:var(--accent);animation:roadFadeIn .5s}@keyframes roadFadeIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.road-layer-head{cursor:pointer;user-select:none;display:flex!important;align-items:center;gap:4px;width:100%}.road-collapse-icon{font-size:10px;opacity:.6;width:12px;text-align:center}.road-layer-hrs{margin-left:auto;font-size:9px;font-weight:400;opacity:.6}.road-items{transition:max-height .3s ease,opacity .2s;overflow:hidden}.road-collapsed{max-height:0!important;opacity:0;margin:0;padding:0}.road-locked{opacity:.6}.road-lock-msg{font-size:10px;color:var(--text-3);padding:4px 12px;margin-bottom:8px;font-style:italic}.road-task-locked{pointer-events:none;opacity:.5}.road-task-locked input{pointer-events:none}.road-res-btn{font-size:12px;text-decoration:none;flex-shrink:0;opacity:.5;transition:opacity .15s;padding:0 2px}.road-res-btn:hover{opacity:1}.road-badge-anim{animation:roadBadge .6s ease;display:inline-block;margin-left:4px}@keyframes roadBadge{0%{transform:scale(0);opacity:0}50%{transform:scale(1.4)}to{transform:scale(1);opacity:1}}.hero-anim{position:relative;overflow:hidden;padding:20px;border-radius:var(--radius-lg)}.hero-anim:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from 0deg,transparent,var(--accent-soft),transparent);animation:spin 8s linear infinite;z-index:0}.hero-content{position:relative;z-index:1}.stat-row{display:flex;gap:24px;justify-content:center;flex-wrap:wrap}.stat-item{text-align:center}.stat-item .num{font-size:28px;font-weight:700;color:var(--accent)}.stat-item .lbl{font-size:11px;color:var(--text-3)}.version-badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;margin-bottom:12px}.kb-overlay{position:fixed;inset:0;background:#00000080;z-index:250;display:none;align-items:center;justify-content:center}.kb-overlay.show{display:flex}.kb-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:400px;width:90%}.kb-modal h3{font-size:16px;margin-bottom:16px}.kb-row{display:flex;justify-content:space-between;padding:6px 0;font-size:12px;color:var(--text-2);border-bottom:1px solid var(--border)}.kb-key{font-family:var(--mono);padding:2px 8px;background:var(--bg-3);border:1px solid var(--border);border-radius:4px;font-size:11px}.skill-sel{display:flex;gap:10px;margin-bottom:28px;flex-wrap:wrap;justify-content:center}.skcard{width:185px;padding:18px 14px;border-radius:var(--radius-lg);border:2px solid var(--border);background:var(--bg-2);cursor:pointer;transition:all .2s;text-align:left}.skcard:hover{border-color:var(--border-light);background:var(--bg-3)}.skcard.on{border-color:var(--accent);background:var(--accent-soft)}.skcard .em{font-size:26px;margin-bottom:8px}.skcard h4{font-size:13px;font-weight:600;margin-bottom:3px}.skcard p{font-size:11px;color:var(--text-3);line-height:1.5}.skill-fine{margin:8px 0 4px;padding:4px 8px}.skill-fine-ticks{display:flex;justify-content:space-between;font-size:14px;margin-bottom:2px;padding:0 2px}.skill-fine input[type=range]{width:100%;accent-color:var(--accent);cursor:pointer}.skill-fine-label{text-align:center;font-size:13px;color:var(--text);margin-top:4px;font-weight:600}.szl{font-size:11px;color:var(--text-3);margin-bottom:8px;text-align:center;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.chip{padding:6px 12px;border-radius:18px;font-size:12px;border:1.5px solid var(--chip-border,var(--border));background:var(--chip-bg,var(--bg-3));cursor:pointer;transition:all .12s;color:var(--text-2);user-select:none;display:flex;align-items:center;gap:5px}.chip:hover{border-color:var(--accent);color:var(--text)}.chip.on{border-color:var(--accent);background:var(--accent-soft);color:var(--accent);font-weight:500}.chip .ck{width:13px;height:13px;border-radius:3px;border:1.5px solid var(--text-3);display:flex;align-items:center;justify-content:center;font-size:9px;transition:all .12s}.chip.on .ck{border-color:var(--accent);background:var(--accent);color:#fff}.czone{padding:10px 20px}.czlabel{font-size:11px;color:var(--text-3);margin-bottom:8px;font-weight:500}.cgrid{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}.cfoot{padding:6px 20px 12px;display:flex;gap:6px;align-items:center}.cfoot input.cadd{flex:1;padding:8px 14px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg-3);color:var(--text);font-size:12px;outline:none}.cfoot input.cadd:focus{border-color:var(--accent)}.ocards{padding:10px 20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}.ocard{padding:14px;border-radius:var(--radius);border:1.5px solid var(--border);background:var(--bg-3);cursor:pointer;transition:all .15s}.ocard:hover{border-color:var(--accent);background:var(--accent-soft)}.ocard h5{font-size:13px;font-weight:600;margin-bottom:3px}.ocard p{font-size:11px;color:var(--text-3);line-height:1.4}.ocard-rec-badge{display:inline-block;margin-left:6px;padding:1px 6px;font-size:9px;font-weight:600;background:color-mix(in srgb,var(--warn) 15%,transparent);color:var(--warn);border:1px solid color-mix(in srgb,var(--warn) 30%,transparent);border-radius:10px;vertical-align:middle}.m-edit{position:absolute;top:4px;right:4px;background:none;border:none;color:var(--text-3);cursor:pointer;font-size:13px;padding:2px 5px;border-radius:4px;opacity:0;transition:.15s}.msg:hover .m-edit{opacity:1}.m-edit:hover{color:var(--warn);background:var(--warn-soft)}.q-help{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:var(--accent-soft);color:var(--accent);font-size:10px;font-weight:700;cursor:pointer;margin-left:6px;transition:.15s}.q-help:hover{background:var(--accent);color:#fff}.voice-btn{background:none;border:1px solid var(--border);border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;color:var(--text-3);transition:.15s;flex-shrink:0}.voice-btn:hover{border-color:var(--accent);color:var(--accent)}.voice-btn.recording{border-color:var(--danger);color:var(--danger);animation:pulse 1s infinite}@keyframes pulse{0%,to{opacity:1}50%{opacity:.4}}.skip-btn{background:none;border:none;color:var(--text-3);font-size:11px;cursor:pointer;padding:4px 10px;border-radius:12px;transition:.15s}.skip-btn:hover{background:var(--bg-3);color:var(--text-2)}.dnd-hint{font-size:11px;color:var(--text-3);margin-bottom:8px;font-style:italic}.dnd-list{list-style:none;padding:0;margin:0 0 8px}.dnd-item{display:flex;align-items:center;gap:8px;padding:8px 12px;margin:3px 0;border-radius:7px;border:1.5px solid var(--border);background:var(--bg-3);cursor:grab;transition:all .12s;user-select:none;font-size:12px;color:var(--text)}.dnd-item:active{cursor:grabbing;background:var(--bg-4);border-color:var(--accent);box-shadow:0 4px 12px #0000004d}.dnd-item:focus{outline:2px solid var(--accent);outline-offset:2px;border-color:var(--accent)}.dnd-grip{color:var(--text-3);font-size:14px;cursor:grab}.dnd-label{flex:1}.dnd-priority{font-size:10px;font-weight:600;padding:2px 8px;border-radius:10px}.dnd-priority.p0{background:#ef444426;color:var(--danger)}.dnd-priority.p1{background:#eab30826;color:var(--warn)}.dnd-priority.p2{background:#64748b26;color:var(--text-3)}.drag-over{border-color:var(--accent);background:var(--accent-soft)}.confirm-overlay{position:fixed;inset:0;background:#0009;z-index:350;display:none;align-items:center;justify-content:center;animation:fadeIn .2s}.confirm-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:420px;width:90%}.confirm-modal h4{font-size:14px;font-weight:600;margin-bottom:12px}.confirm-modal .cm-val{background:var(--bg-4);padding:10px 14px;border-radius:var(--radius);font-size:12px;color:var(--text);margin-bottom:16px;max-height:120px;overflow-y:auto;line-height:1.6}.confirm-modal .cm-acts{display:flex;gap:8px;justify-content:flex-end}.complexity-card{margin:12px 0;padding:16px;border-radius:var(--radius-lg);background:var(--bg-3);border:1px solid var(--border);animation:fadeIn .3s}.complexity-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.complexity-score{font-size:32px;font-weight:700}.complexity-score.low{color:var(--success)}.complexity-score.mid{color:var(--warn)}.complexity-score.high{color:var(--danger)}.complexity-bar{height:6px;border-radius:3px;background:var(--bg-4);margin-bottom:12px;overflow:hidden}.complexity-fill{height:100%;border-radius:3px;transition:width .6s ease}.complexity-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}.complexity-item{display:flex;justify-content:space-between;font-size:12px;padding:4px 0;border-bottom:1px solid var(--border)}.pm-overlay{position:fixed;inset:0;background:#0009;z-index:350;display:none;align-items:center;justify-content:center;animation:fadeIn .2s}.pm-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto}.pm-modal h3{font-size:16px;font-weight:700;margin-bottom:16px}.pm-item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:var(--radius);border:1px solid var(--border);margin-bottom:6px;cursor:pointer;transition:.15s}.pm-item:hover,.pm-item.current{border-color:var(--accent);background:var(--accent-soft)}.pm-item-name{font-size:13px;font-weight:500}.pm-item-meta{font-size:10px;color:var(--text-3)}.pm-item-acts{display:flex;gap:4px}.pm-item-acts button{background:none;border:none;cursor:pointer;font-size:12px;padding:2px 4px}.pm-storage{margin:12px 0 4px;font-size:11px;color:var(--text-3)}.pm-storage-label{margin-bottom:4px}.pm-storage-bar{height:6px;background:var(--bg-4);border-radius:3px;overflow:hidden}.pm-storage-fill{height:100%;border-radius:3px;transition:width .3s}.pm-actions{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}.toc-panel{display:none;padding:6px 8px;overflow-x:auto;white-space:nowrap;border-bottom:1px solid var(--border);background:var(--bg-2)}.toc-item{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:4px;cursor:pointer;font-size:10px;color:var(--text-3);transition:.15s;margin-right:2px}.toc-item:hover{background:var(--accent-soft);color:var(--accent)}.toc-item.done{color:var(--success)}.toc-item.active{color:var(--accent);font-weight:600}.toc-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0;background:var(--border-light)}.toc-item.done .toc-dot{background:var(--success)}.toc-item.active .toc-dot{background:var(--accent)}.edit-banner{padding:8px 20px;background:var(--warn-soft,rgba(234,179,8,.1));color:var(--warn);font-size:11px;font-weight:600;display:flex;align-items:center;justify-content:space-between}.skipped-banner{padding:8px 20px;background:var(--accent-soft);color:var(--accent);font-size:11px;font-weight:600}.tour-container{position:fixed;bottom:20px;left:50%;transform:translate(-50%);z-index:400;max-width:440px;width:92%}.tour-card{background:var(--bg-2);border:2px solid var(--accent);border-radius:var(--radius-lg);padding:20px;box-shadow:0 8px 30px #0006}.tour-dots{display:flex;gap:6px;justify-content:center;margin:10px 0}.tour-dot{width:8px;height:8px;border-radius:50%;background:var(--border)}.tour-dot.on{background:var(--accent)}[data-theme=light] .skcard{background:var(--bg-2);border-color:var(--border)}[data-theme=light] .m-bot{background:var(--bg-3);border-color:var(--border)}[data-theme=light] .m-usr{background:#3b82f614;border-color:#3b82f633}[data-theme=light] .m-tip{color:var(--text-3)}[data-theme=light] .skcard:hover{background:var(--bg-3);border-color:var(--text-3)}[data-theme=light] .skcard.on{background:#3b82f60f;border-color:var(--accent)}[data-theme=light] .complexity-card{background:var(--bg-3);border-color:var(--border)}[data-theme=light] .dnd-item,[data-theme=light] .confirm-modal,[data-theme=light] .pm-modal,[data-theme=light] .tour-card{background:var(--bg-2);border-color:var(--border)}[data-theme=light] .voice-btn{border-color:var(--border);color:var(--text-3)}[data-theme=light] .pm-item{border-color:var(--border)}[data-theme=light] .pm-item:hover{background:#3b82f60a}@keyframes fadeIn{0%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}.msg{margin-bottom:12px;animation:fadeIn .25s ease}.m-bot{background:var(--bg-3);padding:12px 14px;border-radius:3px var(--radius) var(--radius) var(--radius);border-left:3px solid var(--accent)}.m-usr{background:var(--surface,var(--bg-4));padding:12px 14px;border-radius:var(--radius) 3px var(--radius) var(--radius);margin-left:32px;border-right:3px solid var(--accent-2,#8b5cf6);position:relative}.m-tip{background:var(--warn-soft,rgba(234,179,8,.1));padding:8px 12px;border-radius:var(--radius);border-left:3px solid var(--warn);font-size:12px;color:var(--warn)}.m-lbl{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:.8px;margin-bottom:5px;color:var(--text-3);display:flex;align-items:center;gap:4px}.m-body{font-size:13px;line-height:1.7}.pd-title{font-size:10px;font-weight:700;color:var(--text-3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}.pd-phase{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:8px;margin-bottom:4px;cursor:pointer;transition:all .15s;font-size:12px;font-weight:600;color:var(--text-2)}.pd-phase:hover{background:var(--accent-soft)}.pd-phase.active{background:var(--accent-soft);color:var(--accent)}.pd-phase.done{color:var(--success)}.pd-dot{width:8px;height:8px;border-radius:50%;background:var(--border-light);flex-shrink:0;transition:.2s}.pd-phase.active .pd-dot{background:var(--accent);box-shadow:0 0 6px var(--accent)}.pd-phase.done .pd-dot{background:var(--success)}.pd-progress{margin-top:8px;padding-top:8px;border-top:1px solid var(--border);font-size:10px;color:var(--text-3);display:flex;align-items:center;gap:6px}.pd-bar{flex:1;height:4px;background:var(--bg-3);border-radius:2px;overflow:hidden}.pd-bar-fill{height:100%;background:var(--accent);border-radius:2px;transition:width .3s}.pd-gen{margin-top:10px;width:100%;font-size:11px;padding:6px 0}.pd-qlist{margin:0;padding:0 0 0 16px;list-style:none}.pd-q{padding:3px 4px;font-size:10px;color:var(--text-3);cursor:pointer;border-radius:4px;transition:all .15s;display:flex;align-items:center;gap:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.pd-q:hover{background:var(--bg-3);color:var(--text)}.pd-q.current{color:var(--accent);font-weight:600}.pd-q .pd-qmark{width:6px;height:6px;border-radius:50%;flex-shrink:0}.pd-q.answered .pd-qmark{background:var(--success)}.pd-q:not(.answered) .pd-qmark{background:var(--border-light)}.pd-q.current .pd-qmark{background:var(--accent);box-shadow:0 0 4px var(--accent)}.pd-q.q-na{opacity:.3;pointer-events:none;text-decoration:line-through}.gen-lang-overlay{position:fixed;inset:0;background:#0009;z-index:1100;display:flex;align-items:center;justify-content:center;animation:fadeIn .2s}.gen-lang-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:360px;width:90%;text-align:center}.gen-lang-modal h3{margin-bottom:8px;font-size:16px}.gen-lang-modal p{font-size:12px;color:var(--text-3);margin-bottom:16px}.gen-lang-btns{display:flex;gap:10px;justify-content:center}.gen-lang-btn{flex:1;padding:14px 12px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-3);cursor:pointer;transition:all .15s;font-size:13px;font-weight:600;color:var(--text)}.gen-lang-btn:hover{border-color:var(--accent);background:var(--accent-soft)}.gen-lang-btn .flag{font-size:24px;display:block;margin-bottom:6px}.flex-end{display:flex;gap:6px;justify-content:flex-end}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.skip-link{position:absolute;top:-40px;left:0;background:var(--accent);color:#fff;padding:8px 16px;z-index:9999;font-size:14px;border-radius:0 0 var(--radius) 0;transition:top .2s}.skip-link:focus{top:0}*:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:2px}.skcard:focus-visible{outline:2px solid var(--accent);outline-offset:2px}[role=dialog]:focus{outline:none}.breadcrumb{display:flex;align-items:center;gap:6px;font-size:11px;flex:1;overflow-x:auto;white-space:nowrap}.breadcrumb-link{background:none;border:none;color:var(--accent);cursor:pointer;padding:4px 6px;border-radius:4px;transition:all .15s;font-size:11px}.breadcrumb-link:hover{background:var(--accent-soft);text-decoration:underline}.breadcrumb-current{color:var(--text);font-weight:600;padding:4px 6px}.breadcrumb-sep{color:var(--text-3);font-size:10px}.prev-toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.prev-toolbar-r{display:flex;gap:4px}.prev-nav-btn{min-width:28px;padding:2px 6px}.prev-nav-btn.disabled,.prev-nav-btn[aria-disabled=true]{opacity:.3;pointer-events:none}.view-nav{display:flex;gap:2px}.view-nav-btn{min-width:26px;padding:2px 5px;font-size:11px}.view-nav-btn.disabled,.view-nav-btn[aria-disabled=true]{opacity:.25;pointer-events:none}.empty-preview{color:var(--text-3);font-size:13px;text-align:center;margin-top:40px}.empty-preview-sm{color:var(--text-3);font-size:12px;text-align:center;margin-top:40px}.ft-separator{color:var(--border);font-size:10px;padding:6px 0}.road-summary{margin-top:12px;padding:12px;background:var(--bg-3);border-radius:var(--radius);font-size:12px;text-align:center}.exp-header{margin-bottom:12px}.exp-header h3{font-size:14px;margin-bottom:4px}.exp-header p{font-size:11px;color:var(--text-3)}.exp-ranking{margin:12px 0;padding:12px;background:var(--bg-3);border-radius:var(--radius);border:1px solid var(--border)}.exp-ranking h4{font-size:12px;margin-bottom:10px;color:var(--accent)}.exp-rank-row{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;border-radius:4px;cursor:pointer;transition:background .15s}.exp-rank-row:hover{background:var(--bg-2)}.exp-rank-top{background:var(--bg-2);border:1px solid var(--accent);border-radius:6px}.exp-rank-left{display:flex;align-items:center;gap:8px;min-width:200px}.exp-rank-medal{font-size:14px;min-width:28px;text-align:center}.exp-rank-name{font-size:12px;font-weight:500}.exp-rank-right{display:flex;align-items:center;gap:8px;flex:1;max-width:200px}.exp-rank-bar{flex:1;height:6px;background:var(--bg-1);border-radius:3px;overflow:hidden}.exp-rank-bar-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .3s}.exp-rank-score{font-size:11px;font-weight:600;color:var(--accent);min-width:36px;text-align:right}.exp-rank-reasons{display:flex;flex-wrap:wrap;gap:4px;margin:2px 0 6px 36px}.exp-rank-tag{font-size:10px;padding:1px 6px;background:var(--accent);color:#fff;border-radius:10px;opacity:.8}.exp-metrics-sep{margin-top:10px;border-top:1px solid var(--border);padding-top:8px}.launch-stats{display:flex;gap:12px;margin:12px 0}.launch-stat{flex:1;text-align:center;padding:10px;background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius)}.launch-num{font-size:20px;font-weight:700;color:var(--accent);display:block}.launch-lbl{font-size:10px;color:var(--text-3)}.launch-folders{margin:12px 0;padding:12px;background:var(--bg-3);border-radius:var(--radius);border:1px solid var(--border)}.launch-folders h4{font-size:12px;margin-bottom:8px}.launch-folder-row{display:flex;align-items:center;gap:8px;padding:4px 0;font-size:11px}.launch-folder-row label{display:flex;align-items:center;gap:4px;min-width:120px}.launch-folder-row span{flex:1;text-align:right;color:var(--text-3);font-size:10px;min-width:140px}.launch-bar{flex:1;height:4px;background:var(--bg-1);border-radius:2px;max-width:80px}.launch-bar-fill{height:100%;background:var(--accent);border-radius:2px}.launch-models{margin:8px 0;padding:10px;background:var(--bg-3);border-radius:var(--radius);border:1px solid var(--border)}.launch-models h4{font-size:12px;margin-bottom:6px}.launch-model-row{font-size:11px;padding:3px 0;display:flex;justify-content:space-between}.launch-model-pct{font-weight:600;font-size:10px}.launch-templates{margin:12px 0}.launch-templates h4{font-size:12px;margin-bottom:8px}.launch-tpl{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:6px;cursor:pointer;transition:border-color .15s,background .15s}.launch-tpl:hover{border-color:var(--accent);background:var(--bg-2)}.launch-tpl-icon{font-size:22px;min-width:30px;text-align:center}.launch-tpl-info{display:flex;flex-direction:column;gap:2px}.launch-tpl-info strong{font-size:12px}.launch-tpl-info span{font-size:10px;color:var(--text-3)}.launch-cat-bar{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px}.launch-cat-btn{padding:4px 10px;border-radius:20px;font-size:10px;font-weight:600;background:var(--chip-bg);color:var(--text-3);border:1px solid var(--chip-border);cursor:pointer;transition:all .15s}.launch-cat-btn:hover{border-color:var(--accent);color:var(--accent)}.launch-cat-btn.active{background:var(--accent-soft);color:var(--accent);border-color:var(--accent)}.launch-rec-row{display:flex;flex-wrap:wrap;gap:6px;align-items:center;padding:8px 0;margin-bottom:8px;border-bottom:1px solid var(--border)}.launch-rec-lbl{font-size:10px;font-weight:700;color:var(--text-3);text-transform:uppercase;letter-spacing:.5px}.launch-rec-chip{padding:4px 10px;border-radius:20px;font-size:10px;font-weight:600;background:var(--accent-soft);color:var(--accent);border:1px solid color-mix(in srgb,var(--accent) 30%,transparent);cursor:pointer;transition:all .15s}.launch-rec-chip:hover{background:var(--accent);color:#fff}.launch-output{margin:12px 0;border:1px solid var(--accent);border-radius:var(--radius);overflow:hidden}.launch-output-head{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--accent);color:#fff}.launch-output-head h4{margin:0;font-size:13px}.launch-output-meta{padding:6px 12px;font-size:10px;color:var(--text-3);background:var(--bg-3);border-bottom:1px solid var(--border)}.launch-output-pre{padding:12px;font-size:11px;max-height:300px;overflow:auto;white-space:pre-wrap;word-break:break-word;background:var(--bg-1);margin:0}.launch-airec{font-size:.65em;opacity:.55;margin-left:auto;white-space:nowrap;padding:2px 5px;background:var(--bg-2);border-radius:4px;border:1px solid var(--border)}.help-expert-hint{margin-top:8px;padding:8px;border-top:1px solid var(--border);background:var(--bg-3);border-radius:6px}.help-eh-head{display:flex;justify-content:space-between;align-items:center;font-weight:600;font-size:.85em;margin-bottom:4px}.help-eh-text{font-size:.85em;color:var(--text-2);line-height:1.5}.help-eh-next{background:none;border:none;cursor:pointer;font-size:1em;padding:0 4px;color:var(--text-2)}.help-eh-next:hover{color:var(--accent)}.diff-header{padding:8px 12px;border-bottom:1px solid var(--border);background:var(--bg-3);display:flex;justify-content:space-between;align-items:center}.diff-title{font-size:12px;font-weight:600}.diff-stats{font-size:11px;color:var(--text-3)}.diff-stats .add{color:var(--success)}.diff-stats .del{color:var(--danger)}.diff-stats .btn{font-size:10px;margin-left:8px}.diff-body{font-family:monospace;font-size:11px;line-height:1.6;padding:8px;overflow-y:auto;max-height:calc(100vh - 200px)}.diff-same{padding:1px 8px;color:var(--text-3)}.diff-add{padding:1px 8px;background:color-mix(in srgb,var(--success) 9%,transparent);color:var(--success)}.diff-del{padding:1px 8px;background:color-mix(in srgb,var(--danger) 9%,transparent);color:var(--danger);text-decoration:line-through}.diff-ln{display:inline-block;width:35px;text-align:right;margin-right:8px}.diff-same .diff-ln{opacity:.5}.editor-toolbar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-bottom:1px solid var(--border);background:var(--bg-3)}.editor-toolbar .title{font-size:12px;font-weight:600}.editor-toolbar .actions{display:flex;gap:6px}.editor-toolbar .btn{font-size:11px}.editor-area{width:100%;height:calc(100% - 42px);border:none;outline:none;resize:none;background:var(--bg-1);color:var(--text);font-family:Fira Code,monospace;font-size:12px;line-height:1.6;padding:12px;tab-size:2;box-sizing:border-box}.exp-dim{opacity:.2}.exp-current{color:var(--accent)}.exp-select h4{margin:0}.exp-win{color:var(--success)}.exp-tie{color:var(--warn)}.guide-overlay{position:fixed;inset:0;background:#000000a6;z-index:250;display:flex;align-items:center;justify-content:center;animation:fadeIn .3s}.guide-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:16px;padding:28px;max-width:520px;width:92%;max-height:85vh;overflow-y:auto;box-shadow:0 24px 64px #00000059}.guide-header{display:flex;align-items:center;gap:14px;margin-bottom:16px;position:relative}.guide-em{font-size:36px}.guide-title{font-size:18px;font-weight:800;letter-spacing:-.02em}.guide-sub{font-size:12px;font-weight:600}div.guide-sub.guide-lv-b{background:none;color:var(--success)}div.guide-sub.guide-lv-i{background:none;color:var(--warn)}div.guide-sub.guide-lv-p{background:none;color:var(--danger)}.guide-close{position:absolute;top:0;right:0;background:none;border:none;color:var(--text-3);font-size:18px;cursor:pointer;padding:4px 8px;border-radius:6px}.guide-close:hover{background:var(--bg-3);color:var(--text)}.guide-badge{font-size:11px;color:var(--accent);background:var(--accent-soft);padding:6px 14px;border-radius:20px;text-align:center;margin-bottom:20px;font-weight:600;letter-spacing:.02em}.guide-steps{display:flex;flex-direction:column;gap:14px;margin-bottom:20px}.guide-step{display:flex;gap:14px;padding:14px;background:var(--bg-3);border:1px solid var(--border);border-radius:12px}.guide-step-num{width:32px;height:32px;min-width:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px}.guide-step-title{font-size:13px;font-weight:700;margin-bottom:4px}.guide-step-desc{font-size:12px;color:var(--text-2);line-height:1.7}.guide-step-desc code{font-family:var(--mono);font-size:11px;background:var(--bg);padding:1px 5px;border-radius:4px;color:var(--accent-2)}.guide-actions{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}.guide-prog{display:flex;align-items:center;gap:8px;margin-bottom:14px}.guide-prog-bar{flex:1;height:6px;background:var(--bg-3);border-radius:3px;overflow:hidden}.guide-prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--success));border-radius:3px;transition:width .4s}.guide-prog-txt{font-size:11px;font-weight:700;color:var(--accent);min-width:28px;text-align:right}.guide-ck{display:flex;align-items:center;flex-shrink:0;cursor:pointer}.guide-ck input{display:none}.guide-ckbox{width:20px;height:20px;min-width:20px;border-radius:5px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;transition:all .15s}.guide-step-done .guide-ckbox{background:var(--success);border-color:var(--success)}.guide-step-done .guide-step-title{text-decoration:line-through;opacity:.6}.guide-step-done .guide-step-desc{opacity:.5}.guide-lv-b{background:#34d3991f;color:var(--success)}.guide-lv-i{background:#fbbf241f;color:var(--warn)}.guide-lv-p{background:#fb71851f;color:var(--danger)}@media print{:root{--bg:#fff;--bg-2:#fff;--bg-3:#f5f5f5;--bg-4:#eee;--text:#111;--text-2:#333;--text-3:#666;--border:#ccc;--accent:#2563eb;--success:#059669;--warn:#d97706;--danger:#dc2626}body{background:#fff;color:#111;font-size:11pt}.topbar,.pstrip,.mobtabs,.sidebar,.sb-iconbar,.tour-container,.guide-overlay,.help-overlay,.kb-overlay,.pm-overlay,.confirm-overlay,.toast-msg,.btn,.export-grid,.izone,.toc-panel,.edit-banner,.skipped-banner,.code-copy-btn,.table-copy-btn,.mermaid-copy-btn{display:none!important}.panel-c,.panel-p{width:100%;border:none;overflow:visible}.ws{flex-direction:column;overflow:visible}.prev-body pre{border:1px solid #ccc;background:#f9f9f9;page-break-inside:avoid}.md-rendered h1,.md-rendered h2,.md-rendered h3{page-break-after:avoid}.md-rendered table{page-break-inside:avoid}a{color:#2563eb;text-decoration:underline}.prev-head{background:#fff;border-bottom:2px solid #111}}.audit-results{background:var(--bg-s);border:1px solid var(--bd);border-radius:var(--radius);padding:12px;margin-top:8px}.audit-results h4{margin:0 0 8px;font-size:13px;color:var(--fg)}.audit-summary-err,.audit-summary-warn,.audit-summary-info{display:inline-block;font-size:11px;padding:2px 8px;border-radius:10px;margin-right:6px;margin-bottom:6px}.audit-summary-err{background:color-mix(in srgb,var(--danger) 12%,transparent);color:var(--danger)}.audit-summary-warn{background:color-mix(in srgb,var(--warn) 12%,transparent);color:var(--warn-text,#b45309)}.audit-summary-info{background:color-mix(in srgb,var(--accent) 12%,transparent);color:var(--accent)}.prchip-custom{border-style:dashed;opacity:.8}.prchip-custom.sel{opacity:1;border-color:var(--accent);background:var(--bg-2)}.techdb-overlay{position:fixed;inset:0;background:#0009;z-index:9999;display:flex;align-items:center;justify-content:center}.techdb-modal{background:var(--bg-1);border-radius:12px;width:min(90vw,700px);max-height:80vh;display:flex;flex-direction:column;box-shadow:0 8px 32px #0000004d}.techdb-hd{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}.techdb-hd h3{margin:0;flex:1}.techdb-search{padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg-2);color:var(--text);width:180px}.techdb-body{display:flex;flex:1;overflow:hidden;min-height:300px}.techdb-cats{width:160px;overflow-y:auto;border-right:1px solid var(--border);padding:8px}.techdb-cat{padding:6px 10px;border-radius:6px;cursor:pointer;font-size:.85em;margin-bottom:2px}.techdb-cat:hover,.techdb-cat.sel{background:var(--accent);color:#fff}.techdb-items{flex:1;overflow-y:auto;padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px;align-content:start}.techdb-item{padding:8px 12px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s}.techdb-item:hover{border-color:var(--accent);background:var(--bg-2)}.techdb-item b{display:block;margin-bottom:4px}.techdb-req,.techdb-price{font-size:.75em;opacity:.7;margin-right:8px}.btn-tech-browse{margin-top:8px;opacity:.7}.btn-tech-browse:hover{opacity:1}.phase-exit{animation:phaseExitAnim .2s ease-out forwards}.phase-enter{animation:phaseEnterAnim .3s ease-out}@keyframes phaseExitAnim{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-20px)}}@keyframes phaseEnterAnim{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.save-indicator{position:fixed;top:20px;right:20px;font-size:24px;opacity:0;pointer-events:none;transition:opacity .2s;z-index:999}.save-indicator-show{opacity:1;animation:saveFlash .8s ease-out}@keyframes saveFlash{0%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:1}to{transform:scale(1);opacity:0}}.whats-new-dot{position:absolute;top:-4px;right:-4px;width:10px;height:10px;background:var(--danger);border-radius:50%;border:2px solid var(--bg-1);animation:dotPulse 2s infinite}@keyframes dotPulse{0%,to{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:.8}}.ai-quickstart{background:var(--bg-2);border:1px solid var(--accent);border-radius:10px;padding:14px 16px;margin:10px 0}.ai-qs-title{font-weight:700;margin-bottom:10px;color:var(--accent)}.ai-qs-flow{display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin-bottom:10px}.ai-qs-step{display:flex;align-items:center;gap:4px;background:var(--bg-1);border-radius:6px;padding:4px 8px;font-size:.85em}.ai-qs-num{font-weight:700;color:var(--accent)}.ai-qs-arrow{color:var(--text);opacity:.4}.ai-qs-steps{display:grid;gap:4px;margin-bottom:8px}.ai-qs-detail{font-size:.82em;padding:4px 8px;background:var(--bg-1);border-radius:6px;border-left:2px solid var(--accent)}.ai-qs-note{font-size:.8em;opacity:.7;border-top:1px solid var(--border);padding-top:8px;margin-top:4px}.ai-qs-micro-label{font-size:.82em;font-weight:600;color:var(--accent);opacity:.85;margin-bottom:6px}.ai-qs-detail-micro{display:flex;align-items:flex-start;gap:6px}.ai-qs-recovery{margin-top:8px;border-top:1px solid var(--border);padding-top:6px}.ai-qs-recovery summary{font-size:.8em;cursor:pointer;opacity:.7;user-select:none}.ai-qs-recovery summary:hover{opacity:1}.ai-qs-rp-list{display:grid;gap:4px;margin-top:6px}.ai-qs-rp{display:flex;align-items:center;justify-content:space-between;gap:8px;background:var(--bg-1);border-radius:6px;padding:4px 8px}.ai-qs-rp-lbl{font-size:.8em;flex:1}.ai-qs-recovery-open{margin-top:8px;padding:8px 12px;border:1px solid var(--border);border-radius:8px;background:var(--bg-2)}.ai-qs-recovery-title{font-weight:600;margin-bottom:6px;font-size:.88em}.power-ops-panel{margin:12px 0;padding:10px 14px;background:var(--bg-2);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:8px}.power-ops-title{font-size:.85em;font-weight:700;margin-bottom:8px;color:var(--accent)}.power-ops-btns{display:flex;flex-wrap:wrap;gap:6px}.sb-all-collapse summary.ft-section-header{cursor:pointer;user-select:none;display:list-item}.sb-all-collapse summary:hover{opacity:.8}.export-hero-urgent{border:2px solid var(--accent);box-shadow:0 0 12px color-mix(in srgb,var(--accent) 30%,transparent);animation:heroUrgentPulse 2.5s ease-in-out infinite}.export-hero-urgent-label{background:var(--accent);color:#fff;font-size:.8em;font-weight:700;text-align:center;padding:4px 8px;border-radius:6px 6px 0 0;margin:-14px -16px 10px;letter-spacing:.03em}@keyframes heroUrgentPulse{0%,to{box-shadow:0 0 8px color-mix(in srgb,var(--accent) 25%,transparent)}50%{box-shadow:0 0 18px color-mix(in srgb,var(--accent) 50%,transparent)}}.start-here-card{background:var(--bg-2);border:1px solid var(--success,#22c55e);border-radius:10px;padding:12px 14px;margin:8px 0}.start-here-title{font-weight:700;color:var(--success,#22c55e);margin-bottom:8px;font-size:.9em}.start-here-file{display:flex;align-items:center;gap:10px;padding:7px 8px;border-radius:7px;cursor:pointer;transition:background .15s}.start-here-file:hover{background:var(--bg-1)}.start-here-icon{font-size:1.2em;flex-shrink:0}.start-here-info{display:flex;flex-direction:column;flex:1;min-width:0}.start-here-name{font-weight:600;font-size:.88em;font-family:monospace}.start-here-desc{font-size:.78em;opacity:.7;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.start-here-arr{opacity:.4;flex-shrink:0}.toast-msg.toast-warn{border-color:var(--warn,#d97706);background:color-mix(in srgb,var(--warn,#d97706) 10%,var(--bg-3))}@media (prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}.guide-bridge{margin:14px 0 6px;padding:12px;background:var(--bg-3);border-radius:10px;border:1px solid var(--border)}.guide-bridge-title{font-size:11px;font-weight:700;color:var(--text-2);margin-bottom:10px;letter-spacing:.4px;text-transform:uppercase}.guide-bridge-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.guide-bridge-card{background:var(--bg-2);border:1px solid var(--border);border-radius:8px;padding:10px 8px;cursor:pointer;text-align:left;transition:border-color .2s,transform .15s;width:100%}.guide-bridge-card:hover{border-color:var(--accent);transform:translateY(-2px)}.bridge-icon{font-size:1.4em;display:block;margin-bottom:4px}.bridge-name{font-size:12px;font-weight:700;color:var(--text);margin-bottom:3px}.bridge-why{font-size:11px;color:var(--text-2);line-height:1.4}.dash-shortcuts{display:flex;flex-direction:column;gap:6px;padding:4px 0 8px}.dash-sc-row{display:flex;align-items:center;gap:10px}.dash-sc-key{background:var(--bg-3);border:1px solid var(--border);border-bottom-width:2px;border-radius:5px;padding:2px 8px;font-size:11px;font-family:monospace;color:var(--text);white-space:nowrap}.dash-sc-desc{font-size:12px;color:var(--text-2)}.dash-pex-grid{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}.dash-pex-btn{font-size:12px!important;display:flex!important;align-items:center;gap:5px}.dash-pex-cnt{background:var(--bg-3);border-radius:4px;padding:1px 5px;font-size:10px;font-weight:700;color:var(--text-2)}.preset-mode-toggle{display:flex;gap:6px;padding:8px 0 6px;border-bottom:1px solid var(--border);margin-bottom:8px}.preset-mode-btn{background:var(--bg-3);border:1px solid var(--border);border-radius:20px;padding:5px 14px;font-size:12px;cursor:pointer;color:var(--text-2);transition:background .15s,border-color .15s,color .15s}.preset-mode-btn.active,.preset-mode-btn:hover{background:var(--accent);border-color:var(--accent);color:#fff}.scale-selector{display:flex;gap:4px;padding:4px 0 6px;flex-wrap:wrap;justify-content:center}.scale-btn{background:var(--bg-3);border:1px solid var(--border);border-radius:16px;padding:4px 10px;font-size:11px;cursor:pointer;color:var(--text-2);white-space:nowrap;transition:background .15s,border-color .15s,color .15s}.scale-btn.active,.scale-btn:hover{background:var(--accent-2,var(--accent));border-color:var(--accent);color:#fff}.field-cat-bar{display:flex;gap:4px;padding:4px 0 6px;flex-wrap:wrap;width:100%;justify-content:center}.field-cat-btn{background:var(--bg-3);border:1px solid var(--border);border-radius:16px;padding:4px 10px;font-size:11px;cursor:pointer;color:var(--text-2);white-space:nowrap;transition:background .15s,border-color .15s,color .15s}.field-cat-btn.active,.field-cat-btn:hover{background:var(--bg-2);border-color:var(--accent);color:var(--text)}.preset-suggest-wrap{margin-bottom:8px;position:relative}.preset-suggest-in{width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:8px;background:var(--bg-2);color:var(--text);font-size:.95rem;outline:none;transition:border .2s;box-sizing:border-box}.preset-suggest-in:focus{border-color:var(--accent)}.preset-suggest-in::placeholder{color:var(--text-2);opacity:.7}.preset-suggest-box{display:none;position:absolute;left:0;right:0;z-index:99;margin-top:4px;border:1px solid var(--border);border-radius:8px;background:var(--bg-2);overflow:hidden;box-shadow:0 4px 16px #00000040}.ps-item{display:flex;align-items:center;gap:8px;padding:8px 12px;cursor:pointer;transition:background .15s}.ps-item:hover,.ps-item:focus{background:var(--bg-3);outline:none}.ps-badge-field,.ps-badge-std{font-size:.75rem;flex-shrink:0}.ps-name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px}.ps-desc{color:var(--text-2);font-size:.82rem;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ps-score{font-size:.72rem;color:var(--accent);font-weight:700;flex-shrink:0}.ps-empty{padding:12px;text-align:center;color:var(--text-2);font-size:.85rem}

</style>
</head>
<body>
<a href="#cbody" class="skip-link">Skip to content</a>
<div class="app" id="app">
  <!-- Topbar -->
  <header class="topbar" role="banner">
    <div class="topbar-left">
      <div class="topbar-brand">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
        <span>DevForge <small>v9</small></span>
      </div>

    </div>
    <div class="topbar-right">
      <button class="theme-btn" onclick="toggleLang()" title="EN/JA" aria-label="Toggle language" id="langBtn">🌐</button>
      <button class="theme-btn" onclick="toggleTheme()" title="Theme" aria-label="Toggle theme" id="themeBtn">🌙</button>
      <button class="theme-btn" onclick="if(typeof showCommandPalette==='function')showCommandPalette()" title="検索 (Ctrl+P)" id="searchBtn" aria-label="Search">🔍</button>
      <button class="theme-btn" onclick="showManual()" title="Help" id="helpBtn" aria-label="Help">❓</button>
      <button class="theme-btn" onclick="showKB()" title="Shortcuts" id="kbBtn" aria-label="Keyboard shortcuts">⌨️</button>
      <button class="theme-btn" onclick="showPM()" title="Projects" id="pmBtn">📁</button>
    </div>
  </header>
  <div class="pstrip" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Phase progress"><div class="pstrip-fill" id="pbar" style="width:0%"></div></div>

  <!-- Onboarding -->
  <div class="onboard" id="onboard" role="region" aria-label="Onboarding">
    <div class="hero-anim">
      <div class="hero-content">
        <div class="version-badge">v9.5 — 2026 Edition</div>
        <h1 id="heroTitle">DevForge v9</h1>
        <p id="heroDesc">開発の3大悪夢を解決。質問に答えるだけで135+ファイルの設計図を自動生成。20の柱が、AIと共に「ひらめき→仕様→実装」の階段をガイド。</p>
        <p id="heroLv0Hint" style="display:none">難しい知識は不要。質問に答えるだけ</p>
      </div>
    </div>
    <div class="stat-row">
      <div class="stat-item"><div class="num" id="statFileNum">135+</div><div class="lbl" id="statFiles">生成ファイル</div></div>
      <div class="stat-item"><div class="num" id="statTechNum"></div><div class="lbl" id="statTech">技術エントリ</div></div>
      <div class="stat-item"><div class="num" id="statPillarNum">20</div><div class="lbl" id="statPillars">柱 (Pillars)</div></div>
      <div class="stat-item"><div class="num">10+</div><div class="lbl" id="statAI">AIツール対応</div></div>
    </div>
    <div class="info-grid">
      <div class="icard"><h4>😱 3つの悪夢を解決</h4><p>真っ白な画面の絶望・終わらない連携地獄・「俺の環境では動く」症候群…DevForgeが全て自動解決</p></div>
      <div class="icard"><h4>🧪 20の柱×135+ファイル</h4><p>設計書を自動生成 → AIに投入 → 実コード。質問に答えるだけで仕様・環境・AIルール全てを自動生成。</p></div>
      <div class="icard"><h4>📱 モバイル対応</h4><p>Expo / React Native 開発パス・EAS Build・OTA更新</p></div>
      <div class="icard"><h4>🤖 AI自律開発</h4><p>Vibe Coding・マルチAgent・Claude Code Subagents</p></div>
      <div class="icard"><h4>💳 決済・CMS・EC</h4><p>Stripe・microCMS・Medusa・Shopify Hydrogen</p></div>
      <div class="icard"><h4>📦 フルエクスポート</h4><p>ZIP・PDF・全ファイル結合コピー・URLシェア</p></div>
    </div>
    <div class="pillars-badge">
      <span class="pbadge">①SDD統合</span><span class="pbadge">②DevContainer</span><span class="pbadge">③MCP設定</span>
      <span class="pbadge">④AIルール</span><span class="pbadge">⑤並列探索</span><span class="pbadge">⑥Dashboard</span><span class="pbadge">⑦ロードマップ</span><span class="pbadge">⑧AIランチャー</span><span class="pbadge">⑨デザインシステム</span><span class="pbadge">⑩リバースEng</span><span class="pbadge">⑪実装ガイド</span><span class="pbadge">⑫セキュリティ</span><span class="pbadge">⑬戦略</span><span class="pbadge">⑭運用</span><span class="pbadge">⑮未来戦略</span><span class="pbadge">⑯開発IQ</span><span class="pbadge">⑰ゲノム</span><span class="pbadge">⑱Prompt Ops</span><span class="pbadge">⑲エンタープライズ</span><span class="pbadge">⑳CI/CD</span>
    </div>
    <div class="start-zone">
      <div class="szl" id="skillAsk">Select your skill level</div>
      <div class="skill-sel" id="skillSel" role="radiogroup" aria-label="Skill level">
        <div class="skcard" data-lv="beginner" onclick="pickSkill('beginner')" role="radio" aria-checked="false" tabindex="0"><div class="em">🌱</div><h4 class="sk-title">Beginner</h4><p class="sk-desc">初めてのWeb開発。最適な選択肢をガイドします</p></div>
        <div class="skcard on" data-lv="intermediate" onclick="pickSkill('intermediate')" role="radio" aria-checked="true" tabindex="0"><div class="em">⚡</div><h4 class="sk-title">Intermediate</h4><p class="sk-desc">1年以上の経験。Svelte, DDD等の中級オプション解放</p></div>
        <div class="skcard" data-lv="pro" onclick="pickSkill('pro')" role="radio" aria-checked="false" tabindex="0"><div class="em">🔥</div><h4 class="sk-title">Professional</h4><p class="sk-desc">全オプション解放。MDD, RBAC, SSO等＋確認ダイアログ付き</p></div>
      </div>
      <div class="skill-fine" id="skillFine">
        <div class="skill-fine-ticks">
          <span>🔰</span><span>🌱</span><span>📗</span><span>⚡</span><span>🔥</span><span>💎</span><span>👑</span>
        </div>
        <input type="range" id="skillLvSlider" min="0" max="6" step="1" value="3" oninput="pickSkillLv(+this.value)" aria-label="スキル微調整">
        <div class="skill-fine-label" id="skillFineLabel">⚡ 中級者</div>
      </div>
      <input class="nameIn" id="nameIn" placeholder="" aria-label="Project name">
      <div class="preset-row" id="presetRow"></div>
      <button class="btn btn-g btn-xs" onclick="showPresetCompare()" style="margin-bottom:8px" id="compareBtn">⚔️ <span id="compareLbl">テンプレート比較</span></button>
      <button class="btn btn-p btn-start" onclick="start()" id="startBtn">🚀 開始する</button>
    </div>
    <div class="app-footer">© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん</div>
  </div>

  <!-- Workspace -->
  <main id="ws" role="main" aria-label="Workspace" style="display:none;">
    <div class="toc-panel" id="tocPanel" role="navigation" aria-label="Table of contents"></div>
    <div class="mobtabs" role="tablist" aria-label="View switch"><div class="mobtab on" onclick="mobSw('c')" role="tab" aria-selected="true" tabindex="0">💬 チャット</div><div class="mobtab" onclick="mobSw('p')" role="tab" aria-selected="false" tabindex="0">📄 プレビュー</div><div class="mobtab" onclick="mobFiles()" role="tab" aria-selected="false" tabindex="0">📁 ファイル</div></div>
    <div class="ws-outer">
      <aside class="sidebar" id="sidebar" role="complementary" aria-label="Sidebar navigation">
        <div class="sb-head">
          <button class="sb-toggle" id="sbToggle" onclick="toggleSidebar()" title="サイドバー切替 (Ctrl+B)" aria-label="Toggle sidebar">◀</button>
        </div>
        <div class="sb-body" id="sbBody">
          <div class="sb-tabs" role="tablist" aria-label="Sidebar tabs">
            <button class="sb-tab on" data-tab="progress" onclick="switchSidebarTab('progress')" role="tab" aria-selected="true">📋</button>
            <button class="sb-tab" data-tab="files" onclick="switchSidebarTab('files')" role="tab" aria-selected="false">📁</button>
          </div>
          <div class="sb-section sb-progress" id="sbProgress">
            <div class="pd-title" id="pdTitle">Progress</div>
            <div id="sbPills"></div>
            <div class="pd-progress"><div class="pd-bar"><div class="pd-bar-fill" id="pdBar" style="width:0%"></div></div><span id="pdPct">0%</span><span id="cxMini"></span></div>
            <button class="btn btn-p pd-gen" id="pdGenBtn" onclick="generateAll()">🚀 生成</button>
            <div class="sb-pillar-grid" id="sbPillarGrid"></div>
          </div>
          <div class="sb-section sb-files" id="sbFiles" style="display:none"></div>
        </div>
      </aside>
      <div class="sb-iconbar" id="sbIconbar" style="display:none" aria-hidden="true">
        <button class="sb-icon-btn" onclick="toggleSidebar()" title="サイドバーを開く" aria-label="Open sidebar">▶</button>
        <button class="sb-icon-btn" onclick="toggleSidebar();switchSidebarTab('progress')" title="進捗" aria-label="Progress">📋</button>
        <button class="sb-icon-btn" onclick="toggleSidebar();switchSidebarTab('files')" title="ファイル" aria-label="Files">📁</button>
      </div>
      <div class="ws">
        <div class="panel-c" id="panC">
          <div class="cbody" id="cbody" role="log" aria-live="polite" aria-label="Conversation"></div>
          <div class="izone" id="izone" role="form" aria-label="Answer input"></div>
        </div>
        <div class="panel-p" id="panP" role="complementary" aria-label="Preview panel">
          <div class="prev-head">
            <h3 id="panPTitle">📁 生成ファイル</h3>
            <div class="view-nav" id="viewNav"><button class="btn btn-xs btn-s view-nav-btn disabled" id="viewBackBtn" onclick="viewBack()" title="前の画面" aria-label="Previous screen">⏮</button><button class="btn btn-xs btn-s view-nav-btn disabled" id="viewFwdBtn" onclick="viewForward()" title="次の画面" aria-label="Next screen">⏭</button></div>
            <div class="prev-tabs" id="prevTabs" role="tablist" aria-label="Preview tabs"></div>
          </div>
          <div class="pillar-tabs" id="pillarTabs" role="tablist" aria-label="Pillar tabs"></div>
          <div class="prev-body" id="prevBody" aria-live="polite"><p class="prev-placeholder">質問に回答するとリアルタイムでプレビューが更新されます</p></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Help Overlay -->
  <div class="help-overlay" id="helpOverlay" role="dialog" aria-modal="true" aria-label="Help manual" onclick="if(event.target===this)closeManual()">
    <div class="help-modal" role="document">
      <div class="help-nav" id="helpNav" role="navigation" aria-label="Help navigation">
        <input id="helpSearch" class="help-search" placeholder="🔍" oninput="filterManual(this.value)" aria-label="Search help">
      </div>
      <div class="help-body" id="helpBody"></div>
    </div>
  </div>

  <!-- Keyboard Shortcut Overlay -->
  <div class="kb-overlay" id="kbOverlay" role="dialog" aria-modal="true" aria-label="Keyboard shortcuts" onclick="if(event.target===this)closeKB()">
    <div class="kb-modal" role="document">
      <h3 id="kbTitle">⌨️ ショートカット</h3>
      <div class="kb-row"><span class="kblbl">ヘルプ・マニュアル</span><span class="kb-key">F1 / Ctrl+H</span></div>
      <div class="kb-row"><span class="kblbl">ショートカット一覧</span><span class="kb-key">Ctrl+K</span></div>
      <div class="kb-row"><span class="kblbl">コマンドパレット</span><span class="kb-key">Ctrl+P</span></div>
      <div class="kb-row"><span class="kblbl">テーマ切替</span><span class="kb-key">Ctrl+T</span></div>
      <div class="kb-row"><span class="kblbl">言語切替</span><span class="kb-key">Ctrl+L</span></div>
      <div class="kb-row"><span class="kblbl">エクスポート</span><span class="kb-key">Ctrl+E</span></div>
      <div class="kb-row"><span class="kblbl">全ファイルコピー</span><span class="kb-key">Ctrl+Shift+C</span></div>
      <div class="kb-row"><span class="kblbl">プロジェクト管理</span><span class="kb-key">Ctrl+M</span></div>
      <div class="kb-row"><span class="kblbl">サイドバー切替</span><span class="kb-key">Ctrl+B</span></div>
      <div class="kb-row"><span class="kblbl">エクスプローラー</span><span class="kb-key">Ctrl+4</span></div>
      <div class="kb-row"><span class="kblbl">ダッシュボード</span><span class="kb-key">Ctrl+5</span></div>
      <div class="kb-row"><span class="kblbl">ロードマップ</span><span class="kb-key">Ctrl+6</span></div>
      <div class="kb-row"><span class="kblbl">AI起動</span><span class="kb-key">Ctrl+7</span></div>
    </div>
  </div>
  <!-- Help Popup (per-question) -->
  <div id="helpPopup" role="tooltip" aria-live="polite" style="display:none;"></div>
  <!-- Confirm Overlay (Pro mode) -->
  <div class="confirm-overlay" id="confirmOverlay" role="alertdialog" aria-modal="true" aria-label="Confirmation"></div>
  <!-- Project Manager Overlay -->
  <div class="pm-overlay" id="pmOverlay" role="dialog" aria-modal="true" aria-label="Project manager" onclick="if(event.target===this)closePM()"></div>
  <!-- Tour Container -->
  <div class="tour-container" id="tourContainer" role="complementary" aria-label="Guided tour"></div>
</div>
<script>
const $=id=>document.getElementById(id);
const KEY='devforge-v9';
const V=9;
var SKILL_TIERS=['beginner','beginner','intermediate','intermediate','pro','pro','pro'];
function skillTier(lv){return SKILL_TIERS[lv]||'intermediate';}
var SKILL_NAMES=[
{ja:'完全初心者',en:'Absolute Beginner',emoji:'🔰'},
{ja:'初心者',en:'Beginner',emoji:'🌱'},
{ja:'慣れ始め',en:'Getting Started',emoji:'📗'},
{ja:'中級者',en:'Intermediate',emoji:'⚡'},
{ja:'上級者',en:'Advanced',emoji:'🔥'},
{ja:'エキスパート',en:'Expert',emoji:'💎'},
{ja:'伝道者',en:'Evangelist',emoji:'👑'}
];
let S={phase:0,step:0,answers:{},projectName:'',skill:'intermediate',skillLv:3,preset:'custom',lang:'ja',genLang:'ja',theme:'dark',pillar:0,previewFile:null,files:{},skipped:[],progress:{},editedFiles:{},prevFiles:{},qbarDismissed:false,pinnedFiles:[],recentFiles:[],sidebarOpen:true,_v:V};
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function escAttr(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/"/g,'&quot;');}
function _jp(s,d){if(s==null)return d;try{return JSON.parse(s);}catch(e){return d;}}
function sanitize(s,max=500){if(!s||typeof s!=='string')return '';return s.replace(/<[^>]*>/g,'').slice(0,max).trim();}
function sanitizeName(s){if(!s||typeof s!=='string')return '';return s.replace(/[<>"'&\\\/]/g,'').slice(0,100).trim();}
function fileSlug(s){if(!s)return 'devforge-project';const r=s.replace(/[^a-zA-Z0-9\s_-]/g,'').replace(/[\s_]+/g,'-').replace(/-{2,}/g,'-').replace(/^-|-$/g,'').slice(0,80);return r||'devforge-project';}
function _filterProto(obj){if(!obj||typeof obj!=='object')return obj;['__proto__','constructor','prototype'].forEach(k=>{delete obj[k];});return obj;}
// Toast stacking state
let _toastStack=[];
const _maxToasts=5;
function toast(m,opts){
if(typeof m==='string'&&!opts){opts={};}else if(typeof m==='object'){opts=m;m=opts.message||'';}
const {type='info',duration=2200,undoFn=null,action=null,actionLabel='Undo'}=opts;
const t=document.createElement('div');
t.className='toast-msg toast-'+type;
t.setAttribute('role','alert');
let html='<span class="toast-text">'+esc(m)+'</span>';
// Undo button
if(undoFn){
html+='<button class="toast-action" aria-label="'+esc(actionLabel)+'">'+esc(actionLabel)+'</button>';
}else if(action){
html+='<button class="toast-action" aria-label="'+esc(actionLabel)+'">'+esc(actionLabel)+'</button>';
}
t.innerHTML=html;
// Action handlers
if(undoFn){
const btn=t.querySelector('.toast-action');
if(btn){
btn.onclick=()=>{
undoFn();
t.remove();
_toastStack=_toastStack.filter(x=>x!==t);
repositionToasts();
};
}
}else if(action){
const btn=t.querySelector('.toast-action');
if(btn){
btn.onclick=()=>{
action();
t.remove();
_toastStack=_toastStack.filter(x=>x!==t);
repositionToasts();
};
}
}
// Stack management
if(_toastStack.length>=_maxToasts){
const oldest=_toastStack.shift();
if(oldest)oldest.remove();
}
_toastStack.push(t);
document.body.appendChild(t);
repositionToasts();
if(typeof announce==='function')announce(m);
// Auto-remove
const autoRemove=setTimeout(()=>{
t.classList.add('toast-exit');
setTimeout(()=>{
t.remove();
_toastStack=_toastStack.filter(x=>x!==t);
repositionToasts();
},200);
},duration);
// Clear timeout if manually dismissed
t._autoRemove=autoRemove;
}
function repositionToasts(){
const qb=$('qbar');
const qbHeight=qb&&!S.qbarDismissed?72:0;
_toastStack.forEach((t,i)=>{
const bottom=qbHeight+16+(i*60);
t.style.bottom=bottom+'px';
});
}
function hasDM(m){return (S.answers.dev_methods||'').includes(m);}
let _lsOK=true;try{localStorage.setItem('_t','1');localStorage.removeItem('_t');}catch(e){_lsOK=false;}
function _lsGet(k){if(!_lsOK)return null;try{return localStorage.getItem(k);}catch(e){return null;}}
function _lsSet(k,v){if(!_lsOK)return;try{localStorage.setItem(k,v);}catch(e){}}
function _lsRm(k){if(!_lsOK)return;try{localStorage.removeItem(k);}catch(e){}}
function _lsUsage(){try{const bytes=JSON.stringify(localStorage).length*2;return{used:bytes,pct:Math.round(bytes/(5*1024*1024)*100)};}catch(e){return{used:0,pct:0};}}
// Save indicator (HCD: ⑥文脈適合)
function showSaveIndicator(){
let ind=$('saveIndicator');
if(!ind){
ind=document.createElement('div');
ind.id='saveIndicator';
ind.className='save-indicator';
ind.innerHTML='💾';
document.body.appendChild(ind);
}
ind.classList.add('save-indicator-show');
setTimeout(()=>ind.classList.remove('save-indicator-show'),800);
}
var _storWarnAt=0;
function save(){const d=JSON.stringify(S);const sz=d.length;const now=Date.now();if(now-_storWarnAt>30000){if(sz>4*1024*1024){toast(S.lang==='ja'?'⚠️ データ容量が4MBを超えました。ZIPでエクスポートし生成ファイルをクリアしてください':'⚠️ Data exceeded 4MB. Export ZIP and clear generated files.',{type:'error',duration:5000});_storWarnAt=now;}else if(sz>3.5*1024*1024){toast(S.lang==='ja'?'💾 データ容量が3.5MBに近づいています。ZIPエクスポートを推奨します':'💾 Storage nearing 3.5MB. Export ZIP recommended.',{type:'warn',duration:4000});_storWarnAt=now;}}if(_lsOK){try{localStorage.setItem(KEY,d);}catch(e){toast(S.lang==='ja'?'❌ 保存失敗: ブラウザストレージが満杯です。ZIPでエクスポートしてください':'❌ Save failed: Browser storage full. Export as ZIP.',{type:'error',duration:6000});return;}}showSaveIndicator();}
function load(){
let d=_lsGet(KEY);
if(!d){d=_lsGet('devforge-v8');if(d)_lsRm('devforge-v8');}
// Migrate legacy dfv8_ keys to devforge- namespace
const _legacyTpl=_lsGet('dfv8_templates');if(_legacyTpl){_lsSet('devforge-templates',_legacyTpl);_lsRm('dfv8_templates');}
// Migrate dfv8_road_* keys
try{const ps=JSON.parse(_lsGet('devforge-projects')||'{}');Object.keys(ps).forEach(n=>{const lk='dfv8_road_'+n;const nk='devforge-road-'+n;const v=_lsGet(lk);if(v&&!_lsGet(nk)){_lsSet(nk,v);}_lsRm(lk);});}catch(e){}
if(!d)return;
try{
const o=JSON.parse(d);
if(typeof o.phase==='number')S.phase=o.phase;
if(typeof o.step==='number')S.step=o.step;
if(o.answers&&typeof o.answers==='object'&&!Array.isArray(o.answers))S.answers=_filterProto(o.answers);
if(typeof o.projectName==='string')S.projectName=o.projectName;
if(typeof o.skill==='string')S.skill=o.skill;
if(typeof o.skillLv==='number'&&!isNaN(o.skillLv)&&o.skillLv>=0&&o.skillLv<=6){S.skillLv=Math.min(6,Math.max(0,Math.round(o.skillLv)));S.skill=skillTier(S.skillLv);}else{S.skillLv=S.skill==='beginner'?1:S.skill==='pro'?5:3;}
if(typeof o.preset==='string')S.preset=o.preset;
if(typeof o.lang==='string')S.lang=o.lang;
if(typeof o.genLang==='string')S.genLang=o.genLang;
if(typeof o.theme==='string')S.theme=o.theme;
if(typeof o.pillar==='number')S.pillar=o.pillar;
if(typeof o.previewFile==='string'||o.previewFile===null)S.previewFile=o.previewFile;
if(o.files&&typeof o.files==='object'&&!Array.isArray(o.files))S.files=_filterProto(o.files);
if(Array.isArray(o.skipped))S.skipped=o.skipped;
if(o.progress&&typeof o.progress==='object'&&!Array.isArray(o.progress))S.progress=o.progress;
if(o.editedFiles&&typeof o.editedFiles==='object'&&!Array.isArray(o.editedFiles))S.editedFiles=_filterProto(o.editedFiles);
if(o.prevFiles&&typeof o.prevFiles==='object'&&!Array.isArray(o.prevFiles))S.prevFiles=_filterProto(o.prevFiles);
if(typeof o.qbarDismissed==='boolean')S.qbarDismissed=o.qbarDismissed;
if(Array.isArray(o.pinnedFiles))S.pinnedFiles=o.pinnedFiles;
if(Array.isArray(o.recentFiles))S.recentFiles=o.recentFiles;
if(typeof o.sidebarOpen==='boolean')S.sidebarOpen=o.sidebarOpen;
if(typeof o._v==='number')S._v=o._v;
if(!S._v||S._v<V){
S.genLang=S.genLang||S.lang||'ja';
S.editedFiles=S.editedFiles||{};
S.prevFiles=S.prevFiles||{};
S._v=V;
save();
}
}catch(e){_lsRm(KEY);}
}
let voiceRec=null,voiceBtn=null,_confirmCb=null;
const I18N={
ja:{
p1:'Phase 1',p2:'Phase 2',p3:'Phase 3',
heroTitle:'DevForge v9',
heroDesc:'質問に答えるだけで、135+ファイルの開発ドキュメント・環境設定・AIルール・学習ロードマップを自動生成。20の柱でAI駆動開発をゼロから完全サポート。',
startBtn:'🚀 開始する',
statFiles:'生成ファイル',statTech:'技術エントリ',statPillars:'柱 (Pillars)',statAI:'AIツール対応',
skillAsk:'スキルレベルを選択',
skBeginner:'初心者',skBeginnerDesc:'初めてのWeb開発。最適な選択肢をガイドします',
skIntermediate:'中級者',skIntermediateDesc:'1年以上の経験。Svelte, DDD等の中級オプション解放',
skPro:'上級者',skProDesc:'全オプション解放。MDD, RBAC, SSO等＋確認ダイアログ付き',
send:'送信',confirm:'決定',skip:'スキップ ▸',selectMin:'最低1つ選択してください',
sortLabel:'ドラッグで優先順位を並べ替えてください:',sortConfirm:'この順序で決定',
skipMsg:'⏭️ この質問はスキップしました。後で回答できます。',
skippedTitle:'📋 スキップした質問が ',skippedSuffix:' 件あります。回答しましょう。',
skippedDone:'✅ すべての質問に回答完了！',
skippedBanner:'⏭️ スキップ回答中 — 残り ',skippedBannerSuffix:' 件',
answerConfirm:'回答を確認',edit:'修正',
tourNext:'次へ',tourPrev:'前へ',tourDone:'完了',tourStart:'ツアー開始',
phEnd1:'Phase 1 完了！技術選定に進みます。',
phEnd2:'Phase 2 完了！機能・データ設計に進みます。',
genBtn:'📦 135+ファイル生成',
genDone:'✅ 135+ファイルが生成されました！プレビューパネルで確認してください。',
copyDone:'クリップボードにコピーしました',
pmTitle:'📁 プロジェクト管理',pmNew:'新規プロジェクト',pmEmpty:'保存されたプロジェクトはありません',
helpClose:'閉じる',
kbTitle:'⌨️ ショートカット',
kb:['ヘルプ・マニュアル','ショートカット一覧','コマンドパレット','テーマ切替','言語切替','エクスポート','全ファイルコピー','プロジェクト管理','サイドバー切替','エクスプローラー','ダッシュボード','ロードマップ','AI起動'],
pillar:['①SDD統合','②DevContainer','③MCP設定','④AIルール','⑤並列探索','⑥Dashboard','⑦ロードマップ','⑧AIランチャー','⑨デザインシステム','⑩リバースEng','⑪実装ガイド','⑫セキュリティ','⑬戦略インテリジェンス','⑭運用インテリジェンス','⑮未来戦略','⑯開発IQ','⑰プロンプトゲノム','⑱Prompt Ops','⑲エンタープライズ','⑳CI/CD'],
skillFineTune:'スキル微調整'
},
en:{
p1:'Phase 1',p2:'Phase 2',p3:'Phase 3',
heroTitle:'DevForge v9',
heroDesc:'Solve 3 dev nightmares. Answer questions to auto-generate 135+ design docs. 20 pillars guide your "idea → spec → code" journey with AI.',
startBtn:'🚀 Get Started',
statFiles:'Generated Files',statTech:'Tech Entries',statPillars:'Pillars',statAI:'AI Tools',
skillAsk:'Select your skill level',
skBeginner:'Beginner',skBeginnerDesc:'First-time web dev. Curated options to guide you smoothly',
skIntermediate:'Intermediate',skIntermediateDesc:'1+ year experience. Unlocks Svelte, DDD & mid-level options',
skPro:'Professional',skProDesc:'All options unlocked. MDD, RBAC, SSO & full customization with confirmation',
send:'Send',confirm:'Confirm',skip:'Skip ▸',selectMin:'Select at least one',
sortLabel:'Drag to sort by priority:',sortConfirm:'Confirm order',
skipMsg:'⏭️ This question was skipped. You can answer it later.',
skippedTitle:'📋 You have ',skippedSuffix:' skipped questions. Let\'s answer them.',
skippedDone:'✅ All questions answered!',
skippedBanner:'⏭️ Answering skipped — ',skippedBannerSuffix:' remaining',
answerConfirm:'Confirm answer',edit:'Edit',
tourNext:'Next',tourPrev:'Back',tourDone:'Done',tourStart:'Start Tour',
phEnd1:'Phase 1 complete! Moving to tech stack.',
phEnd2:'Phase 2 complete! Moving to feature design.',
genBtn:'📦 Generate 135+ Files',
genDone:'✅ 135+ files generated! Check the preview panel.',
copyDone:'Copied to clipboard',
pmTitle:'📁 Project Manager',pmNew:'New Project',pmEmpty:'No saved projects',
helpClose:'Close',
kbTitle:'⌨️ Shortcuts',
kb:['Help / Manual','Shortcuts','Command Palette','Toggle Theme','Toggle Language','Export','Copy All Files','Project Manager','Toggle Sidebar','Explorer','Dashboard','Roadmap','AI Launcher'],
pillar:['①SDD','②DevContainer','③MCP','④AI Rules','⑤Explorer','⑥Dashboard','⑦Roadmap','⑧AI Launcher','⑨Design System','⑩Reverse Eng','⑪Impl Guide','⑫Security','⑬Strategic Intelligence','⑭Ops Intelligence','⑮Future Strategy','⑯Dev IQ','⑰Prompt Genome','⑱Prompt Ops','⑲Enterprise','⑳CI/CD'],
skillFineTune:'Skill Fine-Tune'
}
};
const t=k=>I18N[S.lang][k]||k;
const _PD={frontend:'React + Next.js',backend:'Supabase',mobile:'none',ai_auto:'none',payment:'none',deploy:'Vercel',css_fw:'Tailwind CSS',dev_methods:'TDD（テスト駆動）, SDD（仕様駆動）',dev_methodsEn:'TDD (Test-Driven), SDD (Spec-Driven)',screens:['ダッシュボード','一覧ページ','詳細ページ','設定','管理画面'],screensEn:['Dashboard','List Page','Detail Page','Settings','Admin Panel']};
function _mp(p){return Object.assign({},_PD,p);}
const PR={
saas:_mp({name:'SaaSアプリ',nameEn:'SaaS App',icon:'☁️',purpose:'サブスクリプション型Webサービスの構築',purposeEn:'Build a subscription-based web service',target:['スタートアップ','中小企業','フリーランス'],targetEn:['Startups','SMBs','Freelancers'],features:['ユーザー登録・ログイン','ダッシュボード','課金・プラン管理','チーム招待','分析レポート'],featuresEn:['User Registration & Login','Dashboard','Billing & Plan Management','Team Invitations','Analytics Reports'],
entities:'User, Team, Subscription, Invoice, Activity',payment:'stripe',org_model:'マルチテナント(RLS)',screens:['ダッシュボード','プラン管理','チーム設定','請求','分析画面'],screensEn:['Dashboard','Plan Management','Team Settings','Billing','Analytics']}),
ai_agent:_mp({name:'AIエージェント',nameEn:'AI Agent',icon:'🤖',purpose:'AIを活用したタスク自動化・対話型アシスタント',purposeEn:'AI-powered task automation & conversational assistant',target:['エンジニア','スタートアップ'],targetEn:['Engineers','Startups'],features:['チャットインターフェース','プロンプト管理','履歴・コンテキスト管理','API連携','使用量ダッシュボード'],featuresEn:['Chat Interface','Prompt Management','History & Context Management','API Integration','Usage Dashboard'],
entities:'User, Conversation, Message, Prompt, ApiUsage, Agent, Tool',ai_auto:'マルチAgent協調',payment:'stripe'}),
ai_content:_mp({name:'AIコンテンツ生成',nameEn:'AI Content Gen',icon:'✨',purpose:'AIを活用した文章・画像・動画の自動生成プラットフォーム',purposeEn:'AI-powered text, image & video auto-generation platform',target:['マーケター','ブロガー','クリエイター'],targetEn:['Marketers','Bloggers','Creators'],features:['テンプレート選択','AIコンテンツ生成','編集・リライト','SEO最適化','エクスポート'],featuresEn:['Template Selection','AI Content Generation','Edit & Rewrite','SEO Optimization','Export'],
entities:'User, Template, Generation, Content, Project, CreditUsage',ai_auto:'Vibe Coding入門',payment:'stripe'}),
automation:_mp({name:'ワークフロー自動化',nameEn:'Workflow Automation',icon:'⚙️',purpose:'タスクやプロセスを自動化するiPaaS/ノーコード連携ツール',purposeEn:'iPaaS/no-code tool for automating tasks and processes',target:['中小企業','マーケター','管理者'],targetEn:['SMBs','Marketers','Admins'],frontend:'React (Vite SPA)',backend:'Node.js + Express',features:['ビジュアルフローエディタ','トリガー・アクション設定','API連携','実行ログ','スケジュール実行'],featuresEn:['Visual Flow Editor','Trigger & Action Config','API Integration','Execution Logs','Scheduled Runs'],
entities:'User, Workflow, Trigger, Action, Execution, Connection, Log',payment:'stripe',org_model:'ワークスペース型'}),
marketplace:_mp({name:'マーケットプレイス',nameEn:'Marketplace',icon:'🏪',purpose:'売り手と買い手をつなぐ双方向プラットフォーム',purposeEn:'Two-sided platform connecting buyers and sellers',target:['一般消費者','フリーランス','スモールビジネス'],targetEn:['Consumers','Freelancers','Small Businesses'],features:['出品・商品登録','検索・フィルタ','メッセージ機能','決済・エスクロー','レビュー・評価'],featuresEn:['Product Listing','Search & Filter','Messaging','Payment & Escrow','Reviews & Ratings'],
entities:'User, Listing, Category, Order, Transaction, Review, Message',payment:'stripe',screens:['ホーム','出品一覧','商品詳細','メッセージ','取引履歴'],screensEn:['Home','Listings','Listing Detail','Messages','Transaction History']}),
ec:_mp({name:'ECサイト',nameEn:'E-Commerce',icon:'🛍️',purpose:'オンラインショップの構築',purposeEn:'Build an online shop',target:['一般消費者','ショップオーナー'],targetEn:['Consumers','Shop Owners'],backend:'Node.js + Express',features:['商品管理','カート・決済','注文管理','在庫管理','レビュー機能'],featuresEn:['Product Management','Cart & Checkout','Order Management','Inventory Management','Reviews'],entities:'Product, Order, User, Category, Cart, Payment',payment:'ec_build',screens:['商品一覧','商品詳細','カート','チェックアウト','注文履歴'],screensEn:['Product List','Product Detail','Cart','Checkout','Order History']}),
dashboard:_mp({name:'ダッシュボード',nameEn:'Dashboard',icon:'📊',purpose:'データを集約・可視化してインサイトを提供する分析ツール',purposeEn:'Analytics tool to aggregate and visualize data for insights',target:['経営者','マーケター','データアナリスト'],targetEn:['Executives','Marketers','Data Analysts'],features:['KPIウィジェット','グラフ・チャート','データフィルタ','レポート出力','アラート通知'],featuresEn:['KPI Widgets','Charts & Graphs','Data Filters','Report Export','Alert Notifications'],
entities:'User, DataSource, Widget, Dashboard, Report, Alert'}),
chatbot:_mp({name:'チャットボット',nameEn:'Chatbot',icon:'💬',purpose:'AIカスタマーサポート・FAQ自動応答システム',purposeEn:'AI customer support & FAQ auto-response system',target:['中小企業','EC事業者'],targetEn:['SMBs','E-commerce Businesses'],frontend:'React (Vite SPA)',features:['チャットウィジェット','FAQ学習・管理','会話フロー設計','有人エスカレーション','分析レポート'],featuresEn:['Chat Widget','FAQ Learning & Management','Conversation Flow Design','Human Escalation','Analytics Reports'],
entities:'User, Bot, Conversation, Message, Intent, KnowledgeBase, Handoff',ai_auto:'Vibe Coding入門'}),
fintech:_mp({name:'フィンテック',nameEn:'Fintech',icon:'💰',purpose:'決済・家計管理・請求書など金融系Webアプリ',purposeEn:'Financial web app for payments, budgeting & invoicing',target:['フリーランス','中小企業','一般消費者'],targetEn:['Freelancers','SMBs','Consumers'],backend:'Node.js + NestJS',features:['口座連携','収支ダッシュボード','請求書発行','自動カテゴリ分類','レポート出力'],featuresEn:['Account Linking','Income/Expense Dashboard','Invoice Generation','Auto-categorization','Report Export'],
entities:'User, Account, Transaction, Invoice, Category, Budget, Report',mobile:'Expo (React Native)',payment:'stripe'}),
devtool:_mp({name:'開発者ツール',nameEn:'Dev Tool',icon:'🛠️',purpose:'開発者の生産性を向上させるユーティリティ・API',purposeEn:'Developer utility & API to boost productivity',target:['エンジニア','スタートアップ'],targetEn:['Engineers','Startups'],backend:'Node.js + Express',features:['APIキー管理','ドキュメント','使用量モニタ','Webhook設定','Playground'],featuresEn:['API Key Management','Documentation','Usage Monitor','Webhook Config','Playground'],
entities:'User, ApiKey, Project, RequestLog, Webhook, Documentation',payment:'stripe',org_model:'マルチテナント(RLS)'}),
creator:_mp({name:'クリエイターエコノミー',nameEn:'Creator Economy',icon:'🎨',purpose:'コンテンツ販売・ファンコミュニティ・サブスク課金プラットフォーム',purposeEn:'Content sales, fan community & subscription platform',target:['クリエイター','インフルエンサー'],targetEn:['Creators','Influencers'],features:['プロフィール・ポートフォリオ','有料コンテンツ配信','サブスク課金','ファンコメント・投げ銭','アナリティクス'],featuresEn:['Profile & Portfolio','Paid Content Distribution','Subscription Billing','Fan Comments & Tips','Analytics'],
entities:'User, Content, Subscription, Payment, Comment, Tip, Tier',payment:'stripe'}),
newsletter:_mp({name:'ニュースレター/メディア',nameEn:'Newsletter/Media',icon:'📰',purpose:'ニュースレター配信・メディア運営プラットフォーム',purposeEn:'Newsletter distribution & media management platform',target:['ライター','メディア運営者','マーケター'],targetEn:['Writers','Media Operators','Marketers'],features:['記事エディタ','購読者管理','配信スケジュール','開封・クリック分析','有料プラン'],featuresEn:['Article Editor','Subscriber Management','Delivery Schedule','Open & Click Analytics','Paid Plans'],
entities:'User, Post, Subscriber, Campaign, Analytics, Plan',payment:'stripe'}),
pwa:_mp({name:'PWAアプリ',nameEn:'PWA App',icon:'📱',purpose:'ネイティブアプリ体験をWebで提供するモバイルファースト',purposeEn:'Mobile-first web app with native app experience',target:['一般消費者','スタートアップ'],targetEn:['Consumers','Startups'],frontend:'React (Vite SPA)',backend:'Firebase',features:['オフライン対応','プッシュ通知','ホーム画面追加','カメラ・位置情報','データ同期'],featuresEn:['Offline Support','Push Notifications','Add to Home Screen','Camera & Location','Data Sync'],
entities:'User, Content, Notification, SyncQueue, Setting',deploy:'Firebase Hosting',mobile:'Expo (React Native)'}),
booking:_mp({name:'予約システム',nameEn:'Booking System',icon:'📅',purpose:'サービスやリソースの予約・スケジュールを管理するシステム',purposeEn:'Booking & schedule management system for services',target:['店舗オーナー','フリーランス','一般消費者'],targetEn:['Shop Owners','Freelancers','Consumers'],features:['カレンダー表示','予約作成・変更','リマインダー通知','決済連携','スタッフ管理'],featuresEn:['Calendar View','Create & Modify Bookings','Reminder Notifications','Payment Integration','Staff Management'],
entities:'User, Service, Booking, TimeSlot, Staff, Payment, Reminder',payment:'stripe',screens:['カレンダー','予約作成','予約確認','管理画面','プロフィール'],screensEn:['Calendar','New Booking','Booking Confirm','Admin Panel','Profile']}),
event:_mp({name:'イベントプラットフォーム',nameEn:'Event Platform',icon:'🎪',purpose:'オンライン・オフラインイベントの開催・参加管理',purposeEn:'Online/offline event hosting & attendance management',target:['イベント主催者','コミュニティ','企業'],targetEn:['Event Organizers','Communities','Companies'],features:['イベント作成・公開','チケット販売','参加者管理','ライブ配信連携','アンケート'],featuresEn:['Event Creation & Publishing','Ticket Sales','Attendee Management','Live Streaming Integration','Surveys'],
entities:'User, Event, Ticket, Attendee, Venue, Session, Survey',payment:'stripe',screens:['イベント一覧','イベント詳細','チケット購入','マイチケット','管理画面'],screensEn:['Event List','Event Detail','Buy Tickets','My Tickets','Admin Panel']}),
health:_mp({name:'ヘルステック',nameEn:'Health Tech',icon:'🏥',purpose:'健康・フィットネス・ウェルネスの記録と改善を支援するアプリ',purposeEn:'Health, fitness & wellness tracking and improvement app',target:['一般消費者','トレーナー'],targetEn:['Consumers','Trainers'],frontend:'React (Vite SPA)',backend:'Firebase',features:['健康データ記録','トレーニング管理','食事ログ','目標・進捗グラフ','リマインダー'],featuresEn:['Health Data Logging','Training Management','Meal Logs','Goals & Progress Graphs','Reminders'],
entities:'User, HealthLog, Workout, Meal, Goal, Progress, Reminder',deploy:'Firebase Hosting',mobile:'Expo (React Native)',screens:['ダッシュボード','健康記録','トレーニング','食事ログ','目標'],screensEn:['Dashboard','Health Log','Workout','Meal Log','Goals']}),
hr:_mp({name:'HR/採用管理',nameEn:'HR/Recruiting',icon:'👥',purpose:'採用プロセスと人事管理を効率化するツール',purposeEn:'Tool to streamline recruiting and HR management',target:['人事担当者','採用担当者','経営者'],targetEn:['HR Staff','Recruiters','Executives'],features:['求人管理','応募者トラッキング','面接スケジュール','評価・スコアカード','オンボーディング'],featuresEn:['Job Management','Applicant Tracking','Interview Scheduling','Evaluation Scorecards','Onboarding'],
entities:'User, JobPosting, Applicant, Interview, Evaluation, Department, Onboarding'}),
linkbio:_mp({name:'Link in Bio',nameEn:'Link in Bio',icon:'🔗',purpose:'SNSプロフィール用のマイクロサイト・リンク集約ツール',purposeEn:'Micro-site & link aggregation tool for social profiles',target:['インフルエンサー','クリエイター','フリーランス'],targetEn:['Influencers','Creators','Freelancers'],features:['カスタムリンクページ','テーマ・デザイン編集','アクセス解析','SNS連携','収益化リンク'],featuresEn:['Custom Link Page','Theme & Design Editor','Access Analytics','Social Integration','Monetization Links'],
entities:'User, Page, Link, Theme, ClickLog, Integration'}),
gamify:_mp({name:'ゲーミフィケーション',nameEn:'Gamification',icon:'🎮',purpose:'ゲーム要素でユーザーエンゲージメントを向上',purposeEn:'Boost user engagement with game elements',target:['教育者','マーケター','コミュニティ管理者'],targetEn:['Educators','Marketers','Community Managers'],frontend:'React (Vite SPA)',backend:'Firebase',features:['ポイント・バッジシステム','リーダーボード','チャレンジ・ミッション','報酬・交換','進捗ダッシュボード'],featuresEn:['Points & Badge System','Leaderboard','Challenges & Missions','Rewards & Redemption','Progress Dashboard'],
entities:'User, Badge, Challenge, Reward, Leaderboard, PointLog, Achievement',deploy:'Firebase Hosting'}),
collab:_mp({name:'リアルタイムコラボ',nameEn:'Realtime Collab',icon:'🤝',purpose:'チームが同時編集・共同作業できるリアルタイムツール',purposeEn:'Real-time tool for team collaborative editing',target:['リモートチーム','スタートアップ','教育者'],targetEn:['Remote Teams','Startups','Educators'],features:['リアルタイム同時編集','カーソル共有','コメント・メンション','バージョン履歴','権限管理'],featuresEn:['Real-time Co-editing','Cursor Sharing','Comments & Mentions','Version History','Permission Management'],
entities:'User, Document, Workspace, Comment, Version, Permission, Activity',payment:'stripe',org_model:'ワークスペース型'}),
iot:_mp({name:'IoTダッシュボード',nameEn:'IoT Dashboard',icon:'📡',purpose:'IoTデバイスのデータ監視・制御・可視化ツール',purposeEn:'IoT device data monitoring, control & visualization',target:['エンジニア','製造業'],targetEn:['Engineers','Manufacturing'],frontend:'React (Vite SPA)',backend:'Node.js + Express',features:['デバイス登録・管理','リアルタイムデータ表示','アラート設定','遠隔制御','履歴データ分析'],featuresEn:['Device Registration & Management','Real-time Data Display','Alert Settings','Remote Control','Historical Data Analysis'],
entities:'User, Device, SensorData, Alert, Command, DeviceGroup, Log'}),
portfolio:_mp({name:'ポートフォリオ',nameEn:'Portfolio',icon:'🖼️',purpose:'スキル・実績を魅力的に紹介するサイト',purposeEn:'Showcase skills and achievements attractively',target:['学生','フリーランス'],targetEn:['Students','Freelancers'],frontend:'Astro',features:['自己紹介','プロジェクト一覧','スキル表示','お問い合わせ'],featuresEn:['About Me','Project Gallery','Skills Display','Contact Form'],entities:'Project, Skill, ContactMessage',screens:['ホーム','プロジェクト一覧','スキル','お問い合わせ'],screensEn:['Home','Project Gallery','Skills','Contact']}),
cms:_mp({name:'CMS/ブログ',nameEn:'CMS/Blog',icon:'📝',purpose:'コンテンツを投稿・管理・公開できるシステム',purposeEn:'System to create, manage and publish content',target:['ブロガー','編集者'],targetEn:['Bloggers','Editors'],features:['記事作成・編集','カテゴリ管理','画像アップロード','SEO設定','下書き保存'],featuresEn:['Article Editor','Category Management','Image Upload','SEO Settings','Draft Saving'],entities:'User, Post, Category, Tag, Media',screens:['記事一覧','記事詳細','カテゴリ','エディタ','設定'],screensEn:['Article List','Article Detail','Category','Editor','Settings']}),
lms:_mp({name:'学習プラットフォーム',nameEn:'Learning Platform',icon:'📚',purpose:'体系的に知識を習得できる教育システム',purposeEn:'Structured education system for knowledge acquisition',target:['学生','社会人学習者','教育者'],targetEn:['Students','Working Professionals','Educators'],frontend:'React (Vite SPA)',backend:'Firebase',features:['コース一覧','レッスン視聴','進捗管理','クイズ機能','修了証発行'],featuresEn:['Course Catalog','Lesson Viewing','Progress Tracking','Quiz System','Certificate Issuance'],
entities:'User, Course, Lesson, Progress, Quiz, Certificate',deploy:'Firebase Hosting',mobile:'Expo (React Native)',payment:'stripe',screens:['コース一覧','レッスン画面','進捗管理','クイズ','修了証'],screensEn:['Course List','Lesson View','Progress','Quiz','Certificate']}),
community:_mp({name:'コミュニティ',nameEn:'Community',icon:'🌐',purpose:'共通の関心を持つ人々が交流できるプラットフォーム',purposeEn:'Platform for people with common interests to interact',target:['コミュニティメンバー','管理者'],targetEn:['Community Members','Admins'],features:['プロフィール','投稿・コメント','グループ','イベント管理','通知'],featuresEn:['Profiles','Posts & Comments','Groups','Event Management','Notifications'],entities:'User, Post, Comment, Group, Event',screens:['フィード','グループ','イベント','プロフィール','通知'],screensEn:['Feed','Groups','Events','Profile','Notifications']}),
property_mgmt:_mp({name:'不動産管理',nameEn:'Property Management',icon:'🏢',purpose:'賃貸・売買物件の管理、入居者対応、家賃回収を一元管理',purposeEn:'Centralized rental/sales property management, tenant communication & rent collection',target:['不動産オーナー','管理会社','仲介業者'],targetEn:['Property Owners','Management Companies','Real Estate Agents'],features:['物件登録・管理','入居者情報管理','契約・更新管理','家賃請求・督促','修繕依頼トラッキング','収支レポート'],featuresEn:['Property Registration & Management','Tenant Info Management','Contract & Renewal Management','Rent Billing & Reminders','Repair Request Tracking','Financial Reports'],entities:'Property, Unit, Tenant, Lease, Payment, MaintenanceRequest, Owner, Invoice',payment:'stripe'}),
contract_mgmt:_mp({name:'契約管理',nameEn:'Contract Management',icon:'📜',purpose:'契約書の作成・承認フロー・期限管理・電子署名を統合管理',purposeEn:'Integrated contract creation, approval workflow, deadline tracking & e-signature',target:['法務部','営業部','中小企業','フリーランス'],targetEn:['Legal Dept','Sales Dept','SMBs','Freelancers'],features:['契約書テンプレート','承認ワークフロー','電子署名連携','期限・更新アラート','バージョン管理','検索・タグ付け'],featuresEn:['Contract Templates','Approval Workflow','E-signature Integration','Deadline & Renewal Alerts','Version Control','Search & Tagging'],entities:'Contract, Template, Party, Approval, Signature, Milestone, Alert, Clause',payment:'stripe'}),
helpdesk:_mp({name:'ヘルプデスク',nameEn:'Help Desk',icon:'🎧',purpose:'カスタマーサポートのチケット管理とナレッジベース統合',purposeEn:'Customer support ticket management with integrated knowledge base',target:['サポートチーム','IT部門','SaaS企業'],targetEn:['Support Teams','IT Departments','SaaS Companies'],features:['チケット起票・管理','優先度・ステータス設定','担当者アサイン','ナレッジベース連携','SLA追跡','顧客満足度評価'],featuresEn:['Ticket Creation & Management','Priority & Status Settings','Agent Assignment','Knowledge Base Integration','SLA Tracking','Customer Satisfaction Rating'],entities:'SupportTicket, User, SupportAgent, Category, Priority, KnowledgeArticle, Response, SLA',ai_auto:'Vibe Coding入門',payment:'stripe',org_model:'シングルテナント',screens:['チケット一覧','チケット詳細','ナレッジベース','レポート','設定'],screensEn:['Ticket List','Ticket Detail','Knowledge Base','Reports','Settings']}),
tutoring:_mp({name:'家庭教師マッチング',nameEn:'Tutoring Marketplace',icon:'👨‍🏫',purpose:'講師と生徒をマッチングし、オンライン・対面授業を予約管理',purposeEn:'Match tutors with students, manage online/in-person lesson bookings',target:['学生','保護者','講師','教育事業者'],targetEn:['Students','Parents','Tutors','Education Businesses'],features:['講師プロフィール・検索','科目・スキルフィルタ','レッスン予約','オンライン授業連携','レビュー・評価','決済・手数料管理'],featuresEn:['Tutor Profiles & Search','Subject & Skill Filters','Lesson Booking','Online Class Integration','Reviews & Ratings','Payment & Fee Management'],entities:'Tutor, Student, Subject, Lesson, Booking, Review, Payment, Availability',payment:'stripe'}),
veterinary:_mp({name:'動物病院',nameEn:'Veterinary Clinic',icon:'🐾',purpose:'動物病院のカルテ管理・予約・ワクチン接種記録システム',purposeEn:'Vet clinic medical records, appointments & vaccination tracking',target:['獣医師','動物病院スタッフ','ペットオーナー'],targetEn:['Veterinarians','Clinic Staff','Pet Owners'],features:['ペット情報・カルテ管理','診察予約','ワクチン接種履歴','処方箋管理','会計・請求','リマインダー通知'],featuresEn:['Pet Info & Medical Records','Appointment Scheduling','Vaccination History','Prescription Management','Billing & Invoicing','Reminder Notifications'],entities:'Pet, Owner, Appointment, MedicalRecord, Vaccination, Prescription, Invoice, Veterinarian',payment:'stripe'}),
restaurant:_mp({name:'飲食店管理',nameEn:'Restaurant Management',icon:'🍽️',purpose:'飲食店のPOS・予約・在庫・スタッフ管理を統合',purposeEn:'Integrated POS, reservations, inventory & staff management for restaurants',target:['飲食店オーナー','店長','スタッフ'],targetEn:['Restaurant Owners','Managers','Staff'],frontend:'React (Vite SPA)',features:['テーブル予約管理','POS・注文管理','在庫・発注管理','メニュー編集','売上レポート','スタッフシフト'],featuresEn:['Table Reservation Management','POS & Order Management','Inventory & Ordering','Menu Editor','Sales Reports','Staff Scheduling'],entities:'Table, Reservation, Order, MenuItem, Inventory, Staff, Shift, Payment',payment:'stripe',screens:['テーブル管理','注文管理','メニュー','売上レポート','スタッフ'],screensEn:['Table Mgmt','Order Mgmt','Menu','Sales Reports','Staff']}),
construction_pay:_mp({name:'建設業決済',nameEn:'Construction Payment',icon:'🏗️',purpose:'建設プロジェクトの支払管理・請求書発行・進捗連動決済',purposeEn:'Construction project payment management, invoicing & milestone-based payments',target:['建設会社','下請け業者','元請け'],targetEn:['Construction Companies','Subcontractors','General Contractors'],features:['プロジェクト管理','マイルストーン設定','進捗報告','請求書発行','支払スケジュール','承認ワークフロー'],featuresEn:['Project Management','Milestone Setup','Progress Reporting','Invoice Generation','Payment Schedule','Approval Workflow'],entities:'Project, Contractor, Milestone, Invoice, Payment, ProgressReport, Approval, Estimate',payment:'stripe'}),
clinic:_mp({name:'クリニック・医院',nameEn:'Medical Clinic',icon:'🏥',purpose:'診療所の電子カルテ・予約・処方箋・会計を統合管理',purposeEn:'Integrated EMR, appointments, prescriptions & billing for clinics',target:['医師','看護師','医療事務','患者'],targetEn:['Doctors','Nurses','Medical Admin','Patients'],features:['電子カルテ','診察予約','処方箋管理','検査結果記録','会計・レセプト','待合状況表示'],featuresEn:['Electronic Medical Records','Appointment Scheduling','Prescription Management','Test Result Logging','Billing & Claims','Waiting Room Status'],entities:'Patient, Appointment, MedicalRecord, Prescription, Examination, Invoice, Doctor, Claim',payment:'stripe'}),
knowledge_base:_mp({name:'ナレッジベース',nameEn:'Knowledge Base',icon:'📖',purpose:'組織の知識・ノウハウを体系化し検索可能にするドキュメントDB',purposeEn:'Systematize and search organizational knowledge & know-how documentation',target:['全社員','カスタマーサポート','教育担当'],targetEn:['All Employees','Customer Support','Training Staff'],features:['記事作成・編集','カテゴリ・タグ管理','全文検索','バージョン履歴','アクセス権限','AI検索提案'],featuresEn:['Article Creation & Editing','Category & Tag Management','Full-text Search','Version History','Access Control','AI Search Suggestions'],entities:'Article, Category, Tag, Version, User, AccessControl, SearchLog, Feedback',ai_auto:'Vibe Coding入門'}),
field_service:_mp({name:'現場サービス',nameEn:'Field Service',icon:'🚚',purpose:'現場作業員の派遣・スケジュール・作業報告を一元管理',purposeEn:'Centralized dispatch, scheduling & work reporting for field workers',target:['サービス企業','技術者','ディスパッチャー'],targetEn:['Service Companies','Technicians','Dispatchers'],features:['作業オーダー管理','スケジューリング','リアルタイム位置追跡','作業報告・写真','在庫管理','請求書発行'],featuresEn:['Work Order Management','Scheduling','Real-time Location Tracking','Work Reports & Photos','Inventory Management','Invoice Generation'],entities:'WorkOrder, Technician, Schedule, Location, Report, Inventory, Customer, Invoice',mobile:'Expo (React Native)',payment:'stripe'}),
crm:_mp({name:'CRM',nameEn:'CRM',icon:'📇',purpose:'顧客管理・案件管理・営業パイプライン最適化',purposeEn:'Customer management, deal tracking & sales pipeline optimization',target:['営業チーム','マーケター','経営者'],targetEn:['Sales Teams','Marketers','Executives'],features:['連絡先・企業管理','案件パイプライン','商談フォローアップ','売上予測','メール連携','活動ログ'],featuresEn:['Contact & Company Management','Deal Pipeline','Follow-up Tracking','Revenue Forecasting','Email Integration','Activity Log'],entities:'User, Contact, Company, Deal, Pipeline, Activity, Task',payment:'stripe',org_model:'シングルテナント',screens:['パイプライン','連絡先','企業','商談詳細','レポート'],screensEn:['Pipeline','Contacts','Companies','Deal Detail','Reports']}),
social:_mp({name:'SNS',nameEn:'Social Network',icon:'📱',purpose:'ソーシャルネットワーク・フィード・フォロー・DM',purposeEn:'Social network with feed, follow, DM features',target:['一般ユーザー','クリエイター','コミュニティ'],targetEn:['General Users','Creators','Communities'],frontend:'React (Vite SPA)',backend:'Firebase',features:['プロフィール','投稿・フィード','フォロー/フォロワー','いいね・コメント','DM','通知'],featuresEn:['Profiles','Posts & Feed','Follow/Followers','Likes & Comments','Direct Messages','Notifications'],entities:'User, Post, Comment, Like, Follow, Message, Notification',deploy:'Firebase Hosting',mobile:'Expo (React Native)',screens:['フィード','プロフィール','DM','通知','検索'],screensEn:['Feed','Profile','Direct Messages','Notifications','Search']}),
logistics:_mp({name:'物流管理',nameEn:'Logistics',icon:'🚛',purpose:'配送追跡・ルート最適化・倉庫管理・ドライバー管理',purposeEn:'Shipment tracking, route optimization, warehouse & driver management',target:['物流企業','運送業者','倉庫管理者'],targetEn:['Logistics Companies','Carriers','Warehouse Managers'],features:['配送追跡','ルート最適化','倉庫在庫管理','ドライバー管理','リアルタイム位置情報','配達証明'],featuresEn:['Shipment Tracking','Route Optimization','Warehouse Inventory','Driver Management','Real-time Location','Proof of Delivery'],entities:'Shipment, Route, Warehouse, Driver, Inventory, User',mobile:'Expo (React Native)',payment:'stripe'}),
survey:_mp({name:'アンケート',nameEn:'Survey',icon:'📋',purpose:'アンケート作成・回答収集・分析・レポート出力',purposeEn:'Survey creation, response collection, analysis & reporting',target:['マーケター','研究者','人事担当'],targetEn:['Marketers','Researchers','HR Staff'],features:['フォームビルダー','質問タイプ選択','条件分岐','回答収集','集計・分析','CSVエクスポート'],featuresEn:['Form Builder','Question Types','Conditional Logic','Response Collection','Analytics','CSV Export'],entities:'User, Form, Question, Answer, Analytics'}),
job_board:_mp({name:'求人サイト',nameEn:'Job Board',icon:'💼',purpose:'求人掲載・応募管理・マッチング・スカウト',purposeEn:'Job posting, application management, matching & scouting',target:['求職者','企業人事','転職エージェント'],targetEn:['Job Seekers','HR Teams','Recruiters'],features:['求人検索・フィルタ','応募・保存','企業プロフィール','マッチング通知','スカウト機能','応募管理'],featuresEn:['Job Search & Filter','Apply & Save','Company Profiles','Matching Notifications','Scouting','Application Management'],entities:'User, Job, SavedJob, Company, Applicant',payment:'stripe'}),
factory:_mp({name:'製造管理',nameEn:'Factory Mgmt',icon:'🏭',purpose:'生産ラインの製造オーダー・設備・品質管理システム',purposeEn:'Production line management with work orders, machinery & quality control',target:['製造業','工場管理者','品質担当'],targetEn:['Manufacturing','Factory Managers','Quality Engineers'],backend:'Node.js + Express',features:['製造オーダー管理','設備稼働監視','品質検査記録','工程管理','在庫・資材管理','生産レポート'],featuresEn:['Production Order Management','Machine Operation Monitoring','Quality Inspection Records','Process Management','Inventory & Materials','Production Reports'],entities:'User, ProductionOrder, Machine, QualityCheck, Inventory, Staff',mobile:'none'}),
agri:_mp({name:'スマート農業',nameEn:'Smart Agriculture',icon:'🌾',purpose:'農場の作物・圃場・収穫量をデジタル管理するスマートアグリシステム',purposeEn:'Smart agriculture system for managing farms, crops, fields & harvests digitally',target:['農家','農業法人','JAスタッフ'],targetEn:['Farmers','Agri Corporations','Agricultural Cooperatives'],frontend:'React (Vite SPA)',backend:'Node.js + Express',features:['農場・圃場登録','作物管理','作業記録','気象データ連携','収穫量記録','収益分析'],featuresEn:['Farm & Field Registration','Crop Management','Work Logs','Weather Data Integration','Harvest Records','Revenue Analysis'],entities:'User, Farm, Crop, Field, Harvest',mobile:'Expo (React Native)'}),
energy:_mp({name:'エネルギー管理',nameEn:'Energy Mgmt',icon:'⚡',purpose:'電力・ガス・再生可能エネルギーの使用量監視と最適化',purposeEn:'Monitor and optimize electricity, gas & renewable energy consumption',target:['エネルギー企業','施設管理者','環境担当'],targetEn:['Energy Companies','Facility Managers','Sustainability Teams'],frontend:'React (Vite SPA)',backend:'Node.js + Express',features:['メーター登録・管理','使用量記録・グラフ','料金プラン管理','アラート・異常検知','省エネレポート','CO2排出量計算'],featuresEn:['Meter Registration & Management','Usage Recording & Charts','Tariff Plan Management','Alerts & Anomaly Detection','Energy Saving Reports','CO2 Emission Calculation'],entities:'User, Meter, Reading, Tariff, Alert, Report'}),
media_platform:_mp({name:'メディアプラットフォーム',nameEn:'Media Platform',icon:'📺',purpose:'番組・記事・エピソードを配信するメディアプラットフォーム',purposeEn:'Media platform for distributing programs, articles & episodes',target:['メディア企業','コンテンツクリエイター','視聴者'],targetEn:['Media Companies','Content Creators','Viewers'],frontend:'React + Next.js',backend:'Supabase',features:['コンテンツ管理','番組・記事配信','視聴者管理','広告・スポンサー管理','コメント・評価','アナリティクス'],featuresEn:['Content Management','Program & Article Distribution','Viewer Management','Ad & Sponsor Management','Comments & Ratings','Analytics'],entities:'User, Program, Episode, Article, Comment, Subscriber',payment:'stripe'}),
gov_portal:_mp({name:'行政ポータル',nameEn:'Gov Portal',icon:'🏛️',purpose:'市民向け行政サービスの申請・手続きオンライン窓口',purposeEn:'Online portal for citizens to access and apply for government services',target:['市民','行政職員','自治体'],targetEn:['Citizens','Government Staff','Local Authorities'],frontend:'React + Next.js',backend:'Node.js + NestJS',features:['申請フォーム','手続き状況追跡','書類アップロード','通知・お知らせ','Q&A・FAQ','職員管理画面'],featuresEn:['Application Forms','Procedure Status Tracking','Document Upload','Notifications & Announcements','Q&A & FAQ','Staff Admin Panel'],entities:'User, Application, Citizen, Service, Document, Notification, Department'}),
travel_booking:_mp({name:'旅行予約',nameEn:'Travel Booking',icon:'✈️',purpose:'旅程・ホテル・フライトを一括管理する旅行予約プラットフォーム',purposeEn:'Travel booking platform for itinerary, hotel & flight management',target:['旅行者','旅行会社','ホテル・航空会社'],targetEn:['Travelers','Travel Agencies','Hotels & Airlines'],features:['旅程作成・管理','ホテル検索・予約','フライト検索','旅行保険連携','支払い管理','旅行レビュー'],featuresEn:['Itinerary Creation & Management','Hotel Search & Booking','Flight Search','Travel Insurance Integration','Payment Management','Travel Reviews'],entities:'User, Itinerary, Hotel, Flight, Booking, Payment, Review',payment:'stripe',mobile:'Expo (React Native)',screens:['検索','旅程詳細','予約確認','マイ旅程','設定'],screensEn:['Search','Itinerary Detail','Booking Confirm','My Trips','Settings']}),
insurance_mgmt:_mp({name:'保険管理',nameEn:'Insurance Mgmt',icon:'🛡️',purpose:'保険契約・請求・見積もりを管理する保険業務プラットフォーム',purposeEn:'Insurance business platform for policy management, claims & quotes',target:['保険会社','代理店','契約者'],targetEn:['Insurance Companies','Agents','Policyholders'],backend:'Node.js + NestJS',features:['契約管理','保険料見積もり','請求申請','審査ワークフロー','証券発行','レポート・統計'],featuresEn:['Policy Management','Premium Quotes','Claim Filing','Review Workflow','Certificate Issuance','Reports & Statistics'],entities:'User, Policy, Claim, Quote, Customer, Agent, Document',payment:'stripe'}),
custom:{name:'',icon:'⚡'},
};
var _SCALE_DEFAULTS={
solo:{frontend:'React (Vite SPA)',backend:'Python (FastAPI)',deploy:'Vercel',ai_auto:'Vibe Coding入門',database:'PostgreSQL',auth:'メール/パスワード',css_fw:'Tailwind CSS',dev_methods:'TDD（テスト駆動）, SDD（仕様駆動）',dev_methodsEn:'TDD (Test-Driven), SDD (Spec-Driven)'},
small:{frontend:'React + Next.js',backend:'Supabase',deploy:'Vercel',ai_auto:'Vibe Coding入門',database:'Supabase (PostgreSQL)',auth:'Supabase Auth',css_fw:'Tailwind CSS',dev_methods:'TDD（テスト駆動）, SDD（仕様駆動）',dev_methodsEn:'TDD (Test-Driven), SDD (Spec-Driven)'},
medium:{frontend:'React + Next.js',backend:'Node.js + Express',deploy:'AWS',ai_auto:'マルチAgent協調',database:'PostgreSQL',auth:'メール/パスワード',css_fw:'Tailwind CSS',dev_methods:'TDD（テスト駆動）, SDD（仕様駆動）, DDD（ドメイン駆動）',dev_methodsEn:'TDD (Test-Driven), SDD (Spec-Driven), DDD (Domain-Driven)'},
large:{frontend:'React + Next.js',backend:'Node.js + NestJS',deploy:'AWS',ai_auto:'マルチAgent協調',database:'PostgreSQL',auth:'メール/パスワード',css_fw:'Tailwind CSS',dev_methods:'TDD（テスト駆動）, SDD（仕様駆動）, DDD（ドメイン駆動）',dev_methodsEn:'TDD (Test-Driven), SDD (Spec-Driven), DDD (Domain-Driven)'}
};
function _fpd(p){
return Object.assign({
features:[],featuresEn:[],
scaleHint:{solo:{ja:'',en:''},small:{ja:'',en:''},medium:{ja:'',en:''},large:{ja:'',en:''}},
meta:{revenue:'subscription',regulation:'low',apiDep:'hybrid',agentLv:'L1',multimodal:'text',onDevice:'cloud'}
},p);
}
var FIELD_CAT_DEFAULTS={
engineering:{
target:['エンジニア','品質管理者','製造現場'],targetEn:['Engineers','Quality Managers','Manufacturing Staff'],
screens:['ダッシュボード','データ一覧','詳細ページ','設定','レポート'],screensEn:['Dashboard','Data List','Detail Page','Settings','Reports'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
science:{
target:['研究者','大学院生','研究機関'],targetEn:['Researchers','Grad Students','Research Institutes'],
screens:['ダッシュボード','データアップロード','分析結果','レポート','設定'],screensEn:['Dashboard','Data Upload','Analysis Results','Reports','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
agriculture:{
target:['農家','農業法人','JA職員'],targetEn:['Farmers','Agricultural Corps','Cooperative Staff'],
screens:['ダッシュボード','農場管理','データ一覧','アラート','設定'],screensEn:['Dashboard','Farm Mgmt','Data List','Alerts','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
medical:{
target:['医師','看護師','医療事務','患者'],targetEn:['Doctors','Nurses','Medical Admin','Patients'],
screens:['ダッシュボード','患者一覧','カルテ詳細','入力フォーム','設定'],screensEn:['Dashboard','Patient List','Record Detail','Input Form','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
social:{
target:['ビジネスパーソン','マーケター','経営者'],targetEn:['Business Professionals','Marketers','Executives'],
screens:['ダッシュボード','分析画面','レポート','検索','設定'],screensEn:['Dashboard','Analytics','Reports','Search','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
humanities:{
target:['研究者','ライター','教育者'],targetEn:['Researchers','Writers','Educators'],
screens:['ダッシュボード','エディタ','検索','ライブラリ','設定'],screensEn:['Dashboard','Editor','Search','Library','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
education_field:{
target:['学生','教師','教育機関'],targetEn:['Students','Teachers','Educational Institutions'],
screens:['ダッシュボード','コース一覧','学習画面','進捗','設定'],screensEn:['Dashboard','Course List','Learning View','Progress','Settings'],
payment:'stripe',mobile:'none',org_model:'シングルテナント'},
art:{
target:['クリエイター','デザイナー','アーティスト'],targetEn:['Creators','Designers','Artists'],
screens:['ダッシュボード','ギャラリー','エディタ','プロフィール','設定'],screensEn:['Dashboard','Gallery','Editor','Profile','Settings'],
payment:'stripe',mobile:'none',org_model:'シングルテナント'},
interdisciplinary:{
target:['PM','チームメンバー','研究者'],targetEn:['PMs','Team Members','Researchers'],
screens:['ダッシュボード','プロジェクト一覧','タスク管理','レポート','設定'],screensEn:['Dashboard','Project List','Task Mgmt','Reports','Settings'],
payment:'stripe',mobile:'none',org_model:'シングルテナント'},
environment:{
target:['環境担当者','ESG推進チーム','施設管理者'],targetEn:['Environmental Officers','ESG Teams','Facility Managers'],
screens:['ダッシュボード','データ入力','レポート','アラート','設定'],screensEn:['Dashboard','Data Input','Reports','Alerts','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
architecture:{
target:['建築士','設計事務所','デベロッパー'],targetEn:['Architects','Design Firms','Developers'],
screens:['ダッシュボード','プロジェクト一覧','ビューア','レポート','設定'],screensEn:['Dashboard','Project List','Viewer','Reports','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
sports:{
target:['コーチ','アスリート','スポーツ団体'],targetEn:['Coaches','Athletes','Sports Orgs'],
screens:['ダッシュボード','選手一覧','パフォーマンス分析','トレーニング計画','設定'],screensEn:['Dashboard','Athlete List','Performance Analytics','Training Plans','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
welfare:{
target:['介護士','ケアマネ','福祉施設'],targetEn:['Caregivers','Care Managers','Welfare Facilities'],
screens:['ダッシュボード','利用者一覧','記録入力','レポート','設定'],screensEn:['Dashboard','Client List','Record Input','Reports','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
tourism:{
target:['旅行者','観光事業者','ホテル管理者'],targetEn:['Travelers','Tourism Operators','Hotel Managers'],
screens:['ダッシュボード','検索','予約管理','詳細ページ','設定'],screensEn:['Dashboard','Search','Booking Mgmt','Detail Page','Settings'],
payment:'stripe',mobile:'none',org_model:'シングルテナント'},
biotech:{
target:['研究者','製薬会社','臨床担当者'],targetEn:['Researchers','Pharma Companies','Clinical Staff'],
screens:['ダッシュボード','データ管理','分析結果','レポート','設定'],screensEn:['Dashboard','Data Mgmt','Analysis Results','Reports','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
mobility:{
target:['交通事業者','エンジニア','都市計画担当'],targetEn:['Transit Operators','Engineers','Urban Planners'],
screens:['ダッシュボード','地図','データ一覧','アラート','設定'],screensEn:['Dashboard','Map','Data List','Alerts','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
cybersecurity:{
target:['セキュリティエンジニア','CISO','IT管理者'],targetEn:['Security Engineers','CISOs','IT Admins'],
screens:['ダッシュボード','アラート一覧','インシデント詳細','レポート','設定'],screensEn:['Dashboard','Alert List','Incident Detail','Reports','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
fintech_field:{
target:['金融担当者','投資家','コンプライアンス'],targetEn:['Financial Officers','Investors','Compliance Staff'],
screens:['ダッシュボード','取引一覧','分析画面','レポート','設定'],screensEn:['Dashboard','Transactions','Analytics','Reports','Settings'],
payment:'stripe',mobile:'none',org_model:'シングルテナント'},
smart_factory:{
target:['工場管理者','品質エンジニア','製造業'],targetEn:['Factory Managers','Quality Engineers','Manufacturing'],
screens:['ダッシュボード','ライン監視','データ一覧','アラート','設定'],screensEn:['Dashboard','Line Monitor','Data List','Alerts','Settings'],
payment:'none',mobile:'none',org_model:'シングルテナント'},
cross_theme:{
target:['開発者','PM','エンジニア'],targetEn:['Developers','PMs','Engineers'],
screens:['ダッシュボード','設定','管理画面','レポート','一覧ページ'],screensEn:['Dashboard','Settings','Admin Panel','Reports','List Page'],
payment:'none',mobile:'none',org_model:'シングルテナント'}
};
var PR_FIELD={
// ── 🔧 工学系 (engineering) ──
eng_inspection:_fpd({name:'設備点検・異常検知',nameEn:'Equipment Inspection & Anomaly Detection',icon:'🔍',field:'engineering',purpose:'センサーデータと画像AIで設備の異常を早期検知し、保全コストを削減',purposeEn:'Early anomaly detection via sensor data & image AI to reduce maintenance costs',entities:'User, InspectionRecord, InspectionSchedule, AnomalyEvent, Equipment, Alert',features:['センサーデータ収集・可視化','AIによる異常検知アラート','点検スケジュール管理','不具合レポート自動生成','予知保全ダッシュボード'],featuresEn:['Sensor data collection & visualization','AI anomaly detection alerts','Inspection scheduling','Auto defect report generation','Predictive maintenance dashboard'],scaleHint:{solo:{ja:'個人研究・小規模工場向け。FastAPI+SQLiteで軽量構成',en:'Solo/small factory. FastAPI+SQLite lightweight setup'},small:{ja:'中小製造業向け。Supabaseでリアルタイム監視を実現',en:'SMB manufacturing. Supabase for real-time monitoring'},medium:{ja:'複数拠点対応。Express+PostgreSQL+Redis+Kafka',en:'Multi-site. Express+PostgreSQL+Redis+Kafka'},large:{ja:'大規模工場。NestJS+Kafka+ML推論パイプライン+SCADA連携',en:'Large factory. NestJS+Kafka+ML inference+SCADA integration'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
eng_simulation:_fpd({name:'構造計算・シミュレーター',nameEn:'Structural Calculation Simulator',icon:'🧮',field:'engineering',purpose:'FEM・CFDシミュレーションでインフラ・製品の構造安全性を解析',purposeEn:'FEM/CFD simulation to analyze structural safety of infrastructure & products',entities:'User, SimulationModel, SimInput, SimResult, Report',features:['パラメータ入力フォーム','シミュレーション実行管理','結果可視化(メッシュ/応力分布)','レポート出力','バージョン管理'],featuresEn:['Parameter input form','Simulation run management','Result visualization (mesh/stress)','Report export','Version control'],scaleHint:{solo:{ja:'個人研究者。FastAPI+NumPy/SciPyで軽量計算',en:'Solo researcher. FastAPI+NumPy/SciPy for lightweight computation'},small:{ja:'設計事務所向け。Supabase+Python計算サーバー',en:'Design office. Supabase+Python compute server'},medium:{ja:'エンジニアリング会社。Express+並列計算クラスター',en:'Engineering firm. Express+parallel compute cluster'},large:{ja:'大規模インフラ。NestJS+HPC+GPU計算+デジタルツイン連携',en:'Large infrastructure. NestJS+HPC+GPU compute+digital twin'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
eng_cad_review:_fpd({name:'CAD補助・設計レビュー',nameEn:'CAD Assist & Design Review',icon:'📐',field:'engineering',purpose:'CADファイル共有・AIレビュー・承認ワークフローで設計品質を向上',purposeEn:'CAD file sharing, AI review & approval workflow to improve design quality',entities:'User, CADFile, DesignReview, Project, Comment',features:['CADファイルアップロード・バージョン管理','AI設計チェック','レビュー・承認ワークフロー','コメント・注釈機能','差分比較'],featuresEn:['CAD file upload & versioning','AI design check','Review & approval workflow','Comments & annotations','Diff comparison'],scaleHint:{solo:{ja:'個人設計者。FastAPI+ファイルストレージで基本共有',en:'Solo designer. FastAPI+file storage for basic sharing'},small:{ja:'小規模設計事務所。Supabase+Storageで手軽に導入',en:'Small design firm. Supabase+Storage easy setup'},medium:{ja:'中規模メーカー。Express+承認ワークフロー+PDM連携',en:'Mid-size manufacturer. Express+approval workflow+PDM'},large:{ja:'大企業。NestJS+PLM連携+マルチサイトコラボ',en:'Enterprise. NestJS+PLM integration+multi-site collab'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
eng_quality:_fpd({name:'工程管理・品質管理',nameEn:'Process & Quality Dashboard',icon:'✅',field:'engineering',purpose:'製造工程のKPI・品質データをリアルタイム可視化し改善を支援',purposeEn:'Real-time KPI & quality data visualization for manufacturing process improvement',entities:'User, QualityProcess, ProcessStep, QualityCheck, Defect, Machine',features:['工程KPIダッシュボード','品質検査記録','不良品分析・傾向グラフ','4M変更管理','QC報告書生成'],featuresEn:['Process KPI dashboard','Quality inspection records','Defect analysis & trend charts','4M change management','QC report generation'],scaleHint:{solo:{ja:'小工場・個人事業。FastAPI+SQLiteで基本記録',en:'Small factory/solo. FastAPI+SQLite basic records'},small:{ja:'中小製造業。Supabase+リアルタイムグラフ',en:'SMB manufacturing. Supabase+real-time charts'},medium:{ja:'複数ライン管理。Express+PostgreSQL+BI連携',en:'Multi-line management. Express+PostgreSQL+BI'},large:{ja:'全社品質管理。NestJS+MES連携+AIによる不良予測',en:'Company-wide quality. NestJS+MES+AI defect prediction'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
// ── 🔬 理学系 (science) ──
sci_data_analysis:_fpd({name:'実験データ解析',nameEn:'Experiment Data Analyzer',icon:'🔬',field:'science',purpose:'実験・観測データをAIで統計解析・パターン発見・可視化',purposeEn:'AI-powered statistical analysis, pattern discovery & visualization for experiment data',entities:'User, ExperimentRun, ExperimentData, DataPoint, Report',features:['データアップロード(CSV/JSON)','統計解析・可視化','AIパターン発見','外れ値検出','レポート出力'],featuresEn:['Data upload (CSV/JSON)','Statistical analysis & visualization','AI pattern discovery','Outlier detection','Report export'],scaleHint:{solo:{ja:'個人研究者。FastAPI+Pandas/Seabornで即時解析',en:'Solo researcher. FastAPI+Pandas/Seaborn for quick analysis'},small:{ja:'研究室向け。Supabase+JupyterHub連携',en:'Lab use. Supabase+JupyterHub integration'},medium:{ja:'研究機関。Express+分散計算+MLflow',en:'Research institute. Express+distributed compute+MLflow'},large:{ja:'国立研究所。NestJS+HPC+データレイク+協調解析',en:'National lab. NestJS+HPC+data lake+collaborative analysis'}},meta:{revenue:'subsidy',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
sci_paper_summary:_fpd({name:'論文サマライザー',nameEn:'Paper Summarizer & Research Assistant',icon:'📄',field:'science',purpose:'論文PDFをAIが要約・関連研究抽出・引用管理を自動化',purposeEn:'AI paper summarization, related research extraction & automated citation management',entities:'User, ResearchPaper, PaperSummary, KnowledgeItem',features:['PDF論文アップロード','AIサマリー生成','引用管理','関連論文推薦','研究ノート'],featuresEn:['PDF paper upload','AI summary generation','Citation management','Related paper recommendation','Research notes'],scaleHint:{solo:{ja:'個人研究者。FastAPI+OpenAI APIで手軽に開始',en:'Solo researcher. FastAPI+OpenAI API easy start'},small:{ja:'研究グループ。Supabase+ベクター検索で関連論文発見',en:'Research group. Supabase+vector search for related papers'},medium:{ja:'大学研究科。Express+pgvector+知識グラフ',en:'University dept. Express+pgvector+knowledge graph'},large:{ja:'研究機関全体。NestJS+RAG+マルチモーダル解析',en:'Whole institution. NestJS+RAG+multimodal analysis'}},meta:{revenue:'subsidy',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
sci_math_checker:_fpd({name:'数式・証明チェッカー',nameEn:'Math & Proof Checker',icon:'∑',field:'science',purpose:'LaTeX数式・数学的証明をAIが検証しフィードバックを提供',purposeEn:'AI verification of LaTeX formulas & mathematical proofs with feedback',entities:'User, MathFormula, ExperimentData',features:['LaTeX数式入力','AI証明検証','エラー指摘・修正提案','数式ライブラリ管理','教育用ステップ解説'],featuresEn:['LaTeX formula input','AI proof verification','Error feedback & correction','Formula library','Educational step-by-step explanation'],scaleHint:{solo:{ja:'個人研究者・学生。FastAPI+SymPy+GPT-4',en:'Solo researcher/student. FastAPI+SymPy+GPT-4'},small:{ja:'研究室。Supabase+数式DB',en:'Lab. Supabase+formula DB'},medium:{ja:'大学。Express+証明システム+協調編集',en:'University. Express+proof system+collaborative editing'},large:{ja:'数学・物理研究所。NestJS+形式検証+Lean4連携',en:'Math/physics institute. NestJS+formal verification+Lean4'}},meta:{revenue:'subsidy',regulation:'low',apiDep:'api_heavy',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
sci_observation:_fpd({name:'観測データ可視化',nameEn:'Observation Data Visualizer',icon:'🌌',field:'science',purpose:'天文・気象・地震など観測データのリアルタイム収集と可視化',purposeEn:'Real-time collection & visualization of astronomical, meteorological & seismic data',entities:'User, ObservationLog, DataPoint, Alert, Sensor',features:['観測データ取込み','リアルタイムグラフ','アノマリーアラート','データアーカイブ','地図・3D可視化'],featuresEn:['Observation data ingestion','Real-time charts','Anomaly alerts','Data archive','Map & 3D visualization'],scaleHint:{solo:{ja:'個人天文家。FastAPI+matplotlib',en:'Solo astronomer. FastAPI+matplotlib'},small:{ja:'観測所。Supabase+TimescaleDB互換',en:'Observatory. Supabase+TimescaleDB compatible'},medium:{ja:'大学天文台。Express+PostgreSQL+時系列DB',en:'University observatory. Express+PostgreSQL+time-series DB'},large:{ja:'国立天文台。NestJS+大規模データパイプライン+グリッドコンピューティング',en:'National observatory. NestJS+large-scale data pipeline+grid computing'}},meta:{revenue:'subsidy',regulation:'low',apiDep:'hybrid',agentLv:'L1',multimodal:'text',onDevice:'edge_cloud'}}),
// ── 🌾 農学系 (agriculture) ──
agri_diagnosis:_fpd({name:'作物診断・病害虫識別',nameEn:'Crop Diagnosis & Pest ID',icon:'🌿',field:'agriculture',purpose:'スマートフォン写真から作物の病害虫をAI識別・処置提案',purposeEn:'AI identification of crop diseases & pests from smartphone photos with treatment suggestions',entities:'User, CropDiagnosis, Farm, Crop, Alert',features:['写真アップロード','AI病害虫識別','処置・農薬推奨','診断履歴管理','専門家相談連携'],featuresEn:['Photo upload','AI pest/disease identification','Treatment & pesticide recommendation','Diagnosis history','Expert consultation'],scaleHint:{solo:{ja:'個人農家。FastAPI+画像分類モデル',en:'Solo farmer. FastAPI+image classification model'},small:{ja:'農業法人。Supabase+モバイルアプリ',en:'Agricultural corp. Supabase+mobile app'},medium:{ja:'農業指導機関。Express+AI学習データ蓄積',en:'Agricultural advisory. Express+AI training data accumulation'},large:{ja:'農業省・広域。NestJS+フェデレーテッドラーニング+ドローン連携',en:'Ministry/wide-area. NestJS+federated learning+drone integration'}},meta:{revenue:'subsidy',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
agri_forecast:_fpd({name:'気象×収穫予測',nameEn:'Weather & Harvest Forecast',icon:'🌤️',field:'agriculture',purpose:'気象データとAIで収穫量を予測し農業経営計画を最適化',purposeEn:'AI harvest yield prediction using weather data to optimize farm management',entities:'User, WeatherForecast, Harvest, Farm, Crop',features:['気象APIデータ連携','AIによる収穫予測','作付け計画最適化','収益シミュレーション','アラート通知'],featuresEn:['Weather API integration','AI harvest prediction','Crop planting optimization','Revenue simulation','Alert notifications'],scaleHint:{solo:{ja:'個人農家。FastAPI+気象APIで基本予測',en:'Solo farmer. FastAPI+weather API basic forecast'},small:{ja:'農業法人。Supabase+機械学習予測モデル',en:'Agricultural corp. Supabase+ML prediction model'},medium:{ja:'JAグループ。Express+広域気象+市場価格連携',en:'JA group. Express+wide-area weather+market price'},large:{ja:'食品企業・商社。NestJS+衛星データ+サプライチェーン最適化',en:'Food company/trading. NestJS+satellite data+supply chain optimization'}},meta:{revenue:'btob',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
agri_soil:_fpd({name:'土壌分析・精密農業',nameEn:'Soil Analysis & Precision Farming',icon:'🌱',field:'agriculture',purpose:'土壌センサーデータをAI分析し施肥・灌漑を最適化する精密農業',purposeEn:'AI soil sensor analysis to optimize fertilization & irrigation for precision farming',entities:'User, SoilAnalysis, Field, Farm, IrrigationSchedule',features:['土壌センサー連携','pH・栄養素分析','施肥推奨マップ','灌漑自動スケジュール','コスト削減レポート'],featuresEn:['Soil sensor integration','pH & nutrient analysis','Fertilization recommendation map','Auto irrigation scheduling','Cost reduction report'],scaleHint:{solo:{ja:'個人農家。FastAPI+センサーAPI',en:'Solo farmer. FastAPI+sensor API'},small:{ja:'農業法人。Supabase+IoTセンサー管理',en:'Agricultural corp. Supabase+IoT sensor management'},medium:{ja:'精密農業法人。Express+GIS+ドローン測量連携',en:'Precision farming corp. Express+GIS+drone survey'},large:{ja:'大規模農場・農機メーカー。NestJS+衛星観測+自動農機制御',en:'Large farm/agri-machinery. NestJS+satellite observation+autonomous machinery'}},meta:{revenue:'btob',regulation:'low',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
agri_iot:_fpd({name:'農業IoTダッシュボード',nameEn:'Agriculture IoT Dashboard',icon:'📡',field:'agriculture',purpose:'農場の温湿度・土壌・水質センサーを一元管理するIoTプラットフォーム',purposeEn:'Unified IoT platform to manage farm temperature, soil & water sensors',entities:'User, Farm, SensorData, Sensor, Alert, IrrigationSchedule',features:['センサーデバイス管理','リアルタイムデータ表示','閾値アラート設定','遠隔制御','履歴データ分析'],featuresEn:['Sensor device management','Real-time data display','Threshold alert settings','Remote control','Historical data analysis'],scaleHint:{solo:{ja:'個人農家。FastAPI+MQTT+SQLite',en:'Solo farmer. FastAPI+MQTT+SQLite'},small:{ja:'農業法人。Supabase+IoTハブ連携',en:'Agricultural corp. Supabase+IoT hub'},medium:{ja:'大規模農場。Express+MQTT Broker+時系列DB',en:'Large farm. Express+MQTT broker+time-series DB'},large:{ja:'農業コングロマリット。NestJS+エッジAI+サテライトIoT',en:'Agriculture conglomerate. NestJS+edge AI+satellite IoT'}},meta:{revenue:'btob',regulation:'low',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'edge_cloud'}}),
// ── 🏥 医歯薬系 (medical) ──
med_symptom:_fpd({name:'症状チェッカー',nameEn:'Symptom Checker',icon:'🩺',field:'medical',purpose:'症状入力からAIが疾患候補を提示し適切な受診科を案内',purposeEn:'AI-powered symptom input to suggest disease candidates and appropriate medical departments',entities:'User, SymptomCheck, Patient',features:['症状入力インターフェース','AI疾患候補提示','重症度評価','受診科・病院案内','履歴管理'],featuresEn:['Symptom input interface','AI disease candidate suggestions','Severity assessment','Department & hospital guide','History management'],scaleHint:{solo:{ja:'医師個人開発。FastAPI+医療知識API',en:'Solo physician. FastAPI+medical knowledge API'},small:{ja:'クリニック向け。Supabase+症状DB',en:'Clinic use. Supabase+symptom DB'},medium:{ja:'病院グループ。Express+FHIR連携+電子カルテ統合',en:'Hospital group. Express+FHIR+EMR integration'},large:{ja:'医療システム企業。NestJS+大規模医療データ+規制対応',en:'Medical system company. NestJS+large-scale medical data+regulatory compliance'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
med_drug_check:_fpd({name:'薬剤相互作用チェッカー',nameEn:'Drug Interaction Checker',icon:'💊',field:'medical',purpose:'複数薬剤の相互作用リスクをAIがチェックし安全な処方を支援',purposeEn:'AI checks drug interaction risks to support safe prescription',entities:'User, DrugInteraction, Prescription',features:['薬剤名入力・検索','相互作用データベース','リスク重症度表示','処方推奨変更提案','薬剤情報PDF出力'],featuresEn:['Drug name input & search','Interaction database','Risk severity display','Prescription change suggestions','Drug info PDF export'],scaleHint:{solo:{ja:'薬剤師個人。FastAPI+医薬品DB API',en:'Solo pharmacist. FastAPI+drug DB API'},small:{ja:'薬局チェーン。Supabase+薬剤DB同期',en:'Pharmacy chain. Supabase+drug DB sync'},medium:{ja:'病院薬剤部。Express+調剤システム連携',en:'Hospital pharmacy. Express+dispensing system'},large:{ja:'製薬会社・医療IT。NestJS+FDA/PMDA規制DB+リアルタイム更新',en:'Pharma/medical IT. NestJS+FDA/PMDA regulatory DB+real-time updates'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
med_doc_summary:_fpd({name:'医療文書・カルテ要約',nameEn:'Medical Doc Summarizer',icon:'📋',field:'medical',purpose:'電子カルテ・放射線レポート・退院サマリーをAIが要約し業務効率化',purposeEn:'AI summarization of EMR, radiology reports & discharge summaries for workflow efficiency',entities:'User, MedicalDocument, Patient, MedicalRecord',features:['文書アップロード・OCR','AI要約生成','重要項目ハイライト','多言語対応','セキュリティ監査ログ'],featuresEn:['Document upload & OCR','AI summary generation','Key item highlighting','Multilingual support','Security audit log'],scaleHint:{solo:{ja:'医師個人。FastAPI+GPT-4+医療特化プロンプト',en:'Solo physician. FastAPI+GPT-4+medical prompts'},small:{ja:'クリニック。Supabase+ファイルストレージ+暗号化',en:'Clinic. Supabase+file storage+encryption'},medium:{ja:'病院。Express+FHIR+電子カルテ統合+HIPAA対応',en:'Hospital. Express+FHIR+EMR integration+HIPAA'},large:{ja:'病院グループ。NestJS+プライベートLLM+完全オンプレ',en:'Hospital group. NestJS+private LLM+full on-premise'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'on_device'}}),
med_rehab:_fpd({name:'リハビリ進捗管理',nameEn:'Rehab Progress Tracker',icon:'💪',field:'medical',purpose:'患者のリハビリ目標設定・実施記録・進捗可視化でケアの質を向上',purposeEn:'Patient rehab goal setting, session recording & progress visualization for care quality',entities:'User, RehabSession, RehabGoal, Patient',features:['患者リハビリ目標設定','セッション記録','進捗グラフ・レポート','動作解析連携','家族・担当医共有'],featuresEn:['Patient rehab goal setting','Session recording','Progress charts & reports','Motion analysis integration','Family & physician sharing'],scaleHint:{solo:{ja:'療法士個人。FastAPI+SQLite',en:'Solo therapist. FastAPI+SQLite'},small:{ja:'リハビリクリニック。Supabase+患者ポータル',en:'Rehab clinic. Supabase+patient portal'},medium:{ja:'総合病院リハビリ科。Express+電子カルテ連携+AI動作解析',en:'General hospital rehab. Express+EMR+AI motion analysis'},large:{ja:'リハビリテーション病院チェーン。NestJS+ウェアラブル連携+AI予後予測',en:'Rehab hospital chain. NestJS+wearable+AI prognosis prediction'}},meta:{revenue:'btob',regulation:'strict',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
// ── ⚖️ 社会科学系 (social) ──
soc_legal_review:_fpd({name:'法律・契約書レビュー',nameEn:'Legal & Contract Review',icon:'⚖️',field:'social',purpose:'契約書・法律文書をAIがレビューしリスクと改善点を指摘',purposeEn:'AI review of contracts & legal documents to identify risks and improvement points',entities:'User, LegalCase, Contract, Document',features:['契約書アップロード','AIリスク分析','条項別チェック','修正提案','法律知識Q&A'],featuresEn:['Contract upload','AI risk analysis','Clause-by-clause check','Revision suggestions','Legal Q&A'],scaleHint:{solo:{ja:'弁護士個人。FastAPI+LLM+法律特化プロンプト',en:'Solo attorney. FastAPI+LLM+legal prompts'},small:{ja:'法律事務所。Supabase+文書管理+セキュリティ強化',en:'Law firm. Supabase+document management+security'},medium:{ja:'企業法務部。Express+電子署名+承認ワークフロー',en:'Corporate legal. Express+e-signature+approval workflow'},large:{ja:'総合法律事務所。NestJS+判例DB+カスタムLLM fine-tuning',en:'Full-service law firm. NestJS+case law DB+custom LLM fine-tuning'}},meta:{revenue:'btob',regulation:'high',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'on_device'}}),
soc_market_research:_fpd({name:'市場調査・競合分析',nameEn:'Market Research & Competitive Analysis',icon:'📊',field:'social',purpose:'AI自動収集による市場トレンド・競合動向・顧客ニーズの分析',purposeEn:'AI-automated market trend, competitor & customer needs analysis',entities:'User, MarketResearch, ResearchData, Report',features:['Web自動収集','AI競合分析','トレンドレポート生成','ダッシュボード','エクスポート'],featuresEn:['Web auto-collection','AI competitor analysis','Trend report generation','Dashboard','Export'],scaleHint:{solo:{ja:'マーケター個人。FastAPI+Web Scraping+OpenAI',en:'Solo marketer. FastAPI+web scraping+OpenAI'},small:{ja:'コンサル会社。Supabase+定期レポート自動生成',en:'Consulting firm. Supabase+periodic auto-report'},medium:{ja:'マーケティング会社。Express+BI連携+SNS API',en:'Marketing agency. Express+BI+SNS API'},large:{ja:'大企業マーケ部門。NestJS+リアルタイム競合モニタリング+AIエージェント',en:'Enterprise marketing. NestJS+real-time competitor monitoring+AI agent'}},meta:{revenue:'btob',regulation:'low',apiDep:'api_heavy',agentLv:'L3',multimodal:'text',onDevice:'cloud'}}),
soc_financial_report:_fpd({name:'財務レポート自動生成',nameEn:'Financial Report Generator',icon:'💹',field:'social',purpose:'会計データからIFRS/GAAP準拠の財務レポートをAIが自動作成',purposeEn:'AI auto-generation of IFRS/GAAP compliant financial reports from accounting data',entities:'User, FinancialReport, Report, Account',features:['会計データ取込み','自動レポート生成','グラフ・チャート','監査証跡','多言語対応'],featuresEn:['Accounting data ingestion','Auto report generation','Charts & graphs','Audit trail','Multilingual support'],scaleHint:{solo:{ja:'CFO個人・フリーランス会計士。FastAPI+CSV処理',en:'Solo CFO/freelance accountant. FastAPI+CSV processing'},small:{ja:'中小企業経理。Supabase+会計ソフト連携',en:'SMB accounting. Supabase+accounting software integration'},medium:{ja:'上場企業。Express+ERPシステム連携+監査ログ',en:'Listed company. Express+ERP integration+audit log'},large:{ja:'多国籍企業。NestJS+IFRS準拠+複数通貨+XBRL出力',en:'Multinational. NestJS+IFRS+multi-currency+XBRL output'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
soc_sns_analysis:_fpd({name:'世論・SNS分析',nameEn:'Public Opinion & SNS Analysis',icon:'📢',field:'social',purpose:'Twitter/X・Instagramなど複数SNSの投稿を収集・感情分析・トレンド把握',purposeEn:'Multi-platform SNS post collection, sentiment analysis & trend monitoring',entities:'User, SocialPost, SentimentAnalysis, Report',features:['複数SNSデータ収集','AI感情分析','トレンドキーワード','インフルエンサー分析','レポート出力'],featuresEn:['Multi-SNS data collection','AI sentiment analysis','Trend keywords','Influencer analysis','Report export'],scaleHint:{solo:{ja:'個人研究者。FastAPI+SNS API+BERT',en:'Solo researcher. FastAPI+SNS API+BERT'},small:{ja:'PR会社。Supabase+定期レポート',en:'PR agency. Supabase+periodic reports'},medium:{ja:'マーケ会社。Express+リアルタイム分析+BI連携',en:'Marketing firm. Express+real-time analysis+BI'},large:{ja:'大企業・官公庁。NestJS+大規模データ収集+LLM感情分析',en:'Enterprise/government. NestJS+large-scale collection+LLM sentiment'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
// ── 📚 人文科学系 (humanities) ──
hum_text_analysis:_fpd({name:'文献・史料解析',nameEn:'Literature & Historical Doc Analysis',icon:'📜',field:'humanities',purpose:'古文書・歴史文献をデジタル化しAIで内容解析・関連性マッピング',purposeEn:'Digitize ancient documents & historical literature for AI content analysis & relationship mapping',entities:'User, LiteratureSource, TextAnalysis, ResearchPaper',features:['文献スキャンアップロード','OCR・テキスト抽出','AI内容解析','関係性グラフ','エクスポート'],featuresEn:['Document scan upload','OCR & text extraction','AI content analysis','Relationship graph','Export'],scaleHint:{solo:{ja:'個人研究者。FastAPI+OCR+NLP',en:'Solo researcher. FastAPI+OCR+NLP'},small:{ja:'大学研究室。Supabase+デジタルアーカイブ',en:'University lab. Supabase+digital archive'},medium:{ja:'研究機関。Express+大規模文献DB+協調編集',en:'Research institute. Express+large literature DB+collaborative editing'},large:{ja:'国立図書館・博物館。NestJS+IIIF連携+マルチ言語AI',en:'National library/museum. NestJS+IIIF integration+multi-language AI'}},meta:{revenue:'subsidy',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
hum_translation:_fpd({name:'翻訳・多言語対応',nameEn:'Translation & Multilingual Tool',icon:'🌍',field:'humanities',purpose:'専門用語対応の高精度AI翻訳と翻訳メモリ管理ツール',purposeEn:'High-accuracy AI translation with terminology support and translation memory management',entities:'User, Translation, TranslationSegment, Courseware',features:['テキスト・ファイル翻訳','翻訳メモリ','用語集管理','品質スコア','協調翻訳'],featuresEn:['Text & file translation','Translation memory','Glossary management','Quality score','Collaborative translation'],scaleHint:{solo:{ja:'フリーランス翻訳者。FastAPI+DeepL/GPT-4 API',en:'Freelance translator. FastAPI+DeepL/GPT-4 API'},small:{ja:'翻訳会社。Supabase+翻訳メモリDB',en:'Translation agency. Supabase+TM database'},medium:{ja:'グローバル企業。Express+CAT連携+QAワークフロー',en:'Global company. Express+CAT tools+QA workflow'},large:{ja:'多国籍企業。NestJS+カスタム翻訳エンジン+XLIFF対応',en:'Multinational. NestJS+custom translation engine+XLIFF'}},meta:{revenue:'btob',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
hum_style_analysis:_fpd({name:'文体分析・コンテンツ品質管理',nameEn:'Style Analysis & Content QA',icon:'✍️',field:'humanities',purpose:'文章の文体・一貫性・品質をAIが分析しライティング品質を向上',purposeEn:'AI analysis of text style, consistency & quality to improve writing standards',entities:'User, StyleReport, Content',features:['文章アップロード','AI文体分析','一貫性チェック','改善提案','ブランドガイドライン管理'],featuresEn:['Text upload','AI style analysis','Consistency check','Improvement suggestions','Brand guideline management'],scaleHint:{solo:{ja:'ライター個人。FastAPI+LLM文体分析',en:'Solo writer. FastAPI+LLM style analysis'},small:{ja:'編集プロダクション。Supabase+ブランドガイドライン管理',en:'Editorial production. Supabase+brand guideline management'},medium:{ja:'メディア企業。Express+コンテンツCMS連携+品質スコアボード',en:'Media company. Express+CMS integration+quality scoreboard'},large:{ja:'出版社・大企業コンテンツ部門。NestJS+カスタムスタイルガイドLLM',en:'Publisher/enterprise content. NestJS+custom style guide LLM'}},meta:{revenue:'btob',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
hum_courseware:_fpd({name:'教材・講義スクリプト生成',nameEn:'Courseware & Script Generator',icon:'📖',field:'humanities',purpose:'授業計画・教材・講義スクリプトをAIが自動生成し教育者の準備時間を削減',purposeEn:'AI auto-generation of lesson plans, teaching materials & lecture scripts to reduce prep time',entities:'User, Courseware, Lesson, Course',features:['授業計画入力','AI教材生成','スクリプト作成','グレードレベル調整','エクスポート(PDF/DOCX)'],featuresEn:['Lesson plan input','AI material generation','Script creation','Grade level adjustment','Export (PDF/DOCX)'],scaleHint:{solo:{ja:'個人教師。FastAPI+GPT-4で教材自動生成',en:'Solo teacher. FastAPI+GPT-4 auto-generation'},small:{ja:'学習塾・私立学校。Supabase+教材ライブラリ',en:'Cram school/private school. Supabase+material library'},medium:{ja:'教育委員会。Express+カリキュラム管理+協調編集',en:'Board of education. Express+curriculum management+collab editing'},large:{ja:'文部科学省・大手教育機関。NestJS+国語・数学AI特化モデル',en:'Ministry of education/major institution. NestJS+subject-specific AI models'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
// ── 🎓 教育系 (education_field) ──
edu_learning_plan:_fpd({name:'個別学習プランナー',nameEn:'Personalized Learning Planner',icon:'🎯',field:'education_field',purpose:'学習者の目標・弱点・ペースをAIが分析し最適な学習計画を自動生成',purposeEn:'AI analysis of learner goals, weaknesses & pace to auto-generate optimal study plans',entities:'User, LearningPlan, LearningGoal, Student',features:['学習目標設定','AIプラン自動生成','進捗トラッキング','弱点分析','日次タスク'],featuresEn:['Learning goal setting','AI plan auto-generation','Progress tracking','Weakness analysis','Daily tasks'],scaleHint:{solo:{ja:'個人学習コーチ。FastAPI+GPT-4学習アドバイス',en:'Solo learning coach. FastAPI+GPT-4 learning advice'},small:{ja:'学習塾。Supabase+生徒管理+プランDB',en:'Cram school. Supabase+student management+plan DB'},medium:{ja:'EdTech企業。Express+適応学習エンジン+分析ダッシュボード',en:'EdTech company. Express+adaptive learning engine+analytics'},large:{ja:'大手教育プラットフォーム。NestJS+ナレッジグラフ+マルチモーダル学習',en:'Major education platform. NestJS+knowledge graph+multimodal learning'}},meta:{revenue:'subscription',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
edu_quiz_gen:_fpd({name:'問題自動生成・採点',nameEn:'Auto Quiz Generator & Grader',icon:'📝',field:'education_field',purpose:'教材コンテンツからAIが問題を自動生成し採点・解説を提供',purposeEn:'AI auto-generation of quiz questions from educational content with grading & explanations',entities:'User, Quiz, QuizResult, Student, Course',features:['教材アップロード','AI問題生成','自動採点','解説生成','成績管理'],featuresEn:['Material upload','AI question generation','Auto grading','Explanation generation','Grade management'],scaleHint:{solo:{ja:'個人教師。FastAPI+GPT-4問題生成',en:'Solo teacher. FastAPI+GPT-4 question generation'},small:{ja:'学習塾。Supabase+問題バンク管理',en:'Cram school. Supabase+question bank management'},medium:{ja:'学校法人。Express+LMS連携+成績自動反映',en:'Educational corporation. Express+LMS+auto grade sync'},large:{ja:'大手EdTech。NestJS+適応型出題+AIコンテンツ生成',en:'Major EdTech. NestJS+adaptive testing+AI content generation'}},meta:{revenue:'subscription',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
edu_progress:_fpd({name:'学習進捗トラッカー',nameEn:'Learning Progress Tracker',icon:'📈',field:'education_field',purpose:'学習セッション記録・可視化・目標達成予測で学習継続をサポート',purposeEn:'Study session recording, visualization & goal achievement prediction to support learning continuity',entities:'User, StudySession, Progress, Student, LearningGoal',features:['学習セッション記録','進捗グラフ','目標達成予測','ストリーク管理','保護者レポート'],featuresEn:['Study session recording','Progress charts','Goal achievement prediction','Streak management','Parent reports'],scaleHint:{solo:{ja:'個人ユーザー。FastAPI+シンプルDB',en:'Solo user. FastAPI+simple DB'},small:{ja:'学習塾・コーチ。Supabase+複数生徒管理',en:'Cram school/coach. Supabase+multi-student management'},medium:{ja:'学校・EdTech。Express+通知システム+保護者ポータル',en:'School/EdTech. Express+notification system+parent portal'},large:{ja:'教育委員会・大手EdTech。NestJS+AIドロップアウト予測+介入システム',en:'Board of education/major EdTech. NestJS+AI dropout prediction+intervention'}},meta:{revenue:'subscription',regulation:'low',apiDep:'hybrid',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
edu_tutor_bot:_fpd({name:'チュータリングBot',nameEn:'Tutoring Chatbot',icon:'🤖',field:'education_field',purpose:'生徒の質問に24/7答えるAIチューターBot。個別化された説明で理解を深める',purposeEn:'24/7 AI tutor bot answering student questions with personalized explanations',entities:'User, Bot, Conversation, Student, Course',features:['AI質問応答','教科別チューニング','解説図生成','会話履歴','理解度チェック'],featuresEn:['AI Q&A','Subject-specific tuning','Explanation diagram generation','Conversation history','Comprehension check'],scaleHint:{solo:{ja:'個人教師。FastAPI+LLM+教科知識ベース',en:'Solo teacher. FastAPI+LLM+subject knowledge base'},small:{ja:'学習塾。Supabase+LINEBot連携',en:'Cram school. Supabase+LINE bot integration'},medium:{ja:'学校法人。Express+教科別AIモデル+LMS連携',en:'Educational corp. Express+subject AI models+LMS'},large:{ja:'大手EdTech。NestJS+マルチモーダルAI+音声対応',en:'Major EdTech. NestJS+multimodal AI+voice support'}},meta:{revenue:'subscription',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'},target:['学生','保護者'],targetEn:['Students','Parents']}),
// ── 🎨 芸術・デザイン系 (art) ──
art_image_gen:_fpd({name:'画像生成・スタイル提案',nameEn:'Image Gen & Style Proposal',icon:'🎨',field:'art',purpose:'テキストプロンプトからデザインスタイル画像を生成しクリエイティブを加速',purposeEn:'Generate design-style images from text prompts to accelerate creative work',entities:'User, GeneratedImage, StylePreset',features:['テキスト→画像生成','スタイルプリセット管理','バリエーション生成','コレクション管理','プロンプト最適化'],featuresEn:['Text-to-image generation','Style preset management','Variation generation','Collection management','Prompt optimization'],scaleHint:{solo:{ja:'個人クリエイター。FastAPI+DALL-E/Stable Diffusion',en:'Solo creator. FastAPI+DALL-E/Stable Diffusion'},small:{ja:'デザイン事務所。Supabase+画像管理',en:'Design studio. Supabase+image management'},medium:{ja:'広告代理店。Express+複数AI連携+ブランドガイドライン管理',en:'Ad agency. Express+multi-AI+brand guideline management'},large:{ja:'ゲーム会社・大手クリエイティブ。NestJS+カスタムLoRA+コンテンツ管理',en:'Game company/major creative. NestJS+custom LoRA+content management'}},meta:{revenue:'subscription',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
art_curator:_fpd({name:'作品解説・キュレーター',nameEn:'Artwork Commentary & Curator',icon:'🖼️',field:'art',purpose:'美術作品・展覧会のAI解説生成と多言語キュレーションで鑑賞体験を向上',purposeEn:'AI commentary generation for artworks & exhibitions for multilingual curation experiences',entities:'User, ArtWork, PortfolioItem',features:['作品登録・管理','AI解説生成','多言語翻訳','AR展示連携','QRコード生成'],featuresEn:['Artwork registration & management','AI commentary generation','Multilingual translation','AR exhibition integration','QR code generation'],scaleHint:{solo:{ja:'個人アーティスト。FastAPI+GPT-4解説生成',en:'Solo artist. FastAPI+GPT-4 commentary'},small:{ja:'小規模ギャラリー。Supabase+QR展示システム',en:'Small gallery. Supabase+QR exhibition system'},medium:{ja:'公立美術館。Express+多言語CMS+AR連携',en:'Public museum. Express+multilingual CMS+AR'},large:{ja:'国立美術館・大手オークション。NestJS+AIアート分析+NFT連携',en:'National museum/major auction. NestJS+AI art analysis+NFT integration'}},meta:{revenue:'btob',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
art_music:_fpd({name:'音楽生成・編曲補助',nameEn:'Music Gen & Arrangement',icon:'🎵',field:'art',purpose:'AIによる楽曲生成・編曲・楽譜生成でミュージシャンの創作を支援',purposeEn:'AI-powered music generation, arrangement & score generation to support musicians',entities:'User, MusicTrack, Arrangement',features:['AI楽曲生成','編曲ツール','楽譜生成','ジャンル・スタイル選択','コラボレーション'],featuresEn:['AI music generation','Arrangement tools','Score generation','Genre & style selection','Collaboration'],scaleHint:{solo:{ja:'個人ミュージシャン。FastAPI+Suno/Udio API',en:'Solo musician. FastAPI+Suno/Udio API'},small:{ja:'音楽プロダクション。Supabase+楽曲管理+権利管理',en:'Music production. Supabase+track management+rights management'},medium:{ja:'ゲーム会社・CM制作。Express+BGM自動生成+ライセンス管理',en:'Game company/ad production. Express+BGM auto-gen+license management'},large:{ja:'大手レーベル・メディア。NestJS+カスタムAI作曲+ISRC管理',en:'Major label/media. NestJS+custom AI composition+ISRC management'}},meta:{revenue:'subscription',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'full_multimodal',onDevice:'cloud'}}),
art_portfolio:_fpd({name:'ポートフォリオ自動構成',nameEn:'Auto Portfolio & Sales Support',icon:'💼',field:'art',purpose:'作品データを自動整理しAIがポートフォリオサイトと営業資料を生成',purposeEn:'Auto-organize artwork data with AI-generated portfolio sites and sales materials',entities:'User, ArtWork, PortfolioItem, GeneratedImage',features:['作品アップロード','AI自動構成','ポートフォリオサイト生成','営業資料PDF','SNS連携'],featuresEn:['Artwork upload','AI auto-organization','Portfolio site generation','Sales material PDF','SNS integration'],scaleHint:{solo:{ja:'個人クリエイター。FastAPI+静的サイト生成',en:'Solo creator. FastAPI+static site generation'},small:{ja:'クリエイターエージェンシー。Supabase+複数ポートフォリオ管理',en:'Creator agency. Supabase+multi-portfolio management'},medium:{ja:'デザインスクール。Express+学生作品管理+就職支援',en:'Design school. Express+student portfolio+career support'},large:{ja:'大手クリエイティブ人材サービス。NestJS+AI採用マッチング+作品評価',en:'Major creative talent service. NestJS+AI hiring match+artwork evaluation'}},meta:{revenue:'subscription',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
// ── 🌐 総合・融合系 (interdisciplinary) ──
cross_pm_ai:_fpd({name:'プロジェクト管理AI',nameEn:'PM AI Assistant',icon:'🗂️',field:'interdisciplinary',purpose:'プロジェクト計画・タスク割り当て・進捗予測をAIエージェントが自動最適化',purposeEn:'AI agent auto-optimization of project planning, task assignment & progress prediction',entities:'User, Project, Task, Agent, Conversation',features:['AIタスク割り当て','進捗予測','リスク検出','自動レポート生成','チームコラボ'],featuresEn:['AI task assignment','Progress prediction','Risk detection','Auto report generation','Team collaboration'],scaleHint:{solo:{ja:'フリーランスPM。FastAPI+GPT-4プロジェクトアドバイス',en:'Freelance PM. FastAPI+GPT-4 project advice'},small:{ja:'スタートアップ。Supabase+SlackBot連携',en:'Startup. Supabase+Slack bot integration'},medium:{ja:'IT会社。Express+Jira連携+予測分析',en:'IT company. Express+Jira integration+predictive analytics'},large:{ja:'大企業PMO。NestJS+ポートフォリオ管理+AIエージェント自動化',en:'Enterprise PMO. NestJS+portfolio management+AI agent automation'}},meta:{revenue:'subscription',regulation:'low',apiDep:'api_heavy',agentLv:'L3',multimodal:'text',onDevice:'cloud'}}),
cross_knowledge:_fpd({name:'ナレッジベース構築',nameEn:'Knowledge Base & Internal AI',icon:'🧠',field:'interdisciplinary',purpose:'社内文書・ナレッジをAIインデックス化し自然言語で即時検索・回答',purposeEn:'AI indexing of internal docs & knowledge for instant natural language search & answers',entities:'User, KnowledgeItem, Article, KnowledgeBase',features:['文書取込み・インデックス化','AI自然言語検索','Q&A自動応答','ナレッジ品質管理','アクセス権限管理'],featuresEn:['Document ingestion & indexing','AI natural language search','Q&A auto-answer','Knowledge quality management','Access control'],scaleHint:{solo:{ja:'個人研究者。FastAPI+pgvector+GPT-4 RAG',en:'Solo researcher. FastAPI+pgvector+GPT-4 RAG'},small:{ja:'中小企業。Supabase+pgvector+社内Bot',en:'SMB. Supabase+pgvector+internal bot'},medium:{ja:'中堅企業。Express+Elasticsearch+LLM RAG',en:'Mid-size company. Express+Elasticsearch+LLM RAG'},large:{ja:'大企業。NestJS+プライベートLLM+多言語+SSO',en:'Enterprise. NestJS+private LLM+multilingual+SSO'}},meta:{revenue:'subscription',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'on_device'}}),
cross_research:_fpd({name:'多分野横断リサーチ',nameEn:'Cross-Disciplinary Research',icon:'🔭',field:'interdisciplinary',purpose:'複数分野の論文・文献・データを横断的に検索・分析・統合するリサーチプラットフォーム',purposeEn:'Cross-disciplinary platform to search, analyze & integrate papers, literature & data across fields',entities:'User, ResearchQuery, ResearchPaper, DataPoint',features:['複数DB統合検索','AI横断分析','引用ネットワーク可視化','研究ノート','コラボレーション'],featuresEn:['Multi-DB integrated search','AI cross-field analysis','Citation network visualization','Research notes','Collaboration'],scaleHint:{solo:{ja:'個人研究者。FastAPI+arXiv/PubMed API',en:'Solo researcher. FastAPI+arXiv/PubMed API'},small:{ja:'研究グループ。Supabase+文献管理+共同注釈',en:'Research group. Supabase+literature management+shared annotation'},medium:{ja:'大学研究所。Express+大規模文献DB+知識グラフ',en:'University institute. Express+large literature DB+knowledge graph'},large:{ja:'国際研究機関。NestJS+AIエージェント文献解析+学際ネットワーク',en:'International research institute. NestJS+AI agent literature analysis+interdisciplinary network'}},meta:{revenue:'subsidy',regulation:'low',apiDep:'api_heavy',agentLv:'L3',multimodal:'text_image',onDevice:'cloud'}}),
cross_lms_community:_fpd({name:'コミュニティLMS',nameEn:'Community LMS Platform',icon:'👥',field:'interdisciplinary',purpose:'学習・コミュニティ・イベントを統合したオールインワン教育プラットフォーム',purposeEn:'All-in-one education platform integrating learning, community & events',entities:'User, Course, Lesson, Community, Post',features:['コース配信','コミュニティフォーラム','イベント管理','メンバーシップ課金','進捗管理'],featuresEn:['Course delivery','Community forum','Event management','Membership billing','Progress tracking'],scaleHint:{solo:{ja:'個人コンテンツクリエイター。FastAPI+Supabase',en:'Solo content creator. FastAPI+Supabase'},small:{ja:'オンラインスクール。Supabase+Stripe課金',en:'Online school. Supabase+Stripe billing'},medium:{ja:'EdTech企業。Express+マルチテナント+分析',en:'EdTech company. Express+multi-tenant+analytics'},large:{ja:'大手教育プラットフォーム。NestJS+AI推薦+グローバル展開',en:'Major education platform. NestJS+AI recommendation+global expansion'}},meta:{revenue:'subscription',regulation:'low',apiDep:'hybrid',agentLv:'L1',multimodal:'text_image',onDevice:'cloud'}}),
// ── 🌱 環境・エネルギー系 (environment) ──
env_carbon:_fpd({name:'カーボン排出量管理',nameEn:'Carbon Footprint Tracker',icon:'🌿',field:'environment',purpose:'企業・サプライチェーン全体のCO2排出量を可視化しネットゼロ達成を支援',purposeEn:'Visualize company & supply chain CO2 emissions to support net-zero achievement',entities:'User, CarbonEmission, Report, EnergyAsset',features:['排出源データ入力','Scope1/2/3計算','削減シナリオシミュレーション','ESG報告書出力','サプライチェーン統合'],featuresEn:['Emission source data input','Scope 1/2/3 calculation','Reduction scenario simulation','ESG report output','Supply chain integration'],scaleHint:{solo:{ja:'個人事業主・スタートアップ。FastAPI+排出係数DB',en:'Sole proprietor/startup. FastAPI+emission factor DB'},small:{ja:'中小企業。Supabase+自動Scope2計算',en:'SMB. Supabase+auto Scope 2 calculation'},medium:{ja:'上場企業。Express+サプライヤーポータル+GHGプロトコル準拠',en:'Listed company. Express+supplier portal+GHG protocol'},large:{ja:'大企業・コングロマリット。NestJS+AIドリフト検知+CDP報告連携',en:'Enterprise conglomerate. NestJS+AI drift detection+CDP reporting'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
env_energy_monitor:_fpd({name:'再エネ発電予測・最適化',nameEn:'Renewable Energy Optimizer',icon:'⚡',field:'environment',purpose:'太陽光・風力などの再エネ発電量を予測し電力網との最適統合を実現',purposeEn:'Forecast renewable energy generation from solar/wind to optimize grid integration',entities:'User, RenewableSource, Meter, Reading, Alert',features:['発電量リアルタイム監視','AI発電予測','需給バランス最適化','アラート通知','市場価格連携'],featuresEn:['Real-time generation monitoring','AI generation forecast','Supply-demand balancing','Alert notifications','Market price integration'],scaleHint:{solo:{ja:'個人太陽光発電オーナー。FastAPI+気象API',en:'Solo solar owner. FastAPI+weather API'},small:{ja:'中小電力会社。Supabase+センサーデータ管理',en:'Small utility. Supabase+sensor data management'},medium:{ja:'再エネ事業者。Express+スマートグリッド連携+SCADA',en:'Renewable energy company. Express+smart grid+SCADA'},large:{ja:'大手電力会社・グリッド運営。NestJS+AI需給予測+市場取引自動化',en:'Major utility/grid operator. NestJS+AI demand forecast+market trading automation'}},meta:{revenue:'btob',regulation:'high',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'edge_cloud'}}),
env_assessment:_fpd({name:'環境アセスメント自動化',nameEn:'Environmental Assessment Automation',icon:'🌍',field:'environment',purpose:'建設・開発プロジェクトの環境影響評価プロセスをAIで効率化・自動化',purposeEn:'AI-powered efficiency & automation of environmental impact assessment processes for development projects',entities:'User, EnvAssessment, Document, Report',features:['影響評価フォーム','AI影響分析','法規制チェック','レポート自動生成','ステークホルダー管理'],featuresEn:['Impact assessment form','AI impact analysis','Regulatory check','Auto report generation','Stakeholder management'],scaleHint:{solo:{ja:'コンサルタント個人。FastAPI+環境規制DB',en:'Solo consultant. FastAPI+environmental regulation DB'},small:{ja:'環境コンサル会社。Supabase+プロジェクト管理',en:'Environmental consulting firm. Supabase+project management'},medium:{ja:'建設会社。Express+GIS連携+法規制自動チェック',en:'Construction company. Express+GIS+auto regulatory check'},large:{ja:'大規模インフラ事業者・政府機関。NestJS+AI複合影響評価',en:'Large infrastructure/government. NestJS+AI multi-factor impact assessment'}},meta:{revenue:'btob',regulation:'strict',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
env_esg:_fpd({name:'ESGレポート自動生成',nameEn:'ESG Report Generator',icon:'♻️',field:'environment',purpose:'財務・ESGデータを統合し国際基準(GRI/SASB/TCFD)準拠のレポートを自動生成',purposeEn:'Integrate financial & ESG data to auto-generate reports compliant with GRI/SASB/TCFD',entities:'User, ESGReport, CarbonEmission, Report',features:['ESGデータ入力・収集','国際基準マッピング','AIレポート生成','データ検証','投資家向けダッシュボード'],featuresEn:['ESG data input & collection','International standard mapping','AI report generation','Data validation','Investor dashboard'],scaleHint:{solo:{ja:'IR担当者個人。FastAPI+ESG指標DB',en:'Solo IR officer. FastAPI+ESG metrics DB'},small:{ja:'中堅企業IR部門。Supabase+定期レポート自動化',en:'Mid-size company IR. Supabase+periodic report automation'},medium:{ja:'上場企業。Express+ERP連携+第三者検証ワークフロー',en:'Listed company. Express+ERP+third-party verification workflow'},large:{ja:'大企業・金融機関。NestJS+マルチフレームワーク準拠+リアルタイム開示',en:'Enterprise/financial institution. NestJS+multi-framework compliance+real-time disclosure'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
// ── 🏗️ 建築・都市計画系 (architecture) ──
arch_bim_viewer:_fpd({name:'BIMデータ解析・設計補助',nameEn:'BIM Analyzer & Design Assist',icon:'🏗️',field:'architecture',purpose:'BIMモデルを解析しAIが設計上の問題点・最適化提案を自動検出',purposeEn:'BIM model analysis with AI auto-detection of design issues & optimization proposals',entities:'User, BIMModel, BuildingElement, Project',features:['BIMファイルアップロード(IFC)','AI設計チェック','干渉チェック','コスト試算','3Dビューア'],featuresEn:['BIM file upload (IFC)','AI design check','Clash detection','Cost estimation','3D viewer'],scaleHint:{solo:{ja:'建築士個人。FastAPI+IFC.js解析',en:'Solo architect. FastAPI+IFC.js analysis'},small:{ja:'設計事務所。Supabase+BIM管理+レビューワークフロー',en:'Design firm. Supabase+BIM management+review workflow'},medium:{ja:'ゼネコン設計部門。Express+CAD連携+自動干渉チェック',en:'General contractor design. Express+CAD+auto clash detection'},large:{ja:'大手ゼネコン・デベロッパー。NestJS+デジタルツイン+運用BIM連携',en:'Major GC/developer. NestJS+digital twin+operational BIM'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
arch_regulation:_fpd({name:'用途地域・法規制チェック',nameEn:'Zoning & Building Code Checker',icon:'📏',field:'architecture',purpose:'住所・座標入力で用途地域・建蔽率・容積率など建築基準法を自動チェック',purposeEn:'Auto-check zoning, building coverage ratio & floor area ratio from address/coordinates',entities:'User, ZoningCheck, Property, Document',features:['住所・座標入力','用途地域判定','法規制自動チェック','建築可能規模試算','レポート出力'],featuresEn:['Address/coordinate input','Zoning determination','Auto regulatory check','Buildable area estimation','Report output'],scaleHint:{solo:{ja:'建築士個人。FastAPI+地図API+建築基準法DB',en:'Solo architect. FastAPI+map API+building code DB'},small:{ja:'設計事務所。Supabase+申請管理',en:'Design firm. Supabase+application management'},medium:{ja:'不動産会社・ゼネコン。Express+自治体条例DB+自動更新',en:'Real estate/GC. Express+municipal ordinance DB+auto-update'},large:{ja:'不動産デベロッパー。NestJS+全国法規制網羅+AIリスク評価',en:'Real estate developer. NestJS+nationwide regulations+AI risk assessment'}},meta:{revenue:'btob',regulation:'high',apiDep:'api_heavy',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
arch_urban_sim:_fpd({name:'都市シミュレーション',nameEn:'Urban Planning Simulation',icon:'🌆',field:'architecture',purpose:'都市開発計画の人流・交通・環境影響をAIシミュレーションで検証',purposeEn:'AI simulation verification of urban development plans covering people flow, traffic & environmental impact',entities:'User, UrbanModel, SimulationModel, SimResult',features:['都市モデル入力','AI人流シミュレーション','交通流解析','環境影響予測','可視化ダッシュボード'],featuresEn:['Urban model input','AI people flow simulation','Traffic flow analysis','Environmental impact prediction','Visualization dashboard'],scaleHint:{solo:{ja:'研究者・コンサルタント。FastAPI+Mesa/SimPy',en:'Researcher/consultant. FastAPI+Mesa/SimPy'},small:{ja:'都市計画コンサル。Supabase+GISデータ統合',en:'Urban planning consultant. Supabase+GIS data integration'},medium:{ja:'地方自治体。Express+デジタルツイン試験版',en:'Local government. Express+digital twin pilot'},large:{ja:'大都市・国土交通省。NestJS+PLATEAU連携+リアルタイムシミュレーション',en:'Major city/national government. NestJS+PLATEAU+real-time simulation'}},meta:{revenue:'btob',regulation:'high',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
arch_realestate:_fpd({name:'不動産価格予測・物件分析',nameEn:'Real Estate Price Predictor',icon:'🏠',field:'architecture',purpose:'立地・設備・市場データをAIが分析し不動産価格を予測・投資判断を支援',purposeEn:'AI analysis of location, amenities & market data to predict real estate prices & support investment decisions',entities:'User, PropertyValuation, Property, Report',features:['物件情報入力','AI価格予測','周辺相場分析','投資シミュレーション','レポート出力'],featuresEn:['Property info input','AI price prediction','Surrounding market analysis','Investment simulation','Report output'],scaleHint:{solo:{ja:'個人投資家。FastAPI+国土数値情報API',en:'Solo investor. FastAPI+geospatial data API'},small:{ja:'不動産会社。Supabase+物件DB+顧客管理',en:'Real estate company. Supabase+property DB+customer management'},medium:{ja:'大手不動産。Express+リアルタイム市場データ+AI予測モデル',en:'Major real estate. Express+real-time market data+AI prediction model'},large:{ja:'REITファンド・金融機関。NestJS+衛星データ+経済指標連携',en:'REIT fund/financial institution. NestJS+satellite data+economic indicators'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'},target:['投資家','不動産仲介業者'],targetEn:['Investors','Real Estate Agents']}),
// ── 🏃 スポーツ・体育系 (sports) ──
sport_performance:_fpd({name:'競技パフォーマンス分析',nameEn:'Athlete Performance Analytics',icon:'🏆',field:'sports',purpose:'アスリートのパフォーマンスデータをAI分析し競技力向上を支援',purposeEn:'AI analysis of athlete performance data to support competitive improvement',entities:'User, Athlete, PerformanceLog, TrainingPlan',features:['パフォーマンスデータ入力','AI分析レポート','弱点特定','トレーニング最適化','競合比較'],featuresEn:['Performance data input','AI analysis report','Weakness identification','Training optimization','Competitor comparison'],scaleHint:{solo:{ja:'個人コーチ・選手。FastAPI+スポーツ分析API',en:'Solo coach/athlete. FastAPI+sports analytics API'},small:{ja:'スポーツクラブ。Supabase+選手管理',en:'Sports club. Supabase+athlete management'},medium:{ja:'プロスポーツチーム。Express+ウェアラブル連携+映像解析',en:'Pro sports team. Express+wearable+video analysis'},large:{ja:'スポーツリーグ・国体組織。NestJS+AI映像解析+ビッグデータ統合',en:'Sports league/national organization. NestJS+AI video analysis+big data'}},meta:{revenue:'btob',regulation:'low',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
sport_injury:_fpd({name:'怪我リスク予測・コンディション管理',nameEn:'Injury Risk & Conditioning',icon:'🩹',field:'sports',purpose:'ウェアラブルデータをAIが分析し怪我リスクを事前予測・コンディション最適化',purposeEn:'AI analysis of wearable data to predict injury risk and optimize athlete conditioning',entities:'User, Athlete, InjuryReport, TrainingPlan',features:['ウェアラブルデータ取込み','AIリスク予測','コンディションアラート','回復プログラム管理','医療スタッフ共有'],featuresEn:['Wearable data ingestion','AI risk prediction','Conditioning alerts','Recovery program management','Medical staff sharing'],scaleHint:{solo:{ja:'フィジカルコーチ個人。FastAPI+Garmin/Apple Health API',en:'Solo physical coach. FastAPI+Garmin/Apple Health API'},small:{ja:'スポーツクラブ。Supabase+選手コンディション管理',en:'Sports club. Supabase+athlete conditioning management'},medium:{ja:'プロチーム。Express+医療記録連携+予測モデル',en:'Pro team. Express+medical records+prediction model'},large:{ja:'Jリーグ・プロ野球球団。NestJS+リアルタイム生体モニタリング+AIコーチ',en:'J-League/pro baseball. NestJS+real-time biometric monitoring+AI coaching'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'edge_cloud'},mobile:'Expo (React Native)'}),
sport_coaching:_fpd({name:'スポーツ指導・コーチング支援',nameEn:'Coaching Support Tool',icon:'🎽',field:'sports',purpose:'コーチの指導計画策定・動作解析・フィードバック提供をAIが支援',purposeEn:'AI-assisted coaching plan creation, motion analysis & feedback delivery for coaches',entities:'User, Athlete, TrainingPlan, Coach, GameEvent',features:['指導計画作成','AI動作解析','フィードバック自動生成','練習メニュー最適化','選手コミュニケーション'],featuresEn:['Coaching plan creation','AI motion analysis','Auto feedback generation','Practice menu optimization','Athlete communication'],scaleHint:{solo:{ja:'個人コーチ。FastAPI+AI動画解析API',en:'Solo coach. FastAPI+AI video analysis API'},small:{ja:'スポーツクラブ・学校部活。Supabase+コーチング記録',en:'Sports club/school club. Supabase+coaching records'},medium:{ja:'プロスポーツ組織。Express+映像解析+データ統合',en:'Pro sports organization. Express+video analysis+data integration'},large:{ja:'ナショナルチーム・大学スポーツ。NestJS+AIビデオコーチング+戦術分析',en:'National team/university sports. NestJS+AI video coaching+tactical analysis'}},meta:{revenue:'btob',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
sport_stadium:_fpd({name:'観客体験・スタジアム運営',nameEn:'Fan Experience & Stadium Ops',icon:'🏟️',field:'sports',purpose:'スタジアムの運営効率化・ファン体験向上・収益最大化をデジタルで実現',purposeEn:'Digital transformation for stadium operations, fan experience improvement & revenue maximization',entities:'User, StadiumEvent, GameEvent, Venue, Ticket',features:['チケット管理','飲食注文システム','混雑可視化','AR観戦体験','ファン会員管理'],featuresEn:['Ticket management','F&B ordering system','Crowd visualization','AR watching experience','Fan membership management'],scaleHint:{solo:{ja:'小規模イベント運営。FastAPI+QRチケット',en:'Small event operations. FastAPI+QR ticketing'},small:{ja:'地方スポーツチーム。Supabase+ファン会員+チケット',en:'Regional sports team. Supabase+fan membership+ticketing'},medium:{ja:'プロスポーツクラブ。Express+入退場管理+POS連携',en:'Pro sports club. Express+entry/exit management+POS'},large:{ja:'Jリーグ・大規模スタジアム。NestJS+スマートスタジアム+AR/VR体験',en:'J-League/large stadium. NestJS+smart stadium+AR/VR experience'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L1',multimodal:'text_image',onDevice:'cloud'},target:['ファン','スタジアム運営者'],targetEn:['Fans','Stadium Operators'],payment:'stripe'}),
// ── 🤝 福祉・介護系 (welfare) ──
welf_care_plan:_fpd({name:'ケアプラン作成支援',nameEn:'Care Plan Assistant',icon:'🤝',field:'welfare',purpose:'ケアマネージャーのケアプラン策定をAIが支援し利用者QOLを向上',purposeEn:'AI support for care managers to create care plans and improve client quality of life',entities:'User, CarePlan, CareActivity, Patient',features:['利用者情報管理','AIケアプラン生成','サービス調整支援','モニタリング記録','給付管理'],featuresEn:['Client info management','AI care plan generation','Service coordination support','Monitoring records','Benefit management'],scaleHint:{solo:{ja:'ケアマネ個人。FastAPI+ケアプランDB',en:'Solo care manager. FastAPI+care plan DB'},small:{ja:'居宅介護支援事業所。Supabase+複数担当者管理',en:'Home care support office. Supabase+multi-staff management'},medium:{ja:'介護グループ。Express+介護保険システム連携',en:'Care group. Express+long-term care insurance system'},large:{ja:'社会福祉法人・行政。NestJS+AI最適サービスマッチング+広域管理',en:'Social welfare corporation/government. NestJS+AI service matching+wide-area management'}},meta:{revenue:'btob',regulation:'strict',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
welf_monitoring:_fpd({name:'認知症早期検知・見守り',nameEn:'Dementia Detection & Monitoring',icon:'👁️',field:'welfare',purpose:'IoTセンサー・会話AIで認知症の早期兆候を検知し家族・医療者に通知',purposeEn:'Detect early dementia signs via IoT sensors & conversational AI to notify family & healthcare providers',entities:'User, CognitionTest, MonitoringAlert, Patient',features:['会話AIテスト','IoTセンサー連携','行動パターン分析','アラート通知','家族向けレポート'],featuresEn:['Conversational AI test','IoT sensor integration','Behavioral pattern analysis','Alert notifications','Family reports'],scaleHint:{solo:{ja:'個人研究者・医師。FastAPI+会話AI+センサーAPI',en:'Solo researcher/physician. FastAPI+conversational AI+sensor API'},small:{ja:'デイサービス・グループホーム。Supabase+センサーハブ',en:'Day service/group home. Supabase+sensor hub'},medium:{ja:'老人保健施設。Express+医療連携+家族ポータル',en:'Long-term care facility. Express+medical integration+family portal'},large:{ja:'医療機関ネットワーク・行政。NestJS+プライバシー保護AI+広域見守り',en:'Medical network/government. NestJS+privacy-preserving AI+wide-area monitoring'}},meta:{revenue:'btob',regulation:'strict',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'edge_cloud'},target:['認知症家族','医療者'],targetEn:['Families with Dementia Patients','Healthcare Providers']}),
welf_employment:_fpd({name:'障害者就労支援・マッチング',nameEn:'Disability Employment Matching',icon:'🌟',field:'welfare',purpose:'障害のある方の特性・スキルと企業ニーズをAIがマッチングし就労定着を支援',purposeEn:'AI matching of disabled persons skills with employer needs to support sustained employment',entities:'User, EmploymentMatch, Job',features:['利用者スキル・特性登録','求人情報管理','AIマッチング','就労定着サポート','企業向けレポート'],featuresEn:['Client skills & traits registration','Job listing management','AI matching','Employment retention support','Employer reports'],scaleHint:{solo:{ja:'就労支援員個人。FastAPI+マッチングロジック',en:'Solo employment support worker. FastAPI+matching logic'},small:{ja:'就労移行支援事業所。Supabase+利用者管理',en:'Employment transition support office. Supabase+client management'},medium:{ja:'社会福祉法人。Express+ハローワーク連携+企業ポータル',en:'Social welfare corporation. Express+Hello Work+employer portal'},large:{ja:'全国福祉機関・厚生労働省。NestJS+全国就労DB+AI雇用予測',en:'Nationwide welfare agency/MHLW. NestJS+national employment DB+AI employment prediction'}},meta:{revenue:'subsidy',regulation:'high',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'},target:['障害者','就労支援員','企業人事'],targetEn:['Persons with Disabilities','Support Workers','HR Staff']}),
welf_record:_fpd({name:'介護記録・業務効率化',nameEn:'Care Record & Workflow',icon:'📓',field:'welfare',purpose:'介護記録の音声入力・AI整理・情報共有で介護士の業務負担を軽減',purposeEn:'Voice input, AI organization & information sharing for care records to reduce caregiver burden',entities:'User, CareRecord, Patient, CareActivity',features:['音声入力記録','AI記録整理・要約','シフト管理','申し送り自動生成','バイタル管理'],featuresEn:['Voice input recording','AI record organization & summary','Shift management','Auto handover generation','Vital signs management'],scaleHint:{solo:{ja:'個人介護士。FastAPI+音声API',en:'Solo caregiver. FastAPI+voice API'},small:{ja:'小規模特養・グループホーム。Supabase+スマホアプリ',en:'Small care home/group home. Supabase+smartphone app'},medium:{ja:'大規模介護施設。Express+介護ソフト連携+電子化',en:'Large care facility. Express+care software+digitalization'},large:{ja:'介護グループ法人。NestJS+多施設統合+AI業務最適化',en:'Care group corporation. NestJS+multi-facility+AI workflow optimization'}},meta:{revenue:'btob',regulation:'strict',apiDep:'hybrid',agentLv:'L2',multimodal:'full_multimodal',onDevice:'edge_cloud'},mobile:'Expo (React Native)'}),
// ── ✈️ 観光・ホスピタリティ系 (tourism) ──
tour_concierge:_fpd({name:'多言語接客・観光案内Bot',nameEn:'Multilingual Concierge Bot',icon:'🗣️',field:'tourism',purpose:'多言語AIコンシェルジュが観光案内・施設情報・予約をワンストップで提供',purposeEn:'Multilingual AI concierge for one-stop tourism info, facility guidance & reservations',entities:'User, Attraction, ConciergeBotSession',features:['多言語チャット対応','観光スポット案内','施設予約連携','地図表示','FAQ自動応答'],featuresEn:['Multilingual chat support','Tourist spot guidance','Facility reservation integration','Map display','FAQ auto-response'],scaleHint:{solo:{ja:'個人観光事業者。FastAPI+GPT-4多言語対応',en:'Solo tourism operator. FastAPI+GPT-4 multilingual'},small:{ja:'観光施設・ホテル。Supabase+多言語コンテンツ管理',en:'Tourism facility/hotel. Supabase+multilingual content management'},medium:{ja:'観光地域DMO。Express+複数施設連携+予約API',en:'Regional DMO. Express+multi-facility+reservation API'},large:{ja:'観光省・大手旅行会社。NestJS+AI音声ガイド+多チャネル対応',en:'Tourism ministry/major travel company. NestJS+AI voice guide+multi-channel'}},meta:{revenue:'btob',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
tour_planner:_fpd({name:'観光プラン自動生成',nameEn:'Travel Plan Generator',icon:'🗺️',field:'tourism',purpose:'旅行者の好み・予算・日程をAIが分析し最適な観光プランを自動生成',purposeEn:'AI analysis of traveler preferences, budget & schedule to auto-generate optimal tourism plans',entities:'User, TravelPlan, Itinerary, Attraction',features:['旅行条件入力','AI観光プラン生成','スポット詳細・評価','ルート最適化','PDF出力・共有'],featuresEn:['Travel condition input','AI tourism plan generation','Spot details & ratings','Route optimization','PDF export & sharing'],scaleHint:{solo:{ja:'旅行ブロガー・個人。FastAPI+観光スポットAPI',en:'Solo travel blogger. FastAPI+tourism spot API'},small:{ja:'旅行代理店。Supabase+顧客プラン管理',en:'Travel agency. Supabase+customer plan management'},medium:{ja:'OTA・DMO。Express+複数APIアグリゲーション+パーソナライズ',en:'OTA/DMO. Express+multi-API aggregation+personalization'},large:{ja:'大手旅行会社。NestJS+AIパーソナライズ+リアルタイム在庫連携',en:'Major travel company. NestJS+AI personalization+real-time inventory'}},meta:{revenue:'subscription',regulation:'low',apiDep:'api_heavy',agentLv:'L2',multimodal:'text_image',onDevice:'cloud'}}),
tour_hotel:_fpd({name:'ホテル・宿泊施設運営最適化',nameEn:'Hotel Operations Optimizer',icon:'🏨',field:'tourism',purpose:'ホテルの稼働率・収益・スタッフ配置をAIがリアルタイム最適化',purposeEn:'AI real-time optimization of hotel occupancy, revenue & staff allocation',entities:'User, Hotel, HotelOperation, Booking, Staff',features:['稼働率ダッシュボード','動的料金設定','スタッフスケジュール最適化','予約管理','顧客フィードバック分析'],featuresEn:['Occupancy dashboard','Dynamic pricing','Staff schedule optimization','Reservation management','Customer feedback analysis'],scaleHint:{solo:{ja:'個人民泊・小宿。FastAPI+予約管理',en:'Solo B&B/small inn. FastAPI+reservation management'},small:{ja:'ブティックホテル。Supabase+チャネルマネージャー連携',en:'Boutique hotel. Supabase+channel manager integration'},medium:{ja:'中規模ホテルチェーン。Express+PMS連携+RevPAR最適化',en:'Mid-size hotel chain. Express+PMS+RevPAR optimization'},large:{ja:'大手ホテルグループ。NestJS+AIイールドマネジメント+全世界展開',en:'Major hotel group. NestJS+AI yield management+global expansion'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
tour_analytics:_fpd({name:'旅行者行動分析・経済効果',nameEn:'Tourism Analytics & Impact',icon:'📊',field:'tourism',purpose:'観光客の行動データを分析し地域観光の経済効果・施策立案を支援',purposeEn:'Analysis of tourist behavior data to support regional tourism economic impact assessment & policy planning',entities:'User, TourismStats, Attraction, Report',features:['来訪者データ収集','行動パターン分析','経済効果試算','観光施策シミュレーション','自治体向けレポート'],featuresEn:['Visitor data collection','Behavior pattern analysis','Economic impact estimation','Tourism policy simulation','Government reports'],scaleHint:{solo:{ja:'観光コンサルタント。FastAPI+統計DB',en:'Tourism consultant. FastAPI+statistics DB'},small:{ja:'観光協会・DMO。Supabase+アンケートデータ統合',en:'Tourism association/DMO. Supabase+survey data integration'},medium:{ja:'地方自治体。Express+IoTセンサー+WIFI探知分析',en:'Local government. Express+IoT sensors+WiFi detection analysis'},large:{ja:'観光庁・広域DMO。NestJS+ビッグデータ+AIトレンド予測',en:'Japan Tourism Agency/wide-area DMO. NestJS+big data+AI trend prediction'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
// ── 🧬 バイオテック・ライフサイエンス系 (biotech) ──
bio_drug_discovery:_fpd({name:'AI創薬・候補化合物探索',nameEn:'AI Drug Discovery & Screening',icon:'🧬',field:'biotech',purpose:'機械学習で化合物ライブラリをスクリーニングし新薬候補を効率的に発見',purposeEn:'Machine learning screening of compound libraries to efficiently discover new drug candidates',entities:'User, Compound, MolecularTarget, BindingResult',features:['化合物ライブラリ管理','AI結合親和性予測','バーチャルスクリーニング','ADMET予測','実験結果管理'],featuresEn:['Compound library management','AI binding affinity prediction','Virtual screening','ADMET prediction','Experimental result management'],scaleHint:{solo:{ja:'個人研究者。FastAPI+RDKit+DeepChem',en:'Solo researcher. FastAPI+RDKit+DeepChem'},small:{ja:'バイオスタートアップ。Supabase+計算化学サーバー',en:'Bio startup. Supabase+computational chemistry server'},medium:{ja:'創薬ベンチャー。Express+HPC+AI創薬モデル',en:'Drug discovery venture. Express+HPC+AI drug discovery model'},large:{ja:'大手製薬会社。NestJS+AlphaFold連携+マルチモーダルAI',en:'Major pharma. NestJS+AlphaFold integration+multimodal AI'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L3',multimodal:'text',onDevice:'cloud'}}),
bio_genomics:_fpd({name:'ゲノム解析・個別化医療',nameEn:'Genomics & Personalized Medicine',icon:'🔬',field:'biotech',purpose:'ゲノム変異データを解析し疾患リスク予測・個別化治療計画を提案',purposeEn:'Genomic variant analysis for disease risk prediction & personalized treatment planning',entities:'User, GenomeSample, VariantCall, GeneticRisk',features:['ゲノムデータアップロード','変異解析','疾患リスク予測','個別化治療提案','レポート生成'],featuresEn:['Genome data upload','Variant analysis','Disease risk prediction','Personalized treatment suggestions','Report generation'],scaleHint:{solo:{ja:'研究者個人。FastAPI+GATK+Hail',en:'Solo researcher. FastAPI+GATK+Hail'},small:{ja:'遺伝子診断クリニック。Supabase+ゲノムDB',en:'Genetic diagnostic clinic. Supabase+genome DB'},medium:{ja:'大学病院ゲノム医療部門。Express+FHIR+電子カルテ連携',en:'University hospital genomics. Express+FHIR+EMR integration'},large:{ja:'ゲノム医療センター・製薬会社。NestJS+コホートDB+AI創薬連携',en:'Genomic medicine center/pharma. NestJS+cohort DB+AI drug discovery'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'on_device'}}),
bio_clinical_trial:_fpd({name:'臨床試験・治験支援',nameEn:'Clinical Trial Support',icon:'🏥',field:'biotech',purpose:'被験者管理・データ収集・有害事象報告・規制対応を統合した治験管理システム',purposeEn:'Integrated clinical trial management for subject management, data collection, AE reporting & regulatory compliance',entities:'User, ClinicalTrial, TrialSubject, AdverseEvent',features:['被験者登録管理','電子症例報告書(eCRF)','有害事象報告','プロトコル管理','21 CFR Part 11準拠'],featuresEn:['Subject registration management','Electronic case report forms (eCRF)','Adverse event reporting','Protocol management','21 CFR Part 11 compliance'],scaleHint:{solo:{ja:'研究者個人。FastAPI+REDCap互換',en:'Solo researcher. FastAPI+REDCap compatible'},small:{ja:'CRO・バイオスタートアップ。Supabase+eConsentシステム',en:'CRO/bio startup. Supabase+eConsent system'},medium:{ja:'製薬会社臨床部門。Express+EDC連携+CTMS',en:'Pharma clinical dept. Express+EDC integration+CTMS'},large:{ja:'多国籍治験・大手CRO。NestJS+ICH-GCP完全準拠+AI AE検知',en:'Multinational trial/major CRO. NestJS+ICH-GCP full compliance+AI AE detection'}},meta:{revenue:'btob',regulation:'strict',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'on_device'}}),
bio_informatics:_fpd({name:'バイオインフォマティクス',nameEn:'Bioinformatics & Protein Analysis',icon:'🧫',field:'biotech',purpose:'オミクスデータ・タンパク質構造をAI解析し生命科学研究を加速',purposeEn:'AI analysis of omics data & protein structures to accelerate life science research',entities:'User, ProteinStructure, OmicsDataset, BioAnalysis',features:['オミクスデータ解析','タンパク質構造予測','パスウェイ解析','データ統合','解析パイプライン管理'],featuresEn:['Omics data analysis','Protein structure prediction','Pathway analysis','Data integration','Analysis pipeline management'],scaleHint:{solo:{ja:'計算生物学者個人。FastAPI+Biopython+AlphaFold API',en:'Solo computational biologist. FastAPI+Biopython+AlphaFold API'},small:{ja:'研究室。Supabase+Galaxy/Snakemake連携',en:'Lab. Supabase+Galaxy/Snakemake integration'},medium:{ja:'研究機関。Express+HPC+大規模データレイク',en:'Research institute. Express+HPC+large-scale data lake'},large:{ja:'製薬会社・ゲノム解析センター。NestJS+AIパイプライン+マルチオミクス統合',en:'Pharma/genomics center. NestJS+AI pipeline+multi-omics integration'}},meta:{revenue:'subsidy',regulation:'moderate',apiDep:'api_heavy',agentLv:'L3',multimodal:'text',onDevice:'cloud'}}),
// ── 🚗 モビリティ・自動運転系 (mobility) ──
mob_autonomous:_fpd({name:'自動運転データ解析',nameEn:'Autonomous Driving Data Analyzer',icon:'🚗',field:'mobility',purpose:'自動運転センサーデータを収集・可視化・AI評価し安全性向上を支援',purposeEn:'Collection, visualization & AI evaluation of autonomous driving sensor data to improve safety',entities:'User, DrivingSession, SimScenario, SafetyEval',features:['走行データ収集・管理','AIシナリオ生成','安全性評価','フリート分析','規制レポート'],featuresEn:['Driving data collection & management','AI scenario generation','Safety evaluation','Fleet analysis','Regulatory reports'],scaleHint:{solo:{ja:'研究者個人。FastAPI+ROSデータ処理',en:'Solo researcher. FastAPI+ROS data processing'},small:{ja:'自動運転スタートアップ。Supabase+シミュレーション管理',en:'Autonomous driving startup. Supabase+simulation management'},medium:{ja:'Tier1サプライヤー。Express+CARLA連携+検証パイプライン',en:'Tier-1 supplier. Express+CARLA integration+validation pipeline'},large:{ja:'自動車OEM。NestJS+大規模データレイク+規制認証支援',en:'Automotive OEM. NestJS+large-scale data lake+regulatory certification support'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L3',multimodal:'text_image',onDevice:'edge_cloud'}}),
mob_traffic:_fpd({name:'交通流最適化・スマート交差点',nameEn:'Traffic Optimization & Smart Intersection',icon:'🚦',field:'mobility',purpose:'AIが信号制御・交通流をリアルタイム最適化し渋滞・事故を削減',purposeEn:'AI real-time optimization of traffic signals & flow to reduce congestion & accidents',entities:'User, TrafficSignal, TrafficSensor, TrafficModel',features:['センサーデータ収集','AI信号制御','渋滞予測・可視化','緊急車両優先制御','ダッシュボード'],featuresEn:['Sensor data collection','AI signal control','Congestion prediction & visualization','Emergency vehicle priority','Dashboard'],scaleHint:{solo:{ja:'研究者個人。FastAPI+SUMO交通シミュレーション',en:'Solo researcher. FastAPI+SUMO traffic simulation'},small:{ja:'地方自治体。Supabase+交通センサー管理',en:'Local government. Supabase+traffic sensor management'},medium:{ja:'都市交通局。Express+信号制御システム+エッジAI',en:'City traffic bureau. Express+signal control system+edge AI'},large:{ja:'大都市・国家レベル。NestJS+Connected Car連携+広域最適化',en:'Major city/national level. NestJS+connected car+wide-area optimization'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L3',multimodal:'text',onDevice:'edge_cloud'}}),
mob_ev_charging:_fpd({name:'EV充電インフラ管理',nameEn:'EV Charging Infrastructure',icon:'⚡',field:'mobility',purpose:'EV充電スタンドネットワークの管理・最適配置・需要予測プラットフォーム',purposeEn:'Management, optimal placement & demand forecasting platform for EV charging station networks',entities:'User, ChargeStation, ChargeSession, EVBattery',features:['充電スタンド管理','リアルタイム稼働状況','需要予測','料金管理','ユーザーアプリ'],featuresEn:['Charge station management','Real-time status','Demand forecasting','Pricing management','User app'],scaleHint:{solo:{ja:'個人充電事業者。FastAPI+OCPP対応',en:'Solo charging operator. FastAPI+OCPP support'},small:{ja:'充電スタートアップ。Supabase+スタンド管理+決済',en:'Charging startup. Supabase+station management+payment'},medium:{ja:'エネルギー会社。Express+スマートグリッド連携+V2G',en:'Energy company. Express+smart grid+V2G'},large:{ja:'大手電力・自動車メーカー。NestJS+全国ネットワーク+AI需給最適化',en:'Major utility/automaker. NestJS+nationwide network+AI supply-demand optimization'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'edge_cloud'}}),
mob_maas:_fpd({name:'MaaSプラットフォーム',nameEn:'MaaS Platform',icon:'🚌',field:'mobility',purpose:'電車・バス・タクシー・シェアサイクルを一元管理するMobility as a Serviceプラットフォーム',purposeEn:'Mobility as a Service platform for unified management of trains, buses, taxis & bike-sharing',entities:'User, TripPlan, TransitOption, MobilityPass',features:['マルチモーダル経路検索','統合チケット発行','サブスクパス管理','リアルタイム運行情報','需要分析'],featuresEn:['Multi-modal route search','Integrated ticketing','Subscription pass management','Real-time transit info','Demand analytics'],scaleHint:{solo:{ja:'研究者・開発者。FastAPI+交通APIアグリゲーション',en:'Researcher/developer. FastAPI+transit API aggregation'},small:{ja:'地方交通事業者。Supabase+バス・タクシー連携',en:'Regional transit operator. Supabase+bus/taxi integration'},medium:{ja:'都市交通局。Express+複数事業者API統合+決済',en:'City transit bureau. Express+multi-operator API+payment'},large:{ja:'国家交通機関・大都市圏。NestJS+リアルタイム全交通統合+AI需要予測',en:'National transport/major metro. NestJS+real-time all-transit integration+AI demand forecasting'}},meta:{revenue:'btob',regulation:'high',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
// ── 🛡️ サイバーセキュリティ系 (cybersecurity) ──
sec_soc:_fpd({name:'AI脅威検知・SOC自動化',nameEn:'AI Threat Detection & SOC Automation',icon:'🛡️',field:'cybersecurity',purpose:'AIがセキュリティイベントをリアルタイム分析し脅威を自動検知・対応',purposeEn:'AI real-time analysis of security events for automatic threat detection & response',entities:'User, ThreatAlert, SecurityIncident, IncidentResponse',features:['SIEMデータ連携','AI脅威スコアリング','自動インシデント対応','MITRE ATT&CK対応','SOCダッシュボード'],featuresEn:['SIEM data integration','AI threat scoring','Auto incident response','MITRE ATT&CK support','SOC dashboard'],scaleHint:{solo:{ja:'セキュリティエンジニア個人。FastAPI+OSquery+Sigma',en:'Solo security engineer. FastAPI+OSquery+Sigma'},small:{ja:'中小企業セキュリティ担当。Supabase+アラート管理',en:'SMB security team. Supabase+alert management'},medium:{ja:'中堅企業SOC。Express+SIEM連携+自動化プレイブック',en:'Mid-size company SOC. Express+SIEM+automation playbook'},large:{ja:'大企業・MSSP。NestJS+AI脅威インテリジェンス+24/7自動対応',en:'Enterprise/MSSP. NestJS+AI threat intelligence+24/7 auto-response'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L3',multimodal:'text',onDevice:'on_device'}}),
sec_pentest:_fpd({name:'脆弱性診断・ペネトレーションテスト',nameEn:'Vulnerability Scan & Pen Testing',icon:'🔓',field:'cybersecurity',purpose:'AIアシスト脆弱性スキャン・ペネトレーションテスト管理・報告書生成ツール',purposeEn:'AI-assisted vulnerability scanning, penetration test management & report generation tool',entities:'User, VulnScan, PenTestReport, RemediationTask',features:['対象指定スキャン','AI脆弱性分類','攻撃シナリオ生成','報告書自動生成','是正タスク管理'],featuresEn:['Target specification scanning','AI vulnerability classification','Attack scenario generation','Auto report generation','Remediation task management'],scaleHint:{solo:{ja:'ペネトレーションテスター個人。FastAPI+Nmap/Burp Suite API',en:'Solo pen tester. FastAPI+Nmap/Burp Suite API'},small:{ja:'セキュリティコンサル会社。Supabase+顧客レポート管理',en:'Security consulting firm. Supabase+client report management'},medium:{ja:'IT企業セキュリティ部門。Express+DAST/SAST連携+DevSecOps',en:'IT company security dept. Express+DAST/SAST+DevSecOps'},large:{ja:'大手セキュリティ企業・CISA登録機関。NestJS+AIレッドチーム+脅威DB',en:'Major security company/CISA registry. NestJS+AI red team+threat DB'}},meta:{revenue:'btob',regulation:'high',apiDep:'api_heavy',agentLv:'L3',multimodal:'text',onDevice:'on_device'}}),
sec_awareness:_fpd({name:'セキュリティ意識向上・フィッシング対策',nameEn:'Security Awareness & Anti-Phishing',icon:'🎓',field:'cybersecurity',purpose:'フィッシング模擬訓練・e-ラーニングでセキュリティ意識を向上させる',purposeEn:'Phishing simulation drills & e-learning to improve security awareness',entities:'User, PhishingCampaign, SecurityTraining',features:['フィッシング模擬メール送信','クリック率分析','e-ラーニングコンテンツ','完了証明書','部門別レポート'],featuresEn:['Phishing simulation emails','Click rate analysis','e-learning content','Completion certificates','Department reports'],scaleHint:{solo:{ja:'セキュリティ担当者個人。FastAPI+メール送信サーバー',en:'Solo security officer. FastAPI+email sending server'},small:{ja:'中小企業情報システム部。Supabase+受講管理',en:'SMB IT dept. Supabase+training management'},medium:{ja:'中堅企業全社展開。Express+LMS連携+自動エスカレーション',en:'Mid-size company-wide. Express+LMS+auto escalation'},large:{ja:'大企業・グループ会社。NestJS+AIパーソナライズ訓練+コンプライアンス管理',en:'Enterprise/group companies. NestJS+AI personalized drills+compliance management'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
sec_compliance:_fpd({name:'セキュリティポリシー・コンプライアンス',nameEn:'Security Policy & Compliance',icon:'📋',field:'cybersecurity',purpose:'ISO27001・SOC2・NIS2など規制対応のポリシー管理・ギャップ分析・監査証跡を自動化',purposeEn:'Automated policy management, gap analysis & audit trail for ISO27001/SOC2/NIS2 compliance',entities:'User, SecurityPolicy, ComplianceGap, AuditLog',features:['ポリシー文書管理','AIギャップ分析','統制マッピング','監査証跡','外部監査支援'],featuresEn:['Policy document management','AI gap analysis','Control mapping','Audit trail','External audit support'],scaleHint:{solo:{ja:'CISO個人・コンサルタント。FastAPI+コンプライアンスDB',en:'Solo CISO/consultant. FastAPI+compliance DB'},small:{ja:'中小企業情報システム部。Supabase+統制管理',en:'SMB IT dept. Supabase+control management'},medium:{ja:'上場企業。Express+ISO27001準拠+自動エビデンス収集',en:'Listed company. Express+ISO27001+auto evidence collection'},large:{ja:'金融機関・大企業。NestJS+GRC統合+AIリスク評価+多規制対応',en:'Financial institution/enterprise. NestJS+GRC integration+AI risk assessment+multi-regulation'}},meta:{revenue:'btob',regulation:'strict',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'on_device'}}),
// ── 💰 フィンテック・暗号資産系 (fintech_field) ──
fin_credit:_fpd({name:'AI与信審査・ローン自動審査',nameEn:'AI Credit Scoring & Auto Loan',icon:'💳',field:'fintech_field',purpose:'AIが申請者の信用情報・行動データを分析し与信審査を自動化・高速化',purposeEn:'AI analysis of applicant credit & behavioral data to automate & accelerate credit screening',entities:'User, CreditApplication, CreditScore, CreditDecision',features:['オンライン申請フォーム','AI与信スコアリング','自動審査判定','説明可能AI出力','審査ワークフロー'],featuresEn:['Online application form','AI credit scoring','Auto screening decision','Explainable AI output','Screening workflow'],scaleHint:{solo:{ja:'フィンテック起業家。FastAPI+信用情報API',en:'Fintech entrepreneur. FastAPI+credit info API'},small:{ja:'消費者金融スタートアップ。Supabase+MLスコアリング',en:'Consumer finance startup. Supabase+ML scoring'},medium:{ja:'地域銀行・クレジット会社。Express+勘定系連携+FSA規制対応',en:'Regional bank/credit company. Express+core banking+FSA compliance'},large:{ja:'大手銀行・保険会社。NestJS+オルタナティブデータ+FSA/FCA承認AIモデル',en:'Major bank/insurer. NestJS+alternative data+FSA/FCA approved AI model'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
fin_aml:_fpd({name:'不正検知・AML',nameEn:'Fraud Detection & AML',icon:'🔍',field:'fintech_field',purpose:'リアルタイム取引モニタリングでマネーロンダリングと不正を自動検知',purposeEn:'Real-time transaction monitoring to automatically detect money laundering & fraud',entities:'User, FraudAlert, SARReport, Account',features:['リアルタイム取引監視','AIリスクスコアリング','SAR報告書自動生成','ケース管理','規制当局対応'],featuresEn:['Real-time transaction monitoring','AI risk scoring','Auto SAR report generation','Case management','Regulatory authority support'],scaleHint:{solo:{ja:'コンプライアンス専門家個人。FastAPI+AMLルールエンジン',en:'Solo compliance expert. FastAPI+AML rule engine'},small:{ja:'フィンテックスタートアップ。Supabase+取引モニタリング',en:'Fintech startup. Supabase+transaction monitoring'},medium:{ja:'地域銀行・決済会社。Express+FATF規制+SAR自動化',en:'Regional bank/payment company. Express+FATF regulations+auto SAR'},large:{ja:'大手金融機関。NestJS+AI Graph Network分析+リアルタイム全取引監視',en:'Major financial institution. NestJS+AI graph network analysis+real-time all-transaction monitoring'}},meta:{revenue:'btob',regulation:'strict',apiDep:'api_heavy',agentLv:'L3',multimodal:'text',onDevice:'on_device'}}),
fin_crypto:_fpd({name:'暗号資産・DeFi分析',nameEn:'Crypto & DeFi Analytics',icon:'₿',field:'fintech_field',purpose:'暗号資産ポートフォリオ管理・DeFiポジション監視・オンチェーン分析を統合',purposeEn:'Integrated crypto portfolio management, DeFi position monitoring & on-chain analytics',entities:'User, CryptoPortfolio, DeFiPosition, SmartContractAudit',features:['ポートフォリオ管理','DeFiポジション追跡','オンチェーン分析','スマートコント監査','税務レポート'],featuresEn:['Portfolio management','DeFi position tracking','On-chain analytics','Smart contract audit','Tax reporting'],scaleHint:{solo:{ja:'個人投資家。FastAPI+CoinGecko/Etherscan API',en:'Solo investor. FastAPI+CoinGecko/Etherscan API'},small:{ja:'暗号資産スタートアップ。Supabase+ウォレット連携',en:'Crypto startup. Supabase+wallet integration'},medium:{ja:'仮想通貨取引所・VCファンド。Express+複数チェーン対応+税務連携',en:'Crypto exchange/VC fund. Express+multi-chain+tax integration'},large:{ja:'大手取引所・機関投資家。NestJS+リアルタイムオンチェーン+AML連携',en:'Major exchange/institutional investor. NestJS+real-time on-chain+AML integration'}},meta:{revenue:'subscription',regulation:'high',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
fin_advisor:_fpd({name:'パーソナルファイナンスAI',nameEn:'Personal Finance AI Advisor',icon:'💰',field:'fintech_field',purpose:'AIが収支・資産・目標を分析しパーソナライズされた資産形成アドバイスを提供',purposeEn:'AI analysis of income, assets & goals to provide personalized wealth building advice',entities:'User, FinancialPlan, InvestmentAdvice, Account',features:['収支自動分類','資産目標設定','AIアドバイス生成','投資シミュレーション','税優遇最適化'],featuresEn:['Auto income/expense categorization','Asset goal setting','AI advice generation','Investment simulation','Tax optimization'],scaleHint:{solo:{ja:'個人FP・投資アドバイザー。FastAPI+金融データAPI',en:'Solo financial planner. FastAPI+financial data API'},small:{ja:'IFA・中小証券会社。Supabase+顧客ポートフォリオ',en:'IFA/small securities firm. Supabase+client portfolio'},medium:{ja:'地域銀行・証券会社。Express+勘定系連携+コンプライアンス',en:'Regional bank/securities. Express+core banking+compliance'},large:{ja:'大手金融グループ。NestJS+ロボアドバイザー+AI規制対応',en:'Major financial group. NestJS+robo-advisor+AI regulatory compliance'}},meta:{revenue:'subscription',regulation:'strict',apiDep:'api_heavy',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
// ── 🏭 製造DX・スマートファクトリー系 (smart_factory) ──
mfg_digital_twin:_fpd({name:'デジタルツイン工場管理',nameEn:'Digital Twin Factory Platform',icon:'🏭',field:'smart_factory',purpose:'物理工場のデジタルツインを構築しリアルタイム監視・シミュレーション・最適化',purposeEn:'Build factory digital twins for real-time monitoring, simulation & optimization',entities:'User, DigitalTwinModel, FactoryLine, Machine',features:['デジタルツイン構築','リアルタイム同期','生産シミュレーション','異常予知','3D可視化'],featuresEn:['Digital twin construction','Real-time synchronization','Production simulation','Anomaly prediction','3D visualization'],scaleHint:{solo:{ja:'工場技術者個人。FastAPI+Unity/ThreeJS',en:'Solo factory engineer. FastAPI+Unity/Three.js'},small:{ja:'中小製造業。Supabase+センサーデータ連携',en:'SMB manufacturing. Supabase+sensor data integration'},medium:{ja:'中堅メーカー。Express+PLCデータ収集+クラウドDT',en:'Mid-size manufacturer. Express+PLC data collection+cloud DT'},large:{ja:'大手製造業。NestJS+エッジAI+全工場デジタルツイン',en:'Major manufacturer. NestJS+edge AI+full factory digital twin'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
mfg_robot:_fpd({name:'自律型ロボット制御',nameEn:'Autonomous Robot Control',icon:'🦾',field:'smart_factory',purpose:'複数ロボットの協調制御・タスク最適割り当て・自律判断システム',purposeEn:'Cooperative control, optimal task assignment & autonomous decision system for multiple robots',entities:'User, RobotTask, RobotConfig, CoordinationPlan',features:['ロボット管理コンソール','タスク割り当て最適化','協調動作計画','障害物回避AI','パフォーマンス分析'],featuresEn:['Robot management console','Task assignment optimization','Cooperative motion planning','Obstacle avoidance AI','Performance analytics'],scaleHint:{solo:{ja:'ロボット研究者。FastAPI+ROS2 API',en:'Solo robotics researcher. FastAPI+ROS2 API'},small:{ja:'物流倉庫スタートアップ。Supabase+AMR管理',en:'Logistics warehouse startup. Supabase+AMR management'},medium:{ja:'製造業ロボット導入。Express+PLC/SCADA連携+エッジAI',en:'Manufacturing robot deployment. Express+PLC/SCADA+edge AI'},large:{ja:'大手メーカー・物流。NestJS+大規模マルチロボット+AIオーケストレーション',en:'Major manufacturer/logistics. NestJS+large-scale multi-robot+AI orchestration'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L3',multimodal:'text',onDevice:'edge_cloud'}}),
mfg_supply_chain:_fpd({name:'サプライチェーン最適化',nameEn:'Supply Chain Optimizer',icon:'🔗',field:'smart_factory',purpose:'AIが需要予測・在庫最適化・調達計画・サプライヤー管理を統合最適化',purposeEn:'AI-integrated demand forecasting, inventory optimization, procurement planning & supplier management',entities:'User, SupplyNode, DemandForecast, ProcurementOrder',features:['需要AIフォーキャスト','在庫最適化','調達自動化','サプライヤー評価','リスク分析'],featuresEn:['AI demand forecasting','Inventory optimization','Procurement automation','Supplier evaluation','Risk analysis'],scaleHint:{solo:{ja:'SCMコンサルタント個人。FastAPI+ERP API',en:'Solo SCM consultant. FastAPI+ERP API'},small:{ja:'中小メーカー。Supabase+在庫・発注管理',en:'SMB manufacturer. Supabase+inventory & order management'},medium:{ja:'中堅メーカー。Express+ERP連携+需要予測ML',en:'Mid-size manufacturer. Express+ERP+demand forecast ML'},large:{ja:'大手製造業・商社。NestJS+グローバルSCN+AI最適化+リスク対応',en:'Major manufacturer/trading. NestJS+global SCN+AI optimization+risk mitigation'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L3',multimodal:'text',onDevice:'cloud'}}),
mfg_inspection:_fpd({name:'製造品質AIインスペクション',nameEn:'Manufacturing Quality AI Inspection',icon:'🔍',field:'smart_factory',purpose:'カメラ・センサーデータをAIがリアルタイム解析し製品不良をインライン検出',purposeEn:'AI real-time analysis of camera & sensor data for inline product defect detection',entities:'User, QualityInspection, DefectRecord, Machine',features:['カメラ映像AI解析','不良品自動検出','不良分類・ヒートマップ','ライン停止アラート','品質レポート'],featuresEn:['Camera video AI analysis','Auto defect detection','Defect classification & heatmap','Line stop alerts','Quality reports'],scaleHint:{solo:{ja:'品質エンジニア個人。FastAPI+YOLOv8ローカル推論',en:'Solo quality engineer. FastAPI+YOLOv8 local inference'},small:{ja:'中小製造業。Supabase+エッジカメラ管理',en:'SMB manufacturing. Supabase+edge camera management'},medium:{ja:'中堅メーカー。Express+MES連携+AIインスペクションライン',en:'Mid-size manufacturer. Express+MES+AI inspection line'},large:{ja:'大手製造業。NestJS+全ライン自動化+AIモデル継続学習',en:'Major manufacturer. NestJS+full line automation+AI continuous learning'}},meta:{revenue:'btob',regulation:'moderate',apiDep:'hybrid',agentLv:'L2',multimodal:'text_image',onDevice:'edge_cloud'}}),
// ── 🔗 テーマ横断 (cross_theme) ──
theme_security:_fpd({name:'セキュリティ・プライバシー対応',nameEn:'Security & Privacy Module',icon:'🔒',field:'cross_theme',purpose:'あらゆるアプリに追加できるZero Trust・GDPR/個人情報保護対応モジュール',purposeEn:'Zero Trust & GDPR/privacy compliance module addable to any application',entities:'User, SecurityPolicy, ComplianceGap, AuditLog',features:['認証強化(MFA/SSO)','RBAC権限管理','監査ログ','GDPR同意管理','脆弱性スキャン連携'],featuresEn:['Auth hardening (MFA/SSO)','RBAC access control','Audit log','GDPR consent management','Vulnerability scan integration'],scaleHint:{solo:{ja:'スタートアップ創業者。FastAPI+JWT+基本セキュリティ',en:'Startup founder. FastAPI+JWT+basic security'},small:{ja:'中小企業SaaS。Supabase+RLS+監査ログ',en:'SMB SaaS. Supabase+RLS+audit log'},medium:{ja:'中堅企業。Express+LDAP/SSO+SIEM連携',en:'Mid-size company. Express+LDAP/SSO+SIEM'},large:{ja:'大企業・金融。NestJS+Zero Trust+SASE+コンプライアンス自動化',en:'Enterprise/financial. NestJS+Zero Trust+SASE+compliance automation'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L1',multimodal:'text',onDevice:'on_device'}}),
theme_a11y:_fpd({name:'アクセシビリティ・多言語対応',nameEn:'Accessibility & Multilingual',icon:'♿',field:'cross_theme',purpose:'WCAG 2.1 AA準拠のアクセシビリティ改善と多言語i18n対応を追加するモジュール',purposeEn:'Module to add WCAG 2.1 AA compliant accessibility improvements & multilingual i18n support',entities:'User, Translation, Setting',features:['WCAG監査ツール','スクリーンリーダー対応','多言語切替','RTL対応','フォントサイズ調整'],featuresEn:['WCAG audit tool','Screen reader support','Multilingual switching','RTL support','Font size adjustment'],scaleHint:{solo:{ja:'個人開発者。FastAPI+axe-core+i18next',en:'Solo developer. FastAPI+axe-core+i18next'},small:{ja:'スタートアップ。Supabase+翻訳管理',en:'Startup. Supabase+translation management'},medium:{ja:'中堅企業グローバル展開。Express+ICU+プロ翻訳ワークフロー',en:'Mid-size global expansion. Express+ICU+professional translation workflow'},large:{ja:'グローバル大企業。NestJS+AI翻訳+アクセシビリティ全自動監査',en:'Global enterprise. NestJS+AI translation+automated accessibility audit'}},meta:{revenue:'subscription',regulation:'moderate',apiDep:'api_heavy',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
theme_sustainability:_fpd({name:'サステナビリティ対応',nameEn:'Sustainability Module',icon:'🌿',field:'cross_theme',purpose:'ビジネス活動のCO2排出量・水使用量・廃棄物をトラッキングするサステナビリティモジュール',purposeEn:'Sustainability module to track CO2 emissions, water usage & waste from business activities',entities:'User, CarbonEmission, ESGReport',features:['排出量自動計算','ESGスコア管理','サプライヤー評価','削減ロードマップ','外部報告書出力'],featuresEn:['Auto emission calculation','ESG score management','Supplier evaluation','Reduction roadmap','External report export'],scaleHint:{solo:{ja:'個人事業主。FastAPI+排出係数DB',en:'Sole proprietor. FastAPI+emission factor DB'},small:{ja:'中小企業CSR担当。Supabase+ESGデータ入力',en:'SMB CSR officer. Supabase+ESG data input'},medium:{ja:'上場企業。Express+ERP連携+GHGプロトコル準拠',en:'Listed company. Express+ERP+GHG protocol'},large:{ja:'大企業・多国籍。NestJS+リアルタイム排出監視+CDP/TCFD報告',en:'Enterprise/multinational. NestJS+real-time emission monitoring+CDP/TCFD reporting'}},meta:{revenue:'btob',regulation:'high',apiDep:'hybrid',agentLv:'L1',multimodal:'text',onDevice:'cloud'}}),
theme_agent:_fpd({name:'AIエージェント統合',nameEn:'AI Agent Integration',icon:'🤖',field:'cross_theme',purpose:'既存アプリにマルチエージェント・ReActループ・ツール呼び出しを追加するモジュール',purposeEn:'Module to add multi-agent, ReAct loops & tool calling to existing applications',entities:'User, AgentConfig, AgentTask, AgentLog, ToolDefinition',features:['エージェント設定管理','タスクキュー','ReActループ実行','ツール定義・登録','実行ログ・デバッグ'],featuresEn:['Agent configuration management','Task queue','ReAct loop execution','Tool definition & registry','Execution log & debugging'],scaleHint:{solo:{ja:'AI開発者個人。FastAPI+LangChain/LlamaIndex',en:'Solo AI developer. FastAPI+LangChain/LlamaIndex'},small:{ja:'AIスタートアップ。Supabase+エージェントDB',en:'AI startup. Supabase+agent DB'},medium:{ja:'エンタープライズAI部門。Express+マルチエージェント+監視',en:'Enterprise AI dept. Express+multi-agent+monitoring'},large:{ja:'大企業AIプラットフォーム。NestJS+分散エージェント+AIオペレーション',en:'Enterprise AI platform. NestJS+distributed agents+AI operations'}},meta:{revenue:'subscription',regulation:'moderate',apiDep:'api_heavy',agentLv:'L3',multimodal:'text',onDevice:'cloud'}}),
theme_analytics:_fpd({name:'共通分析・レポート自動生成',nameEn:'Universal Analytics & Reporting',icon:'📊',field:'cross_theme',purpose:'あらゆるアプリのデータを統合しAIがインサイト・レポートを自動生成する汎用分析モジュール',purposeEn:'Universal analytics module integrating any app data for AI-auto-generated insights & reports',entities:'User, Report, Analytics, Dashboard',features:['データソース連携','AIインサイト生成','カスタムダッシュボード','自動レポート配信','アラート設定'],featuresEn:['Data source integration','AI insight generation','Custom dashboards','Auto report delivery','Alert settings'],scaleHint:{solo:{ja:'個人分析者。FastAPI+Pandas+Plotly',en:'Solo analyst. FastAPI+Pandas+Plotly'},small:{ja:'スタートアップ。Supabase+Metabase連携',en:'Startup. Supabase+Metabase integration'},medium:{ja:'中堅企業。Express+BI+データウェアハウス',en:'Mid-size company. Express+BI+data warehouse'},large:{ja:'大企業。NestJS+Snowflake/BigQuery+AIインサイト自動化',en:'Enterprise. NestJS+Snowflake/BigQuery+AI insight automation'}},meta:{revenue:'subscription',regulation:'low',apiDep:'hybrid',agentLv:'L2',multimodal:'text',onDevice:'cloud'}}),
theme_on_device:_fpd({name:'オンデバイスAI実装',nameEn:'On-Device AI Module',icon:'📱',field:'cross_theme',purpose:'プライバシー保護のためLLM・画像AIをデバイスローカルで実行するモジュール',purposeEn:'Module for running LLM & image AI locally on device for privacy protection',entities:'User, DeviceProfile, ModelDeployment, InferenceLog, EdgeConfig',features:['モデル圧縮・量子化','デバイスプロファイル管理','ローカル推論実行','エッジ同期','消費電力監視'],featuresEn:['Model compression & quantization','Device profile management','Local inference execution','Edge sync','Power consumption monitoring'],scaleHint:{solo:{ja:'モバイル開発者個人。FastAPI+llama.cpp/whisper.cpp',en:'Solo mobile developer. FastAPI+llama.cpp/whisper.cpp'},small:{ja:'スタートアップ。Supabase+WebLLM/ONNX Runtime',en:'Startup. Supabase+WebLLM/ONNX Runtime'},medium:{ja:'IoTデバイスメーカー。Express+TensorFlow Lite+エッジ管理',en:'IoT device maker. Express+TensorFlow Lite+edge management'},large:{ja:'大手デバイスメーカー・通信会社。NestJS+連合学習+多デバイス管理',en:'Major device maker/carrier. NestJS+federated learning+multi-device management'}},meta:{revenue:'btob',regulation:'high',apiDep:'on_premise',agentLv:'L1',multimodal:'text_image',onDevice:'on_device'}}),
};
var FIELD_CAT_MAP={
eng_inspection:'engineering',eng_simulation:'engineering',eng_cad_review:'engineering',eng_quality:'engineering',
sci_data_analysis:'science',sci_paper_summary:'science',sci_math_checker:'science',sci_observation:'science',
agri_diagnosis:'agriculture',agri_forecast:'agriculture',agri_soil:'agriculture',agri_iot:'agriculture',
med_symptom:'medical',med_drug_check:'medical',med_doc_summary:'medical',med_rehab:'medical',
soc_legal_review:'social',soc_market_research:'social',soc_financial_report:'social',soc_sns_analysis:'social',
hum_text_analysis:'humanities',hum_translation:'humanities',hum_style_analysis:'humanities',hum_courseware:'humanities',
edu_learning_plan:'education_field',edu_quiz_gen:'education_field',edu_progress:'education_field',edu_tutor_bot:'education_field',
art_image_gen:'art',art_curator:'art',art_music:'art',art_portfolio:'art',
cross_pm_ai:'interdisciplinary',cross_knowledge:'interdisciplinary',cross_research:'interdisciplinary',cross_lms_community:'interdisciplinary',
env_carbon:'environment',env_energy_monitor:'environment',env_assessment:'environment',env_esg:'environment',
arch_bim_viewer:'architecture',arch_regulation:'architecture',arch_urban_sim:'architecture',arch_realestate:'architecture',
sport_performance:'sports',sport_injury:'sports',sport_coaching:'sports',sport_stadium:'sports',
welf_care_plan:'welfare',welf_monitoring:'welfare',welf_employment:'welfare',welf_record:'welfare',
tour_concierge:'tourism',tour_planner:'tourism',tour_hotel:'tourism',tour_analytics:'tourism',
bio_drug_discovery:'biotech',bio_genomics:'biotech',bio_clinical_trial:'biotech',bio_informatics:'biotech',
mob_autonomous:'mobility',mob_traffic:'mobility',mob_ev_charging:'mobility',mob_maas:'mobility',
sec_soc:'cybersecurity',sec_pentest:'cybersecurity',sec_awareness:'cybersecurity',sec_compliance:'cybersecurity',
fin_credit:'fintech_field',fin_aml:'fintech_field',fin_crypto:'fintech_field',fin_advisor:'fintech_field',
mfg_digital_twin:'smart_factory',mfg_robot:'smart_factory',mfg_supply_chain:'smart_factory',mfg_inspection:'smart_factory',
theme_security:'cross_theme',theme_a11y:'cross_theme',theme_sustainability:'cross_theme',theme_agent:'cross_theme',theme_analytics:'cross_theme',theme_on_device:'cross_theme',
};
var FIELD_CATS_JA=[
{key:'all',label:'すべて',desc:'全82分野別プリセット'},
{key:'engineering',label:'🔧 工学',desc:'設備点検・シミュレーション・CAD・品質管理'},
{key:'science',label:'🔬 理学',desc:'実験解析・論文・数式・観測'},
{key:'agriculture',label:'🌾 農学',desc:'作物診断・気象予測・土壌・農業IoT'},
{key:'medical',label:'🏥 医歯薬',desc:'症状チェック・薬剤・医療文書・リハビリ'},
{key:'social',label:'⚖️ 社会科学',desc:'法律・市場調査・財務・SNS分析'},
{key:'humanities',label:'📚 人文科学',desc:'文献解析・翻訳・文体・教材'},
{key:'education_field',label:'🎓 教育',desc:'学習プラン・問題生成・進捗・チューター'},
{key:'art',label:'🎨 芸術',desc:'画像生成・キュレーター・音楽・ポートフォリオ'},
{key:'interdisciplinary',label:'🌐 融合',desc:'PM-AI・ナレッジ・横断リサーチ・コミュニティLMS'},
{key:'environment',label:'🌱 環境',desc:'カーボン管理・再エネ・環境評価・ESG'},
{key:'architecture',label:'🏗️ 建築',desc:'BIM・法規制・都市シミュ・不動産'},
{key:'sports',label:'🏃 スポーツ',desc:'パフォーマンス・怪我予防・コーチング・スタジアム'},
{key:'welfare',label:'🤝 福祉',desc:'ケアプラン・認知症・就労支援・介護記録'},
{key:'tourism',label:'✈️ 観光',desc:'コンシェルジュ・旅行プラン・ホテル運営・観光分析'},
{key:'biotech',label:'🧬 バイオ',desc:'AI創薬・ゲノム・臨床試験・バイオインフォマティクス'},
{key:'mobility',label:'🚗 モビリティ',desc:'自動運転・交通最適化・EV充電・MaaS'},
{key:'cybersecurity',label:'🛡️ セキュリティ',desc:'SOC自動化・脆弱性診断・意識向上・コンプライアンス'},
{key:'fintech_field',label:'💰 フィンテック',desc:'与信審査・AML・暗号資産・パーソナルファイナンス'},
{key:'smart_factory',label:'🏭 製造DX',desc:'デジタルツイン・ロボット・サプライチェーン・品質AI'},
{key:'cross_theme',label:'🔗 横断テーマ',desc:'セキュリティ・a11y・サステナ・AIエージェント・分析・オンデバイス'},
];
var FIELD_CATS_EN=[
{key:'all',label:'All',desc:'All 82 field presets'},
{key:'engineering',label:'🔧 Engineering',desc:'Inspection, simulation, CAD, quality control'},
{key:'science',label:'🔬 Science',desc:'Experiment analysis, papers, math, observation'},
{key:'agriculture',label:'🌾 Agriculture',desc:'Crop diagnosis, weather forecast, soil, ag IoT'},
{key:'medical',label:'🏥 Medical',desc:'Symptom check, drug interaction, medical docs, rehab'},
{key:'social',label:'⚖️ Social Science',desc:'Legal, market research, financial reports, SNS analysis'},
{key:'humanities',label:'📚 Humanities',desc:'Literature analysis, translation, style, courseware'},
{key:'education_field',label:'🎓 Education',desc:'Learning plans, quiz gen, progress, tutoring bot'},
{key:'art',label:'🎨 Art & Design',desc:'Image gen, curator, music, portfolio'},
{key:'interdisciplinary',label:'🌐 Interdisciplinary',desc:'PM AI, knowledge base, cross-research, community LMS'},
{key:'environment',label:'🌱 Environment',desc:'Carbon management, renewables, env assessment, ESG'},
{key:'architecture',label:'🏗️ Architecture',desc:'BIM, zoning, urban sim, real estate'},
{key:'sports',label:'🏃 Sports',desc:'Performance analytics, injury risk, coaching, stadium ops'},
{key:'welfare',label:'🤝 Welfare',desc:'Care plans, dementia monitoring, employment, care records'},
{key:'tourism',label:'✈️ Tourism',desc:'Concierge, travel plans, hotel ops, tourism analytics'},
{key:'biotech',label:'🧬 Biotech',desc:'AI drug discovery, genomics, clinical trials, bioinformatics'},
{key:'mobility',label:'🚗 Mobility',desc:'Autonomous driving, traffic optimization, EV charging, MaaS'},
{key:'cybersecurity',label:'🛡️ Cybersecurity',desc:'SOC automation, pen testing, awareness, compliance'},
{key:'fintech_field',label:'💰 Fintech',desc:'Credit scoring, AML, crypto analytics, personal finance AI'},
{key:'smart_factory',label:'🏭 Smart Factory',desc:'Digital twin, robots, supply chain, quality AI inspection'},
{key:'cross_theme',label:'🔗 Cross-Theme',desc:'Security, a11y, sustainability, AI agent, analytics, on-device'},
];
var FIELD_TREND={
engineering:4,science:3,agriculture:4,medical:5,
social:3,humanities:3,education_field:5,art:4,
interdisciplinary:4,environment:5,architecture:4,
sports:3,welfare:5,tourism:4,biotech:5,
mobility:5,cybersecurity:5,fintech_field:4,smart_factory:5,
cross_theme:4
};
/* KPI chip builder — purpose-linked dynamic chips */
function _kpiChips(ja,lv){
const p=(S.answers.purpose||'').toLowerCase();
// Common KPIs (always shown)
const common=ja
?['📈 月間1000ユーザー','📈 DAU 100+','😊 NPS 50以上','⚡ レスポンス200ms以内','⚡ 稼働率99.9%+']
:['📈 1,000 MAU','📈 100+ DAU','😊 NPS 50+','⚡ <200ms response','⚡ 99.9%+ uptime'];
// Purpose-specific KPI pools
const pools=ja?{
saas:['💰 月売上10万円(MRR)','🔄 月間チャーン5%以下','🔄 DAU/MAU比率30%+','💰 LTV5万円','🔄 機能利用率80%+','💰 ARPU500円'],
ec:['💰 GMV月100万円','💰 CV率3%+','🏪 カート放棄30%以下','🏪 客単価3000円','🏪 取引完了率95%+','😊 レビュー評価4.5★+'],
marketplace:['💰 GMV月100万円','💰 テイクレート10%','🏪 月500新規出品','🏪 取引完了率95%+','👥 需給バランス比率'],
education:['📚 コース完了率80%+','📚 クイズ合格率70%+','📚 視聴完了率70%+','📚 月100修了証発行','🔄 7日連続利用率50%+','🔄 セッション時間5分+'],
community:['👥 日次投稿50件+','👥 メンバー月10%増','👥 UGC率30%+','👥 アクティブグループ70%+','🔄 DAU/MAU比率30%+'],
content:['📚 月30記事公開','📚 月間5000PV','📚 開封率30%+','📚 CTR 5%+','🔄 セッション時間5分+','💰 購読者月10%増'],
analytics:['🏢 レポート作成1分以内','🏢 日次100万件処理','😊 CSAT 4.5/5','⚡ エラー率0.1%以下'],
automation:['🤖 手動作業70%削減','🤖 処理時間50%短縮','⚡ エラー率0.1%以下','⚡ API成功率99.5%+','🏢 タスク完了率90%+'],
ai:['🤖 AI正答率90%+','🤖 有人対応20%以下','🤖 生成品質スコア4/5','🤖 プロンプト成功率85%+','😊 CSAT 4.5/5'],
portfolio:['📈 月間5000PV','📚 CTR 5%+','⚡ LCP 2.5秒以内','😊 問合せ率3%+'],
booking:['🏪 予約転換率60%+','🏪 リソース稼働率80%+','🏪 ノーショー5%以下','😊 CSAT 4.5/5','💰 月間予約500件+'],
fintech:['💰 月間取引高1000万円','🏢 不正検知率99%+','⚡ 決済成功率99.5%+','😊 CSAT 4.5/5'],
hr:['🏢 採用日数30日以内','🏢 オファー承諾率80%+','🏢 オンボーディング完了率95%+','😊 従業員満足度4/5'],
health:['🔄 7日連続利用率50%+','🔄 目標達成率60%+','📚 データ記録率80%+','😊 ユーザー継続率70%+'],
iot:['⚡ デバイス稼働率95%+','⚡ データ遅延1秒以内','⚡ アラート応答5分以内','🏢 デバイス接続1000台+'],
event:['🏪 チケット販売率80%+','😊 参加者満足度4.5/5','👥 リピート参加率40%+','💰 イベント収益目標達成'],
gamify:['🔄 バッジ獲得率60%+','🔄 デイリークエスト完了率50%+','🔄 リーダーボード参加率30%+','📈 エンゲージメント率40%+'],
collab:['👥 同時編集5人+','👥 編集頻度日次10回+','🔄 機能利用率80%+','😊 NPS 50以上'],
devtool:['📈 API呼出月10万回','📈 開発者登録月100人+','📚 ドキュメントカバレッジ90%+','⚡ API成功率99.5%+'],
creator:['💰 ファンLTV1万円','💰 コンテンツ収益化率20%+','👥 ファンエンゲージメント率30%+','📈 購読者月10%増'],
newsletter:['📚 開封率30%+','📚 CTR 5%+','💰 有料購読者月5%増','📈 購読者月10%増'],
chatbot:['🤖 自動解決率80%+','🤖 有人対応20%以下','😊 CSAT 4.5/5','⚡ 応答時間2秒以内'],
pwa:['📈 インストール率10%+','📈 オフライン利用率20%+','🔄 プッシュ通知開封率30%+','⚡ LCP 2.5秒以内'],
tool:['🏢 タスク完了率90%+','🏢 処理時間50%短縮','😊 CSAT 4.5/5','⚡ 稼働率99.9%+','🔄 機能利用率80%+']
}:{
saas:['💰 $1K MRR','🔄 <5% monthly churn','🔄 30%+ DAU/MAU','💰 $500 LTV','🔄 80%+ feature adoption','💰 $5 ARPU'],
ec:['💰 $10K GMV','💰 3%+ conversion','🏪 <30% cart abandon','🏪 $30 AOV','🏪 95%+ fulfillment','😊 4.5★+ reviews'],
marketplace:['💰 $10K GMV','💰 10% take rate','🏪 500 listings/mo','🏪 95%+ fulfillment','👥 Supply/demand balance'],
education:['📚 80%+ completion','📚 70%+ quiz pass','📚 70%+ watch-through','📚 100 certs/month','🔄 50%+ 7-day streak','🔄 5min+ session'],
community:['👥 50+ posts/day','👥 10%+ member growth/mo','👥 30%+ UGC ratio','👥 70%+ active groups','🔄 30%+ DAU/MAU'],
content:['📚 30 posts/month','📚 5,000 PV/month','📚 30%+ open rate','📚 5%+ CTR','🔄 5min+ session','💰 10%+ subscriber growth/mo'],
analytics:['🏢 Reports in <1min','🏢 1M records/day','😊 CSAT 4.5/5','⚡ <0.1% error rate'],
automation:['🤖 70% manual reduction','🤖 50% time saved','⚡ <0.1% error rate','⚡ 99.5%+ API success','🏢 90%+ task completion'],
ai:['🤖 90%+ AI accuracy','🤖 <20% human handoff','🤖 4/5 quality score','🤖 85%+ prompt success','😊 CSAT 4.5/5'],
portfolio:['📈 5,000 PV/month','📚 5%+ CTR','⚡ LCP <2.5s','😊 3%+ inquiry rate'],
booking:['🏪 60%+ booking conv.','🏪 80%+ utilization','🏪 <5% no-show','😊 CSAT 4.5/5','💰 500+ bookings/mo'],
fintech:['💰 $100K transactions/mo','🏢 99%+ fraud detection','⚡ 99.5%+ payment success','😊 CSAT 4.5/5'],
hr:['🏢 <30 days time-to-hire','🏢 80%+ offer acceptance','🏢 95%+ onboarding','😊 4/5 employee satisfaction'],
health:['🔄 50%+ 7-day streak','🔄 60%+ goal achievement','📚 80%+ data logging','😊 70%+ user retention'],
iot:['⚡ 95%+ device uptime','⚡ <1s data latency','⚡ <5min alert response','🏢 1,000+ devices'],
event:['🏪 80%+ sell-through','😊 4.5/5 attendee satisfaction','👥 40%+ repeat attendance','💰 Revenue target met'],
gamify:['🔄 60%+ badge earn rate','🔄 50%+ daily quest','🔄 30%+ leaderboard participation','📈 40%+ engagement rate'],
collab:['👥 5+ concurrent editors','👥 10+ daily edits','🔄 80%+ feature adoption','😊 NPS 50+'],
devtool:['📈 100K API calls/mo','📈 100+ devs/month','📚 90%+ docs coverage','⚡ 99.5%+ API success'],
creator:['💰 $100 fan LTV','💰 20%+ monetization rate','👥 30%+ fan engagement','📈 10%+ subscriber growth/mo'],
newsletter:['📚 30%+ open rate','📚 5%+ CTR','💰 5%+ paid subscriber growth/mo','📈 10%+ subscriber growth/mo'],
chatbot:['🤖 80%+ auto-resolution','🤖 <20% human handoff','😊 CSAT 4.5/5','⚡ <2s response time'],
pwa:['📈 10%+ install rate','📈 20%+ offline usage','🔄 30%+ push open rate','⚡ LCP <2.5s'],
tool:['🏢 90%+ task completion','🏢 50% time saved','😊 CSAT 4.5/5','⚡ 99.9%+ uptime','🔄 80%+ feature adoption']
};
// Field preset category KPI override (checked before purpose-text regex)
if((S.preset||'').slice(0,6)==='field:'&&typeof PR_FIELD!=='undefined'){
var _fpKi=PR_FIELD[S.preset.slice(6)];var _fpCK=_fpKi?(_fpKi.field||''):'';
var _fpKP=ja?{engineering:['🏭 ライン稼働率95%+','⚡ 不良品率0.1%以下','⚡ アラート5分以内'],science:['📚 再現率95%+','📚 分析精度90%+','⚡ 処理速度50%向上'],agriculture:['🌾 収穫量15%増','🌾 農薬20%削減','⚡ 記録率80%+'],medical:['😊 医師効率30%向上','⚡ 誤診防止95%+','😊 患者満足度4.5/5'],social:['📈 月間5万リーチ','💰 エンゲージメント5%+','📈 シェア3%+'],humanities:['📚 処理速度50%向上','📚 検索精度90%+'],education_field:['📚 完了率80%+','📚 合格率75%+','🔄 7日継続50%+'],art:['💰 月10件販売','💰 収益20%増','👥 エンゲージメント30%+'],interdisciplinary:['🏢 完了率90%+','📈 効率50%向上'],environment:['🌿 CO2 10%削減','🌿 ESGスコア向上','⚡ エネルギー効率15%+'],architecture:['🏗️ 工数30%削減','😊 顧客満足度4.5/5'],sports:['🏆 パフォーマンス10%向上','🏆 怪我20%削減','🔄 継続率80%+'],welfare:['😊 負担30%削減','😊 満足度4.5/5','📚 記録精度95%+'],tourism:['🏪 予約率60%+','😊 満足度4.5/5','💰 客単価30%増'],biotech:['💊 候補絞り込み50%向上','⚡ 分析精度95%+'],mobility:['🚗 運行効率20%向上','⚡ 遅延5%以下','🚗 満足度4.5/5'],cybersecurity:['🔒 検知率99%+','🔒 対応30分以内','⚡ 誤検知1%以下'],fintech_field:['💰 速度50%向上','🏢 違反ゼロ','⚡ 稼働99.99%+'],smart_factory:['🏭 生産20%向上','⚡ 稼働率95%+','🏭 不良0.5%以下'],cross_theme:['🏢 効率40%向上','📈 導入率90%+','😊 継続率80%+']}:{engineering:['🏭 95%+ line utilization','⚡ <0.1% defect rate','⚡ <5min alert'],science:['📚 95%+ reproducibility','📚 90%+ accuracy','⚡ 50% faster'],agriculture:['🌾 15% yield increase','🌾 20% less pesticide','⚡ 80%+ logging'],medical:['😊 30% doctor efficiency','⚡ 95%+ error prevention','😊 4.5/5 satisfaction'],social:['📈 50K reach/month','💰 5%+ engagement','📈 3%+ share'],humanities:['📚 50% faster processing','📚 90%+ search accuracy'],education_field:['📚 80%+ completion','📚 75%+ pass rate','🔄 50%+ streak'],art:['💰 10 sales/month','💰 20%+ revenue','👥 30%+ engagement'],interdisciplinary:['🏢 90%+ completion','📈 50% efficiency gain'],environment:['🌿 10% CO2 reduction','🌿 Better ESG score','⚡ 15% energy saving'],architecture:['🏗️ 30% time saved','😊 4.5/5 client satisfaction'],sports:['🏆 10% performance gain','🏆 20% injury reduction','🔄 80%+ adherence'],welfare:['😊 30% burden reduction','😊 4.5/5 satisfaction','📚 95%+ accuracy'],tourism:['🏪 60%+ booking rate','😊 4.5/5 satisfaction','💰 30% more spending'],biotech:['💊 50% faster screening','⚡ 95%+ accuracy'],mobility:['🚗 20% efficiency','⚡ <5% delay','🚗 4.5/5 satisfaction'],cybersecurity:['🔒 99%+ detection','🔒 <30min response','⚡ <1% false positives'],fintech_field:['💰 50% faster transactions','🏢 zero violations','⚡ 99.99%+ uptime'],smart_factory:['🏭 20% production gain','⚡ 95%+ uptime','🏭 <0.5% defects'],cross_theme:['🏢 40% efficiency','📈 90%+ adoption','😊 80%+ retention']};
if(_fpCK&&_fpKP[_fpCK]){var _fks=new Set();var _fka=[...common,..._fpKP[_fpCK]].filter(c=>{if(_fks.has(c))return false;_fks.add(c);return true;});if(lv==='beginner')return _fka.slice(0,6);if(lv==='pro')return _fka;var _fkc=S.skillLv===2?8:10;return _fka.slice(0,_fkc);}
}
// Detect purpose category from answer
const detect=[
[/SaaS|サブスク|subscription/i,'saas'],
[/EC|Eコマース|E-Commerce|ショップ|shop|commerce/i,'ec'],
[/マーケットプレイス|marketplace|売り手.*買い手|buyer.*seller/i,'marketplace'],
[/教育|学習|Education|Learning|LMS|コース|course/i,'education'],
[/コミュニティ|community|フォーラム|forum|交流/i,'community'],
[/コンテンツ|content|メディア|media|ブログ|blog|ニュース|news|配信/i,'content'],
[/IoT|デバイス|device|センサー|sensor|監視|monitor/i,'iot'],
[/分析|analytics|可視化|visualiz|ダッシュボード|dashboard|データ分析|data.*analy/i,'analytics'],
[/チャットボット|chatbot|FAQ|カスタマー.*サポート|customer.*support/i,'chatbot'],
[/AI|人工知能|エージェント|agent|対話型/i,'ai'],
[/自動化|automat|ワークフロー|workflow|RPA|iPaaS/i,'automation'],
[/ポートフォリオ|portfolio|実績|showcase/i,'portfolio'],
[/予約|booking|スケジュール|schedule|予約/i,'booking'],
[/金融|fintech|決済|payment|家計|budget|請求|invoice/i,'fintech'],
[/HR|採用|recruit|人事|hiring/i,'hr'],
[/健康|health|フィットネス|fitness|ウェルネス|wellness/i,'health'],
[/イベント|event|チケット|ticket|開催/i,'event'],
[/ゲーミ|gamif|ゲーム|game|ポイント|point|バッジ|badge/i,'gamify'],
[/コラボ|collab|共同|同時編集|realtime/i,'collab'],
[/開発者|developer|devtool|API|ユーティリティ|utility/i,'devtool'],
[/クリエイター|creator|ファン|fan|コンテンツ販売/i,'creator'],
[/ニュースレター|newsletter|メール配信|mail/i,'newsletter'],
[/PWA|プログレッシブ|モバイルファースト|mobile.?first/i,'pwa'],
[/業務|business|効率化|ツール|tool/i,'tool'],
];
let matched=[];
for(const[rx,key]of detect){if(rx.test(p)&&pools[key]){matched.push(...pools[key]);break;}}
// If no match, add generic SaaS+tool mix
if(!matched.length){
const fallback=pools[ja?'saas':'saas'];
matched.push(...fallback.slice(0,3));
}
// Deduplicate
const seen=new Set();const all=[...common,...matched].filter(c=>{if(seen.has(c))return false;seen.add(c);return true;});
// Skill-level trim
if(lv==='beginner')return all.slice(0,6);
if(lv==='pro')return all;
// Lv2 (Getting Started) gets 8 chips as a stepping-stone between beginner(6) and intermediate(10)
var kpiCount=S.skillLv===2?8:10;
return all.slice(0,kpiCount);
}
function _uniq(a){var s=new Set();return a.filter(v=>{if(s.has(v))return false;s.add(v);return true;});}
function getQ(){
const lv=S.skill;
const ja=S.lang==='ja';
var _qfpk=(S.preset||'').slice(0,6)==='field:'?S.preset.slice(6):'';
var _qfpo=(_qfpk&&typeof PR_FIELD!=='undefined')?PR_FIELD[_qfpk]:null;
var _qfpc=(_qfpo&&typeof FIELD_CAT_DEFAULTS!=='undefined')?FIELD_CAT_DEFAULTS[_qfpo.field]:null;
function _fpPre(qId){
if(!_qfpo)return [];
var _ta=function(v){return Array.isArray(v)?v:String(v||'').split(',').map(function(s){return s.trim();}).filter(Boolean);};
if(qId==='target'){var _t=((!ja)&&_qfpo.targetEn)||_qfpo.target||((!ja)&&_qfpc&&_qfpc.targetEn)||(_qfpc&&_qfpc.target)||[];return _ta(_t);}
if(qId==='mvp_features'){var _f=((!ja)&&_qfpo.featuresEn)||_qfpo.features||[];return _ta(_f);}
if(qId==='screens'){var _s=((!ja)&&_qfpo.screensEn)||_qfpo.screens||((!ja)&&_qfpc&&_qfpc.screensEn)||(_qfpc&&_qfpc.screens)||[];return _ta(_s);}
if(qId==='data_entities'){return _ta(_qfpo.entities||'');}
return [];
}
return {
1:{name:ja?'プロジェクト定義':'Project Definition',questions:[
{id:'purpose',q:ja?'プロジェクトの目的':'Project Purpose',type:'chip-text',chips:ja?['業務効率化ツール','コンテンツ配信','教育・学習支援','EC・マーケットプレイス','コミュニティ構築','ポートフォリオ','データ分析・可視化','自動化ツール','SaaS']:['Business Tool','Content Delivery','Education','E-Commerce','Community','Portfolio','Data Analytics','Automation','SaaS'],placeholder:ja?'自由入力…':'Type freely...',tip:ja?'「誰が何をできるようになるか」を明確に':'Clarify "who can do what"',help:'purpose'},
{id:'target',q:ja?'ターゲットユーザー':'Target Users',type:'chip-multi',chips:_uniq([..._fpPre('target'),...(ja?['学生','フリーランス','スタートアップ','中小企業','エンジニア','デザイナー','教育者','一般消費者','管理者','経営者']:['Students','Freelancers','Startups','SMBs','Engineers','Designers','Educators','Consumers','Admins','Executives'])]),placeholder:ja?'追加…':'Add...',tip:ja?'具体的なペルソナをイメージしましょう':'Imagine a specific persona',help:'target'},
{id:'success',q:ja?'成功指標（KPI）':'Success Metrics (KPI)',type:'chip-multi',chips:_kpiChips(ja,lv),placeholder:ja?'追加…':'Add...',tip:ja?'3〜5つに絞りましょう（プロジェクト種別に応じた指標を提案中）':'Pick 3-5 (suggestions based on your project type)',help:'success'},
{id:'scope_out',q:ja?'スコープ外（やらないこと）':'Out of Scope',type:'chip-multi',chips:ja?['チャット機能','動画配信','決済機能','多言語対応','ネイティブアプリ','AI機能','管理画面','API公開','SNS連携','プッシュ通知']:['Chat','Video streaming','Payments','i18n','Native app','AI features','Admin panel','Public API','Social media','Push notifications'],placeholder:ja?'追加…':'Add...',tip:ja?'スコープを絞ることがMVP完成の鍵':'Scoping down is key to MVP success',help:'scope_out'},
{id:'deadline',q:ja?'リリース目標':'Release Target',type:'options',options:[{label:ja?'2週間':'2 weeks',desc:ja?'超MVP':'Ultra MVP'},{label:ja?'1ヶ月':'1 month',desc:ja?'基本機能':'Basic features'},{label:ja?'3ヶ月':'3 months',desc:ja?'本格MVP':'Full MVP'},{label:ja?'6ヶ月':'6 months',desc:'v1.0'}],tip:ja?'MVPを優先しましょう':'Prioritize MVP',help:'deadline'},
]},
2:{name:ja?'技術選定':'Tech Stack',questions:[
{id:'frontend',q:ja?'フロントエンド':'Frontend',type:'options',options:[{label:'React + Next.js',desc:ja?'SSR/SSG/ISR — 求人最多・エコシステム最大':'SSR/SSG/ISR — most jobs & largest ecosystem'},{label:'React (Vite SPA)',desc:ja?'CSR高速 — 管理画面やSaaS向け':'Fast CSR — for admin panels & SaaS'},...(lv!=='beginner'?[{label:'Vue 3 + Nuxt',desc:ja?'学習容易・日本コミュニティ充実':'Easy to learn, strong JP community'},{label:'Svelte + SvelteKit',desc:ja?'最小バンドル・高速':'Smallest bundle, fast'},
{label:'Astro',desc:ja?'コンテンツサイト・静的サイト':'Content & static sites'}]:[]),...(lv==='pro'?[{label:'Angular',desc:ja?'エンタープライズ大規模':'Enterprise scale'},{label:'React Router v7 (Remix)',desc:ja?'Web標準・フレームワーク統合':'Web standards, framework-unified'}]:[])],tip:ja?'知っている技術が最速です':'Pick what you know',help:'frontend'},
{id:'css_fw',q:ja?'CSSフレームワーク':'CSS Framework',type:'options',help:'css_fw',options:[{label:'Tailwind CSS',desc:ja?'2026年シェア1位 — ユーティリティファースト':'#1 in 2026 — utility-first'},{label:'shadcn/ui + Tailwind',desc:ja?'Radix UI + Tailwind — コピペUI':'Radix UI + Tailwind — copy-paste UI'},{label:'Bootstrap',desc:ja?'レガシー互換・クラス名でスタイル':'Legacy compat, class-based styling'},...(lv!=='beginner'?[{label:'CSS Modules',desc:ja?'スコープ付きCSS':'Scoped CSS'},
{label:'Vanilla CSS',desc:ja?'フレームワーク不使用':'No framework'}]:[])],tip:ja?'Tailwind CSSが2026年のデファクト':'Tailwind CSS is the 2026 standard'},
{id:'backend',q:ja?'バックエンド/DB':'Backend/DB',type:'options',options:[{label:'Firebase',desc:ja?'Google BaaS — 最速プロトタイプ':'Google BaaS — fastest prototype'},{label:'Supabase',desc:ja?'OSS PostgreSQL BaaS — 急成長中':'OSS PostgreSQL BaaS — rapid growth'},...(lv!=='beginner'?[{label:'Node.js + Express',desc:ja?'実績豊富・エコシステム最大・Express 5.x':'Most proven, largest ecosystem, Express 5.x'},{label:'Node.js + Fastify',desc:ja?'Express 5x高速':'5x faster than Express'},
{label:'Node.js + NestJS',desc:ja?'DI・TypeScript完全対応':'DI, full TypeScript support'}]:[]),...(lv==='pro'?[{label:'Python + FastAPI',desc:ja?'AI/ML連携最適・非同期':'Best for AI/ML, async'},{label:'Python + Django',desc:ja?'フルスタック・管理画面付き':'Full-stack with admin panel'},{label:'Java + Spring Boot',desc:ja?'金融・エンタープライズ':'Finance & enterprise'},{label:'Go + Gin',desc:ja?'高パフォーマンス・マイクロサービス':'High-perf microservices'},
{label:'Hono',desc:ja?'Edge Runtime・超軽量':'Edge Runtime, ultra-light'}]:[]),{label:ja?'なし（静的サイト）':'None (static site)',desc:ja?'バックエンド不要':'No backend needed'}],tip:ja?'BaaSならコード不要で開始可能':'BaaS needs no server code',help:'backend'},
{id:'database',q:ja?'データベース':'Database',type:'options',help:'database',condition:{backend:v=>!/なし|None|static/i.test(v)},options:[{label:'PostgreSQL',desc:ja?'2026年SQL推奨1位 — 堅牢・拡張性':'#1 SQL in 2026 — robust & extensible'},{label:'Supabase (PostgreSQL)',desc:ja?'BaaS + リアルタイム + Auth付き':'BaaS + realtime + Auth included'},{label:'Firebase Firestore',desc:ja?'NoSQL BaaS — スキーマレス':'NoSQL BaaS — schemaless'},...(lv!=='beginner'?[{label:'MongoDB',desc:ja?'ドキュメントDB — 柔軟スキーマ':'Document DB — flexible schema'},
{label:'MySQL',desc:ja?'実績豊富 — WordPress/Laravel':'Proven track record — WordPress/Laravel'}]:[]),...(lv==='pro'?[{label:'SQLite',desc:ja?'組込み/Edge — Turso互換':'Embedded/Edge — Turso compatible'},{label:'Redis',desc:ja?'キャッシュ/セッション/Pub-Sub':'Cache/Session/Pub-Sub'},{label:'Neon',desc:ja?'サーバーレスPostgreSQL':'Serverless PostgreSQL'}]:[])],tip:ja?'迷ったらPostgreSQL':'When in doubt, PostgreSQL'},
{id:'orm',q:ja?'ORM':'ORM',type:'options',help:'orm',condition:{backend:v=>!/Firebase|Supabase|Convex|なし|None|static/i.test(v)},options:[{label:'Prisma',desc:ja?'2026年Node.js ORM 1位 — 型安全・Studio付き':'#1 Node.js ORM 2026 — type-safe + Studio'},{label:'Drizzle',desc:ja?'軽量・SQLライク — TypeScript完全対応':'Lightweight SQL-like — full TypeScript'},...(lv!=='beginner'?[{label:'TypeORM',desc:ja?'デコレータベース — NestJS親和':'Decorator-based — NestJS compatible'}]:[]),...(lv==='pro'?[{label:'SQLAlchemy (Python)',desc:ja?'Python標準ORM':'Python standard ORM'},
{label:'Kysely',desc:ja?'SQL型安全ビルダー':'Type-safe SQL builder'}]:[]),{label:ja?'なし / BaaS使用':'None / Using BaaS',desc:ja?'Firebase/Supabase利用時':'When using Firebase/Supabase'}],tip:ja?'PrismaのStudioはDB管理に便利':'Prisma Studio is great for DB management'},
{id:'dev_env_type',q:ja?'開発環境タイプ':'Dev Environment Type',type:'options',
condition:{backend:v=>/Supabase|Firebase|Convex/i.test(v)},
options:[
{label:ja?'ローカル開発':'Local Development',desc:ja?'ローカルエミュレーターを自動起動':'Auto-start local emulators'},
{label:ja?'クラウド接続':'Cloud Direct',desc:ja?'リモートBaaSに直接接続（エミュレーターなし）':'Connect to remote BaaS (no emulators)'},
{label:ja?'ハイブリッド':'Hybrid',desc:ja?'両方の設定を生成、手動切替':'Generate both, switch manually'}
],
tip:ja?'ローカル開発はオフラインでも動作可能':'Local development works offline too',
help:'dev_env_type'},
{id:'mobile',q:ja?'モバイル対応 ★v8':'Mobile Support ★v8',type:'options',help:'mobile',options:[{label:'Expo (React Native)',desc:ja?'推奨 — SDK55・EAS Build/Submit・OTA・React共有80%+':'Recommended — SDK55, EAS Build/Submit, OTA, 80%+ React reuse'},...(lv!=='beginner'?[{label:'Flutter',desc:ja?'Dart製・ピクセルパーフェクトUI・マルチプラットフォーム':'Dart, pixel-perfect UI, multi-platform'},
{label:'React Native (bare)',desc:ja?'ネイティブモジュール完全制御':'Full native module control'}]:[]),...(lv==='pro'?[{label:ja?'Swift/Kotlin (ネイティブ)':'Swift/Kotlin (Native)',desc:ja?'最高パフォーマンス・プラットフォーム固有':'Best performance, platform-specific'}]:[]),{label:'PWA',desc:ja?'Service Worker — インストール可能Web':'Service Worker — installable web'},{label:ja?'なし':'None',desc:ja?'Web専用':'Web only'}],tip:ja?'ExpoならReact知識をそのままモバイルへ':'Expo lets you reuse React skills for mobile'},
{id:'ai_auto',q:ja?'AI自律開発レベル ★v8':'AI Dev Level ★v8',type:'options',help:'ai_auto',options:[{label:ja?'Vibe Coding入門':'Vibe Coding Intro',desc:ja?'Level 1 — AIペアプログラミング・Tab補完':'Level 1 — AI pair programming, Tab completion'},...(lv!=='beginner'?[{label:ja?'エージェント型開発':'Agentic Dev',desc:ja?'Level 2 — Cursor Agent/Cline/Antigravity マルチファイル編集':'Level 2 — Cursor Agent/Cline/Antigravity multi-file editing'},
{label:ja?'マルチAgent協調':'Multi-Agent',desc:ja?'Level 2-3 — Antigravity Manager View/Sub-Agents並列実行':'Level 2-3 — Antigravity Manager View/Sub-Agents parallel exec'}]:[]),...(lv==='pro'?[{label:ja?'フル自律開発':'Full Autonomous',desc:ja?'Level 3 — Claude Code Subagents/Jules(非同期)/Agent Teams':'Level 3 — Claude Code Subagents/Jules(async)/Agent Teams'},
{label:ja?'オーケストレーター':'Orchestrator',desc:ja?'Agent Architect — CI/CD統合・本番パイプライン':'Agent Architect — CI/CD integration, prod pipeline'}]:[]),{label:ja?'なし':'None',desc:ja?'手動コーディング':'Manual coding'}],tip:ja?'2028年までに新規本番コードの40%がVibe Coding生成 (Gartner)':'40% of new production code via Vibe Coding by 2028 (Gartner)'},
{id:'payment',q:ja?'決済・CMS・EC ★v8':'Payment/CMS/EC ★v8',type:'chip-multi',chips:ja?['Stripe決済','Stripe Billing (サブスク)',...(lv!=='beginner'?['Paddle (SaaS MoR)','Lemon Squeezy (デジタル商品)','Polar (OSS収益化)']:[]),'microCMS (国産ヘッドレス)',...(lv!=='beginner'?['Strapi (OSS CMS)','Sanity','Contentful']:[]),...(lv==='pro'?['Medusa (OSS EC)','Shopify Hydrogen','Stripe Connect (マーケットプレイス)','Saleor (Python EC)']:[]),'なし']:['Stripe','Stripe Billing (Sub)',...(lv!=='beginner'?['Paddle (SaaS MoR)',
'Lemon Squeezy (Digital)','Polar (OSS Monetize)']:[]),'microCMS (JP Headless)',...(lv!=='beginner'?['Strapi (OSS CMS)','Sanity','Contentful']:[]),...(lv==='pro'?['Medusa (OSS EC)','Shopify Hydrogen','Stripe Connect (Marketplace)','Saleor (Python EC)']:[]),'None'],
placeholder:ja?'追加…':'Add...',tip:ja?'Stripeが最も導入しやすい。MoR=税務処理代行':'Stripe is easiest to integrate. MoR = tax handling',help:'payment'},
{id:'ai_tools',q:ja?'AIコーディングツール（複数可）':'AI Coding Tools (multi)',type:'chip-multi',condition:{ai_auto:v=>v&&!/none|なし/i.test(v)},chips:['Cursor','Claude Code','GitHub Copilot','Google Antigravity',...(lv!=='beginner'?['Windsurf','Cline/RooCode','Kiro','Gemini CLI','Aider','Amazon Q Developer']:[]),...(lv==='pro'?['Codex (OpenAI)','Augment Code','Bolt.new','Devin','Lovable','Continue.dev','Tabnine']:[])],placeholder:ja?'追加…':'Add...',tip:ja?'Cursor / Antigravity (IDE) + Claude Code (CLI) が最強コンビ':'Cursor / Antigravity (IDE) + Claude Code (CLI) is the strongest combo',help:'ai_tools'},
{id:'deploy',q:ja?'デプロイ先':'Deployment',type:'options',options:[{label:'Vercel',desc:ja?'Next.js最適・無料枠充実・Edge Functions':'Best for Next.js, generous free tier, Edge Functions'},{label:'Firebase Hosting',desc:ja?'Firebase統合・Google CDN':'Firebase integration, Google CDN'},...(lv!=='beginner'?[{label:'Cloudflare Pages',desc:ja?'エッジ最速・Workers統合':'Fastest edge, Workers integration'},{label:'Railway',desc:ja?'フルスタック簡単デプロイ・PostgreSQL付き':'Easy full-stack deploy with PostgreSQL'},
{label:'Fly.io',desc:ja?'Dockerベース・グローバルエッジ':'Docker-based, global edge'},{label:'Render',desc:ja?'フルスタック簡単デプロイ・無料枠あり':'Easy full-stack deploy, free tier'}]:[]),...(lv==='pro'?[{label:'AWS (EC2/ECS/Lambda)',desc:ja?'フルカスタム・IaC':'Full custom, IaC'},{label:ja?'Docker (自前)':'Docker (self-hosted)',desc:ja?'完全制御・K8s対応':'Full control, K8s ready'}]:[]),{label:'Netlify',desc:ja?'静的/JAMstack — 無料枠充実':'Static/JAMstack — generous free tier'}],tip:ja?'Vercel/Netlify無料枠で十分':'Vercel/Netlify free tiers are plenty',help:'deploy'},
{id:'dev_methods',q:ja?'駆動開発手法（複数可）':'Dev Methods (multi)',type:'chip-multi',chips:[...(lv==='beginner'?(ja?['TDD（テスト駆動）','BDD（振る舞い駆動）','SDD（仕様駆動）']:['TDD (Test-Driven)','BDD (Behavior-Driven)','SDD (Spec-Driven)']):(ja?['TDD（テスト駆動）','BDD（振る舞い駆動）','SDD（仕様駆動）','DDD（ドメイン駆動）','FDD（機能駆動）',...(lv==='pro'?['MDD（モデル駆動）']:[])]:['TDD (Test-Driven)','BDD (Behavior-Driven)','SDD (Spec-Driven)','DDD (Domain-Driven)','FDD (Feature-Driven)',...(lv==='pro'?['MDD (Model-Driven)']:[])]))],
placeholder:ja?'追加…':'Add...',tip:lv==='beginner'?(ja?'TDD + SDD がAI駆動開発の基本':'TDD + SDD are AI-driven dev basics'):(ja?'SDD→BDD→TDD→DDD の組み合わせが最強':'SDD→BDD→TDD→DDD combo is strongest'),help:'dev_methods'},
]},
3:{name:ja?'機能・データ設計':'Feature & Data Design',questions:[
{id:'mvp_features',q:ja?'MVP機能（3〜5個推奨）':'MVP Features (3-5 recommended)',type:'chip-multi',sortable:true,chips:_uniq([..._fpPre('mvp_features'),...(ja?['ユーザー登録・ログイン','プロフィール編集','ダッシュボード','一覧表示・検索','詳細ページ','作成・編集・削除','ファイルアップロード','通知機能','お気に入り','コメント機能','シェア機能','設定画面',...(lv!=='beginner'?['API連携','管理画面','エクスポート','多言語','サブスクリプション']:[]),...(lv==='pro'?['リアルタイム同期','Webhook','RBAC','監査ログ','マルチテナント']:[])]
:['User Auth','Profile Edit','Dashboard','List & Search','Detail Page','CRUD','File Upload','Notifications','Favorites','Comments','Share','Settings',...(lv!=='beginner'?['API Integration','Admin Panel','Export','i18n','Subscription']:[]),...(lv==='pro'?['Realtime Sync','Webhook','RBAC','Audit Log','Multi-tenant']:[])])]),placeholder:ja?'追加…':'Add...',tip:ja?'3〜5個に絞りましょう':'Keep it to 3-5',help:'mvp_features'},
{id:'org_model',q:ja?'組織・テナント構造':'Organization & Tenant Structure',type:'chip-text',condition:{purpose:v=>/saas|analytics|collab|hr|tool|automation|fintech|legal|ec|marketplace|logistics|insurance/i.test(detectDomain(v||'')||'')},chips:ja?['シングルテナント','マルチテナント(RLS)','ワークスペース型','組織+チーム階層']:['Single-tenant','Multi-tenant (RLS)','Workspace-based','Org + Team hierarchy'],placeholder:ja?'追加…':'Add...',tip:ja?'マルチテナントはRLS設計・組織モデルを生成します':'Multi-tenant generates RLS design & org model',help:'org_model'},
{id:'future_features',q:ja?'将来追加機能':'Future Features',type:'chip-multi',chips:ja?['課金・サブスク','チーム機能','カレンダー連携','チャット','分析レポート','AI機能','モバイルアプリ','API公開','外部連携','A/Bテスト']
:['Billing','Team features','Calendar','Chat','Analytics','AI features','Mobile app','Public API','Integrations','A/B testing'],placeholder:ja?'追加…':'Add...',tip:ja?'Phase 2, 3として計画':'Plan for Phase 2, 3',help:'future_features'},
{id:'data_entities',q:ja?'データテーブル':'Data Entities',type:'chip-multi',condition:{backend:v=>!/なし|None|static/i.test(v)},chips:_uniq([..._fpPre('data_entities'),...['User','Post','Comment','Tag','Category','Product','Order','Task','Project','Message','Notification','File','Setting','Log',...(lv!=='beginner'?['Course','Lesson','Progress','Quiz','Certificate','Event','Group','Review','Invoice','Subscription']:[])]]),placeholder:ja?'追加…':'Add...',tip:ja?'英語・単数形が標準':'English, singular form is standard',help:'data_entities'},
{id:'auth',q:ja?'認証方式':'Authentication',type:'chip-multi',condition:{backend:v=>!/なし|None|static/i.test(v)},chips:ja?['メール/パスワード','Google OAuth','GitHub OAuth','Magic Link',...(lv!=='beginner'?['Auth.js/NextAuth','Clerk','Firebase Auth','Supabase Auth']:[]),...(lv==='pro'?['SSO/SAML','MFA','API Key']:[])]
:['Email/Password','Google OAuth','GitHub OAuth','Magic Link',...(lv!=='beginner'?['Auth.js/NextAuth','Clerk','Firebase Auth','Supabase Auth']:[]),...(lv==='pro'?['SSO/SAML','MFA','API Key']:[])],placeholder:'',tip:ja?'OAuth系は実装簡単でUX向上':'OAuth is easy to implement and improves UX',help:'auth'},
{id:'screens',q:ja?'主要画面':'Key Screens',type:'chip-multi',sortable:true,chips:_uniq([..._fpPre('screens'),...(ja?['ランディングページ','ログイン/登録','ダッシュボード','一覧ページ','詳細ページ','作成/編集フォーム','プロフィール','設定','404エラー','お問い合わせ',...(lv!=='beginner'?['管理画面','分析画面','オンボーディング']:[]),...(lv==='pro'?['APIドキュメント','ステータスページ','利用規約']:[])]
:['Landing Page','Login/Register','Dashboard','List Page','Detail Page','Create/Edit Form','Profile','Settings','404 Error','Contact',...(lv!=='beginner'?['Admin Panel','Analytics','Onboarding']:[]),...(lv==='pro'?['API Docs','Status Page','Terms of Service']:[])])]),placeholder:ja?'追加…':'Add...',tip:ja?'ワイヤーフレームを描くとスムーズ':'Wireframing helps a lot',help:'screens'},
{id:'skill_level',q:ja?'スキルレベル確認':'Confirm Skill Level',type:'options',help:'skill_level',options:[{label:'Beginner',desc:ja?'HTML/CSS学習中 — 初心者向けロードマップ':'Learning HTML/CSS — beginner roadmap'},{label:'Intermediate',desc:ja?'React/Node.js経験あり — 中級者パス':'React/Node.js experience — intermediate path'},{label:'Professional',desc:ja?'フルスタック実務経験 — プロ向け高度パス':'Full-stack production exp — advanced path'}],tip:ja?'ロードマップの難易度に影響します':'Affects roadmap difficulty'},
{id:'learning_goal',q:ja?'学習目標期間':'Learning Timeline',type:'options',help:'learning_goal',options:[{label:ja?'3ヶ月集中':'3 months intensive',desc:ja?'集中的に学習':'Focused learning'},{label:ja?'6ヶ月標準':'6 months standard',desc:ja?'バランスよく':'Balanced pace'},{label:ja?'12ヶ月じっくり':'12 months thorough',desc:ja?'深く理解':'Deep understanding'}],tip:ja?'ロードマップのペースに影響します':'Affects roadmap pace'},
{id:'learning_path',q:ja?'学習パターン ★v8':'Learning Pattern ★v8',type:'options',help:'learning_path',options:[{label:ja?'PERN Stack':'PERN Stack',desc:ja?'React+Node.js+PostgreSQL — 最も汎用的':'React+Node.js+PostgreSQL — most versatile'},{label:ja?'React + BaaS':'React + BaaS',desc:ja?'Firebase/Supabase — 最短ルート':'Firebase/Supabase — fastest route'},
...(lv!=='beginner'?[{label:ja?'フルスタック+モバイル':'Fullstack+Mobile',desc:ja?'React+Next.js+Expo — Web+Mobile統合':'React+Next.js+Expo — Web+Mobile unified'}]:[]),...(lv==='pro'?[{label:ja?'AI自律オーケストレーター':'AI Orchestrator',desc:ja?'Claude Code中心 — Agent Architect特化':'Claude Code focused — Agent Architect path'},
{label:ja?'SaaS収益化特化':'SaaS Monetization',desc:ja?'Stripe+microCMS+Next.js — 収益化パス':'Stripe+microCMS+Next.js — monetization path'}]:[])],tip:ja?'ロードマップの学習パスを決定します':'Determines your learning path'},
]},
};
}
const REQ_LABELS={
ja:{required:'必須',top1:'推奨No.1',top2:'推奨No.2','rec-jp':'推奨(JP)','rec-oss':'推奨(OSS)',recommended:'推奨',optional:'選択'},
en:{required:'Required',top1:'Top Pick',top2:'2nd Pick','rec-jp':'Rec (JP)','rec-oss':'Rec (OSS)',recommended:'Recommended',optional:'Optional'}
};
const PRICE_LABELS={
ja:{usage:'従量制',free:'無料','free-oss':'無料(OSS)','free-tier':'無料〜','free-15':'無料〜$15','free-19':'無料〜$19','free-20':'無料〜$20','free-23':'無料〜$23','free-25':'無料〜$25','free-26':'無料〜$26','free-39':'無料〜$39','free-99':'無料〜$99','free-100':'無料〜$100','free-105':'無料〜$105','free-300':'無料〜$300+','free-399':'無料〜$399','free-1295':'無料〜$1,295',paid:'有料','free(preview)':'無料(Preview)','pay-as-you-go':'従量課金','bundled':'IDE付属'},
en:{usage:'Usage-based',free:'Free','free-oss':'Free (OSS)','free-tier':'Free tier','free-15':'Free–$15','free-19':'Free–$19','free-20':'Free–$20','free-23':'Free–$23','free-25':'Free–$25','free-26':'Free–$26','free-39':'Free–$39','free-99':'Free–$99','free-100':'Free–$100','free-105':'Free–$105','free-300':'Free–$300+','free-399':'Free–$399','free-1295':'Free–$1,295',paid:'Paid','free(preview)':'Free (Preview)','pay-as-you-go':'Pay-as-you-go','bundled':'Bundled'}
};
function priceLabel(code){if(!code)return '';return (PRICE_LABELS[S.lang]||PRICE_LABELS.en)[code]||code;}
function reqLabel(code){return (REQ_LABELS[S.lang]||REQ_LABELS.en)[code]||code;}
const TECH_DB=[
// Languages
{name:'HTML5',cat:'lang',sub:'markup',req:'required',level:'all',weeks:'2-4'},
{name:'CSS3',cat:'lang',sub:'style',req:'required',level:'all',weeks:'3-6'},
{name:'JavaScript (ES6+)',cat:'lang',sub:'language',req:'required',level:'all',weeks:'4-12'},
{name:'TypeScript',cat:'lang',sub:'language',req:'required',level:'int',weeks:'2-4'},
{name:'SQL',cat:'lang',sub:'query',req:'required',level:'int',weeks:'2-4'},
{name:'Python',cat:'lang',sub:'language',req:'optional',level:'back',weeks:'4-8'},
{name:'Java',cat:'lang',sub:'language',req:'optional',level:'ent',weeks:'8-16'},
{name:'Go',cat:'lang',sub:'language',req:'optional',level:'perf',weeks:'4-8'},
{name:'Rust',cat:'lang',sub:'language',req:'optional',level:'sys',weeks:'8-16'},
{name:'Kotlin',cat:'lang',sub:'language',req:'optional',level:'android',weeks:'4-8'},
{name:'Swift',cat:'lang',sub:'language',req:'optional',level:'ios',weeks:'4-8'},
{name:'Dart',cat:'lang',sub:'language',req:'optional',level:'flutter',weeks:'4-8'},
{name:'GraphQL SDL',cat:'lang',sub:'query',req:'optional',level:'pro',weeks:'1-2'},
// Frontend (28)
{name:'React',cat:'front',sub:'fw',req:'top1',level:'int'},
{name:'Next.js',cat:'front',sub:'meta-fw',req:'recommended',level:'int'},
{name:'Vue 3',cat:'front',sub:'fw',req:'optional',level:'int'},
{name:'Nuxt',cat:'front',sub:'meta-fw',req:'optional',level:'int'},
{name:'Svelte',cat:'front',sub:'fw',req:'optional',level:'int'},
{name:'SvelteKit',cat:'front',sub:'meta-fw',req:'optional',level:'int'},
{name:'Angular',cat:'front',sub:'fw',req:'optional',level:'ent'},
{name:'Astro',cat:'front',sub:'fw',req:'optional',level:'content'},
{name:'Tailwind CSS',cat:'front',sub:'css-fw',req:'top1',level:'int'},
{name:'shadcn/ui',cat:'front',sub:'ui',req:'recommended',level:'int'},
{name:'React Router',cat:'front',sub:'routing',req:'required',level:'react'},
{name:'React Query',cat:'front',sub:'data',req:'recommended',level:'int'},
{name:'Zustand',cat:'front',sub:'state',req:'recommended',level:'int'},
{name:'Redux Toolkit',cat:'front',sub:'state',req:'optional',level:'large'},
{name:'Vite',cat:'front',sub:'build',req:'top1',level:'int'},
{name:'Vitest',cat:'front',sub:'test',req:'recommended',level:'int'},
{name:'Playwright',cat:'front',sub:'e2e',req:'recommended',level:'int'},
{name:'Storybook',cat:'front',sub:'ui-dev',req:'optional',level:'pro'},
{name:'ESLint',cat:'front',sub:'lint',req:'required',level:'int'},
{name:'Prettier',cat:'front',sub:'format',req:'required',level:'int'},
// Mobile (22)
{name:'React Native',cat:'mobile',sub:'fw',req:'top1',level:'int'},
{name:'Expo',cat:'mobile',sub:'platform',req:'top1',level:'int'},
{name:'Expo Router',cat:'mobile',sub:'routing',req:'recommended',level:'int'},
{name:'Expo SDK',cat:'mobile',sub:'sdk',req:'recommended',level:'int'},
{name:'EAS Build',cat:'mobile',sub:'build',req:'recommended',level:'int'},
{name:'EAS Submit',cat:'mobile',sub:'store',req:'recommended',level:'int'},
{name:'EAS Update (OTA)',cat:'mobile',sub:'update',req:'recommended',level:'int'},
{name:'NativeWind',cat:'mobile',sub:'css',req:'recommended',level:'int'},
{name:'Tamagui',cat:'mobile',sub:'ui',req:'optional',level:'universal'},
{name:'React Native Reanimated',cat:'mobile',sub:'animation',req:'recommended',level:'int'},
{name:'FlashList',cat:'mobile',sub:'list',req:'recommended',level:'perf'},
{name:'Maestro',cat:'mobile',sub:'e2e',req:'recommended',level:'pro'},
{name:'Flutter',cat:'mobile',sub:'alt-fw',req:'optional',level:'dart'},
{name:'Kotlin Multiplatform (KMP)',cat:'mobile',sub:'cross-platform',req:'optional',level:'ent'},
{name:'Compose Multiplatform',cat:'mobile',sub:'cross-platform-ui',req:'optional',level:'ent'},
{name:'Tauri v2',cat:'mobile',sub:'hybrid',req:'optional',level:'pro'},
{name:'SwiftUI',cat:'mobile',sub:'native-fw',req:'optional',level:'ios'},
{name:'Jetpack Compose',cat:'mobile',sub:'native-fw',req:'optional',level:'android'},
{name:'visionOS / RealityKit',cat:'mobile',sub:'spatial',req:'optional',level:'pro'},
// Backend (30)
{name:'Node.js',cat:'back',sub:'runtime',req:'top1',level:'int'},
{name:'Express',cat:'back',sub:'fw',req:'recommended',level:'int'},
{name:'Fastify',cat:'back',sub:'fw',req:'recommended',level:'int'},
{name:'NestJS',cat:'back',sub:'fw',req:'optional',level:'ent'},
{name:'Hono',cat:'back',sub:'fw',req:'optional',level:'edge'},
{name:'Django',cat:'back',sub:'fw',req:'optional',level:'py'},
{name:'FastAPI',cat:'back',sub:'fw',req:'optional',level:'py'},
{name:'Spring Boot',cat:'back',sub:'fw',req:'optional',level:'java'},
{name:'PostgreSQL',cat:'back',sub:'db',req:'top1',level:'int'},
{name:'MongoDB',cat:'back',sub:'db',req:'top2',level:'int'},
{name:'MySQL',cat:'back',sub:'db',req:'optional',level:'int'},
{name:'Redis',cat:'back',sub:'cache',req:'recommended',level:'int'},
{name:'Prisma',cat:'back',sub:'orm',req:'top1',level:'int'},
{name:'Drizzle',cat:'back',sub:'orm',req:'top2',level:'int'},
{name:'NextAuth.js / Auth.js',cat:'back',sub:'auth',req:'recommended',level:'int'},
{name:'JWT',cat:'back',sub:'auth-spec',req:'required',level:'int'},
{name:'OAuth 2.0',cat:'back',sub:'auth-spec',req:'recommended',level:'int'},
{name:'Socket.io',cat:'back',sub:'ws',req:'optional',level:'rt'},
{name:'GraphQL (Apollo)',cat:'back',sub:'api',req:'optional',level:'pro'},
{name:'Swagger/OpenAPI',cat:'back',sub:'doc',req:'recommended',level:'int'},
// BaaS (8)
{name:'Firebase',cat:'baas',sub:'full',req:'recommended',level:'mvp'},
{name:'Supabase',cat:'baas',sub:'full',req:'recommended',level:'sql'},
{name:'Vercel Edge Functions',cat:'baas',sub:'serverless',req:'optional',level:'front'},
{name:'Cloudflare Workers',cat:'baas',sub:'edge',req:'optional',level:'global'},
{name:'Neon',cat:'baas',sub:'db',req:'optional',level:'pg'},
// Payment/CMS/EC (22)
{name:'Stripe',cat:'payment',sub:'payment',req:'top1',level:'int',price:'2.9%+30¢'},
{name:'Stripe Billing',cat:'payment',sub:'subscription',req:'recommended',level:'int',price:'usage'},
{name:'Stripe Connect',cat:'payment',sub:'marketplace',req:'optional',level:'pro',price:'usage'},
{name:'Paddle',cat:'payment',sub:'mor',req:'optional',level:'int',price:'5%+50¢'},
{name:'Lemon Squeezy (Stripe)',cat:'payment',sub:'mor',req:'optional',level:'beg',price:'5%+50¢'},
{name:'Polar',cat:'payment',sub:'mor',req:'optional',level:'int',price:'5%+40¢'},
{name:'PayPal',cat:'payment',sub:'payment',req:'optional',level:'beg',price:'2.9%+30¢'},
{name:'microCMS',cat:'payment',sub:'cms',req:'rec-jp',level:'beg',price:'¥0〜¥4,900'},
{name:'Strapi',cat:'payment',sub:'cms',req:'rec-oss',level:'int',price:'free-15'},
{name:'Sanity',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-99'},
{name:'Contentful',cat:'payment',sub:'cms',req:'optional',level:'pro',price:'free-300'},
{name:'Payload',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-oss'},
{name:'Shopify Hydrogen',cat:'payment',sub:'ec',req:'optional',level:'pro',price:'$39〜'},
{name:'Medusa',cat:'payment',sub:'ec',req:'rec-oss',level:'int',price:'free'},
{name:'Saleor',cat:'payment',sub:'ec',req:'optional',level:'pro',price:'free-1295'},
{name:'Clerk',cat:'payment',sub:'auth',req:'optional',level:'int',price:'free-25'},
{name:'Auth0',cat:'payment',sub:'auth',req:'optional',level:'pro',price:'free-23'},
// DevOps (20)
{name:'Git',cat:'devops',sub:'vcs',req:'required',level:'all'},
{name:'GitHub',cat:'devops',sub:'platform',req:'required',level:'all'},
{name:'Docker',cat:'devops',sub:'container',req:'recommended',level:'int'},
{name:'Docker Compose',cat:'devops',sub:'orchestration',req:'recommended',level:'int'},
{name:'GitHub Actions',cat:'devops',sub:'ci',req:'recommended',level:'int'},
{name:'Vercel',cat:'devops',sub:'paas',req:'recommended',level:'int'},
{name:'Railway',cat:'devops',sub:'paas',req:'recommended',level:'int'},
{name:'AWS',cat:'devops',sub:'iaas',req:'optional',level:'pro'},
{name:'Kubernetes',cat:'devops',sub:'k8s',req:'optional',level:'pro'},
{name:'Terraform',cat:'devops',sub:'iac',req:'optional',level:'pro'},
{name:'Nginx',cat:'devops',sub:'web',req:'optional',level:'pro'},
{name:'Linux Basics',cat:'devops',sub:'os',req:'recommended',level:'int'},
{name:'Backstage (Spotify)',cat:'devops',sub:'idp',req:'optional',level:'pro',price:'free-oss'},
// AI Tools (22)
{name:'Cursor',cat:'ai',sub:'ide',req:'top1',level:'int',price:'$20'},
{name:'Claude Code',cat:'ai',sub:'cli',req:'recommended',level:'int',price:'$20〜$200'},
{name:'GitHub Copilot',cat:'ai',sub:'ext',req:'recommended',level:'beg',price:'$10〜$39'},
{name:'Windsurf',cat:'ai',sub:'ide',req:'optional',level:'int',price:'free-15'},
{name:'Gemini CLI',cat:'ai',sub:'cli',req:'optional',level:'int',price:'free'},
{name:'Cline / RooCode',cat:'ai',sub:'ext',req:'optional',level:'pro',price:'usage'},
{name:'Kiro',cat:'ai',sub:'ide',req:'optional',level:'int',price:'$20'},
{name:'Codex (OpenAI)',cat:'ai',sub:'cli',req:'optional',level:'pro',price:'$20'},
{name:'CLAUDE.md',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'.cursor/rules',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'AGENTS.md',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'MCP',cat:'ai',sub:'protocol',req:'recommended',level:'int'},
{name:'Spec Kit',cat:'ai',sub:'sdd',req:'recommended',level:'int'},
// AI Autonomous (18)
{name:'Devin',cat:'ai_auto',sub:'autonomous',req:'optional',level:'pro',price:'$20〜$500'},
{name:'Replit Agent',cat:'ai_auto',sub:'browser',req:'optional',level:'beg',price:'$25'},
{name:'Claude Code Subagents',cat:'ai_auto',sub:'parallel',req:'optional',level:'pro'},
{name:'Claude Code Tasks',cat:'ai_auto',sub:'dag',req:'optional',level:'pro'},
{name:'Claude-Flow',cat:'ai_auto',sub:'orchestrator',req:'optional',level:'pro'},
{name:'Lovable',cat:'ai_auto',sub:'generator',req:'optional',level:'beg',price:'$25'},
{name:'Bolt.new',cat:'ai_auto',sub:'generator',req:'optional',level:'beg',price:'free-oss'},
{name:'v0 (Vercel)',cat:'ai_auto',sub:'ui-gen',req:'optional',level:'int',price:'$20'},
{name:'Codex App (OpenAI)',cat:'ai_auto',sub:'agentic',req:'optional',level:'pro',price:'$20'},
{name:'FlutterFlow',cat:'ai_auto',sub:'no-code',req:'optional',level:'beg',price:'free-tier'},
{name:'Adalo',cat:'ai_auto',sub:'no-code',req:'optional',level:'beg',price:'free-tier'},
{name:'Architect',cat:'ai_auto',sub:'text-to-app',req:'optional',level:'int',price:'paid'},
// ── Additional Languages (6) ──
{name:'C#',cat:'lang',sub:'language',req:'optional',level:'dotnet',weeks:'6-12'},
{name:'PHP',cat:'lang',sub:'language',req:'optional',level:'wp',weeks:'4-8'},
{name:'Ruby',cat:'lang',sub:'language',req:'optional',level:'rails',weeks:'4-8'},
{name:'Markdown',cat:'lang',sub:'markup',req:'required',level:'all',weeks:'1d'},
{name:'JSON',cat:'lang',sub:'data',req:'required',level:'all',weeks:'1d'},
{name:'YAML',cat:'lang',sub:'config',req:'recommended',level:'int',weeks:'1d'},
// ── Additional Frontend (8) ──
{name:'Bootstrap',cat:'front',sub:'css-fw',req:'optional',level:'legacy'},
{name:'Radix UI',cat:'front',sub:'ui',req:'optional',level:'a11y'},
{name:'Framer Motion',cat:'front',sub:'animation',req:'optional',level:'pro'},
{name:'GSAP',cat:'front',sub:'animation',req:'optional',level:'pro'},
{name:'React Testing Library',cat:'front',sub:'test',req:'recommended',level:'int'},
{name:'Figma',cat:'front',sub:'design',req:'recommended',level:'int'},
{name:'Chrome DevTools',cat:'front',sub:'debug',req:'required',level:'all'},
{name:'React DevTools',cat:'front',sub:'debug',req:'required',level:'react'},
// ── Additional Mobile (9) ──
{name:'EAS Workflows',cat:'mobile',sub:'ci',req:'recommended',level:'pro'},
{name:'React Native Gesture Handler',cat:'mobile',sub:'gesture',req:'recommended',level:'int'},
{name:'Detox',cat:'mobile',sub:'e2e',req:'optional',level:'pro'},
{name:'React Native DevTools',cat:'mobile',sub:'debug',req:'required',level:'int'},
{name:'Hermes V1',cat:'mobile',sub:'engine',req:'required',level:'all'},
{name:'Expo Modules API',cat:'mobile',sub:'native',req:'optional',level:'pro'},
{name:'Config Plugins',cat:'mobile',sub:'native-config',req:'recommended',level:'int'},
{name:'Swift/Kotlin (Native)',cat:'mobile',sub:'native-dev',req:'optional',level:'pro'},
{name:'Expo Go',cat:'mobile',sub:'dev-tool',req:'recommended',level:'beg'},
// ── Additional Backend (10) ──
{name:'Flask',cat:'back',sub:'fw',req:'optional',level:'py'},
{name:'Gin',cat:'back',sub:'fw',req:'optional',level:'go'},
{name:'SQLite',cat:'back',sub:'db',req:'optional',level:'embed'},
{name:'TypeORM',cat:'back',sub:'orm',req:'optional',level:'int'},
{name:'SQLAlchemy',cat:'back',sub:'orm',req:'recommended',level:'py'},
{name:'Passport.js',cat:'back',sub:'auth',req:'recommended',level:'int'},
{name:'bcrypt / argon2',cat:'back',sub:'crypto',req:'required',level:'int'},
{name:'Bull/BullMQ',cat:'back',sub:'queue',req:'optional',level:'int'},
{name:'Postman',cat:'back',sub:'api-test',req:'recommended',level:'int'},
{name:'Jest / Pytest',cat:'back',sub:'test',req:'recommended',level:'int'},
// ── Additional BaaS (3) ──
{name:'AWS Lambda',cat:'baas',sub:'serverless',req:'optional',level:'aws'},
{name:'AWS Amplify',cat:'baas',sub:'full',req:'optional',level:'aws'},
{name:'Convex',cat:'baas',sub:'reactive',req:'optional',level:'rt'},
// ── Additional Payment/CMS/EC (5) ──
{name:'Prismic',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-100'},
{name:'Hygraph',cat:'payment',sub:'cms',req:'optional',level:'pro',price:'free-399'},
{name:'Storyblok',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-105'},
{name:'Vendure',cat:'payment',sub:'ec',req:'optional',level:'pro',price:'free-oss'},
{name:'WooCommerce',cat:'payment',sub:'ec',req:'optional',level:'beg',price:'free'},
// ── Additional DevOps (9) ──
{name:'Fly.io',cat:'devops',sub:'paas',req:'optional',level:'int'},
{name:'Netlify',cat:'devops',sub:'paas',req:'optional',level:'static'},
{name:'GCP (Cloud Run)',cat:'devops',sub:'iaas',req:'optional',level:'pro'},
{name:'PM2',cat:'devops',sub:'process',req:'optional',level:'node'},
{name:'Prometheus',cat:'devops',sub:'monitor',req:'optional',level:'pro'},
{name:'Grafana',cat:'devops',sub:'viz',req:'optional',level:'pro'},
{name:'Let\'s Encrypt',cat:'devops',sub:'ssl',req:'recommended',level:'prod'},
{name:'Cloudflare',cat:'devops',sub:'cdn',req:'optional',level:'pro'},
// ── Additional AI Tools (10) ──
{name:'Claude (Chat)',cat:'ai',sub:'chat',req:'recommended',level:'all',price:'$20'},
{name:'ChatGPT',cat:'ai',sub:'chat',req:'optional',level:'all',price:'$20'},
{name:'Gemini',cat:'ai',sub:'chat',req:'optional',level:'all',price:'free-20'},
{name:'skills.md',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'Hooks',cat:'ai',sub:'automation',req:'optional',level:'pro'},
{name:'Conductor',cat:'ai',sub:'parallel',req:'optional',level:'pro'},
{name:'Vibe Kanban',cat:'ai',sub:'agent-mgmt',req:'optional',level:'pro'},
{name:'Context7',cat:'ai',sub:'mcp-server',req:'recommended',level:'int'},
{name:'Playwright MCP',cat:'ai',sub:'test-mcp',req:'recommended',level:'int'},
{name:'VS Code',cat:'ai',sub:'editor',req:'required',level:'all',price:'free'},
// ── Additional AI Autonomous (10) ──
{name:'Zencoder/Zenflow',cat:'ai_auto',sub:'spec-agent',req:'optional',level:'pro',price:'paid'},
{name:'Kilo Code',cat:'ai_auto',sub:'precision',req:'optional',level:'pro',price:'paid'},
{name:'Continue.dev',cat:'ai_auto',sub:'oss',req:'optional',level:'int',price:'free'},
{name:'Claude Code Agent Teams',cat:'ai_auto',sub:'multi-agent',req:'optional',level:'pro'},
{name:'Claude Code Swarms',cat:'ai_auto',sub:'swarm',req:'optional',level:'pro'},
{name:'Claude Code Headless',cat:'ai_auto',sub:'ci-cd',req:'optional',level:'pro'},
{name:'Gas Town',cat:'ai_auto',sub:'k8s-agents',req:'optional',level:'pro'},
{name:'Multiclaude',cat:'ai_auto',sub:'team',req:'optional',level:'pro'},
{name:'CodeGPT',cat:'ai_auto',sub:'fullstack',req:'optional',level:'int',price:'paid'},
{name:'Manus',cat:'ai_auto',sub:'autonomous',req:'optional',level:'pro',price:'paid'},
{name:'Google Antigravity',cat:'ai',sub:'ide',req:'optional',level:'int',price:'free(preview)'},
{name:'OpenRouter',cat:'ai',sub:'router',req:'optional',level:'int',price:'pay-as-you-go'},
{name:'Augment Code',cat:'ai',sub:'ide',req:'optional',level:'pro',price:'$20〜$250'},
{name:'Aider',cat:'ai',sub:'cli',req:'optional',level:'int',price:'free-oss'},
{name:'Jules (Google)',cat:'ai_auto',sub:'async-agent',req:'optional',level:'int',price:'free'},
{name:'Amazon Q Developer',cat:'ai',sub:'ext',req:'optional',level:'int',price:'free-19'},
{name:'Gemini Code Assist',cat:'ai',sub:'ext',req:'optional',level:'int',price:'free-tier'},
{name:'JetBrains Junie',cat:'ai',sub:'ext',req:'optional',level:'int',price:'bundled'},
{name:'Tabnine',cat:'ai',sub:'ext',req:'optional',level:'int',price:'free-39'},
{name:'Qwen3-Coder',cat:'ai_auto',sub:'oss-model',req:'optional',level:'pro',price:'free-oss'},
{name:'DeepSeek V3.2',cat:'ai_auto',sub:'oss-model',req:'optional',level:'pro',price:'free-oss'},
// ── Design & Methodology (12) ──
{name:'TDD',cat:'method',sub:'methodology',req:'recommended',level:'int'},
{name:'BDD',cat:'method',sub:'methodology',req:'recommended',level:'int'},
{name:'DDD',cat:'method',sub:'methodology',req:'recommended',level:'pro'},
{name:'FDD',cat:'method',sub:'methodology',req:'optional',level:'int'},
{name:'MDD',cat:'method',sub:'methodology',req:'optional',level:'int'},
{name:'SDD',cat:'method',sub:'methodology',req:'recommended',level:'int'},
{name:'Clean Architecture',cat:'method',sub:'pattern',req:'recommended',level:'pro'},
{name:'Microservices',cat:'method',sub:'pattern',req:'optional',level:'pro'},
{name:'Monorepo (Turborepo)',cat:'method',sub:'structure',req:'optional',level:'pro'},
{name:'Conventional Commits',cat:'method',sub:'convention',req:'recommended',level:'int'},
{name:'Semantic Versioning',cat:'method',sub:'convention',req:'recommended',level:'int'},
{name:'Agile / Scrum',cat:'method',sub:'process',req:'recommended',level:'all'},
// ── Testing & Quality (8) ──
{name:'Cypress',cat:'test',sub:'e2e',req:'optional',level:'int'},
{name:'Testing Library',cat:'test',sub:'unit',req:'recommended',level:'int'},
{name:'MSW (Mock Service Worker)',cat:'test',sub:'mock',req:'recommended',level:'int'},
{name:'Faker.js',cat:'test',sub:'data',req:'optional',level:'int'},
{name:'Lighthouse CI',cat:'test',sub:'perf',req:'recommended',level:'int'},
{name:'Sentry',cat:'test',sub:'monitor',req:'recommended',level:'int',price:'free-26'},
{name:'SonarQube',cat:'test',sub:'quality',req:'optional',level:'pro'},
{name:'Codecov',cat:'test',sub:'coverage',req:'optional',level:'int'},
// ── API & Communication (6) ──
{name:'tRPC',cat:'api',sub:'typesafe',req:'optional',level:'int'},
{name:'gRPC',cat:'api',sub:'rpc',req:'optional',level:'pro'},
{name:'Zod',cat:'api',sub:'validation',req:'recommended',level:'int'},
{name:'Axios',cat:'api',sub:'http',req:'optional',level:'int'},
{name:'WebSocket',cat:'api',sub:'realtime',req:'optional',level:'int'},
{name:'Server-Sent Events',cat:'api',sub:'realtime',req:'optional',level:'int'},
// ── Build & Toolchain (7) ──
{name:'Turbopack',cat:'build',sub:'bundler',req:'optional',level:'next'},
{name:'esbuild',cat:'build',sub:'bundler',req:'optional',level:'pro'},
{name:'SWC',cat:'build',sub:'compiler',req:'recommended',level:'int'},
{name:'pnpm',cat:'build',sub:'pkgmgr',req:'recommended',level:'int'},
{name:'Turborepo',cat:'build',sub:'monorepo',req:'optional',level:'pro'},
{name:'Changesets',cat:'build',sub:'versioning',req:'optional',level:'pro'},
{name:'WebAssembly (WASI)',cat:'build',sub:'runtime',req:'optional',level:'pro'},
// ── Data & Analytics (6) ──
{name:'Drizzle Studio',cat:'data',sub:'gui',req:'optional',level:'int'},
{name:'Prisma Studio',cat:'data',sub:'gui',req:'recommended',level:'int'},
{name:'PostHog',cat:'data',sub:'analytics',req:'optional',level:'int',price:'free-tier'},
{name:'Plausible',cat:'data',sub:'analytics',req:'optional',level:'int',price:'$9〜'},
{name:'Vercel Analytics',cat:'data',sub:'analytics',req:'recommended',level:'int',price:'free-tier'},
{name:'OpenTelemetry',cat:'data',sub:'observability',req:'optional',level:'pro'},
// ── Security (6) ──
{name:'Helmet.js',cat:'security',sub:'headers',req:'recommended',level:'int'},
{name:'CORS',cat:'security',sub:'policy',req:'required',level:'int'},
{name:'CSP',cat:'security',sub:'policy',req:'recommended',level:'int'},
{name:'rate-limiter-flexible',cat:'security',sub:'ratelimit',req:'recommended',level:'int'},
{name:'npm audit',cat:'security',sub:'deps',req:'required',level:'all'},
{name:'Snyk',cat:'security',sub:'scanning',req:'optional',level:'pro',price:'free-tier'},
];
const _TECH_COUNT=TECH_DB.length;
const HELP_DATA={
purpose:{
ja:{title:'プロジェクトの目的',desc:'「誰が・何を・なぜ」使うのかを1文で表現しましょう。',example:'例: "フリーランスが見積書を5分で作成できるSaaS"',
expertHints:[
{icon:'🎨',name:'クリエイティブ',hint:'このアプリで、ユーザーにどんな「物語」を体験させたいですか？'},
{icon:'⚙️',name:'技術専門家',hint:'既存の技術で不可能だったことを、新技術でどう実現しますか？'},
{icon:'📊',name:'ビジネス',hint:'ユーザーは今、何にお金を払っていて、それより何が優れていますか？'},
{icon:'📚',name:'学術研究者',hint:'この問題について、学術的に最も有効とされるアプローチは何ですか？'},
{icon:'🔬',name:'科学者',hint:'この仮説を検証するために、最小のMVPで測定すべきデータは何ですか？'},
{icon:'👤',name:'ユーザー',hint:'ターゲットが朝起きて最初に感じるフラストレーションは何ですか？'},
{icon:'💥',name:'ディスラプター',hint:'この業界で「当たり前」とされていることを、もし逆にしたらどうなりますか？'},
{icon:'😄',name:'ユーモリスト',hint:'このアプリを使うとき、思わず笑顔になる瞬間はどこですか？'},
{icon:'🧭',name:'冒険家',hint:'もし失敗のリスクがゼロなら、最も大胆な機能は何ですか？'}
]},
en:{title:'Project Purpose',desc:'Express "who uses what and why" in one sentence.',example:'e.g. "A SaaS where freelancers create invoices in 5 min"',
expertHints:[
{icon:'🎨',name:'Creative',hint:'What "story" do you want users to experience with this app?'},
{icon:'⚙️',name:'Technical',hint:'What was previously impossible that new technology now enables?'},
{icon:'📊',name:'Business',hint:'What do users currently pay for, and how are you better?'},
{icon:'📚',name:'Academic',hint:'What is the most evidence-backed approach to this problem?'},
{icon:'🔬',name:'Scientist',hint:'What is the minimum measurable data your MVP must capture to validate this hypothesis?'},
{icon:'👤',name:'User Rep',hint:'What is the first frustration your target user feels when they wake up?'},
{icon:'💥',name:'Disruptor',hint:'What if you did the exact opposite of what this industry considers "standard"?'},
{icon:'😄',name:'Humorist',hint:'At what moment will users smile unexpectedly when using this app?'},
{icon:'🧭',name:'Adventurer',hint:'If failure risk were zero, what is the boldest feature you would build?'}
]}
},
target:{
ja:{title:'ターゲットユーザー',desc:'具体的なペルソナを2〜3人イメージすると設計がブレません。',example:'例: "30代エンジニア、副業で受注管理に困っている"',
expertHints:[
{icon:'🎨',name:'クリエイティブ',hint:'あなたのユーザーが今日体験した「小さな感動」は何でしたか？'},
{icon:'⚙️',name:'技術専門家',hint:'ターゲットユーザーの技術リテラシーは？その制約がアーキテクチャに与える影響は？'},
{icon:'📊',name:'ビジネス',hint:'このユーザー層の年間「不満解消」予算はいくらですか？'},
{icon:'👤',name:'ユーザー',hint:'ユーザーが現在使っているワークアラウンドは何ですか？（Excel/メモ帳/脳内管理）'},
{icon:'💥',name:'ディスラプター',hint:'「こんな人は使わない」と思っていたユーザー層が実は最大の市場では？'},
{icon:'🔬',name:'科学者',hint:'ユーザー行動の中で「習慣化」できる部分はどこですか？'},
{icon:'🧭',name:'冒険家',hint:'3年後にこのアプリの「熱狂的ファン」になっているのはどんな人ですか？'}
]},
en:{title:'Target Users',desc:'Imagine 2-3 specific personas to keep your design focused.',example:'e.g. "30s engineer struggling with freelance order management"',
expertHints:[
{icon:'🎨',name:'Creative',hint:'What was a small moment of delight your users experienced today?'},
{icon:'⚙️',name:'Technical',hint:'What is this user\'s tech literacy, and how does that constrain your architecture?'},
{icon:'📊',name:'Business',hint:'What is this user segment\'s annual budget for "solving frustrations"?'},
{icon:'👤',name:'User Rep',hint:'What workaround are users currently using? (Excel/notepad/memory)'},
{icon:'💥',name:'Disruptor',hint:'Could the user segment you thought "would never use this" actually be your biggest market?'},
{icon:'🔬',name:'Scientist',hint:'Which part of user behavior can be turned into a habit loop?'},
{icon:'🧭',name:'Adventurer',hint:'Who will be the "super fan" of this app in 3 years?'}
]}
},
success:{
ja:{title:'成功指標（KPI）',desc:'プロジェクト種別に応じた指標を自動提案。📈成長 💰収益 🔄継続 😊満足 ⚡技術 の10カテゴリから3〜5つ選択。',example:'例: EC→"GMV月100万" / 教育→"完了率80%+"'},
en:{title:'Success Metrics (KPI)',desc:'Auto-suggested by project type. Pick 3-5 from 10 categories: 📈Growth 💰Revenue 🔄Retention 😊Satisfaction ⚡Perf.',example:'e.g. EC→"$10K GMV" / Education→"80%+ completion"'}
},
scope_out:{
ja:{title:'スコープ外',desc:'「やらないこと」を決めるのがMVP成功の鍵。',example:'例: "v1ではモバイルアプリは作らない"',
expertHints:[
{icon:'📊',name:'ビジネス',hint:'「これは後でいい」と言えるものを全てリストアップ。半分以上あるはずです。'},
{icon:'👤',name:'ユーザー',hint:'最初の1週間でユーザーが絶対に使わない機能は？それは全てスコープ外です。'},
{icon:'💥',name:'ディスラプター',hint:'機能を1つだけ残すとしたら？それ以外は全てスコープ外の候補。'},
{icon:'⚙️',name:'技術専門家',hint:'実装に1週間以上かかる機能はv1のスコープ外にしてください。'},
{icon:'🧭',name:'冒険家',hint:'スコープ外を明確にしないプロジェクトの90%は完成しません。'}
]},
en:{title:'Out of Scope',desc:'Deciding what NOT to do is key to MVP success.',example:'e.g. "No mobile app in v1"',
expertHints:[
{icon:'📊',name:'Business',hint:'"This can wait" — list everything that qualifies. There should be more than half.'},
{icon:'👤',name:'User Rep',hint:'Which features won\'t users touch in the first week? Those are all out of scope.'},
{icon:'💥',name:'Disruptor',hint:'If you could only keep one feature, what would it be? Everything else is a scope-out candidate.'},
{icon:'⚙️',name:'Technical',hint:'Any feature taking more than a week to implement belongs in v2, not v1.'},
{icon:'🧭',name:'Adventurer',hint:'90% of projects without a clear scope-out never ship. Define it now.'}
]}
},
deadline:{
ja:{title:'リリース目標',desc:'2週間=超MVP、1ヶ月=基本MVP、3ヶ月=本格版。',example:'TIP: 2週間でまずデプロイ、その後改善サイクルが最速'},
en:{title:'Release Target',desc:'2 weeks = ultra MVP, 1 month = basic MVP, 3 months = full version.',example:'TIP: Deploy in 2 weeks first, then iterate fast'}
},
frontend:{
ja:{title:'フロントエンド',desc:'既に知っている技術を選ぶのが最速。',example:'初心者→React、SSR→Next.js',link:'https://stateofjs.com'},
en:{title:'Frontend',desc:'Choosing a tech you already know is fastest.',example:'Beginner→React, SSR→Next.js',link:'https://stateofjs.com'}
},
backend:{
ja:{title:'バックエンド/DB',desc:'BaaS(Firebase/Supabase)はサーバーコード不要で最速。',example:'静的サイト→なし、認証あり→Firebase/Supabase'},
en:{title:'Backend/DB',desc:'BaaS (Firebase/Supabase) needs no server code — fastest path.',example:'Static→None, Auth needed→Firebase/Supabase'}
},
ai_tools:{
ja:{title:'AIツール',desc:'Cursor/Antigravity=AI IDE、Claude Code/Aider=CLI、Copilot/Tabnine=補完拡張、OpenRouter=API統合ハブ。',example:'推奨: Cursor or Antigravity + Claude Code'},
en:{title:'AI Tools',desc:'Cursor/Antigravity=AI IDE, Claude Code/Aider=CLI, Copilot/Tabnine=completion ext, OpenRouter=API hub.',example:'Recommended: Cursor or Antigravity + Claude Code'}
},
deploy:{
ja:{title:'デプロイ先',desc:'Vercel/Netlify=無料枠で十分。',example:'Next.js→Vercel、静的→Netlify'},
en:{title:'Deployment',desc:'Vercel/Netlify free tier is enough to start.',example:'Next.js→Vercel, Static→Netlify'}
},
dev_methods:{
ja:{title:'駆動開発手法',desc:'TDD=テスト先行、BDD=振る舞い設計、DDD=ドメインモデル中心。',example:'推奨: TDD（必須）+ BDD'},
en:{title:'Dev Methodologies',desc:'TDD=test-first, BDD=behavior-driven, DDD=domain-model-centric.',example:'Recommended: TDD (essential) + BDD'}
},
mvp_features:{
ja:{title:'MVP機能',desc:'3〜5個に絞る。「これがないと使えない」機能だけ選択。',example:'最小: 認証 + メイン機能1つ + 設定',
expertHints:[
{icon:'⚙️',name:'技術専門家',hint:'この機能リストの中で、技術的に最もリスクが高いものはどれですか？先に検証すべきです。'},
{icon:'📊',name:'ビジネス',hint:'各機能の「開発コスト/収益貢献度」比率を計算してください。ROI最大の機能だけ残す。'},
{icon:'👤',name:'ユーザー',hint:'ユーザーが「これができないなら使わない」と言う機能は何ですか？それだけ作ればいい。'},
{icon:'💥',name:'ディスラプター',hint:'競合が全部持っている機能を全て外したら、何が残りますか？それが差別化の核心。'},
{icon:'🔬',name:'科学者',hint:'この機能の中で「使われるか検証できていない」ものはどれですか？仮説として明示してください。'},
{icon:'🧭',name:'冒険家',hint:'今の機能リストを半分に削ったとき、残すのはどれですか？'}
]},
en:{title:'MVP Features',desc:'Narrow to 3-5. Only pick features users cannot live without.',example:'Minimum: Auth + 1 core feature + Settings',
expertHints:[
{icon:'⚙️',name:'Technical',hint:'Which feature has the highest technical risk? Validate that one first.'},
{icon:'📊',name:'Business',hint:'Calculate development cost vs revenue contribution for each feature. Keep only the highest ROI ones.'},
{icon:'👤',name:'User Rep',hint:'Which feature would make users say "then I won\'t use it"? Build only that.'},
{icon:'💥',name:'Disruptor',hint:'If you removed every feature competitors have, what remains? That\'s your differentiation core.'},
{icon:'🔬',name:'Scientist',hint:'Which features are unvalidated hypotheses? Flag them explicitly.'},
{icon:'🧭',name:'Adventurer',hint:'If you cut this list in half, which ones survive?'}
]}
},
org_model:{
ja:{title:'組織・テナント構造',desc:'マルチテナント選択でRLSポリシー・組織ERモデル・承認フローが自動生成されます。',example:'SaaS: マルチテナント(RLS) / 社内ツール: シングルテナント'},
en:{title:'Organization & Tenant Structure',desc:'Multi-tenant selection auto-generates RLS policies, org ER model, and approval workflows.',example:'SaaS: Multi-tenant (RLS) / Internal tool: Single-tenant'}
},
future_features:{
ja:{title:'将来追加機能',desc:'Phase 2, 3として計画。MVPリリース後に再評価。',example:'課金→PMF確認後、モバイル→DAU 1000+時'},
en:{title:'Future Features',desc:'Plan as Phase 2-3. Re-evaluate after MVP launch.',example:'Billing→after PMF, Mobile→at DAU 1000+'}
},
data_entities:{
ja:{title:'データテーブル',desc:'英語・単数形・PascalCaseが標準。',example:'User, Post, Comment（Usersではなく単数形）'},
en:{title:'Data Tables',desc:'English, singular, PascalCase is standard.',example:'User, Post, Comment (singular, not Users)'}
},
auth:{
ja:{title:'認証方式',desc:'OAuth(Google/GitHub)は実装簡単でUX向上。',example:'最小: メール/PW + Google OAuth'},
en:{title:'Authentication',desc:'OAuth (Google/GitHub) is easy to implement and improves UX.',example:'Minimum: Email/PW + Google OAuth'}
},
screens:{
ja:{title:'主要画面',desc:'ユーザーフローに沿って画面を洗い出し。',example:'LP → ログイン → ダッシュボード → 詳細',
expertHints:[
{icon:'🎨',name:'クリエイティブ',hint:'ユーザーが初めてアプリを開いた瞬間、どんな感情を感じてほしいですか？その感情から逆算して画面を設計してください。'},
{icon:'⚙️',name:'技術専門家',hint:'この画面リストで、サーバーサイドレンダリングが必要な画面はどれですか？最初から分類しておくとアーキテクチャが安定します。'},
{icon:'👤',name:'ユーザー',hint:'ユーザーが最も頻繁に訪問する画面はどれですか？そこに全エネルギーを集中してください。'},
{icon:'💥',name:'ディスラプター',hint:'「ダッシュボード」や「設定」を作らないとしたら、本当に必要な画面は何ですか？'},
{icon:'😄',name:'ユーモリスト',hint:'この画面の中で「思わずスクリーンショットを撮りたくなる」デザインができる画面はどれですか？'},
{icon:'🧭',name:'冒険家',hint:'一番難しい画面から作り始めたら、後の全てが簡単に感じます。どれが最難関ですか？'}
]},
en:{title:'Key Screens',desc:'Map out screens following the user flow.',example:'LP → Login → Dashboard → Detail',
expertHints:[
{icon:'🎨',name:'Creative',hint:'What emotion should users feel the moment they first open your app? Design backwards from that emotion.'},
{icon:'⚙️',name:'Technical',hint:'Which screens need server-side rendering? Classify early to stabilize your architecture.'},
{icon:'👤',name:'User Rep',hint:'Which screen will users visit most frequently? Invest all your energy there.'},
{icon:'💥',name:'Disruptor',hint:'If you refused to build a "Dashboard" or "Settings", what screens are truly necessary?'},
{icon:'😄',name:'Humorist',hint:'Which screen could be designed so beautifully that users take screenshots to share?'},
{icon:'🧭',name:'Adventurer',hint:'Start with the hardest screen first — everything else will feel easy. Which is the hardest?'}
]}
},
payment:{
ja:{title:'決済・CMS・EC',desc:'Stripe=最も導入しやすい。MoR=税務処理代行。',example:'SaaS→Stripe、グローバル→Paddle'},
en:{title:'Payment/CMS/EC',desc:'Stripe is easiest to integrate. MoR = Merchant of Record (handles tax).',example:'SaaS→Stripe, Global→Paddle'}
},
css_fw:{
ja:{title:'CSSフレームワーク',desc:'Tailwind CSSが2026年の事実上の標準。ユーティリティファーストで高速開発。',example:'推奨: Tailwind CSS + shadcn/ui'},
en:{title:'CSS Framework',desc:'Tailwind CSS is the de facto standard in 2026. Utility-first for rapid dev.',example:'Recommended: Tailwind CSS + shadcn/ui'}
},
orm:{
ja:{title:'ORM',desc:'ORMはデータベース操作を型安全に行うためのツール。BaaS使用時は不要。',example:'推奨: Prisma (型安全・Studio付き)'},
en:{title:'ORM',desc:'ORM enables type-safe database operations. Not needed with BaaS.',example:'Recommended: Prisma (type-safe, Studio included)'}
},
dev_env_type:{
ja:{title:'開発環境タイプ',desc:'BaaS利用時の開発ワークフローを選択します。',example:'ローカル=オフライン開発可能、クラウド=本番相当データ、ハイブリッド=両方'},
en:{title:'Dev Environment Type',desc:'Choose development workflow when using BaaS.',example:'Local=offline OK, Cloud=production data, Hybrid=both'}
},
learning_path:{
ja:{title:'学習パターン',desc:'技術スタックの組み合わせに基づいた学習パスを選択。',example:'初心者→BaaS、中級→PERN、上級→AI Orchestrator'},
en:{title:'Learning Path',desc:'Choose a learning path based on your tech stack combination.',example:'Beginner→BaaS, Intermediate→PERN, Advanced→AI Orchestrator'}
},
skill_level:{
ja:{title:'スキルレベル',desc:'選択により質問の選択肢が動的に変化します。Beginner=基本選択肢のみ、Intermediate=中級選択肢追加、Pro=全選択肢解放。途中変更は非推奨。',example:'迷ったらIntermediate。後から選択肢が足りなければProに変更可能'},
en:{title:'Skill Level',desc:'Your choice dynamically adjusts available options. Beginner=basic options only, Intermediate=adds mid-level options, Pro=unlocks all. Avoid changing mid-project.',example:'If unsure, pick Intermediate. You can switch to Pro later if needed'}
},
database:{
ja:{title:'データベース',desc:'PostgreSQL=本格的なRDB（Supabase/Neonで無料運用可）、SQLite=ローカル/組込み用途、MongoDB=NoSQL柔軟なスキーマ。BaaS選択時はBaaS側のDBが使われるため不要。',example:'迷ったらPostgreSQL + Prisma。Supabaseなら無料で本番運用可能'},
en:{title:'Database',desc:'PostgreSQL=production RDB (free via Supabase/Neon), SQLite=local/embedded, MongoDB=NoSQL flexible schema. Not needed if using BaaS (BaaS provides its own DB).',example:'Default: PostgreSQL + Prisma. Supabase offers free production hosting'}
},
mobile:{
ja:{title:'モバイル対応',desc:'PWA=Webベースでインストール不要、Expo=React Native簡易構築（EAS Build対応）、React Native=ネイティブ制御が必要な場合。モバイル不要なら「なし」でOK。',example:'まずPWAで検証、ストア配信が必要になったらExpoに移行が最速ルート'},
en:{title:'Mobile Support',desc:'PWA=web-based no install needed, Expo=simplified React Native (EAS Build), React Native=when native control needed. Select "None" if mobile is not required.',example:'Start with PWA for validation, migrate to Expo when store distribution is needed'}
},
ai_auto:{
ja:{title:'AI自律開発レベル',desc:'Vibe Coding=AIにざっくり指示してコード生成、Agentic Dev=Cursor Agent/Cline等がマルチファイル自動編集、Multi-Agent=複数Agentが並列作業、Full Autonomous=Claude Code Subagents/Jules等で非同期自律開発。',example:'初心者→Vibe Coding、中級→Agentic Dev、上級→Multi-Agent以上'},
en:{title:'AI Autonomous Level',desc:'Vibe Coding=rough instructions to AI, Agentic Dev=Cursor Agent/Cline multi-file editing, Multi-Agent=parallel agent work, Full Autonomous=Claude Code Subagents/Jules async development.',example:'Beginner→Vibe Coding, Intermediate→Agentic Dev, Advanced→Multi-Agent+'}
},
learning_goal:{
ja:{title:'学習目標',desc:'このプロジェクトで習得したい技術領域を選択。選択に応じてロードマップの学習パスが最適化されます。',example:'「フルスタック開発」を選ぶとフロントからデプロイまで網羅的なパスが生成されます'},
en:{title:'Learning Goal',desc:'Select the technical area you want to master through this project. The roadmap learning path optimizes based on your selection.',example:'Choosing "Full-Stack Dev" generates a comprehensive path from frontend to deployment'}
},
};
const COMPAT_RULES=[
// ── FE ↔ Mobile (2 ERROR) ──
{id:'fe-mob-expo',p:['frontend','mobile'],lv:'error',
t:a=>inc(a.mobile,'Expo')&&!inc(a.frontend,'React'),
ja:'ExpoはReact Native専用です。フロントをReact系に変更してください',
en:'Expo requires React. Change frontend to a React-based option',
fix:{f:'frontend',s:'React + Next.js'}},
{id:'fe-mob-astro',p:['frontend','mobile'],lv:'error',
t:a=>inc(a.frontend,'Astro')&&inc(a.mobile,'Expo'),
ja:'AstroはSSG専用でExpoと併用できません。React + Next.jsを推奨',
en:'Astro is SSG-only and incompatible with Expo. Use React + Next.js',
fix:{f:'frontend',s:'React + Next.js'}},
{id:'be-mobile-static',p:['backend','mobile'],lv:'info',
t:a=>isStaticBE(a)&&a.mobile&&!inc(a.mobile,'なし')&&!inc(a.mobile,'None')&&a.mobile!=='none'&&!inc(a.mobile,'PWA'),
ja:'モバイルアプリにはAPI用バックエンドが必要です。Supabase/Firebase等のBaaSを検討してください',
en:'Mobile apps need an API backend. Consider BaaS like Supabase/Firebase',
fix:{f:'backend',s:'Supabase'}},
// ── Mobile ↔ Auth (3 WARN) ──
{id:'mob-noauth',p:['mobile','auth'],lv:'warn',
t:a=>{
if(!a.mobile||!a.auth)return false;
const hasMobile=a.mobile&&!inc(a.mobile,'なし')&&!inc(a.mobile,'None')&&a.mobile!=='none'&&!inc(a.mobile,'PWA');
const hasAuth=a.auth&&!inc(a.auth,'なし')&&!inc(a.auth,'None')&&a.auth!=='none';
return hasMobile&&!hasAuth;
},
ja:'モバイルアプリでは認証がほぼ必須です。Supabase Auth/Firebase Auth推奨',
en:'Mobile apps almost always need authentication. Use Supabase Auth/Firebase Auth',
fix:{f:'auth',s:'Supabase Auth'}},
{id:'mob-auth-nextauth',p:['mobile','auth'],lv:'warn',
t:a=>a.mobile&&inc(a.mobile,'Expo')&&inc(a.auth,'NextAuth'),
ja:'NextAuthはWeb専用。React Nativeには@react-native-google-signin等のアダプター必要',
en:'NextAuth is web-only. React Native needs adapters like @react-native-google-signin',
fix:{f:'auth',s:'Supabase Auth'}},
{id:'mob-auth-flutter-nextauth',p:['mobile','auth'],lv:'warn',
t:a=>a.mobile&&inc(a.mobile,'Flutter')&&(inc(a.auth,'NextAuth')||inc(a.auth,'Auth.js')),
ja:'FlutterではNextAuth/Auth.jsは直接利用できません。Firebase Auth/Supabase Auth推奨',
en:'NextAuth/Auth.js is web-only. Flutter needs Firebase Auth/Supabase Auth',
fix:{f:'auth',s:'Supabase Auth'}},
// ── BE ↔ ORM (3 ERROR, 1 WARN) ──
{id:'be-orm-py-prisma',p:['backend','orm'],lv:'error',
t:a=>isPyBE(a)&&inc(a.orm,'Prisma')||isPyBE(a)&&inc(a.orm,'Drizzle')||isPyBE(a)&&inc(a.orm,'TypeORM'),
ja:'Prisma/Drizzle/TypeORMはNode.js専用です。SQLAlchemyを選択してください',
en:'Prisma/Drizzle/TypeORM are Node.js-only. Choose SQLAlchemy',
fix:{f:'orm',s:'SQLAlchemy (Python)'}},
{id:'be-orm-java-prisma',p:['backend','orm'],lv:'error',
t:a=>(inc(a.backend,'Java')||inc(a.backend,'Go'))&&(inc(a.orm,'Prisma')||inc(a.orm,'Drizzle')),
ja:'Prisma/DrizzleはNode.js/TypeScript専用です',
en:'Prisma/Drizzle are Node.js/TypeScript-only',
fix:{f:'orm',s:'None / Using BaaS'}},
{id:'be-orm-node-sqla',p:['backend','orm'],lv:'error',
t:a=>isNodeBE(a)&&inc(a.orm,'SQLAlchemy'),
ja:'SQLAlchemyはPython専用です。Prisma/Drizzleを選択してください',
en:'SQLAlchemy is Python-only. Choose Prisma or Drizzle',
fix:{f:'orm',s:'Prisma'}},
{id:'be-orm-static',p:['backend','orm'],lv:'warn',
t:a=>isStaticBE(a)&&a.orm&&!inc(a.orm,'なし')&&!inc(a.orm,'None')&&a.orm!=='none',
ja:'静的サイトではORMは不要です',
en:'ORM is unnecessary for static sites',
fix:{f:'orm',s:'None / Using BaaS'}},
// ── BE ↔ DB (4 WARN) ──
{id:'be-db-fb-notfs',p:['backend','database'],lv:'warn',
t:a=>inc(a.backend,'Firebase')&&a.database&&!inc(a.database,'Firestore'),
ja:'Firebase利用時はFirestoreが最適です',
en:'Firestore is the optimal DB for Firebase',
fix:{f:'database',s:'Firestore'}},
{id:'be-db-supa-notpg',p:['backend','database'],lv:'warn',
t:a=>inc(a.backend,'Supabase')&&a.database&&!inc(a.database,'Supabase')&&!inc(a.database,'PostgreSQL')&&!inc(a.database,'Neon'),
ja:'Supabase利用時はSupabase (PostgreSQL)が統合されています',
en:'Supabase integrates best with Supabase (PostgreSQL)',
fix:{f:'database',s:'Supabase (PostgreSQL)'}},
{id:'be-db-static-db',p:['backend','database'],lv:'warn',
t:a=>isStaticBE(a)&&a.database&&!inc(a.database,'なし')&&a.database!=='None',
ja:'静的サイトではDBは通常不要です',
en:'Static sites typically do not need a database',
fix:{f:'database',s:'None'}},
{id:'be-db-py-fs',p:['backend','database'],lv:'warn',
t:a=>isPyBE(a)&&inc(a.database,'Firestore'),
ja:'PythonとFirestoreの相性は中程度。PostgreSQLが推奨です',
en:'Python + Firestore compatibility is moderate. PostgreSQL recommended',
fix:{f:'database',s:'PostgreSQL'}},
// ── BE ↔ Deploy (7 WARN) ──
{id:'be-dep-java-vercel',p:['backend','deploy'],lv:'warn',
t:a=>(inc(a.backend,'Java')||inc(a.backend,'Go'))&&inc(a.deploy,'Vercel'),
ja:'VercelはNode.js/Python前提です。Railway/AWS/Dockerが必要',
en:'Vercel supports Node.js/Python. Use Railway/AWS/Docker for Java/Go',
fix:{f:'deploy',s:'Railway'}},
{id:'be-dep-fb-notfbh',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'Firebase')&&a.deploy&&!inc(a.deploy,'Firebase'),
ja:'Firebase利用時はFirebase Hostingが最適です',
en:'Firebase Hosting is optimal when using Firebase backend',
fix:{f:'deploy',s:'Firebase Hosting'}},
{id:'be-dep-supa-fbh',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'Supabase')&&inc(a.deploy,'Firebase'),
ja:'SupabaseにはVercelまたはSupabase Hostingが推奨です',
en:'Use Vercel or Supabase Hosting with Supabase backend',
fix:{f:'deploy',s:'Vercel'}},
{id:'be-dep-nest-vercel',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'NestJS')&&inc(a.deploy,'Vercel'),
ja:'NestJSのサーバーレスデプロイは制限があります。Railwayが推奨',
en:'NestJS serverless deploys have limitations. Railway recommended',
fix:{f:'deploy',s:'Railway'}},
{id:'be-dep-django-vercel',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'Django')&&inc(a.deploy,'Vercel'),
ja:'DjangoのVercelデプロイは制限あり。Railway/Fly.ioが推奨',
en:'Django on Vercel has limitations. Railway/Fly.io recommended',
fix:{f:'deploy',s:'Railway'}},
{id:'be-dep-heavy-netlify',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.deploy,'Netlify')&&(inc(a.backend,'Django')||inc(a.backend,'Spring')||inc(a.backend,'Laravel')),
ja:'Django/Spring/LaravelのNetlifyデプロイは大幅な制限があります。Railway推奨',
en:'Django/Spring/Laravel have severe limitations on Netlify. Railway recommended',
fix:{f:'deploy',s:'Railway'}},
{id:'be-dep-nest-netlify',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'NestJS')&&inc(a.deploy,'Netlify'),
ja:'NestJSのNetlifyデプロイは制限があります。Railway推奨',
en:'NestJS on Netlify has limitations. Railway recommended',
fix:{f:'deploy',s:'Railway'}},
// ── FE ↔ Deploy (2 WARN) ──
{id:'fe-dep-angular-vercel',p:['frontend','deploy'],lv:'warn',
t:a=>inc(a.frontend,'Angular')&&inc(a.deploy,'Vercel'),
ja:'AngularのVercel対応は限定的。Firebase HostingまたはAWSが推奨',
en:'Angular on Vercel is limited. Use Firebase Hosting or AWS',
fix:{f:'deploy',s:'Firebase Hosting'}},
{id:'fe-dep-nuxt-fbh',p:['frontend','deploy'],lv:'warn',
t:a=>inc(a.frontend,'Nuxt')&&inc(a.deploy,'Firebase'),
ja:'Nuxt 3はVercel/Netlifyが最適デプロイ先です',
en:'Nuxt 3 deploys best on Vercel or Netlify',
fix:{f:'deploy',s:'Vercel'}},
// ── AI Auto ↔ Skill (3 WARN) ──
{id:'ai-sk-auto-beg',p:['ai_auto','skill_level'],lv:'warn',
t:a=>inc(a.ai_auto,'自律')||inc(a.ai_auto,'Autonomous'),
ja:'フル自律開発には上級スキルが必要です。段階的に進めましょう',
en:'Full autonomous dev requires advanced skills. Progress gradually',
cond:a=>a.skill_level==='Beginner'},
{id:'ai-sk-orch-notpro',p:['ai_auto','skill_level'],lv:'warn',
t:a=>(inc(a.ai_auto,'オーケストレーター')||inc(a.ai_auto,'Orchestrator'))&&a.skill_level!=='Professional',
ja:'オーケストレーターはCI/CD統合の経験が必要です',
en:'Orchestrator requires CI/CD integration experience'},
{id:'ai-sk-multi-beg',p:['ai_auto','skill_level'],lv:'warn',
t:a=>(inc(a.ai_auto,'マルチ')||inc(a.ai_auto,'Multi'))&&a.skill_level==='Beginner',
ja:'マルチAgent協調は中級以上の経験が推奨です',
en:'Multi-Agent coordination recommended for intermediate+'},
// ── BE ↔ Payment (2 WARN) ──
{id:'be-pay-static-stripe',p:['backend','payment'],lv:'warn',
t:a=>isStaticBE(a)&&a.payment&&(inc(a.payment,'Stripe')),
ja:'Stripe webhookにはサーバーが必要。Supabase Edge Functionsで対応可能',
en:'Stripe webhooks need a server. Supabase Edge Functions can help',
fix:{f:'backend',s:'Supabase'}},
{id:'be-pay-saleor-notpy',p:['backend','payment'],lv:'warn',
t:a=>a.payment&&inc(a.payment,'Saleor')&&!isPyBE(a),
ja:'SaleorはPython/Django製です。Python系バックエンドが必要',
en:'Saleor is built with Python/Django. Python backend required',
fix:{f:'backend',s:'Python + Django'}},
{id:'ai-antigravity-windsurf',p:['ai_tools'],lv:'warn',
t:a=>inc(a.ai_tools,'Antigravity')&&inc(a.ai_tools,'Windsurf'),
ja:'AntigravityはWindsurf統合版です。どちらか一方で十分です',
en:'Antigravity integrates Windsurf. One is sufficient',
fix:{f:'ai_tools',s:'Google Antigravity'}},
{id:'ai-openrouter-hub',p:['ai_tools'],lv:'info',
t:a=>inc(a.ai_tools,'OpenRouter'),
ja:'OpenRouterはBYOKハブです。Aider/Cline等のAPIバックエンドとして活用できます',
en:'OpenRouter is a BYOK hub. Use as API backend for Aider/Cline etc.'},
// ── ORM ↔ DB (2 WARN/ERROR) ──
{id:'orm-prisma-mongo',p:['orm','database'],lv:'warn',
t:a=>inc(a.orm,'Prisma')&&inc(a.database,'MongoDB'),
ja:'PrismaのMongoDB対応はPreview段階です。本番環境では注意が必要',
en:'Prisma MongoDB support is in Preview. Use with caution in production'},
{id:'orm-drizzle-fs',p:['orm','database'],lv:'error',
t:a=>inc(a.orm,'Drizzle')&&inc(a.database,'Firestore'),
ja:'DrizzleはSQL専用です。Firestore非対応',
en:'Drizzle is SQL-only, not compatible with Firestore',
fix:{f:'orm',s:'None / Using BaaS'}},
{id:'orm-drizzle-mongo',p:['orm','database'],lv:'error',
t:a=>inc(a.orm,'Drizzle')&&inc(a.database,'MongoDB'),
ja:'DrizzleはSQL専用です。MongoDB非対応',
en:'Drizzle is SQL-only, not compatible with MongoDB',
fix:{f:'orm',s:'Prisma'}},
// ── Deploy ↔ DB (2 WARN/INFO) ──
{id:'dep-db-vercel-pg',p:['deploy','database'],lv:'warn',
t:a=>inc(a.deploy,'Vercel')&&inc(a.database,'PostgreSQL')&&!inc(a.database,'Neon')&&!inc(a.database,'Supabase'),
ja:'Vercel+PostgreSQLは外部ホスティング必要。Neon/Supabase/Vercel Postgresを推奨',
en:'Vercel+PostgreSQL needs external hosting. Use Neon/Supabase/Vercel Postgres',
fix:{f:'database',s:'Neon (PostgreSQL)'}},
{id:'dep-db-cf-pg',p:['deploy','database'],lv:'info',
t:a=>inc(a.deploy,'Cloudflare')&&inc(a.database,'PostgreSQL'),
ja:'Cloudflare Workers→外部DBはHyperdriveまたはD1への移行を推奨',
en:'Cloudflare Workers → external DB: use Hyperdrive or consider D1'},
{id:'dep-db-cf-fs',p:['deploy','database'],lv:'warn',
t:a=>inc(a.deploy,'Cloudflare')&&inc(a.database,'Firestore'),
ja:'Cloudflare Workers + Firestoreはレイテンシー高。D1/KV/Durableを推奨',
en:'Cloudflare + Firestore has high latency. Consider D1/KV/Durable Objects',
fix:{f:'deploy',s:'Firebase Hosting'}},
// ── Deploy ↔ Backend (Cloudflare Workers compatibility) (1 ERROR, 1 WARN, 1 INFO) ──
{id:'be-dep-heavy-cf',p:['backend','deploy'],lv:'error',
t:a=>inc(a.deploy,'Cloudflare')&&(inc(a.backend,'Django')||inc(a.backend,'Spring')||inc(a.backend,'Laravel')),
ja:'Django/Spring/LaravelはCloudflare Workers非対応（V8制限）。Hono/Express推奨',
en:'Django/Spring/Laravel incompatible with Cloudflare Workers (V8 limits). Use Hono/Express',
fix:{f:'backend',s:'Node.js + Hono'}},
{id:'be-dep-node-cf',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.deploy,'Cloudflare')&&(inc(a.backend,'Express')||inc(a.backend,'NestJS'))&&!inc(a.backend,'Hono'),
ja:'Express/NestJSは一部Node API非対応。Cloudflare Workers最適化にはHono推奨',
en:'Express/NestJS have Node API limitations on Cloudflare. Hono is optimized for Workers',
fix:{f:'backend',s:'Node.js + Hono'}},
{id:'be-dep-hono-cf',p:['backend','deploy'],lv:'info',
t:a=>inc(a.deploy,'Cloudflare')&&inc(a.backend,'Hono'),
ja:'✨ Hono + Cloudflare Workersは最適な組み合わせです（超高速Edge実行）',
en:'✨ Hono + Cloudflare Workers is optimal (ultra-fast edge execution)'},
// ── Domain ↔ Auth/Payment (2 ERROR/WARN) ──
{id:'dom-sec-noauth',p:['purpose','auth'],lv:'error',
t:a=>{
if(!a.purpose||!a.auth)return false;
const dom=detectDomain(a.purpose);
const highSecDomains=['fintech','health','legal'];
const hasAuth=a.auth&&!inc(a.auth,'なし')&&!inc(a.auth,'None')&&a.auth!=='none';
return highSecDomains.includes(dom)&&!hasAuth;
},
ja:'金融/医療/法務ドメインでは認証必須です',
en:'Auth is required for fintech/health/legal domains',
fix:{f:'auth',s:'Supabase Auth'}},
{id:'dom-ec-nopay',p:['purpose','payment'],lv:'warn',
t:a=>{
if(!a.purpose||!a.payment)return false;
const dom=detectDomain(a.purpose);
const hasPay=a.payment&&!inc(a.payment,'なし')&&!inc(a.payment,'None')&&a.payment!=='none';
return dom==='ec'&&!hasPay;
},
ja:'ECドメインで決済未選択です。Stripe等の決済方式を検討してください',
en:'EC domain without payment. Consider Stripe or other payment methods'},
// ── AI Auto ↔ Tools (1 WARN) ──
{id:'ai-auto-notools',p:['ai_auto','ai_tools'],lv:'warn',
t:a=>{
if(!a.ai_auto||!a.ai_tools)return false;
const hasAuto=a.ai_auto&&!inc(a.ai_auto,'なし')&&!inc(a.ai_auto,'None')&&a.ai_auto!=='none';
const hasTools=a.ai_tools&&!inc(a.ai_tools,'なし')&&!inc(a.ai_tools,'None')&&a.ai_tools!=='none';
return hasAuto&&!hasTools;
},
ja:'AI自律レベル設定済みですが、AIツール未選択です。Cursor/Claude Code等を選択してください',
en:'AI autonomous level set but no AI tools selected. Choose Cursor/Claude Code etc.'},
// ── Convex ↔ FE/ORM (2 WARN/INFO) ──
{id:'be-convex-noreact',p:['backend','frontend'],lv:'warn',
t:a=>inc(a.backend,'Convex')&&!inc(a.frontend,'React')&&!inc(a.frontend,'Next'),
ja:'ConvexはReact最適化されています。React/Next.js推奨',
en:'Convex is optimized for React. React/Next.js recommended'},
{id:'be-convex-orm',p:['backend','orm'],lv:'info',
t:a=>inc(a.backend,'Convex')&&a.orm&&!inc(a.orm,'なし')&&!inc(a.orm,'None')&&a.orm!=='none',
ja:'ConvexはTypeScript定義で完結します。ORMは通常不要',
en:'Convex uses TypeScript definitions. ORM typically not needed',
fix:{f:'orm',s:'None / Using BaaS'}},
// ── Misc (3 INFO) ──
{id:'ai-tools-multi',p:['ai_tools'],lv:'info',
t:a=>{
if(!a.ai_tools)return false;
const tools=(a.ai_tools||'').split(',').filter(x=>x.trim()).length;
return tools>=3;
},
ja:'複数AIツール(3+)選択時は、CLAUDE.md等のAIルールが統一管理されます',
en:'Multiple AI tools (3+) selected: AI rules are unified via CLAUDE.md'},
{id:'mobile-expo-rn',p:['mobile'],lv:'info',
t:a=>inc(a.mobile,'bare')||inc(a.mobile,'Bare'),
ja:'React Native bareは柔軟性が高いですが、Expoの方が開発速度が速いです',
en:'React Native bare offers flexibility, but Expo is faster for development',
fix:{f:'mobile',s:'Expo (Managed)'}},
{id:'mob-flutter-firebase',p:['mobile','backend'],lv:'info',
t:a=>inc(a.mobile,'Flutter')&&inc(a.backend,'Firebase'),
ja:'✨ Flutter + Firebaseは最適な組み合わせです（FlutterFire統合）',
en:'✨ Flutter + Firebase is an excellent combination (FlutterFire integration)'},
{id:'mob-flutter-supabase',p:['mobile','backend'],lv:'info',
t:a=>inc(a.mobile,'Flutter')&&inc(a.backend,'Supabase'),
ja:'✨ Flutter + Supabaseは良い組み合わせです（supabase_flutter パッケージを使用）',
en:'✨ Flutter + Supabase works well — use the supabase_flutter package for native SDK access'},
{id:'mob-expo-drizzle',p:['mobile','orm'],lv:'warn',
t:a=>inc(a.mobile,'Expo')&&inc(a.orm,'Drizzle'),
ja:'DrizzleはサーバーサイドORMです。Expo(React Native)では動作しません。モバイルにはRNSQLiteまたはBaaSを使用してください',
en:'Drizzle is a server-side ORM and will not work in Expo (React Native). Use RN SQLite or a BaaS backend instead',
fix:{f:'orm',s:'Prisma'}},
// ── Semantic Consistency Rules (Phase A) ── 8 rules ──
// A1: scope_out「ネイティブ」 vs mobile有効
{id:'sem-scope-mobile',p:['scope_out','mobile'],lv:'error',
t:a=>(inc(a.scope_out,'ネイティブ')||inc(a.scope_out,'native')||inc(a.scope_out,'Native'))&&a.mobile&&a.mobile!=='none'&&!inc(a.mobile,'PWA'),
ja:'スコープ外に「ネイティブアプリ」がありますが、モバイル対応が有効です。生成文書が矛盾します — どちらかを修正してください',
en:'Scope excludes "native apps" but mobile support is enabled. Generated docs will conflict — fix one or the other'},
// A2: scope_out「決済/EC」 vs payment有効
{id:'sem-scope-payment',p:['scope_out','payment'],lv:'warn',
t:a=>(inc(a.scope_out,'決済')||inc(a.scope_out,'EC')||inc(a.scope_out,'payment')||inc(a.scope_out,'Payment'))&&a.payment&&!inc(a.payment,'なし')&&!inc(a.payment,'None')&&a.payment!=='none',
ja:'スコープ外に「決済/EC」がありますが、決済方式が選択されています。仕様書のスコープ定義に矛盾が生じます',
en:'Scope excludes "payment/EC" but a payment method is selected. Spec scope definition will conflict'},
// A3: scope_out「EC」 vs entities に Product/Order
{id:'sem-scope-entities',p:['scope_out','data_entities'],lv:'warn',
t:a=>(inc(a.scope_out,'EC')||inc(a.scope_out,'commerce')||inc(a.scope_out,'Commerce'))&&(inc(a.data_entities,'Product')||inc(a.data_entities,'Order')||inc(a.data_entities,'Cart')),
ja:'スコープ外に「EC」がありますが、エンティティにProduct/Orderが含まれています。ERとスコープが矛盾します',
en:'Scope excludes "EC" but entities include Product/Order. ER and scope will conflict'},
// A4: deploy=Vercel && backend=Express/Fastify（常駐サーバー型）
{id:'sem-deploy-express',p:['deploy','backend'],lv:'warn',
t:a=>inc(a.deploy,'Vercel')&&(inc(a.backend,'Express')||inc(a.backend,'Fastify'))&&!inc(a.frontend,'Next.js'),
ja:'VercelでExpress/Fastifyを動かすにはServerless Functionsに変換が必要です。Next.js API RoutesまたはRailway/Renderへの分離を検討してください',
en:'Running Express/Fastify on Vercel requires Serverless Functions. Consider Next.js API Routes or split to Railway/Render',
fix:{f:'deploy',s:'Railway'}},
// A5: backend=Supabase && auth に NextAuth/Auth.js
{id:'sem-auth-supa-nextauth',p:['auth','backend'],lv:'warn',
t:a=>inc(a.backend,'Supabase')&&(inc(a.auth,'NextAuth')||inc(a.auth,'Auth.js')),
ja:'Supabase利用時はSupabase Authが統合されています。NextAuth/Auth.jsとの併用は認証SoTが二重化します',
en:'Supabase includes built-in Auth. Using NextAuth/Auth.js creates dual auth sources of truth',
fix:{f:'auth',s:'Supabase Auth'}},
// A6: backend≠Supabase && auth に Supabase Auth
{id:'sem-auth-nosupa-supaauth',p:['auth','backend'],lv:'warn',
t:a=>!inc(a.backend,'Supabase')&&inc(a.auth,'Supabase Auth'),
ja:'Supabase Authが選択されていますが、バックエンドがSupabaseではありません。認証の接続先が不明確になります',
en:'Supabase Auth selected but backend is not Supabase. Auth connection target will be unclear',
fix:{f:'backend',s:'Supabase'}},
// A7: purpose=教育系 && entities に Product/Order（ドメイン不一致）
{id:'sem-purpose-entities',p:['purpose','data_entities'],lv:'info',
t:a=>(inc(a.purpose,'教育')||inc(a.purpose,'学習')||inc(a.purpose,'Education')||inc(a.purpose,'Learning')||inc(a.purpose,'LMS'))&&(inc(a.data_entities,'Product')||inc(a.data_entities,'Order')),
ja:'教育・学習系のプロジェクトにProduct/Orderエンティティがあります。教材販売が目的でなければCourse/Lessonへの変更を検討してください',
en:'Education project has Product/Order entities. Consider Course/Lesson unless this is for course sales',
fixFn:a=>({f:'data_entities',s:(a.data_entities||'').replace(/Product/g,'Course').replace(/Order/g,'Enrollment')})},
// A8: deploy=Vercel && backend含Express && frontend含Next.js（BFF曖昧）
{id:'sem-deploy-bff',p:['deploy','backend','frontend'],lv:'info',
t:a=>inc(a.deploy,'Vercel')&&inc(a.backend,'Express')&&inc(a.frontend,'Next.js'),
ja:'Next.js + Express + Vercelの構成です。ExpressをNext.js API Routesに統合するか、Expressを別ホスト（Railway等）にする設計判断が必要です。生成文書ではAPI Routes統合を前提とします',
en:'Next.js + Express + Vercel stack detected. Decide whether to merge Express into Next.js API Routes or host Express separately. Generated docs will assume API Routes integration'},
// ── Security Rules (3 rules: 1 ERROR + 2 WARN) ──
// S1: 金融/医療/法務 + MFA未設定
{id:'dom-sec-nomfa',p:['purpose','mvp_features'],lv:'warn',
t:a=>{
const dom=detectDomain(a.purpose||'');
if(!dom)return false;
const isSensitiveDomain=['fintech','health','legal'].includes(dom);
const hasMFA=inc(a.mvp_features,'MFA')||inc(a.mvp_features,'二要素')||inc(a.mvp_features,'2FA')||inc(a.mvp_features,'多要素');
return isSensitiveDomain&&!hasMFA;
},
ja:'金融/医療/法務系のプロジェクトですが、MFA（多要素認証）が設定されていません。セキュリティ強化のためMFA導入を推奨します',
en:'Finance/health/legal project without MFA (multi-factor authentication). MFA is strongly recommended for security'},
// S2: 決済あり + 認証なし
{id:'dom-sec-pay-noauth',p:['payment','auth'],lv:'error',
t:a=>{
const hasPay=a.payment&&!inc(a.payment,'なし')&&!inc(a.payment,'None')&&a.payment!=='none';
const noAuth=!a.auth||inc(a.auth,'なし')||inc(a.auth,'None')||a.auth==='none';
return hasPay&&noAuth;
},
ja:'決済機能が有効ですが、認証が設定されていません。決済機能には必ず認証が必要です',
en:'Payment is enabled but authentication is not configured. Payment features require authentication',
fix:{f:'auth',s:'Supabase Auth'}},
// S3: 機密エンティティ + 認証なし
{id:'dom-sec-sensitive-noauth',p:['data_entities','auth'],lv:'warn',
t:a=>{
const sensitiveEntities=['Patient','Transaction','Payment','MedicalRecord','Claim','Contract','Invoice','BankAccount','CreditCard','Prescription','Diagnosis'];
const hasSensitive=sensitiveEntities.some(e=>inc(a.data_entities,e));
const noAuth=!a.auth||inc(a.auth,'なし')||inc(a.auth,'None')||a.auth==='none';
return hasSensitive&&noAuth;
},
ja:'Patient/Transaction等の機密情報を扱うエンティティがありますが、認証が設定されていません。個人情報保護のため認証の導入を推奨します',
en:'Sensitive entities (Patient/Transaction/etc.) detected without authentication. Authentication is recommended for privacy protection',
fix:{f:'auth',s:'Supabase Auth'}},
];
// helpers
function inc(v,k){return v&&typeof v==='string'&&v.indexOf(k)!==-1;}
function isPyBE(a){return inc(a.backend,'Python')||inc(a.backend,'FastAPI')||inc(a.backend,'Django');}
function isNodeBE(a){return inc(a.backend,'Express')||inc(a.backend,'Fastify')||inc(a.backend,'NestJS')||inc(a.backend,'Hono');}
function isStaticBE(a){return inc(a.backend,'なし')||inc(a.backend,'None')||inc(a.backend,'static');}
function checkCompat(answers){
if(!answers)return[];
return COMPAT_RULES.filter(r=>{
try{
if(r.cond&&!r.cond(answers))return false;
const keys=r.p;
if(keys.some(k=>!answers[k]))return false;
return r.t(answers);
}catch(e){return false;}
}).map(r=>({id:r.id,pair:r.p,level:r.lv,msg:S.lang==='ja'?r.ja:r.en,fix:r.fix||(r.fixFn?r.fixFn(answers):null)}));
}
// ── Stack Synergy Score Data ──
const SYNERGY_FE_BE={'Next.js|Supabase':95,'Next.js|Firebase':92,'Next.js|Vercel':98,'Next.js|Express':85,'Next.js|NestJS':88,'Next.js|Convex':93,'React|Express':80,'React|Firebase':88,'React|Supabase':90,'Vue|Nuxt|Express':82,'Vue|Nuxt|Firebase':85,'Svelte|SvelteKit|Supabase':90,'Astro|static':95,'Astro|Supabase':88,'Angular|NestJS':90,'Angular|Firebase':92};
const SYNERGY_DEPLOY={'Next.js|Vercel':98,'Nuxt|Vercel':95,'Nuxt|Netlify':93,'SvelteKit|Vercel':94,'Astro|Vercel':96,'Astro|Netlify':95,'Astro|Cloudflare':93,'React|Vercel':90,'React|Netlify':88,'Firebase|Firebase':98,'Supabase|Vercel':95,'Express|Railway':92,'NestJS|Railway':94,'Django|Railway':93,'FastAPI|Railway':91,'Spring|Railway':88,'Convex|Vercel':96};
const SYNERGY_DOMAIN={'fintech|Supabase':15,'fintech|PostgreSQL':12,'fintech|Stripe':18,'health|Supabase':14,'health|PostgreSQL':12,'legal|PostgreSQL':10,'ec|Stripe':20,'ec|Saleor':18,'ec|Supabase':12,'education|Firebase':10,'education|Supabase':12,'saas|Supabase':15,'saas|Stripe':18,'iot|Firebase':12,'iot|Supabase':10,'community|Firebase':14,'content|Supabase':12,'marketplace|Stripe':15,
// Extended domain synergy coverage (32 domains)
'realestate|Supabase':12,'realestate|PostgreSQL':10,'realestate|Stripe':14,
'analytics|Supabase':14,'analytics|PostgreSQL':12,
'hr|Supabase':12,'hr|PostgreSQL':10,
'portfolio|Astro':18,'portfolio|Vercel':15,
'tool|Supabase':12,'tool|Vercel':10,
'ai|Supabase':14,'ai|Firebase':12,'ai|Stripe':10,
'automation|Supabase':12,'automation|Vercel':10,
'event|Stripe':16,'event|Supabase':12,
'gamify|Firebase':16,'gamify|Supabase':10,
'collab|Supabase':15,'collab|Firebase':14,'collab|Stripe':10,
'devtool|Supabase':12,'devtool|Stripe':14,'devtool|Vercel':12,
'creator|Stripe':18,'creator|Supabase':12,'creator|Firebase':10,
'newsletter|Supabase':14,'newsletter|Stripe':12,
'manufacturing|PostgreSQL':12,'manufacturing|Supabase':10,
'logistics|Supabase':12,'logistics|PostgreSQL':10,
'agriculture|Supabase':10,'agriculture|Firebase':8,
'energy|Supabase':12,'energy|PostgreSQL':10,
'media|Supabase':14,'media|Stripe':12,'media|Firebase':10,
'government|PostgreSQL':12,'government|Supabase':10,
'travel|Stripe':16,'travel|Supabase':14,
'insurance|PostgreSQL':12,'insurance|Supabase':10,'insurance|Stripe':12};
function calcSynergy(a){
if(!a||!a.frontend||!a.backend)return{overall:60,d1:60,d2:60,d3:60,d4:60,d5:60,domain:null};
const fe=a.frontend||'';const be=a.backend||'';const dep=a.deploy||'';const db=a.database||'';const pay=a.payment||'';
// D1: FE↔BE affinity
let d1=60;
const feKey=fe.split(' ')[0];const beKey=be.split(' ')[0]||be.split('+')[1]?.trim()||be;
const key1=feKey+'|'+beKey;const key2=fe.includes('Next')?'Next.js|'+beKey:null;
d1=SYNERGY_FE_BE[key1]||SYNERGY_FE_BE[key2]||60;
if(inc(fe,'React')&&inc(be,'Express'))d1=80;
if(inc(fe,'React')&&inc(be,'Supabase'))d1=90;
if(inc(fe,'Vue')&&inc(be,'Express'))d1=82;
if(inc(fe,'Svelte')&&inc(be,'Supabase'))d1=90;
// D2: Ecosystem unity
let d2=50;
const isBaaS=inc(be,'Firebase')||inc(be,'Supabase')||inc(be,'Convex');
if(isBaaS&&((inc(be,'Firebase')&&inc(db,'Firestore'))||(inc(be,'Supabase')&&inc(db,'Supabase'))||(inc(be,'Convex')&&!db)))d2+=20;
if(inc(fe,'Next')&&inc(dep,'Vercel'))d2+=15;
if(inc(fe,'Nuxt')&&(inc(dep,'Vercel')||inc(dep,'Netlify')))d2+=12;
if(inc(fe,'Astro')&&(inc(dep,'Vercel')||inc(dep,'Netlify')||inc(dep,'Cloudflare')))d2+=15;
d2=Math.min(100,d2);
// D3: Domain fit
let d3=60;
const dom=detectDomain(a.purpose||'');
if(dom){
const keys=[dom+'|'+beKey,dom+'|'+db.split(' ')[0],dom+'|'+pay.split(' ')[0]];
keys.forEach(k=>{if(SYNERGY_DOMAIN[k])d3+=SYNERGY_DOMAIN[k];});
d3=Math.min(100,d3);
}
// D4: Deploy alignment
let d4=60;
const depKey1=(fe.includes('Next')?'Next.js':feKey)+'|'+dep.split(' ')[0];
const depKey2=beKey+'|'+dep.split(' ')[0];
d4=SYNERGY_DEPLOY[depKey1]||SYNERGY_DEPLOY[depKey2]||60;
if(inc(be,'Firebase')&&inc(dep,'Firebase'))d4=98;
if(inc(be,'Supabase')&&inc(dep,'Vercel'))d4=95;
// D5: Complexity balance
let d5=70;
const skill=a.skill_level||'Intermediate';
const complexStack=(inc(be,'NestJS')||inc(be,'Spring')||inc(be,'Django'))?1:0;
const hasMobile=a.mobile&&!inc(a.mobile,'なし')&&!inc(a.mobile,'None')&&a.mobile!=='none'?1:0;
const hasPayment=pay&&!inc(pay,'なし')&&!inc(pay,'None')&&pay!=='none'?1:0;
const complexity=complexStack+hasMobile+hasPayment;
if(skill==='Beginner'&&complexity>=2)d5=40;
else if(skill==='Beginner'&&complexity===1)d5=60;
else if(skill==='Professional')d5=90;
else d5=70;
const overall=Math.round(d1*0.25+d2*0.25+d3*0.2+d4*0.2+d5*0.1);
return{overall,d1:Math.round(d1),d2:Math.round(d2),d3:Math.round(d3),d4:Math.round(d4),d5:Math.round(d5),domain:dom};
}
/* Each entry: { n: display name, u: URL }
Add new entries when new tech choices are added to questions.
Keys should match the lookup keys used in showRoadmapUI(). */
const RESOURCES={
/* Web Fundamentals */
html:{n:'MDN Web Docs',u:'https://developer.mozilla.org/ja/docs/Web'},
tailwind:{n:'Tailwind Docs',u:'https://tailwindcss.com/docs'},
js:{n:'javascript.info',u:'https://ja.javascript.info/'},
/* Frontend Frameworks */
react:{n:'React Docs',u:'https://react.dev/learn'},
nextjs:{n:'Next.js Docs',u:'https://nextjs.org/docs'},
vue:{n:'Vue.js Guide',u:'https://ja.vuejs.org/guide/introduction'},
svelte:{n:'Svelte Tutorial',u:'https://svelte.dev/tutorial'},
astro:{n:'Astro Docs',u:'https://docs.astro.build'},
angular:{n:'Angular Docs',u:'https://angular.dev/overview'},
remix:{n:'Remix Docs',u:'https://remix.run/docs/en/main'},
/* UI Libraries */
shadcn:{n:'shadcn/ui',u:'https://ui.shadcn.com/docs'},
/* State & Data */
zustand:{n:'Zustand',u:'https://zustand-demo.pmnd.rs/'},
rquery:{n:'TanStack Query',u:'https://tanstack.com/query/latest'},
/* Testing */
vitest:{n:'Vitest',u:'https://vitest.dev/guide/'},
/* Backend Runtimes */
node:{n:'Node.js Docs',u:'https://nodejs.org/docs/latest/api/'},
express:{n:'Express.js',u:'https://expressjs.com/'},
fastify:{n:'Fastify',u:'https://fastify.dev/docs/latest/'},
nestjs:{n:'NestJS',u:'https://docs.nestjs.com/'},
fastapi:{n:'FastAPI',u:'https://fastapi.tiangolo.com/'},
django:{n:'Django',u:'https://docs.djangoproject.com/'},
spring:{n:'Spring Boot',u:'https://spring.io/guides'},
go:{n:'Go Gin',u:'https://gin-gonic.com/docs/'},
hono:{n:'Hono',u:'https://hono.dev/docs/'},
/* ORM */
prisma:{n:'Prisma Docs',u:'https://www.prisma.io/docs'},
drizzle:{n:'Drizzle ORM',u:'https://orm.drizzle.team/docs/overview'},
typeorm:{n:'TypeORM',u:'https://typeorm.io/'},
sqlalchemy:{n:'SQLAlchemy',u:'https://docs.sqlalchemy.org/'},
kysely:{n:'Kysely',u:'https://kysely.dev/docs/intro'},
/* BaaS / DB */
firebase:{n:'Firebase Docs',u:'https://firebase.google.com/docs'},
supabase:{n:'Supabase Docs',u:'https://supabase.com/docs'},
postgres:{n:'PostgreSQL Docs',u:'https://www.postgresql.org/docs/'},
mongo:{n:'MongoDB Manual',u:'https://www.mongodb.com/docs/manual/'},
mysql:{n:'MySQL Docs',u:'https://dev.mysql.com/doc/'},
redis:{n:'Redis Docs',u:'https://redis.io/docs/'},
neon:{n:'Neon Docs',u:'https://neon.tech/docs'},
/* Auth */
nextauth:{n:'Auth.js',u:'https://authjs.dev/'},
clerk:{n:'Clerk Docs',u:'https://clerk.com/docs'},
/* Mobile */
expo:{n:'Expo Docs',u:'https://docs.expo.dev/'},
flutter:{n:'Flutter Docs',u:'https://docs.flutter.dev/'},
rn:{n:'React Native',u:'https://reactnative.dev/docs/getting-started'},
/* DevOps */
docker:{n:'Docker Docs',u:'https://docs.docker.com/'},
ghactions:{n:'GitHub Actions',u:'https://docs.github.com/actions'},
/* Deploy */
vercel:{n:'Vercel Docs',u:'https://vercel.com/docs'},
cloudflare:{n:'CF Pages',u:'https://developers.cloudflare.com/pages/'},
railway:{n:'Railway Docs',u:'https://docs.railway.com/'},
/* AI Dev */
cursor:{n:'Cursor Docs',u:'https://docs.cursor.com/'},
claudecode:{n:'Claude Code',u:'https://docs.anthropic.com/en/docs/claude-code'},
mcp:{n:'MCP Spec',u:'https://modelcontextprotocol.io/'},
copilot:{n:'GitHub Copilot',u:'https://docs.github.com/copilot'},
windsurf:{n:'Windsurf Docs',u:'https://docs.windsurf.com/'},
antigravity:{n:'Google Antigravity',u:'https://antigravity.google/'},
openrouter:{n:'OpenRouter Docs',u:'https://openrouter.ai/docs'},
augment:{n:'Augment Code',u:'https://www.augmentcode.com/'},
aider:{n:'Aider Docs',u:'https://aider.chat/docs/'},
jules:{n:'Jules (Google)',u:'https://jules.google/'},
amazonq:{n:'Amazon Q Developer',u:'https://aws.amazon.com/q/developer/'},
geminiassist:{n:'Gemini Code Assist',u:'https://cloud.google.com/gemini/docs/codeassist/overview'},
junie:{n:'JetBrains Junie',u:'https://www.jetbrains.com/junie/'},
tabnine:{n:'Tabnine',u:'https://www.tabnine.com/'},
/* Payments */
stripe:{n:'Stripe Docs',u:'https://docs.stripe.com/'},
paddle:{n:'Paddle Docs',u:'https://developer.paddle.com/'},
/* Dev Methods */
tdd:{n:'TDD Guide',u:'https://martinfowler.com/bliki/TestDrivenDevelopment.html'},
bdd:{n:'BDD Intro',u:'https://cucumber.io/docs/bdd/'},
ddd:{n:'DDD Reference',u:'https://www.domainlanguage.com/ddd/reference/'},
sdd:{n:'SDD Overview',u:'https://en.wikipedia.org/wiki/Specification-driven_development'},
fdd:{n:'FDD Guide',u:'https://en.wikipedia.org/wiki/Feature-driven_development'},
};
const GT=(()=>{
const ja={
none:'なし',
/* LEARNING_PATH.md */
lp_title:'学習ロードマップ',lp_skill:'スキルレベル',lp_target:'目標期間',
l1:'Web基盤',l2:'フロントエンド',l3:'バックエンド',l3m:'モバイル',
l4:'DevOps',l5:'AI駆動開発',l6:'収益化',l7:'駆動開発手法',l7span:'全期間',
html5b:'HTML5 基礎（2-4週）',css3b:'CSS3 基礎（3-6週）',jsb:'JavaScript ES6+（4-12週）',
tsAdv:'TypeScript ディープダイブ',cssAdv:'最新CSS (Container Queries, :has())',
setup:'セットアップ・基礎',stMgmt:'状態管理',dataFetch:'データフェッチ',
testing:'テスト',dbDesign:'データベース設計',auth:'認証・認可',
mobEnv:'環境構築',mobNav:'ナビゲーション・画面設計',
mobNative:'ネイティブ機能（カメラ/通知）',mobStore:'ストアビルド・提出',
deploy:'デプロイ',monitor:'モニタリング基盤',aiUse:'活用',
mcpCfg:'MCP設定・活用',aiOpt:'AI Agent Rules 最適化',practice:'実践',
billing:'課金フロー実装',opsScale:'運用・スケール',
/* Post-MVP Feature Roadmap section */
ff_title:'機能拡張ロードマップ',ff_span:'MVP完成後',ff_integrate:'の実装',
/* Learning path label */
lp_path:'学習パス',
/* TECH_STACK_GUIDE.md */
ts_title:'技術スタックガイド',ts_selected:'選択された技術スタック',
cat:'カテゴリ',tech:'技術',rationale:'理由',
feLabel:'フロントエンド',beLabel:'バックエンド',dbLabel:'データベース',
deployLabel:'デプロイ',mobileLabel:'モバイル',payLabel:'決済/CMS',
nextR:'SSR/SSG対応、SEO最適化',vueR:'学習コスト低、柔軟性',feGenR:'高性能、エコシステム充実',
supaR:'BaaS型、高速MVP開発',expR:'軽量、学習コスト低',nestR:'エンタープライズ対応、DI',beGenR:'スケーラブル',
pgR:'ACID準拠、JSON対応、Supabase互換',dbGenR:'柔軟なスキーマ',
vercelR:'Next.js最適化、自動デプロイ',deployGenR:'高い柔軟性',
expoR:'React知識転用、OTA更新',mobGenR:'クロスプラットフォーム対応',
payR:'SaaS/EC収益化基盤',
ts_deps:'技術間の関連性',ts_versions:'推奨バージョン',
/* MOBILE_GUIDE.md */
mob_title:'モバイル開発ガイド',mob_env:'環境構築',mob_dir:'ディレクトリ構造',
mob_home:'ホーム画面',mob_explore:'探索画面',mob_profile:'プロフィール',
mob_root:'ルートレイアウト',mob_eas:'設定',mob_libs:'推奨ライブラリ',
mob_anim:'アニメーション',mob_list:'高速リスト',mob_img:'画像最適化',
mob_none:'現在のプロジェクトではモバイル開発は対象外です。\n将来的にExpo (React Native)での対応を推奨します。',
/* TOOLS_SETUP.md */
tool_title:'開発ツールセットアップガイド',tool_essential:'必須ツール',
tool_rec:'推奨',tool_pkgmgr:'パッケージマネージャー',tool_init:'プロジェクト初期化',
tool_docker:'データベース (Docker使用)',tool_ai:'AIコーディングツール',
tool_ext:'拡張機能',tool_used:'使用時',tool_vsInst:'VS Code拡張からインストール',
tool_official:'公式サイトからインストール',tool_env:'環境変数テンプレート',
/* RESOURCES.md */
res_title:'学習リソース集',res_official:'公式ドキュメント',
res_ai:'AI駆動開発',res_bp:'ベストプラクティス',res_docs:'ドキュメント',
res_proto:'プロトコル',res_patterns:'パターン',
res_books:'推奨書籍・コース',res_fullstack:'フルスタックWeb開発入門',
res_tsPractice:'TypeScript実践ガイド',res_design:'で学ぶ設計原則',
res_saas:'SaaS開発とStripe決済実装',res_headless:'ヘッドレスアーキテクチャ入門',
res_beg:'初心者向け',res_int:'中級者向け',
/* MILESTONES.md */
ms_title:'マイルストーン計画',ms_target:'目標期間',
ms_m:['環境構築・基礎','コア機能実装','UI/UX・テスト','デプロイ・CI/CD','最適化・モニタリング','本番運用・改善','スケール・次フェーズ'],
ms_criteria:'マイルストーン達成基準を定義',ms_review:'週次レビュー実施',ms_retro:'振り返り・改善',
/* AI_WORKFLOW.md */
aiw_title:'AI駆動開発ワークフローガイド',aiw_flow:'AI開発フロー',
aiw_s1:'.spec/ を読む',aiw_s2:'タスク選択',aiw_s3:'AI実装',aiw_s4:'レビュー',aiw_s5:'テスト',aiw_s6:'コミット',
aiw_select:'AIツール使い分け',aiw_task:'タスク',aiw_rec:'推奨ツール',
aiw_newfile:'新規ファイル作成',aiw_bugfix:'バグ修正',aiw_testgen:'テスト生成',aiw_refactor:'リファクタリング',
aiw_ctx:'コンテキスト理解',aiw_term:'ターミナル直接操作',aiw_inline:'インライン補完',aiw_multi:'マルチファイル編集',
aiw_mcp:'MCP活用パターン',aiw_mcp1:'最新ライブラリドキュメント参照',aiw_mcp2:'プロジェクト構造の理解',aiw_mcp3:'E2Eテスト自動化',
aiw_prompt:'プロンプトテンプレート',aiw_addFeature:'新機能追加',
aiw_promptText:`.spec/tasks.mdの[タスク名]を実装してください。
.spec/specification.mdの要件に従い、
.spec/technical-plan.mdのアーキテクチャに沿って実装してください。
テストも同時に作成してください。`,
aiw_bugfixPrompt:'バグ修正',
aiw_bugfixText:`以下のエラーを修正してください:
[エラー内容を貼り付け]
手順:
1. docs/25_error_logs.mdを参照し、既知の問題か確認
2. 根本原因を特定
3. 修正とテストを実装
4. docs/25_error_logs.mdにエラーを記録`,
aiw_refactorPrompt:'リファクタリング',
aiw_refactorText:`以下のコードをリファクタリングしてください:
[対象ファイル/コードを貼り付け]
手順:
1. .spec/specification.mdの要件を再確認
2. 問題点を特定 (SOLID原則違反、重複コード等)
3. 段階的に改善 (テストを壊さない)
4. docs/24_progress.mdを更新`,
/* AI_AUTONOMOUS.md */
aia_title:'AI自律開発ガイド',aia_level:'レベル',
aia_vibe:'Vibe Codingの実践',aia_vibeDesc:'自然言語で意図を伝え、AIが実装する開発スタイル。',
aia_basic:'基本フロー',
aia_f1:'意図を明確に伝える',aia_f1ex:'「ユーザー一覧画面を作って」',
aia_f2:'AIが実装',aia_f2ex:'コード生成・テスト・リファクタリング',
aia_f3:'レビュー・修正',aia_f3ex:'人間が最終確認',
aia_f4:'イテレーション',aia_f4ex:'フィードバックを繰り返し',
aia_tools:'推奨ツール',
aia_vibe1:'Cursor + Claude: 基本的なVibe Coding',aia_vibe2:'Claude Code: ターミナルベースの自律実装',aia_vibe3:'Antigravity: Agent-first IDE（Editor + Manager View）',
aia_multi1:'Claude Code Subagents: 並列タスク実行',aia_multi2:'Claude-Flow: マルチAgent協調',aia_multi3:'AGENTS.md: Agent間の役割定義',
aia_full1:'Devin: 完全自律型AIエンジニア',aia_full2:'Claude Code Tasks: DAGタスク管理',aia_full3:'Gas Town: K8s for AI Agents',aia_async1:'Jules (Google): 非同期コーディングAgent',
aia_bp:'ベストプラクティス',
aia_bp1:'.spec/を必ず最初に読ませる',aia_bp2:'小さなタスクに分割する',aia_bp3:'テストを先に書かせる (TDD)',aia_bp4:'コミット前に必ずレビュー',
aia_none:'現在のプロジェクトではAI自律開発は対象外です。\nまずはAIコーディングツール（',aia_none2:'）の基本活用から始めましょう。',
/* SAAS_COMMERCE_GUIDE.md */
sc_title:'SaaS・EC収益化ガイド',sc_selected:'選択',
sc_compare:'決済プラットフォーム比較',sc_platform:'プラットフォーム',sc_rate:'料率',sc_feat:'特徴',
sc_stripe:'API最強、カスタマイズ自在',sc_paddle:'SaaS特化、税務自動',sc_lemon:'Stripe傘下、個人開発者向け',
sc_impl:'Stripe実装ガイド',sc_webhook:'Webhook処理',
sc_paid:'決済完了',sc_renew:'サブスク更新',sc_cancel:'解約',
sc_cms:'ヘッドレスCMS実装',sc_ec:'ヘッドレスEC',
sc_prodMgmt:'商品管理',sc_payment:'決済',sc_ship:'配送',sc_fulfill:'カスタムFulfillment',
sc_none:'現在のプロジェクトでは決済・EC機能は対象外です。\n将来的にStripe決済やヘッドレスCMSの導入を推奨します。',
/* Dashboard roadmap labels */
dRoadDeploy:'デプロイ',dRoadReset:'🔄 リセット',dRoadFiles:'📁 ファイル一覧',dRoadProgress:'📈 全体進捗',
};
const en={
none:'None',
lp_title:'Learning Roadmap',lp_skill:'Skill Level',lp_target:'Target',
l1:'Web Fundamentals',l2:'Frontend',l3:'Backend',l3m:'Mobile',
l4:'DevOps',l5:'AI-Driven Dev',l6:'Monetization',l7:'Dev Methodologies',l7span:'Entire Duration',
html5b:'HTML5 Basics (2-4 weeks)',css3b:'CSS3 Basics (3-6 weeks)',jsb:'JavaScript ES6+ (4-12 weeks)',
tsAdv:'TypeScript deep dive',cssAdv:'Modern CSS (Container Queries, :has())',
setup:'Setup & Basics',stMgmt:'State Management',dataFetch:'Data Fetching',
testing:'Testing',dbDesign:'Database Design',auth:'Auth & Authorization',
mobEnv:'Environment Setup',mobNav:'Navigation & Screen Design',
mobNative:'Native Features (Camera/Push)',mobStore:'Store Build & Submission',
deploy:'Deploy',monitor:'Monitoring Setup',aiUse:'Integration',
mcpCfg:'MCP Configuration',aiOpt:'AI Agent Rules Optimization',practice:'Practice',
billing:'Billing Flow Implementation',opsScale:'Operations & Scaling',
ff_title:'Feature Expansion Roadmap',ff_span:'Post-MVP',ff_integrate:'integration',
lp_path:'Learning Path',
ts_title:'Tech Stack Guide',ts_selected:'Selected Tech Stack',
cat:'Category',tech:'Technology',rationale:'Rationale',
feLabel:'Frontend',beLabel:'Backend',dbLabel:'Database',
deployLabel:'Deploy',mobileLabel:'Mobile',payLabel:'Payment/CMS',
nextR:'SSR/SSG support, SEO optimized',vueR:'Low learning curve, flexible',feGenR:'High performance, rich ecosystem',
supaR:'BaaS, rapid MVP',expR:'Lightweight, easy to learn',nestR:'Enterprise-grade, DI',beGenR:'Scalable',
pgR:'ACID compliant, JSON support, Supabase compatible',dbGenR:'Flexible schema',
vercelR:'Next.js optimized, auto-deploy',deployGenR:'High flexibility',
expoR:'Reuse React skills, OTA updates',mobGenR:'Cross-platform',
payR:'SaaS/EC monetization platform',
ts_deps:'Technology Dependencies',ts_versions:'Recommended Versions',
mob_title:'Mobile Dev Guide',mob_env:'Environment Setup',mob_dir:'Directory Structure',
mob_home:'Home screen',mob_explore:'Explore screen',mob_profile:'Profile',
mob_root:'Root layout',mob_eas:'Config',mob_libs:'Recommended Libraries',
mob_anim:'Animations',mob_list:'High-perf list',mob_img:'Image optimization',
mob_none:'Mobile development is not in scope for this project.\nConsider Expo (React Native) for future mobile support.',
tool_title:'Dev Tools Setup Guide',tool_essential:'Essential Tools',
tool_rec:'Recommended',tool_pkgmgr:'Package Manager',tool_init:'Project Init',
tool_docker:'Database (via Docker)',tool_ai:'AI Coding Tools',
tool_ext:'Extensions',tool_used:'if used',tool_vsInst:'Install from VS Code extensions',
tool_official:'Install from official site',tool_env:'Environment Variables',
res_title:'Learning Resources',res_official:'Official Documentation',
res_ai:'AI-Driven Development',res_bp:'Best Practices',res_docs:'Docs',
res_proto:'Protocol',res_patterns:'Patterns',
res_books:'Recommended Books & Courses',res_fullstack:'Full-Stack Web Development',
res_tsPractice:'TypeScript in Practice',res_design:' Design Principles',
res_saas:'SaaS Development with Stripe',res_headless:'Headless Architecture Guide',
res_beg:'Beginner',res_int:'Intermediate',
ms_title:'Milestone Plan',ms_target:'Target',
ms_m:['Setup & Foundations','Core Feature Implementation','UI/UX & Testing','Deploy & CI/CD','Optimization & Monitoring','Production & Improvement','Scale & Next Phase'],
ms_criteria:'Define milestone acceptance criteria',ms_review:'Conduct weekly reviews',ms_retro:'Retrospective & improvement',
aiw_title:'AI-Driven Dev Workflow Guide',aiw_flow:'AI Dev Flow',
aiw_s1:'.spec/ review',aiw_s2:'Task selection',aiw_s3:'AI implementation',aiw_s4:'Review',aiw_s5:'Test',aiw_s6:'Commit',
aiw_select:'AI Tool Selection',aiw_task:'Task',aiw_rec:'Recommended',
aiw_newfile:'New file creation',aiw_bugfix:'Bug fix',aiw_testgen:'Test generation',aiw_refactor:'Refactoring',
aiw_ctx:'Context awareness',aiw_term:'Direct terminal access',aiw_inline:'Inline completion',aiw_multi:'Multi-file editing',
aiw_mcp:'MCP Usage Patterns',aiw_mcp1:'Latest library docs reference',aiw_mcp2:'Project structure comprehension',aiw_mcp3:'E2E test automation',
aiw_prompt:'Prompt Templates',aiw_addFeature:'Add New Feature',
aiw_promptText:`Implement [task name] from .spec/tasks.md.
Follow the requirements in .spec/specification.md
and the architecture defined in .spec/technical-plan.md.
Create tests alongside the implementation.`,
aiw_bugfixPrompt:'Bug Fix',
aiw_bugfixText:`Fix the following error:
[Paste error here]
Steps:
1. Reference docs/25_error_logs.md to check if it is a known issue
2. Identify root cause
3. Implement fix and tests
4. Log error to docs/25_error_logs.md`,
aiw_refactorPrompt:'Refactoring',
aiw_refactorText:`Refactor the following code:
[Paste target file/code here]
Steps:
1. Re-verify requirements in .spec/specification.md
2. Identify issues (SOLID violations, code duplication, etc.)
3. Improve gradually (do not break tests)
4. Update docs/24_progress.md`,
aia_title:'AI Autonomous Dev Guide',aia_level:'Level',
aia_vibe:'Vibe Coding in Practice',aia_vibeDesc:'A development style where you express intent in natural language and AI implements it.',
aia_basic:'Basic Flow',
aia_f1:'Communicate intent clearly',aia_f1ex:'"Create a user list screen"',
aia_f2:'AI implements',aia_f2ex:'Code generation, testing, refactoring',
aia_f3:'Review & fix',aia_f3ex:'Human final review',
aia_f4:'Iteration',aia_f4ex:'Repeat feedback cycles',
aia_tools:'Recommended Tools',
aia_vibe1:'Cursor + Claude: Basic Vibe Coding',aia_vibe2:'Claude Code: Terminal-based autonomous implementation',aia_vibe3:'Antigravity: Agent-first IDE (Editor + Manager View)',
aia_multi1:'Claude Code Subagents: Parallel task execution',aia_multi2:'Claude-Flow: Multi-Agent coordination',aia_multi3:'AGENTS.md: Agent role definitions',
aia_full1:'Devin: Fully autonomous AI engineer',aia_full2:'Claude Code Tasks: DAG task management',aia_full3:'Gas Town: K8s for AI Agents',aia_async1:'Jules (Google): Async coding agent',
aia_bp:'Best Practices',
aia_bp1:'Always feed .spec/ first',aia_bp2:'Break into small tasks',aia_bp3:'Write tests first (TDD)',aia_bp4:'Always review before committing',
aia_none:'AI autonomous development is not in scope.\nStart with AI coding tools (',aia_none2:') for the basics.',
sc_title:'SaaS & E-Commerce Guide',sc_selected:'Selected',
sc_compare:'Payment Platform Comparison',sc_platform:'Platform',sc_rate:'Rate',sc_feat:'Features',
sc_stripe:'Best API, highly customizable',sc_paddle:'SaaS-focused, auto tax',sc_lemon:'Stripe-owned, indie-friendly',
sc_impl:'Stripe Implementation',sc_webhook:'Webhook Handler',
sc_paid:'Payment completed',sc_renew:'Subscription renewed',sc_cancel:'Cancelled',
sc_cms:'Headless CMS',sc_ec:'Headless E-Commerce',
sc_prodMgmt:'Product Management',sc_payment:'Payment',sc_ship:'Shipping',sc_fulfill:'Custom Fulfillment',
sc_none:'Payment/E-Commerce features are not in scope.\nConsider Stripe payments or Headless CMS for future implementation.',
dRoadDeploy:'Deploy',dRoadReset:'🔄 Reset',dRoadFiles:'📁 File List',dRoadProgress:'📈 Overall Progress',
};
return {ja,en,t:(key)=>(({ja,en})[S.genLang||S.lang]||en)[key]||en[key]||key};
})();
function initPills(){
const _ja=S.lang==='ja';
const c=$('sbPills');if(!c)return;c.innerHTML='';
const qs=getQ();
for(let i=1;i<=3;i++){
const ph=qs[i];if(!ph)continue;
const d=document.createElement('div');d.className='pd-phase';d.id='pp'+i;
d.innerHTML='<span class="pd-dot"></span>'+ph.name;
d.onclick=()=>{if(S.phase>=i){S.phase=i;S.step=0;save();showQ();updProgress();}};
c.appendChild(d);
/* Question list under each phase */
const ul=document.createElement('ul');ul.className='pd-qlist';ul.id='pq'+i;
ph.questions.forEach((q,si)=>{
const li=document.createElement('li');li.className='pd-q';
li.setAttribute('data-qid',q.id);
const shortQ=q.q.length>18?q.q.slice(0,18)+'…':q.q;
li.innerHTML='<span class="pd-qmark"></span>'+shortQ;
li.onclick=(e)=>{e.stopPropagation();if(S.phase>i||(S.phase===i&&S.step>=si)){S.phase=i;S.step=si;save();showQ();updProgress();}};
ul.appendChild(li);
});
c.appendChild(ul);
}
const tl=$('pdTitle');if(tl)tl.textContent=_ja?'進捗':'Progress';
const gb=$('pdGenBtn');if(gb)gb.textContent=_ja?'🚀 生成':'🚀 Generate';
}
function isQActive(q){
if(!q.condition)return true;
const[k,fn]=Object.entries(q.condition)[0];
return fn(S.answers[k]||'');
}
function updProgress(){
const qs=getQ();let total=0,done=0;
for(let p=1;p<=3;p++){const ph=qs[p];if(!ph)continue;ph.questions.forEach(q=>{if(!isQActive(q))return;total++;if(S.answers[q.id])done++;});}
const pct=total?Math.round(done/total*100):0;
$('pbar').style.width=pct+'%';
const _pstrip=$('pbar').parentElement;if(_pstrip)_pstrip.setAttribute('aria-valuenow',pct);
const pdBar=$('pdBar');if(pdBar)pdBar.style.width=pct+'%';
const pdPct=$('pdPct');if(pdPct)pdPct.textContent=done+'/'+total+' ('+pct+'%)';
const cxMiniEl=$('cxMini');if(cxMiniEl&&typeof getComplexityMini==='function')cxMiniEl.innerHTML=getComplexityMini();
for(let i=1;i<=3;i++){
const el=$('pp'+i);if(el){el.classList.toggle('active',S.phase===i);el.classList.toggle('done',S.phase>i);}
/* Update question-level status */
const ph=qs[i];if(!ph)continue;
ph.questions.forEach((q,si)=>{
const li=document.querySelector('.pd-q[data-qid="'+q.id+'"]');
if(!li)return;
const active=isQActive(q);
li.classList.toggle('answered',active&&!!S.answers[q.id]);
li.classList.toggle('current',active&&S.phase===i&&S.step===si);
li.classList.toggle('q-na',!active);
});
}
updTOC();
}
function addMsg(type,text,tip,qid,helpId){
const _ja=S.lang==='ja';
const body=$('cbody'),d=document.createElement('div');d.className='msg';
const cls=type==='bot'?'m-bot':'m-usr';
const w=document.createElement('div');w.className=cls;w.style.position='relative';
const lbl=document.createElement('div');lbl.className='m-lbl';
lbl.textContent=type==='bot'?(_ja?'AI アシスタント':'AI Assistant'):(_ja?'あなた':'You');
if(type==='bot'&&helpId&&HELP_DATA[helpId]){
const hb=document.createElement('span');hb.className='q-help';hb.textContent='?';hb.title=_ja?'ヘルプ':'Help';
hb.setAttribute('role','button');
hb.setAttribute('aria-label',_ja?'ヘルプ':'Help');
hb.tabIndex=0;
hb.onclick=(e)=>showHelp(helpId,e);
hb.onkeydown=(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();showHelp(helpId,e);}};
lbl.appendChild(hb);
}
const bd=document.createElement('div');bd.className='m-body';
text.split('\n').forEach((l,i,a)=>{bd.appendChild(document.createTextNode(l));if(i<a.length-1)bd.appendChild(document.createElement('br'));});
w.appendChild(lbl);w.appendChild(bd);
if(type==='user'&&qid){
const eb=document.createElement('button');
eb.className='m-edit';eb.textContent='✎';eb.title=_ja?'編集':'Edit';
eb.onclick=()=>editAnswer(qid,d);
w.appendChild(eb);
d.dataset.qid=qid;
}
d.appendChild(w);body.appendChild(d);
if(tip){const tt=document.createElement('div');tt.className='msg';tt.innerHTML='<div class="m-tip">💡 '+esc(tip)+'</div>';body.appendChild(tt);}
body.scrollTop=body.scrollHeight;
return d;
}
function showQ(){
const qs=getQ();
const ph=qs[S.phase];if(!ph)return;
// Skip conditional questions
while(S.step<ph.questions.length){
const q=ph.questions[S.step];
if(!isQActive(q)){S.step++;continue;}
break;
}
if(S.step>=ph.questions.length){phaseEnd();return;}
const q=ph.questions[S.step];
$('pdTitle').textContent=ph.name;
updProgress();
addMsg('bot',q.q,q.tip,null,q.help);
if(q.id==='scope_out'){const body=$('chatBody');if(body){const _ja=S.lang==='ja';const w=document.createElement('div');w.className='msg';w.innerHTML='<div class="compat-warn"><span class="compat-icon">⚠️</span><span class="compat-msg">'+(_ja?'よくある失敗: スコープ外を定義しないと「機能追加地獄」に陥り、MVPが完成しません。':'Common pitfall: Without defining scope-out, you\'ll fall into "feature hell" and never ship your MVP.')+'</span></div>';body.appendChild(w);body.scrollTop=body.scrollHeight;}}
renderInputFor(q,(val)=>{
if(S.skillLv>=5){showConfirm(val,()=>{doSubmit(q.id,val);});}
else{doSubmit(q.id,val);}
},true);
}
function doSubmit(qid,val){
S.answers[qid]=sanitize(val.trim?val.trim():String(val));
addMsg('user',String(val),null,qid);
showCompatAlert(S.answers);
S.step++;save();
setTimeout(()=>{
const ph=getQ()[S.phase];
if(!ph||S.step>=ph.questions.length)phaseEnd();
else showQ();
},300);
}
function showCompatAlert(answers){
// Lv0-1: show errors only — warn/info are too technical for beginners and safe stack is auto-selected
const issues=checkCompat(answers).filter(i=>S.skillLv<=1?i.level==='error':(i.level==='error'||i.level==='warn'||i.level==='info'));
if(!issues.length)return;
const _ja=S.lang==='ja';const body=$('cbody');
issues.forEach(iss=>{
const d=document.createElement('div');d.className='msg';
const icon=iss.level==='error'?'❌':iss.level==='warn'?'⚠️':'ℹ️';
const cls=iss.level==='error'?'compat-error':iss.level==='warn'?'compat-warn':'compat-info';
let h=`<div class="${cls}"><span class="compat-icon">${icon}</span><span class="compat-msg">${esc(iss.msg)}</span>`;
if(iss.fix)h+=`<button class="btn btn-xs btn-s compat-fix" onclick="S.answers['${escAttr(iss.fix.f)}']='${escAttr(iss.fix.s)}';save();this.parentNode.innerHTML='✅ ${_ja?'修正済':'Fixed'}: ${escHtml(iss.fix.f)} → ${escHtml(iss.fix.s)}'">${_ja?'修正':'Fix'}</button>`;
h+='</div>';d.innerHTML=h;body.appendChild(d);
});
body.scrollTop=body.scrollHeight;
}
function phaseEnd(){
if(S.phase<3){
// Beginner auto-mode: skip Phase 2 tech questions and auto-fill with best-practice defaults
if(S.phase===1&&S.skillLv<=1){
if(typeof autoFillPhase2Defaults==='function')autoFillPhase2Defaults();
const _ja=S.lang==='ja';
const _stackName=S.skillLv===0?(_ja?'Next.js + Firebase + Vercel':'Next.js + Firebase + Vercel'):(_ja?'Next.js + Supabase + Vercel':'Next.js + Supabase + Vercel');
const autoMsg=_ja
?'✅ 技術構成は初心者向けベストプラクティスで自動選択しました（'+_stackName+'）\n💡 Phase 2をスキップして機能設計へ進みます。後から設定画面で変更できます。'
:'✅ Tech stack auto-selected using beginner best practices ('+_stackName+')\n💡 Skipping Phase 2 to go straight to feature design. You can change settings later.';
addMsg('bot',autoMsg);
if(typeof announce==='function')announce(autoMsg);
S.phase=3;S.step=0;save();
setTimeout(()=>showQ(),600);
return;
}
const msg=t('phEnd'+S.phase);
addMsg('bot',msg);
if(typeof announce==='function')announce(msg);
if(S.skillLv<=1){const _ja=S.lang==='ja';var _phMsg=S.phase===1?(_ja?'✅ Phase 1完了！あと2ステップ':'✅ Phase 1 done! 2 more steps'):S.phase===2?(_ja?'✅ Phase 2完了！あと1ステップ':'✅ Phase 2 done! 1 more step'):(_ja?'✅ 最終Phase完了！':'✅ Final phase done!');toast(_phMsg);}
S.phase++;S.step=0;save();
setTimeout(()=>showQ(),400);
} else {
handleSkipped();
}
}
function skipQ(qid){
if(!S.skipped.includes(qid))S.skipped.push(qid);
addMsg('bot',t('skipMsg'));
S.step++;save();
setTimeout(()=>{
const ph=getQ()[S.phase];
if(!ph||S.step>=ph.questions.length)phaseEnd();
else showQ();
},250);
}
function handleSkipped(){
S.skipped=S.skipped.filter(id=>!S.answers[id]);
if(S.skipped.length===0){finish();return;}
addMsg('bot',t('skippedTitle')+S.skipped.length+t('skippedSuffix'));
askNextSkipped();
}
function askNextSkipped(){
S.skipped=S.skipped.filter(id=>!S.answers[id]);
if(S.skipped.length===0){addMsg('bot',t('skippedDone'));finish();return;}
const qid=S.skipped[0];
let targetQ=null;
for(const ph of Object.values(getQ())){for(const q of ph.questions){if(q.id===qid){targetQ=q;break;}}}
if(!targetQ){S.skipped.shift();askNextSkipped();return;}
const zone=$('izone');zone.innerHTML='';
const banner=document.createElement('div');banner.className='skipped-banner';
banner.innerHTML='<span>'+t('skippedBanner')+S.skipped.length+t('skippedBannerSuffix')+'</span>';
zone.appendChild(banner);
addMsg('bot',targetQ.q,targetQ.tip,null,targetQ.help);
renderInputFor(targetQ,(val)=>{
S.answers[qid]=sanitize(val.trim?val.trim():String(val));
addMsg('user',String(val),null,qid);
S.skipped.shift();
showCompatAlert(S.answers);save();
setTimeout(()=>askNextSkipped(),250);
},false);
}
function finish(){
showGenerate();
showComplexity();
}
function showGenerate(){
const zone=$('izone');zone.innerHTML='';
const btn=document.createElement('button');btn.className='btn btn-p';btn.style.cssText='padding:14px 40px;font-size:14px;margin:20px;';
btn.textContent=t('genBtn');
btn.onclick=()=>{generateAll();};
zone.appendChild(btn);
}
function findNext(){
const qs=getQ();
for(let p=1;p<=3;p++){const ph=qs[p];if(!ph)continue;
for(let s=0;s<ph.questions.length;s++){
const q=ph.questions[s];
if(!isQActive(q))continue;
if(!S.answers[q.id]){S.phase=p;S.step=s;showQ();return;}
}
}
finish();
}
const _TECHDB_MAP={
frontend:'front',backend:'back',css_fw:'front',
database:'back',orm:'back',mobile:'mobile',
ai_auto:'ai_auto',payment:'payment',ai_tools:'ai',
deploy:'devops',dev_methods:'method'
};
const _CAT_LABELS={
ja:{lang:'言語',front:'フロントエンド',mobile:'モバイル',back:'バックエンド',
baas:'BaaS',payment:'決済/CMS/EC',devops:'DevOps',ai:'AIツール',
ai_auto:'AI自律',method:'手法',test:'テスト',api:'API',
build:'ビルド',data:'データ',security:'セキュリティ'},
en:{lang:'Language',front:'Frontend',mobile:'Mobile',back:'Backend',
baas:'BaaS',payment:'Payment/CMS/EC',devops:'DevOps',ai:'AI Tools',
ai_auto:'AI Autonomous',method:'Methods',test:'Testing',api:'API',
build:'Build',data:'Data',security:'Security'}
};
function renderInputFor(q,onSubmit,allowSkip){
const _ja=S.lang==='ja';
const zone=$('izone');
const existingBanner=zone.querySelector('.edit-banner')||zone.querySelector('.skipped-banner');
if(!existingBanner)zone.innerHTML='';
if(q.type==='chip-text')renderChips(zone,q,false,onSubmit,true);
else if(q.type==='chip-multi')renderChips(zone,q,true,onSubmit,true);
else if(q.type==='options')renderOpts(zone,q,onSubmit);
// Add TECH_DB browser button
if(_TECHDB_MAP[q.id]&&typeof TECH_DB!=='undefined'){
const _ja=S.lang==='ja';
const tb=document.createElement('button');
tb.className='btn btn-xs btn-tech-browse';
tb.textContent=_ja?'🔍 技術マスターから選択...':'🔍 Browse Tech Master...';
tb.onclick=()=>showTechBrowser(q.id,val=>{
// options型: 直接サブミット、chip-multi型: チップ追加
if(q.type==='options'){onSubmit(val);}
else{
// chip-multiの場合、カスタムチップとして追加
const gr=zone.querySelector('.cgrid');
if(gr){
const ch=document.createElement('div');ch.className='chip active';
ch.textContent='✓ '+val;ch.dataset.val=val;
ch.onclick=()=>ch.classList.toggle('active');
gr.appendChild(ch);
}
}
});
zone.appendChild(tb);
}
if(allowSkip!==false){
const sk=document.createElement('div');sk.style.cssText='padding:4px 20px 10px;text-align:right;';
const btn=document.createElement('button');btn.className='skip-btn';btn.textContent=S.skillLv<=1?(_ja?'スキップ（後で回答OK）':'Skip (answer later)'):t('skip');
btn.onclick=()=>skipQ(q.id);
sk.appendChild(btn);zone.appendChild(sk);
}
}
function renderChips(zone,q,multi,onSubmit,withVoice){
const _ja=S.lang==='ja';
const sel=new Set();
var _preAns=(S.answers&&S.answers[q.id])?String(S.answers[q.id]):'';
if(multi&&_preAns){_preAns.split(',').map(v=>v.trim()).filter(Boolean).forEach(v=>sel.add(v));}
const cz=document.createElement('div');cz.className='czone';
const lb=document.createElement('div');lb.className='czlabel';lb.textContent=_ja?(multi?'選択してください（複数可・自由入力併用）':'選択するか下に入力'):(multi?'Select multiple or type below':'Select or type below');
cz.appendChild(lb);
const gr=document.createElement('div');gr.className='cgrid';
(q.chips||[]).forEach(ch=>{
const c=document.createElement('div');c.className='chip';
if(multi&&sel.has(ch)){c.classList.add('on');}
c.setAttribute('tabindex','0');
c.setAttribute('role',multi?'checkbox':'option');
if(multi){const ck=document.createElement('span');ck.className='ck';ck.textContent='✓';c.appendChild(ck);}
c.appendChild(document.createTextNode(ch));
c.onclick=()=>{
if(multi){if(sel.has(ch)){sel.delete(ch);c.classList.remove('on')}else{sel.add(ch);c.classList.add('on')}}
else{onSubmit(ch);}
};
c.onkeydown=(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();c.click();}};
gr.appendChild(c);
});
cz.appendChild(gr);zone.appendChild(cz);
const ft=document.createElement('div');ft.className='cfoot';
const inp=document.createElement('input');inp.className='cadd';inp.placeholder=q.placeholder||(_ja?'自由入力…':'Type here…');
inp.setAttribute('aria-label', _ja?'自由入力':'Free text input');
if(!multi&&_preAns)inp.value=_preAns;
if(multi){
inp.addEventListener('keypress',e=>{
if(e.key==='Enter'&&inp.value.trim()){
const v=inp.value.trim();sel.add(v);
const c=document.createElement('div');c.className='chip on';
const ck=document.createElement('span');ck.className='ck';ck.textContent='✓';c.appendChild(ck);
c.appendChild(document.createTextNode(v));c.onclick=()=>{sel.delete(v);c.remove();};
gr.appendChild(c);inp.value='';
}
});
const btn=document.createElement('button');btn.className='btn btn-p btn-sm';btn.textContent=t('confirm');
btn.onclick=()=>{if(inp.value.trim())sel.add(inp.value.trim());if(!sel.size){toast(t('selectMin'));return;}
const items=Array.from(sel);
if(q.sortable&&items.length>1){renderDnD(zone,items,onSubmit);}
else{onSubmit(items.join(', '));}
};
ft.appendChild(inp);ft.appendChild(btn);
if(withVoice&&voiceRec){const vb=document.createElement('button');vb.className='voice-btn';vb.textContent='🎙️';vb.title=_ja?'音声入力':'Voice Input';vb.onclick=()=>toggleVoice(vb);ft.appendChild(vb);}
} else {
inp.addEventListener('keypress',e=>{if(e.key==='Enter'&&inp.value.trim())onSubmit(inp.value.trim());});
const btn=document.createElement('button');btn.className='btn btn-p btn-sm';btn.textContent=t('send');
btn.onclick=()=>{if(inp.value.trim())onSubmit(inp.value.trim());};
ft.appendChild(inp);ft.appendChild(btn);
if(withVoice&&voiceRec){const vb=document.createElement('button');vb.className='voice-btn';vb.textContent='🎙️';vb.title=_ja?'音声入力':'Voice Input';vb.onclick=()=>toggleVoice(vb);ft.appendChild(vb);}
}
zone.appendChild(ft);
}
/* Tech question IDs where first option gets a "⭐ おすすめ" badge */
const _REC_BADGE_QS=new Set(['frontend','css_fw','backend','database','orm','deploy','mobile','auth']);
function renderOpts(zone,q,onSubmit){
const _ja=S.lang==='ja';
const cards=document.createElement('div');cards.className='ocards';
const showBadge=_REC_BADGE_QS.has(q.id);
(q.options||[]).forEach((o,idx)=>{
const c=document.createElement('div');c.className='ocard';
c.setAttribute('tabindex','0');
c.setAttribute('role','option');
const h=document.createElement('h5');
const label=typeof o==='string'?o:o.label;
h.textContent=label;
// ⭐ Recommended badge on first option for tech questions (Beginner/Intermediate/Lower Advanced)
if(showBadge&&idx===0&&S.skillLv<4){
const badge=document.createElement('span');badge.className='ocard-rec-badge';
badge.textContent=_ja?'⭐ おすすめ':'⭐ Recommended';
h.appendChild(badge);
}
c.appendChild(h);
if(o.desc){const p=document.createElement('p');p.textContent=o.desc;c.appendChild(p);}
c.onclick=()=>onSubmit(label);
c.onkeydown=(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();c.click();}};
cards.appendChild(c);
});
zone.appendChild(cards);
}
function showTechBrowser(qId, onSelect){
const _ja=S.lang==='ja';
const cats=_TECHDB_MAP[qId];
if(!cats)return;
// 対象カテゴリのエントリをフィルタ
const primaryCat=cats;
const allCats=[...new Set(TECH_DB.filter(t=>t.cat===primaryCat).map(t=>t.cat))];
// モーダル構築
const ov=document.createElement('div');ov.className='techdb-overlay';
ov.setAttribute('role','dialog');
ov.setAttribute('aria-modal','true');
ov.setAttribute('aria-label',_ja?'技術マスター':'Tech Master');
ov.onclick=e=>{if(e.target===ov)ov.remove();};
ov.addEventListener('keydown',e=>{
if(e.key==='Escape')ov.remove();
});
const modal=document.createElement('div');modal.className='techdb-modal';
// ヘッダー + 検索
const hd=document.createElement('div');hd.className='techdb-hd';
hd.innerHTML='<h3>'+(_ja?'技術マスターから選択':'Browse Tech Master')+'</h3>';
const search=document.createElement('input');search.className='techdb-search';
search.placeholder=_ja?'検索...':'Search...';
search.setAttribute('aria-label', _ja?'技術マスター検索':'Tech Master search');
hd.appendChild(search);modal.appendChild(hd);
// カテゴリタブ + アイテムグリッド
const body=document.createElement('div');body.className='techdb-body';
const catList=document.createElement('div');catList.className='techdb-cats';
const itemGrid=document.createElement('div');itemGrid.className='techdb-items';
// 全カテゴリ表示（primaryCatをデフォルト選択）
const labels=_CAT_LABELS[_ja?'ja':'en'];
Object.keys(labels).forEach(cat=>{
const items=TECH_DB.filter(t=>t.cat===cat);
if(!items.length)return;
const btn=document.createElement('div');btn.className='techdb-cat';
btn.textContent=labels[cat]+' ('+items.length+')';
btn.dataset.cat=cat;
if(cat===primaryCat)btn.classList.add('sel');
btn.onclick=()=>{
catList.querySelectorAll('.techdb-cat').forEach(c=>c.classList.remove('sel'));
btn.classList.add('sel');
renderItems(cat);
};
catList.appendChild(btn);
});
function renderItems(cat){
itemGrid.innerHTML='';
const items=TECH_DB.filter(t=>t.cat===cat);
const q=search.value.toLowerCase();
items.filter(t=>!q||t.name.toLowerCase().includes(q)).forEach(t=>{
const card=document.createElement('div');card.className='techdb-item';
card.innerHTML='<b>'+esc(t.name)+'</b><span class="techdb-req">'+
(typeof reqLabel==='function'?reqLabel(t.req):t.req)+'</span>'+
(t.price?'<span class="techdb-price">'+(typeof priceLabel==='function'?priceLabel(t.price):t.price)+'</span>':'');
card.onclick=()=>{onSelect(t.name);ov.remove();};
itemGrid.appendChild(card);
});
}
search.oninput=()=>{
const sel=catList.querySelector('.techdb-cat.sel');
renderItems(sel?sel.dataset.cat:primaryCat);
};
body.appendChild(catList);body.appendChild(itemGrid);
modal.appendChild(body);ov.appendChild(modal);
document.body.appendChild(ov);
renderItems(primaryCat);
// Initial focus on search
setTimeout(()=>search.focus(),50);
}
function renderDnD(zone,items,onSubmit){
const _ja=S.lang==='ja';
zone.innerHTML='';
const wrap=document.createElement('div');wrap.style.cssText='padding:10px 20px;';
const lbl=document.createElement('div');lbl.className='czlabel';lbl.textContent=t('sortLabel');
wrap.appendChild(lbl);
// Keyboard hint (HCD: A アクセシビリティ ④身体負荷)
const hint=document.createElement('div');hint.className='dnd-hint';
hint.textContent=_ja?'ドラッグまたは↑↓キーで並び替え':'Drag or use ↑↓ keys to reorder';
wrap.appendChild(hint);
const list=document.createElement('ul');list.className='dnd-list';list.setAttribute('role','listbox');
let dragItem=null;
items.forEach((item,i)=>{
const li=document.createElement('li');
li.className='dnd-item';
li.draggable=true;
li.dataset.idx=i;
li.setAttribute('tabindex','0');
li.setAttribute('role','option');
li.setAttribute('aria-label',(_ja?'項目 ':'Item ')+(i+1)+': '+item);
const grip=document.createElement('span');grip.className='dnd-grip';grip.textContent='⠿';
const label=document.createElement('span');label.className='dnd-label';label.textContent=item;
const pri=document.createElement('span');pri.className='dnd-priority';
li.appendChild(grip);li.appendChild(label);li.appendChild(pri);
li.addEventListener('dragstart',e=>{dragItem=li;li.style.opacity='0.4';e.dataTransfer.effectAllowed='move';});
li.addEventListener('dragend',()=>{dragItem=null;li.style.opacity='1';list.querySelectorAll('.dnd-item').forEach(el=>el.classList.remove('drag-over'));updPri();});
li.addEventListener('dragover',e=>{e.preventDefault();e.dataTransfer.dropEffect='move';li.classList.add('drag-over');});
li.addEventListener('dragleave',()=>li.classList.remove('drag-over'));
li.addEventListener('drop',e=>{e.preventDefault();li.classList.remove('drag-over');if(dragItem&&dragItem!==li){const rect=li.getBoundingClientRect();const mid=rect.top+rect.height/2;if(e.clientY<mid)list.insertBefore(dragItem,li);else list.insertBefore(dragItem,li.nextSibling);}});
// Keyboard navigation (HCD: A アクセシビリティ ④身体負荷)
li.addEventListener('keydown',e=>{
if(e.key==='ArrowUp'){
e.preventDefault();
const prev=li.previousElementSibling;
if(prev&&prev.classList.contains('dnd-item')){
list.insertBefore(li,prev);
li.focus();
updPri();
if(typeof announce==='function')announce(_ja?'上に移動しました':'Moved up');
}
}else if(e.key==='ArrowDown'){
e.preventDefault();
const next=li.nextElementSibling;
if(next&&next.classList.contains('dnd-item')){
list.insertBefore(next,li);
li.focus();
updPri();
if(typeof announce==='function')announce(_ja?'下に移動しました':'Moved down');
}
}
});
list.appendChild(li);
});
wrap.appendChild(list);
function updPri(){
const _ja=S.lang==='ja';
const els=list.querySelectorAll('.dnd-item');const n=els.length;
els.forEach((el,i)=>{
const p=el.querySelector('.dnd-priority');
if(i<Math.ceil(n*0.3)){p.textContent=_ja?'P0 必須':'P0 Must';p.className='dnd-priority p0';}
else if(i<Math.ceil(n*0.7)){p.textContent=_ja?'P1 重要':'P1 Important';p.className='dnd-priority p1';}
else{p.textContent=_ja?'P2 任意':'P2 Optional';p.className='dnd-priority p2';}
});
}
updPri();
const ft=document.createElement('div');ft.style.cssText='padding:6px 20px 12px;display:flex;gap:6px;justify-content:flex-end;';
const btn=document.createElement('button');btn.className='btn btn-p btn-sm';btn.textContent=t('sortConfirm');
btn.onclick=()=>{
const ordered=Array.from(list.querySelectorAll('.dnd-label')).map(el=>el.textContent);
const priLabels=Array.from(list.querySelectorAll('.dnd-priority')).map(el=>el.textContent.split(' ')[0]);
onSubmit(ordered.map((item,i)=>'['+priLabels[i]+'] '+item).join(', '));
};
ft.appendChild(btn);wrap.appendChild(ft);zone.appendChild(wrap);
}
function editAnswer(qid,msgEl){
const _ja=S.lang==='ja';
let targetQ=null;
for(const ph of Object.values(getQ())){for(const q of ph.questions){if(q.id===qid){targetQ=q;break;}}}
if(!targetQ)return;
const savedPhase=S.phase,savedStep=S.step;
let isEditing=true;
msgEl.style.outline='2px solid var(--warn)';msgEl.style.borderRadius='var(--radius)';
toast(_ja?'回答を編集中…':'Editing answer…');
const zone=$('izone');zone.innerHTML='';
const banner=document.createElement('div');banner.className='edit-banner';
banner.innerHTML='<span>'+(_ja?'✏️ 「'+esc(targetQ.q)+'」を編集中':'✏️ Editing: '+esc(targetQ.q))+'</span>';
const cancelBtn=document.createElement('button');cancelBtn.className='btn btn-g btn-xs';cancelBtn.textContent=_ja?'キャンセル':'Cancel';
cancelBtn.onclick=()=>{
if(!isEditing)return;isEditing=false;
msgEl.style.outline='';msgEl.style.borderRadius='';zone.innerHTML='';
S.phase=savedPhase;S.step=savedStep;
if(Object.keys(S.files).length>0){showExportGrid();}else{findNext();}
};
banner.appendChild(cancelBtn);zone.appendChild(banner);
renderInputFor(targetQ,(newVal)=>{
if(!isEditing)return;isEditing=false;
S.answers[qid]=sanitize(newVal.trim?newVal.trim():String(newVal));
const bd=msgEl.querySelector('.m-body');bd.textContent='';
String(newVal).split('\n').forEach((l,i,a)=>{bd.appendChild(document.createTextNode(l));if(i<a.length-1)bd.appendChild(document.createElement('br'));});
msgEl.style.outline='';msgEl.style.borderRadius='';zone.innerHTML='';
showCompatAlert(S.answers);
save();toast(_ja?'回答を更新しました':'Answer updated');
// If files already generated, regenerate silently (no language chooser)
if(Object.keys(S.files).length>0&&S.genLang){
doGenerate(S.genLang);
// doGenerate's setTimeout will restore export grid + file tree
} else {
// Still in Q&A flow — resume wizard
S.phase=savedPhase;S.step=savedStep;findNext();
}
},false);
}
function showHelp(id,e){
const _ja=S.lang==='ja';
const raw=HELP_DATA[id];if(!raw)return;const data=raw[S.lang]||raw.ja;
const popup=$('helpPopup');
popup.style.display='block';
popup.style.top=Math.min(e.clientY+10,window.innerHeight-250)+'px';
popup.style.left=Math.max(0,Math.min(e.clientX-100,window.innerWidth-380))+'px';
const safeLink=data.link&&(data.link.startsWith('https://')||data.link.startsWith('http://'))?data.link:'';
window._ehData=data.expertHints||[];
window._ehIdx=window._ehData.length?Math.floor(Math.random()*window._ehData.length):0;
const ehHtml=_renderExpertHint(_ja);
popup.innerHTML='<button class="hp-close" onclick="closeHelpPopup()" aria-label="'+t('helpClose')+'">✕</button><h4>'+esc(data.title)+'</h4><p>'+esc(data.desc)+'</p>'+(data.example?'<div class="hp-ex">'+esc(data.example)+'</div>':'')+(safeLink?'<a class="hp-link" href="'+esc(safeLink)+'" target="_blank" rel="noopener">📎 '+(_ja?'参考リンク':'Reference')+'</a>':'')+ehHtml;
setTimeout(()=>{document.addEventListener('click',closeHelpOnClick,{once:true});},100);
}
function _renderExpertHint(_ja){
if(!window._ehData||!window._ehData.length)return '';
const eh=window._ehData[window._ehIdx];if(!eh)return '';
return '<div class="help-expert-hint"><div class="help-eh-head"><span>'+eh.icon+' '+esc(eh.name)+'</span><button class="help-eh-next" onclick="cycleExpertHint()" title="'+(_ja?'次のヒント':'Next hint')+'">🔄</button></div><div class="help-eh-text">'+esc(eh.hint)+'</div></div>';
}
function cycleExpertHint(){
if(!window._ehData||!window._ehData.length)return;
window._ehIdx=(window._ehIdx+1)%window._ehData.length;
const eh=window._ehData[window._ehIdx];if(!eh)return;
const popup=$('helpPopup');if(!popup)return;
const hint=popup.querySelector('.help-expert-hint');if(!hint)return;
hint.querySelector('.help-eh-head span').textContent=eh.icon+' '+eh.name;
hint.querySelector('.help-eh-text').textContent=eh.hint;
}
function closeHelpPopup(){$('helpPopup').style.display='none';}
function closeHelpOnClick(e){if(!$('helpPopup').contains(e.target))closeHelpPopup();}
function showPostGenGuide(force){
if(!force&&_lsGet('devforge-guide-shown'))return;
_lsSet('devforge-guide-shown','1');
const _ja=S.lang==='ja';
// Use skillLv slider as primary source; fall back to wizard answer
const lv=S.skillLv<=1?'Beginner':S.skillLv>=5?'Professional':(S.answers.skill_level||'Intermediate');
const isB=lv.includes('Beginner');const isP=lv.includes('Professional');
const overlay=document.createElement('div');
overlay.className='guide-overlay';
overlay.onclick=e=>{if(e.target===overlay)overlay.remove();};
const level=isB?{em:'🌱',name:_ja?'Beginner':'Beginner',cls:'guide-lv-b'}:isP?{em:'⚡',name:_ja?'Professional':'Professional',cls:'guide-lv-p'}:{em:'🔥',name:_ja?'Intermediate':'Intermediate',cls:'guide-lv-i'};
const steps=isB?(_ja?[
['生成物は設計書',`<strong>最重要:</strong> 生成された${Object.keys(S.files||{}).length||135}+ファイルは「設計ドキュメント」。npm installで動くコードではない。AIツールに投入することで実コードが生成される。`],
['まずZIPを保存','📦 ZIPダウンロード → ローカルに保存。ブラウザのデータは消えることがある。この1ステップが全財産を守る。'],
['3ファイルだけ覚える','<code>CLAUDE.md</code>(AIに全仕様を理解させる) / <code>.cursorrules</code>(Cursor自動読込) / <code>tasks.md</code>(やることリスト)'],
['AIに丸ごと渡す','「全ファイルコピー」(Ctrl+Shift+C)でAIに貼り付け → 仕様を把握した状態で開発スタート。'],
['ロードマップに従う','ダッシュボード柱⑦のロードマップUIがそのまま学習計画。Layer 1から順にチェック。📖で公式ドキュメントにジャンプ。'],
['AIで発想を広げる','AIランチャー柱⑧の「🎭 9人の専門家ブレスト」で、9つの視点からアイデアを生成。「平凡な答え」から脱却しましょう。'],
]:[
['Files are Design Docs',`<strong>Key fact:</strong> The ${Object.keys(S.files||{}).length||135}+ generated files are design documents, not executable code. Feed them to an AI tool to generate real code.`],
['Save ZIP First','📦 ZIP Download → save locally. Browser data can be lost. This one step protects everything you just created.'],
['Remember 3 Files','<code>CLAUDE.md</code>(AI understands your project) / <code>.cursorrules</code>(Cursor auto-loads) / <code>tasks.md</code>(your todo list)'],
['Feed Everything to AI','"Copy All" (Ctrl+Shift+C) → Paste into AI → Start coding with full context.'],
['Follow the Roadmap','Dashboard Pillar ⑦ is your learning plan. Check off from Layer 1. Hit 📖 for official docs.'],
['Expand Ideas with AI','Use "🎭 9-Expert Brainstorm" in AI Launcher Pillar ⑧ to generate ideas from 9 perspectives. Break out of "average answers".'],
]):isP?(_ja?[
['Agent Teams並列開発','AGENTS.mdでエージェント役割定義 → Claude Code Subagents / Antigravity Manager Viewで並列実行。'],
['SDD仕様駆動','<code>.spec/</code>がSSoT。tasks.mdをタスクキューとしてAIに投入。verification.mdで品質判定。'],
['37テンプレートパイプライン','柱⑧で📋レビュー→🔨実装→🧪テスト→♻️リファクタ→🔒セキュリティ→📝ドキュメント→🛡️Ops準備。全工程自動化。'],
['3-layer CLAUDE.md','ルートCLAUDE.md(薄い ~1.5Kトークン) + .claude/rules/(パス別5ファイル) + .claude/settings.json でトークン最小化。'],
['Ops Plane統合','docs/53-55でSLO/SLI設計・Feature Flags・Circuit Breaker・12 Ops Capabilities。運用自動化。'],
['創造工学×AI活用','柱⑧「🎭 9人の専門家ブレスト」+「🎯 UXジャーニー設計」+「🤖 AIモデル使い分け」で創造的思考→UX設計→AI最適化の全工程をカバー。'],
]:[
['Agent Teams Parallel Dev','AGENTS.md defines roles → Run with Claude Code Subagents / Antigravity Manager View.'],
['SDD Spec-Driven','<code>.spec/</code> is your SSoT. Feed tasks.md as task queue. Verify with verification.md.'],
['37-Template Pipeline','Pillar ⑧: 📋Review → 🔨Implement → 🧪Test → ♻️Refactor → 🔒Security → 📝Docs → 🛡️Ops. Full automation.'],
['3-layer CLAUDE.md','Root CLAUDE.md (thin ~1.5K tokens) + .claude/rules/ (path-specific 5 files) + .claude/settings.json minimizes tokens.'],
['Ops Plane Integration','docs/53-55 for SLO/SLI design, Feature Flags, Circuit Breaker, 12 Ops Capabilities. Ops automation.'],
['Creative Eng × AI','Pillar ⑧ "🎭 9-Expert Brainstorm" + "🎯 UX Journey Design" + "🤖 AI Model Selection" covers the full pipeline: creative thinking → UX design → AI optimization.'],
]):(_ja?[
['SDD仕様駆動開発','<code>.spec/</code>がSSoT。AIへの指示は「tasks.mdの○○を実装して、specification.mdに従って」で完結。'],
['マルチAIツール統一','柱④の10+ファイルでCursor/Claude Code/Copilot/Windsurf/Cline/Gemini全対応。フォルダに置くだけ。'],
['MCP拡張','mcp-config.jsonをプロジェクトルートに配置 → AIがcontext7/filesystem/playwright等を即利用。'],
['セキュリティ＆Ops参照','docs/43-47セキュリティインテリジェンス（OWASP・STRIDE・コンプライアンス）、docs/53-55 Ops設計書（SLO/SLI・12 Capabilities）を参照。'],
['.claude/rules/カスタマイズ','5つのパス別ルール(spec.md/frontend.md/backend.md/test.md/ops.md)をプロジェクトに合わせて編集。パス別自動ロード。'],
['9専門家でブレスト','柱⑧「🎭 9人の専門家ブレスト」で多角的アイデア生成。ビジネス・技術・ユーザー・ディスラプターの4視点で最低限チェック。'],
]:[
['SDD Spec-Driven Dev','<code>.spec/</code> is your SSoT. Tell AI: "implement X from tasks.md following specification.md".'],
['Multi-AI Tool Unity','Pillar ④ generates 10+ files covering Cursor/Claude Code/Copilot/Windsurf/Cline/Gemini. Just drop in.'],
['MCP Extension','Place mcp-config.json in root → AI instantly uses context7, filesystem, playwright MCPs.'],
['Security & Ops Reference','docs/43-47 Security Intelligence (OWASP, STRIDE, Compliance), docs/53-55 Ops docs (SLO/SLI, 12 Capabilities).'],
['.claude/rules/ Customization','Edit 5 path-specific rules (spec.md/frontend.md/backend.md/test.md/ops.md) for your project. Auto-loaded by path.'],
['9-Expert Brainstorm','Use Pillar ⑧ "🎭 9-Expert Brainstorm" for multi-perspective ideas. Check at minimum 4 viewpoints: Business, Technical, User, and Disruptor.'],
]);
// Lv6 community sharing step — visible for Evangelists only
if(S.skillLv>=6){
steps.push([
_ja?'📢 コミュニティで共有':'📢 Share with Community',
_ja?'生成した設計書をコミュニティで共有しましょう。URLコピーボタンで簡単に共有できます。あなたの知見が次の開発者を助けます。<button class="btn btn-xs btn-s" onclick="shareURL()" style="margin-top:6px;">URLをコピーして共有</button>':'Share your generated specs with the community. Use the URL copy button for easy sharing. Your insights help the next developer.<button class="btn btn-xs btn-s" onclick="shareURL()" style="margin-top:6px;">Copy URL &amp; Share</button>'
]);
}
const lvKey=isB?'b':isP?'p':'i';
const prog=_jp(_lsGet('devforge-guide-prog'),{});
const stepsHtml=steps.map((s,i)=>{
const done=prog[lvKey+i];
return `<div class="guide-step${done?' guide-step-done':''}" data-gi="${lvKey}${i}"><label class="guide-ck"><input type="checkbox" ${done?'checked':''} onchange="toggleGuideStep('${lvKey}${i}',this.checked,this.closest('.guide-step'))"><span class="guide-ckbox">${done?'✓':''}</span></label><div class="guide-step-num ${level.cls}">${i+1}</div><div><div class="guide-step-title">${s[0]}</div><div class="guide-step-desc">${s[1]}</div></div></div>`;
}).join('');
const doneCount=steps.filter((_,i)=>prog[lvKey+i]).length;
const progPct=Math.round(doneCount/steps.length*100);
const progBar=`<div class="guide-prog"><div class="guide-prog-bar" role="progressbar" aria-valuenow="${progPct}" aria-valuemin="0" aria-valuemax="100"><div class="guide-prog-fill" style="width:${progPct}%"></div></div><span class="guide-prog-txt">${doneCount}/${steps.length}</span></div>`;
overlay.setAttribute('role','dialog');
overlay.setAttribute('aria-modal','true');
overlay.setAttribute('aria-label',_ja?'次にやることガイド':'Next Steps Guide');
overlay.innerHTML=`<div class="guide-modal">
<div class="guide-header">
<span class="guide-em">${level.em}</span>
<div>
<div class="guide-title">${_ja?'生成完了！次にやること':'Generation Complete! Next Steps'}</div>
<div class="guide-sub ${level.cls}">${level.name} ${_ja?'向けガイド':'Guide'}</div>
</div>
<button class="guide-close" aria-label="${_ja?'閉じる':'Close'}" onclick="this.closest('.guide-overlay').remove()">✕</button>
</div>
<div class="guide-badge">${_ja?'世界で唯一の仕様駆動AIプロジェクトジェネレーター':'The world\'s only spec-driven AI project generator'}</div>
${progBar}
<div class="guide-steps">${stepsHtml}</div>
${S.skillLv===2?`<div class="guide-bridge">
<div class="guide-bridge-title">${_ja?'🔭 次に探索すべき3つのピラー — Lv.2 → 3 へ':'🔭 3 Pillars to Explore Next — Lv.2 → 3'}</div>
<div class="guide-bridge-cards">
<button class="guide-bridge-card" onclick="this.closest('.guide-overlay').remove();var _t=document.querySelectorAll('.piltab');if(_t[3])_t[3].click();">
<span class="bridge-icon">🤖</span>
<div class="bridge-name">${_ja?'④ AIルール':'④ AI Rules'}</div>
<div class="bridge-why">${_ja?'Cursor/Cline/Windsurf/Gemini全対応ルールを自分仕様にカスタマイズ':'Customize rules for all AI tools to fit your workflow'}</div>
</button>
<button class="guide-bridge-card" onclick="this.closest('.guide-overlay').remove();var _t=document.querySelectorAll('.piltab');if(_t[7])_t[7].click();">
<span class="bridge-icon">🚀</span>
<div class="bridge-name">${_ja?'⑧ AIランチャー':'⑧ AI Launcher'}</div>
<div class="bridge-why">${_ja?'37種プロンプトでAIをプロジェクト専用に即戦力化':'37 prompt templates — make AI your dedicated team member'}</div>
</button>
<button class="guide-bridge-card" onclick="this.closest('.guide-overlay').remove();var _t=document.querySelectorAll('.piltab');if(_t[6])_t[6].click();">
<span class="bridge-icon">🗺️</span>
<div class="bridge-name">${_ja?'⑦ ロードマップ':'⑦ Roadmap'}</div>
<div class="bridge-why">${_ja?'学習計画をチェックリストで管理。Layer別に進捗を可視化':'Track learning path by layer with interactive checklist'}</div>
</button>
</div>
</div>`:''}
${S.skillLv===3?`<div class="guide-bridge">
<div class="guide-bridge-title">${_ja?'🛡️ 次に探索すべき3つのピラー — Lv.3 → 4 へ':'🛡️ 3 Pillars to Level Up — Lv.3 → 4'}</div>
<div class="guide-bridge-cards">
<button class="guide-bridge-card" onclick="this.closest('.guide-overlay').remove();var _t=document.querySelectorAll('.piltab');if(_t[11])_t[11].click();">
<span class="bridge-icon">🛡️</span>
<div class="bridge-name">${_ja?'⑫ セキュリティ':'⑫ Security'}</div>
<div class="bridge-why">${_ja?'OWASP+STRIDEで設計を守る。脅威モデル・監査プロンプト自動生成':'OWASP+STRIDE threat modeling & audit prompts auto-generated'}</div>
</button>
<button class="guide-bridge-card" onclick="this.closest('.guide-overlay').remove();showCommandPalette();">
<span class="bridge-icon">📊</span>
<div class="bridge-name">${_ja?'コマンドパレット':'Command Palette'}</div>
<div class="bridge-why">${_ja?'Ctrl+K で全機能を即アクセス。ファイル検索・エクスポート・ナビを一括操作':'Ctrl+K to access all features instantly — search, export, navigate'}</div>
</button>
<button class="guide-bridge-card" onclick="this.closest('.guide-overlay').remove();var _t=document.querySelectorAll('.piltab');if(_t[19])_t[19].click();">
<span class="bridge-icon">⚙️</span>
<div class="bridge-name">${_ja?'⑳ CI/CD':'⑳ CI/CD'}</div>
<div class="bridge-why">${_ja?'デプロイ戦略・品質ゲート・リリースエンジニアリングを設計書に追加':'Add deploy strategy, quality gates & release engineering to your specs'}</div>
</button>
</div>
</div>`:''}
<div class="guide-actions">
${S.skillLv<=1?`
<button class="btn btn-s btn-sm" onclick="exportZIP()">${_ja?'📦 まずZIPを保存':'📦 Save ZIP First'}</button>
<button class="btn btn-p btn-sm" onclick="this.closest('.guide-overlay').remove()">${_ja?'✨ 始める':'✨ Let\'s Go'}</button>
`:`
<button class="btn btn-s btn-sm" onclick="window.open('devforge-v9-usage-guide.html','_blank','noopener')">${_ja?'📖 活用ガイド（別ページ）':'📖 Usage Guide (Full)'}</button>
<button class="btn btn-s btn-sm" onclick="window.open('tech-selection-guide.html','_blank','noopener')">${_ja?'📊 技術選定ガイド':'📊 Tech Selection Guide'}</button>
<button class="btn btn-s btn-sm" onclick="this.closest('.guide-overlay').remove();showManual('guide')">${_ja?'📖 詳細ガイド':'📖 Full Guide'}</button>
<button class="btn btn-s btn-sm" onclick="this.closest('.guide-overlay').remove();showManual('workflow')">${_ja?'📘 ワークフロー':'📘 Workflow'}</button>
<button class="btn btn-p btn-sm" onclick="this.closest('.guide-overlay').remove()">${_ja?'✨ 始める':'✨ Let\'s Go'}</button>
`}
</div>
</div>`;
// Keyboard accessibility
overlay.addEventListener('keydown',e=>{
if(e.key==='Escape')overlay.remove();
if(e.key==='Tab'){
const focusable=overlay.querySelectorAll('button, input, select, textarea, a[href], [tabindex]:not([tabindex="-1"])');
const first=focusable[0];const last=focusable[focusable.length-1];
if(e.shiftKey&&document.activeElement===first){e.preventDefault();last.focus();}
if(!e.shiftKey&&document.activeElement===last){e.preventDefault();first.focus();}
}
});
document.body.appendChild(overlay);
// Initial focus
const closeBtn=overlay.querySelector('.guide-close');
if(closeBtn)closeBtn.focus();
}
function toggleGuideStep(key,checked,el){
const prog=_jp(_lsGet('devforge-guide-prog'),{});
if(checked)prog[key]=1;else delete prog[key];
_lsSet('devforge-guide-prog',JSON.stringify(prog));
if(el)el.classList.toggle('guide-step-done',checked);
if(el){const ckbox=el.querySelector('.guide-ckbox');if(ckbox)ckbox.textContent=checked?'✓':'';}
// Update progress bar
const overlay=el?.closest('.guide-overlay');
if(!overlay)return;
const total=overlay.querySelectorAll('.guide-step').length;
const done=overlay.querySelectorAll('.guide-step-done').length;
const fill=overlay.querySelector('.guide-prog-fill');
const txt=overlay.querySelector('.guide-prog-txt');
if(fill)fill.style.width=Math.round(done/total*100)+'%';
if(txt)txt.textContent=done+'/'+total;
}
function showConfirm(val,onOk){
if(S.skillLv<5){onOk();return;}
_confirmCb=onOk;
const ov=$('confirmOverlay');ov.style.display='flex';
pushModal(ov,()=>{ov.style.display='none';releaseFocus(ov);_confirmCb=null;});
ov.innerHTML='<div class="confirm-modal"><h4>'+t('answerConfirm')+'</h4>'
+'<div class="cm-val">'+esc(String(val))+'</div>'
+'<div class="cm-acts">'
+'<button class="btn btn-g btn-sm" onclick="removeModal($(\'confirmOverlay\'));$(\'confirmOverlay\').style.display=\'none\';releaseFocus($(\'confirmOverlay\'));_confirmCb=null;">'+t('edit')+'</button>'
+'<button class="btn btn-p btn-sm" onclick="removeModal($(\'confirmOverlay\'));$(\'confirmOverlay\').style.display=\'none\';releaseFocus($(\'confirmOverlay\'));if(_confirmCb){_confirmCb();_confirmCb=null;}">'+t('confirm')+'</button>'
+'</div></div>';
trapFocus(ov);
}
function getComplexityHTML(){
const a=S.answers;const _ja=S.lang==='ja';
const fs=(a.mvp_features||'').split(',').map(s=>s.trim()).filter(Boolean);
const fCount=fs.length;
const eCount=((a.data_entities||'').split(',')).filter(Boolean).length;
const sCount=((a.screens||'').split(',')).filter(Boolean).length;
const authCount=((a.auth||'').split(',')).filter(Boolean).length;
const hasTDD=hasDM('TDD')?1:0,hasBDD=hasDM('BDD')?1:0,hasDDD=hasDM('DDD')?1:0;
const beComplex=(a.backend||'').includes('なし')||(a.backend||'').includes('None')?0:(a.backend||'').includes('Firebase')||(a.backend||'').includes('Supabase')?1:2;
let score=0;
score+=Math.min(fCount*8,50);
score+=Math.min(eCount*3,20);
score+=Math.min(sCount*2,14);
score+=authCount*2;
score+=beComplex*5;
score+=(hasTDD+hasBDD+hasDDD)*3;
score=Math.min(score,100);
const level=score<=30?'low':score<=60?'mid':'high';
const levelLabel=score<=30?(_ja?'🟢 シンプル':'🟢 Simple'):score<=60?(_ja?'🟡 中規模':'🟡 Medium'):(_ja?'🔴 大規模':'🔴 Large');
const weeks=score<=30?(_ja?'2-4週':'2-4 wks'):score<=60?(_ja?'1-3ヶ月':'1-3 mo'):(_ja?'3-6ヶ月':'3-6 mo');
const devs=score<=30?(_ja?'1人':'1'):score<=60?(_ja?'1-2人':'1-2'):(_ja?'2-4人':'2-4');
const color=score<=30?'var(--success)':score<=60?'var(--warn)':'var(--danger)';
const _s=_ja?'件':'';
return `<div class="complexity-card"><div class="complexity-header"><div><div class="dash-total complexity-label">${_ja?'プロジェクト複雑度':'PROJECT COMPLEXITY'}</div><div class="complexity-sub">${levelLabel}</div>
</div><div class="complexity-score ${level}">${score}</div></div><div class="complexity-bar"><div class="complexity-fill" style="width:${score}%;background:${color};"></div></div><div class="complexity-grid"><div class="complexity-item"><span>${_ja?'MVP機能':'MVP Features'}</span>
<span>${fCount}${_s}</span></div><div class="complexity-item"><span>${_ja?'エンティティ':'Entities'}</span><span>${eCount}${_s}</span></div><div class="complexity-item"><span>${_ja?'画面数':'Screens'}</span><span>${sCount}${_s}</span>
</div><div class="complexity-item"><span>${_ja?'認証方式':'Auth Methods'}</span><span>${authCount}${_s}</span></div><div class="complexity-item"><span>${_ja?'推定期間':'Est. Duration'}</span><span>${weeks}</span></div>
<div class="complexity-item"><span>${_ja?'推奨人数':'Team Size'}</span><span>${devs}</span></div></div></div>`;
}
function getComplexityMini(){
const a=S.answers;
const fs=(a.mvp_features||'').split(',').map(s=>s.trim()).filter(Boolean);
const fCount=fs.length;
const eCount=((a.data_entities||'').split(',')).filter(Boolean).length;
const sCount=((a.screens||'').split(',')).filter(Boolean).length;
const authCount=((a.auth||'').split(',')).filter(Boolean).length;
const hasTDD=hasDM('TDD')?1:0,hasBDD=hasDM('BDD')?1:0,hasDDD=hasDM('DDD')?1:0;
const beComplex=(a.backend||'').includes('なし')||(a.backend||'').includes('None')?0:(a.backend||'').includes('Firebase')||(a.backend||'').includes('Supabase')?1:2;
let score=0;
score+=Math.min(fCount*8,50);
score+=Math.min(eCount*3,20);
score+=Math.min(sCount*2,14);
score+=authCount*2;
score+=beComplex*5;
score+=(hasTDD+hasBDD+hasDDD)*3;
score=Math.min(score,100);
if(!score)return '';
const color=score<=30?'var(--success)':score<=60?'var(--warn)':'var(--danger)';
const label=score<=30?'🟢':score<=60?'🟡':'🔴';
return '<span class="cx-mini" style="color:'+color+'" title="Complexity: '+score+'">⚡'+score+'</span>';
}
function showComplexity(){
const body=$('cbody');
const card=document.createElement('div');
card.innerHTML=getComplexityHTML();
body.appendChild(card.firstChild);body.scrollTop=body.scrollHeight;
}
function updTOC(){
const toc=$('tocPanel');if(!toc||!S.projectName)return;
toc.style.display='block';
const qs=getQ();let items=[];
for(let p=1;p<=3;p++){
const ph=qs[p];if(!ph)continue;
for(const q of ph.questions){
if(!isQActive(q))continue;
const done=!!S.answers[q.id];
const active=S.phase===p&&ph.questions.indexOf(q)===S.step;
items.push('<div class="toc-item'+(done?' done':'')+(active?' active':'')+'" onclick="jumpToQ(\''+q.id+'\')" title="'+esc(q.q)+'"><span class="toc-dot"></span><span>'+esc(q.q)+'</span></div>');
}
}
toc.innerHTML=items.join('');
}
function jumpToQ(qid){
const el=document.querySelector('[data-qid="'+qid+'"]');
if(el)el.scrollIntoView({behavior:'smooth',block:'center'});
}
function initVoice(){
const _ja=S.lang==='ja';
if(!('webkitSpeechRecognition' in window)&&!('SpeechRecognition' in window))return;
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
voiceRec=new SR();voiceRec.lang=_ja?'ja-JP':'en-US';voiceRec.interimResults=false;voiceRec.maxAlternatives=1;
voiceRec.onresult=(e)=>{
const text=e.results[0][0].transcript;
const inp=document.querySelector('.cadd');
if(inp){inp.value+=text;inp.focus();}
if(voiceBtn){voiceBtn.classList.remove('recording');voiceBtn.textContent='🎙️';}
};
voiceRec.onend=()=>{if(voiceBtn){voiceBtn.classList.remove('recording');voiceBtn.textContent='🎙️';}};
voiceRec.onerror=()=>{if(voiceBtn){voiceBtn.classList.remove('recording');voiceBtn.textContent='🎙️';}};
}
function toggleVoice(btn){
const _ja=S.lang==='ja';
if(!voiceRec)return;
voiceBtn=btn;
if(btn.classList.contains('recording')){voiceRec.stop();btn.classList.remove('recording');btn.textContent='🎙️';}
else{voiceRec.lang=_ja?'ja-JP':'en-US';voiceRec.start();btn.classList.add('recording');btn.textContent='⏹️';}
}
const _SAFE_KEYS=['phase','step','answers','projectName','skill','skillLv','preset','lang','genLang','theme','pillar','previewFile','files','skipped','progress','editedFiles','prevFiles','_v'];
function getProjects(){return _jp(_lsGet('devforge-projects'),{});}
function saveProject(){
if(!S.projectName)return;
const ps=getProjects();
ps[S.projectName]={state:JSON.parse(JSON.stringify(S)),date:new Date().toISOString()};
_lsSet('devforge-projects',JSON.stringify(ps));
}
function switchProject(name){
const ps=getProjects();const p=ps[name];
if(p&&p.state){
_SAFE_KEYS.forEach(k=>{if(Object.prototype.hasOwnProperty.call(p.state,k))S[k]=p.state[k];});
save();location.reload();
}
}
function deleteProject(name){
const _ja=S.lang==='ja';
if(!confirm(_ja?'「'+name+'」を削除しますか？':'Delete "'+name+'"?'))return;
const ps=getProjects();delete ps[name];
_lsSet('devforge-projects',JSON.stringify(ps));
if(S.projectName===name){_lsRm(KEY);location.reload();}
else showPM();
}
function exportProject(){
const _ja=S.lang==='ja';
const ps=getProjects();const p=ps[S.projectName];
if(!p){toast(_ja?'保存されたプロジェクトがありません':'No saved project');return;}
const blob=new Blob([JSON.stringify(p,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');a.href=url;a.download=fileSlug(S.projectName)+'.devforge.json';a.click();
URL.revokeObjectURL(url);
toast(_ja?'📁 プロジェクトをエクスポートしました':'📁 Project exported');
_lsSet('devforge-last-export',new Date().toISOString());
}
function importProject(){
const _ja=S.lang==='ja';
const inp=document.createElement('input');inp.type='file';inp.accept='.json,.devforge.json';
inp.onchange=e=>{
const f=e.target.files[0];if(!f)return;
const reader=new FileReader();
reader.onload=ev=>{
try{
const data=JSON.parse(ev.target.result);
if(!data.state||!data.state.projectName){toast(_ja?'❌ 無効なファイル形式':'❌ Invalid file format');return;}
data.state.projectName=sanitizeName(data.state.projectName);
if(data.state.answers){
Object.keys(data.state.answers).forEach(k=>{
if(['__proto__','constructor','prototype'].includes(k)){delete data.state.answers[k];return;}
if(typeof data.state.answers[k]==='string'){
data.state.answers[k]=sanitize(data.state.answers[k]);
} else {
delete data.state.answers[k];
}
});
}
if(data.state.files){
Object.keys(data.state.files).forEach(k=>{
if(['__proto__','constructor','prototype'].includes(k)){delete data.state.files[k];return;}
if(typeof data.state.files[k]!=='string'){delete data.state.files[k];}
});
}
const ps=getProjects();
ps[data.state.projectName]=data;
_lsSet('devforge-projects',JSON.stringify(ps));
_SAFE_KEYS.forEach(k=>{if(Object.prototype.hasOwnProperty.call(data.state,k))S[k]=data.state[k];});
save();
toast(_ja?'✅ インポート完了':'✅ Import complete');
location.reload();
}catch(err){toast(_ja?'❌ 読み込みエラー':'❌ Read error');}
};
reader.readAsText(f);
};
inp.click();
}
function newProject(){
if(S.projectName)saveProject();
_lsRm(KEY);location.reload();
}
function showPM(){
const _ja=S.lang==='ja';
const ov=$('pmOverlay');ov.style.display='flex';
pushModal(ov,()=>{ov.style.display='none';releaseFocus(ov);});
const ps=getProjects();const names=Object.keys(ps);
let html='<div class="pm-modal"><h3>'+t('pmTitle')+'</h3>';
if(names.length===0){html+='<p class="dash-empty">'+t('pmEmpty')+'</p>';}
else{
names.forEach(name=>{
const isCurrent=name===S.projectName;
const meta=ps[name].date?new Date(ps[name].date).toLocaleDateString():'';
const estKB=Math.round(JSON.stringify(ps[name]).length/512);
html+='<div class="pm-item'+(isCurrent?' current':'')+'" onclick="switchProject(\''+escAttr(name)+'\')"><div><div class="pm-item-name">'+esc(name)+(isCurrent?' ✓':'')+'</div><div class="pm-item-meta">'+meta+' · ~'+estKB+'KB</div></div><div class="pm-item-acts"><button onclick="event.stopPropagation();deleteProject(\''+escAttr(name)+'\')" aria-label="'+(esc(_ja?'削除':'Delete'))+'">🗑️</button></div></div>';
});
}
const usg=typeof _lsUsage==='function'?_lsUsage():{used:0,pct:0};
const usgColor=usg.pct>=80?'var(--danger)':usg.pct>=60?'var(--warn)':'var(--success)';
html+='<div class="pm-storage"><div class="pm-storage-label"><span>'+(usg.pct)+'% '+(_ja?'使用中':'used')+' (~'+Math.round(usg.used/1024)+'KB / 5120KB)</span></div><div class="pm-storage-bar"><div class="pm-storage-fill" style="width:'+Math.min(100,usg.pct)+'%;background:'+usgColor+'"></div></div></div>';
html+='<div class="pm-actions"><button class="btn btn-s" onclick="newProject()">➕ '+(_ja?'新規プロジェクト':'New Project')+'</button><button class="btn btn-s" onclick="importProject()">📥 '+(_ja?'インポート':'Import')+'</button>';
if(S.projectName)html+='<button class="btn btn-s" onclick="exportProject()">📤 '+(_ja?'エクスポート':'Export')+'</button>';
html+='<button class="btn btn-g btn-sm" onclick="closePM()">'+(_ja?'閉じる':'Close')+'</button></div></div>';
ov.innerHTML=html;
trapFocus(ov);
}
function closePM(){$('pmOverlay').style.display='none';releaseFocus($('pmOverlay'));removeModal($('pmOverlay'));}
function _updateSkillLabel(lv){
const _ja=S.lang==='ja';
var n=SKILL_NAMES[lv]||SKILL_NAMES[3];
var el=$('skillFineLabel');
if(el)el.textContent=n.emoji+' '+(_ja?n.ja:n.en);
}
function pickSkillLv(n){
n=Math.max(0,Math.min(6,+n));
S.skillLv=n;
S.skill=skillTier(n);
// sync card highlight
var cards=document.querySelectorAll('.skcard');
cards.forEach(function(c){c.classList.remove('on');c.setAttribute('aria-checked','false');});
var tIdx={'beginner':0,'intermediate':1,'pro':2}[S.skill];
if(cards[tIdx]){cards[tIdx].classList.add('on');cards[tIdx].setAttribute('aria-checked','true');}
_updateSkillLabel(n);
save();
}
function pickSkill(lv){
S.skill=lv;
// Set skillLv to tier's default level
var defaultLv={'beginner':1,'intermediate':3,'pro':5}[lv]||3;
S.skillLv=defaultLv;
document.querySelectorAll('.skcard').forEach(c=>{c.classList.toggle('on',c.dataset.lv===lv);c.setAttribute('aria-checked',String(c.dataset.lv===lv));});
// Sync slider and label
var sl=$('skillLvSlider');if(sl){sl.value=S.skillLv;}
_updateSkillLabel(S.skillLv);
save();
}
/* Preset category map */
const PRESET_CAT_MAP={
saas:'saas_ai',ai_agent:'saas_ai',ai_content:'saas_ai',automation:'saas_ai',chatbot:'saas_ai',devtool:'saas_ai',
ec:'ec_market',marketplace:'ec_market',booking:'ec_market',event:'ec_market',restaurant:'ec_market',
creator:'media_sns',newsletter:'media_sns',cms:'media_sns',community:'media_sns',linkbio:'media_sns',social:'media_sns',gamify:'media_sns',pwa:'media_sns',
hr:'business',helpdesk:'business',crm:'business',knowledge_base:'business',contract_mgmt:'business',survey:'business',job_board:'business',
dashboard:'data_iot',iot:'data_iot',collab:'data_iot',field_service:'data_iot',logistics:'data_iot',
fintech:'life_pro',health:'life_pro',property_mgmt:'life_pro',veterinary:'life_pro',clinic:'life_pro',construction_pay:'life_pro',lms:'life_pro',tutoring:'life_pro',portfolio:'life_pro',
factory:'data_iot',agri:'life_pro',energy:'data_iot',media_platform:'media_sns',gov_portal:'business',travel_booking:'life_pro',insurance_mgmt:'life_pro',
};
const PRESET_CATS_JA=[{key:'all',label:'すべて',desc:'全48プリセット'},{key:'saas_ai',label:'☁️ SaaS・AI',desc:'クラウドサービス・AI自動化'},{key:'ec_market',label:'🛒 EC・マーケット',desc:'販売・予約・イベント'},{key:'media_sns',label:'📱 メディア・SNS',desc:'情報発信・クリエイター・交流'},{key:'business',label:'🏢 ビジネス・業務',desc:'業務効率化・HR・CRM'},{key:'data_iot',label:'📊 データ・IoT',desc:'分析・デバイス管理・コラボ'},{key:'life_pro',label:'🏥 生活・専門',desc:'医療・教育・不動産・物流'}];
const PRESET_CATS_EN=[{key:'all',label:'All',desc:'All 48 presets'},{key:'saas_ai',label:'☁️ SaaS & AI',desc:'Cloud services & AI automation'},{key:'ec_market',label:'🛒 E-Commerce',desc:'Sales, booking & events'},{key:'media_sns',label:'📱 Media & SNS',desc:'Content, creator & community'},{key:'business',label:'🏢 Business',desc:'Workflow, HR & CRM'},{key:'data_iot',label:'📊 Data & IoT',desc:'Analytics, devices & collab'},{key:'life_pro',label:'🏥 Life & Pro',desc:'Healthcare, education & logistics'}];
let _presetCatFilter='all';
/* ─── Field Preset Mode ─────────────────────────────────────── */
var _presetMode='standard';   // 'standard' | 'field'
var _fieldScale='small';      // 'solo'|'small'|'medium'|'large'
var _fieldCatFilter='all';    // field category key or 'all'
function _renderFieldChips(){
const _ja=S.lang==='ja';const _en=!_ja;
const row=$('presetRow');if(!row||typeof PR_FIELD==='undefined')return;
Array.from(row.querySelectorAll('.prchip')).forEach(c=>c.remove());
const insertBefore=row.querySelector('.preset-footer');
Object.entries(PR_FIELD).forEach(function([k,v]){
if(!v||!v.name)return;
if(_fieldCatFilter!=='all'&&v.field!==_fieldCatFilter)return;
const c=document.createElement('span');c.className='prchip';
c.textContent=(v.icon||'')+(v.icon?' ':'')+(_en&&v.nameEn?v.nameEn:v.name);
if(S.preset===('field:'+k))c.classList.add('on');
c.onclick=function(e){pickFieldPreset(k,e);};
// Tooltip: scaleHint + meta
const sh=v.scaleHint&&v.scaleHint[_fieldScale]?(_ja?v.scaleHint[_fieldScale].ja:v.scaleHint[_fieldScale].en):'';
const m=v.meta||{};
const regLbl=_ja?'📋規制:':'📋Reg:';
const metaStr=regLbl+(m.regulation||'-')+' | 🤖'+(m.agentLv||'-')+' | 🖼️'+(m.multimodal||'-')+' | ☁️'+(m.onDevice||'-');
const purpose=(_en&&v.purposeEn)?v.purposeEn:v.purpose||'';
c.title=purpose+(sh?'\n─────\n'+sh:'')+'\n─────\n'+metaStr;
if(insertBefore)row.insertBefore(c,insertBefore);else row.appendChild(c);
});
}
function pickFieldPreset(k,e){
const _ja=S.lang==='ja';const _en=!_ja;
const v=PR_FIELD[k];if(!v)return;
S.preset='field:'+k;
document.querySelectorAll('.prchip').forEach(c=>c.classList.remove('on'));
if(e&&e.target)e.target.classList.add('on');
if(v.name)$('nameIn').value=(_en&&v.nameEn)?v.nameEn:v.name;
save();
}
function _switchPresetMode(mode){
_presetMode=mode;
const row=$('presetRow');if(!row)return;
// Sync mode toggle button styles
const btns=row.querySelectorAll('.preset-mode-btn');
btns.forEach(function(b){b.classList.toggle('active',b.dataset.mode===mode);});
// Show/hide scale+field-cat bars
const scaleSel=row.querySelector('.scale-selector');if(scaleSel)scaleSel.style.display=mode==='field'?'flex':'none';
const fcBar=row.querySelector('.field-cat-bar');if(fcBar)fcBar.style.display=mode==='field'?'flex':'none';
const stdBar=row.querySelector('.preset-cat-bar');if(stdBar)stdBar.style.display=mode==='standard'?'flex':'none';
if(mode==='standard')_renderPresetChips();else _renderFieldChips();
}
var _beginnerPresets=new Set(['saas','lms','portfolio','cms','ec']);
function _renderPresetChips(){
const row=$('presetRow');if(!row)return;
const _ja=S.lang==='ja';const _en=!_ja;
// Remove existing chips (keep category bar + footer)
Array.from(row.querySelectorAll('.prchip')).forEach(c=>c.remove());
const insertBefore=row.querySelector('.preset-footer');
Object.entries(PR).forEach(([k,v])=>{
if(k==='custom'||!v.name)return;
// Lv0-1: show only 5 beginner-safe presets
if(S.skillLv<=1&&!_beginnerPresets.has(k))return;
const cat=PRESET_CAT_MAP[k]||'saas_ai';
if(_presetCatFilter!=='all'&&cat!==_presetCatFilter)return;
const c=document.createElement('span');c.className='prchip';
c.textContent=(v.icon||'')+(v.icon?' ':'')+(_en&&v.nameEn?v.nameEn:v.name);
if(S.preset===k)c.classList.add('on');
c.onclick=(e)=>pickPreset(k,e);
const desc=(_en&&v.purposeEn)?v.purposeEn:v.purpose||'';
const fe=v.frontend||'-';const be=v.backend||'-';
const fts=(_en&&v.featuresEn?v.featuresEn:v.features)||[];
const ftStr=Array.isArray(fts)?fts.slice(0,3).join(', ')+(fts.length>3?' …':''):fts;
c.title=desc+'\n─────\nFrontend: '+fe+'\nBackend: '+be+'\nFeatures: '+ftStr;
if(insertBefore)row.insertBefore(c,insertBefore);else row.appendChild(c);
});
}
/* ── Preset Suggest ──────────────────────────────────────────────── */
function _scorePreset(preset, key, query, isField){
var words=query.toLowerCase().split(/[\s,、・\/]+/).filter(Boolean);
if(!words.length) return 0;
var score=0;
var nm=((preset.name||'')+(preset.nameEn||'')).toLowerCase();
var pu=((preset.purpose||'')+(preset.purposeEn||'')).toLowerCase();
var ent=((preset.entities||'')).toLowerCase();
for(var i=0;i<words.length;i++){
var w=words[i];
if(w.length<2) continue;
if(nm.indexOf(w)>=0) score+=3;
if(pu.indexOf(w)>=0) score+=2;
if(ent.indexOf(w)>=0) score+=1;
if(key.indexOf(w)>=0) score+=2;
}
if(typeof detectDomain==='function'){
var qDomain=detectDomain(query);
if(qDomain){
var pDomain=detectDomain(preset.purpose||'');
if(pDomain===qDomain) score+=5;
}
}
return score;
}
function _suggestPresets(query){
var box=$('presetSuggestBox');if(!box)return;
const _ja=S.lang==='ja';var _en=!_ja;
query=(query||'').trim();
if(query.length<2){box.innerHTML='';box.style.display='none';return;}
var results=[];
Object.entries(PR).forEach(function(e){
var k=e[0],v=e[1];
if(k==='custom'||!v.name)return;
if(S.skillLv<=1&&!_beginnerPresets.has(k))return;
var sc=_scorePreset(v,k,query,false);
if(sc>0)results.push({key:k,preset:v,score:sc,isField:false});
});
if(S.skillLv>=2&&typeof PR_FIELD!=='undefined'){
Object.entries(PR_FIELD).forEach(function(e){
var k=e[0],v=e[1];
if(!v||!v.name)return;
var sc=_scorePreset(v,k,query,true);
if(sc>0)results.push({key:k,preset:v,score:sc,isField:true});
});
}
results.sort(function(a,b){return b.score-a.score;});
results=results.slice(0,5);
if(!results.length){
box.innerHTML='<div class="ps-empty">'+(_ja?'一致するプリセットがありません':'No matching presets')+'</div>';
box.style.display='block';return;
}
var out='';
results.forEach(function(r){
var p=r.preset;
var pnm=(_en&&p.nameEn?p.nameEn:p.name)||'';
if(p.icon)pnm=p.icon+' '+pnm;
var desc=(_en&&p.purposeEn?p.purposeEn:p.purpose||'').slice(0,60);
var badge=r.isField?'<span class="ps-badge-field">🎓</span>':'<span class="ps-badge-std">📦</span>';
out+='<div class="ps-item" onclick="_pickSuggested(\''+escAttr(r.key)+'\','+r.isField+')" role="button" tabindex="0">';
out+=badge+'<span class="ps-name">'+esc(pnm)+'</span>';
out+='<span class="ps-desc">'+esc(desc)+'</span>';
out+='<span class="ps-score">'+r.score+'pt</span>';
out+='</div>';
});
box.innerHTML=out;box.style.display='block';
}
function _pickSuggested(key,isField){
const _ja=S.lang==='ja';
if(isField&&_presetMode!=='field'&&S.skillLv>=2){_switchPresetMode('field');}
if(!isField&&_presetMode!=='standard'){_switchPresetMode('standard');}
if(isField){pickFieldPreset(key,null);}
else{pickPreset(key,null);}
var box=$('presetSuggestBox');if(box){box.innerHTML='';box.style.display='none';}
var sin=$('presetSuggestIn');if(sin)sin.value='';
var pName='';
if(!isField&&PR[key]){pName=(_ja||true)&&!(S.lang==='en')&&PR[key].name?PR[key].name:(PR[key].nameEn||PR[key].name||'');}
else if(isField&&typeof PR_FIELD!=='undefined'&&PR_FIELD[key]){pName=(S.lang==='en'&&PR_FIELD[key].nameEn?PR_FIELD[key].nameEn:PR_FIELD[key].name)||'';}
if(pName){
document.querySelectorAll('.prchip').forEach(function(c){
if(c.textContent.indexOf(pName)>=0){
c.classList.add('on');
if(typeof c.scrollIntoView==='function')c.scrollIntoView({behavior:'smooth',block:'nearest'});
}
});
}
}
function initPresets(){
const row=$('presetRow');row.innerHTML='';
const _ja=S.lang==='ja';
if(S.preset&&S.preset.slice(0,6)==='field:'&&typeof PR_FIELD!=='undefined'){_presetMode='field';}
// ── Preset Suggest Input ──
var suggestWrap=document.createElement('div');suggestWrap.className='preset-suggest-wrap';
var suggestIn=document.createElement('input');suggestIn.type='text';suggestIn.className='preset-suggest-in';
suggestIn.id='presetSuggestIn';
suggestIn.placeholder=_ja?'🔍 何を作りたい？ 例: 農業IoT / 教育チューター / 医療カルテ':'🔍 What to build? e.g., farm IoT / tutoring / medical records';
suggestIn.setAttribute('aria-label',_ja?'プリセット検索':'Search presets');
var suggestBox=document.createElement('div');suggestBox.className='preset-suggest-box';suggestBox.id='presetSuggestBox';
suggestWrap.appendChild(suggestIn);suggestWrap.appendChild(suggestBox);
row.appendChild(suggestWrap);
var _suggestTimer=null;
suggestIn.addEventListener('input',function(){
clearTimeout(_suggestTimer);
_suggestTimer=setTimeout(function(){_suggestPresets(suggestIn.value);},300);
});
// ── Mode Toggle (📦 標準 | 🎓 分野別) — hidden for Lv0-1 ──
if(S.skillLv>=2&&typeof PR_FIELD!=='undefined'){
const modeBar=document.createElement('div');modeBar.className='preset-mode-toggle';
const modes=_ja?[{k:'standard',l:'📦 標準'},{k:'field',l:'🎓 分野別'}]:[{k:'standard',l:'📦 Standard'},{k:'field',l:'🎓 Field'}];
modes.forEach(function(m){
const b=document.createElement('button');b.className='preset-mode-btn'+((_presetMode===m.k)?' active':'');
b.dataset.mode=m.k;b.textContent=m.l;
b.onclick=function(){_switchPresetMode(m.k);};
modeBar.appendChild(b);
});
row.appendChild(modeBar);
}
// ── Scale Selector (field mode only) ──
const scaleKeys=['solo','small','medium','large'];
const scaleLabels=_ja?['👤 個人','🏠 小規模','🏢 中規模','🏭 大規模']:['👤 Solo','🏠 Small','🏢 Medium','🏭 Large'];
const scaleSel=document.createElement('div');scaleSel.className='scale-selector';
scaleSel.style.display=_presetMode==='field'?'flex':'none';
scaleKeys.forEach(function(sk,i){
const b=document.createElement('button');b.className='scale-btn'+((_fieldScale===sk)?' active':'');
b.textContent=scaleLabels[i];b.dataset.scale=sk;
b.onclick=function(){
_fieldScale=sk;
scaleSel.querySelectorAll('.scale-btn').forEach(function(sb){sb.classList.toggle('active',sb.dataset.scale===sk);});
_renderFieldChips();
};
scaleSel.appendChild(b);
});
row.appendChild(scaleSel);
// ── Field Category Bar (field mode only) ──
const fcBar=document.createElement('div');fcBar.className='field-cat-bar';
fcBar.style.display=_presetMode==='field'?'flex':'none';
if(typeof FIELD_CATS_JA!=='undefined'&&typeof FIELD_CATS_EN!=='undefined'){
const fcats=_ja?FIELD_CATS_JA:FIELD_CATS_EN;
const trend=typeof FIELD_TREND!=='undefined'?FIELD_TREND:{};
fcats.forEach(function(fc){
const b=document.createElement('button');b.className='field-cat-btn'+((_fieldCatFilter===fc.key)?' active':'');
const stars=fc.key!=='all'&&trend[fc.key]?'⭐'.repeat(trend[fc.key]):'';
b.textContent=fc.label+(stars?' '+stars:'');b.title=(fc.desc||'')+(stars?' | '+(_ja?'成長トレンド: ':'Growth Trend: ')+stars:'');
b.onclick=function(){
_fieldCatFilter=fc.key;
fcBar.querySelectorAll('.field-cat-btn').forEach(function(fb){fb.classList.toggle('active',fb===b);});
_renderFieldChips();
};
fcBar.appendChild(b);
});
}
row.appendChild(fcBar);
// ── Standard Category Bar ──
const catBar=document.createElement('div');catBar.className='preset-cat-bar';catBar.id='presetCatBar';
catBar.style.display=_presetMode==='standard'?'flex':'none';
const cats=_ja?PRESET_CATS_JA:PRESET_CATS_EN;
cats.forEach(cat=>{
const btn=document.createElement('button');
btn.className='preset-cat-btn'+(_presetCatFilter===cat.key?' active':'');
btn.textContent=cat.label;btn.title=cat.desc;
btn.onclick=()=>{
_presetCatFilter=cat.key;
row.querySelectorAll('.preset-cat-btn').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
_renderPresetChips();
};
catBar.appendChild(btn);
});
// Lv0-1: hide category bar (only 5 presets shown, no need for filters)
if(S.skillLv<=1)catBar.style.display='none';
row.appendChild(catBar);
// Footer area (compare + custom + notice) — appended BEFORE chips so _renderPresetChips can insertBefore it
const footer=document.createElement('div');footer.className='preset-footer';
// Compare button (hidden for Lv0-1)
const cb=document.createElement('span');cb.className='prchip prchip-cmp';
cb.textContent=_ja?'⚔️ 比較':'⚔️ Compare';
cb.onclick=()=>showPresetCompare();
if(S.skillLv<=1)cb.style.display='none';
footer.appendChild(cb);
// "Start from scratch" custom mode chip
const cs=document.createElement('span');cs.className='prchip prchip-custom';
cs.textContent=_ja?'📝 白紙から始める':'📝 Start from scratch';
cs.onclick=()=>{
S.preset='custom';
document.querySelectorAll('.prchip').forEach(c=>c.classList.remove('sel'));
cs.classList.add('sel');
toast(_ja?'カスタムモード — 全質問に回答します':'Custom mode — answer all questions');
};
footer.appendChild(cs);
// localStorage safety notice
const notice=document.createElement('div');notice.className='preset-storage-notice';
notice.innerHTML='<span>💾 '+(  _ja
?'データはこのブラウザのみに保存されます。履歴消去で消えます — 完了後は必ずZIPで保存を'
:'Data is saved in this browser only. Clearing history erases it — always download ZIP when done'
)+'</span>';
footer.appendChild(notice);
row.appendChild(footer);
// Render chips (inserted before footer)
if(_presetMode==='field')_renderFieldChips();else _renderPresetChips();
}
function showPresetCompare(){
const _ja=S.lang==='ja';const _en=S.lang==='en';
const keys=Object.keys(PR).filter(k=>k!=='custom'&&PR[k].name);
const opts=keys.map(k=>{const p=PR[k];return `<option value="${k}">${p.icon||''} ${_en&&p.nameEn?p.nameEn:p.name}</option>`;}).join('');
const ov=document.createElement('div');ov.className='guide-overlay';ov.id='cmpOv';
ov.setAttribute('role','dialog');
ov.setAttribute('aria-modal','true');
ov.setAttribute('aria-label',_ja?'テンプレート比較':'Template Comparison');
ov.onclick=e=>{if(e.target===ov)ov.remove();};
ov.addEventListener('keydown',e=>{if(e.key==='Escape')ov.remove();});
ov.innerHTML=`<div class="guide-modal" style="max-width:680px;width:95%;">
<div class="guide-header"><span class="guide-em">⚔️</span><div><div class="guide-title">${_ja?'テンプレート比較':'Template Comparison'}</div><div class="guide-sub">${_ja?'2つのプリセットを並べて比較':'Compare two presets side by side'}</div></div><button class="guide-close" aria-label="${_ja?'閉じる':'Close'}" onclick="$('cmpOv').remove()">✕</button></div>
<div class="cmp-selectors"><select id="cmpA" aria-label="${_ja?'比較対象A':'Comparison subject A'}" onchange="renderCompare()">${opts}</select><span class="cmp-vs">VS</span><select id="cmpB" aria-label="${_ja?'比較対象B':'Comparison subject B'}" onchange="renderCompare()">${opts.replace('value="'+keys[0]+'"','value="'+keys[1]+'"')}</select></div>
<div id="cmpBody"></div>
</div>`;
document.body.appendChild(ov);
$('cmpB').value=keys[1];
renderCompare();
}
function renderCompare(){
const _ja=S.lang==='ja';const _en=S.lang==='en';
const a=PR[$('cmpA').value];const b=PR[$('cmpB').value];
const n=k=>(_en&&k+'En' in a)?a[k+'En']:a[k];
const nb=k=>(_en&&k+'En' in b)?b[k+'En']:b[k];
const ft=v=>{const f=Array.isArray(v)?v:[];return f.length;};
const rows=[
[_ja?'目的':'Purpose',n('purpose')||'-',nb('purpose')||'-'],
['Frontend',a.frontend||'-',b.frontend||'-'],
['Backend',a.backend||'-',b.backend||'-'],
[_ja?'機能数':'Features',ft(_en?a.featuresEn:a.features),ft(_en?b.featuresEn:b.features)],
['Mobile',a.mobile||'none',b.mobile||'none'],
['AI',a.ai_auto||'none',b.ai_auto||'none'],
[_ja?'決済':'Payment',a.payment||'none',b.payment||'none'],
['Entities',(a.entities||'').split(',').length,(b.entities||'').split(',').length],
];
let h='<table class="cmp-table"><tr><th></th><th>'+(a.icon||'')+' '+(n('name')||'')+'</th><th>'+(b.icon||'')+' '+(nb('name')||'')+'</th></tr>';
rows.forEach(r=>{
const diff=String(r[1])!==String(r[2]);
h+=`<tr${diff?' class="cmp-diff"':''}><td class="cmp-label">${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td></tr>`;
});
h+='</table>';
$('cmpBody').innerHTML=h;
}
function pickPreset(k,e){
S.preset=k;
document.querySelectorAll('.prchip').forEach(c=>c.classList.remove('on'));
if(e&&e.target)e.target.classList.add('on');
const p=PR[k];
if(p&&p.name)$('nameIn').value=(S.lang==='en'&&p.nameEn)?p.nameEn:p.name;
save();
}
function start(){
const _ja=S.lang==='ja';
const name=sanitizeName($('nameIn').value);
if(!name){toast(_ja?'プロジェクト名を入力してください':'Please enter a project name');return;}
S.projectName=name;S.phase=1;S.step=0;S.skipped=[];
// Lv0 forced preset: absolute beginners get SaaS preset auto-selected
if(S.skillLv===0&&S.preset==='custom'){
S.preset='saas';
toast(_ja?'初心者向けにSaaSプリセットを自動選択しました':'Auto-selected SaaS preset for beginners');
}
const _en=S.lang==='en';
// ── Field Preset Mode: apply scale defaults then field preset overrides ──
var _isFieldPreset=S.preset&&S.preset.slice(0,6)==='field:';
if(_isFieldPreset&&typeof PR_FIELD!=='undefined'&&typeof _SCALE_DEFAULTS!=='undefined'){
const fk=S.preset.slice(6);
const fp=PR_FIELD[fk];
const sd=_SCALE_DEFAULTS[_fieldScale]||_SCALE_DEFAULTS.small;
if(fp){
// Layer 1: Apply scale defaults first
if(sd.frontend)S.answers.frontend=sd.frontend;
if(sd.backend)S.answers.backend=sd.backend;
if(sd.deploy)S.answers.deploy=sd.deploy;
if(sd.ai_auto)S.answers.ai_auto=sd.ai_auto;
if(sd.database)S.answers.database=sd.database;
if(sd.auth){S.answers.auth=_en&&sd.auth==='メール/パスワード'?'Email/Password':sd.auth;}
if(sd.css_fw)S.answers.css_fw=sd.css_fw;
if(sd.dev_methods){S.answers.dev_methods=_en&&sd.dev_methodsEn?sd.dev_methodsEn:sd.dev_methods;}
if(_en&&S.answers.ai_auto){
var _aiMap={'Vibe Coding入門':'Vibe Coding Intro','エージェント型開発':'Agentic Dev','マルチAgent協調':'Multi-Agent','フル自律開発':'Full Autonomous','オーケストレーター':'Orchestrator'};
S.answers.ai_auto=_aiMap[S.answers.ai_auto]||S.answers.ai_auto;
}
// Layer 2: Category defaults (target, screens, payment, mobile)
var _catDef=(typeof FIELD_CAT_DEFAULTS!=='undefined')?FIELD_CAT_DEFAULTS[fp.field]:null;
if(_catDef){
if(_catDef.target){
var _ct=_en&&_catDef.targetEn?_catDef.targetEn:_catDef.target;
S.answers.target=Array.isArray(_ct)?_ct.join(', '):_ct;
}
if(_catDef.screens){
var _cs=_en&&_catDef.screensEn?_catDef.screensEn:_catDef.screens;
S.answers.screens=Array.isArray(_cs)?_cs.join(', '):_cs;
}
var _payMapL2=_en
?{stripe:'Stripe',stripe_billing:'Stripe Billing (Sub)',ec_build:'Stripe, Medusa (OSS EC)'}
:{stripe:'Stripe決済',stripe_billing:'Stripe Billing (サブスク)',ec_build:'Stripe決済, Medusa (OSS EC)'};
if(_catDef.payment&&_catDef.payment!=='none'){
S.answers.payment=_payMapL2[_catDef.payment]||_catDef.payment;
}
if(_catDef.mobile&&_catDef.mobile!=='none'){
S.answers.mobile=_catDef.mobile;
}
if(_catDef.org_model){var _omMapL2={'マルチテナント(RLS)':'Multi-tenant (RLS)','ワークスペース型':'Workspace-based','シングルテナント':'Single-tenant','組織+チーム階層':'Org + Team hierarchy'};S.answers.org_model=_en?(_omMapL2[_catDef.org_model]||_catDef.org_model):_catDef.org_model;}
}
// Layer 3: Field preset specifics (overrides Layer 2)
if(fp.purpose)S.answers.purpose=(_en&&fp.purposeEn)?fp.purposeEn:fp.purpose;
if(fp.target){var _ft=_en&&fp.targetEn?fp.targetEn:fp.target;S.answers.target=Array.isArray(_ft)?_ft.join(', '):_ft;}
if(fp.features){var _ff=_en&&fp.featuresEn?fp.featuresEn:fp.features;S.answers.mvp_features=Array.isArray(_ff)?_ff.join(', '):_ff;}
if(fp.entities)S.answers.data_entities=fp.entities;
if(fp.payment&&fp.payment!=='none'){S.answers.payment=_payMapL2[fp.payment]||fp.payment;}
if(fp.mobile&&fp.mobile!=='none')S.answers.mobile=fp.mobile;
if(fp.screens){var _fsc=_en&&fp.screensEn?fp.screensEn:fp.screens;S.answers.screens=Array.isArray(_fsc)?_fsc.join(', '):_fsc;}
// Layer 4: meta→answer inference
if(fp.meta){
// revenue='subscription' → payment (if not already set by L2/L3)
if(fp.meta.revenue==='subscription'&&(!S.answers.payment||/なし|None/i.test(S.answers.payment))){
S.answers.payment=_en?'Stripe Billing (Sub)':'Stripe Billing (サブスク)';
}
// onDevice='edge_cloud' + multimodal contains 'image' → mobile (if not already set by L2/L3)
if(fp.meta.onDevice==='edge_cloud'&&/image/i.test(fp.meta.multimodal||'')
&&(!S.answers.mobile||/なし|None/i.test(S.answers.mobile))){
S.answers.mobile='Expo (React Native)';
}
// regulation='strict' → dev_methods (always override — security must be enforced)
if(fp.meta.regulation==='strict'){
S.answers.dev_methods=_en
?'TDD (Test-Driven), SDD (Spec-Driven), Security-First'
:'TDD（テスト駆動）, SDD（仕様駆動）, セキュリティファースト';
}
// btob + strict → org_model enterprise upgrade (if single-tenant default from L2)
if(fp.meta.revenue==='btob'&&fp.meta.regulation==='strict'){
var _cur=S.answers.org_model||'';
if(!_cur||/シングルテナント|Single-tenant/i.test(_cur)){
S.answers.org_model=_en?'Org + Team hierarchy':'組織+チーム階層';
}
}
}
}
// N-2: deadline default based on scale
if(!S.answers.deadline){
S.answers.deadline=(_fieldScale==='large'||_fieldScale==='medium')?(_en?'6 months':'6ヶ月'):(_en?'3 months':'3ヶ月');
}
_applyUniversalPostProcess(_en);
var presetName=fp&&fp.name?(_en&&fp.nameEn?fp.nameEn:fp.name):'';
var preFilledCount=Object.keys(S.answers).length;
save();saveProject();
const onbF=$('onboard');const wsF=$('ws');
onbF.classList.add('phase-exit');
setTimeout(()=>{onbF.style.display='none';wsF.style.display='flex';wsF.classList.add('phase-enter');setTimeout(()=>wsF.classList.remove('phase-enter'),300);},200);
if(typeof initSidebar==='function')initSidebar();
initPills();updProgress();
if(S.skillLv<=1){addMsg('bot',_ja?'🌱 質問に答えるだけで設計書が自動生成されます。難しく考えなくてOK！スキップもできます。':'🌱 Just answer the questions and design docs will be auto-generated. Don\'t overthink it — you can skip any question!');}
showQ();
if(presetName&&preFilledCount>0){toast(_ja?'✅ "'+presetName+'" ['+_fieldScale+'] を適用 — '+preFilledCount+'件の回答を自動入力':'✅ Applied "'+presetName+'" [Scale: '+_fieldScale+'] — '+preFilledCount+' answers pre-filled');}
return;
}
const p=PR[S.preset];
if(p&&p.name){
if(p.purpose)S.answers.purpose=(_en&&p.purposeEn)?p.purposeEn:p.purpose;
if(p.target){const t=_en&&p.targetEn?p.targetEn:p.target;S.answers.target=Array.isArray(t)?t.join(', '):t;}
if(p.frontend)S.answers.frontend=p.frontend;
if(p.backend)S.answers.backend=p.backend;
if(p.features){const f=_en&&p.featuresEn?p.featuresEn:p.features;S.answers.mvp_features=Array.isArray(f)?f.join(', '):f;}
if(p.entities)S.answers.data_entities=p.entities;
if(p.screens){const sc=_en&&p.screensEn?p.screensEn:p.screens;S.answers.screens=Array.isArray(sc)?sc.join(', '):sc;}
if(p.org_model){var _omMap={'マルチテナント(RLS)':'Multi-tenant (RLS)','ワークスペース型':'Workspace-based','シングルテナント':'Single-tenant','組織+チーム階層':'Org + Team hierarchy'};S.answers.org_model=_en?(_omMap[p.org_model]||p.org_model):p.org_model;}
if(p.deploy)S.answers.deploy=p.deploy;
if(p.css_fw)S.answers.css_fw=p.css_fw;
if(p.dev_methods)S.answers.dev_methods=_en&&p.dev_methodsEn?p.dev_methodsEn:p.dev_methods;
if(p.mobile&&p.mobile!=='none')S.answers.mobile=p.mobile;
if(p.ai_auto&&p.ai_auto!=='none'){
if(_en){
const _aiMap={'Vibe Coding入門':'Vibe Coding Intro','エージェント型開発':'Agentic Dev','マルチAgent協調':'Multi-Agent','フル自律開発':'Full Autonomous','オーケストレーター':'Orchestrator'};
S.answers.ai_auto=_aiMap[p.ai_auto]||p.ai_auto;
} else { S.answers.ai_auto=p.ai_auto; }
}
if(p.payment&&p.payment!=='none'){
const _payMap=_en
?{stripe:'Stripe',ec_build:'Stripe, Medusa (OSS EC)',stripe_billing:'Stripe Billing (Sub)'}
:{stripe:'Stripe決済',ec_build:'Stripe決済, Medusa (OSS EC)',stripe_billing:'Stripe Billing (サブスク)'};
S.answers.payment=_payMap[p.payment]||p.payment;
}
}
// N-2: deadline default (3ヶ月 for standard presets)
if(!S.answers.deadline) S.answers.deadline=_en?'3 months':'3ヶ月';
_applyUniversalPostProcess(_en);
var presetName=p&&p.name?(_en&&p.nameEn?p.nameEn:p.name):'';
var preFilledCount=Object.keys(S.answers).length;
save();saveProject();
// View transition animation (HCD: ⑤感情体験)
const onb=$('onboard');
const ws=$('ws');
onb.classList.add('phase-exit');
setTimeout(()=>{
onb.style.display='none';
ws.style.display='flex';
ws.classList.add('phase-enter');
setTimeout(()=>ws.classList.remove('phase-enter'),300);
},200);
if(typeof initSidebar==='function')initSidebar();
initPills();updProgress();
if(S.skillLv<=1){addMsg('bot',_ja?'🌱 質問に答えるだけで設計書が自動生成されます。難しく考えなくてOK！スキップもできます。':'🌱 Just answer the questions and design docs will be auto-generated. Don\'t overthink it — you can skip any question!');}
showQ();
if(presetName&&preFilledCount>0){
toast(_ja?'✅ "'+presetName+'" を適用 — '+preFilledCount+'件の回答を自動入力':'✅ Applied "'+presetName+'" — '+preFilledCount+' answers pre-filled');
}
}
/* Universal post-processing: infer database & auth from backend (all presets, all skill levels) */
function _applyUniversalPostProcess(_en){
const _ja=S.lang==='ja';
const be=S.answers.backend||'';
const _isStatic=!be||/なし|None|static/i.test(be);
// Database/Auth defaults: only for non-static backends
if(!_isStatic){
if(!S.answers.database){
if(/Firebase/i.test(be))S.answers.database='Firebase Firestore';
else if(/Supabase/i.test(be))S.answers.database='Supabase (PostgreSQL)';
else S.answers.database='PostgreSQL';
}
if(!S.answers.auth){
if(/Firebase/i.test(be))S.answers.auth='Firebase Auth';
else if(/Supabase/i.test(be))S.answers.auth='Supabase Auth';
else S.answers.auth=_en?'Email/Password':_ja?'メール/パスワード':'Email/Password';
}
}
// N-3: dev_env_type for BaaS backends
if(!S.answers.dev_env_type&&/Firebase|Supabase|Convex/i.test(be)){
S.answers.dev_env_type=_ja?'ローカル開発':'Local Development';
}
// N-4: org_model inference from domain (if not already set by preset/Layer 2-3)
if(!S.answers.org_model&&S.answers.purpose){
var _dom2=(typeof detectDomain==='function')?detectDomain(S.answers.purpose||''):'';
var _orgInfer={saas:'マルチテナント(RLS)',analytics:'シングルテナント',collab:'ワークスペース型',hr:'シングルテナント',tool:'シングルテナント',automation:'ワークスペース型',fintech:'シングルテナント',legal:'シングルテナント',ec:'シングルテナント',marketplace:'マルチテナント(RLS)',logistics:'シングルテナント',insurance:'シングルテナント'};
var _orgInferEn={saas:'Multi-tenant (RLS)',analytics:'Single-tenant',collab:'Workspace-based',hr:'Single-tenant',tool:'Single-tenant',automation:'Workspace-based',fintech:'Single-tenant',legal:'Single-tenant',ec:'Single-tenant',marketplace:'Multi-tenant (RLS)',logistics:'Single-tenant',insurance:'Single-tenant'};
if(_dom2&&_orgInfer[_dom2]){S.answers.org_model=_en?(_orgInferEn[_dom2]||_orgInfer[_dom2]):_orgInfer[_dom2];}
}
// N-5: ai_tools from ai_auto level
if(!S.answers.ai_tools){
var _aL=S.answers.ai_auto||'';
if(_aL&&!/none|なし/i.test(_aL)){
if(/オーケストレーター|Orchestrator/i.test(_aL)||/フル自律|Full Autonomous/i.test(_aL)){
S.answers.ai_tools='Cursor, Claude Code, GitHub Copilot, Google Antigravity';
} else if(/マルチAgent|Multi-Agent/i.test(_aL)){
S.answers.ai_tools='Cursor, Claude Code, GitHub Copilot';
} else {
S.answers.ai_tools='Cursor, Claude Code';
}
}
}
// N-6 (G-6 extended): success KPI from domain — all 32 domains (standard presets only)
if(!S.answers.success&&S.answers.purpose&&!(S.preset||'').startsWith('field:')){
var _domSuc=(typeof detectDomain==='function')?detectDomain(S.answers.purpose||''):'';
var _sucJa={saas:'📈 月間1000ユーザー, 💰 月売上10万円(MRR), 🔄 月間チャーン5%以下',ec:'💰 GMV月100万円, 💰 CV率3%+, 🏪 カート放棄30%以下',marketplace:'💰 GMV月100万円, 💰 テイクレート10%, 🏪 取引完了率95%+',education:'📚 コース完了率80%+, 📚 クイズ合格率70%+, 🔄 7日連続利用率50%+',community:'👥 日次投稿50件+, 👥 メンバー月10%増, 🔄 DAU/MAU比率30%+',fintech:'💰 月間取引高1000万円, 🏢 不正検知率99%+, ⚡ 決済成功率99.5%+',analytics:'🏢 レポート作成1分以内, 📈 月間1000ユーザー, 😊 CSAT 4.5/5',booking:'🏪 予約転換率60%+, 🏪 リソース稼働率80%+, 😊 CSAT 4.5/5',hr:'🏢 採用日数30日以内, 🏢 オファー承諾率80%+, 😊 従業員満足度4/5',automation:'🤖 手動作業70%削減, 🤖 処理時間50%短縮, ⚡ エラー率0.1%以下',ai:'🤖 AI正答率90%+, 🤖 有人対応20%以下, 😊 CSAT 4.5/5',collab:'👥 同時編集5人+, 🔄 機能利用率80%+, 😊 NPS 50以上',
content:'📝 月間1万PV, ⏱ 平均滞在3分+, 📧 読者登録率10%+',health:'😊 日次利用者500人+, 🏥 機能活用率80%+, ⚡ 応答1秒以内',iot:'📡 デバイス稼働率99%+, ⚡ センサー応答1秒以内, 🚨 異常検知率95%+',realestate:'🏠 物件成約率15%+, 📊 内覧率30%+, 😊 CSAT 4.5/5',legal:'⚖️ 文書処理24時間以内, 🔒 機密漏洩ゼロ, 😊 顧客満足度4/5+',portfolio:'👁 月間閲覧5000回+, 📧 コンタクト月10件+, ⭐ 採用内定率向上',tool:'⚡ 処理速度業界比30%向上, 🔄 週次アクティブ率60%+, 😊 CSAT 4.5/5',event:'🎫 チケット販売1000枚/月, 🏪 キャンセル率5%以下, 😊 参加満足度4.5/5',gamify:'🎮 DAU/MAU 40%+, 🔄 7日継続率60%+, 🏆 達成バッジ取得率70%+',devtool:'⭐ GitHub Stars 1000+, 🔄 週次アクティブ開発者500+, 📦 月間インストール10K+',creator:'🎨 投稿数100件/月, 👥 フォロワー10%増/月, 💰 クリエイター収益1万円/月+',newsletter:'📧 開封率35%+, 🔗 クリック率10%+, 📈 購読者月5%増',manufacturing:'🏭 生産効率20%向上, 🚨 不良品率0.1%以下, ⚡ ライン稼働率95%+',logistics:'📦 配送精度99%+, ⚡ 在庫回転率向上30%, 🚚 遅延率2%以下',agriculture:'🌱 収量予測精度85%+, 📱 現場入力完了率90%+, ⚡ 農薬最適化20%削減',energy:'⚡ エネルギー削減15%+, 📊 計測精度99%+, 🚨 異常検知率95%+',media:'📺 月間視聴1万時間+, 🔄 継続率60%+, 📈 広告収益月10万円+',government:'🏛 申請処理3日以内, 😊 市民満足度4/5+, 🔒 データ漏洩ゼロ',travel:'✈️ 予約CV率8%+, 😊 旅行者満足度4.5/5, 🔄 リピート率40%+',insurance:'🔒 審査処理24時間以内, 💰 損害率10%削減, 😊 顧客維持率95%+'};
var _sucEn={saas:'📈 1,000 MAU, 💰 $1K MRR, 🔄 <5% monthly churn',ec:'💰 $10K GMV, 💰 3%+ conversion, 🏪 <30% cart abandon',marketplace:'💰 $10K GMV, 💰 10% take rate, 🏪 95%+ fulfillment',education:'📚 80%+ completion, 📚 70%+ quiz pass, 🔄 50%+ 7-day streak',community:'👥 50+ posts/day, 👥 10%+ member growth/mo, 🔄 30%+ DAU/MAU',fintech:'💰 $100K transactions/mo, 🏢 99%+ fraud detection, ⚡ 99.5%+ payment success',analytics:'🏢 Reports in <1min, 📈 1,000 MAU, 😊 CSAT 4.5/5',booking:'🏪 60%+ booking conv., 🏪 80%+ utilization, 😊 CSAT 4.5/5',hr:'🏢 <30 days time-to-hire, 🏢 80%+ offer acceptance, 😊 4/5 employee satisfaction',automation:'🤖 70% manual reduction, 🤖 50% time saved, ⚡ <0.1% error rate',ai:'🤖 90%+ AI accuracy, 🤖 <20% human handoff, 😊 CSAT 4.5/5',collab:'👥 5+ concurrent editors, 🔄 80%+ feature adoption, 😊 NPS 50+',
content:'📝 10K monthly PVs, ⏱ 3+ min avg session, 📧 10%+ subscriber conversion',health:'😊 500+ daily users, 🏥 80%+ feature adoption, ⚡ <1s response time',iot:'📡 99%+ device uptime, ⚡ <1s sensor response, 🚨 95%+ anomaly detection',realestate:'🏠 15%+ deal close rate, 📊 30%+ viewing rate, 😊 CSAT 4.5/5',legal:'⚖️ 24hr document processing, 🔒 Zero confidential breach, 😊 4/5+ client satisfaction',portfolio:'👁 5K+ monthly views, 📧 10+ contacts/month, ⭐ Higher job offer rate',tool:'⚡ 30% faster than alternatives, 🔄 60%+ weekly active rate, 😊 CSAT 4.5/5',event:'🎫 1,000 tickets/month, 🏪 <5% cancellation, 😊 4.5/5 attendee satisfaction',gamify:'🎮 40%+ DAU/MAU ratio, 🔄 60%+ 7-day retention, 🏆 70%+ badge completion',devtool:'⭐ 1K+ GitHub stars, 🔄 500+ weekly active devs, 📦 10K+ monthly installs',creator:'🎨 100+ posts/month, 👥 10%+ follower growth/mo, 💰 $100+ monthly creator revenue',newsletter:'📧 35%+ open rate, 🔗 10%+ click rate, 📈 5%+ subscriber growth/mo',manufacturing:'🏭 20% efficiency gain, 🚨 <0.1% defect rate, ⚡ 95%+ line uptime',logistics:'📦 99%+ delivery accuracy, ⚡ 30% inventory turnover, 🚚 <2% delay rate',agriculture:'🌱 85%+ yield prediction, 📱 90%+ field entry completion, ⚡ 20% pesticide reduction',energy:'⚡ 15%+ energy reduction, 📊 99%+ measurement accuracy, 🚨 95%+ anomaly detection',media:'📺 10K+ watch hours/mo, 🔄 60%+ retention rate, 📈 $1K+ monthly ad revenue',government:'🏛 3-day processing, 😊 4/5+ citizen satisfaction, 🔒 Zero data breach',travel:'✈️ 8%+ booking conversion, 😊 4.5/5 traveler satisfaction, 🔄 40%+ repeat rate',insurance:'🔒 24hr claim processing, 💰 10% loss ratio reduction, 😊 95%+ retention'};
if(_domSuc&&(_en?_sucEn[_domSuc]:_sucJa[_domSuc])){S.answers.success=_en?_sucEn[_domSuc]:_sucJa[_domSuc];}
}
// N-7: orm from backend type
if(!S.answers.orm&&be&&!/Firebase|Supabase|Convex|なし|None|static/i.test(be)){
if(/Python/i.test(be))S.answers.orm='SQLAlchemy (Python)';
else if(/NestJS/i.test(be))S.answers.orm='TypeORM';
else S.answers.orm='Prisma';
}
// N-8: scope_out from current preset config (excluded features → scope_out)
if(!S.answers.scope_out){
var _so=[];var _soE=[];
var _pa=S.answers.payment||'';var _mo=S.answers.mobile||'';var _aa=S.answers.ai_auto||'';
if(!_pa||/none|なし/i.test(_pa)){_so.push('決済機能');_soE.push('Payments');}
if(!_mo||/none|なし/i.test(_mo)){_so.push('ネイティブアプリ');_soE.push('Native app');}
if(!_aa||/none|なし/i.test(_aa)){_so.push('AI機能');_soE.push('AI features');}
if(_so.length>0){S.answers.scope_out=_en?_soE.join(', '):_so.join(', ');}
}
// N-9: future_features from preset config (out-of-scope items become future features)
if(!S.answers.future_features){
var _ff=[];var _ffE=[];
var _pa2=S.answers.payment||'';var _mo2=S.answers.mobile||'';var _aa2=S.answers.ai_auto||'';
_ff.push('分析レポート');_ffE.push('Analytics');
if(!_pa2||/none|なし/i.test(_pa2)){_ff.push('課金・サブスク');_ffE.push('Billing');}
if(!_mo2||/none|なし/i.test(_mo2)){_ff.push('モバイルアプリ');_ffE.push('Mobile app');}
if(!_aa2||/none|なし/i.test(_aa2)){_ff.push('AI機能');_ffE.push('AI features');}
_ff.push('チーム機能');_ffE.push('Team features');
S.answers.future_features=_en?_ffE.join(', '):_ff.join(', ');
}
// G-1: success KPI for field presets (category-based, 20 field categories)
if(!S.answers.success&&(S.preset||'').startsWith('field:')){
var _fpKey2=(S.preset||'').slice(6);
var _fp2=(typeof PR_FIELD!=='undefined'&&_fpKey2)?PR_FIELD[_fpKey2]:null;
var _fpField2=_fp2?_fp2.field:'';
var _sucFldJa={engineering:'🏭 工程時間30%短縮, 🚨 不良品率0.1%以下, ⚡ 計測精度99%+',science:'📊 分析精度90%+, 📝 論文引用数向上, 🔬 実験サイクル50%短縮',agriculture:'🌱 収量20%向上, 📱 現場記録完了率90%+, ⚡ 農薬使用量30%削減',medical:'🏥 診断サポート精度90%+, ⚡ 患者待ち時間30%削減, 🔒 データ漏洩ゼロ',social:'📈 DAU 1000人+, 💬 エンゲージ率20%+, 🔄 月次継続率85%+',humanities:'📚 リサーチ効率50%向上, 📝 執筆量30%増, 👥 コラボ参加率70%+',education_field:'📚 学習完了率80%+, 📊 テスト成績10%向上, 🔄 7日継続率60%+',art:'🎨 作品投稿数月200件+, 👥 クリエイター数500人+, 💰 月間売上10万円+',interdisciplinary:'🤝 プロジェクト完了率90%+, 👥 学際コラボ数月10件+, 📈 成果発表率80%+',environment:'🌿 CO2削減量10%+, 📊 ESGスコア向上, 🚨 異常早期発見率95%+',architecture:'🏠 設計効率40%向上, 📊 承認フロー50%短縮, 😊 顧客満足度4.5/5',sports:'⚡ パフォーマンス指標10%向上, 🏆 目標達成率80%+, 🔄 トレーニング継続率90%+',welfare:'👴 サービス提供効率30%向上, 📱 記録入力時間50%短縮, 😊 利用者満足度4/5+',tourism:'✈️ 予約CV率10%+, 😊 旅行者満足度4.5/5, 🔄 リピート訪問率40%+',biotech:'🔬 実験データ精度95%+, 📊 承認申請期間30%短縮, 🔒 GxP準拠100%',mobility:'🚗 交通最適化15%向上, 📡 データ収集精度99%+, ⚡ 応答時間1秒以内',cybersecurity:'🔒 脅威検知率99%+, ⚡ インシデント応答1時間以内, 📊 誤検知率0.1%以下',fintech_field:'💰 取引精度99.99%+, 🔒 不正検知率99%+, ⚡ 決済応答1秒以内',smart_factory:'🏭 OEE90%+, 🚨 異常予知精度90%+, ⚡ 計画外停止30%削減',cross_theme:'📈 月間1000ユーザー, 🔄 継続率80%+, 😊 CSAT 4.5/5'};
var _sucFldEn={engineering:'🏭 30% cycle time reduction, 🚨 <0.1% defect rate, ⚡ 99%+ measurement accuracy',science:'📊 90%+ analysis accuracy, 📝 Citation impact improvement, 🔬 50% faster experiment cycles',agriculture:'🌱 20% yield increase, 📱 90%+ field record completion, ⚡ 30% pesticide reduction',medical:'🏥 90%+ diagnostic support accuracy, ⚡ 30% wait time reduction, 🔒 Zero data breach',social:'📈 1,000+ DAU, 💬 20%+ engagement rate, 🔄 85%+ monthly retention',humanities:'📚 50% faster research, 📝 30% more output, 👥 70%+ collaboration rate',education_field:'📚 80%+ course completion, 📊 10% grade improvement, 🔄 60%+ 7-day streak',art:'🎨 200+ works/month, 👥 500+ creators, 💰 $1K+ monthly creator revenue',interdisciplinary:'🤝 90%+ project completion, 👥 10+ cross-discipline collabs/month, 📈 80%+ publication rate',environment:'🌿 10%+ CO2 reduction, 📊 ESG score improvement, 🚨 95%+ early anomaly detection',architecture:'🏠 40% design efficiency, 📊 50% faster approvals, 😊 4.5/5 client satisfaction',sports:'⚡ 10% performance improvement, 🏆 80%+ goal achievement, 🔄 90%+ training adherence',welfare:'👴 30% efficiency gain, 📱 50% faster record input, 😊 4/5+ user satisfaction',tourism:'✈️ 10%+ booking conversion, 😊 4.5/5 traveler satisfaction, 🔄 40%+ repeat visitors',biotech:'🔬 95%+ experimental accuracy, 📊 30% faster regulatory approval, 🔒 100% GxP compliance',mobility:'🚗 15% traffic optimization, 📡 99%+ data collection accuracy, ⚡ <1s response time',cybersecurity:'🔒 99%+ threat detection, ⚡ <1hr incident response, 📊 <0.1% false positive rate',fintech_field:'💰 99.99%+ transaction accuracy, 🔒 99%+ fraud detection, ⚡ <1s payment response',smart_factory:'🏭 OEE 90%+, 🚨 90%+ predictive accuracy, ⚡ 30% less unplanned downtime',cross_theme:'📈 1,000+ MAU, 🔄 80%+ retention, 😊 CSAT 4.5/5'};
if(_fpField2&&_sucFldJa[_fpField2]){S.answers.success=_en?(_sucFldEn[_fpField2]||_sucFldJa[_fpField2]):_sucFldJa[_fpField2];}
}
// G-2: skill_level from S.skillLv (options: Beginner / Intermediate / Professional)
if(!S.answers.skill_level){
var _slv2=typeof S.skillLv==='number'?S.skillLv:3;
S.answers.skill_level=_slv2<=1?'Beginner':_slv2>=5?'Professional':'Intermediate';
}
// G-3: learning_goal from deadline (options mapped to question labels)
if(!S.answers.learning_goal&&S.answers.deadline){
var _dl=S.answers.deadline||'';
if(/12ヶ月|12 month/i.test(_dl)){S.answers.learning_goal=_en?'12 months thorough':'12ヶ月じっくり';}
else if(/6ヶ月|6 month/i.test(_dl)){S.answers.learning_goal=_en?'6 months standard':'6ヶ月標準';}
else{S.answers.learning_goal=_en?'3 months intensive':'3ヶ月集中';}
}
// G-4: learning_path from backend/mobile/ai_auto/payment
if(!S.answers.learning_path){
var _mo3=S.answers.mobile||'';var _aa3=S.answers.ai_auto||'';var _pm3=S.answers.payment||'';
if(/オーケストレーター|Orchestrator/i.test(_aa3)||/フル自律|Full Autonomous/i.test(_aa3)){
S.answers.learning_path=_en?'AI Orchestrator':'AI自律オーケストレーター';
} else if(/Billing|サブスク/i.test(_pm3)&&/Stripe/i.test(_pm3)){
S.answers.learning_path=_en?'SaaS Monetization':'SaaS収益化特化';
} else if(/Expo|Flutter/i.test(_mo3)&&!/none|なし/i.test(_mo3)){
S.answers.learning_path=_en?'Fullstack+Mobile':'フルスタック+モバイル';
} else if(/Firebase|Supabase|Convex/i.test(be)){
S.answers.learning_path='React + BaaS';
} else {
S.answers.learning_path='PERN Stack';
}
}
}
/* Auto-fill Phase 2 (tech stack) defaults for Beginner mode */
function autoFillPhase2Defaults(){
const _ja=S.lang==='ja';
// Only fill fields not already set by preset
if(!S.answers.frontend)S.answers.frontend='React + Next.js';
if(!S.answers.css_fw)S.answers.css_fw='Tailwind CSS';
// Lv0: use Firebase (simpler BaaS, no SQL required)
if(S.skillLv===0&&!S.answers.backend){S.answers.backend='Firebase';}
if(!S.answers.backend)S.answers.backend='Supabase';
if(!S.answers.database){
if(/Firebase/i.test(S.answers.backend))S.answers.database='Firebase Firestore';
else if(/Supabase/i.test(S.answers.backend))S.answers.database='Supabase (PostgreSQL)';
else S.answers.database='PostgreSQL';
}
if(!S.answers.auth){
if(/Firebase/i.test(S.answers.backend))S.answers.auth='Firebase Auth';
else if(/Supabase/i.test(S.answers.backend))S.answers.auth='Supabase Auth';
else S.answers.auth=_ja?'メール/パスワード':'Email/Password';
}
if(!S.answers.mobile)S.answers.mobile=_ja?'なし':'None';
if(!S.answers.ai_auto)S.answers.ai_auto=_ja?'Vibe Coding入門':'Vibe Coding Intro';
if(!S.answers.deploy)S.answers.deploy='Vercel';
if(!S.answers.dev_methods)S.answers.dev_methods=_ja?'TDD（テスト駆動）, SDD（仕様駆動）':'TDD (Test-Driven), SDD (Spec-Driven)';
if(!S.answers.payment)S.answers.payment=_ja?'なし':'None';
save();
}
let _prevHistory=[];
let _prevHistIdx=-1;
let _prevNavFlag=false;
let _viewHistory=[];
let _viewHistIdx=-1;
let _viewNavFlag=false;
function _sanitizeHTML(html){
const allowedTags=['h1','h2','h3','h4','h5','h6','p','br','hr','ul','ol','li','a','strong','em','code','pre','blockquote','table','thead','tbody','tr','th','td','img','div','span','b','i','u','s','del','ins','sup','sub','dl','dt','dd'];
const allowedAttrs={a:['href','title','class','target','rel'],img:['src','alt','title','class'],code:['class'],pre:['class'],div:['class'],span:['class'],table:['class'],th:['colspan','rowspan'],td:['colspan','rowspan']};
const temp=document.createElement('div');temp.innerHTML=html;
function clean(el){
const tag=el.tagName.toLowerCase();
if(!allowedTags.includes(tag)){el.remove();return;}
const attrs=allowedAttrs[tag]||[];
Array.from(el.attributes).forEach(a=>{
if(!attrs.includes(a.name)){el.removeAttribute(a.name);}
else if(a.name==='href'||a.name==='src'){
const v=a.value.toLowerCase();
if(v.startsWith('javascript:')||v.startsWith('data:')||v.startsWith('vbscript:')||v.startsWith('about:')){el.removeAttribute(a.name);}
else if(!v.startsWith('http://')&&!v.startsWith('https://')&&!v.startsWith('mailto:')&&!v.startsWith('#')&&!v.startsWith('./')&&!v.startsWith('../')){el.removeAttribute(a.name);}
}
});
Array.from(el.children).forEach(c=>clean(c));
}
Array.from(temp.children).forEach(c=>clean(c));
return temp.innerHTML;
}
function _miniMD(raw){
if(!raw)return '';
const escH=(s)=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const lines=raw.split('\n');
let html='',inCode=false,inList=false,listType='',inTable=false,tableHeaders=[],inQuote=false,para='';
const flushPara=()=>{if(para.trim()){html+='<p>'+_procInline(para.trim())+'</p>';para='';}};
const _procInline=(s)=>{
s=s.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
s=s.replace(/\*(.+?)\*/g,'<em>$1</em>');
s=s.replace(/`(.+?)`/g,'<code>$1</code>');
s=s.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(m,txt,url)=>{
const u=url.trim().toLowerCase();
if(!u.startsWith('http://')&&!u.startsWith('https://')&&!u.startsWith('./')&&!u.startsWith('../')&&!u.startsWith('#'))return m;
return '<a href="'+escH(url)+'">'+txt+'</a>';
});
return s;
};
for(let i=0;i<lines.length;i++){
const line=lines[i],trim=line.trim();
if(inCode){
if(trim==='```'){html+='</code></pre>';inCode=false;}
else html+=escH(line)+'\n';
continue;
}
if(trim.startsWith('```')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
const lang=trim.slice(3).trim();
html+='<pre><code'+(lang?' class="language-'+escH(lang)+'"':'')+'>';
inCode=true;continue;
}
if(trim.startsWith('####')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h4>'+_procInline(trim.slice(4).trim())+'</h4>';continue;
}
if(trim.startsWith('###')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h3>'+_procInline(trim.slice(3).trim())+'</h3>';continue;
}
if(trim.startsWith('##')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h2>'+_procInline(trim.slice(2).trim())+'</h2>';continue;
}
if(trim.startsWith('#')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h1>'+_procInline(trim.slice(1).trim())+'</h1>';continue;
}
if(/^(\-{3,}|\*{3,})$/.test(trim)){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<hr>';continue;
}
if(trim.startsWith('|')&&trim.endsWith('|')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
const cells=trim.slice(1,-1).split('|').map(c=>c.trim());
if(!inTable){html+='<table><thead><tr>';cells.forEach(c=>html+='<th>'+_procInline(c)+'</th>');html+='</tr></thead><tbody>';tableHeaders=cells;inTable=true;}
else if(cells.every(c=>/^:?\-+:?$/.test(c))){}
else{html+='<tr>';cells.forEach(c=>html+='<td>'+_procInline(c)+'</td>');html+='</tr>';}
continue;
}
if(inTable&&!trim.startsWith('|')){html+='</tbody></table>';inTable=false;}
if(trim.startsWith('>')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);
if(!inQuote){html+='<blockquote>';inQuote=true;}
html+='<p>'+_procInline(trim.slice(1).trim())+'</p>';continue;
}
if(inQuote&&!trim.startsWith('>')){html+='</blockquote>';inQuote=false;}
const ulMatch=trim.match(/^[\-\*]\s+(\[[ x]\]\s+)?(.+)$/);
const olMatch=trim.match(/^\d+\.\s+(.+)$/);
if(ulMatch||olMatch){
flushPara();inQuote&&(html+='</blockquote>',inQuote=false);
const isCheck=ulMatch&&ulMatch[1];
const text=ulMatch?(ulMatch[2]||''):olMatch[1];
const newType=olMatch?'ol':'ul';
if(!inList){html+='<'+newType+'>';listType=newType;inList=true;}
else if(listType!==newType){html+='</'+listType+'><'+newType+'>';listType=newType;}
if(isCheck){const checked=ulMatch[1].includes('x');html+='<li><input type="checkbox"'+(checked?' checked':'')+' disabled> '+_procInline(text)+'</li>';}
else html+='<li>'+_procInline(text)+'</li>';
continue;
}
if(inList&&!ulMatch&&!olMatch){html+=listType==='ol'?'</ol>':'</ul>';inList=false;}
if(!trim){flushPara();continue;}
para+=(para?' ':'')+trim;
}
flushPara();
if(inCode)html+='</code></pre>';
if(inList)html+=listType==='ol'?'</ol>':'</ul>';
if(inQuote)html+='</blockquote>';
if(inTable)html+='</tbody></table>';
return html;
}
function _patchLinks(html){
return html.replace(/<a href="(https?:\/\/[^"]+)"/g,'<a href="$1" target="_blank" rel="noopener"');
}
function safeMD(raw){
if(window._noMarked||typeof marked==='undefined')return _miniMD(raw);
const html=marked.parse(raw);
return _patchLinks(_sanitizeHTML(html));
}
function diffBtn(path){
return (S.prevFiles[path]||S.editedFiles[path])?'<button class="btn btn-xs btn-s btn-diff" onclick="showDiff(\''+escAttr(path)+'\')">🔀 Diff</button>':'';
}
// Breadcrumb navigation (HCD: ③認知負荷 ②使いやすさ)
function getBreadcrumb(path){
const _ja=S.lang==='ja';
const pillarNames=t('pillar');
const pillarName=pillarNames[S.pillar]||'Files';
let crumbs=[{label:_ja?'ファイル':'Files',action:'showFileTree()'}];
// Add pillar if not the default
if(S.pillar>0){
crumbs.push({label:pillarName,action:'showFileTree()'});
}
// Parse path
const parts=path.split('/');
let accumulated='';
parts.forEach((part,i)=>{
accumulated+=part;
if(i<parts.length-1){
// Directory
accumulated+='/';
crumbs.push({label:part,action:'showFileTree()'}); // Could filter to show only this dir
}else{
// File (current, not clickable)
crumbs.push({label:part,action:null,current:true});
}
});
// Build HTML
let html='<div class="breadcrumb">';
crumbs.forEach((c,i)=>{
if(i>0)html+='<span class="breadcrumb-sep">›</span>';
if(c.current){
html+=`<span class="breadcrumb-current" aria-current="page">${esc(c.label)}</span>`;
}else{
html+=`<button class="breadcrumb-link" onclick="${c.action}">${esc(c.label)}</button>`;
}
});
html+='</div>';
return html;
}
function prevToolbar(path,showRaw){
const _ja=S.lang==='ja';
const rawBtn=showRaw?`<button class="btn btn-xs btn-s" onclick="toggleMdRaw('${escAttr(path)}')">📝 Raw</button>`:'';
const canBack=_prevHistIdx>0;
const canFwd=_prevHistIdx<_prevHistory.length-1;
const navBtns=`<button class="btn btn-xs btn-s prev-nav-btn${canBack?'':' disabled'}" aria-disabled="${canBack?'false':'true'}" onclick="prevBack()" title="${_ja?'戻る':'Back'}">◀</button><button class="btn btn-xs btn-s prev-nav-btn${canFwd?'':' disabled'}" aria-disabled="${canFwd?'false':'true'}" onclick="prevForward()" title="${_ja?'進む':'Forward'}">▶</button>`;
return `<div class="prev-toolbar">${navBtns}${getBreadcrumb(path)}<div class="prev-toolbar-r">${rawBtn}<button class="btn btn-xs btn-s" onclick="openEditor('${escAttr(path)}')">✏️ ${_ja?'編集':'Edit'}</button>${diffBtn(path)}<button class="btn btn-xs btn-s" onclick="copyFileContent('${escAttr(path)}')">📋 ${_ja?'コピー':'Copy'}</button><button class="btn btn-xs btn-s" onclick="printCurrentFile()">🖨️ ${_ja?'印刷':'Print'}</button></div></div>`;
}
function initPrevTabs(){
const _ja=S.lang==='ja';
const tabs=$('prevTabs');tabs.innerHTML='';
const ja=_ja;
[ja?'ツリー':'Tree',ja?'プレビュー':'Preview'].forEach((n,i)=>{
const b=document.createElement('button');b.className='ptab'+(i===0?' on':'');
b.setAttribute('role','tab');b.setAttribute('aria-selected',String(i===0));
b.textContent=n;b.onclick=()=>{
document.querySelectorAll('.ptab').forEach(t=>{t.classList.remove('on');t.setAttribute('aria-selected','false');});
b.classList.add('on');b.setAttribute('aria-selected','true');
if(i===0)showFileTree();else showFilePreview();
};tabs.appendChild(b);
});
}
function initPillarTabs(){
const tabs=$('pillarTabs');tabs.innerHTML='';
const names=t('pillar');
names.forEach((n,i)=>{
const b=document.createElement('button');b.className='piltab'+(i===0?' on':'');
b.setAttribute('role','tab');b.setAttribute('aria-selected',String(i===0));
b.textContent=n;b.onclick=()=>{
S.pillar=i;
document.querySelectorAll('.piltab').forEach(t=>{t.classList.remove('on');t.setAttribute('aria-selected','false');});
b.classList.add('on');b.setAttribute('aria-selected','true');
if(i===4) showExplorer();
else if(i===5) showDashboard();
else if(i===6) showRoadmapUI();
else if(i===7) showAILauncher();
else if(i===8) showFileTree(); // Design System
else if(i===9) showFileTree(); // Reverse Engineering
else if(i===10) showFileTree(); // Implementation Intelligence
else if(i===11) showFileTree(); // Security Intelligence
else if(i===12) showFileTree(); // Strategic Intelligence
else showFileTree();
};tabs.appendChild(b);
});
}
// Pin/Unpin file (HCD: ②使いやすさ C継続利用)
function togglePin(path){
if(!S.pinnedFiles)S.pinnedFiles=[];
const idx=S.pinnedFiles.indexOf(path);
const _ja=S.lang==='ja';
if(idx>=0){
S.pinnedFiles.splice(idx,1);
toast(_ja?'📌 ピン留め解除しました':'📌 Unpinned',{type:'info'});
}else{
S.pinnedFiles.push(path);
toast(_ja?'📌 ピン留めしました':'📌 Pinned',{type:'success'});
}
save();
showFileTree();
}
function clearFileHistory(){
const _ja=S.lang==='ja';
if((!S.recentFiles||!S.recentFiles.length)&&(!S.pinnedFiles||!S.pinnedFiles.length)){
toast(_ja?'クリアする履歴がありません':'No history to clear');return;
}
const backup={recentFiles:[...(S.recentFiles||[])],pinnedFiles:[...(S.pinnedFiles||[])]};
S.recentFiles=[];
S.pinnedFiles=[];
_prevHistory=[];_prevHistIdx=-1;
_viewHistory=[];_viewHistIdx=-1;
save();showFileTree();
toast(_ja?'履歴をクリアしました':'History cleared',{
type:'success',duration:5000,
actionLabel:_ja?'元に戻す':'Undo',
undoFn:()=>{
S.recentFiles=backup.recentFiles;
S.pinnedFiles=backup.pinnedFiles;
save();showFileTree();
toast(_ja?'✅ 復元しました':'✅ Restored',{type:'success'});
}
});
}
function updatePreview(){
showFileTree();
}
function showFileTree(){
const _ja=S.lang==='ja';
const body=$('prevBody');
const pillar=S.pillar;
// Special UI pillars
if(pillar===4){showExplorer();return;}
if(pillar===5){showDashboard();return;}
if(pillar===6){showRoadmapUI();return;}
if(pillar===7){showAILauncher();return;}
pushView({pillar:pillar,type:'tree',file:null});
// pillar===8: Design System - show file tree (no special UI)
const tree=buildFileTree();
const hasFiles=Object.keys(S.files).length>0;
let h='<div class="ft-search"><input type="text" id="ftSearch" placeholder="'+(_ja?'🔍 ファイル検索…':'🔍 Search files…')+'" aria-label="'+(_ja?'ファイル検索':'Search files')+'" oninput="filterFileTree(this.value)"></div>';
h+='<ul class="file-tree" id="ftList">';
// Pinned files section (HCD: ②使いやすさ C継続利用)
if(S.pinnedFiles&&S.pinnedFiles.length>0){
h+='<li class="ft-section-header">📌 '+(_ja?'ピン留め':'Pinned')+'</li>';
S.pinnedFiles.forEach(path=>{
if(!S.files[path])return; // Skip if file no longer exists
const isActive=S.previewFile===path;
const fileName=path.split('/').pop();
h+=`<li data-path="${esc(path)}" class="tree-item ft-pinned${isActive?' active':''}" role="treeitem" tabindex="0" onclick="previewFile('${escAttr(path)}')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();previewFile('${escAttr(path)}')}">
📄 ${esc(fileName)}<button class="ft-unpin" onclick="event.stopPropagation();togglePin('${escAttr(path)}')" title="${_ja?'ピン留め解除':'Unpin'}">📌</button>
</li>`;
});
}
// Recent files section
if(S.recentFiles&&S.recentFiles.length>0){
h+='<li class="ft-section-header">🕐 '+(_ja?'最近':'Recent')+'</li>';
S.recentFiles.slice(0,5).forEach(path=>{ // Show max 5 recent
if(!S.files[path])return;
const isActive=S.previewFile===path;
const isPinned=S.pinnedFiles&&S.pinnedFiles.includes(path);
if(isPinned)return; // Don't show in recent if already pinned
const fileName=path.split('/').pop();
h+=`<li data-path="${esc(path)}" class="tree-item ft-recent${isActive?' active':''}" role="treeitem" tabindex="0" onclick="previewFile('${escAttr(path)}')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();previewFile('${escAttr(path)}')}">
📄 ${esc(fileName)}
</li>`;
});
}
if((S.pinnedFiles&&S.pinnedFiles.length>0)||(S.recentFiles&&S.recentFiles.length>0)){
h+='<li class="ft-clear-history"><button class="ft-clear-btn" onclick="clearFileHistory()" title="'+(_ja?'履歴をクリア':'Clear history')+'">🗑️ '+(_ja?'履歴クリア':'Clear')+'</button></li>';
h+='<li class="ft-separator">────────────────</li>';
}
tree.forEach(f=>{
if(!f.name||f.name==='───────────'){h+='<li class="ft-separator">────────────────</li>';return;}
if(f.folder) h+=`<li class="folder">📁 ${f.name}/</li>`;
else {
const isGen=hasFiles&&S.files[f.path];
const isActive=S.previewFile===f.path;
const isEdited=S.editedFiles&&S.editedFiles[f.path];
const isPinned=S.pinnedFiles&&S.pinnedFiles.includes(f.path);
const pinBtn=isGen?`<button class="ft-pin${isPinned?' ft-pin-active':''}" onclick="event.stopPropagation();togglePin('${escAttr(f.path)}')" title="${_ja?(isPinned?'ピン留め解除':'ピン留め'):(isPinned?'Unpin':'Pin')}">${isPinned?'📌':'○'}</button>`:'';
h+=`<li data-path="${esc(f.path)}" onclick="previewFile('${escAttr(f.path)}')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();previewFile('${escAttr(f.path)}')}" class="tree-item${isActive?' active':''}${f.name.startsWith('  ')?' tree-indent':''}${isGen?'':' tree-disabled'}" role="treeitem" tabindex="0">
${isGen?'📄':'⬜'} ${esc(f.name.trim())}${isEdited?'<span class="tree-edited" title="Edited">●</span>':''}${isGen?'<span class="tree-gen">✓</span>':''}${pinBtn}
</li>`;
}
});
h+='</ul>';
if(hasFiles){
const count=Object.keys(S.files).length;
const editCount=S.editedFiles?Object.keys(S.editedFiles).length:0;
h+=`<div class="prev-footer">
${count} ${_ja?'ファイル生成済み':'files generated'}${editCount?` · <span class="tree-edited">${editCount} ${_ja?'編集済み':'edited'}</span>`:''}
</div>`;
}

body.innerHTML=h;
if(typeof renderSidebarFiles==='function')renderSidebarFiles();
}
function buildFileTree(){
const _ja=S.lang==='ja';
const files=[];
const pillar=S.pillar;
if(pillar===0){ // SDD
files.push({folder:true,name:'.spec'});
['constitution.md','specification.md','technical-plan.md','tasks.md','verification.md'].forEach(f=>
files.push({name:'  '+f,path:'.spec/'+f}));
} else if(pillar===1){ // DevContainer
files.push({folder:true,name:'.devcontainer'});
['devcontainer.json','Dockerfile','docker-compose.yml','post-create.sh'].forEach(f=>
files.push({name:'  '+f,path:'.devcontainer/'+f}));
files.push({name:'.env.example',path:'.env.example'});
files.push({name:'.gitattributes',path:'.gitattributes'});
files.push({name:'.editorconfig',path:'.editorconfig'});
files.push({name:'docs/64_cross_platform_guide.md',path:'docs/64_cross_platform_guide.md'});
} else if(pillar===2){ // MCP
files.push({folder:true,name:'.mcp'});
['project-context.md','tools-manifest.json','README.md'].forEach(f=>
files.push({name:'  '+f,path:'.mcp/'+f}));
files.push({name:'mcp-config.json',path:'mcp-config.json'});
} else if(pillar===3){ // AI Rules
['.cursor/rules','.github/copilot-instructions.md','.windsurfrules','.clinerules',
'.kiro/spec.md','CLAUDE.md','.claude/rules/spec.md','.claude/rules/frontend.md',
'.claude/rules/backend.md','.claude/rules/test.md','.claude/rules/ops.md',
'.claude/settings.json','AI_BRIEF.md','AGENTS.md','codex-instructions.md',
'skills/project.md','skills/catalog.md','skills/pipelines.md','skills/factory.md',
'skills/README.md','skills/skill_map.md','skills/agents/coordinator.md','skills/agents/reviewer.md',
'.ai/hooks.yml','.gemini/settings.json'
].forEach(f=>files.push({name:f,path:f}));
} else if(pillar===4){ // Explorer
files.push({name:_ja?'(並列実装探索 — UIのみ)':'(Parallel Explorer — UI only)',path:'_explorer'});
} else if(pillar===5){ // Dashboard
files.push({name:_ja?'(Context Dashboard — UIのみ)':'(Context Dashboard — UI only)',path:'_dashboard'});
} else if(pillar===6){ // Roadmap
files.push({folder:true,name:'roadmap'});
['LEARNING_PATH.md','TECH_STACK_GUIDE.md','MOBILE_GUIDE.md','TOOLS_SETUP.md',
'RESOURCES.md','MILESTONES.md','AI_WORKFLOW.md','AI_AUTONOMOUS.md','SAAS_COMMERCE_GUIDE.md'
].forEach(f=>files.push({name:'  '+f,path:'roadmap/'+f}));
} else if(pillar===7){ // AI Launcher
files.push({name:_ja?'(AIランチャー — UIのみ)':'(AI Launcher — UI only)',path:'_launcher'});
} else if(pillar===8){ // Design System
files.push({folder:true,name:'docs'});
['26_design_system','27_sequence_diagrams'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===9){ // Reverse Engineering
files.push({folder:true,name:'docs'});
['29_reverse_engineering','30_goal_decomposition','41_growth_intelligence'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===10){ // Implementation Intelligence
files.push({folder:true,name:'docs'});
['39_implementation_playbook','40_ai_dev_runbook','42_skill_guide','81_ux_proficiency_audit'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
if(S.files['skills/impl-patterns.md']){
files.push({folder:true,name:'skills'});
files.push({name:'  impl-patterns.md',path:'skills/impl-patterns.md'});
}
} else if(pillar===11){ // Security Intelligence
files.push({folder:true,name:'docs'});
['43_security_intelligence','44_threat_model','45_compliance_matrix','46_ai_security','47_security_testing'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===12){ // Strategic Intelligence
files.push({folder:true,name:'docs'});
['48_industry_blueprint','49_tech_radar','50_stakeholder_strategy','51_operational_excellence','52_advanced_scenarios'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===13){ // Ops Intelligence
files.push({folder:true,name:'docs'});
['53_ops_runbook','54_ops_checklist','55_ops_plane_design'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===14){ // Future Strategy Intelligence
files.push({folder:true,name:'docs'});
['56_market_positioning','57_user_experience_strategy','58_ecosystem_strategy','59_regulatory_foresight'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===15){ // Dev IQ (P16)
files.push({folder:true,name:'docs'});
['60_methodology_intelligence','61_ai_brainstorm_playbook','62_industry_deep_dive','63_next_gen_ux_strategy'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===16){ // Prompt Genome (P17)
files.push({folder:true,name:'docs'});
['65_prompt_genome','66_ai_maturity_assessment','67_prompt_composition_guide','68_prompt_kpi_dashboard'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===17){ // Prompt Ops (P18)
files.push({folder:true,name:'docs'});
['69_prompt_ops_pipeline','70_react_workflow','71_llmops_dashboard','72_prompt_registry'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===18){ // Enterprise SaaS (P19)
files.push({folder:true,name:'docs'});
['73_enterprise_architecture','74_workflow_engine','75_admin_dashboard_spec','76_enterprise_components'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===19){ // CI/CD Intelligence (P20)
files.push({folder:true,name:'docs'});
['77_cicd_pipeline_design','78_deployment_strategy','79_quality_gate_matrix','80_release_engineering'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
}
// Common files
files.push({name:'───────────',path:''});
files.push({folder:true,name:'.github/workflows'});
files.push({name:'  ci.yml',path:'.github/workflows/ci.yml'});
files.push({name:'───────────',path:''});
files.push({folder:true,name:'docs'});
['01_project_overview','02_requirements','03_architecture','04_er_diagram',
'05_api_design','06_screen_design','07_test_cases','08_security',
'09_release_checklist','10_gantt','11_wbs','12_driven_dev','13_glossary',
'14_risk','15_meeting','16_review','17_monitoring',
'18_data_migration','19_performance','20_a11y','21_changelog',
'22_prompt_playbook','23_tasks','24_progress','25_error_logs',
'26_design_system','27_sequence_diagrams','28_qa_strategy','31_industry_playbook',
'32_qa_blueprint','33_test_matrix','34_incident_response','35_sitemap',
'36_test_strategy','37_bug_prevention','38_business_model'].forEach(f=>
files.push({name:'  '+f+'.md',path:'docs/'+f+'.md'}));
files.push({name:'───────────',path:''});
['README.md','.gitignore','package.json','LICENSE'].forEach(f=>files.push({name:f,path:f}));
return files;
}
function previewFile(path){
const _ja=S.lang==='ja';
if(!path||path==='')return;
if(!_prevNavFlag){
if(_prevHistIdx<_prevHistory.length-1){
_prevHistory=_prevHistory.slice(0,_prevHistIdx+1);
}
_prevHistory.push(path);
_prevHistIdx=_prevHistory.length-1;
}
_prevNavFlag=false;
pushView({pillar:S.pillar,type:'preview',file:path});
S.previewFile=path;
// Track recent files (HCD: ②使いやすさ C継続利用)
if(!S.recentFiles)S.recentFiles=[];
S.recentFiles=S.recentFiles.filter(p=>p!==path); // Remove duplicates
S.recentFiles.unshift(path); // Add to front
if(S.recentFiles.length>10)S.recentFiles=S.recentFiles.slice(0,10); // Max 10
save();
if(typeof renderSidebarFiles==='function')renderSidebarFiles();
// Update QBar to show file actions (Edit/Copy)
if(typeof updateQbar==='function')updateQbar();
document.querySelectorAll('.file-tree li').forEach(li=>{
li.classList.toggle('active',li.getAttribute('data-path')===path);
});
if(S.files[path]){
const raw=S.files[path];
if(path.endsWith('.md')&&raw.includes('```mermaid')){
let html=safeMD(raw);
let _mmBlocks=[];
html=html.replace(/<pre><code class="language-mermaid">([\s\S]*?)<\/code><\/pre>/g,
(m,code)=>{const id='_mm'+_mmBlocks.length;
_mmBlocks.push(code.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>'));
return '<div class="mermaid" id="'+id+'"></div>';});
$('prevBody').innerHTML=prevToolbar(path,true)+`<div id="mdRendered" class="md-rendered">${html}</div>`;
_mmBlocks.forEach((c,i)=>{const el=document.getElementById('_mm'+i);if(el){el.textContent=c;el.setAttribute('data-mermaid-code',c);}});
_markBrokenLinks();
loadMermaid(async ()=>{
if(_mermaidReady){
try{
const nodes=document.querySelectorAll('#mdRendered .mermaid');
if(nodes.length>0){
if(mermaid.run) await mermaid.run({nodes:nodes});
else if(mermaid.init) mermaid.init(undefined,nodes);
}
}catch(e){console.warn('Mermaid render:',e);}
}
_addCodeCopyBtns();
_addTableCopyBtns();
_addMermaidCopyBtns();
});
} else if(path.endsWith('.md')){
const html=safeMD(raw);
$('prevBody').innerHTML=prevToolbar(path,true)+`<div id="mdRendered" class="md-rendered">${html}</div>`;
_markBrokenLinks();
_addCodeCopyBtns();
_addTableCopyBtns();
} else {
$('prevBody').innerHTML=prevToolbar(path,false)+`<pre>${escHtml(raw)}</pre>`;
}
// Switch preview tab to active
document.querySelectorAll('.ptab').forEach((t,i)=>{t.classList.toggle('on',i===1);});
} else {
$('prevBody').innerHTML=`<p class="empty-preview-sm">${_ja?'ファイルは生成後にプレビュー可能です':'File preview available after generation'}</p>`;
}
}
let _mdRawMode=false;
function toggleMdRaw(path){
_mdRawMode=!_mdRawMode;
if(_mdRawMode){
const el=$('mdRendered');
if(el) el.outerHTML=`<pre id="mdRaw">${escHtml(S.files[path])}</pre>`;
} else { previewFile(path); }
}
function copyFileContent(path){
if(S.files[path]){
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(S.files[path]).then(()=>toast(t('copyDone'))).catch(()=>{_fallbackCopy(S.files[path]);toast(t('copyDone'));});
} else {_fallbackCopy(S.files[path]);toast(t('copyDone'));}
}
}
function _fallbackCopy(text){const ta=document.createElement('textarea');ta.value=text;ta.style.cssText='position:fixed;left:-9999px;';document.body.appendChild(ta);ta.select();try{document.execCommand('copy');}catch(e){}ta.remove();}
function _getTableText(table){
let md='';
const rows=table.querySelectorAll('tr');
rows.forEach((row,i)=>{
const cells=row.querySelectorAll('th, td');
const cellTexts=Array.from(cells).map(c=>c.textContent.trim());
md+='| '+cellTexts.join(' | ')+' |\n';
if(i===0&&cells[0].tagName.toLowerCase()==='th'){
md+='| '+cellTexts.map(()=>'---').join(' | ')+' |\n';
}
});
return md;
}
function _addCodeCopyBtns(){
const _ja=S.lang==='ja';
document.querySelectorAll('#mdRendered pre').forEach(pre=>{
const btn=document.createElement('button');
btn.className='code-copy-btn';
btn.textContent='📋';
btn.title=_ja?'コードをコピー':'Copy code';
btn.onclick=()=>{
const code=pre.querySelector('code');
const text=code?code.textContent:pre.textContent;
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(text)
.then(()=>{btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));})
.catch(()=>{_fallbackCopy(text);btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));});
}else{_fallbackCopy(text);btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));}
};
pre.appendChild(btn);
});
}
function _addTableCopyBtns(){
const _ja=S.lang==='ja';
document.querySelectorAll('#mdRendered table').forEach(table=>{
const wrapper=document.createElement('div');
wrapper.className='table-wrapper';
table.parentNode.insertBefore(wrapper,table);
wrapper.appendChild(table);
const btn=document.createElement('button');
btn.className='table-copy-btn';
btn.textContent='📋';
btn.title=_ja?'表をコピー':'Copy table';
btn.onclick=()=>{
const text=_getTableText(table);
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(text)
.then(()=>{btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));})
.catch(()=>{_fallbackCopy(text);btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));});
}else{_fallbackCopy(text);btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));}
};
wrapper.appendChild(btn);
});
}
function _addMermaidCopyBtns(){
const _ja=S.lang==='ja';
document.querySelectorAll('#mdRendered .mermaid').forEach(mermaid=>{
const code=mermaid.getAttribute('data-mermaid-code');
if(!code)return;
const btn=document.createElement('button');
btn.className='mermaid-copy-btn';
btn.textContent='📋';
btn.title=_ja?'Mermaidコードをコピー':'Copy Mermaid code';
btn.onclick=()=>{
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(code)
.then(()=>{btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));})
.catch(()=>{_fallbackCopy(code);btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));});
}else{_fallbackCopy(code);btn.textContent='✅';setTimeout(()=>btn.textContent='📋',1500);toast(t('copyDone'));}
};
mermaid.appendChild(btn);
});
}
function prevBack(){
if(_prevHistIdx>0){
_prevHistIdx--;
_prevNavFlag=true;
previewFile(_prevHistory[_prevHistIdx]);
}
}
function prevForward(){
if(_prevHistIdx<_prevHistory.length-1){
_prevHistIdx++;
_prevNavFlag=true;
previewFile(_prevHistory[_prevHistIdx]);
}
}
async function printCurrentFile(){
const path=S.previewFile;
if(!path||!S.files[path])return;
const raw=S.files[path];
const G=S.genLang==='ja';
let content=path.endsWith('.md')?safeMD(raw):'<pre>'+escHtml(raw)+'</pre>';
if(path.endsWith('.md'))content=await _renderMermaidSVG(content);
const css='body{font-family:-apple-system,sans-serif;padding:40px;max-width:800px;margin:0 auto;color:#1e222d;}'+'pre{background:#f5f5f5;padding:16px;border-radius:8px;overflow-x:auto;}'+'table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background:#f0f0f0;}'+'div[style*="page-break-inside:avoid"] svg{max-width:100%;height:auto;}'+'@media print{div[style*="page-break-inside:avoid"]{page-break-inside:avoid;}svg{max-width:100%;}}';
const _CSP_META='<meta http-equiv="Content-Security-Policy" content="default-src \'none\'; style-src \'unsafe-inline\'; img-src data: blob:;">';
const html='<!DOCTYPE html><html><head>'+_CSP_META+'<title>'+escHtml(path)+'</title><style>'+css+'</style></head><body>'+'<h1 style="border-bottom:2px solid #3b82f6;padding-bottom:8px;">'+escHtml(path)+'</h1>'+content+'</body></html>';
const win=window.open('','_blank');
if(win){win.document.write(html);win.document.close();}
else{
const blob=new Blob([html],{type:'text/html'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download=fileSlug(S.projectName)+'-'+path.replace(/\//g,'_');a.click();
}
}
function showFilePreview(){
const _ja=S.lang==='ja';
if(S.previewFile&&S.files[S.previewFile]){
previewFile(S.previewFile);
} else {
$('prevBody').innerHTML=`<p class="dash-empty">${_ja?'ファイルツリーからファイルを選択してください':'Select a file from the tree'}</p>`;
}
}
function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function _viewEq(a,b){return a&&b&&a.pillar===b.pillar&&a.type===b.type&&a.file===b.file;}
function pushView(vs){
if(_viewNavFlag)return;
if(_viewHistIdx>=0&&_viewEq(_viewHistory[_viewHistIdx],vs))return;
if(_viewHistIdx<_viewHistory.length-1)_viewHistory=_viewHistory.slice(0,_viewHistIdx+1);
_viewHistory.push(vs);
if(_viewHistory.length>50){_viewHistory=_viewHistory.slice(-50);}
_viewHistIdx=_viewHistory.length-1;
updViewNav();
}
function _restoreView(vs){
_viewNavFlag=true;
S.pillar=vs.pillar;
document.querySelectorAll('.piltab').forEach((t,i)=>{
t.classList.toggle('on',i===vs.pillar);
t.setAttribute('aria-selected',String(i===vs.pillar));
});
switch(vs.type){
case 'tree':showFileTree();break;
case 'preview':if(vs.file){_prevNavFlag=true;previewFile(vs.file);}break;
case 'explorer':showExplorer();break;
case 'dashboard':showDashboard();break;
case 'techdb':renderTechDB();break;
case 'roadmap':showRoadmapUI();break;
case 'launcher':showAILauncher();break;
default:showFileTree();
}
_viewNavFlag=false;
updViewNav();
}
function viewBack(){
if(_viewHistIdx>0){_viewHistIdx--;_restoreView(_viewHistory[_viewHistIdx]);}
}
function viewForward(){
if(_viewHistIdx<_viewHistory.length-1){_viewHistIdx++;_restoreView(_viewHistory[_viewHistIdx]);}
}
function updViewNav(){
const bb=$('viewBackBtn'),fb=$('viewFwdBtn');
if(!bb||!fb)return;
const _ja=S.lang==='ja';
bb.classList.toggle('disabled',_viewHistIdx<=0);
bb.setAttribute('aria-disabled',String(_viewHistIdx<=0));
fb.classList.toggle('disabled',_viewHistIdx>=_viewHistory.length-1);
fb.setAttribute('aria-disabled',String(_viewHistIdx>=_viewHistory.length-1));
bb.title=_ja?'前の画面':'Previous Screen';
fb.title=_ja?'次の画面':'Next Screen';
}
function filterFileTree(q){
const list=$('ftList');if(!list)return;
const items=list.querySelectorAll('li');
const lq=q.toLowerCase();
items.forEach(li=>{
if(li.classList.contains('ft-separator')||li.classList.contains('folder')){
li.style.display=q?'none':'';return;
}
const path=li.dataset.path||li.textContent;
li.style.display=(!q||path.toLowerCase().includes(lq))?'':'none';
});
}
function _resolveFileRef(href,currentFile){
if(!href)return null;
const h=href.trim();
if(h.startsWith('http://')||h.startsWith('https://')||h.startsWith('#'))return null;
let resolved=null;
if(h.startsWith('./')){
const dir=currentFile.includes('/')?currentFile.substring(0,currentFile.lastIndexOf('/')+1):'';
resolved=dir+h.slice(2);
}else if(h.startsWith('../')){
const parts=currentFile.split('/');parts.pop();
const upParts=h.split('/');
for(let i=0;i<upParts.length;i++){
if(upParts[i]==='..'){parts.pop();}
else if(upParts[i]!=='.'&&upParts[i]!==''){resolved=parts.join('/')+(parts.length?'/':'')+upParts.slice(i).join('/');break;}
}
}else{
resolved=h;
}
if(resolved&&S.files[resolved])return resolved;
const basename=resolved?resolved.split('/').pop().replace(/^\d+_/,''):'';
if(basename){
for(const key in S.files){
const keyBase=key.split('/').pop().replace(/^\d+_/,'');
if(keyBase===basename||key.endsWith('/'+basename))return key;
}
}
return null;
}
function _markBrokenLinks(){
const links=document.querySelectorAll('.md-rendered a[href]');
links.forEach(a=>{
const href=a.getAttribute('href');
if(!href||href.startsWith('http://')||href.startsWith('https://')||href.startsWith('#'))return;
const resolved=_resolveFileRef(href,S.previewFile||'');
if(!resolved)a.classList.add('link-broken');
});
}
function _initLinkInterceptor(){
document.addEventListener('click',e=>{
const a=e.target.closest('.md-rendered a[href]');
if(!a)return;
const href=a.getAttribute('href');
if(!href)return;
if(href.startsWith('http://')||href.startsWith('https://')){
e.preventDefault();
window.open(href,'_blank','noopener');
return;
}
if(href.startsWith('#')){
e.preventDefault();
const id=href.slice(1);
const el=document.getElementById(id);
if(el)el.scrollIntoView({behavior:'smooth'});
return;
}
e.preventDefault();
const resolved=_resolveFileRef(href,S.previewFile||'');
if(resolved){
previewFile(resolved);
}else{
const _ja=S.lang==='ja';
toast((_ja?'ファイルが見つかりません: ':'File not found: ')+href);
}
},true);
}
function initSidebar(){
const sb=$('sidebar');
if(!sb)return;
if(!S.sidebarOpen){
sb.classList.add('collapsed');
const ib=$('sbIconbar');if(ib)ib.style.display='flex';
}else{
sb.classList.remove('collapsed');
const ib=$('sbIconbar');if(ib)ib.style.display='none';
}
updateSidebarLabels();
renderPillarGrid();
}
function toggleSidebar(){
S.sidebarOpen=!S.sidebarOpen;
const sb=$('sidebar');
const ib=$('sbIconbar');
if(sb)sb.classList.toggle('collapsed',!S.sidebarOpen);
if(ib)ib.style.display=S.sidebarOpen?'none':'flex';
save();
}
function switchSidebarTab(tab){
const spEl=$('sbProgress');
const sfEl=$('sbFiles');
document.querySelectorAll('.sb-tab').forEach(t=>{t.classList.toggle('on',t.dataset.tab===tab);t.setAttribute('aria-selected',String(t.dataset.tab===tab));});
if(spEl)spEl.style.display=tab==='progress'?'':'none';
if(sfEl){sfEl.style.display=tab==='files'?'':'none';if(tab==='files')renderSidebarFiles();}
}
function renderSidebarFiles(){
const el=$('sbFiles');
if(!el)return;
const _ja=S.lang==='ja';
const files=S.files||{};
const keys=Object.keys(files);
if(!keys.length){
el.innerHTML='<p class="sb-empty">'+(_ja?'ファイル未生成':'No files yet')+'</p>';
return;
}
let h='';
// Beginner: show key files banner first
if(S.skillLv<=1){
const keyFiles=[
{p:'README.md',l:_ja?'README.md — プロジェクト概要':'README.md — Project overview'},
{p:'CLAUDE.md',l:_ja?'CLAUDE.md — AIに全仕様を理解させる':'CLAUDE.md — Give AI full context'},
{p:'.devcontainer/devcontainer.json',l:_ja?'devcontainer.json — 開発環境一発起動':'devcontainer.json — Instant dev env'},
{p:'.spec/constitution.md',l:_ja?'constitution.md — 最初に読む原則':'constitution.md — Principles (read first)'},
];
const validKeyFiles=keyFiles.filter(kf=>files[kf.p]);
if(validKeyFiles.length){
h+='<div class="sb-key-banner">🌱 '+(_ja?'まずこれを読もう':'Start Here')+'</div>';
h+='<ul class="sb-key-files">';
validKeyFiles.forEach(kf=>{
const active=S.previewFile===kf.p;
h+='<li class="ft-file'+(active?' active':'')+'" data-path="'+escAttr(kf.p)+'"><a href="#" onclick="previewFile(\''+escAttr(kf.p)+'\');return false;" title="'+escAttr(kf.p)+'">'+esc(kf.l)+'</a></li>';
});
h+='</ul>';
}
}
h+='<div class="sb-file-search"><input type="text" id="sbSearchInput" placeholder="'+(_ja?'🔍 検索':'🔍 Search')+'" oninput="filterSidebarTree(this.value)" aria-label="'+(_ja?'ファイル検索':'Search files')+'"></div>';
h+='<ul class="sb-file-tree" id="sbFileList">';
// Pinned
const pinned=S.pinnedFiles||[];
const validPinned=pinned.filter(p=>files[p]);
if(validPinned.length){
h+='<li class="ft-section-header">📌 '+(_ja?'ピン留め':'Pinned')+'</li>';
validPinned.forEach(p=>{
const active=S.previewFile===p;
h+='<li class="ft-file'+(active?' active':'')+'" data-path="'+escAttr(p)+'"><a href="#" onclick="previewFile(\''+escAttr(p)+'\');return false;" title="'+escAttr(p)+'">'+esc(p.split('/').pop())+'</a></li>';
});
}
// Recent
const recent=(S.recentFiles||[]).filter(p=>files[p]&&!validPinned.includes(p)).slice(0,5);
if(recent.length){
h+='<li class="ft-section-header">🕒 '+(_ja?'最近':'Recent')+'</li>';
recent.forEach(p=>{
const active=S.previewFile===p;
h+='<li class="ft-file'+(active?' active':'')+'" data-path="'+escAttr(p)+'"><a href="#" onclick="previewFile(\''+escAttr(p)+'\');return false;" title="'+escAttr(p)+'">'+esc(p.split('/').pop())+'</a></li>';
});
}
// All files grouped by folder (F7: Lv0-1 collapses to reduce visual noise)
if(S.skillLv<=1){
h+='<details class="sb-all-collapse"><summary class="ft-section-header">📁 '+(_ja?'全ファイル ('+keys.length+')':'All Files ('+keys.length+')')+'</summary>';
}else{
h+='<li class="ft-section-header">📁 '+(_ja?'全ファイル':'All Files')+'</li>';
}
let lastFolder='';
keys.forEach(p=>{
const parts=p.split('/');
const folder=parts.length>1?parts[0]:'';
if(folder&&folder!==lastFolder){
h+='<li class="ft-folder">📂 '+esc(folder)+'</li>';
lastFolder=folder;
}
const active=S.previewFile===p;
const fname=parts[parts.length-1];
h+='<li class="ft-file'+(active?' active':'')+'" data-path="'+escAttr(p)+'"><a href="#" onclick="previewFile(\''+escAttr(p)+'\');return false;" title="'+escAttr(p)+'">'+esc(fname)+'</a></li>';
});
if(S.skillLv<=1){h+='</details>';}
h+='</ul>';
el.innerHTML=h;
const activeEl=el.querySelector('.ft-file.active');
if(activeEl)activeEl.scrollIntoView({block:'nearest',behavior:'smooth'});
}
function filterSidebarTree(q){
const items=document.querySelectorAll('#sbFileList .ft-file');
const qLow=q.toLowerCase();
items.forEach(li=>{
const path=li.dataset.path||'';
li.style.display=(!q||path.toLowerCase().includes(qLow))?'':'none';
});
}
function updateSidebarLabels(){
const _ja=S.lang==='ja';
const sfEl=$('sbFiles');
if(sfEl&&sfEl.style.display!=='none')renderSidebarFiles();
// Update toggle button tooltip
const tog=$('sbToggle');
if(tog)tog.title=_ja?'サイドバー切替 (Ctrl+B)':'Toggle Sidebar (Ctrl+B)';
renderPillarGrid();
}
var PILLAR_ICONS=['📋','🐳','🔌','🤖','✅','🗺️','🎨','🔍','💡','🔒','📊','⚙️','🔮','🧬','🧩','🔧','🏢','🚀','📄','📦'];
var GEN_TO_PILLAR=[0,1,2,3,0,6,8,9,10,11,12,13,14,15,16,17,18,19,0,0];
var PILLAR_FIRST_FILE=['.spec/constitution.md','.devcontainer/devcontainer.json','.mcp/project-context.md',null,null,null,'roadmap/LEARNING_PATH.md',null,'docs/26_design_system.md','docs/29_reverse_engineering.md','docs/39_implementation_playbook.md','docs/43_security_intelligence.md','docs/48_industry_blueprint.md','docs/53_ops_runbook.md','docs/56_market_positioning.md','docs/60_methodology_intelligence.md','docs/65_prompt_genome.md','docs/69_prompt_ops_pipeline.md','docs/73_enterprise_architecture.md','docs/77_cicd_pipeline_design.md'];
function renderPillarGrid(){
const g=$('sbPillarGrid');if(!g)return;
const _ja=S.lang==='ja';
const hasFiles=Object.keys(S.files||{}).length>0;
const names=_ja?['SDD','DevContainer','MCP','AIルール','品質','ロードマップ','デザイン','リバース','実装','セキュリティ','戦略','運用','未来','開発IQ','ゲノム','Prompt Ops','Enterprise','CI/CD','仕様書','共通']:['SDD','DevContainer','MCP','AI Rules','Quality','Roadmap','Design','Reverse','Impl','Security','Strategy','Ops','Future','Dev IQ','Genome','Prompt Ops','Enterprise','CI/CD','Docs','Common'];
// F8: beginner-friendly tooltips for Lv0-1 visible pillars
var _bgTips=S.skillLv<=1?(_ja?{0:'仕様書を見る',3:'AIルールを見る',7:'AIプロンプトを起動',8:'デザインを見る'}:{0:'View Specs',3:'View AI Rules',7:'Launch AI Prompts',8:'View Design'}):null;
// Lv0-1: show only 4 essential pillars (same set as hero badge filter)
var _bpFilter=S.skillLv<=1?new Set([0,3,7,8]):null;
let h='';
for(let i=0;i<20;i++){
const cls='sb-pillar-icon'+(hasFiles?' completed':' inactive');
const hidden=_bpFilter&&!_bpFilter.has(i)?'style="display:none"':'';
const tip=_bgTips&&_bgTips[i]!==undefined?_bgTips[i]:names[i];
h+='<button class="'+cls+'" title="'+esc(tip)+'" onclick="clickPillarIcon('+i+')" aria-label="'+esc(tip)+'" '+hidden+'>'+PILLAR_ICONS[i]+'</button>';
}
g.innerHTML=h;
}
function clickPillarIcon(genIdx){
if(!Object.keys(S.files||{}).length)return;
const p=GEN_TO_PILLAR[genIdx];
S.pillar=p;
document.querySelectorAll('.piltab').forEach(function(t,i){
t.classList.toggle('on',i===p);
t.setAttribute('aria-selected',String(i===p));
});
if(p===4){if(typeof showExplorer==='function')showExplorer();return;}
if(p===5){if(typeof showDashboard==='function')showDashboard();return;}
if(p===7){if(typeof showAILauncher==='function')showAILauncher();return;}
if(typeof showFileTree==='function')showFileTree();
const f=PILLAR_FIRST_FILE[p];
if(f&&S.files[f]&&typeof previewFile==='function')previewFile(f);
}
function generateAll(){
const _be=S.answers.backend||'';
const _minKeys=(/なし|None|static/i.test(_be))?['frontend','backend']:['frontend','backend','database'];
if(_minKeys.some(k=>!S.answers[k])){
if(S.skillLv<=1){
toast(S.lang==='ja'?'💬 まずチャットの質問に答えてから生成できます':'💬 Answer the chat questions first, then generate');
}else{
toast(S.lang==='ja'?'⚠️ 基本項目（FE/BE/DB）を先に回答してください':'⚠️ Answer basic items (FE/BE/DB) first');
}
return;
}
showGenLangChooser();
}
function showGenLangChooser(){
const _j=S.lang==='ja';
const ov=document.createElement('div');ov.className='gen-lang-overlay';ov.id='genLangOv';
ov.innerHTML=`<div class="gen-lang-modal">
<h3>${_j?'📄 生成ファイルの言語':'📄 File Language'}</h3>
<p>${_j?'生成するドキュメントの言語を選択してください':'Choose the language for generated documents'}</p>
<div class="gen-lang-btns">
<div class="gen-lang-btn" onclick="doGenerate('ja')"><span class="flag">🇯🇵</span>日本語</div>
<div class="gen-lang-btn" onclick="doGenerate('en')"><span class="flag">🇺🇸</span>English</div>
</div>
</div>`;
document.body.appendChild(ov);
}
function doGenerate(lang){
// Minimum answer safeguard
const _be2=S.answers.backend||'';
const _minKeys=(/なし|None|static/i.test(_be2))?['frontend','backend']:['frontend','backend','database'];
const _missing=_minKeys.filter(k=>!S.answers[k]);
if(_missing.length>0){
toast(S.lang==='ja'?'⚠️ 必須項目が未回答です: '+_missing.join(', '):'⚠️ Required fields unanswered: '+_missing.join(', '));
return;
}
snapshotFiles();
S.genLang=lang;save();
const ov=$('genLangOv');if(ov)ov.remove();
const _j=S.lang==='ja';
// Pre-generation compatibility gate
const _cErrs=checkCompat(S.answers).filter(c=>c.level==='error');
if(_cErrs.length>0){
const msg=_cErrs.map(e=>'❌ '+e.msg).join('\n');
if(!confirm((_j?'⚠️ スタック相性エラーが検出されました:\n\n':'⚠️ Stack compatibility errors detected:\n\n')+msg+'\n\n'+(_j?'このまま生成しますか？':'Continue generating?')))return;
}
addMsg('bot',S.lang==='ja'?'🔨 ファイルを生成中...':'🔨 Generating files...');
// Smart loading UI (HCD: ⑤感情体験 ③認知負荷)
const pillarIcons=['📋','🐳','🔌','🤖','✅','🗺️','🎨','🔍','💡','🔒','📊','⚙️','🔮','🧬','🧩','🔧','🏢','🚀','📄','📦'];
const pillarNames=_j?['SDD','DevContainer','MCP','AIルール','品質','ロードマップ','デザイン','リバース','実装','セキュリティ','戦略','運用','未来','開発IQ','ゲノム','Prompt Ops','Enterprise','CI/CD','仕様書','共通']:['SDD','DevContainer','MCP','AI Rules','Quality','Roadmap','Design','Reverse','Impl','Security','Strategy','Ops','Future','Dev IQ','Genome','Prompt Ops','Enterprise','CI/CD','Docs','Common'];
let pillarGrid='<div class="gen-pillar-grid">';
for(let i=0;i<20;i++){
pillarGrid+=`<div class="gen-pillar-card" id="genPillar${i}" data-status="pending">
<div class="gen-pillar-icon">${pillarIcons[i]}</div>
<div class="gen-pillar-name">${pillarNames[i]}</div>
<div class="gen-pillar-check">✓</div>
</div>`;
}
pillarGrid+='</div>';
$('izone').innerHTML=`<div class="gen-spinner">
<div class="gen-prog-wrap">
<div class="gen-prog-bar"><div class="gen-prog-fill" id="genProgFill"></div></div>
<div class="gen-prog-label" id="genProgLabel"></div>
</div>
${pillarGrid}
<div class="spin gen-spinner-icon">⚙️</div>
</div>`;
const a=S.answers;const pn=S.projectName;
S.files={};S._zipDone=false;const _errs=[];
// Reset sidebar pillar grid to inactive at generation start
{const _sbGr=$('sbPillarGrid');if(_sbGr)_sbGr.querySelectorAll('.sb-pillar-icon').forEach(ic=>{ic.className='sb-pillar-icon inactive';});}
const steps=[
{fn:()=>genPillar1_SDD(a,pn),lbl:_j?'柱① SDD仕様書':'Pillar ① SDD',err:'P1-SDD'},
{fn:()=>genPillar2_DevContainer(a,pn),lbl:_j?'柱② DevContainer':'Pillar ② DevContainer',err:'P2-Dev'},
{fn:()=>genPillar3_MCP(a,pn),lbl:_j?'柱③ MCP':'Pillar ③ MCP',err:'P3-MCP'},
{fn:()=>genPillar4_AIRules(a,pn),lbl:_j?'柱④ AIルール':'Pillar ④ AI Rules',err:'P4-AI'},
{fn:()=>genPillar5_QualityIntelligence(a,pn),lbl:_j?'品質インテリジェンス':'Quality Intelligence',err:'P5-QA'},
{fn:()=>genPillar7_Roadmap(a,pn),lbl:_j?'柱⑦ ロードマップ':'Pillar ⑦ Roadmap',err:'P7-Road'},
{fn:()=>genPillar9_DesignSystem(a,pn),lbl:_j?'柱⑨ デザインシステム':'Pillar ⑨ Design System',err:'P9-DS'},
{fn:()=>genPillar10_ReverseEngineering(a,pn),lbl:_j?'柱⑩ リバースEng':'Pillar ⑩ Reverse Eng',err:'P10-Rev'},
{fn:()=>{genPillar11_ImplIntelligence(a,pn);gen81();},lbl:_j?'柱⑪ 実装インテリジェンス':'Pillar ⑪ Impl Intelligence',err:'P11-Impl'},
{fn:()=>genPillar12_SecurityIntelligence(a,pn),lbl:_j?'柱⑫ セキュリティ':'Pillar ⑫ Security',err:'P12-Sec'},
{fn:()=>genPillar13_StrategicIntelligence(a,pn),lbl:_j?'柱⑬ 戦略インテリジェンス':'Pillar ⑬ Strategic Intelligence',err:'P13-Strategy'},
{fn:()=>genPillar14_OpsIntelligence(a,pn),lbl:_j?'柱⑭ 運用インテリジェンス':'Pillar ⑭ Ops Intelligence',err:'P14-Ops'},
{fn:()=>genPillar15(a),lbl:_j?'柱⑮ 未来戦略インテリジェンス':'Pillar ⑮ Future Strategy Intelligence',err:'P15-Future'},
{fn:()=>genPillar16_DevIQ(a,pn),lbl:_j?'柱⑯ 開発IQ':'Pillar ⑯ Dev IQ',err:'P16-DevIQ'},
{fn:()=>genPillar17_PromptGenome(a,pn),lbl:_j?'柱⑰ プロンプトゲノム':'Pillar ⑰ Prompt Genome',err:'P17-PG'},
{fn:()=>genPillar18_PromptOps(a,pn),lbl:_j?'柱⑱ Prompt Ops':'Pillar ⑱ Prompt Ops',err:'P18-POps'},
{fn:()=>genPillar19_EnterpriseSaaS(a,pn),lbl:_j?'柱⑲ エンタープライズ':'Pillar ⑲ Enterprise',err:'P19-Ent'},
{fn:()=>genPillar20_CICDIntelligence(a,pn),lbl:_j?'柱⑳ CI/CDインテリジェンス':'Pillar ⑳ CI/CD Intelligence',err:'P20-CICD'},
{fn:()=>genDocs21(a,pn),lbl:_j?'仕様書28種':'28 Spec Docs',err:'Docs'},
{fn:()=>genCommonFiles(a,pn),lbl:_j?'共通ファイル':'Common Files',err:'Common'},
];
let si=0;
function runStep(){
if(si>=steps.length){finishGen(_errs);return;}
const s=steps[si];const pct=Math.round((si/steps.length)*100);
const fill=$('genProgFill');if(fill)fill.style.width=pct+'%';
const lbl=$('genProgLabel');if(lbl)lbl.textContent=s.lbl;
// Update pillar card status (HCD: ⑤感情体験 ③認知負荷)
const card=$('genPillar'+si);
if(card){
card.setAttribute('data-status','processing');
if(typeof announce==='function')announce(s.lbl);
}
// Update sidebar pillar icon to processing
const _sbGrid=$('sbPillarGrid');
const _sbIc=_sbGrid?_sbGrid.children[si]:null;
if(_sbIc){_sbIc.classList.remove('inactive','completed');_sbIc.classList.add('processing');}
setTimeout(()=>{
try{s.fn();}catch(e){_errs.push(s.err);console.error('❌ '+s.err+' error:',e);}
// Mark as completed
if(card)card.setAttribute('data-status','completed');
// Update sidebar pillar icon to completed
if(_sbIc){_sbIc.classList.remove('processing','inactive');_sbIc.classList.add('completed');}
si++;runStep();
},60);
}
setTimeout(runStep,300);
}
function finishGen(_errs){
if(_errs.length){toast('⚠️ '+_errs.length+(S.lang==='ja'?' 件のエラー: ':' errors: ')+_errs.join(', '));}
// Phase C: Post-generation audit
const _auditFindings=postGenerationAudit(S.files,S.answers);
const fill=$('genProgFill');if(fill)fill.style.width='100%';
const lbl=$('genProgLabel');if(lbl)lbl.textContent=S.lang==='ja'?'✅ 完了':'✅ Done';
const _fc=Object.keys(S.files).length;
const _ja=S.lang==='ja';
addMsg('bot',_ja?`✅ 生成完了！全${_fc}ファイルが準備できました。ファイルツリーからプレビューするか、エクスポートしてください。`:`✅ Generation complete! All ${_fc} files are ready. Preview in the file tree or export.`);
// Show audit results if any
if(_auditFindings.length>0){
const _sb=$('cbody');
const aErrs=_auditFindings.filter(f=>f.level==='error');
const aWarns=_auditFindings.filter(f=>f.level==='warn');
const aInfos=_auditFindings.filter(f=>f.level==='info');
let auditHtml='<div class="audit-results"><h4>'+(S.lang==='ja'?'🔍 生成後セルフ検証':'🔍 Post-Generation Audit')+'</h4>';
if(aErrs.length) auditHtml+='<div class="audit-summary-err">❌ '+aErrs.length+(S.lang==='ja'?' 件の問題':' issues')+'</div>';
if(aWarns.length) auditHtml+='<div class="audit-summary-warn">⚠️ '+aWarns.length+(S.lang==='ja'?' 件の注意':' warnings')+'</div>';
if(aInfos.length) auditHtml+='<div class="audit-summary-info">ℹ️ '+aInfos.length+(S.lang==='ja'?' 件の参考':' notes')+'</div>';
_auditFindings.forEach(f=>{
const cls=f.level==='error'?'compat-error':f.level==='warn'?'compat-warn':'compat-info';
const icon=f.level==='error'?'❌':f.level==='warn'?'⚠️':'ℹ️';
auditHtml+=`<div class="${cls}"><span class="compat-icon">${icon}</span><span class="compat-msg">${esc(f.msg)}</span></div>`;
});
auditHtml+='</div>';
const ad=document.createElement('div');ad.className='msg';ad.innerHTML=auditHtml;_sb.appendChild(ad);
}
if($('statFileNum'))$('statFileNum').textContent=_fc;
// Save recommendation notice
const _sn=document.createElement('div');_sn.className='msg';
const _sb2=$('cbody');
_sn.innerHTML=`<div class="compat-warn"><span class="compat-icon">💾</span><span class="compat-msg">${_ja?'データはブラウザのみに保存されています。<strong>📦 ZIP</strong> と <strong>📤 JSONエクスポート</strong> で必ずローカル保存してください。':'Data is only stored in your browser. Be sure to save locally with <strong>📦 ZIP</strong> and <strong>📤 JSON Export</strong>.'}</span></div>`;
_sb2.appendChild(_sn);_sb2.scrollTop=_sb2.scrollHeight;
showExportGrid();
showFileTree();
if(typeof switchSidebarTab==='function')switchSidebarTab('files');
if(typeof renderPillarGrid==='function')renderPillarGrid();
initPrevTabs();initPillarTabs();updProgress();save();
createQbar();
setTimeout(showPostGenGuide,400);
}
function showExportGrid(){
const _ja=S.lang==='ja';const fc=Object.keys(S.files).length;
const totalChars=Object.values(S.files).reduce((s,v)=>s+v.length,0);
const tokens=Math.round(totalChars/4);
const sizeKB=Math.round(totalChars/1024);
const summary=`<div class="export-summary">
<span>📁 ${fc} ${_ja?'ファイル':'files'}</span>
<span>📏 ~${sizeKB.toLocaleString()}KB</span>
${S.skillLv>=2?`<span>🔤 ~${tokens.toLocaleString()} ${_ja?'トークン':'tokens'}</span>`:''}
</div>`;
// Hero card for ZIP (HCD: ③認知負荷 ①目的達成)
// C2: Lv0-1向け urgency wrapper で視覚的に強調
const heroCard=(S.skillLv<=1?
`<div class="export-hero export-hero-urgent" onclick="exportZIP()">
<div class="export-hero-urgent-label">💾 ${_ja?'データ消失防止のため今すぐ保存！':'Save now to prevent data loss!'}</div>
<div class="export-hero-badge">${_ja?'推奨':'Recommended'}</div>
<div class="export-hero-icon">📦</div>
<div class="export-hero-content">
<h3>${_ja?'ZIP ダウンロード':'ZIP Download'}</h3>
<p>${_ja?'全'+fc+'ファイルを一括保存。最も確実で便利な方法です。':'Save all '+fc+' files at once. Most reliable and convenient.'}</p>
</div>
</div>`
:
`<div class="export-hero" onclick="exportZIP()">
<div class="export-hero-badge">${_ja?'推奨':'Recommended'}</div>
<div class="export-hero-icon">📦</div>
<div class="export-hero-content">
<h3>${_ja?'ZIP ダウンロード':'ZIP Download'}</h3>
<p>${_ja?'全'+fc+'ファイルを一括保存。最も確実で便利な方法です。':'Save all '+fc+' files at once. Most reliable and convenient.'}</p>
</div>
</div>`
);
// Lv4+ Power Ops panel
const _powerOps=(S.skillLv>=4?(function(){
var _ja=S.lang==='ja';
return '<div class="power-ops-panel">'+
'<div class="power-ops-title">'+(_ja?'⚡ パワーOps':'⚡ Power Ops')+'</div>'+
'<div class="power-ops-btns">'+
'<button class="btn btn-xs btn-s" onclick="showDiffView()">'+(_ja?'📊 差分比較':'📊 Diff View')+'</button>'+
'<button class="btn btn-xs btn-s" onclick="shareURL()">'+(_ja?'🔗 URL共有':'🔗 Share URL')+'</button>'+
'<button class="btn btn-xs btn-s" onclick="showPM()">'+(_ja?'📁 プロジェクト管理':'📁 Projects')+'</button>'+
'</div></div>';
})():'');
// AI Quick Start card (GAP1: post-gen AI workflow guide)
const _aiQs=(function(){
if(typeof AI_TOOL_RECIPES==='undefined')return '';
const tools=(S.answers.ai_tools||'').split(',').map(t=>t.trim()).filter(t=>t);
const tool=tools.find(t=>AI_TOOL_RECIPES[t])||'_default';
const recipe=AI_TOOL_RECIPES[tool]||AI_TOOL_RECIPES._default;
const steps=_ja?recipe.ja:recipe.en;
const name=tool==='_default'?(_ja?'汎用ワークフロー':'Generic Workflow'):tool;
const _lv0=S.skillLv<=1;
// Lv0-1: physical drag-and-drop micro-steps (P3)
const _lv0Steps=_ja?[
'📦 ZIPをダウンロード → ダブルクリックで展開 → フォルダをデスクトップに保存',
'🤖 Cursorを起動 →「フォルダーを開く」で展開フォルダを選択 → チャットに「@CLAUDE.md」と入力して送信',
'📝 チャットに「tasks.mdの最優先タスクを実装して」と入力 → Enter で開発スタート'
]:[
'📦 Download ZIP → Double-click to extract → Save folder to Desktop',
'🤖 Open Cursor → "Open Folder" → Select extracted folder → Type "@CLAUDE.md" in chat and send',
'📝 Type "Implement the top-priority task from tasks.md" in chat → Enter to start'
];
return '<div class="ai-quickstart">'+
'<div class="ai-qs-title">🚀 '+esc(_ja?'AIツールで開発を開始: '+name:'Start AI Dev with: '+name)+'</div>'+
(_lv0?
'<div class="ai-qs-micro-label">🔰 '+(_ja?'初心者向け：この3ステップだけ！':'Beginner: Just these 3 steps!')+'</div>'+
'<div class="ai-qs-steps">'+_lv0Steps.map(function(s,i){return '<div class="ai-qs-detail ai-qs-detail-micro"><span class="ai-qs-num">'+(i+1)+'</span> '+esc(s)+'</div>';}).join('')+'</div>'
:
'<div class="ai-qs-flow">'+
'<div class="ai-qs-step"><span class="ai-qs-num">①</span>'+(_ja?'ZIP DL':'ZIP DL')+'</div>'+
'<span class="ai-qs-arrow">→</span>'+
'<div class="ai-qs-step"><span class="ai-qs-num">②</span>'+esc(_ja?'展開 → '+name+' で開く':'Extract → Open in '+name)+'</div>'+
'<span class="ai-qs-arrow">→</span>'+
'<div class="ai-qs-step"><span class="ai-qs-num">③</span>'+esc((steps&&steps[0])||'')+'</div>'+
'</div>'+
'<div class="ai-qs-steps">'+(steps||[]).map(function(s){return '<div class="ai-qs-detail">'+esc(s)+'</div>';}).join('')+'</div>'
)+
'<div class="ai-qs-note">💡 '+(_ja?'生成物は設計ドキュメントです。AIツールに投入すると実コードが生成されます。':'Generated files are design docs. Feed to your AI tool to generate real code.')+'</div>'+
// C3: AI context recovery prompts (collapsible)
(function(){
var _rp=_ja?[
{lbl:'コンテキスト再注入',txt:'まずCLAUDE.mdを読んでプロジェクトを把握してください。次にtasks.mdの最優先タスクを実装してください。'},
{lbl:'エラー修正依頼',txt:'エラーが発生しました。specification.mdの設計に従って修正してください。エラー内容：'}
]:[
{lbl:'Re-inject Context',txt:'First read CLAUDE.md to understand the project. Then implement the top-priority task from tasks.md.'},
{lbl:'Error Fix Request',txt:'An error occurred. Fix it following the design in specification.md. Error details: '}
];
// F6: Lv0-1 shows recovery prompts expanded (always visible); Lv2+ keeps <details> fold
return (S.skillLv<=1?
'<div class="ai-qs-recovery-open"><div class="ai-qs-recovery-title">🆘 '+(_ja?'AIが文脈を忘れたら？':'If AI loses context?')+'</div>':
'<details class="ai-qs-recovery"><summary>🆘 '+(_ja?'AIが文脈を忘れたら？':'If AI loses context?')+'</summary>')+
'<div class="ai-qs-rp-list">'+_rp.map(function(r){
return '<div class="ai-qs-rp"><span class="ai-qs-rp-lbl">'+esc(r.lbl)+'</span>'+
'<button class="btn btn-xs btn-s" onclick="navigator.clipboard.writeText(\''+escAttr(r.txt)+'\').then(function(){toast(\''+(_ja?'📋 コピー済み':'📋 Copied')+'\')})">'+ (_ja?'コピー':'Copy') +'</button></div>';
}).join('')+'</div>'+(S.skillLv<=1?'</div>':'</details>');
})()+
'</div>';
})();
// Export group
const exportGroup=`
<div class="export-group-label">📤 ${_ja?'エクスポート':'Export'}</div>
<div class="export-grid export-grid-compact">
<div class="export-card" role="button" tabindex="0" onclick="exportPDF()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}"><div class="icon">📄</div><h4>${_ja?'PDF 印刷':'PDF Print'}</h4><p>${_ja?'仕様書をPDF化':'Export specs as PDF'}</p></div>
<div class="export-card" role="button" tabindex="0" onclick="copyAllFiles()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}"><div class="icon">📋</div><h4>${_ja?'全ファイルコピー':'Copy All'}</h4><p>${_ja?'テキスト結合コピー':'Copy combined text'}</p></div>
<div class="export-card" role="button" tabindex="0" onclick="copyForAI()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}"><div class="icon">🤖</div><h4>${_ja?'AI向けMD':'AI Markdown'}</h4><p>${_ja?'TOC付きMD形式':'MD with TOC for AI'}</p></div>
</div>
`;
// Management group
const mgmtGroup=`
<div class="export-group-label">⚙️ ${_ja?'管理':'Management'}</div>
<div class="export-grid export-grid-compact">
<div class="export-card" role="button" tabindex="0" onclick="saveTemplate()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}"><div class="icon">💾</div><h4>${_ja?'テンプレート保存':'Save Template'}</h4><p>${_ja?'設定を保存':'Save settings'}</p></div>
<div class="export-card" role="button" tabindex="0" onclick="shareURL()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}"`+(S.skillLv>=4?' style="display:none"':'')+`><div class="icon">🔗</div><h4>${_ja?'URL共有':'Share URL'}</h4><p>${_ja?'設定をURLで共有':'Share via URL'}</p></div>
<div class="export-card export-card-regen" role="button" tabindex="0" onclick="generateAll()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}"><div class="icon">🔄</div><h4>${_ja?'再生成':'Regenerate'}</h4><p>${_ja?'全ファイル再作成':'Rebuild all files'}</p></div>
</div>
`;
// Danger zone
const dangerZone=`
<div class="export-danger-zone">
<div class="export-danger-label">⚠️ ${_ja?'注意が必要な操作':'Caution Required'}</div>
<div class="export-card export-card-danger" role="button" tabindex="0" onclick="clearFiles()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click();}">
<div class="icon">🗑️</div>
<h4>${_ja?'生成ファイルをクリア':'Clear Generated Files'}</h4>
<p>${_ja?fc+'ファイルを削除（5秒間Undo可能）':'Delete '+fc+' files (Undo within 5s)'}</p>
</div>
</div>
`;
// C1: "Start Here" 3-file spotlight for Lv0-1 (addresses #1 complaint: "where do I start?")
const _startHere=(function(){
if(S.skillLv>1)return '';
var _sf=[
{path:'CLAUDE.md',icon:'🧠',ja:'AIにプロジェクト全体を理解させる最重要ファイル',en:'Most important: gives AI full project context'},
{path:'.spec/tasks.md',icon:'📝',ja:'やることリスト。「最優先タスクを実装して」と伝えるベース',en:'Task list. Tell AI "implement the top-priority task"'},
{path:'.cursorrules',icon:'⚡',ja:'Cursorが自動読み込み。AIルールを即時適用',en:'Auto-loaded by Cursor. AI rules applied automatically'}
].filter(function(f){return !!S.files[f.path];});
if(!_sf.length)return '';
return '<div class="start-here-card">'+
'<div class="start-here-title">📂 '+(_ja?'まずこの3ファイルを読もう！':'Start Here: Read These 3 Files First!')+'</div>'+
_sf.map(function(f){
return '<div class="start-here-file" onclick="previewFile(\''+escAttr(f.path)+'\')" role="button" tabindex="0" onkeydown="if(event.key===\'Enter\'||event.key===\' \')this.click()">'+
'<span class="start-here-icon">'+f.icon+'</span>'+
'<div class="start-here-info">'+
'<span class="start-here-name">'+esc(f.path.replace('.spec/',''))+'</span>'+
'<span class="start-here-desc">'+esc(_ja?f.ja:f.en)+'</span>'+
'</div>'+
'<span class="start-here-arr">→</span>'+
'</div>';
}).join('')+
'</div>';
})();
$('izone').innerHTML=summary+heroCard+_powerOps+_aiQs+_startHere+exportGroup+mgmtGroup+dangerZone;
}
function clearFiles(){
const _ja=S.lang==='ja';const fc=Object.keys(S.files).length;
if(!fc){toast(_ja?'クリアするファイルがありません':'No files to clear');return;}
// Backup for undo
const backup={
files:JSON.parse(JSON.stringify(S.files)),
editedFiles:JSON.parse(JSON.stringify(S.editedFiles)),
prevFiles:JSON.parse(JSON.stringify(S.prevFiles)),
genLang:S.genLang,
previewFile:S.previewFile
};
// Clear
S.files={};S._zipDone=false;S.editedFiles={};S.prevFiles={};S.genLang=null;S.previewFile=null;
save();showFileTree();showExportGrid();if(typeof renderPillarGrid==='function')renderPillarGrid();
if($('qbar'))$('qbar').remove();
// Show undo toast
toast(_ja?fc+' ファイルをクリアしました':'Cleared '+fc+' files',{
type:'success',
duration:5000,
actionLabel:_ja?'元に戻す':'Undo',
undoFn:()=>{
S.files=backup.files;
S.editedFiles=backup.editedFiles;
S.prevFiles=backup.prevFiles;
S.genLang=backup.genLang;
S.previewFile=backup.previewFile;
save();showFileTree();showExportGrid();createQbar();if(typeof renderPillarGrid==='function')renderPillarGrid();
toast(_ja?'✅ 復元しました':'✅ Restored',{type:'success'});
}
});
}
/* ── Pillar ① SDD Integration (Phase B: Context-Aware) ── */
function genPillar1_SDD(a,pn){
const G=S.genLang==='ja';
const date=new Date().toISOString().split('T')[0];
const fe=a.frontend||'React + Next.js';
const be=a.backend||'Node.js + Express';
const db=a.database||'PostgreSQL';
const methods=(a.dev_methods||'TDD').split(', ');
const auth=resolveAuth(a);
const arch=resolveArch(a);
const sched=buildSchedule(a);
// B4: scope_out auto-adjustment + G3: domain inference
let scopeOut=a.scope_out || (()=>{
const domain=detectDomain(a.purpose||'');
const defaults={
education: G?'ネイティブアプリ, 動画配信インフラ, 決済以外の金融機能':'Native apps, Video streaming infrastructure, Non-payment financial features',
ec: G?'ネイティブアプリ, 実店舗POS連携, 会計ソフト連携, 物流管理':'Native apps, POS integration, Accounting software, Logistics management',
community: G?'ネイティブアプリ, 動画配信, リアルタイムビデオ通話, メール配信':'Native apps, Video streaming, Real-time video calls, Email delivery',
saas: G?'ネイティブアプリ, オンプレミスデプロイ, ホワイトラベル対応':'Native apps, On-premise deployment, White-label support',
content: G?'ネイティブアプリ, 動画配信, コメント通知メール':'Native apps, Video streaming, Comment notification emails',
analytics: G?'ネイティブアプリ, ETLパイプライン構築, データウェアハウス':'Native apps, ETL pipeline, Data warehouse',
booking: G?'ネイティブアプリ, 決済代行, カレンダー同期(外部API)':'Native apps, Payment processing, Calendar sync (external API)',
marketplace: G?'ネイティブアプリ, 物流管理, エスクロー決済':'Native apps, Logistics management, Escrow payments',
};
return defaults[domain] || (G?'ネイティブアプリ, モバイルアプリ':'Native apps, Mobile apps');
})();
if(a.mobile&&!isNone(a.mobile)&&!String(a.mobile).includes('PWA')){
scopeOut=scopeOut.replace(/ネイティブアプリ/g,G?'ストア配布用ネイティブビルド（Expo Web UIは対象内）':'Native app store builds (Expo Web UI is in scope)');
scopeOut=scopeOut.replace(/native apps?/gi,'Native app store builds (Expo Web UI is in scope)');
}
// Auth detail lines
const authLines=['- '+(G?'認証SoT（Source of Truth）':'Auth SoT')+': '+auth.sot,
'- '+(G?'トークン形式':'Token Type')+': '+auth.tokenType,
'- '+(G?'トークン検証':'Token Verification')+': '+auth.tokenVerify];
if(auth.social.length) authLines.push('- '+(G?'ソーシャルログイン':'Social Login')+': '+auth.social.join(', '));
authLines.push('- '+(G?'HTTPS必須':'HTTPS required'),'- '+(G?'環境変数でシークレット管理':'Secrets via env vars'),'- '+(G?'SQLインジェクション・XSS対策':'SQL injection & XSS prevention'));
// Architecture label
const archLabel=G?{baas:'BaaS統合型',bff:'BFF（API Routes統合）',split:'FE/BE分離型',traditional:'従来型クライアント-サーバー'}[arch.pattern]:{baas:'BaaS Integration',bff:'BFF (API Routes)',split:'FE/BE Split',traditional:'Traditional Client-Server'}[arch.pattern];
// ════ Constitution ════
S.files['.spec/constitution.md']=[
'# '+pn+' — '+(G?'プロジェクト憲法 (Constitution)':'Project Constitution'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. プロジェクトの使命':'## 1. Mission',a.purpose||(G?'（未定義）':'(Undefined)'),'',
G?'## 2. ターゲットユーザー':'## 2. Target Users',a.target||(G?'（未定義）':'(Undefined)'),'',
G?'## 3. 成功指標':'## 3. Success Metrics',
a.success || (()=>{
const domain=detectDomain(a.purpose||'');
const kpis={
education: G?'- コース完了率: 70%以上\n- 月間アクティブ学習者数 (MAL): 前月比+10%\n- 学習者満足度 (NPS): 40以上':'- Course completion rate: 70%+\n- Monthly Active Learners (MAL): +10% MoM\n- Learner NPS: 40+',
ec: G?'- 月間GMV: 前月比+15%\n- 購入CVR: 3%以上\n- カート離脱率: 70%以下':'- Monthly GMV: +15% MoM\n- Purchase CVR: 3%+\n- Cart abandonment: <70%',
community: G?'- 月間アクティブユーザー (MAU): 前月比+10%\n- 投稿/コメント率: DAU対比30%以上\n- 7日リテンション率: 40%以上':'- Monthly Active Users (MAU): +10% MoM\n- Post/comment rate: 30%+ of DAU\n- 7-day retention: 40%+',
saas: G?'- MRR（月次経常収益）: 前月比+10%\n- チャーン率: 月5%以下\n- NPS: 40以上':'- MRR: +10% MoM\n- Monthly churn: <5%\n- NPS: 40+',
content: G?'- 月間PV: 前月比+20%\n- 平均滞在時間: 3分以上\n- リピート訪問率: 30%以上':'- Monthly PV: +20% MoM\n- Avg session: 3min+\n- Return visit rate: 30%+',
analytics: G?'- DAU: 前月比+10%\n- レポート生成数: 週10件以上/ユーザー\n- データ更新頻度: リアルタイム(< 1分)':'- DAU: +10% MoM\n- Reports generated: 10+/week/user\n- Data refresh: real-time (<1min)',
booking: G?'- 予約完了率: 80%以上\n- 月間予約件数: 前月比+15%\n- キャンセル率: 10%以下':'- Booking completion: 80%+\n- Monthly bookings: +15% MoM\n- Cancellation rate: <10%',
marketplace: G?'- 月間取引件数: 前月比+15%\n- 出品者定着率: 60%以上\n- 購入者CVR: 5%以上':'- Monthly transactions: +15% MoM\n- Seller retention: 60%+\n- Buyer CVR: 5%+',
};
return kpis[domain] || (G?'- テストカバレッジ: 80%以上\n- ユーザー満足度: NPS 40以上\n- p95レスポンスタイム: 500ms以下':'- Test coverage: 80%+\n- User satisfaction: NPS 40+\n- p95 response time: <500ms');
})(),'',
G?'## 4. 技術原則':'## 4. Tech Principles',
'- '+(G?'フロントエンド':'Frontend')+': '+fe,
'- '+(G?'バックエンド':'Backend')+': '+be,
'- '+(G?'データベース':'Database')+': '+db,
'- '+(G?'アーキテクチャ':'Architecture')+': '+archLabel,
'- '+(G?'駆動開発手法':'Dev Methods')+': '+methods.join(', '),'',
G?'## 5. 品質基準':'## 5. Quality Standards',
'- '+(G?'テストカバレッジ: 80%以上':'Test Coverage: 80%+'),
'- TypeScript strict mode',
'- ESLint + Prettier '+(G?'適用':'enforced'),
'- CI/CD '+(G?'パイプライン必須':'pipeline required'),'',
G?'## 6. セキュリティ方針':'## 6. Security Policy',...authLines,'',
G?'## 7. スコープ外':'## 7. Out of Scope',scopeOut,'',
G?'## 8. MVP後の拡張計画':'## 8. Post-MVP Feature Roadmap',
a.future_features
? a.future_features.split(', ').map((f,i)=>'- Phase '+(i<2?2:3)+': '+f).join('\n')
: (G?'- Phase 2: 分析レポート\n- Phase 2: チーム機能':'- Phase 2: Analytics\n- Phase 2: Team features'),
''
].join('\n');
// B1: Architecture-aware API design
let apiDesignLines;
if(arch.isBaaS){
const bn=be.includes('Supabase')?'Supabase':be.includes('Firebase')?'Firebase':'Convex';
const rt=be.includes('Supabase')?'Supabase Realtime (WebSocket)':be.includes('Firebase')?'Firestore onSnapshot':'Convex Subscriptions';
const fn=be.includes('Supabase')?'Supabase Edge Functions (Deno)':be.includes('Firebase')?'Cloud Functions':'Convex Functions';
apiDesignLines=['- '+(G?'アクセス方式':'Access')+': '+bn+' Client SDK','- '+(G?'認証':'Auth')+': '+auth.tokenType,'- '+(G?'リアルタイム':'Realtime')+': '+rt,'- '+(G?'サーバーサイドロジック':'Server Logic')+': '+fn];
} else if(arch.pattern==='bff'){
apiDesignLines=['- RESTful API (Next.js API Routes / Route Handlers)','- '+(G?'バージョニング':'Versioning')+': /api/v1/','- '+(G?'認証':'Auth')+': '+auth.tokenType,'- '+(G?'レスポンス':'Response')+': JSON','- '+(G?'注意':'Note')+': '+(G?'Express のロジックは Next.js API Routes に統合。別途 Express サーバーは不要':'Express logic integrated into Next.js API Routes. No separate Express server needed.')];
} else {
apiDesignLines=['- RESTful API (OpenAPI 3.0)','- '+(G?'バージョニング':'Versioning')+': /api/v1/','- '+(G?'認証':'Auth')+': '+auth.tokenType,'- '+(G?'レスポンス':'Response')+': JSON'];
}
const hasMob=a.mobile&&!isNone(a.mobile);
const hasPay=a.payment&&!isNone(a.payment);
// ════ Specification ════
const specLines=[
'# '+pn+' — '+(G?'要件仕様書 (Specification)':'Specification'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. 機能要件':'## 1. Functional Requirements','',
G?'### 1.1 MVP機能':'### 1.1 MVP Features',
...(a.mvp_features||'').split(', ').flatMap(f=>{
const fd=getFeatureDetail(f);
const lines=['#### '+f.trim()];
if(fd){
const criteria=G?fd.criteria_ja:fd.criteria_en;
lines.push((G?'**受入条件:**':'**Acceptance Criteria:**'));
criteria.forEach(c=>{
const expanded=c.replace(/\{auth\}/g,a.auth||'OAuth');
lines.push('- [ ] '+expanded);
});
} else {
lines.push('- [ ] '+(G?'CRUD実装':'CRUD implementation'));
lines.push('- [ ] '+(G?'バリデーション':'Validation'));
lines.push('- [ ] '+(G?'権限チェック':'Authorization check'));
}
lines.push('');
return lines;
}),
G?'### 1.2 主要画面':'### 1.2 Key Screens',
(a.screens||'').split(', ').map(s=>'- '+s).join('\n'),'',
G?'### 1.3 ルーティング':'### 1.3 Routing',
'| URL | '+(G?'画面名':'Screen')+' | '+(G?'認証':'Auth')+' |',
'|-----|------|------|',
...genRoutes(a).map(r=>'| `'+r.path+'` | '+r.name+' | '+(r.auth?(G?'🔒 要':'🔒 Yes'):(G?'🌐 公開':'🌐 Public'))+' |'),
'',
G?'### 1.4 データモデル':'### 1.4 Data Model','```',
(G?'エンティティ':'Entities')+': '+(a.data_entities||(G?'（未定義）':'(Undefined)')),'```','',
G?'## 2. 非機能要件':'## 2. Non-functional Requirements',
'- '+(G?'レスポンスタイム':'Response Time')+': '+(S.skill==='pro'?'< 200ms (p95)':S.skill==='intermediate'?'< 500ms (p95)':'< 1000ms (p95)'),
'- '+(G?'可用性':'Availability')+': '+(S.skill==='pro'?'99.9%':S.skill==='intermediate'?'99%':(G?'ベストエフォート（PaaS依存）':'Best effort (PaaS-dependent)')),
'- '+(G?'同時接続':'Concurrent Users')+': '+(S.skill==='pro'?'1000+':S.skill==='intermediate'?'〜200':'〜50'),
'- '+(G?'モバイル対応':'Mobile')+': '+(hasMob?'✅ '+a.mobile:(G?'レスポンシブWebのみ':'Responsive Web only')),'',
G?'## 3. 技術スタック':'## 3. Tech Stack',
'| '+(G?'レイヤー':'Layer')+' | '+(G?'技術':'Tech')+' |','|---------|------|',
'| '+(G?'フロントエンド':'Frontend')+' | '+fe+' |',
'| '+(G?'バックエンド':'Backend')+' | '+be+' |',
'| '+(G?'データベース':'Database')+' | '+db+' |',
'| '+(G?'認証SoT':'Auth SoT')+' | '+auth.sot+' |',
'| '+(G?'デプロイ':'Deploy')+' | '+(a.deploy||'Vercel')+' |',
];
if(hasMob) specLines.push('| '+(G?'モバイル':'Mobile')+' | '+a.mobile+' |');
if(hasPay) specLines.push('| '+(G?'決済':'Payment')+' | '+a.payment+' |');
specLines.push('',G?'## 4. API設計方針':'## 4. API Design',...apiDesignLines,'');
// Stripe integration design
if(hasPay&&(a.payment||'').includes('Stripe')){
const isEdge=arch.isBaaS&&be.includes('Supabase');
specLines.push(
G?'## 5. 決済設計 (Stripe)':'## 5. Payment Design (Stripe)','',
G?'### 5.1 プラン設計':'### 5.1 Plan Design',
'| '+(G?'プラン':'Plan')+' | '+(G?'価格':'Price')+' | '+(G?'制限':'Limits')+' |',
'|--------|-------|------|',
'| Free | ¥0 | '+(G?'基本機能のみ':'Basic features only')+' |',
'| Pro | ¥980/'+(G?'月':'mo')+' | '+(G?'全機能・優先サポート':'All features, priority support')+' |',
'| Enterprise | ¥9,800/'+(G?'月':'mo')+' | '+(G?'全機能+SLA+専用サポート':'All features + SLA + dedicated support')+' |','',
G?'### 5.2 決済フロー':'### 5.2 Payment Flow',
'```',
G?'1. ユーザーがプラン選択':'1. User selects plan',
G?'2. Stripe Checkout セッション作成':'2. Create Stripe Checkout session',
G?'3. Stripe決済画面にリダイレクト':'3. Redirect to Stripe payment page',
G?'4. 決済完了 → success_url にリダイレクト':'4. Payment complete → redirect to success_url',
G?'5. Webhook (invoice.paid) → DB更新':'5. Webhook (invoice.paid) → update DB',
'```','',
G?'### 5.3 Webhookイベント':'### 5.3 Webhook Events',
'| Event | '+(G?'処理':'Action')+' |',
'|-------|------|',
'| `checkout.session.completed` | '+(G?'サブスクリプション開始':'Start subscription')+' |',
'| `invoice.paid` | '+(G?'支払確認・期間更新':'Confirm payment, renew period')+' |',
'| `customer.subscription.updated` | '+(G?'プラン変更反映':'Apply plan change')+' |',
'| `customer.subscription.deleted` | '+(G?'解約処理':'Cancel subscription')+' |','',
G?'### 5.4 実装':'### 5.4 Implementation',
'- Endpoint: `/api/webhook/stripe`',
'- '+(G?'署名検証':'Signature verification')+': `stripe.webhooks.constructEvent()`',
'- '+(G?'冪等性':'Idempotency')+': event.id '+(G?'でDB重複チェック':'DB dedup check'),
'- '+(G?'顧客紐付':'Customer mapping')+': User.stripe_customer_id','',
);
}
// RBAC design
const hasAdmin=/管理者|admin/i.test(a.target||'');
if(hasAdmin){
const rbacSectionNum=hasPay&&(a.payment||'').includes('Stripe')?6:5;
specLines.push(
(G?'## '+rbacSectionNum+'. ロール・権限設計 (RBAC)':'## '+rbacSectionNum+'. Role & Permission Design (RBAC)'),'',
G?'### ロール定義':'### Role Definitions',
'| '+(G?'ロール':'Role')+' | '+(G?'説明':'Description')+' | '+(G?'権限':'Permissions')+' |',
'|--------|------|------|',
'| user | '+(G?'一般ユーザー':'Regular user')+' | '+(G?'自分のデータのCRUD':'Own data CRUD')+' |',
'| admin | '+(G?'管理者':'Administrator')+' | '+(G?'全データの閲覧・編集・ユーザー管理':'All data view/edit, user management')+' |',
'| super_admin | '+(G?'スーパー管理者':'Super admin')+' | '+(G?'システム設定・ロール変更':'System config, role changes')+' |','',
G?'### 権限チェック':'### Permission Check',
'- profiles.role '+(G?'カラムでロール管理':'column for role management'),
'- '+(G?'ミドルウェア':'Middleware')+': '+(arch.isBaaS?'RLS + auth.jwt() role check':(G?'API Middleware で role チェック':'API middleware role check')),
'- '+(G?'管理者ルート':'Admin routes')+': /admin/ → role=admin '+(G?'以上':'or above'),
'- '+(G?'監査ログ':'Audit log')+': '+(G?'管理者操作は全件記録':'Log all admin actions'),'',
);
}
S.files['.spec/specification.md']=specLines.join('\n');
// Directory structure adapts to architecture
const dirLines=[pn+'/',
'├── src/',
'│   ├── app/          # '+(G?'ページ・ルーティング':'Pages & routing'),
'│   ├── components/   # '+(G?'UIコンポーネント':'UI components'),
'│   ├── lib/          # '+(G?'ユーティリティ':'Utilities'),
'│   ├── hooks/        # '+(G?'カスタムフック':'Custom hooks'),
'│   └── types/        # '+(G?'TypeScript型定義':'TypeScript types')];
if(arch.isBaaS){
if(be.includes('Supabase')) dirLines.push('├── supabase/         # '+(G?'マイグレーション・Edge Functions':'Migrations & Edge Functions'));
else if(be.includes('Firebase')) dirLines.push('├── functions/        # '+(G?'Cloud Functions':'Cloud Functions'));
} else {
if(arch.pattern!=='bff') dirLines.push('├── api/              # '+(G?'バックエンドAPI':'Backend API'));
const ormN=(a.orm&&a.orm.includes('Drizzle'))?'drizzle':'prisma';
dirLines.push('├── '+ormN+'/           # '+(G?'スキーマ・マイグレーション':'Schema & migrations'));
}
dirLines.push('├── tests/            # '+(G?'テスト':'Tests'),
'├── .spec/            # '+(G?'SDD仕様書':'SDD specs'),
'├── .devcontainer/    # '+(G?'開発環境':'Dev environment'),
'├── roadmap/          # '+(G?'学習ロードマップ':'Learning roadmap'),
'└── docs/             # '+(G?'ドキュメント':'Documents'));
const dirNote=arch.pattern==='bff'?'\n> '+(G?'Note: Express のロジックは src/app/api/ 配下の Route Handlers に統合':'Note: Express logic integrated into src/app/api/ Route Handlers')+'\n':'';
const entities=(a.data_entities||'users, items').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const entityLines=entities.map(en=>{
const cols=getEntityColumns(en,G,entities);
const lines=['### '+en,'- id: UUID (PK)'];
cols.forEach(c=>lines.push('- '+c.col+': '+c.type+(c.constraint?' ('+c.constraint+')':'')+(c.desc?' — '+c.desc:'')));
lines.push('- created_at: timestamp','- updated_at: timestamp');
return lines.join('\n');
}).join('\n\n');
// B5: ER inference
const er=inferER(a);
const erRelSection=er.relationships.length?'\n'+(G?'### リレーション':'### Relationships')+'\n```\n'+er.relationships.join('\n')+'\n```':'';
const erWarnSection=er.warnings.length?'\n'+(G?'### ⚠️ ドメイン適合性の注記':'### ⚠️ Domain Fit Notes')+'\n'+er.warnings.join('\n'):'';
const supaNote=(arch.isBaaS&&be.includes('Supabase'))?'> '+(G?'Supabase Dashboard または supabase/migrations/ でスキーマ管理':'Manage schema via Supabase Dashboard or supabase/migrations/')+'\n\n':'';
const deployNote=arch.pattern==='split'?' (FE) + Railway/Render ('+be+')':'';
// Per-table RLS policies
let rlsSection='';
if(arch.isBaaS&&be.includes('Supabase')){
const rlsLines=[G?'### RLS（Row Level Security）方針':'### RLS (Row Level Security) Policy',
G?'全テーブルにRLS有効化。ポリシー例:':'Enable RLS on all tables. Policy examples:','','```sql'];
(a.data_entities||'').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean).forEach(e=>{
const en=e.trim();const tbl=pluralize(en);
const cols=getEntityColumns(en,G,entities);
const hasUserId=cols.some(c=>c.col==='user_id');
const hasOwnerId=cols.some(c=>c.col==='owner_id'||c.col==='instructor_id'||c.col==='provider_id'||c.col==='sender_id');
const ownerCol=hasUserId?'user_id':cols.find(c=>c.col==='owner_id'||c.col==='instructor_id'||c.col==='provider_id')?.col;
if(en.toLowerCase()==='user'){
rlsLines.push(`-- ${tbl}: ${G?'本人のみ読取・更新':'Owner read/update only'}`,
`CREATE POLICY "${tbl}_select" ON ${tbl} FOR SELECT USING (auth.uid() = id);`,
`CREATE POLICY "${tbl}_update" ON ${tbl} FOR UPDATE USING (auth.uid() = id);`,'');
} else if(ownerCol){
rlsLines.push(`-- ${tbl}: ${G?'本人のデータのみ操作可':'Owner CRUD only'}`,
`CREATE POLICY "${tbl}_select" ON ${tbl} FOR SELECT USING (auth.uid() = ${ownerCol});`,
`CREATE POLICY "${tbl}_insert" ON ${tbl} FOR INSERT WITH CHECK (auth.uid() = ${ownerCol});`,
`CREATE POLICY "${tbl}_update" ON ${tbl} FOR UPDATE USING (auth.uid() = ${ownerCol});`,
`CREATE POLICY "${tbl}_delete" ON ${tbl} FOR DELETE USING (auth.uid() = ${ownerCol});`,'');
} else {
rlsLines.push(`-- ${tbl}: ${G?'認証ユーザーは読取可':'Authenticated read'}`,
`CREATE POLICY "${tbl}_select" ON ${tbl} FOR SELECT USING (auth.role() = 'authenticated');`,'');
}
});
rlsLines.push('```');
rlsSection='\n'+rlsLines.join('\n');
}
// Stripe integration section (uses hasPay/hasStripe from above)
const hasStripe=hasPay&&(a.payment||'').includes('Stripe');
let stripeSection='';
if(hasStripe){
const fn=arch.isBaaS&&be.includes('Supabase')?'Supabase Edge Function':'API Route';
stripeSection='\n\n'+(G?'## 7. 決済設計 (Stripe)':'## 7. Payment Design (Stripe)')+'\n\n'+
(G?'### サブスクリプションモデル':'### Subscription Model')+'\n'+
'| '+(G?'プラン':'Plan')+' | '+(G?'価格':'Price')+' | '+(G?'機能制限':'Limits')+' |\n'+
'|------|------|------|\n'+
'| Free | ¥0 | '+(G?'基本機能のみ':'Basic features only')+' |\n'+
'| Pro | ¥980/'+(G?'月':'mo')+' | '+(G?'全機能+優先サポート':'All features + priority support')+' |\n'+
'| Enterprise | ¥9,800/'+(G?'月':'mo')+' | '+(G?'全機能+SLA+専用サポート':'All features + SLA + dedicated support')+' |\n\n'+
(G?'### Webhook処理フロー':'### Webhook Flow')+'\n```\n'+
'Stripe → POST /api/webhook/stripe → '+(G?'署名検証':'Verify signature')+'\n'+
'  ├── invoice.paid → subscription.status = active\n'+
'  ├── invoice.payment_failed → '+(G?'リトライ通知メール':'Retry notification email')+'\n'+
'  ├── customer.subscription.deleted → subscription.status = canceled\n'+
'  └── customer.subscription.updated → '+(G?'プラン変更反映':'Update plan info')+'\n```\n\n'+
(G?'### DB設計':'### DB Design')+'\n'+
(G?'subscriptions テーブル:':'subscriptions table:')+'\n'+
'- user_id: UUID (FK → users)\n'+
'- stripe_subscription_id: TEXT (UNIQUE)\n'+
'- stripe_customer_id: TEXT\n'+
'- status: active | canceled | past_due | trialing\n'+
'- plan: free | pro | enterprise\n'+
'- current_period_end: TIMESTAMP\n\n'+
(G?'### 実装場所':'### Implementation')+': '+fn+'\n'+
'- POST /api/checkout → stripe.checkout.sessions.create()\n'+
'- POST /api/webhook/stripe → '+(G?'イベント処理':'Event handling')+'\n'+
'- GET /api/subscription → '+(G?'現在のプラン取得':'Get current plan');
}
const fullEntitySection=supaNote+entityLines+erRelSection+erWarnSection+rlsSection;
// ════ Technical Plan ════
S.files['.spec/technical-plan.md']=[
'# '+pn+' — '+(G?'技術計画書 (Technical Plan)':'Technical Plan'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. アーキテクチャ概要':'## 1. Architecture Overview',
(G?'### パターン':'### Pattern')+': '+archLabel,'','```',arch.diagram,'```',
arch.note?'\n> '+arch.note+'\n':'',
G?'## 2. ディレクトリ構造':'## 2. Directory Structure','```',dirLines.join('\n'),'```',dirNote,'',
G?'## 3. データベース設計':'## 3. Database Design',fullEntitySection,'',
G?'## 4. 認証設計':'## 4. Auth Design',
'- '+(G?'認証SoT':'Auth SoT')+': **'+auth.sot+'**',
'- '+(G?'トークン':'Token')+': '+auth.tokenType,
'- '+(G?'検証方法':'Verification')+': '+auth.tokenVerify,
auth.social.length?'- '+(G?'対応プロバイダ':'Providers')+': '+auth.social.join(', '):'','',
(()=>{
var isMultiTenant=/マルチ|multi|RLS|組織|org.*hier/i.test((a.org_model||'')+(a.mvp_features||''));
if(!isMultiTenant) return '';
return [
G?'## 4.5 マルチテナントアーキテクチャ':'## 4.5 Multi-Tenant Architecture',
G?'### テナント分離戦略: Row-Level Security (RLS)':'### Tenant Isolation: Row-Level Security (RLS)',
'```mermaid\ngraph LR\n  U[User]-->|auth.uid()|R[RLS Policy]\n  R-->|org_id check|T['+pn+' Data]\n  R-->|blocked|X[Other Org Data]\n  style R fill:#4f46e5,color:#fff\n```',
'',
G?'### 権限モデル (4階層)':'### Permission Model (4-tier)',
'| Role | '+( G?'権限':'Permissions')+' |',
'|------|-------------|',
'| owner | '+( G?'全権限 (削除・課金含む)':'Full access (delete, billing)') +' |',
'| admin | '+(G?'メンバー管理・設定変更':'Member mgmt, config changes')+' |',
'| member | '+(G?'コンテンツ作成・編集':'Create/edit content')+' |',
'| viewer | '+(G?'読み込みのみ':'Read only')+' |',
'',
G?'### データパーティション方針':'### Data Partitioning',
'- '+( G?'全テーブルに `org_id` カラム必須':'All tables require `org_id` column'),
'- '+(G?'クロステナントクエリ防止: RLSポリシーで強制':'Cross-tenant prevention: enforced by RLS'),
'- '+(G?'インデックス: `(org_id, id)` 複合インデックス推奨':'Index: composite `(org_id, id)` recommended'),
G?'> 詳細: `docs/73_enterprise_architecture.md`':
'> Details: `docs/73_enterprise_architecture.md`'
].join('\n');
})(),
G?'## 5. 開発環境':'## 5. Dev Environment',
'- Docker DevContainer (.devcontainer/)',
'- '+(arch.isBaaS?be+' CLI (local emulator)':'Node.js LTS + '+db),
'- '+((a.ai_tools||'Cursor').split(', ')[0])+' + '+(G?'AI支援':'AI-assisted'),'',
'## 6. CI/CD','- GitHub Actions','- lint → test → build → deploy',
'- '+(G?'デプロイ先':'Deploy')+': '+(a.deploy||'Vercel')+deployNote,
stripeSection,''
].join('\n');
// B7: Tasks from single schedule source
const sprintTasks=(si)=>{
if(si===0) return ['- [ ] '+(G?'リポジトリ作成・初期設定':'Repo init & config'),
'- [ ] '+(G?'DevContainer設定':'DevContainer setup'),
'- [ ] '+(G?'CI/CD パイプライン構築':'CI/CD pipeline'),
'- [ ] '+(G?'データベーススキーマ定義':'Database schema')+((arch.isBaaS&&be.includes('Supabase'))?' + '+(G?'RLSポリシー設定':'RLS policy setup'):''),
'- [ ] '+(G?'認証基盤実装':'Auth implementation')+' ('+auth.sot+')'].join('\n');
if(si===1) return (a.mvp_features||(G?'CRUD操作':'CRUD Operations')).split(', ').map(f=>'- [ ] '+f).join('\n');
if(si===2) return (a.screens||(G?'ダッシュボード, ログイン':'Dashboard, Login')).split(', ').map(s=>'- [ ] '+s+' '+(G?'画面実装':'screen')).join('\n');
if(si===3) return ['- [ ] '+(G?'ユニットテスト (カバレッジ80%+)':'Unit tests (80%+ coverage)'),
'- [ ] '+(G?'E2Eテスト (主要フロー)':'E2E tests (key flows)'),
'- [ ] '+(G?'パフォーマンス最適化':'Performance optimization'),
'- [ ] '+(G?'本番デプロイ':'Production deploy'),
'- [ ] '+(G?'ドキュメント整備':'Documentation')].join('\n');
if(si===4) return ['- [ ] '+a.mobile+' '+(G?'プロジェクト初期化':'project init'),
'- [ ] '+(G?'画面実装（モバイル版）':'Mobile screens'),
'- [ ] '+(G?'ストアビルド設定':'Store build config'),
'- [ ] '+(G?'テスト':'Testing')].join('\n');
return '';
};
S.files['.spec/tasks.md']=[
'# '+pn+' — '+(G?'タスク一覧 (Tasks)':'Task List'),
'> Generated by DevForge v9 — '+date,
'> '+(G?'計画期間':'Timeline')+': '+sched.totalWeeks+' '+(G?'週間':'weeks')+' ('+sched.startDate+' 〜)','',
...sched.sprints.map((sp,i)=>'## '+sp.name+': '+(G?sp.focus_ja:sp.focus_en)+' ['+sp.weeks+']\n'+sprintTasks(i)),''
].join('\n\n');
// ════ Verification ════
const mobTest=hasMob?'| '+(G?'モバイルE2E':'Mobile E2E')+' | Maestro / Detox | '+(G?'主要フロー':'Key flows')+' |':'';
const rlsTest=(arch.isBaaS&&be.includes('Supabase'))?'- [ ] '+(G?'RLSポリシーテスト (全テーブル)':'RLS policy tests (all tables)'):'';
const features=(a.mvp_features||'').split(', ').filter(Boolean);
S.files['.spec/verification.md']=[
'# '+pn+' — '+(G?'検証計画書 (Verification)':'Verification Plan'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. テスト戦略':'## 1. Test Strategy',
'| '+(G?'テスト種別':'Test Type')+' | '+(G?'ツール':'Tool')+' | '+(G?'カバレッジ目標':'Coverage Goal')+' |',
'|-----------|--------|-------------|',
'| '+(G?'ユニットテスト':'Unit Test')+' | Vitest | 80% |',
'| '+(G?'統合テスト':'Integration')+' | Vitest | '+(G?'主要API全て':'All major APIs')+' |',
'| '+(G?'E2Eテスト':'E2E Test')+' | Playwright | '+(G?'主要フロー':'Key flows')+' |',
mobTest,'',
G?'## 2. 駆動開発手法による検証':'## 2. Dev Method Verification',
methods.map(m=>'### '+m+'\n- '+(G?'実施タイミング: 全Sprint':'Timing: All sprints')+'\n- '+(G?'検証項目: 仕様との整合性':'Verify: Spec alignment')).join('\n\n'),'',
G?'## 3. パフォーマンス基準':'## 3. Performance Benchmarks',
'- Lighthouse Score: 90+','- LCP: < 2.5s','- FID: < 100ms','- CLS: < 0.1','',
G?'## 4. セキュリティチェック':'## 4. Security Checklist',
'- [ ] '+(G?'OWASP Top 10対策確認':'OWASP Top 10 compliance'),
'- [ ] '+(G?'依存パッケージ脆弱性スキャン':'Dependency vulnerability scan'),
'- [ ] '+(G?'認証・認可テスト':'Auth/authorization tests')+' ('+auth.sot+')',
'- [ ] '+(G?'データバリデーション確認':'Data validation check'),
rlsTest,'',
// G4: Feature-specific verification checklist
G?'## 5. 機能別検証チェックリスト':'## 5. Feature Verification Checklist',
...features.flatMap(f=>{
const fd=getFeatureDetail(f);
if(!fd) return ['### '+f,'- [ ] '+(G?'実装完了':'Implementation done'),'- [ ] '+(G?'ユニットテスト通過':'Unit tests passing'),''];
const criteria=(G?fd.criteria_ja:fd.criteria_en).map(c=>c.replace(/\{auth\}/g,a.auth||'OAuth'));
return ['### '+f,...criteria.map(c=>'- [ ] '+c),''];
}),
].join('\n');
}
/* ── Pillar ② DevContainer (Phase B: BaaS-Aware) ── */
function genPillar2_DevContainer(a,pn){
const G=S.genLang==='ja';
const fe=a.frontend||'React';
const be=a.backend||'Node.js + Express';
const db=a.database||'PostgreSQL';
const orm=a.orm||'';
const devEnv=a.dev_env_type||'';
const isLocal=/Local|ローカル/i.test(devEnv)||!devEnv;
const isCloud=/Cloud|クラウド/i.test(devEnv);
const isHybrid=/Hybrid|ハイブリッド/i.test(devEnv);
const isNode=be.includes('Node')||be.includes('Express')||be.includes('Fastify')||be.includes('Hono')||be.includes('NestJS');
const isPython=be.includes('Python')||be.includes('Django')||be.includes('FastAPI');
const isBaaS=/Supabase|Firebase|Convex/.test(be);
const isSupabase=be.includes('Supabase');
const isFirebase=be.includes('Firebase');
const baseImage=isNode||isBaaS?'mcr.microsoft.com/devcontainers/javascript-node:22':isPython?'mcr.microsoft.com/devcontainers/python:3.12':'mcr.microsoft.com/devcontainers/base:ubuntu';
// DB service: only for non-BaaS
const dbService=isBaaS?'':db.includes('Postgre')?'postgres':db.includes('Mongo')?'mongo':db.includes('MySQL')?'mysql':'';
// Extensions
const exts=['dbaeumer.vscode-eslint','esbenp.prettier-vscode','bradlc.vscode-tailwindcss'];
if(isSupabase) exts.push('supabase.supabase-vscode');
else if(isNode&&!isBaaS&&(orm.includes('Prisma')||!orm)) exts.push('prisma.prisma');
else if(isPython) exts.push('ms-python.python');
exts.push('github.copilot','github.copilot-chat');
// Forward ports
const ports=[3000];
if(isSupabase) ports.push(54321,54322,54323); // Supabase API + Auth + Studio
else if(isFirebase) ports.push(4000,9099); // Emulator UI + Auth
else if(dbService==='postgres') ports.push(5432);
else if(dbService==='mongo') ports.push(27017);
else if(isPython) ports.push(8000);
S.files['.devcontainer/devcontainer.json']=JSON.stringify({
name:pn+' Dev Environment',
dockerComposeFile:'docker-compose.yml',
service:'app',
workspaceFolder:'/workspace',
customizations:{vscode:{extensions:exts.filter(Boolean),settings:{'editor.formatOnSave':true,'editor.defaultFormatter':'esbenp.prettier-vscode'}}},
forwardPorts:ports,
postCreateCommand:'bash .devcontainer/post-create.sh',
features:{'ghcr.io/devcontainers/features/docker-in-docker:2':{}}
},null,2);
// Dockerfile
let dockerLines=['FROM '+baseImage];
if(isNode||isBaaS) dockerLines.push('RUN npm install -g pnpm@latest');
else if(isPython) dockerLines.push('RUN pip install --upgrade pip');
if(isSupabase) dockerLines.push('RUN npm install -g supabase@latest');
if(isFirebase) dockerLines.push('RUN npm install -g firebase-tools@latest');
dockerLines.push('WORKDIR /workspace');
if(isNode||isBaaS){dockerLines.push('COPY package*.json ./','RUN npm install');}
else if(isPython){dockerLines.push('COPY requirements.txt ./','RUN pip install -r requirements.txt');}
dockerLines.push('COPY . .');
S.files['.devcontainer/Dockerfile']=dockerLines.join('\n')+'\n';
// Docker Compose
let compose='version: \'3.8\'\nservices:\n  app:\n    build:\n      context: ..\n      dockerfile: .devcontainer/Dockerfile\n    volumes:\n      - ..:/workspace:cached\n    command: sleep infinity\n    ports:\n      - "3000:3000"\n';
if(isSupabase) compose+='      - "54321:54321"\n      - "54322:54322"\n      - "54323:54323"\n';
else if(isFirebase) compose+='      - "4000:4000"\n      - "9099:9099"\n';
// DB service only for non-BaaS
if(dbService==='postgres') compose+='  db:\n    image: postgres:16\n    environment:\n      POSTGRES_USER: dev\n      POSTGRES_PASSWORD: devpass\n      POSTGRES_DB: '+pn.toLowerCase().replace(/[^a-z0-9]/g,'_')+'\n    ports:\n      - "5432:5432"\n    volumes:\n      - pgdata:/var/lib/postgresql/data\nvolumes:\n  pgdata:\n';
else if(dbService==='mongo') compose+='  db:\n    image: mongo:7\n    ports:\n      - "27017:27017"\n    volumes:\n      - mongodata:/data/db\nvolumes:\n  mongodata:\n';
else if(dbService==='mysql') compose+='  db:\n    image: mysql:8\n    environment:\n      MYSQL_ROOT_PASSWORD: devpass\n      MYSQL_DATABASE: '+pn.toLowerCase().replace(/[^a-z0-9]/g,'_')+'\n    ports:\n      - "3306:3306"\n    volumes:\n      - mysqldata:/var/lib/mysql\nvolumes:\n  mysqldata:\n';
S.files['.devcontainer/docker-compose.yml']=compose;
// Post-create script
const postLines=['#!/bin/bash','echo "🚀 Setting up '+pn+'..."'];
if(isNode||isBaaS) postLines.push('npm install');
else if(isPython) postLines.push('pip install -r requirements.txt');
if(isSupabase){
if(isLocal){
postLines.push('','# Supabase local development','npx supabase init --force 2>/dev/null || true','npx supabase start','echo "📦 Supabase Studio: http://localhost:54323"');
} else if(isCloud){
postLines.push('','# Supabase cloud setup',G?'echo "☁️ クラウドモード: .env.localにプロジェクトURLとキーを設定してください"':'echo "☁️ Cloud mode: Set project URL and keys in .env.local"',G?'echo "  1. https://app.supabase.com でプロジェクト作成"':'echo "  1. Create project at https://app.supabase.com"',G?'echo "  2. Settings > API から URL とキーを取得"':'echo "  2. Get URL and keys from Settings > API"',G?'echo "  3. .env.local に貼り付け"':'echo "  3. Paste into .env.local"');
} else if(isHybrid){
postLines.push('','# Supabase hybrid setup (install but no auto-start)','npx supabase init --force 2>/dev/null || true',G?'echo "🔀 ハイブリッドモード: .env.localのDEV_MODEで切替"':'echo "🔀 Hybrid mode: Switch via DEV_MODE in .env.local"',G?'echo "  ローカル起動: npx supabase start"':'echo "  Start local: npx supabase start"',G?'echo "  クラウド接続: DEV_MODE=cloud"':'echo "  Cloud: DEV_MODE=cloud"');
}
} else if(isFirebase){
if(isLocal){
postLines.push('','# Firebase emulators','firebase init emulators --non-interactive 2>/dev/null || true','echo "📦 Start emulators with: firebase emulators:start"');
} else if(isCloud){
postLines.push('','# Firebase cloud setup',G?'echo "☁️ クラウドモード: firebase.jsonと.env.localを設定"':'echo "☁️ Cloud mode: Configure firebase.json and .env.local"',G?'echo "  1. https://console.firebase.google.com でプロジェクト作成"':'echo "  1. Create project at https://console.firebase.google.com"',G?'echo "  2. firebase login && firebase use --add"':'echo "  2. firebase login && firebase use --add"');
} else if(isHybrid){
postLines.push('','# Firebase hybrid setup','firebase init emulators --non-interactive 2>/dev/null || true',G?'echo "🔀 ハイブリッドモード: firebase use で切替"':'echo "🔀 Hybrid mode: Switch via firebase use"',G?'echo "  ローカル: firebase emulators:start"':'echo "  Local: firebase emulators:start"',G?'echo "  クラウド: firebase use production"':'echo "  Cloud: firebase use production"');
}
} else if(isNode&&dbService==='postgres'){
if(orm.includes('Drizzle')){
postLines.push('npx drizzle-kit push','echo "📦 Drizzle Studio: npx drizzle-kit studio"');
} else {
postLines.push('npx prisma generate','npx prisma db push');
}
}
postLines.push('','echo "✅ Setup complete! Run \'npm run dev\' to start."');
S.files['.devcontainer/post-create.sh']=postLines.join('\n')+'\n';
// .env.example — framework-aware prefix
const envPrefix=fe.includes('Next')?'NEXT_PUBLIC_':fe.includes('Vite')||fe.includes('SPA')?'VITE_':'REACT_APP_';
const envLines=['# Environment Variables','# Copy to .env.local and fill in values',''];
if(isSupabase){
if(isLocal){
envLines.push('# Supabase (Local Development)',envPrefix+'SUPABASE_URL=http://localhost:54321',envPrefix+'SUPABASE_ANON_KEY=# Get from: npx supabase status','SUPABASE_SERVICE_ROLE_KEY=# Get from: npx supabase status');
} else if(isCloud){
envLines.push('# Supabase (Cloud)',envPrefix+'SUPABASE_URL=https://YOUR_PROJECT.supabase.co',envPrefix+'SUPABASE_ANON_KEY=your-anon-key','SUPABASE_SERVICE_ROLE_KEY=your-service-role-key','# Get keys from: https://app.supabase.com/project/_/settings/api');
} else if(isHybrid){
envLines.push('# Supabase (Hybrid Mode)','# Set DEV_MODE=local or DEV_MODE=cloud','DEV_MODE=local','','# Local',envPrefix+'SUPABASE_URL_LOCAL=http://localhost:54321',envPrefix+'SUPABASE_ANON_KEY_LOCAL=# Get from: npx supabase status','','# Cloud',envPrefix+'SUPABASE_URL_CLOUD=https://YOUR_PROJECT.supabase.co',envPrefix+'SUPABASE_ANON_KEY_CLOUD=your-anon-key','SUPABASE_SERVICE_ROLE_KEY=your-service-role-key');
}
} else if(isFirebase){
if(isLocal){
envLines.push('# Firebase (Local Emulators)',envPrefix+'FIREBASE_API_KEY=demo-key',envPrefix+'FIREBASE_AUTH_DOMAIN=localhost',envPrefix+'FIREBASE_PROJECT_ID=demo-project','# Emulators will auto-detect local mode');
} else if(isCloud){
envLines.push('# Firebase (Cloud)',envPrefix+'FIREBASE_API_KEY=your-api-key',envPrefix+'FIREBASE_AUTH_DOMAIN=your-app.firebaseapp.com',envPrefix+'FIREBASE_PROJECT_ID=your-project-id','# Get config from: https://console.firebase.google.com/project/_/settings/general');
} else if(isHybrid){
envLines.push('# Firebase (Hybrid Mode)','# Use firebase.json "emulators" section for local','# Use .firebaserc for project switching','',envPrefix+'FIREBASE_API_KEY=your-api-key',envPrefix+'FIREBASE_AUTH_DOMAIN=your-app.firebaseapp.com',envPrefix+'FIREBASE_PROJECT_ID=your-project-id');
}
} else if(dbService==='postgres'){
envLines.push('# Database','DATABASE_URL=postgresql://dev:devpass@localhost:5432/'+pn.toLowerCase().replace(/[^a-z0-9]/g,'_'));
}
envLines.push('','# Auth','AUTH_SECRET=your-secret-here','');
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
if(hasPay&&a.payment.includes('Stripe')){
envLines.push('# Stripe','STRIPE_SECRET_KEY=sk_test_xxx','STRIPE_WEBHOOK_SECRET=whsec_xxx',envPrefix+'STRIPE_PUBLISHABLE_KEY=pk_test_xxx','');
}
envLines.push('# Security','ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com','RATE_LIMIT_MAX=100','RATE_LIMIT_WINDOW_MS=60000','');
S.files['.env.example']=envLines.join('\n');
// .gitattributes — enforce LF line endings
S.files['.gitattributes']=[
'# Auto-detect text and normalize line endings',
'* text=auto','',
'*.js text eol=lf','*.ts text eol=lf','*.jsx text eol=lf','*.tsx text eol=lf',
'*.json text eol=lf','*.md text eol=lf','*.yml text eol=lf','*.yaml text eol=lf',
'*.css text eol=lf','*.html text eol=lf','*.sh text eol=lf','*.env text eol=lf','',
'*.png binary','*.jpg binary','*.jpeg binary','*.gif binary',
'*.ico binary','*.woff binary','*.woff2 binary','*.pdf binary'
].join('\n')+'\n';
// .editorconfig — editor settings
S.files['.editorconfig']=[
'root = true','','[*]','indent_style = space','indent_size = 2',
'end_of_line = lf','charset = utf-8','trim_trailing_whitespace = true',
'insert_final_newline = true','','[*.md]','trim_trailing_whitespace = false',
'','[Makefile]','indent_style = tab'
].join('\n')+'\n';
// docs/64_cross_platform_guide.md
const cpg=[];
cpg.push(G?'# クロスプラットフォーム開発ガイド':'# Cross-Platform Development Guide','');
cpg.push(G?'## 概要':'## Overview','');
cpg.push(G?'このプロジェクトは、Windows/Mac/Linux のどの環境でも同じように動作するよう設計されています。':'This project is designed to work consistently across Windows, Mac, and Linux.','');
cpg.push(G?'## 改行コード統一 (.gitattributes)':'## Line Ending Normalization (.gitattributes)','');
cpg.push(G?'`.gitattributes` ファイルにより、全てのテキストファイルがLF改行コードで統一されます。':'The `.gitattributes` file ensures all text files use LF line endings.','');
cpg.push(G?'- **Windows対策**: CRLFで保存されたファイルも、Git経由で自動的にLFに変換されます':'- **Windows fix**: Files saved with CRLF are automatically converted to LF via Git','- '+(G?'シェルスクリプト実行エラー（`\\r` command not found）を防止':'Prevents shell script errors (`\\r` command not found)'),'');
cpg.push(G?'## エディタ設定 (.editorconfig)':'## Editor Config (.editorconfig)','');
cpg.push(G?'`.editorconfig` ファイルにより、エディタの設定が統一されます：':'The `.editorconfig` file standardizes editor settings:','');
cpg.push(G?'- インデント: スペース2個':'- Indent: 2 spaces',G?'- 改行: LF':'- Line ending: LF',G?'- 文字コード: UTF-8':'- Charset: UTF-8',G?'- 末尾空白: 自動削除':'- Trailing whitespace: auto-remove','');
cpg.push(G?'## DevContainer環境':'## DevContainer Environment','');
cpg.push(G?'DevContainerはDocker上でLinux環境を起動するため、OS依存の問題を完全に解消します。':'DevContainers run Linux environments in Docker, eliminating OS-specific issues entirely.','');
if(isBaaS){
cpg.push('',G?'## 開発環境タイプ':'## Development Environment Type','');
if(isLocal){
cpg.push(G?'**選択されたモード**: ローカル開発':'**Selected mode**: Local Development','');
cpg.push(G?'- エミュレーターが自動起動します（`post-create.sh`）':'- Emulators auto-start via `post-create.sh`',G?'- オフラインでも開発可能':'- Offline development supported',G?'- `.env.local` にローカル接続情報を設定':'- Configure local connection in `.env.local`');
} else if(isCloud){
cpg.push(G?'**選択されたモード**: クラウド接続':'**Selected mode**: Cloud Direct','');
cpg.push(G?'- エミュレーターはインストールされません':'- Emulators are not installed',G?'- リモートBaaSに直接接続':'- Connects directly to remote BaaS',G?'- `.env.local` にクラウドプロジェクトのURLとキーを設定':'- Configure cloud project URL and keys in `.env.local`');
} else if(isHybrid){
cpg.push(G?'**選択されたモード**: ハイブリッド':'**Selected mode**: Hybrid','');
cpg.push(G?'- エミュレーターはインストールされますが、自動起動しません':'- Emulators installed but do not auto-start',G?'- `.env.local` の `DEV_MODE` で切替':'- Switch via `DEV_MODE` in `.env.local`',G?'- ローカル: `DEV_MODE=local` + エミュレーター起動':'- Local: `DEV_MODE=local` + start emulators',G?'- クラウド: `DEV_MODE=cloud` + クラウド接続情報':'- Cloud: `DEV_MODE=cloud` + cloud credentials');
}
}
cpg.push('',G?'## トラブルシューティング':'## Troubleshooting','');
cpg.push(G?'### シェルスクリプトが動かない（`\\r` エラー）':'### Shell script errors (`\\r` not found)','');
cpg.push(G?'**原因**: Windows環境でCRLF改行が混入':'**Cause**: CRLF line endings on Windows','');
cpg.push(G?'**解決策**:':'**Solution**:');
cpg.push('```bash');
cpg.push('git add --renormalize .');
cpg.push('git commit -m "chore: normalize line endings"');
cpg.push('```','');
cpg.push(G?'### EditorConfigが反映されない':'### EditorConfig not working','');
cpg.push(G?'**解決策**: エディタにEditorConfig拡張をインストール':'**Solution**: Install EditorConfig extension in your editor','- VS Code: `EditorConfig.EditorConfig`','- JetBrains: Built-in','- Vim: `editorconfig/editorconfig-vim`','');
cpg.push(G?'### DevContainerが起動しない':'### DevContainer fails to start','');
cpg.push(G?'**確認項目**:':'**Checklist**:',G?'1. Dockerデーモンが起動しているか':'1. Docker daemon running?',G?'2. WSL2が有効か（Windows）':'2. WSL2 enabled? (Windows)',G?'3. `.devcontainer/devcontainer.json` が正しいか':'3. `.devcontainer/devcontainer.json` valid?','');
cpg.push(G?'## 関連ドキュメント':'## Related Documents','');
cpg.push(G?'- `.devcontainer/README.md` — DevContainer詳細設定':'- `.devcontainer/README.md` — DevContainer details',G?'- `docs/34_devops_guide.md` — CI/CD設定':'- `docs/34_devops_guide.md` — CI/CD setup',G?'- `docs/02_architecture.md` — システムアーキテクチャ':'- `docs/02_architecture.md` — System architecture');
S.files['docs/64_cross_platform_guide.md']=cpg.join('\n')+'\n';
}
/* ── Pillar ③ MCP (Phase B: Context-Aware) ── */
function genPillar3_MCP(a,pn){
const G=S.genLang==='ja';
const tools=(a.ai_tools||'Cursor').split(', ');
const auth=resolveAuth(a);
const arch=resolveArch(a);
const archLabel=G?{baas:'BaaS統合型',bff:'BFF(API Routes)',split:'FE/BE分離',traditional:'従来型'}[arch.pattern]:{baas:'BaaS Integration',bff:'BFF (API Routes)',split:'FE/BE Split',traditional:'Traditional'}[arch.pattern];
const er=inferER(a);
const domain=detectDomain(a.purpose)||'general';
const be=a.backend||'Node.js + Express';
const fe=a.frontend||'React + Next.js';
// Enhanced Project Context with auth details, domain context, dev methods
S.files['.mcp/project-context.md']=`# ${pn} — MCP Project Context
## Project Overview
- **Name**: ${pn}
- **Purpose**: ${a.purpose||'N/A'}
- **Domain**: ${domain}
- **Stack**: ${fe} + ${be} + ${a.database||'PostgreSQL'}
- **Architecture**: ${archLabel}
- **Deploy**: ${a.deploy||'Vercel'}${arch.pattern==='split'?' (FE) + Railway/Render (BE)':''}
${!isNone(a.mobile)?'- **Mobile**: '+a.mobile+'\n':''}${!isNone(a.payment)?'- **Payment**: '+a.payment+'\n':''}
## Authentication Details
- **Auth SoT**: ${auth.sot}
- **Token Type**: ${auth.tokenType}
- **Verification**: ${auth.tokenVerify}
- **Social Providers**: ${auth.social.join(', ')||'None'}
## Key Entities
${a.data_entities||'users, items'}
${er.relationships.length?'\n## Relationships\n'+er.relationships.join('\n'):''}
## Dev Methods
${a.dev_methods||'TDD, BDD'}
## AI Tools
${tools.join(', ')}
## Domain Context
${G?'このプロジェクトは':'This project is in the'} **${domain}** ${G?'ドメインです。以下の点に注意してください:':'domain. Focus on:'}
${_domainFocus(domain,G)}
## Generated File Structure
- \`.spec/\` — ${G?'仕様書5種':'5 spec docs'}
- \`.devcontainer/\` — ${G?'開発環境4種':'4 dev env files'}
- \`.mcp/\` — ${G?'MCP設定':'MCP config'}
- \`docs/\` — ${G?'31ドキュメント':'31 docs'}
- AI rules — CLAUDE.md, AI_BRIEF.md, .cursorrules, AGENTS.md, skills/
- CI/CD — .github/workflows/ci.yml
`;
// Backend-specific MCP server selection
const mcpServers={
filesystem:{command:'npx',args:['-y','@modelcontextprotocol/server-filesystem','/workspace']},
context7:{command:'npx',args:['-y','@anthropic/mcp-context7']},
playwright:{command:'npx',args:['-y','@anthropic/mcp-playwright']},
};
// Add backend-specific servers
if(be.includes('Supabase')){
mcpServers.supabase={command:'npx',args:['-y','@modelcontextprotocol/server-supabase']};
}
if(be.includes('Firebase')){
mcpServers.firebase={command:'npx',args:['-y','firebase-mcp-server']};
}
if(be.includes('Express')&&(a.database||'').includes('PostgreSQL')){
mcpServers.postgres={command:'npx',args:['-y','@modelcontextprotocol/server-postgres']};
}
if(be.includes('Express')&&(a.database||'').includes('MongoDB')){
mcpServers.mongodb={command:'npx',args:['-y','mongodb-mcp-server']};
}
if((a.dev_methods||'').includes('Docker')){
mcpServers.docker={command:'docker',args:['run','-i','--rm','mcp/docker']};
}
// Domain-specific tool recommendations
const domainTools=_domainTools(domain,G);
S.files['.mcp/tools-manifest.json']=JSON.stringify({
schema:'1.0',
project:pn,
mcpServers:mcpServers,
recommendations:{
core:G?['context7 — 最新ドキュメント参照','playwright — E2Eテスト自動化','filesystem — ファイル操作']:['context7 — Latest docs reference','playwright — E2E test automation','filesystem — File operations'],
backend:be.includes('Supabase')?[G?'supabase — DB操作・認証・ストレージ':'supabase — DB ops, auth, storage']:be.includes('Firebase')?[G?'firebase — Firestore・Auth・Functions':'firebase — Firestore, Auth, Functions']:be.includes('PostgreSQL')?[G?'postgres — SQL実行・マイグレーション':'postgres — SQL execution, migrations']:[],
domain:domainTools
},
categories:{
dev:['filesystem','context7',be.includes('Supabase')?'supabase':be.includes('Firebase')?'firebase':be.includes('PostgreSQL')?'postgres':null].filter(Boolean),
test:['playwright'],
deploy:[(a.dev_methods||'').includes('Docker')?'docker':null].filter(Boolean)
}
},null,2);
S.files['mcp-config.json']=JSON.stringify({
mcpServers:mcpServers,
environment:{
SUPABASE_URL:be.includes('Supabase')?'${SUPABASE_URL}':'',
SUPABASE_ANON_KEY:be.includes('Supabase')?'${SUPABASE_ANON_KEY}':'',
FIREBASE_PROJECT_ID:be.includes('Firebase')?'${FIREBASE_PROJECT_ID}':'',
DATABASE_URL:(a.database||'').includes('PostgreSQL')?'${DATABASE_URL}':'',
MONGODB_URI:(a.database||'').includes('MongoDB')?'${MONGODB_URI}':''
}
},null,2);
// New: .mcp/README.md with installation & usage guide
S.files['.mcp/README.md']=`# MCP Configuration for ${pn}
## Overview
This directory contains **Model Context Protocol (MCP)** configuration for ${pn}.
MCP enables AI coding assistants (Claude Code, Cursor, Windsurf, etc.) to access project-specific context, databases, and tools.
## Installed MCP Servers
${Object.keys(mcpServers).map(k=>'- **'+k+'**: '+(G?_mcpDesc(k,'ja'):_mcpDesc(k,'en'))).join('\n')}
## Installation
### 1. Prerequisites
- Node.js 18+ (for npx servers)
${(a.dev_methods||'').includes('Docker')?'- Docker (for docker MCP server)\n':''}
### 2. Configure AI Tool
${G?'AI ツールの設定ファイルに `mcp-config.json` を追加してください:':'Add `mcp-config.json` to your AI tool config:'}
**Claude Code:**
\`\`\`bash
cp mcp-config.json ~/.config/claude/mcp-config.json
\`\`\`
**Cursor:**
\`\`\`bash
# Cursor settings → MCP → Import mcp-config.json
\`\`\`
### 3. Set Environment Variables
\`\`\`bash
${be.includes('Supabase')?'export SUPABASE_URL="https://xxx.supabase.co"\nexport SUPABASE_ANON_KEY="eyJ..."\n':''}${be.includes('Firebase')?'export FIREBASE_PROJECT_ID="your-project-id"\n':''}\${(a.database||'').includes('PostgreSQL')?'export DATABASE_URL="postgresql://..."\n':''}${(a.database||'').includes('MongoDB')?'export MONGODB_URI="mongodb://..."\n':''}
\`\`\`
## Usage Examples
${be.includes('Supabase')?`### Supabase MCP
\`\`\`
${G?'「Userテーブルの全レコードを取得して」':'Get all records from User table'}
${G?'「新しいPostを作成して」':'Create a new Post'}
${G?'「認証ユーザーのプロフィールを表示して」':'Show authenticated user profile'}
\`\`\`
`:''}${be.includes('Firebase')?`### Firebase MCP
\`\`\`
${G?'「usersコレクションを取得して」':'Fetch users collection'}
${G?'「Firebase Authで新規ユーザー作成」':'Create new user with Firebase Auth'}
\`\`\`
`:''}
### Context7 MCP
\`\`\`
${G?'「Next.jsの最新ドキュメントを参照して」':'Reference latest Next.js docs'}
${G?'「Reactの公式ガイドを検索して」':'Search React official guide'}
\`\`\`
### Playwright MCP
\`\`\`
${G?'「ログインフローのE2Eテストを書いて」':'Write E2E test for login flow'}
${G?'「商品購入のテストシナリオを実行して」':'Run test scenario for product purchase'}
\`\`\`
## Troubleshooting
### MCP Server Not Found
\`\`\`bash
# Verify npx can access servers
npx -y @modelcontextprotocol/server-filesystem --version
\`\`\`
### Permission Denied
\`\`\`bash
# Check file permissions
chmod +x /workspace
\`\`\`
### Connection Errors
${G?'- 環境変数が正しく設定されているか確認してください\n- ネットワーク接続を確認してください':'- Verify environment variables are set correctly\n- Check network connectivity'}
## Resources
- [MCP Documentation](https://modelcontextprotocol.io/)
- [Available MCP Servers](https://github.com/modelcontextprotocol/servers)
`;
}
// Helper: Domain-specific focus points
function _domainFocus(domain,G){
const focuses={
education:G?'- 学習進捗の正確な管理\n- WCAG準拠のアクセシビリティ\n- データ保護(FERPA/GDPR)':'- Accurate learning progress tracking\n- WCAG accessibility compliance\n- Data protection (FERPA/GDPR)',
ec:G?'- 在庫同期・競合制御\n- 決済フローの完全性\n- スパイクトラフィック対策':'- Inventory sync & concurrency control\n- Payment flow integrity\n- Spike traffic handling',
marketplace:G?'- 二者間決済・エスクロー\n- レビュー・評価システム\n- メッセージング機能':'- Two-sided payments & escrow\n- Review & rating system\n- Messaging feature',
community:G?'- 投稿フィルタリング\n- 通報・モデレーション\n- スパム対策':'- Content filtering\n- Reporting & moderation\n- Spam prevention',
booking:G?'- 同時予約競合\n- キャンセル・変更処理\n- タイムゾーン処理':'- Concurrent booking conflicts\n- Cancellation/modification handling\n- Timezone handling',
saas:G?'- マルチテナント分離(RLS)\n- プラン別機能制限\n- サブスク管理':'- Multi-tenant isolation (RLS)\n- Plan-based feature restrictions\n- Subscription management',
fintech:G?'- トランザクション完全性(ACID)\n- 二重処理防止\n- PCI DSS準拠':'- Transaction integrity (ACID)\n- Double-processing prevention\n- PCI DSS compliance',
iot:G?'- デバイス認証・認可\n- オフライン動作\n- ファームウェア更新':'- Device authentication & authorization\n- Offline operation\n- Firmware updates',
realestate:G?'- 契約・更新管理\n- 修繕リクエスト追跡\n- 収支レポート':'- Contract & renewal management\n- Repair request tracking\n- Financial reports',
legal:G?'- 電子署名連携\n- バージョン管理\n- 承認ワークフロー':'- E-signature integration\n- Version control\n- Approval workflow',
hr:G?'- 応募者トラッキング\n- 面接スケジュール\n- 評価・スコアカード':'- Applicant tracking\n- Interview scheduling\n- Evaluation scorecards',
health:G?'- HIPAA準拠\n- カルテ管理\n- 予約・処方箋':'- HIPAA compliance\n- Medical records management\n- Appointments & prescriptions',
content:G?'- 全文検索\n- バージョン履歴\n- アクセス権限':'- Full-text search\n- Version history\n- Access control',
analytics:G?'- KPI集計\n- グラフ表示\n- リアルタイム更新':'- KPI aggregation\n- Chart display\n- Real-time updates',
portfolio:G?'- SEO最適化\n- レスポンシブデザイン\n- お問い合わせフォーム':'- SEO optimization\n- Responsive design\n- Contact form',
tool:G?'- APIキー管理\n- 使用量モニタリング\n- レート制限':'- API key management\n- Usage monitoring\n- Rate limiting'
};
return focuses[domain]||'';
}
// Helper: Domain-specific MCP tool recommendations
function _domainTools(domain,G){
const tools={
education:G?['context7 — 教育系APIドキュメント参照']:['context7 — Education API docs'],
ec:G?['playwright — 購入フローE2Eテスト']:['playwright — Purchase flow E2E tests'],
saas:G?['postgres/supabase — RLS設定・マルチテナント']:['postgres/supabase — RLS config, multi-tenant'],
fintech:G?['postgres — トランザクションテスト']:['postgres — Transaction testing'],
iot:G?['docker — デバイスシミュレーション']:['docker — Device simulation'],
health:G?['playwright — HIPAA準拠テスト']:['playwright — HIPAA compliance tests'],
ai:G?['context7 — AI APIドキュメント']:['context7 — AI API docs'],
automation:G?['playwright — ワークフロー自動テスト']:['playwright — Workflow automation tests'],
event:G?['postgres — イベント集計']:['postgres — Event aggregation'],
gamify:G?['postgres — ポイント・ランキング計算']:['postgres — Point & ranking calculation'],
collab:G?['docker — リアルタイム同期テスト']:['docker — Real-time sync tests'],
devtool:G?['postgres — Webhook配信ログ']:['postgres — Webhook delivery logs'],
creator:G?['stripe — サブスク決済テスト']:['stripe — Subscription payment tests'],
newsletter:G?['postgres — 配信統計分析']:['postgres — Send analytics']
};
return tools[domain]||[];
}
// Helper: MCP server descriptions
function _mcpDesc(name,lang){
const descs={
filesystem:{ja:'ファイル読み書き・検索',en:'File read/write & search'},
context7:{ja:'最新ドキュメント参照',en:'Latest docs reference'},
playwright:{ja:'E2Eテスト自動化',en:'E2E test automation'},
supabase:{ja:'Supabase DB操作・認証',en:'Supabase DB ops & auth'},
firebase:{ja:'Firebase Firestore・Auth',en:'Firebase Firestore & Auth'},
postgres:{ja:'PostgreSQL SQL実行',en:'PostgreSQL SQL execution'},
mongodb:{ja:'MongoDB クエリ実行',en:'MongoDB query execution'},
docker:{ja:'Dockerコンテナ操作',en:'Docker container operations'}
};
return (descs[name]||{})[lang]||name;
}
/* ── Pillar ④ AI Agent Rules (Phase B: Context-Aware, 11 files) ── */
function genPillar4_AIRules(a,pn){
const G=S.genLang==='ja';
const db=a.database||'PostgreSQL';
const be=a.backend||'Node.js + Express';
const auth=resolveAuth(a);
const arch=resolveArch(a);
const orm=arch.isBaaS?(be.includes('Supabase')?'Supabase Client SDK':be.includes('Firebase')?'Firebase SDK':'Convex Client'):(a.orm&&a.orm.includes('Drizzle')?'Drizzle ORM':'Prisma ORM');
const archNote=G?{baas:'BaaS統合パターン（サーバーレス）',bff:'BFF パターン（Next.js API Routes統合）',split:'フロント/バック分離（別ホスト）',traditional:'従来型クライアント-サーバー'}[arch.pattern]:{baas:'BaaS Integration (serverless)',bff:'BFF Pattern (Next.js API Routes)',split:'FE/BE Split (separate hosts)',traditional:'Traditional Client-Server'}[arch.pattern];
const core=`Project: ${pn}
Stack: ${a.frontend||'React'} + ${be} + ${db}
Architecture: ${archNote}
Auth SoT: ${auth.sot}
Methods: ${a.dev_methods||'TDD'}
Entities: ${a.data_entities||'users'}
Purpose: ${a.purpose||'N/A'}`;
const coreRules=`1. Always use TypeScript with strict mode
2. Follow ${(a.dev_methods||'TDD').split(', ')[0]} methodology
3. Write tests before implementation
4. Use ${a.frontend||'React'} conventions
5. Database: ${db} with ${orm}
6. Auth: ${auth.sot} — token type: ${auth.tokenType}
7. Architecture: ${archNote}
8. Follow project structure in .spec/technical-plan.md`;
const forbidden=arch.isBaaS?
`- No raw SQL in application code (use ${orm} methods)
- OK: DDL/RLS/migration SQL in supabase/migrations/
- No separate Express/Fastify server (use ${be} functions)
- No manual JWT handling (use ${auth.sot})`:
arch.pattern==='bff'?
`- No separate Express server (use Next.js API Routes)
- No \`any\` types
- No console.log in production
- No hardcoded secrets`:
`- No \`any\` types
- No console.log in production
- No hardcoded secrets
- No raw SQL in application code (use ${orm})
- OK: DDL/migration SQL in migration files`;
// Cursor-specific rules
const cursorRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}
## Cursor-Specific
- Use @workspace to reference project context
- Use @file to reference spec files (.spec/, docs/)
- Leverage multi-file editing for related changes
- Before editing, read relevant specs with @file`;
// Cline-specific rules
const clineRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}
## Cline-Specific
- Follow Plan→Act loop for each task
- After task completion: run npm test
- Update docs/24_progress.md after completing tasks
- Log errors to docs/25_error_logs.md`;
// Windsurf-specific rules
const windsurfRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}
## Windsurf-Specific
- Leverage Cascade for context-aware coding
- Create Flows for repetitive tasks
- Keep context focused: AI_BRIEF.md + current task only
- Use Flows to automate test generation`;
// Copilot (generic rules only)
const copilotRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}`;
S.files['.cursor/rules']=cursorRules;
S.files['.github/copilot-instructions.md']=`# GitHub Copilot Instructions\n${copilotRules}`;
S.files['.windsurfrules']=windsurfRules;
S.files['.clinerules']=clineRules;
S.files['.kiro/spec.md']=`# Kiro Spec\n${core}\n\n## Spec Files\nSee .spec/ directory for full specifications.`;
// Generate domain context rotation table
const domain=detectDomain(a.purpose)||'_default';
const pb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
let domainCtx='';
if(pb&&pb.ctx_ja&&pb.ctx_ja.length>0&&pb.ctx_ja[0]!==''){
domainCtx='\n\n## Domain Context Rotation\n| '+(G?'タスク種別':'Task Type')+' | '+(G?'参照ドキュメント':'Reference Docs')+' |\n|------|------|\n';
const ctx=G?pb.ctx_ja:pb.ctx_en;
ctx.forEach(c=>{
const[task,docs]=c.split('→');
domainCtx+='| '+task+' | '+docs+' |\n';
});
}
// ═══ A1: File Selection Matrix (Task-specific context loading) ═══
const fileSelectionMatrix=G?
'| タスク種別 | 推奨読込ファイル | 推定トークン |\n|---------|---------------|----------|\n| 🆕 新規機能 | AI_BRIEF.md + .spec/specification.md + docs/04_er_diagram.md | ~6K |\n| 🐛 バグ修正 | AI_BRIEF.md + docs/25_error_logs.md + 該当ソースファイル | ~4K |\n| 📝 設計レビュー | .spec/constitution.md + .spec/specification.md + docs/32_qa_blueprint.md | ~7K |\n| 🔒 セキュリティ | docs/08_security.md + docs/25_error_logs.md + .spec/verification.md | ~5K |\n| 🧪 テスト作成 | docs/07_test_cases.md + docs/33_test_matrix.md + 対象コード | ~6K |\n| 📚 ドキュメント | AI_BRIEF.md + 該当実装 + .spec/specification.md | ~5K |\n| 🚀 デプロイ | docs/09_release.md + .github/workflows/ci.yml + .devcontainer/ | ~3K |\n| 🎯 計画・マイルストーン | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| 🔍 調査タスク | AI_BRIEF.md のみ（詳細はサブエージェントに委譲） | ~3K |\n| 📋 戦略・コンプライアンス | docs/48_industry_blueprint.md + docs/50_stakeholder_strategy.md | ~5K |':
'| Task Type | Recommended Files | Est. Tokens |\n|-----------|------------------|-------------|\n| 🆕 New Feature | AI_BRIEF.md + .spec/specification.md + docs/04_er_diagram.md | ~6K |\n| 🐛 Bug Fix | AI_BRIEF.md + docs/25_error_logs.md + relevant source | ~4K |\n| 📝 Design Review | .spec/constitution.md + .spec/specification.md + docs/32_qa_blueprint.md | ~7K |\n| 🔒 Security | docs/08_security.md + docs/25_error_logs.md + .spec/verification.md | ~5K |\n| 🧪 Test Writing | docs/07_test_cases.md + docs/33_test_matrix.md + target code | ~6K |\n| 📚 Documentation | AI_BRIEF.md + implementation + .spec/specification.md | ~5K |\n| 🚀 Deployment | docs/09_release.md + .github/workflows/ci.yml + .devcontainer/ | ~3K |\n| 🎯 Planning / Milestones | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| 🔍 Research | AI_BRIEF.md only (delegate details to sub-agents) | ~3K |\n| 📋 Strategic / Compliance | docs/48_industry_blueprint.md + docs/50_stakeholder_strategy.md | ~5K |';
// detectIndustry() は p13 で function宣言（ホイスティングで利用可能）
// INDUSTRY_INTEL は p13 の const（ランタイム時にはアクセス可能）
const _ind=typeof detectIndustry==='function'?detectIndustry(a.purpose):null;
const _ii=_ind&&typeof INDUSTRY_INTEL!=='undefined'?INDUSTRY_INTEL[_ind]:null;
const domainRisksMd=_ii?(G?
'\n## コンプライアンス & ドメインリスク\n\n### 規制要件\n'+_ii.reg_ja.map(r=>'- '+r).join('\n')+'\n\n### 主要失敗要因\n'+_ii.fail_ja.map(f=>'- ⚠️ '+f).join('\n')+'\n':
'\n## Compliance & Domain Risks\n\n### Regulatory Requirements\n'+_ii.reg_en.map(r=>'- '+r).join('\n')+'\n\n### Key Failure Factors\n'+_ii.fail_en.map(f=>'- ⚠️ '+f).join('\n')+'\n'
):'';
// ═══ Phase 4: CLAUDE.md 3-Layer Split ═══
// Layer A: Thin root CLAUDE.md (~1.5K tokens, compressed from ~3K)
S.files['CLAUDE.md']=genThinCLAUDE(a,pn,auth,forbidden,G,arch,domainRisksMd);
// Layer B: Path-specific rule files
S.files['.claude/rules/spec.md']=genSpecRules(G,fileSelectionMatrix,domainCtx);
S.files['.claude/rules/frontend.md']=genFrontendRules(a.frontend||'React',G);
S.files['.claude/rules/backend.md']=genBackendRules(arch,be,a.backend||'Node.js + Express',G);
S.files['.claude/rules/test.md']=genTestRules(a.dev_methods||'TDD',G);
S.files['.claude/rules/ops.md']=genOpsRules(G);
// Layer C: Settings
S.files['.claude/settings.json']=JSON.stringify({
permissions:{
allowedTools:['Read','Write','Edit','Bash','Glob','Grep','WebFetch'],
dangerousCommands:{
requireConfirmation:['rm -rf','git push --force','git reset --hard','DROP TABLE','DELETE FROM']
}
},
context:{
specDir:'.spec/',
docsDir:'docs/',
testCommand:'npm test',
buildCommand:'npm run build'
},
rules:{
autoLoadByPath:true,
strictMode:false
}
},null,2);
// ═══ A3: AGENTS.md Sub-agent Coordination Enhancement ═══
const agentSpecMatrix=G?
'| エージェント | 専門領域 | 必要コンテキスト | トークン予算 |\n|----------|--------|-------------|----------|\n| Planner | 計画・マイルストーン | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| Frontend | UI/UX実装 | AI_BRIEF.md + docs/06_screen_design.md + docs/26_design_system.md | ~5K |\n| Backend | API/DB実装 | AI_BRIEF.md + docs/04_er_diagram.md + docs/05_api_design.md | ~6K |\n| Test | テスト作成 | AI_BRIEF.md + docs/07_test_cases.md + docs/33_test_matrix.md | ~6K |\n| QA | 品質検証 | docs/32_qa_blueprint.md + docs/37_bug_prevention.md | ~4K |\n| DevOps | デプロイ | docs/09_release_checklist.md + .devcontainer/ + .github/workflows/ | ~3K |\n| Research | 調査専門 | AI_BRIEF.md のみ（結論返却） | ~3K |':
'| Agent | Specialization | Required Context | Token Budget |\n|-------|---------------|------------------|-------------|\n| Planner | Planning & milestones | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| Frontend | UI/UX impl | AI_BRIEF.md + docs/06_screen_design.md + docs/26_design_system.md | ~5K |\n| Backend | API/DB impl | AI_BRIEF.md + docs/04_er_diagram.md + docs/05_api_design.md | ~6K |\n| Test | Test creation | AI_BRIEF.md + docs/07_test_cases.md + docs/33_test_matrix.md | ~6K |\n| QA | Quality assurance | docs/32_qa_blueprint.md + docs/37_bug_prevention.md | ~4K |\n| DevOps | Deployment | docs/09_release_checklist.md + .devcontainer/ + .github/workflows/ | ~3K |\n| Research | Investigation | AI_BRIEF.md only (return conclusion) | ~3K |';
const handoffProtocol=G?
'\n## Handoff Protocol（引継ぎフォーマット）\n\n**引継ぎ時に必ず含める情報**:\n```yaml\nfrom: [引継ぎ元エージェント名]\nto: [引継ぎ先エージェント名]\ntask: [タスク概要 1文]\ncontext: [必要最小限のコンテキスト]\ndeliverables:\n  - [成果物1]\n  - [成果物2]\nnext_action: [次のアクション]\nblocking_issues: [ブロッカーがあれば]\n```\n\n**Summary-Only Import原則**:\n- 調査エージェントは全文返却禁止\n- 結論(3行) + 推奨事項(3つ) + 次のアクションのみ\n- メインエージェントは要約のみコンテキストに追加\n':
'\n## Handoff Protocol\n\n**Required information in handoff**:\n```yaml\nfrom: [Source agent name]\nto: [Target agent name]\ntask: [Task summary in 1 sentence]\ncontext: [Minimal necessary context]\ndeliverables:\n  - [Deliverable 1]\n  - [Deliverable 2]\nnext_action: [Next action]\nblocking_issues: [If any blockers]\n```\n\n**Summary-Only Import Principle**:\n- Research agents MUST NOT return full text\n- Conclusion (3 lines) + Recommendations (3 bullets) + Next action only\n- Main agent adds summary only to context\n';
S.files['AGENTS.md']=`# AGENTS.md — ${pn}\n\n## Agent Guidelines\n${core}\n\n## Task Assignment\n- Frontend agent: UI components, pages, styling\n- Backend agent: ${arch.isBaaS?a.backend+' functions, RLS policies':arch.pattern==='bff'?'Next.js API Routes, middleware':'API routes, database, auth'}\n- Test agent: Unit tests, E2E tests\n- DevOps agent: CI/CD, deployment\n\n## Agent Specialization Matrix\n${G?'**エージェント種別と責任範囲**':'**Agent types and responsibilities**'}\n\n${agentSpecMatrix}${handoffProtocol}\n\n## Coordination\n- All agents must read .spec/ before starting\n- Use tasks.md for work coordination\n- Commit with conventional commits`;
S.files['codex-instructions.md']=`# Codex Instructions (OpenAI)\n${copilotRules}\n\n## Codex Agent Mode\n- Use agentic mode for multi-file refactoring\n- Verify changes with npm test before committing\n- Respect .spec/ constraints`;
S.files['skills/project.md']=`# ${pn} ${G?'— AIスキル':'— AI Skills'}\n${G?'工場テンプレート形式。詳細はskills/catalog.md参照':'Factory Template format. See skills/catalog.md for details'}\n\n${G?'## スキル':'## Skills'}\n\n### 1. spec-review\n- **${G?'役割':'Role'}**: ${G?'設計':'Design'}\n- **${G?'目的':'Purpose'}**: ${G?'.spec/検証':'Verify .spec/'}\n- **${G?'入力':'Input'}**: .spec/constitution.md, specification.md\n- **${G?'判断':'Judgment'}**: ${G?'矛盾0件':' 0 contradictions'}\n- **${G?'次':'Next'}**: code-gen\n\n### 2. code-gen\n- **${G?'役割':'Role'}**: ${G?'制作':'Production'}\n- **${G?'目的':'Purpose'}**: ${G?'コード生成':'Generate code'}\n- **${G?'入力':'Input'}**: .spec/technical-plan.md\n- **${G?'判断':'Judgment'}**: ${G?'エラー0':'0 errors'}\n- **${G?'次':'Next'}**: test-gen\n\n### 3. test-gen\n- **${G?'役割':'Role'}**: ${G?'制作':'Production'}\n- **${G?'目的':'Purpose'}**: ${G?'テスト生成':'Generate tests'}\n- **${G?'入力':'Input'}**: ${G?'新規コード':'New code'}\n- **${G?'判断':'Judgment'}**: ${G?'カバレッジ80%+':'Coverage ≥80%'}\n- **${G?'次':'Next'}**: deploy-check\n\n### 4. doc-gen\n- **${G?'役割':'Role'}**: ${G?'運用':'Operations'}\n- **${G?'目的':'Purpose'}**: ${G?'ドキュメント生成':'Generate docs'}\n- **${G?'判断':'Judgment'}**: ${G?'未文書化0':'0 undocumented'}\n- **${G?'次':'Next'}**: refactor\n\n### 5. refactor\n- **${G?'役割':'Role'}**: ${G?'設計':'Design'}\n- **${G?'目的':'Purpose'}**: ${G?'リファクタリング提案':'Suggest refactoring'}\n- **${G?'判断':'Judgment'}**: ${G?'重複10%↓':'Duplication ≤10%'}\n- **${G?'次':'Next'}**: spec-review\n\n${G?'## テンプレート':'## Template'}\n\`\`\`markdown\n### [skill-id]\n- **${G?'役割':'Role'}**: [Planning/Design/Production/Operations]\n- **${G?'目的':'Purpose'}**: [${G?'何をするか':'What it does'}]\n- **${G?'判断':'Judgment'}**: [${G?'成功条件':'Success criteria'}]\n- **${G?'次':'Next'}**: [${G?'次のスキル':'Next skill'}]\n\`\`\`\n`;
S.files['.gemini/settings.json']=`{\n  "project": "${pn}",\n  "model": "gemini-3-pro",\n  "context": {\n    "spec_dir": ".spec/",\n    "include": ["src/", "package.json", "tsconfig.json"],\n    "exclude": ["node_modules/", "dist/"]\n  },\n  "safety": "balanced",\n  "tools": ["code_execution", "grounding"]\n}`;
S.files['.ai/hooks.yml']=`# AI Hooks Configuration
hooks:
pre-commit:
- name: lint-check
command: npm run lint
- name: type-check
command: npx tsc --noEmit
pre-push:
- name: test
command: npm test
post-generate:
- name: format
command: npx prettier --write .
`;
// ═══ AI_BRIEF.md — Condensed Single-File Spec for AI Agents ═══
// Goal: ~3000 tokens containing everything an AI needs to start coding
const entities=(a.data_entities||'User').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const features=(a.mvp_features||'CRUD').split(', ').filter(Boolean);
const screens=(a.screens||'Dashboard').split(', ').filter(Boolean);
const fe=a.frontend||'React';
const deploy=a.deploy||'Vercel';
// Build compact DB schema
const dbSchema=entities.map(en=>{
const cols=getEntityColumns(en,G,entities);
const colList=cols.map(c=>{
const fk=c.constraint.includes('FK')?` → ${c.constraint.match(/FK\((\w+)\)/)?.[1]||'?'}`:'';
const req=c.constraint.includes('NOT NULL')?'!':'';
return `${c.col}${req}:${c.type.replace('VARCHAR(255)','str').replace('VARCHAR(100)','str').replace('VARCHAR(50)','str').replace('VARCHAR(20)','enum').replace('DECIMAL(10,2)','decimal').replace('BOOLEAN','bool').replace('TIMESTAMP','ts').replace('BIGINT','bigint').replace('JSONB','json').replace('UUID','uuid').replace('TEXT','text').replace('DATE','date').replace('TIME','time').replace('INT','int')}${fk}`;
}).join(', ');
return `  ${en}: id:uuid(PK)${colList?', '+colList:''}, created_at:ts, updated_at:ts`;
}).join('\n');
// Build compact ER relationships
const erData=inferER(a);
const erCompact=erData.relationships.map(r=>r.replace(/\s+/g,' ')).join('; ');
// Build compact features with acceptance criteria
const featureCompact=features.map(f=>{
const fd=getFeatureDetail(f);
if(fd){
const criteria=(G?fd.criteria_ja:fd.criteria_en).map(c=>c.replace(/\{auth\}/g,a.auth||'OAuth'));
return `  ${f}: ${criteria.slice(0,4).join(' / ')}`;
}
return `  ${f}`;
}).join('\n');
// Build compact routes
const routes=genRoutes(a);
const routeCompact=routes.map(r=>`${r.auth?'🔒':'🌐'} ${r.path} → ${r.name}`).join(', ');
// Per-table RLS (compact)
let rlsCompact='';
if(arch.isBaaS&&be.includes('Supabase')){
rlsCompact=entities.map(en=>{
const cols=getEntityColumns(en,G,entities);
const ownerCol=en.toLowerCase()==='user'?'id':cols.find(c=>c.col==='user_id'||c.col==='owner_id'||c.col==='instructor_id'||c.col==='provider_id')?.col;
if(!ownerCol) return `  ${pluralize(en)}: authenticated=SELECT`;
return `  ${pluralize(en)}: auth.uid()=${ownerCol} → SELECT/INSERT/UPDATE/DELETE`;
}).join('\n');
}
// Stripe section (compact)
let stripeCompact='';
if(a.payment&&(a.payment||'').includes('Stripe')){
stripeCompact=`
## Payment (Stripe)
Plans: Free(¥0) / Pro(¥980/mo) / Enterprise(¥9,800/mo)
Webhook: POST /api/webhook/stripe
invoice.paid → subscription.status=active
customer.subscription.deleted → status=canceled
Tables: subscriptions(user_id, stripe_subscription_id, stripe_customer_id, status, plan, current_period_end)
Keys: STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`;
}
// RBAC section (compact)
let rbacCompact='';
const hasAdminBrief=/管理者|admin/i.test(a.target||'');
if(hasAdminBrief){
rbacCompact=`
## RBAC
Roles: user(own data) / admin(all data, user mgmt)${/講師|instructor/i.test(a.target||'')?` / instructor(own content+students)`:''}
Column: profiles.role
Admin routes: /admin/ → role=admin check`;
}
const _trb=typeof TECH_RADAR_BASE!=='undefined'?TECH_RADAR_BASE:null;
const briefDomainRisk=_ii?(G?
'\n## ドメインリスク\n'+_ii.fail_ja.slice(0,3).map(f=>'- '+f).join('\n')+'\n':
'\n## Domain Risks\n'+_ii.fail_en.slice(0,3).map(f=>'- '+f).join('\n')+'\n'
):'';
// Tech Radar: 選択技術の分類を表示
const _feRadar=_trb?(['frontend','backend','infrastructure','ai'].map(cat=>{
const r=_trb[cat];if(!r)return '';
const all=[...r.adopt.map(t=>t+':Adopt'),...r.trial.map(t=>t+':Trial'),...r.assess.map(t=>t+':Assess'),...r.hold.map(t=>t+':Hold')];
// ユーザー選択技術とマッチ
const stack=[a.frontend,a.backend,a.database,a.deploy].filter(Boolean).join(' ');
return all.filter(e=>stack.includes(e.split(':')[0].split(' ')[0])).join(', ');
}).filter(Boolean).join(', ')):'';
const briefTechRadar=_feRadar?(G?'\nTech Radar: '+_feRadar+'\n':'\nTech Radar: '+_feRadar+'\n'):'';
S.files['AI_BRIEF.md']=`# ${pn} — AI Implementation Brief
> ${G?'このファイル1つで開発開始可能。':'Start coding with this single file.'} ~3K tokens.
## Stack
${fe} + ${be} + ${a.database||'PostgreSQL'} → ${deploy}
Auth: ${auth.sot} (${auth.tokenType})
ORM: ${orm}
Pattern: ${archNote}
## Context Protocol
1. Start: Read THIS file (AI_BRIEF.md)
2. Deep dive: .spec/{constitution,specification}.md
3. Current state: docs/24_progress.md
4. Before coding: Relevant docs/ file
5. After task: Update docs/24_progress.md
6. On error: Log to docs/25_error_logs.md
7. Context full: Keep AI_BRIEF.md + current task only
## Context Loading Strategy
**Phase-based file loading priority**:
${G?'- **Phase 0 企画**: .spec/constitution.md → .spec/specification.md + docs/29_reverse_engineering.md':'- **Phase 0 Planning**: .spec/constitution.md → .spec/specification.md + docs/29_reverse_engineering.md'}
${G?'- **Phase 1 設計**: + docs/04_er_diagram.md + docs/05_api_design.md + docs/30_goal_decomposition.md + docs/32_qa_blueprint.md':'- **Phase 1 Design**: + docs/04_er_diagram.md + docs/05_api_design.md + docs/30_goal_decomposition.md + docs/32_qa_blueprint.md'}
${G?'- **Phase 2 実装**: + AI_BRIEF.md (主要) + docs/24_progress.md + 該当ソース':'- **Phase 2 Implementation**: + AI_BRIEF.md (primary) + docs/24_progress.md + relevant source'}
${G?'- **Phase 3 テスト**: + docs/07_test_cases.md + docs/33_test_matrix.md + docs/36_test_strategy.md':'- **Phase 3 Testing**: + docs/07_test_cases.md + docs/33_test_matrix.md + docs/36_test_strategy.md'}
${G?'- **Phase 4 運用**: + docs/34_incident_response.md + docs/09_release_checklist.md + docs/25_error_logs.md':'- **Phase 4 Operations**: + docs/34_incident_response.md + docs/09_release_checklist.md + docs/25_error_logs.md'}
**Token budget allocation**:
${G?'- 🎯 現在タスク: 40% (4K)':'- 🎯 Current task: 40% (4K)'}
${G?'- 📋 Spec/設計: 30% (3K)':'- 📋 Spec/design: 30% (3K)'}
${G?'- 📊 進捗/履歴: 20% (2K)':'- 📊 Progress/history: 20% (2K)'}
${G?'- 🔄 予備バッファ: 10% (1K)':'- 🔄 Reserve buffer: 10% (1K)'}
**New files reference** (${G?'最新生成ファイル':'latest generated files'}):
- docs/29_reverse_engineering.md ${G?'— ゴール逆算プランニング':'— Goal-driven planning'}
- docs/30_goal_decomposition.md ${G?'— ゴール分解・ギャップ分析':'— Goal decomposition & gap analysis'}
- docs/34_incident_response.md ${G?'— 障害対応':'— Incident response'}
- docs/35_sitemap.md ${G?'— 情報設計':'— Information architecture'}
- docs/36_test_strategy.md ${G?'— フェーズ別テスト戦略':'— Phase-based testing'}
- docs/37_bug_prevention.md ${G?'— バグ予防':'— Bug prevention'}
- docs/38_business_model.md ${G?'— ビジネスモデル (payment≠none時)':'— Business model (if payment≠none)'}
- skills/agents/*.md ${G?'— エージェント定義 (ai_auto=multi/full時)':'— Agent definitions (if ai_auto=multi/full)'}
## DB Schema
\`\`\`
${dbSchema}
\`\`\`
## Relationships
${erCompact}
${rlsCompact?'\n## RLS Policies\n'+rlsCompact:''}
## Features (MVP)
${featureCompact}
## Routes
${routeCompact}
${stripeCompact}${rbacCompact}${briefDomainRisk}${briefTechRadar}
## Dev Rules
- TypeScript strict, Vitest, Playwright
- ${(a.dev_methods||'TDD').split(', ')[0]} methodology
- ${orm} for DB access
- ${auth.sot} for all auth
- Forbidden: ${arch.isBaaS?'raw SQL, Express server, manual JWT':'any types, console.log in prod, hardcoded secrets'}
## File Structure
.spec/           → ${G?'仕様書':'Specifications'} (constitution, specification, technical-plan, tasks, verification)
docs/            → ${G?'設計ドキュメント':'Design documents'} (ER, API, screen, test cases, security, etc.)
.devcontainer/   → ${G?'開発環境':'Dev environment'}
CLAUDE.md        → ${G?'Claude Code用ルール':'Claude Code rules'}
.cursor/rules    → ${G?'Cursor用ルール':'Cursor rules'}
## Quick Start
1. \`npm install\` → setup dependencies
2. Read this file → understand full spec
3. Create DB schema (see DB Schema above)
4. Implement features top-to-bottom (see Features)
5. Run \`npm test\` after each feature
`;
// ═══ Phase 2 & 3: Skills Catalog + Pipelines (only if ai_auto ≠ None) ═══
const aiAuto=a.ai_auto||'';
if(aiAuto&&!isNone(aiAuto)){
// Detect domain for domain-specific skills
const domain=detectDomain(a.purpose||'');
// Compressed: role:name_ja:name_en:purpose_ja:purpose_en:judgment_ja:judgment_en
const coreSkills=['0:ゴール逆算:Goal Reversal:KPI→機能→実装の逆算:KPI → Features → Impl:ギャップ0:0 gaps','0:要件レビュー:Req Review:要件検証:Verify reqs:欠落0:0 gaps','1:設計検証:Arch Review:技術評価:Eval tech:P0リスク0:0 P0 risks','2:実装支援:Code Support:実装支援:Impl support:エラー0:0 errors','3:デプロイ検証:Deploy Check:デプロイ前チェック:Pre-deploy check:全PASS:All PASS'];
const domainSkillsMap={
education:['1:教材設計:Curriculum:教材設計:Design curriculum:説明可能:Explainable','2:問題生成:Quiz Gen:問題生成:Gen quiz:各3問:3 each'],
ec:['1:商品検証:Catalog:商品検証:Verify catalog:必須100%:Req 100%','1:決済検証:Checkout:決済検証:Verify checkout:OWASP準拠:OWASP OK'],
saas:['0:機能仕様:Feature Spec:機能仕様:Feature spec:AC3+:≥3 AC','1:API設計:API Design:API設計:API design:違反0:0 violations'],
community:['1:モデレーション:Moderation:モデレーション:Moderation:違反1%↓:≤1% violations','3:分析:Analytics:行動分析:Behavior analysis:可視化:Visualized'],
booking:['0:予約設計:Booking Logic:予約設計:Booking logic:重複0:0 duplicates','2:リマインダー:Reminder:通知最適化:Optimize notify:到達95%+:≥95% delivery'],
health:['1:記録検証:Health Log:健康記録検証:Verify health logs:異常値0:0 anomalies','2:目標設定:Goal Setting:目標達成率計算:Calc goal achievement:達成率可視化:Visualized rate'],
marketplace:['0:取引設計:Trade Design:取引フロー設計:Design trade flow:安全性確保:Safety ensured','1:レビュー検証:Review Check:レビュー信頼性検証:Verify review trust:偽装0:0 fake'],
content:['2:配信最適化:Delivery Opt:コンテンツ配信最適化:Optimize content delivery:遅延100ms↓:≤100ms delay','3:分析:Analytics:閲覧分析:View analytics:エンゲージ可視化:Engagement vis'],
analytics:['1:ダッシュボード設計:Dashboard:ダッシュボード設計:Design dashboard:KPI明確:Clear KPI','2:レポート生成:Report Gen:レポート自動生成:Auto-gen reports:正確性100%:100% accuracy'],
business:['0:CRM設計:CRM Design:顧客管理設計:Design CRM:リード漏れ0:0 lead loss','1:営業フロー:Sales Flow:営業プロセス最適化:Optimize sales process:CVR向上:Improve CVR'],
iot:['1:デバイス管理:Device Mgmt:デバイス管理:Device management:全台接続:All connected','2:センサー分析:Sensor Analysis:センサーデータ分析:Analyze sensor data:異常検知:Anomaly detected','3:アラート設計:Alert Design:アラート設計:Design alerts:誤報1%↓:≤1% false alarm'],
realestate:['0:物件管理:Property Mgmt:物件データ管理:Manage property data:登録100%:100% listed','1:内見予約:Viewing:内見予約管理:Manage viewings:重複0:0 overlaps','2:契約検証:Contract:契約書検証:Verify contracts:必須項目100%:100% required'],
legal:['0:契約レビュー:Contract Review:契約書レビュー:Review contracts:リスク条項0:0 risk clauses','1:コンプライアンス:Compliance:法令準拠チェック:Compliance check:違反0:0 violations','3:文書管理:Doc Mgmt:文書バージョン管理:Doc version control:最新版追跡:Latest tracked'],
hr:['0:採用フロー:Hiring Flow:採用プロセス設計:Design hiring flow:漏れ0:0 gaps','1:評価設計:Eval Design:評価制度設計:Design evaluation:基準明確:Clear criteria','3:オンボーディング:Onboarding:入社手続き管理:Manage onboarding:完了率100%:100% completion'],
fintech:['1:取引検証:Tx Validation:取引データ検証:Validate transactions:不正0:0 fraud','1:リスク分析:Risk Analysis:リスク評価:Risk assessment:P0対応済:P0 addressed','3:レポート生成:Report Gen:財務レポート:Financial reports:正確性100%:100% accuracy'],
ai:['0:プロンプト設計:Prompt Design:プロンプト最適化:Optimize prompts:精度90%+:≥90% accuracy','1:RAG構築:RAG Setup:コンテキスト管理:Manage context:関連性95%+:≥95% relevance','2:モデル評価:Model Eval:応答品質評価:Eval response quality:幻覚1%↓:≤1% hallucination'],
automation:['0:ワークフロー設計:Workflow Design:自動化フロー設計:Design automation flow:漏れ0:0 gaps','1:条件分岐:Branching:条件分岐ロジック:Branching logic:網羅100%:100% coverage','2:エラーハンドリング:Error Handling:リトライ・フォールバック:Retry & fallback:復旧率98%+:≥98% recovery'],
event:['0:チケット設計:Ticket Design:チケット販売設計:Design ticket sales:在庫管理100%:100% inventory','1:参加者管理:Attendee Mgmt:参加者管理:Manage attendees:重複0:0 duplicates','2:通知最適化:Notify Opt:イベント通知最適化:Optimize event notifications:到達95%+:≥95% delivery'],
gamify:['0:ポイント設計:Point Design:ポイントシステム設計:Design point system:整合性100%:100% consistency','1:バッジ条件:Badge Logic:バッジ獲得条件:Badge unlock logic:漏れ0:0 gaps','2:ランキング:Leaderboard:ランキング計算:Calc leaderboard:精度100%:100% accuracy'],
collab:['0:同期設計:Sync Design:リアルタイム同期設計:Design realtime sync:遅延200ms↓:≤200ms latency','1:競合解決:Conflict Resolve:競合解決アルゴリズム:Conflict resolution:損失0:0 data loss','2:バージョン管理:Versioning:変更履歴管理:Manage change history:追跡100%:100% tracked'],
devtool:['0:API設計:API Design:開発者API設計:Design developer API:DX評価4.5+:≥4.5 DX','1:SDK構築:SDK Build:SDK・サンプル構築:Build SDK & samples:カバレッジ80%+:≥80% coverage','2:ドキュメント:Docs:ドキュメント生成:Generate docs:網羅性95%+:≥95% completeness'],
creator:['0:収益化設計:Monetization:収益化戦略設計:Design monetization:収益源3+:≥3 revenue streams','1:ファン管理:Fan Mgmt:ファンコミュニティ管理:Manage fan community:エンゲージ8%+:≥8% engagement','2:分析:Analytics:クリエイター分析:Creator analytics:インサイト可視化:Insights vis'],
newsletter:['0:コンテンツ戦略:Content Strategy:配信コンテンツ戦略:Delivery content strategy:開封率25%+:≥25% open rate','1:セグメント設計:Segment Design:セグメント配信設計:Design segment delivery:精度95%+:≥95% accuracy','2:A/Bテスト:A/B Test:A/Bテスト設計:Design A/B test:統計的有意性:Statistical significance']
};
const domainSkills=domainSkillsMap[domain]||[];
const allSkills=[...coreSkills,...domainSkills];
const roleNames=G?['企画 (Planning)','設計 (Design)','制作 (Production)','運用 (Operations)']:['Planning','Design','Production','Operations'];
// Template helpers for compression
const _fld=(fj,fe,val)=>`- **${G?fj:fe}**: ${val}\n`;
// Compressed skill details helper (19 skills)
const _sd=(i,pj,pe,oj,oe)=>({input:i,process:G?pj:pe,output:G?oj:oe});
const skillDetails={
'教材設計':_sd('docs/03,04','ER図→学習フロー抽出→難易度分類→構成生成','ER→flow→difficulty→curriculum','構成マップ(md)','Curriculum (md)'),
'機能仕様':_sd('.spec/constitution','使命→ストーリー抽出→受入条件3つ→優先度付与','Mission→stories→3 AC→priority','仕様書(md)','Spec (md)'),
'API設計':_sd('docs/04,05','ER→エンドポイント生成→REST命名チェック→標準化','ER→endpoints→REST check→standardize','API仕様(OpenAPI)','API spec (OpenAPI)'),
'決済検証':_sd('docs/08','OWASP照合→Webhook検証→RLSチェック','OWASP→webhook→RLS','チェックリスト','Checklist'),
'要件レビュー':_sd('.spec/constitution,specification','使命→KPI照合→機能網羅チェック→欠落列挙','Mission→KPI check→feature coverage→list gaps','矛盾リスト+修正案','Gap list + fix proposal'),
'設計検証':_sd('.spec/technical-plan','スタック評価→依存関係チェック→リスク分析→代替案','Stack eval→deps check→risk→alternatives','リスク評価表','Risk assessment'),
'実装支援':_sd('.spec/specification,technical-plan','仕様読込→型定義→CRUD実装→テスト生成','Read spec→types→CRUD impl→gen tests','実装コード+テスト','Code + tests'),
'デプロイ検証':_sd('docs/09,ci.yml','環境変数チェック→ビルド検証→ヘルスチェック→ロールバック確認','Env check→build verify→health→rollback','デプロイレポート','Deploy report'),
'問題生成':_sd('docs/03,Lesson','学習目標抽出→難易度設定→正常系3問+異常系3問→解説生成','Goals→difficulty→3 normal+3 edge→explanations','問題セット(JSON)','Quiz set (JSON)'),
'商品検証':_sd('Product,Category','必須フィールド検査→SKU重複チェック→価格妥当性→画像存在確認','Required fields→SKU dup→price valid→image check','検証レポート','Validation report'),
'モデレーション':_sd('Post,Comment','禁止語チェック→スパム判定→報告集計→対応優先度付与','Banned words→spam detect→report aggregate→priority','モデレーションキュー','Moderation queue'),
'予約設計':_sd('Service,TimeSlot','空き枠計算→重複検出→バッファ設定→通知設計','Availability calc→dup detect→buffer→notify design','予約ロジック仕様','Booking logic spec'),
'記録検証':_sd('HealthLog,Goal','入力値範囲チェック→異常値検出→トレンド分析→アラート条件設定','Range check→anomaly detect→trend→alert config','健康レポート','Health report'),
'CRM設計':_sd('User,Contact','リード定義→ファネル設計→スコアリング→自動化ルール','Lead def→funnel→scoring→automation rules','CRM設計書','CRM design doc'),
'デバイス管理':_sd('Device,Sensor','デバイス登録→接続状態監視→ファーム更新管理→ログ収集','Register→monitor→firmware→logs','デバイス管理画面','Device dashboard'),
'物件管理':_sd('Property,Category','物件登録→写真管理→間取り設定→公開管理','Register→photos→floor plan→publish','物件データベース','Property DB'),
'契約レビュー':_sd('Contract,Template','テンプレート照合→リスク条項検出→期限チェック→承認フロー','Template match→risk detect→deadline→approval','レビュー結果','Review result'),
'採用フロー':_sd('JobPosting,Applicant','求人作成→応募管理→面接調整→評価集約→内定','Post→apply→interview→eval→offer','採用パイプライン','Hiring pipeline'),
'取引検証':_sd('Transaction,Account','残高確認→二重支払チェック→限度額検証→監査ログ','Balance→dup check→limit→audit log','検証レポート','Validation report')
};
let catalogMd=`# ${pn} ${G?'— AIスキルカタログ':'— AI Skills Catalog'}\n${G?'ドメイン特化スキル + コア開発スキル':'Domain-specific skills + core development skills'}\n\n`;
roleNames.forEach((role,idx)=>{
const roleSkills=allSkills.filter(s=>parseInt(s.split(':')[0])===idx);
if(roleSkills.length===0)return;
catalogMd+=`## ${role}\n\n`;
roleSkills.forEach(s=>{
const[,nameJa,nameEn,purposeJa,purposeEn,judgmentJa,judgmentEn]=s.split(':');
const name=G?nameJa:nameEn;
const purpose=G?purposeJa:purposeEn;
const judgment=G?judgmentJa:judgmentEn;
const detail=skillDetails[nameJa]||skillDetails[nameEn];
catalogMd+=`### ${name}\n`+_fld('目的','Purpose',purpose)+_fld('判断基準','Judgment',judgment);
if(detail){
catalogMd+=_fld('入力','Input',detail.input)+_fld('処理','Process',detail.process)+_fld('出力','Output',detail.output);
}else{
catalogMd+=_fld('入力','Input',G?'関連ドキュメント':'Relevant documents')+_fld('出力','Output',G?'検証レポート/生成物':'Validation report / deliverables');
}
catalogMd+='\n';
});
});
// Advanced skills based on ai_auto level
const hasMultiAgent=aiAuto.includes('Multi')||aiAuto.includes('マルチ')||aiAuto.includes('Full')||aiAuto.includes('フル')||aiAuto.includes('Orch');
const hasFullAuto=aiAuto.includes('Full')||aiAuto.includes('フル')||aiAuto.includes('Orch');
if(hasMultiAgent){
catalogMd+=`## ${G?'高度スキル':'Advanced'}\n`;
catalogMd+=`### ${G?'並列レビュー':'Parallel Review'}\n- **${G?'目的':'Purpose'}**: ${G?'複数エージェントで同時レビュー':'Multi-agent simultaneous review'}\n- **${G?'判断':'Judgment'}**: ${G?'全合意':'All agree'}\n- **${G?'入力':'Input'}**: ${G?'対象コード':'Target code'}\n- **${G?'処理':'Process'}**: ${G?'分割→並列レビュー→結果マージ→合意形成':'Split→parallel review→merge→consensus'}\n- **${G?'出力':'Output'}**: ${G?'統合レビュー':'Unified review'}\n\n`;
catalogMd+=`### ${G?'コードレビュー自動化':'Auto Code Review'}\n- **${G?'目的':'Purpose'}**: ${G?'PR単位で自動コードレビュー':'Auto review per PR'}\n- **${G?'判断':'Judgment'}**: ${G?'問題0件':'0 issues'}\n- **${G?'入力':'Input'}**: ${G?'PRの差分':'PR diff'}\n- **${G?'処理':'Process'}**: ${G?'差分解析→パターンチェック→セキュリティスキャン→提案生成':'Diff→pattern check→security scan→suggestions'}\n- **${G?'出力':'Output'}**: ${G?'レビューコメント':'Review comments'}\n\n`;
catalogMd+=`### ${G?'ドキュメント自動更新':'Auto Doc Update'}\n- **${G?'目的':'Purpose'}**: ${G?'コード変更に連動してドキュメント更新':'Update docs on code changes'}\n- **${G?'判断':'Judgment'}**: ${G?'乖離0':'0 drift'}\n- **${G?'入力':'Input'}**: ${G?'変更コード+既存docs/':'Changed code + existing docs/'}\n- **${G?'処理':'Process'}**: ${G?'変更検出→影響ドキュメント特定→差分生成→反映':'Detect change→find affected docs→gen diff→apply'}\n- **${G?'出力':'Output'}**: ${G?'更新済ドキュメント':'Updated docs'}\n\n`;
catalogMd+=`### ${G?'圧縮':'Compression'}\n- **${G?'判断':'Judgment'}**: ${G?'トークン80%削減':'80% token reduction'}\n\n`;
}
if(hasFullAuto){
catalogMd+=`## ${G?'自律':'Autonomous'}\n### ${G?'統括':'Orchestration'}\n- **${G?'判断':'Judgment'}**: ${G?'全完了':'All done'}\n### ${G?'自己修復':'Self-Heal'}\n- **${G?'判断':'Judgment'}**: ${G?'リトライ成功':'Retry OK'}\n\n`;
}
// Domain-specific skill
const domainPb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
if(domainPb&&domainPb.skill_ja&&domainPb.skill_ja!==''){
const skillParts=(G?domainPb.skill_ja:domainPb.skill_en).split('|');
if(skillParts.length>=5){
catalogMd+=`## ${G?'業種特化スキル':'Domain-Specific'}\n### ${G?'業種カスタムスキル':'Custom Domain Skill'}\n`;
catalogMd+=`- **${G?'役割':'Role'}**: ${skillParts[0]}\n`;
catalogMd+=`- **${G?'目的':'Purpose'}**: ${skillParts[1]}\n`;
catalogMd+=`- **${G?'入力':'Input'}**: ${skillParts[2]}\n`;
catalogMd+=`- **${G?'判断基準':'Judgment'}**: ${skillParts[3]}\n`;
catalogMd+=`- **${G?'出力':'Output'}**: ${skillParts[4]}\n\n`;
}
}
catalogMd+=`${G?'## 工場テンプレート':'## Factory Template'}\n${G?'詳細はskills/project.mdを参照':'See skills/project.md for template details'}\n`;
S.files['skills/catalog.md']=catalogMd;
// ═══ Phase 3: Pipelines (simplified) ═══
const aiLevel=aiAuto.includes('Vibe')||aiAuto.includes('入門')?'vibe':aiAuto.includes('Agentic')||aiAuto.includes('開発')?'agentic':aiAuto.includes('Multi')||aiAuto.includes('マルチ')?'multi':aiAuto.includes('Full')||aiAuto.includes('フル')?'full':'orch';
const basePipe={n:'Feature Dev',t:'New task',s:['req-review','arch-validate','code-gen','test-gen','deploy-check'],g:aiLevel==='vibe'||aiLevel==='agentic'?'human':'auto'};
const bugPipe={n:'Bug Fix',t:'Bug report',s:['reproduce','root-cause','fix','test','log'],g:aiLevel==='vibe'?'human':'auto'};
const pipelines=[basePipe];
if(aiLevel!=='vibe')pipelines.push(bugPipe);
if(aiLevel==='full'||aiLevel==='orch')pipelines.push({n:'Release',t:'Version tag',s:['qa','staging','security','prod'],g:'staging'});
let pipelineMd=`# ${pn} ${G?'— パイプライン':'— Pipelines'}\n\n`;
pipelines.forEach(p=>{
pipelineMd+=`## ${p.n}\n- **${G?'トリガー':'Trigger'}**: ${p.t}\n- **${G?'スキル':'Skills'}**: ${p.s.join(' → ')}\n- **${G?'ゲート':'Gate'}**: ${p.g}\n- **${G?'エラー':'Error'}**: ${G?'ログ → リトライ':'log → retry'}\n\n\`\`\`mermaid\ngraph LR\n  T[${G?'開始':'Start'}]`;
p.s.forEach((s,i)=>pipelineMd+=` --> S${i+1}[${s}]`);
pipelineMd+=` --> Done[${G?'完了':'Done'}]\n\`\`\`\n\n`;
});
pipelineMd+=`${G?'## 実行方法':'## Execution'}\n1. ${G?'トリガー':'Trigger'}\n2. ${G?'スキル実行':'Run skills'}\n3. ${G?'PASS → 次':'PASS → next'}\n`;
S.files['skills/pipelines.md']=pipelineMd;
// ═══ skills/factory.md (Manus Skills Factory Template) ═══
const thinkingAxis={
education:G?'理解できるか?':'Understandable?',
ec:G?'コンバージョンするか?':'Converts?',
saas:G?'ユーザー価値があるか?':'User value?',
fintech:G?'安全か?':'Secure?',
health:G?'正確か?':'Accurate?',
marketplace:G?'信頼できるか?':'Trustworthy?',
community:G?'健全か?':'Healthy?',
content:G?'エンゲージメントするか?':'Engaging?',
analytics:G?'正確か?':'Accurate?',
booking:G?'重複しないか?':'No conflicts?',
business:G?'効率的か?':'Efficient?',
iot:G?'接続できるか?':'Connected?',
realestate:G?'成約するか?':'Converts?',
legal:G?'準拠しているか?':'Compliant?',
hr:G?'公平か?':'Fair?',
ai:G?'幻覚がないか?':'No hallucinations?',
automation:G?'自動化できるか?':'Automatable?',
event:G?'満足できるか?':'Satisfying?',
gamify:G?'継続できるか?':'Retaining?',
collab:G?'同期できるか?':'Synced?',
devtool:G?'使いやすいか?':'Developer-friendly?',
creator:G?'収益化できるか?':'Monetizable?',
newsletter:G?'開封されるか?':'Opened?'
};
const axis=thinkingAxis[domain]||(G?'目標達成できるか?':'Goal-achievable?');
let factoryMd='# '+(G?'Manus Skills式スキルファクトリー':'Manus Skills Factory Template')+'\n\n';
factoryMd+=G?'**重要**: このテンプレートは「1スキル=1判断」原則に基づき、カスタムスキルを設計するためのファクトリーです。AIエージェントは、新しいタスクに遭遇した際、このフォーマットでスキルを定義してください。\n\n':'**IMPORTANT**: This template follows "1 Skill = 1 Judgment" principle for designing custom skills. AI agents MUST use this format when defining new skills for encountered tasks.\n\n';
factoryMd+=(G?'## 原則: 1スキル=1判断':'## Principle: 1 Skill = 1 Judgment')+'\n\n';
factoryMd+=G?'- **スキルは判断単位**: 複数の判断を1スキルに詰め込まない\n- **判断基準は明確**: "PASS/FAIL"または"数値目標"で測定可能\n- **入力→処理→判断→出力**: この4ステップで完結する\n\n':'- **Skill is a judgment unit**: Don\'t pack multiple judgments into one skill\n- **Judgment criteria are clear**: Measurable as "PASS/FAIL" or "numerical targets"\n- **Input → Process → Judge → Output**: Complete in these 4 steps\n\n';
factoryMd+=(G?'## ドメイン別思考軸':'## Domain-Specific Thinking Axis')+'\n\n';
factoryMd+='**'+(G?'現在のドメイン':'Current Domain')+'**: '+domain+'\n';
factoryMd+='**'+(G?'中心的な問い':'Central Question')+'**: **'+axis+'**\n\n';
factoryMd+=G?'すべてのスキルは、この思考軸に沿った判断を行うべきです。\n\n':'All skills should make judgments aligned with this thinking axis.\n\n';
factoryMd+=(G?'## スキル定義フォーマット':'## Skill Definition Format')+'\n\n```\n';
factoryMd+=(G?'### スキル名: 【具体的な判断内容】':'### Skill Name: [Specific Judgment]')+'\n\n';
factoryMd+='**'+(G?'役割':'Role')+'** (Planning/Design/Production/Operations): '+(G?'該当フェーズを選択':'Select applicable phase')+'\n\n';
factoryMd+='**'+(G?'目的':'Purpose')+'**: '+(G?'このスキルが何を判断するか（1文で）':'What this skill judges (one sentence)')+'\n\n';
factoryMd+='**'+(G?'入力':'Input')+'**:\n- '+(G?'必要なファイル/データ':'Required files/data')+'\n- '+(G?'前提条件':'Prerequisites')+'\n\n';
factoryMd+='**'+(G?'処理':'Processing')+'**:\n1. '+(G?'ステップ1':'Step 1')+'\n2. '+(G?'ステップ2':'Step 2')+'\n3. '+(G?'ステップ3':'Step 3')+'\n\n';
factoryMd+='**'+(G?'判断基準':'Judgment Criteria')+'**: '+(G?'PASS条件（測定可能）':'PASS condition (measurable)')+'\n';
factoryMd+=(G?'- 例: エラー0件, カバレッジ80%+, 応答時間2秒以下':'- Example: 0 errors, coverage ≥80%, response time ≤2s')+'\n\n';
factoryMd+='**'+(G?'出力':'Output')+'**:\n- PASS/'+(G?'FAIL':'FAIL')+'\n- '+(G?'判断理由':'Reason')+'\n- '+(G?'次のアクション':'Next action')+'\n```\n\n';
factoryMd+=(G?'## カスタムスキル作成手順':'## Custom Skill Creation Steps')+'\n\n';
factoryMd+='1. **'+(G?'判断内容を特定':'Identify judgment')+'**\n   - '+(G?'何を判断するか明確にする':'Clarify what to judge')+'\n   - '+(G?'複数の判断がある場合は分割する':'Split if multiple judgments exist')+'\n\n';
factoryMd+='2. **'+(G?'入力を定義':'Define inputs')+'**\n   - '+(G?'必要なドキュメント/ファイルをリスト':'List required documents/files')+'\n   - '+(G?'前提条件を明記':'Specify prerequisites')+'\n\n';
factoryMd+='3. **'+(G?'処理ステップを分解':'Break down processing')+'**\n   - '+(G?'3-5ステップで記述':'Describe in 3-5 steps')+'\n   - '+(G?'各ステップは具体的に':'Each step should be concrete')+'\n\n';
factoryMd+='4. **'+(G?'判断基準を数値化':'Quantify criteria')+'**\n   - '+(G?'測定可能な基準にする':'Make measurable criteria')+'\n   - '+(G?'思考軸に沿っているか確認':'Check alignment with thinking axis')+'\n\n';
factoryMd+='5. **'+(G?'出力を設計':'Design output')+'**\n   - PASS/FAIL + '+(G?'理由':'reason')+'\n   - '+(G?'次のアクション（次のスキル名 or 完了）':'Next action (next skill name or complete)')+'\n\n';
factoryMd+=(G?'## サンプルスキル':'## Sample Skill')+'\n\n```\n';
factoryMd+=(G?'### スキル名: データベース設計検証':'### Skill Name: Database Design Validation')+'\n\n';
factoryMd+='**'+(G?'役割':'Role')+'**: Design\n\n';
factoryMd+='**'+(G?'目的':'Purpose')+'**: '+(G?'ER図とentitiesが一致し、FK参照が正しいか判断':'Judge if ER diagram matches entities and FK references are correct')+'\n\n';
factoryMd+='**'+(G?'入力':'Input')+'**:\n- docs/04_er_diagram.md\n- .spec/technical-plan.md (entities)\n\n';
factoryMd+='**'+(G?'処理':'Processing')+'**:\n1. '+(G?'ER図から全エンティティ抽出':'Extract all entities from ER diagram')+'\n2. '+(G?'technical-planのentitiesリストと照合':'Compare with entities list in technical-plan')+'\n3. '+(G?'FK参照先が全て存在するか確認':'Verify all FK references exist')+'\n\n';
factoryMd+='**'+(G?'判断基準':'Judgment Criteria')+'**: '+(G?'不一致0件 AND FK未定義0件':'0 mismatches AND 0 undefined FKs')+'\n\n';
factoryMd+='**'+(G?'出力':'Output')+'**:\n- PASS/'+(G?'FAIL':'FAIL')+'\n- '+(G?'不一致リスト（あれば）':'Mismatch list (if any)')+'\n- '+(G?'次: API設計検証':'Next: API Design Validation')+'\n```\n\n';
factoryMd+=(G?'## ドメイン別スキル例':'## Domain-Specific Skill Examples')+'\n\n';
if(domainSkills.length>0){
factoryMd+=(G?'現在のドメイン（':'Current domain (')+domain+(G?'）の登録済みスキル:':') registered skills:')+'\n';
domainSkills.forEach((sk,i)=>{
const[r,nJa,nEn,pJa,pEn,jJa,jEn]=sk.split(':');
factoryMd+=(i+1)+'. **'+(G?nJa:nEn)+'** - '+(G?jJa:jEn)+'\n';
});
}else{
factoryMd+=G?'（このドメインはまだスキルが登録されていません。上記フォーマットで作成してください）':'(No skills registered for this domain yet. Create using the format above)';
}
factoryMd+='\n';
S.files['skills/factory.md']=factoryMd;
// ═══ C2: md Package Distribution (~10KB, ai_auto=multi/full/orch only) ═══
const isMultiOrAbove=aiLevel==='multi'||aiLevel==='full'||aiLevel==='orch';
if(isMultiOrAbove){
// skills/README.md - Package overview
let skillsReadme='# '+pn+' Skills Package\n\n';
skillsReadme+=G?'**世界唯一のAI Development OS**: このパッケージは、AIエージェントが自律的に開発を進めるための完全なスキル体系です。\n\n':'**World\'s First AI Development OS**: This package is a complete skill system for AI agents to autonomously develop software.\n\n';
skillsReadme+=(G?'## クイックスタート':'## Quick Start')+'\n\n';
skillsReadme+='1. **'+(G?'全体像を把握':'Understand overview')+'**: `skills/skill_map.md` '+(G?'でスキル依存関係を確認':'for skill dependency map')+'\n';
skillsReadme+='2. **'+(G?'詳細を確認':'Check details')+'**: `skills/catalog.md` '+(G?'で全スキル詳細を確認':'for all skill details')+'\n';
skillsReadme+='3. **'+(G?'パイプライン実行':'Execute pipeline')+'**: `skills/pipelines.md` '+(G?'で自動化フロー確認':'for automation flows')+'\n';
skillsReadme+='4. **'+(G?'カスタムスキル作成':'Create custom skills')+'**: `skills/factory.md` '+(G?'のテンプレート使用':'using template')+'\n\n';
skillsReadme+=(G?'## ファイル構成':'## File Structure')+'\n\n';
skillsReadme+='```\n';
skillsReadme+='skills/\n';
skillsReadme+='├── README.md          # '+(G?'このファイル':'This file')+'\n';
skillsReadme+='├── skill_map.md       # '+(G?'依存関係マップ':'Dependency map')+'\n';
skillsReadme+='├── catalog.md         # '+(G?'全スキルカタログ':'Full catalog')+'\n';
skillsReadme+='├── pipelines.md       # '+(G?'自動化パイプライン':'Automation pipelines')+'\n';
skillsReadme+='├── factory.md         # '+(G?'スキル工場テンプレート':'Skill factory template')+'\n';
skillsReadme+='├── project.md         # '+( G?'プロジェクトスキル':'Project skills')+'\n';
skillsReadme+='└── agents/\n';
skillsReadme+='    ├── coordinator.md # '+(G?'オーケストレーター':'Coordinator agent')+'\n';
skillsReadme+='    └── reviewer.md    # '+(G?'レビューアー':'Reviewer agent')+'\n';
skillsReadme+='```\n\n';
skillsReadme+=(G?'## AI成熟度モデル':'## AI Maturity Model')+'\n\n';
skillsReadme+=(G?'**現在レベル**: '+aiLevel.toUpperCase():'**Current Level**: '+aiLevel.toUpperCase())+'\n\n';
const maturityLevels=[
{level:'Prompt',desc_ja:'個別プロンプト',desc_en:'Individual prompts',current:aiLevel==='vibe'},
{level:'Skill',desc_ja:'スキル単位（1スキル=1判断）',desc_en:'Skill-based (1 skill = 1 judgment)',current:aiLevel==='agentic'},
{level:'Agent',desc_ja:'エージェント単位（複数スキル統合）',desc_en:'Agent-based (multiple skills)',current:aiLevel==='multi'},
{level:'Package',desc_ja:'パッケージ単位（スキル群配布）',desc_en:'Package-based (skill sets)',current:aiLevel==='full'},
{level:'Series',desc_ja:'シリーズ単位（業種別パッケージ群）',desc_en:'Series-based (industry packages)',current:aiLevel==='orch'}
];
maturityLevels.forEach((m,i)=>{
const arrow=m.current?'👉 ':'   ';
const label=G?m.desc_ja:m.desc_en;
skillsReadme+=arrow+(i+1)+'. **'+m.level+'** - '+label+(m.current?' ✅':'')+'\n';
});
skillsReadme+='\n';
skillsReadme+=(G?'## 使い方':'## Usage')+'\n\n';
skillsReadme+='### '+(G?'スキル実行':'Execute Skill')+'\n';
skillsReadme+='```javascript\n';
skillsReadme+='// 1. '+(G?'スキルを選択':'Select skill')+'\n';
skillsReadme+='const skill = getSkill(\'spec-review\');\n\n';
skillsReadme+='// 2. '+(G?'入力を準備':'Prepare input')+'\n';
skillsReadme+='const input = {\n';
skillsReadme+='  files: [\'/.spec/constitution.md\', \'.spec/specification.md\'],\n';
skillsReadme+='  context: AI_BRIEF\n';
skillsReadme+='};\n\n';
skillsReadme+='// 3. '+(G?'実行':'Execute')+'\n';
skillsReadme+='const result = await executeSkill(skill, input);\n\n';
skillsReadme+='// 4. '+(G?'判定':'Judge')+'\n';
skillsReadme+='if (result.judgment === \'PASS\') {\n';
skillsReadme+='  // '+(G?'次のスキルへ':'Proceed to next skill')+'\n';
skillsReadme+='} else {\n';
skillsReadme+='  // '+(G?'修正して再実行':'Fix and re-execute')+'\n';
skillsReadme+='}\n';
skillsReadme+='```\n\n';
S.files['skills/README.md']=skillsReadme;
// skills/skill_map.md - Dependency map with 4-layer business model
let skillMapMd='# '+pn+' Skill Map\n\n';
skillMapMd+=G?'**スキル依存関係マップ**: すべてのスキルの依存関係と4層ビジネスモデルを可視化します。\n\n':'**Skill Dependency Map**: Visualizes all skill dependencies and 4-layer business model.\n\n';
skillMapMd+=(G?'## 4層ビジネスモデル':'## 4-Layer Business Model')+'\n\n';
skillMapMd+='```mermaid\ngraph TB\n';
skillMapMd+='  subgraph P['+(G?'企画':'Planning')+']\n';
skillMapMd+='    P1['+( G?'要件レビュー':'Req Review')+']\n';
skillMapMd+='  end\n';
skillMapMd+='  subgraph D['+(G?'設計':'Design')+']\n';
skillMapMd+='    D1['+(G?'設計検証':'Arch Review')+']\n';
skillMapMd+='    D2['+(G?'API設計':'API Design')+']\n';
skillMapMd+='  end\n';
skillMapMd+='  subgraph C['+(G?'制作':'Production')+']\n';
skillMapMd+='    C1['+(G?'実装支援':'Code Support')+']\n';
skillMapMd+='    C2['+(G?'テスト生成':'Test Gen')+']\n';
skillMapMd+='  end\n';
skillMapMd+='  subgraph O['+(G?'運用':'Operations')+']\n';
skillMapMd+='    O1['+(G?'デプロイ検証':'Deploy Check')+']\n';
skillMapMd+='    O2['+(G?'ドキュメント生成':'Doc Gen')+']\n';
skillMapMd+='  end\n\n';
skillMapMd+='  P1 --> D1\n';
skillMapMd+='  D1 --> D2\n';
skillMapMd+='  D2 --> C1\n';
skillMapMd+='  C1 --> C2\n';
skillMapMd+='  C2 --> O1\n';
skillMapMd+='  O1 --> O2\n';
skillMapMd+='  O2 -.->|'+(G?'振り返り':'Retrospective')+'| P1\n';
skillMapMd+='```\n\n';
skillMapMd+=(G?'## スキル一覧':'## Skill List')+'\n\n';
skillMapMd+='| '+(G?'スキルID':'Skill ID')+' | '+(G?'役割':'Role')+' | '+(G?'依存':'Depends On')+' | '+(G?'次':'Next')+' |\n';
skillMapMd+='|----------|------|------|------|\n';
skillMapMd+='| spec-review | Planning | - | arch-review |\n';
skillMapMd+='| arch-review | Design | spec-review | api-design |\n';
skillMapMd+='| api-design | Design | arch-review | code-gen |\n';
skillMapMd+='| code-gen | Production | api-design | test-gen |\n';
skillMapMd+='| test-gen | Production | code-gen | deploy-check |\n';
skillMapMd+='| deploy-check | Operations | test-gen | doc-gen |\n';
skillMapMd+='| doc-gen | Operations | deploy-check | - |\n\n';
skillMapMd+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
skillMapMd+='- **skills/catalog.md** — '+(G?'全スキル詳細':'All skill details')+'\n';
skillMapMd+='- **skills/pipelines.md** — '+(G?'実行フロー':'Execution flows')+'\n';
skillMapMd+='- **skills/factory.md** — '+(G?'カスタムスキル作成':'Custom skill creation')+'\n\n';
S.files['skills/skill_map.md']=skillMapMd;
// skills/agents/coordinator.md - Orchestrator agent definition
let coordMd='# Coordinator Agent\n\n';
coordMd+=G?'**役割**: 複数エージェントの統括・タスク配分・進捗管理\n\n':'**Role**: Orchestrate multiple agents, task allocation, progress management\n\n';
coordMd+=(G?'## 責務':'## Responsibilities')+'\n\n';
coordMd+='1. **'+(G?'タスク分解':'Task Decomposition')+'**: '+(G?'大きなタスクを実行可能な単位に分割':'Break large tasks into executable units')+'\n';
coordMd+='2. **'+(G?'エージェント割当':'Agent Assignment')+'**: '+(G?'各タスクに最適なエージェントを割当':'Assign optimal agent to each task')+'\n';
coordMd+='3. **'+(G?'進捗監視':'Progress Monitoring')+'**: docs/24_progress.md '+(G?'を更新':'updates')+'\n';
coordMd+='4. **'+(G?'ブロッカー解消':'Blocker Resolution')+'**: '+(G?'依存関係の問題を検出・解決':'Detect and resolve dependency issues')+'\n\n';
coordMd+=(G?'## 入力':'## Input')+'\n\n';
coordMd+='- .spec/tasks.md '+(G?'— 全タスクリスト':'— All tasks list')+'\n';
coordMd+='- docs/24_progress.md '+(G?'— 現在の進捗':'— Current progress')+'\n';
coordMd+='- AI_BRIEF.md '+(G?'— プロジェクト全体像':'— Project overview')+'\n\n';
coordMd+=(G?'## 判断基準':'## Judgment Criteria')+'\n\n';
coordMd+='- [ ] '+(G?'全タスクが適切に割当済み':'All tasks properly assigned')+'\n';
coordMd+='- [ ] '+(G?'ブロッカー0件':'0 blockers')+'\n';
coordMd+='- [ ] '+(G?'進捗が予定通り':'Progress on track')+'\n\n';
coordMd+=(G?'## 出力':'## Output')+'\n\n';
coordMd+='- '+(G?'更新された.spec/tasks.md':'Updated .spec/tasks.md')+'\n';
coordMd+='- '+(G?'更新されたdocs/24_progress.md':'Updated docs/24_progress.md')+'\n';
coordMd+='- '+(G?'次のフェーズへの移行可否判定':'Go/No-go decision for next phase')+'\n\n';
S.files['skills/agents/coordinator.md']=coordMd;
// skills/agents/reviewer.md - Reviewer agent definition
let reviewerMd='# Reviewer Agent\n\n';
reviewerMd+=G?'**役割**: コード品質・設計整合性・セキュリティの自動レビュー\n\n':'**Role**: Automated review of code quality, design consistency, and security\n\n';
reviewerMd+=(G?'## 責務':'## Responsibilities')+'\n\n';
reviewerMd+='1. **'+(G?'コード品質':'Code Quality')+'**: '+(G?'TypeScript strict準拠、ESLintエラー0':'TypeScript strict, 0 ESLint errors')+'\n';
reviewerMd+='2. **'+(G?'設計整合性':'Design Consistency')+'**: .spec/specification.md '+(G?'との一致':'alignment')+'\n';
reviewerMd+='3. **'+(G?'セキュリティ':'Security')+'**: docs/08_security.md '+(G?'のチェックリスト確認':'checklist verification')+'\n';
reviewerMd+='4. **'+(G?'テストカバレッジ':'Test Coverage')+'**: ≥80%\n\n';
reviewerMd+=(G?'## 入力':'## Input')+'\n\n';
reviewerMd+='- '+(G?'変更されたコードファイル':'Modified code files')+'\n';
reviewerMd+='- .spec/specification.md\n';
reviewerMd+='- docs/32_qa_blueprint.md\n';
reviewerMd+='- docs/37_bug_prevention.md\n\n';
reviewerMd+=(G?'## 判断基準':'## Judgment Criteria')+'\n\n';
reviewerMd+='- [ ] '+(G?'全テスト PASS':'All tests PASS')+'\n';
reviewerMd+='- [ ] '+(G?'カバレッジ ≥80%':'Coverage ≥80%')+'\n';
reviewerMd+='- [ ] '+(G?'セキュリティ違反 0件':'0 security violations')+'\n';
reviewerMd+='- [ ] .spec/'+(G?'整合性確認済':'consistency verified')+'\n\n';
reviewerMd+=(G?'## 出力':'## Output')+'\n\n';
reviewerMd+='- PASS / FAIL\n';
reviewerMd+='- '+(G?'問題リスト（あれば）':'Issue list (if any)')+'\n';
reviewerMd+='- '+(G?'改善提案':'Improvement suggestions')+'\n\n';
S.files['skills/agents/reviewer.md']=reviewerMd;
}
// ═══ Phase 4: AGENTS.md enhancement ═══
S.files['AGENTS.md']+=`\n\n## Pipeline Coordination\n- Pipelines: skills/pipelines.md\n- Catalog: skills/catalog.md\n- Gates: ${aiLevel==='vibe'||aiLevel==='agentic'?'human':'auto'}\n- Error: docs/25 → retry → escalate\n- Context: AI_BRIEF.md only\n`;
}
}
// ═══ Phase 4: Helper Functions for CLAUDE.md 3-Layer Split ═══
function genThinCLAUDE(a,pn,auth,forbidden,G,arch,domainRisksMd){
const fe=a.frontend||'React';
const be=a.backend||'Node.js + Express';
const db=a.database||'PostgreSQL';
const archNote=G?{
baas:'BaaS統合パターン',
bff:'BFF パターン',
split:'フロント/バック分離',
traditional:'従来型'
}[arch.pattern]:{
baas:'BaaS Integration',
bff:'BFF Pattern',
split:'FE/BE Split',
traditional:'Traditional'
}[arch.pattern];
const devMethods=a.dev_methods||'TDD';
return `# ${pn} ${G?'— 開発ルール':'— Development Rules'}
## ${G?'概要':'Overview'}
- **${G?'スタック':'Stack'}**: ${fe} + ${be} + ${db}
- **${G?'アーキテクチャ':'Architecture'}**: ${archNote}
- **${G?'認証':'Auth'} SoT**: ${auth.sot}
- **${G?'開発手法':'Methods'}**: ${devMethods}
## ${G?'必須ルール':'Critical Rules'}
### ${G?'禁止事項':'Forbidden'}
${forbidden}
${domainRisksMd}
### ${G?'認証の唯一の情報源':'Auth Source of Truth'}
${G?`すべての認証状態は ${auth.sot} から取得すること。認証ロジックを重複させない。`:`All auth state MUST come from ${auth.sot}. Never duplicate auth logic.`}
## ${G?'ルールファイル':'Rule Files'}
${G?'パス別の詳細ルールは以下を参照:':'For path-specific detailed rules, see:'}
- \`.claude/rules/spec.md\` ${G?'— 仕様駆動開発ルール':'— Spec-driven development'}
- \`.claude/rules/frontend.md\` ${G?'— フロントエンド開発ルール':'— Frontend development'}
- \`.claude/rules/backend.md\` ${G?'— バックエンド開発ルール':'— Backend development'}
- \`.claude/rules/test.md\` ${G?'— テスト手法ルール':'— Testing methodology'}
- \`.claude/rules/ops.md\` ${G?'— 運用・デプロイルール':'— Operations & deployment'}
${G?'**特定のパスで作業する際**、Claudeは関連するルールファイルを自動読み込みします。':'**When working on specific paths**, Claude will automatically load the relevant rule file.'}
## ${G?'ワークフロー':'Workflow'}
1. **${G?'機能':'Feature'}** → \`.spec/\` ${G?'確認':'check'} → ${G?'実装':'implement'} → ${G?'テスト':'test'} → ${G?'コミット':'commit'}
2. **${G?'バグ':'Bug'}** → ${G?'再現':'reproduce'} → ${G?'修正':'fix'} → ${G?'テスト':'test'} → ${G?'コミット':'commit'}
3. **${G?'常に':'Always'}** → ${G?'コミット前にテスト実行':'Run tests before commit'}
## ${G?'クイックリファレンス':'Quick Reference'}
- ${G?'仕様ディレクトリ':'Spec Dir'}: \`.spec/\`
- ${G?'ドキュメント':'Docs Dir'}: \`docs/\`
- ${G?'テストコマンド':'Test Command'}: \`npm test\`
- ${G?'ビルドコマンド':'Build Command'}: \`npm run build\`
`;
}
function genSpecRules(G,fileSelectionMatrix,domainCtx){
return `---
paths:
- ".spec/**"
alwaysApply: false
---
# ${G?'仕様駆動開発ルール':'Spec-Driven Development Rules'}
## ${G?'ファイル選択マトリクス':'File Selection Matrix'}
| ${G?'タスク種別':'Task Type'} | ${G?'読むファイル':'Read Files'} | ${G?'書くファイル':'Write Files'} |
|-----------|------------|-------------|
| ${G?'機能企画':'Feature Planning'} | constitution, specification | specification, technical-plan |
| ${G?'アーキテクチャ設計':'Architecture Design'} | specification, technical-plan | technical-plan, tasks |
| ${G?'タスク分解':'Task Breakdown'} | specification, technical-plan, tasks | tasks, verification |
| ${G?'実装':'Implementation'} | ${G?'すべての.specファイル':'All .spec files'} | ${G?'(コードファイル、.specは書かない)':'(Code files, not .spec)'} |
| ${G?'検証':'Verification'} | verification | ${G?'verification (ステータス更新)':'verification (update status)'} |
## ${G?'仕様整合性ルール':'Spec Integrity Rules'}
1. **constitution ${G?'は不変':'is immutable'}** — ${G?'初回作成後は編集しない':'Never edit after initial creation'}
2. **specification ${G?'が真実の源':'is source of truth'}** — ${G?'すべての機能をここで最初に定義':'All features defined here first'}
3. **technical-plan ${G?'は specification と一致':'must match specification'}** — ${G?'仕様なしに実装しない':'No implementation without spec'}
4. **tasks ${G?'は specification を参照':'must reference specification'}** — ${G?'すべてのタスクは要件にリンク':'Every task links to requirements'}
5. **verification ${G?'は specification を検証':'validates specification'}** — ${G?'受入基準に対してテスト':'Test against acceptance criteria'}
## ${G?'ワークフロー':'Workflow'}
\`\`\`mermaid
graph LR
A[${G?'機能要求':'Feature Request'}] --> B[${G?'specification更新':'Update specification'}]
B --> C[${G?'technical-plan更新':'Update technical-plan'}]
C --> D[${G?'tasks生成':'Generate tasks'}]
D --> E[${G?'実装':'Implement'}]
E --> F[${G?'verification更新':'Update verification'}]
\`\`\`
## ${G?'タスク別推奨ファイル':'Task-Specific Recommended Files'}
${fileSelectionMatrix}
${domainCtx}
`;
}
function genFrontendRules(fe,G){
const frameworkKey=fe.includes('React')?'react':fe.includes('Vue')?'vue':fe.includes('Svelte')?'svelte':'react';
const rules={
react:{
conventions_ja:['関数コンポーネント + Hooks','Props分割代入','コンポーネントはdefault exportを避ける'],
conventions_en:['Functional components + hooks','Props destructuring','Avoid default exports for components'],
state_ja:'グローバル状態はContext API、ローカルはuseState/useReducer',
state_en:'Context API for global state, useState/useReducer for local',
styling_ja:'CSS ModulesまたはTailwind、インラインスタイル避ける',
styling_en:'CSS Modules or Tailwind, avoid inline styles',
patterns_ja:['再利用ロジックはカスタムフック','エラーハンドリングはError Boundary','遅延ロードはSuspense'],
patterns_en:['Custom hooks for reusable logic','Error boundaries for error handling','Suspense for lazy loading']
},
vue:{
conventions_ja:['Composition API (Vue 3)','script setupシンタックス','単一ファイルコンポーネント'],
conventions_en:['Composition API (Vue 3)','Script setup syntax','Single-file components'],
state_ja:'グローバル状態はPinia、ローカルはreactive()',
state_en:'Pinia for global state, reactive() for local',
styling_ja:'SFC内でscoped styles',
styling_en:'Scoped styles in SFC',
patterns_ja:['再利用ロジックはComposables','深いpropsはprovide/inject','モーダルはTeleport'],
patterns_en:['Composables for reusable logic','Provide/inject for deep prop passing','Teleport for modals']
},
svelte:{
conventions_ja:['リアクティブ宣言','プロップスの型定義','ストアでグローバル状態'],
conventions_en:['Reactive declarations','Type props','Stores for global state'],
state_ja:'グローバル状態はストア、ローカルはlet',
state_en:'Stores for global state, let for local',
styling_ja:'コンポーネント内でscoped styles',
styling_en:'Scoped styles in component',
patterns_ja:['再利用ロジックはアクション','スロットで構成','トランジションAPI'],
patterns_en:['Actions for reusable logic','Slots for composition','Transition API']
}
};
const r=rules[frameworkKey];
return `---
paths:
- "src/components/**"
- "app/**"
- "pages/**"
alwaysApply: false
---
# ${G?'フロントエンド開発ルール':'Frontend Development Rules'} (${fe})
## ${G?'規約':'Conventions'}
${(G?r.conventions_ja:r.conventions_en).map(c=>'- '+c).join('\n')}
## ${G?'状態管理':'State Management'}
${G?r.state_ja:r.state_en}
## ${G?'スタイリング':'Styling'}
${G?r.styling_ja:r.styling_en}
## ${G?'パターン':'Patterns'}
${(G?r.patterns_ja:r.patterns_en).map(p=>'- '+p).join('\n')}
## ${G?'テスト':'Testing'}
- ${G?'ユーティリティのユニットテスト: Vitest':'Unit tests for utilities: Vitest'}
- ${G?'コンポーネントテスト: Testing Library':'Component tests: Testing Library'}
- ${G?'E2Eテスト: Playwright':'E2E tests: Playwright'}
`;
}
function genBackendRules(arch,be,beRaw,G){
// Detect BFF from backend string if arch didn't catch it
const isBFF=arch.pattern==='bff'||beRaw.includes('API Routes')||beRaw.includes('API routes');
if(arch.isBaaS){
return `---
paths:
- "src/lib/**"
- "supabase/**"
- "app/**/actions.ts"
alwaysApply: false
---
# ${G?'バックエンドルール':'Backend Rules'} (BaaS: ${be})
## ${G?'アーキテクチャパターン':'Architecture Pattern'}
- **BaaS ${G?'統合':'Integration'}**: ${G?'別のExpressサーバーなし':'No separate Express server'}
- **Server Actions**: ${G?'Next.js Server Actionsをミューテーションに使用':'Use Next.js Server Actions for mutations'}
- **RLS**: ${G?'すべてのテーブルに行レベルセキュリティポリシー':'Row-Level Security policies for ALL tables'}
- **${G?'認証':'Auth'}**: ${be} ${G?'が認証を処理':'handles authentication'}
## ${G?'データベースルール':'Database Rules'}
1. **${G?'アプリケーションコードに生SQLなし':'No raw SQL in application code'}** — ${be} ${G?'のクライアントメソッド使用':'client methods'}
2. **${G?'OK: マイグレーションのDDL/RLS':'OK: DDL/RLS in migrations'}** — \`supabase/migrations/*.sql\`
3. **${G?'すべてのテーブルにRLS必須':'All tables MUST have RLS'}** — ${G?'有効化してポリシー定義':'Enable and define policies'}
4. **${G?'外部キー必須':'Foreign keys required'}** — ${G?'参照整合性を維持':'Maintain referential integrity'}
## ${G?'セキュリティ':'Security'}
- ${G?'Service roleキーはサーバーサイドのみ':'Service role key ONLY in server-side code'}
- ${G?'Anonキーはクライアントサイド可':'Anon key OK for client-side'}
- ${G?'Service roleをクライアントに公開しない':'Never expose service role to client'}
- ${G?'Server Actionsですべての入力を検証':'Validate all inputs in Server Actions'}
`;
}else if(isBFF){
return `---
paths:
- "app/api/**"
- "src/lib/**"
alwaysApply: false
---
# ${G?'バックエンドルール':'Backend Rules'} (BFF: ${beRaw})
## ${G?'アーキテクチャパターン':'Architecture Pattern'}
- **BFF (Backend For Frontend)**: ${G?'Next.js API Routesを統合':'Next.js API Routes integration'}
- **${G?'別サーバーなし':'No separate server'}**: ${G?'すべてAPI Routesで処理':'Handle all via API Routes'}
- **${G?'ミドルウェア':'Middleware'}**: ${G?'認証・CORS・レート制限':'Auth, CORS, rate limiting'}
## ${G?'データベースルール':'Database Rules'}
1. **ORM ${G?'使用':'use'}**: Prisma ${G?'または':'or'} Drizzle
2. **${G?'型安全':'Type safety'}**: ${G?'DB→TypeScript自動生成':'DB → TypeScript auto-generation'}
3. **${G?'マイグレーション':'Migrations'}**: ${G?'バージョン管理、ロールバック可能':'Versioned, rollbackable'}
## ${G?'セキュリティ':'Security'}
- ${G?'すべてのAPI Routesで入力検証':'Validate inputs in all API Routes'}
- ${G?'環境変数でシークレット管理':'Secrets in environment variables'}
- ${G?'CSRFトークン使用':'Use CSRF tokens'}
- ${G?'レート制限実装':'Implement rate limiting'}
`;
}else{
return `---
paths:
- "src/api/**"
- "src/routes/**"
- "src/controllers/**"
alwaysApply: false
---
# ${G?'バックエンドルール':'Backend Rules'} (${G?'従来型':'Traditional'}: ${beRaw})
## ${G?'アーキテクチャパターン':'Architecture Pattern'}
- **${G?'クライアント-サーバー分離':'Client-Server separation'}**: ${G?'フロントとバックは別ホスト':'FE and BE on separate hosts'}
- **API ${G?'駆動':'driven'}**: RESTful ${G?'または':'or'} GraphQL
- **${G?'認証':'Auth'}**: JWT ${G?'または':'or'} session-based
## ${G?'データベースルール':'Database Rules'}
1. **ORM ${G?'使用':'use'}**: Prisma, Drizzle, ${G?'または':'or'} TypeORM
2. **${G?'生SQLなし':'No raw SQL'}** (${G?'マイグレーションは除く':'except migrations'})
3. **${G?'トランザクション':'Transactions'}**: ${G?'複数テーブル更新時は必須':'Required for multi-table updates'}
4. **${G?'接続プーリング':'Connection pooling'}**: ${G?'本番環境で必須':'Required in production'}
## ${G?'セキュリティ':'Security'}
- CORS ${G?'適切に設定':'properly configured'}
- ${G?'入力検証':'Input validation'} (Zod, Joi)
- ${G?'出力サニタイズ':'Output sanitization'}
- ${G?'レート制限':'Rate limiting'} (express-rate-limit)
- ${G?'ヘルメット使用':'Use Helmet'} (security headers)
`;
}
}
function genTestRules(devMethods,G){
const hasTDD=devMethods.includes('TDD');
const hasBDD=devMethods.includes('BDD');
const hasDDD=devMethods.includes('DDD');
let rules=`---
paths:
- "**/*.test.*"
- "**/*.spec.*"
- "tests/**"
alwaysApply: false
---
# ${G?'テスト手法ルール':'Testing Methodology Rules'}
`;
if(hasTDD){
rules+=`## ${G?'テスト駆動開発 (TDD)':'Test-Driven Development (TDD)'}
1. **Red** → ${G?'失敗するテストを先に書く':'Write failing test first'}
2. **Green** → ${G?'テストを通す最小限のコード':'Write minimal code to pass'}
3. **Refactor** → ${G?'テストをグリーンに保ちながらコード改善':'Improve code while keeping tests green'}
`;
}
rules+=`## ${G?'テスト構造 (AAAパターン)':'Test Structure (AAA Pattern)'}
\`\`\`typescript
describe('Feature', () => {
it('should do something', () => {
// Arrange - ${G?'セットアップ':'Setup'}
const input = 'test';
// Act - ${G?'実行':'Execute'}
const result = doSomething(input);
// Assert - ${G?'検証':'Verify'}
expect(result).toBe('expected');
});
});
\`\`\`
## ${G?'カバレッジ要件':'Coverage Requirements'}
- ${G?'ユニットテスト: ≥80% カバレッジ':'Unit tests: ≥80% coverage'}
- ${G?'統合テスト: 重要パス':'Integration tests: Critical paths'}
- ${G?'E2Eテスト: ユーザージャーニー':'E2E tests: User journeys'}
## ${G?'テスト命名':'Test Naming'}
- ${G?'説明的':'Descriptive'}: \`should [${G?'期待動作':'expected behavior'}] when [${G?'条件':'condition'}]\`
- ${G?'良い例':'Good'}: \`should return 401 when user is not authenticated\`
- ${G?'悪い例':'Bad'}: \`test1\`, \`testAuth\`
`;
return rules;
}
function genOpsRules(G){
return `---
paths:
- ".github/**"
- "docs/34_*"
- "docs/53_*"
- "docs/54_*"
- "docs/55_*"
alwaysApply: false
---
# ${G?'運用・デプロイルール':'Operations & Deployment Rules'}
## ${G?'参照ドキュメント':'Reference Documents'}
- **${G?'Ops Runbook':'Ops Runbook'}**: \`docs/53_ops_runbook.md\` — SLO/SLI, Feature Flags, Observability
- **${G?'Ops Checklist':'Ops Checklist'}**: \`docs/54_ops_checklist.md\` — 12 Ops Capabilities
- **${G?'Ops Plane Design':'Ops Plane Design'}**: \`docs/55_ops_plane_design.md\` — Ops Plane Architecture, Circuit Breaker, Evidence-Based Ops, Dev×Ops Separation
- **${G?'インシデント対応':'Incident Response'}**: \`docs/34_incident_response.md\` — ${G?'オンコール手順':'On-call procedures'}
## ${G?'デプロイ安全性':'Deployment Safety'}
1. **${G?'フックをスキップしない':'Never skip hooks'}** — \`--no-verify\` ${G?'は明示的承認時のみ':'only with explicit approval'}
2. **main ${G?'への強制プッシュ禁止':'force push prohibited'}** — ${G?'本番ブランチ保護':'Protect production branch'}
3. **${G?'ステージングで先にテスト':'Test in staging first'}** — ${G?'ステージング検証後に本番デプロイ':'Production after staging validation'}
4. **${G?'ロールバック計画必須':'Rollback plan required'}** — ${G?'デプロイ前に戻し方を把握':'Know how to revert before deploying'}
## ${G?'Feature Flags':'Feature Flags'} (${G?'docs/53参照':'see docs/53'})
- ${G?'段階的ロールアウトに使用':'Use for gradual rollouts'}
- ${G?'重要機能のキルスイッチ':'Kill switches for critical features'}
- ${G?'CI/CDでフラグ状態をテスト':'Test flag states in CI/CD'}
## ${G?'モニタリング':'Monitoring'} (${G?'docs/53参照':'see docs/53'})
- ${G?'SLO違反でアラート発火':'SLO violations trigger alerts'}
- ${G?'ドメイン別エラー率閾値':'Error rate thresholds by domain'}
- ${G?'デプロイターゲット別Observabilityスタック':'Observability stack per deployment target'}
## ${G?'バックアップ・リカバリ':'Backup & Recovery'} (${G?'docs/53参照':'see docs/53'})
- ${G?'ドメイン別RPO/RTO要件':'RPO/RTO requirements by domain'}
- ${G?'リストア手順を定期的にテスト':'Test restore procedures regularly'}
- ${G?'リカバリRunbookを文書化':'Document recovery runbooks'}
## ${G?'Dev × Ops 責任分離':'Dev × Ops Responsibility Separation'} (${G?'docs/55参照':'see docs/55'})
**Dev Agent ${G?'(このエージェント)':'(This Agent)'}**:
- ${G?'機能実装・テスト・コードレビュー・バグ修正':'Feature implementation, testing, code review, bug fixes'}
- ${G?'編集範囲':'Edit scope'}: \`src/\` ${G?'配下のみ':'only'}
**Ops Agent ${G?'(人間またはOps AI)':'(Human or Ops AI)'}**:
- ${G?'モニタリング・Feature Flag操作・インシデント対応・バックアップ検証':'Monitoring, Feature Flag operations, incident response, backup validation'}
- ${G?'編集範囲':'Edit scope'}: ${G?'全体 (本番環境操作含む)':'All (including production ops)'}
**${G?'共有契約':'Shared Contract'}**:
- \`.spec/constitution.md\` + \`CLAUDE.md\` + \`docs/53-55\` ${G?'を双方が参照':'referenced by both parties'}
**${G?'破壊的操作 (4-eyes 必須)':'Destructive Operations (4-eyes required)'}**:
- \`git reset --hard\`, \`git clean -f\`, \`DROP TABLE\`, \`DELETE\` ${G?'等は承認後のみ実行':'etc. Execute only after approval'}
- ${G?'参照':'Reference'}: \`.claude/settings.json\` \`requireConfirmation\` ${G?'リスト':'list'}
`;
}

function genPillar5_QualityIntelligence(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'_default';
const purpose=a.purpose||'';
const features=(a.mvp_features||'').split(/[,、\n]/).map(s=>s.trim()).filter(Boolean);
const entities=(a.data_entities||'').split(/[,、]\s*/).map(s=>s.trim()).filter(Boolean);
// Infer industry from domain or default to saas
const industryMap={
fintech:'fintech',health:'health',ec:'ec',saas:'saas',community:'social',
education:'education',gamify:'gaming',iot:'iot',booking:'travel',
realestate:'realestate',content:'media',hr:'hr',analytics:'marketing',
marketplace:'ec',business:'saas',legal:'government',portfolio:'media',
tool:'saas',ai:'saas',automation:'saas',event:'travel',collab:'saas',
devtool:'saas',creator:'media',newsletter:'media'
};
const industry=industryMap[domain]||'saas';
const tm=INDUSTRY_TEST_MATRIX[industry]||INDUSTRY_TEST_MATRIX.saas;
// ═══ docs/32_qa_blueprint.md ═══
let doc32='# '+(G?'業種適応型QAブループリント':'Industry-Adaptive QA Blueprint')+'\n\n';
doc32+=G?'**重要**: このドキュメントは、業種特有のQA戦略とリスク評価を提供します。AIエージェントは、テスト計画策定時に必ずこのブループリントを参照してください。\n\n':'**IMPORTANT**: This document provides industry-specific QA strategies and risk assessments. AI agents MUST reference this blueprint when creating test plans.\n\n';
// Industry Overview
doc32+=(G?'## 対象業種':'## Target Industry')+'\n\n';
doc32+='**'+(G?'業種':'Industry')+'**: '+industry+'\n';
doc32+='**'+(G?'ドメイン':'Domain')+'**: '+domain+'\n';
doc32+='**'+(G?'プロジェクト目的':'Project Purpose')+'**: '+purpose+'\n\n';
// Critical Functions
doc32+=(G?'## 重要機能（Critical Functions）':'## Critical Functions')+'\n\n';
doc32+=G?'この業種で最も重要視すべき機能:\n\n':'Most critical functions for this industry:\n\n';
const critFuncs=G?tm.critical_functions_ja:tm.critical_functions_en;
critFuncs.forEach((cf,i)=>{
doc32+=(i+1)+'. **'+cf+'**\n';
});
doc32+='\n';
// Test Focus Areas
doc32+=(G?'## テスト重点領域':'## Test Focus Areas')+'\n\n';
const testFocus=G?tm.test_focus_ja:tm.test_focus_en;
testFocus.forEach((tf,i)=>{
doc32+='### '+(i+1)+'. '+tf+'\n\n';
// Add test details based on focus area
if(i===0){
doc32+=G?'- テストケース: 正常系・異常系・境界値\n- カバレッジ目標: 80%+\n- 自動化: 必須\n\n':'- Test cases: Normal, error, boundary\n- Coverage target: 80%+\n- Automation: Required\n\n';
}else if(i===1){
doc32+=G?'- 静的解析ツール使用\n- コードレビュー必須\n- OWASP Top 10準拠\n\n':'- Use static analysis tools\n- Code review required\n- OWASP Top 10 compliance\n\n';
}else if(i===2){
doc32+=G?'- 負荷テスト実施\n- レスポンスタイム測定\n- リソース監視\n\n':'- Conduct load testing\n- Measure response time\n- Monitor resources\n\n';
}else{
doc32+=G?'- 実機テスト推奨\n- ユーザビリティ評価\n- アクセシビリティチェック\n\n':'- Real device testing recommended\n- Usability evaluation\n- Accessibility check\n\n';
}
});
// Risk Priority Matrix
doc32+=(G?'## リスク優先度マトリクス':'## Risk Priority Matrix')+'\n\n';
const priObj={};
tm.priority.split('|').forEach(p=>{
const[k,v]=p.split(':');
priObj[k]=v;
});
doc32+='| '+(G?'カテゴリ':'Category')+' | '+(G?'優先度':'Priority')+' | '+(G?'対策':'Mitigation')+' |\n';
doc32+='|----------|----------|----------|\n';
const catMap={
Security:G?'セキュリティ':'Security',
Performance:G?'パフォーマンス':'Performance',
DataIntegrity:G?'データ整合性':'Data Integrity',
UX:'UX',
Compliance:G?'コンプライアンス':'Compliance'
};
Object.entries(catMap).forEach(([key,label])=>{
const priority=priObj[key]||'MED';
const mitigation=priority==='HIGH'||priority==='CRITICAL'?(G?'専門家レビュー・自動化テスト':'Expert review, automated tests'):(G?'定期チェック':'Regular checks');
doc32+='| '+label+' | '+priority+' | '+mitigation+' |\n';
});
doc32+='\n';
// Typical Bugs & Prevention
doc32+=(G?'## 典型的バグパターン':'## Typical Bug Patterns')+'\n\n';
const typicalBugs=G?tm.typical_bugs_ja:tm.typical_bugs_en;
typicalBugs.forEach((bug,i)=>{
doc32+='### '+(i+1)+'. '+bug+'\n\n';
doc32+='**'+(G?'検出方法':'Detection')+'**: ';
if(i===0){
doc32+=G?'単体テスト・統合テスト\n':'Unit tests, integration tests\n';
}else if(i===1){
doc32+=G?'E2Eテスト・手動テスト\n':'E2E tests, manual tests\n';
}else if(i===2){
doc32+=G?'コードレビュー・静的解析\n':'Code review, static analysis\n';
}else{
doc32+=G?'ログ監視・アラート\n':'Log monitoring, alerts\n';
}
doc32+='**'+(G?'予防策':'Prevention')+'**: ';
if(i===0){
doc32+=G?'設計段階でのレビュー、早期プロトタイプ検証\n':'Design review, early prototype validation\n';
}else if(i===1){
doc32+=G?'ペアプログラミング、TDD実践\n':'Pair programming, TDD practice\n';
}else{
doc32+=G?'チェックリスト使用、自動化\n':'Use checklists, automation\n';
}
doc32+='\n';
});
// Recommended Tools
doc32+=(G?'## 推奨テストツール':'## Recommended Testing Tools')+'\n\n';
const tools=G?tm.tools_ja:tm.tools_en;
tools.forEach((tool,i)=>{
const[name,type]=tool.split(/[（(]/);
const cleanType=(type||'').replace(/[）)]/g,'');
doc32+=(i+1)+'. **'+name.trim()+'**';
if(cleanType){
doc32+=' - '+cleanType;
}
doc32+='\n';
});
doc32+='\n';
// Risk Heatmap
doc32+=(G?'## リスクヒートマップ':'## Risk Heatmap')+'\n\n';
doc32+='```\n';
doc32+=(G?'影響度 ＼ 発生確率  │  低    中    高':'Impact \\ Probability │  Low   Med   High')+'\n';
doc32+='─────────────────┼──────────────────\n';
const highRisk=priObj.Security==='HIGH'||priObj.Security==='CRITICAL'?'🔴':'🟡';
const medRisk=priObj.DataIntegrity==='HIGH'?'🟡':'🟢';
doc32+=(G?'      大          │  🟡    🟡    ':'      High         │  🟡    🟡    ')+highRisk+'\n';
doc32+=(G?'      中          │  🟢    🟡    🟡':'      Med          │  🟢    🟡    🟡')+'\n';
doc32+=(G?'      小          │  🟢    🟢    ':'      Low          │  🟢    🟢    ')+medRisk+'\n';
doc32+='```\n\n';
doc32+=G?'🔴 = 即対応必須 | 🟡 = 計画的対応 | 🟢 = 定期チェック\n\n':'🔴 = Immediate action | 🟡 = Planned action | 🟢 = Regular check\n\n';
// Compliance Checklist
if(priObj.Compliance==='HIGH'||priObj.Compliance==='CRITICAL'){
doc32+=(G?'## コンプライアンスチェックリスト':'## Compliance Checklist')+'\n\n';
const compStd={
fintech:'PCI DSS',health:'HIPAA',education:'FERPA',hr:'GDPR',
legal:'SOX',government:'WCAG 2.1 AA'
}[industry]||'GDPR';
doc32+='**'+(G?'準拠基準':'Standard')+'**: '+compStd+'\n\n';
doc32+='- [ ] '+(G?'データ暗号化（保存時・転送時）':'Data encryption (at rest & in transit)')+'\n';
doc32+='- [ ] '+(G?'アクセスログ記録':'Access log recording')+'\n';
doc32+='- [ ] '+(G?'データ保持期間管理':'Data retention management')+'\n';
doc32+='- [ ] '+(G?'監査証跡完全性':'Audit trail completeness')+'\n';
doc32+='- [ ] '+(G?'インシデント対応手順':'Incident response procedures')+'\n\n';
}

S.files['docs/32_qa_blueprint.md']=doc32;
// ═══ docs/33_test_matrix.md ═══
let doc33='# '+(G?'具体的テストマトリクス':'Concrete Test Matrix')+'\n\n';
doc33+=G?'**重要**: このマトリクスは、実装すべきテストケースの具体例を提供します。AIエージェントは、テスト実装時にこのマトリクスをテンプレートとして使用してください。\n\n':'**IMPORTANT**: This matrix provides concrete test case examples. AI agents MUST use this matrix as a template when implementing tests.\n\n';
// Test Case Template
doc33+=(G?'## テストケーステンプレート':'## Test Case Template')+'\n\n';
doc33+='| '+(G?'機能':'Feature')+' | '+(G?'テストケース':'Test Case')+' | '+(G?'期待結果':'Expected Result')+' | '+(G?'優先度':'Priority')+' |\n';
doc33+='|------|------|------|------|\n';
// Generate test cases for critical functions
critFuncs.slice(0,3).forEach((func,i)=>{
const pri=i===0?'P0':(i===1?'P1':'P2');
// Normal case
doc33+='| '+func+' | '+(G?'正常系: ':'Normal: ')+(G?'有効なデータで実行':'Execute with valid data')+' | '+(G?'成功':'Success')+' (200/201) | '+pri+' |\n';
// Error case
doc33+='| '+func+' | '+(G?'異常系: ':'Error: ')+(G?'不正なデータ':'Invalid data')+' | '+(G?'エラー':'Error')+' (400/422) | '+pri+' |\n';
// Boundary case
if(i===0){
doc33+='| '+func+' | '+(G?'境界値: ':'Boundary: ')+(G?'最大/最小値':'Max/min values')+' | '+(G?'適切に処理':'Handled properly')+' | '+pri+' |\n';
}
});
doc33+='\n';
// Bug Pattern × Detection × Prevention
doc33+=(G?'## バグパターン × 検出方法 × 予防策':'## Bug Pattern × Detection × Prevention')+'\n\n';
doc33+='| '+(G?'バグパターン':'Bug Pattern')+' | '+(G?'検出方法':'Detection Method')+' | '+(G?'予防策':'Prevention')+' |\n';
doc33+='|----------|----------|----------|\n';
typicalBugs.forEach((bug,i)=>{
const detection=i===0?(G?'単体テスト':'Unit tests'):(i===1?(G?'E2Eテスト':'E2E tests'):(i===2?(G?'静的解析':'Static analysis'):(G?'ログ監視':'Log monitoring')));
const prevention=i===0?(G?'設計レビュー':'Design review'):(i===1?'TDD':(i===2?(G?'チェックリスト':'Checklist'):(G?'自動化':'Automation')));
doc33+='| '+bug+' | '+detection+' | '+prevention+' |\n';
});
doc33+='\n';
// Cross-Cutting Concerns Test Cases
doc33+=(G?'## 業界横断テストケース':'## Cross-Cutting Test Cases')+'\n\n';
const crossCutting=Object.values(QA_CROSS_CUTTING).filter(c=>c.domains.includes(domain)||c.domains.includes(industry));
if(crossCutting.length>0){
crossCutting.forEach((cc,i)=>{
const label=G?cc.ja:cc.en;
doc33+='### '+(i+1)+'. '+label+'\n\n';
// Generate sample test case
if(label.includes('同時')||label.includes('Concurrent')){
doc33+='- '+(G?'100人同時アクセステスト':'100 concurrent users test')+'\n';
doc33+='- '+(G?'期待: データ競合0件':'Expected: 0 race conditions')+'\n\n';
}else if(label.includes('冪等')||label.includes('Idempot')){
doc33+='- '+(G?'同一リクエスト2回送信':'Send same request twice')+'\n';
doc33+='- '+(G?'期待: 結果同一、副作用1回のみ':'Expected: Same result, side effect once only')+'\n\n';
}else if(label.includes('スパイク')||label.includes('Spike')){
doc33+='- '+(G?'通常の100倍トラフィック':'100x normal traffic')+'\n';
doc33+='- '+(G?'期待: エラー率5%以下':'Expected: Error rate ≤5%')+'\n\n';
}else if(label.includes('レート')||label.includes('Rate')){
doc33+='- '+(G?'制限超過リクエスト':'Request beyond limit')+'\n';
doc33+='- '+(G?'期待: 429 Too Many Requests':'Expected: 429 Too Many Requests')+'\n\n';
}else{
doc33+='- '+(G?'機能テスト実施':'Functional test')+'\n';
doc33+='- '+(G?'期待: 仕様通り動作':'Expected: Works as specified')+'\n\n';
}
});
}else{
doc33+=G?'（該当する業界横断テストパターンなし）\n\n':'(No applicable cross-cutting patterns)\n\n';
}

// Tool-Specific Test Examples
doc33+=(G?'## ツール別テスト例':'## Tool-Specific Test Examples')+'\n\n';
tools.slice(0,3).forEach((tool,i)=>{
const[name]=tool.split(/[（(]/);
doc33+='### '+name.trim()+'\n\n```javascript\n';
if(name.includes('Jest')||name.includes('Vitest')){
doc33+="describe('"+critFuncs[0]+"', () => {\n";
doc33+="  test('should return success with valid data', async () => {\n";
doc33+="    const result = await "+critFuncs[0].toLowerCase().replace(/\s+/g,'')+"(validData);\n";
doc33+="    expect(result.status).toBe(200);\n";
doc33+="  });\n});\n";
}else if(name.includes('Playwright')||name.includes('Cypress')){
doc33+="test('"+critFuncs[0]+"', async ({ page }) => {\n";
doc33+="  await page.goto('/"+critFuncs[0].toLowerCase().replace(/\s+/g,'-')+"');\n";
doc33+="  await page.click('button[type=\"submit\"]');\n";
doc33+="  await expect(page.locator('.success')).toBeVisible();\n";
doc33+="});\n";
}else{
doc33+="// "+name.trim()+(G?' 使用例':' usage example')+"\n";
doc33+="// "+(G?'設定と実行手順はドキュメント参照':'Refer to documentation for setup and execution')+"\n";
}
doc33+='```\n\n';
});
// Coverage Goals
doc33+=(G?'## カバレッジ目標':'## Coverage Goals')+'\n\n';
doc33+='| '+(G?'カテゴリ':'Category')+' | '+(G?'目標':'Target')+' |\n';
doc33+='|----------|----------|\n';
doc33+='| '+(G?'ライン':'Line')+' | ≥80% |\n';
doc33+='| '+(G?'ブランチ':'Branch')+' | ≥70% |\n';
doc33+='| '+(G?'関数':'Function')+' | ≥85% |\n';
doc33+='| '+(G?'ステートメント':'Statement')+' | ≥80% |\n';
doc33+='\n';
doc33+=G?'**注**: 重要機能（P0）は100%カバレッジを目指す\n\n':'**Note**: Critical functions (P0) should aim for 100% coverage\n\n';
S.files['docs/33_test_matrix.md']=doc33;
// ═══ B1: docs/34_incident_response.md (~10KB) ═══
let doc34='# '+(G?'インシデント対応プレイブック':'Incident Response Playbook')+'\n\n';
doc34+=G?'**重要**: このプレイブックは本番障害発生時の対応手順を定義します。全メンバーは事前にこの手順を理解し、障害発生時は冷静に実行してください。\n\n':'**IMPORTANT**: This playbook defines incident response procedures for production outages. All team members MUST understand these procedures beforehand and execute calmly during incidents.\n\n';
// Severity Classification
doc34+=(G?'## Severity分類':'## Severity Classification')+'\n\n';
doc34+='| Severity | '+(G?'定義':'Definition')+' | '+(G?'対応時間':'Response Time')+' | '+(G?'具体例 ('+domain+')':'Examples ('+domain+')')+' |\n';
doc34+='|----------|------|------|------|\n';
// Domain-specific examples
const s1Ex={
ec:G?'決済処理停止':'Payment processing down',
fintech:G?'残高不整合・取引停止':'Balance inconsistency, trading halt',
health:G?'患者データ消失':'Patient data loss',
education:G?'試験データ消失':'Exam data loss',
saas:G?'全サービス停止':'Complete service outage',
community:G?'個人情報漏洩':'Personal data breach',
booking:G?'予約システム停止':'Booking system down',
marketplace:G?'取引決済停止':'Transaction payment down',
iot:G?'全デバイス接続断':'All devices disconnected',
realestate:G?'契約データ消失':'Contract data loss',
legal:G?'機密情報漏洩':'Confidential data breach',
hr:G?'給与データ漏洩':'Payroll data breach'
}[domain]||(G?'サービス全停止':'Complete service down');
const s2Ex={
ec:G?'カート機能障害':'Cart malfunction',
fintech:G?'一部取引遅延':'Partial transaction delays',
health:G?'予約機能障害':'Appointment feature down',
education:G?'動画再生不可':'Video playback failure',
saas:G?'主要機能停止':'Core feature down',
community:G?'投稿機能停止':'Post feature down',
booking:G?'通知送信失敗':'Notification delivery failure',
iot:G?'一部デバイス障害':'Partial device failures'
}[domain]||(G?'主要機能停止':'Core feature down');
const s3Ex={
ec:G?'検索精度低下':'Search accuracy degraded',
saas:G?'パフォーマンス低下':'Performance degradation',
education:G?'レスポンス遅延':'Response delays'
}[domain]||(G?'性能劣化':'Performance degradation');
const s4Ex=G?'軽微なUI不具合':'Minor UI glitch';
doc34+='| S1 🔴 | '+(G?'サービス停止・データ損失':'Service down, data loss')+' | '+( G?'15分以内':'≤15 min')+' | '+s1Ex+' |\n';
doc34+='| S2 🟠 | '+(G?'主要機能停止':'Core feature down')+' | '+(G?'1時間以内':'≤1 hour')+' | '+s2Ex+' |\n';
doc34+='| S3 🟡 | '+(G?'性能劣化':'Performance degraded')+' | '+(G?'24時間以内':'≤24 hours')+' | '+s3Ex+' |\n';
doc34+='| S4 🟢 | '+(G?'軽微な不具合':'Minor bug')+' | '+(G?'次回リリース':'Next release')+' | '+s4Ex+' |\n\n';
// Runbook Template
doc34+=(G?'## Runbookテンプレート':'## Runbook Template')+'\n\n';
doc34+=(G?'### 1. 検知 (Detection)':'### 1. Detection')+'\n\n';
doc34+='- **'+(G?'アラート':'Alert')+'**: '+(G?'監視ツール（CloudWatch/Datadog/Sentry）からアラート受信':'Receive alert from monitoring tool (CloudWatch/Datadog/Sentry)')+'\n';
doc34+='- **'+(G?'確認':'Verify')+'**: '+(G?'ダッシュボードでメトリクス確認':'Check metrics on dashboard')+'\n';
doc34+='- **'+(G?'影響範囲特定':'Scope')+'**: '+(G?'全ユーザー or 特定機能 or 特定リージョン':'All users / specific feature / specific region')+'\n\n';
doc34+=(G?'### 2. トリアージ (Triage)':'### 2. Triage')+'\n\n';
doc34+='- **Severity'+(G?'判定':'Classification')+'**: '+(G?'上記分類表に基づき判定':'Classify based on table above')+'\n';
doc34+='- **'+(G?'初動':'Initial Action')+'**: S1/S2'+(G?'は即座にインシデントチャネル開設':'→ Open incident channel immediately')+'\n';
doc34+='- **'+(G?'担当者招集':'Assemble Team')+'**: '+(G?'オンコール担当 + バックエンド + インフラ':'On-call + Backend + Infra')+'\n\n';
doc34+=(G?'### 3. 緩和 (Mitigation)':'### 3. Mitigation')+'\n\n';
doc34+='**'+(G?'優先順位':'Priority')+'**: '+(G?'復旧 > 原因究明':'Recovery > Root cause analysis')+'\n\n';
doc34+=(G?'緩和策の例:':'Mitigation examples:')+'\n';
doc34+='- '+(G?'ロールバック: 直近デプロイが原因の場合':'Rollback: If caused by recent deploy')+'\n';
doc34+='- '+(G?'スケールアップ: リソース不足の場合':'Scale up: If resource exhaustion')+'\n';
doc34+='- '+(G?'機能無効化: 特定機能が原因の場合':'Disable feature: If specific feature causes issue')+'\n';
doc34+='- '+(G?'キャッシュクリア: データ不整合の場合':'Clear cache: If data inconsistency')+'\n';
doc34+='- '+(G?'手動データ修正: DB不整合の場合':'Manual data fix: If DB inconsistency')+'\n\n';
doc34+=(G?'### 4. 根本原因分析 (Root Cause Analysis)':'### 4. Root Cause Analysis')+'\n\n';
doc34+=(G?'復旧後に実施:':'After recovery:')+'\n';
doc34+='- **'+(G?'ログ分析':'Log Analysis')+'**: docs/25_error_logs.md'+(G?'に記録':'に記録')+'\n';
doc34+='- **5 Whys**: '+(G?'根本原因まで深掘り':'Dig deep until root cause')+'\n';
doc34+='- **'+(G?'タイムライン作成':'Timeline')+'**: '+(G?'発生→検知→対応→復旧の時系列':'Occurrence → Detection → Response → Recovery')+'\n\n';
doc34+=(G?'### 5. 再発防止 (Prevention)':'### 5. Prevention')+'\n\n';
doc34+='- **'+(G?'修正チケット作成':'Fix Ticket')+'**: .spec/tasks.md'+(G?'に追加':'に追加')+'\n';
doc34+='- **'+(G?'監視追加':'Add Monitoring')+'**: '+(G?'同様の障害を早期検知できるアラート追加':'Add alerts to detect similar issues early')+'\n';
doc34+='- **'+(G?'テスト追加':'Add Tests')+'**: docs/33_test_matrix.md'+(G?'にリグレッションテスト追加':'に追加')+'\n';
doc34+='- **'+(G?'ドキュメント更新':'Update Docs')+'**: '+(G?'本プレイブックに新たな対処法追加':'Add new procedures to this playbook')+'\n\n';
// Escalation Matrix
doc34+=(G?'## エスカレーションマトリクス':'## Escalation Matrix')+'\n\n';
doc34+='| Severity | '+  (G?'初動（分）':'Initial (min)')+' | '+(G?'エスカレーション（分）':'Escalation (min)')+' | '+(G?'通知先':'Notify')+' |\n';
doc34+='|----------|------|------|------|\n';
doc34+='| S1 🔴 | 15 | 30 | '+(G?'CTO + 全エンジニア':'CTO + All engineers')+' |\n';
doc34+='| S2 🟠 | 60 | 120 | '+(G?'テックリード + 該当チーム':'Tech lead + Relevant team')+' |\n';
doc34+='| S3 🟡 | 1440 (24h) | - | '+(G?'担当者のみ':'Assignee only')+' |\n';
doc34+='| S4 🟢 | - | - | '+(G?'次回計画会議で':'Next planning meeting')+' |\n\n';
// Post-Mortem Template
doc34+=(G?'## ポストモーテムテンプレート':'## Post-Mortem Template')+'\n\n';
doc34+='```markdown\n';
doc34+='# '+(G?'ポストモーテム: [障害タイトル]':'Post-Mortem: [Incident Title]')+'\n\n';
doc34+='**'+(G?'発生日時':'Date')+'**: YYYY-MM-DD HH:MM\n';
doc34+='**Severity**: S1/S2/S3/S4\n';
doc34+='**'+(G?'影響':'Impact')+'**: '+(G?'影響を受けたユーザー数・機能':'Affected users, features')+'\n';
doc34+='**'+(G?'検知→復旧時間':'Detection to Recovery')+'**: XX'+(G?'分':'min')+'\n\n';
doc34+='## '+(G?'何が起きたか':'What Happened')+'\n'+(G?'障害の概要を1-2文で':'1-2 sentence summary')+'\n\n';
doc34+='## '+(G?'タイムライン':'Timeline')+'\n';
doc34+='- HH:MM - '+(G?'障害発生':'Incident occurred')+'\n';
doc34+='- HH:MM - '+(G?'アラート検知':'Alert detected')+'\n';
doc34+='- HH:MM - '+(G?'対応開始':'Response started')+'\n';
doc34+='- HH:MM - '+(G?'復旧完了':'Recovery completed')+'\n\n';
doc34+='## '+(G?'根本原因':'Root Cause')+'\n'+(G?'5 Whysの結果':'Result of 5 Whys')+'\n\n';
doc34+='## '+(G?'再発防止策':'Prevention Measures')+'\n';
doc34+='- [ ] '+(G?'アクションアイテム1':'Action item 1')+'\n';
doc34+='- [ ] '+(G?'アクションアイテム2':'Action item 2')+'\n';
doc34+='```\n\n';
// Domain-Specific Runbooks
const domainPlaybook=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
if(domainPlaybook&&domainPlaybook.prevent_ja){
doc34+=(G?'## ドメイン固有の注意事項 ('+domain+')':'## Domain-Specific Notes ('+domain+')')+'\n\n';
const preventList=G?domainPlaybook.prevent_ja:domainPlaybook.prevent_en;
preventList.forEach((p,i)=>{
doc34+=(i+1)+'. '+p+'\n';
});
doc34+='\n';
}

// Link to error logs
doc34+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc34+='- **docs/25_error_logs.md** — '+(G?'過去の障害記録':'Past incident records')+'\n';
doc34+='- **docs/37_bug_prevention.md** — '+(G?'バグ予防チェックリスト':'Bug prevention checklist')+'\n';
doc34+='- **.spec/verification.md** — '+(G?'リリース前検証手順':'Pre-release verification')+'\n\n';
S.files['docs/34_incident_response.md']=doc34;
// ═══ B3: docs/36_test_strategy.md (~12KB) ═══
let doc36='# '+(G?'フェーズ別テスト戦略':'Phase-Based Testing Strategy')+'\n\n';
doc36+=G?'**重要**: このドキュメントは開発フェーズごとのテスト戦略を定義します。各フェーズで必要なテストを実施し、品質を段階的に向上させてください。\n\n':'**IMPORTANT**: This document defines testing strategies for each development phase. Execute required tests at each phase to progressively improve quality.\n\n';
// Phase 1: Design Review
doc36+=(G?'## Phase 1: 設計レビュー':'## Phase 1: Design Review')+'\n\n';
doc36+=(G?'**目的**: 実装前に設計の整合性とセキュリティリスクを検証':'**Purpose**: Verify design consistency and security risks before implementation')+'\n\n';
doc36+='### 1.1 '+(G?'.spec/ 整合性チェック':'.spec/ Consistency Check')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] constitution.md ⇔ specification.md '+(G?'の機能一致':'feature alignment')+'\n';
doc36+='- [ ] specification.md ⇔ technical-plan.md '+(G?'のスタック一致':'stack alignment')+'\n';
doc36+='- [ ] tasks.md '+(G?'の全タスクがspecに対応':'all tasks map to spec')+'\n';
doc36+='- [ ] verification.md '+(G?'の検証項目が全機能をカバー':'verification covers all features')+'\n\n';
doc36+='### 1.2 ER'+(G?'図検証':'Diagram Verification')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] '+(G?'全エンティティがdata_entitiesに存在':'All entities exist in data_entities')+'\n';
doc36+='- [ ] FK'+(G?'参照先が全て定義済み':'references are all defined')+'\n';
doc36+='- [ ] '+(G?'循環参照がない':'No circular references')+'\n';
doc36+='- [ ] '+(G?'孤立エンティティがない':'No orphaned entities')+'\n\n';
doc36+='### 1.3 '+(G?'セキュリティ脅威モデル':'Security Threat Modeling')+'\n\n';
doc36+='**'+(G?'実施内容':'Activities')+'**:\n';
doc36+='- **STRIDE'+(G?'分析':'Analysis')+'**: '+(G?'なりすまし・改ざん・否認・情報漏洩・DoS・権限昇格':'Spoofing, Tampering, Repudiation, Info disclosure, DoS, Elevation')+'\n';
doc36+='- **OWASP Top 10**: docs/08_security.md '+(G?'と照合':'check against')+'\n';
doc36+='- **'+(G?'データフロー図':'Data Flow Diagram')+'**: '+(G?'機密データの経路確認':'Verify sensitive data paths')+'\n\n';
// Phase 2: Integration Testing
doc36+=(G?'## Phase 2: 統合テスト':'## Phase 2: Integration Testing')+'\n\n';
doc36+=(G?'**目的**: API・認証・データフローの統合動作を検証':'**Purpose**: Verify integrated behavior of API, auth, and data flows')+'\n\n';
doc36+='### 2.1 API'+(G?'コントラクトテスト':'Contract Testing')+'\n\n';
doc36+='**'+(G?'ツール':'Tool')+'**: '+( tools.find(t=>t.includes('Pact')||t.includes('契約'))||'Pact / Contract tests')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] '+(G?'全エンドポイントがdocs/05_api_design.mdに存在':'All endpoints exist in docs/05_api_design.md')+'\n';
doc36+='- [ ] '+(G?'リクエスト・レスポンススキーマ一致':'Request/response schema match')+'\n';
doc36+='- [ ] '+(G?'エラーコードが仕様通り':'Error codes match spec')+'\n\n';
const authBackend=a.backend||'';
const authFlow=authBackend.includes('Supabase')?'Supabase Auth':authBackend.includes('Firebase')?'Firebase Auth':'Auth.js';
doc36+='### 2.2 '+(G?'認証フローテスト ('+authFlow+')':'Auth Flow Testing ('+authFlow+')')+'\n\n';
doc36+='**'+(G?'テストケース':'Test Cases')+'**:\n';
doc36+='- [ ] '+(G?'サインアップ → メール確認 → ログイン':'Signup → Email verify → Login')+'\n';
doc36+='- [ ] '+(G?'パスワードリセット':'Password reset')+'\n';
doc36+='- [ ] '+(G?'トークン有効期限切れ → リフレッシュ':'Token expiry → Refresh')+'\n';
if(authBackend.includes('Supabase')){
doc36+='- [ ] RLS'+(G?'ポリシーが全テーブルで動作':'policies work on all tables')+'\n';
}
doc36+='- [ ] '+(G?'不正トークンでアクセス拒否':'Invalid token → Access denied')+'\n\n';
doc36+='### 2.3 '+(G?'データ整合性テスト':'Data Integrity Testing')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] FK'+(G?'違反時にエラー':'violation → Error')+'\n';
doc36+='- [ ] UNIQUE'+(G?'制約違反時にエラー':'constraint violation → Error')+'\n';
doc36+='- [ ] '+(G?'カスケード削除が正しく動作':'Cascade delete works correctly')+'\n';
doc36+='- [ ] '+(G?'トランザクション失敗時にロールバック':'Transaction failure → Rollback')+'\n\n';
// Phase 3: Pre-Release Testing
doc36+=(G?'## Phase 3: リリース前テスト':'## Phase 3: Pre-Release Testing')+'\n\n';
doc36+=(G?'**目的**: 本番環境で発生しうる問題を事前検出':'**Purpose**: Detect issues that could occur in production')+'\n\n';
doc36+='### 3.1 E2E'+(G?'シナリオテスト':'Scenario Testing')+'\n\n';
doc36+='**'+(G?'ツール':'Tool')+'**: '+(tools.find(t=>t.includes('Playwright')||t.includes('Cypress'))||'Playwright / Cypress')+'\n\n';
doc36+='**'+(G?'主要シナリオ':'Critical Scenarios')+'**:\n';
features.slice(0,5).forEach((f,i)=>{
doc36+=(i+1)+'. '+f+' '+(G?'の完全フロー':'complete flow')+'\n';
});
doc36+='\n';
doc36+='### 3.2 '+(G?'並行性テスト':'Concurrency Testing')+'\n\n';
doc36+='**'+(G?'シナリオ':'Scenarios')+'**:\n';
// Domain-specific concurrency scenarios
if(domain==='ec'||domain==='marketplace'){
doc36+='- [ ] '+(G?'最後の1個問題: 2人が同時に最後の在庫を購入':'Last item problem: 2 users buy last stock simultaneously')+'\n';
}
if(domain==='fintech'){
doc36+='- [ ] '+(G?'二重送金: 同一送金リクエストを2回送信':'Double payment: Send same payment request twice')+'\n';
}
if(domain==='booking'||domain==='realestate'){
doc36+='- [ ] '+(G?'ダブルブッキング: 同一時間帯に2件予約':'Double booking: 2 bookings for same time slot')+'\n';
}
doc36+='- [ ] '+(G?'楽観的ロック: バージョン競合時の処理':'Optimistic lock: Version conflict handling')+'\n';
doc36+='- [ ] '+(G?'デッドロック: 複数トランザクション衝突':'Deadlock: Multiple transaction collision')+'\n\n';
doc36+='### 3.3 '+(G?'パフォーマンスベンチマーク':'Performance Benchmarking')+'\n\n';
doc36+='**'+(G?'ツール':'Tool')+'**: k6 / Artillery / Locust\n\n';
doc36+='**'+(G?'ベンチマーク目標':'Benchmark Targets')+'**:\n';
doc36+='- **'+(G?'レスポンスタイム':'Response Time')+'**: P95 ≤ 500ms\n';
doc36+='- **'+(G?'スループット':'Throughput')+'**: ≥ 100 req/sec\n';
doc36+='- **'+(G?'同時接続':'Concurrent Users')+'**: 1000+ '+(G?'ユーザーで安定':'users stable')+'\n';
doc36+='- **'+(G?'エラー率':'Error Rate')+'**: ≤ 0.1%\n\n';
// Phase 4: Post-Release Monitoring
doc36+=(G?'## Phase 4: リリース後監視':'## Phase 4: Post-Release Monitoring')+'\n\n';
doc36+=(G?'**目的**: 本番環境での異常を早期検知':'**Purpose**: Early detection of anomalies in production')+'\n\n';
doc36+='### 4.1 '+(G?'インシデント検知閾値':'Incident Detection Thresholds')+'\n\n';
doc36+='| '+(G?'メトリクス':'Metric')+' | '+(G?'警告':'Warning')+' | '+(G?'重大':'Critical')+' |\n';
doc36+='|----------|----------|----------|\n';
doc36+='| '+(G?'エラー率':'Error Rate')+' | >1% | >5% |\n';
doc36+='| P95 '+(G?'レスポンス':'Response')+' | >1s | >3s |\n';
doc36+='| CPU'+(G?'使用率':'Usage')+' | >70% | >90% |\n';
doc36+='| '+(G?'メモリ':'Memory')+' | >80% | >95% |\n';
doc36+='| DB'+(G?'接続数':'Connections')+' | >80% | >95% |\n\n';
doc36+='### 4.2 '+(G?'回帰アラート':'Regression Alerts')+'\n\n';
doc36+='**'+(G?'監視項目':'Monitor')+'**:\n';
doc36+='- **'+(G?'エラースパイク':'Error Spike')+'**: '+(G?'直近1時間のエラー数が前週平均の3倍':'Errors in last hour >3x weekly average')+'\n';
doc36+='- **'+(G?'レイテンシ劣化':'Latency Degradation')+'**: P95 '+(G?'が前日比1.5倍':'is 1.5x vs yesterday')+'\n';
doc36+='- **'+(G?'コンバージョン低下':'Conversion Drop')+'**: '+(G?'主要KPIが前週比20%低下':'Key KPI down 20% vs last week')+'\n\n';
doc36+='### 4.3 '+(G?'ドメイン別監視 ('+domain+')':'Domain-Specific Monitoring ('+domain+')')+'\n\n';
// Domain-specific monitoring
if(domain==='ec'||domain==='marketplace'){
doc36+='- **'+(G?'決済成功率':'Payment Success Rate')+'**: ≥98%\n';
doc36+='- **'+(G?'カゴ落ち率':'Cart Abandonment')+'**: ≤30%\n';
}else if(domain==='fintech'){
doc36+='- **'+(G?'取引処理時間':'Transaction Processing Time')+'**: ≤2s\n';
doc36+='- **'+(G?'残高不整合':'Balance Inconsistency')+'**: 0 件/日\n';
}else if(domain==='booking'||domain==='realestate'){
doc36+='- **'+(G?'予約重複':'Booking Duplicates')+'**: 0 件/日\n';
doc36+='- **'+(G?'通知到達率':'Notification Delivery')+'**: ≥95%\n';
}else if(domain==='iot'){
doc36+='- **'+(G?'デバイス接続率':'Device Connection Rate')+'**: ≥99%\n';
doc36+='- **'+(G?'データ欠損':'Data Loss')+'**: ≤0.1%\n';
}else{
doc36+='- **'+(G?'主要機能可用性':'Core Feature Availability')+'**: ≥99.9%\n';
doc36+='- **'+(G?'ユーザーエラー報告':'User Error Reports')+'**: '+(G?'月次トレンド監視':'Monitor monthly trend')+'\n';
}
doc36+='\n';
// ── KPI Regression Testing (P5-P10 Feedback Loop) ──
doc36+='### 4.4 '+(G?'KPIリグレッションテスト':'KPI Regression Testing')+'\n\n';
doc36+=(G?'**重要**: docs/29_reverse_engineering.md で定義されたゴールKPIを継続的に監視し、リリース後もゴール達成度を追跡してください。\n\n':'**IMPORTANT**: Continuously monitor goal KPIs defined in docs/29_reverse_engineering.md and track goal achievement post-release.\n\n');
// Access REVERSE_FLOW_MAP if available (loaded from p10-reverse.js)
if(typeof REVERSE_FLOW_MAP!=='undefined'){
const flowMap=REVERSE_FLOW_MAP[domain]||REVERSE_FLOW_MAP._default;
const kpis=G?flowMap.kpi_ja:flowMap.kpi_en;
doc36+='**'+(G?'監視対象KPI':'KPIs to Monitor')+'** ('+(G?'docs/29から':'from docs/29')+'):\n';
kpis.forEach((kpi,i)=>{
doc36+=(i+1)+'. '+kpi+'\n';
});
doc36+='\n';
}else{
// Fallback if REVERSE_FLOW_MAP not available
doc36+='**'+(G?'監視対象KPI':'KPIs to Monitor')+'**: '+(G?'docs/29_reverse_engineering.md 参照':'See docs/29_reverse_engineering.md')+'\n\n';
}

doc36+='**'+(G?'テスト頻度':'Test Frequency')+'**: '+(G?'週次':'Weekly')+'\n';
doc36+='**'+(G?'アラート条件':'Alert Condition')+'**: '+(G?'目標値から20%以上乖離':'Deviation >20% from target')+'\n';
doc36+='**'+(G?'対応フロー':'Response Flow')+'**:\n';
doc36+='1. '+(G?'KPI乖離検出 → docs/25_error_logs.md に記録':'KPI deviation detected → Log in docs/25_error_logs.md')+'\n';
doc36+='2. '+(G?'原因分析 (5 Whys) → 根本原因特定':'Root cause analysis (5 Whys)')+'\n';
doc36+='3. '+(G?'改善施策実施 → docs/30_goal_decomposition.md のギャップマトリクス更新':'Implement improvements → Update gap matrix in docs/30_goal_decomposition.md')+'\n';
doc36+='4. '+(G?'効果測定 → KPI回復確認':'Measure impact → Verify KPI recovery')+'\n\n';
doc36+='**'+(G?'相互参照':'Cross-References')+'**:\n';
doc36+='- **docs/29_reverse_engineering.md** — '+(G?'ゴールKPI定義':'Goal KPI definitions')+'\n';
doc36+='- **docs/30_goal_decomposition.md** — '+(G?'ギャップ分析マトリクス':'Gap analysis matrix')+'\n';
doc36+='- **docs/24_progress.md** — '+(G?'進捗トラッキング':'Progress tracking')+'\n\n';
// Stack-Specific Tool Configuration
doc36+=(G?'## スタック別ツール設定':'## Stack-Specific Tool Configuration')+'\n\n';
const testTool=tools.find(t=>t.includes('Vitest'))?'Vitest':tools.find(t=>t.includes('Jest'))?'Jest':'Vitest';
const e2eTool=tools.find(t=>t.includes('Playwright'))?'Playwright':tools.find(t=>t.includes('Cypress'))?'Cypress':'Playwright';
doc36+='### '+testTool+' '+(G?'設定':'Configuration')+'\n\n';
doc36+='```javascript\n';
doc36+='// vitest.config.js / jest.config.js\n';
doc36+='export default {\n';
doc36+='  coverage: {\n';
doc36+='    provider: \'v8\',\n';
doc36+='    reporter: [\'text\', \'json\', \'html\'],\n';
doc36+='    lines: 80,\n';
doc36+='    functions: 85,\n';
doc36+='    branches: 70,\n';
doc36+='    statements: 80,\n';
doc36+='  },\n';
doc36+='  testTimeout: 10000,\n';
doc36+='};\n```\n\n';
doc36+='### '+e2eTool+' '+(G?'設定':'Configuration')+'\n\n';
doc36+='```javascript\n';
if(e2eTool==='Playwright'){
doc36+='// playwright.config.js\n';
doc36+='export default {\n';
doc36+='  testDir: \'./e2e\',\n';
doc36+='  timeout: 30000,\n';
doc36+='  retries: process.env.CI ? 2 : 0,\n';
doc36+='  use: {\n';
doc36+='    baseURL: process.env.BASE_URL || \'http://localhost:3000\',\n';
doc36+='    trace: \'on-first-retry\',\n';
doc36+='  },\n';
doc36+='};\n';
}else{
doc36+='// cypress.config.js\n';
doc36+='export default {\n';
doc36+='  e2e: {\n';
doc36+='    baseUrl: \'http://localhost:3000\',\n';
doc36+='    video: false,\n';
doc36+='    screenshotOnRunFailure: true,\n';
doc36+='  },\n';
doc36+='};\n';
}
doc36+='```\n\n';
// Related Documents
doc36+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc36+='- **docs/07_test_cases.md** — '+(G?'テストケース詳細':'Detailed test cases')+'\n';
doc36+='- **docs/33_test_matrix.md** — '+(G?'具体的テスト例':'Concrete test examples')+'\n';
doc36+='- **docs/37_bug_prevention.md** — '+(G?'バグ予防チェックリスト':'Bug prevention checklist')+'\n';
doc36+='- **.spec/verification.md** — '+(G?'リリース前検証':'Pre-release verification')+'\n\n';
S.files['docs/36_test_strategy.md']=doc36;
// ═══ B4: docs/37_bug_prevention.md (~8KB) ═══
let doc37='# '+(G?'バグ予防チェックリスト':'Bug Prevention Checklist')+'\n\n';
doc37+=G?'**重要**: このチェックリストは、実装・レビュー・テスト時に必ず確認すべき項目をリスト化しています。見落としを防ぎ、品質を向上させるために活用してください。\n\n':'**IMPORTANT**: This checklist lists items that MUST be verified during implementation, review, and testing. Use this to prevent oversights and improve quality.\n\n';
// Priority-Ordered Checklist (based on INDUSTRY_TEST_MATRIX.priority)
doc37+=(G?'## 優先度順チェックリスト ('+domain+'に最適化)':'## Priority-Ordered Checklist (Optimized for '+domain+')')+'\n\n';
const priorityOrder=['Security','DataIntegrity','Performance','UX','Compliance'];
const domainPriority={};
tm.priority.split('|').forEach(p=>{
const[k,v]=p.split(':');
domainPriority[k]=v;
});
// Sort by priority (CRITICAL > HIGH > MED > LOW)
const sortedPriorities=priorityOrder.sort((a,b)=>{
const order={CRITICAL:0,HIGH:1,MED:2,LOW:3};
return order[domainPriority[a]||'MED']-order[domainPriority[b]||'MED'];
});
sortedPriorities.forEach((cat,idx)=>{
const priority=domainPriority[cat]||'MED';
const icon=priority==='CRITICAL'||priority==='HIGH'?'🔴':(priority==='MED'?'🟡':'🟢');
const label={
Security:G?'セキュリティ':'Security',
DataIntegrity:G?'データ整合性':'Data Integrity',
Performance:G?'パフォーマンス':'Performance',
UX:'UX',
Compliance:G?'コンプライアンス':'Compliance'
}[cat];
doc37+='### '+(idx+1)+'. '+icon+' '+label+' ('+priority+')\n\n';
if(cat==='Security'){
doc37+='- [ ] '+(G?'ユーザー入力は全てサニタイズ済み':'All user inputs sanitized')+'\n';
doc37+='- [ ] SQL'+(G?'インジェクション対策（ORMのパラメタライズドクエリ使用）':'injection prevention (use ORM parameterized queries)')+'\n';
doc37+='- [ ] XSS'+(G?'対策（出力時エスケープ）':'prevention (escape on output)')+'\n';
doc37+='- [ ] CSRF'+(G?'トークン実装':'token implemented')+'\n';
doc37+='- [ ] '+(G?'認証なしでアクセスできるエンドポイントがない':'No unauthenticated endpoint access')+'\n';
doc37+='- [ ] '+(G?'パスワードはハッシュ化（bcrypt/Argon2）':'Passwords hashed (bcrypt/Argon2)')+'\n';
doc37+='- [ ] '+(G?'環境変数に機密情報なし（.envから読込）':'No secrets in code (load from .env)')+'\n';
}else if(cat==='DataIntegrity'){
doc37+='- [ ] FK'+(G?'制約が全て定義済み':'constraints all defined')+'\n';
doc37+='- [ ] UNIQUE'+(G?'制約が適切に設定':'constraints properly set')+'\n';
doc37+='- [ ] NOT NULL'+(G?'制約が必須フィールドに設定':'constraints on required fields')+'\n';
doc37+='- [ ] '+(G?'トランザクション境界が明確':'Transaction boundaries clear')+'\n';
doc37+='- [ ] '+(G?'楽観的/悲観的ロックが必要箇所に実装':'Optimistic/pessimistic locks where needed')+'\n';
doc37+='- [ ] '+(G?'カスケード削除が意図通り':'Cascade deletes work as intended')+'\n';
}else if(cat==='Performance'){
doc37+='- [ ] N+1'+(G?'クエリ問題がない':'query problem eliminated')+'\n';
doc37+='- [ ] '+(G?'インデックスが検索フィールドに設定':'Indexes on search fields')+'\n';
doc37+='- [ ] '+(G?'ページネーション実装（大量データ対応）':'Pagination for large datasets')+'\n';
doc37+='- [ ] '+(G?'キャッシュ戦略が適切':'Caching strategy appropriate')+'\n';
doc37+='- [ ] '+(G?'画像・動画は最適化済み':'Images/videos optimized')+'\n';
}else if(cat==='UX'){
doc37+='- [ ] '+(G?'ローディング状態表示':'Loading state displayed')+'\n';
doc37+='- [ ] '+(G?'エラーメッセージがユーザーフレンドリー':'User-friendly error messages')+'\n';
doc37+='- [ ] '+(G?'バリデーションメッセージが具体的':'Specific validation messages')+'\n';
doc37+='- [ ] '+(G?'空状態メッセージ（データなし時）':'Empty state message (no data)')+'\n';
doc37+='- [ ] '+(G?'モバイルレスポンシブ':'Mobile responsive')+'\n';
}else if(cat==='Compliance'){
doc37+='- [ ] '+(G?'個人情報取扱い同意取得':'Personal data consent obtained')+'\n';
doc37+='- [ ] '+(G?'データ削除機能実装（GDPR対応）':'Data deletion feature (GDPR)')+'\n';
doc37+='- [ ] '+(G?'アクセスログ記録':'Access logging')+'\n';
doc37+='- [ ] '+(G?'監査証跡完全性':'Audit trail completeness')+'\n';
}
doc37+='\n';
});
// 6-Category Bug Classification
doc37+=(G?'## 6カテゴリバグ分類':'## 6-Category Bug Classification')+'\n\n';
const bugCategories=[
{ja:'機能バグ',en:'Functional',check_ja:'仕様通り動作するか',check_en:'Works as specified'},
{ja:'UI/UXバグ',en:'UI/UX',check_ja:'見た目・操作性に問題ないか',check_en:'Appearance and usability OK'},
{ja:'データバグ',en:'Data',check_ja:'データ不整合・消失がないか',check_en:'No data inconsistency or loss'},
{ja:'パフォーマンスバグ',en:'Performance',check_ja:'レスポンス時間が許容範囲か',check_en:'Response time acceptable'},
{ja:'セキュリティバグ',en:'Security',check_ja:'脆弱性がないか',check_en:'No vulnerabilities'},
{ja:'統合バグ',en:'Integration',check_ja:'外部サービス連携が正常か',check_en:'External service integration OK'}
];
bugCategories.forEach((cat,i)=>{
const label=G?cat.ja:cat.en;
const check=G?cat.check_ja:cat.check_en;
doc37+='### '+(i+1)+'. '+label+'\n';
doc37+='**'+(G?'チェック':'Check')+'**: '+check+'\n';
doc37+='**'+(G?'検出方法':'Detection')+'**: ';
if(i<2){
doc37+=G?'単体テスト・E2Eテスト':'Unit tests, E2E tests';
}else if(i<4){
doc37+=G?'統合テスト・手動検証':'Integration tests, manual verification';
}else{
doc37+=G?'静的解析・ペネトレーションテスト':'Static analysis, penetration tests';
}
doc37+='\n';
doc37+='**'+(G?'予防策':'Prevention')+'**: ';
if(i<2){
doc37+=G?'仕様レビュー・プロトタイプ検証':'Spec review, prototype validation';
}else if(i<4){
doc37+=G?'コードレビュー・TDD実践':'Code review, TDD practice';
}else{
doc37+=G?'セキュリティガイドライン遵守':'Follow security guidelines';
}
doc37+='\n\n';
});
// Concurrency Scenarios (Domain-Specific)
doc37+=(G?'## 並行性シナリオ ('+domain+'特化)':'## Concurrency Scenarios ('+domain+'-Specific)')+'\n\n';
if(domain==='ec'||domain==='marketplace'){
doc37+='### 1. '+(G?'最後の1個問題':'Last Item Problem')+'\n';
doc37+='**'+(G?'シナリオ':'Scenario')+'**: '+(G?'在庫1個の商品に2人が同時に購入ボタンをクリック':'2 users click buy on item with stock=1 simultaneously')+'\n';
doc37+='**'+(G?'期待動作':'Expected')+'**: '+(G?'1人は成功、1人は在庫切れエラー':'1 succeeds, 1 gets out-of-stock error')+'\n';
doc37+='**'+(G?'実装方法':'Implementation')+'**: '+(G?'楽観的ロック or SELECT FOR UPDATE':'Optimistic lock or SELECT FOR UPDATE')+'\n\n';
}
if(domain==='fintech'){
doc37+='### 2. '+(G?'二重送金問題':'Double Payment Problem')+'\n';
doc37+='**'+(G?'シナリオ':'Scenario')+'**: '+(G?'同一送金リクエストを短時間に2回送信':'Send same payment request twice in short interval')+'\n';
doc37+='**'+(G?'期待動作':'Expected')+'**: '+(G?'1回のみ実行、2回目は重複エラー':'Execute once, 2nd returns duplicate error')+'\n';
doc37+='**'+(G?'実装方法':'Implementation')+'**: '+(G?'冪等性キー（idempotency key）':'Idempotency key')+'\n\n';
}
if(domain==='booking'||domain==='realestate'){
doc37+='### 3. '+(G?'ダブルブッキング問題':'Double Booking Problem')+'\n';
doc37+='**'+(G?'シナリオ':'Scenario')+'**: '+(G?'同一時間帯に2件の予約が同時に作成される':'2 bookings for same time slot created simultaneously')+'\n';
doc37+='**'+(G?'期待動作':'Expected')+'**: '+(G?'1件は成功、1件は時間帯重複エラー':'1 succeeds, 1 gets time slot conflict error')+'\n';
doc37+='**'+(G?'実装方法':'Implementation')+'**: '+(G?'UNIQUE制約 (service_id, time_slot) + トランザクション':'UNIQUE constraint (service_id, time_slot) + transaction')+'\n\n';
}else{
doc37+='### '+(G?'一般的な並行性問題':'General Concurrency Issues')+'\n';
doc37+='- **'+(G?'データ競合':'Race Condition')+'**: '+(G?'トランザクション分離レベル設定':'Set transaction isolation level')+'\n';
doc37+='- **'+(G?'デッドロック':'Deadlock')+'**: '+(G?'ロック順序を統一':'Unify lock order')+'\n';
doc37+='- **'+(G?'Lost Update':'Lost Update')+'**: '+(G?'楽観的ロックで防止':'Prevent with optimistic lock')+'\n\n';
}

// 7 Common Oversights
doc37+=(G?'## 7つの見落としやすい項目':'## 7 Common Oversights')+'\n\n';
doc37+='### 1. '+(G?'タイムゾーン':'Timezone')+'\n';
doc37+='- [ ] '+(G?'DBにUTC保存、表示時にユーザータイムゾーンで変換':'Store in DB as UTC, convert to user timezone on display')+'\n';
doc37+='- [ ] '+(G?'日時計算はライブラリ使用（date-fns/dayjs）':'Use library for date calculations (date-fns/dayjs)')+'\n\n';
doc37+='### 2. Unicode/Emoji\n';
doc37+='- [ ] VARCHAR'+(G?'サイズは文字数ではなくバイト数で考慮':'size in bytes, not characters')+'\n';
doc37+='- [ ] '+(G?'絵文字対応（utf8mb4）':'Emoji support (utf8mb4)')+'\n\n';
doc37+='### 3. '+(G?'並行変更':'Concurrent Modification')+'\n';
doc37+='- [ ] '+(G?'同一データを2人が同時編集→Last Write Wins問題':'2 users edit same data → Last Write Wins problem')+'\n';
doc37+='- [ ] '+(G?'バージョンカラムで楽観的ロック':'Optimistic lock with version column')+'\n\n';
doc37+='### 4. '+(G?'ファイルアップロード':'File Upload')+'\n';
doc37+='- [ ] '+(G?'ファイルサイズ制限':'File size limit')+'\n';
doc37+='- [ ] '+(G?'MIMEタイプ検証':'MIME type validation')+'\n';
doc37+='- [ ] '+(G?'ファイル名サニタイズ':'Filename sanitization')+'\n';
doc37+='- [ ] '+(G?'ウイルススキャン（本番推奨）':'Virus scan (recommended in prod)')+'\n\n';
doc37+='### 5. '+(G?'レート制限':'Rate Limiting')+'\n';
doc37+='- [ ] API'+(G?'エンドポイントにレート制限実装':'rate limiting on endpoints')+'\n';
doc37+='- [ ] '+(G?'ログイン試行回数制限（ブルートフォース対策）':'Login attempt limit (brute force prevention)')+'\n\n';
doc37+='### 6. '+(G?'メール配信':'Email Delivery')+'\n';
doc37+='- [ ] '+(G?'送信失敗時のリトライ':'Retry on delivery failure')+'\n';
doc37+='- [ ] '+(G?'送信履歴記録':'Record delivery history')+'\n';
doc37+='- [ ] '+(G?'スパム判定されない設定（SPF/DKIM）':'SPF/DKIM to avoid spam')+'\n\n';
doc37+='### 7. '+(G?'ブラウザストレージ':'Browser Storage')+'\n';
doc37+='- [ ] localStorage'+(G?'に機密情報保存しない':'no sensitive data')+'\n';
doc37+='- [ ] '+(G?'容量上限（5-10MB）を考慮':'Consider quota (5-10MB)')+'\n';
doc37+='- [ ] '+(G?'ユーザーが削除できる仕組み':'User can clear data')+'\n\n';
// Related Documents
doc37+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc37+='- **docs/32_qa_blueprint.md** — '+(G?'業種別QA戦略':'Industry-specific QA strategy')+'\n';
doc37+='- **docs/33_test_matrix.md** — '+(G?'具体的テストマトリクス':'Concrete test matrix')+'\n';
doc37+='- **docs/36_test_strategy.md** — '+(G?'フェーズ別テスト戦略':'Phase-based testing strategy')+'\n';
doc37+='- **docs/34_incident_response.md** — '+(G?'インシデント対応':'Incident response')+'\n\n';
S.files['docs/37_bug_prevention.md']=doc37;
}
/* ── Pillar ⑦ Roadmap (9 files) — uses GT (gen-templates.js) — Phase B ── */
function genPillar7_Roadmap(a,pn){
const T=k=>(GT[S.genLang]||GT.en)[k]||GT.en[k]||k;
const level=a.skill_level||'Intermediate';const goal=a.learning_goal||(S.genLang==='ja'?'6ヶ月標準':'6-month standard');
const fe=a.frontend||'React + Next.js';const be=a.backend||'Node.js + Express';
const mob=a.mobile||T('none');const ai=a.ai_auto||T('none');const pay=a.payment||T('none');
const noMob=mob===GT.ja.none||mob===GT.en.none;const noAI=ai===GT.ja.none||ai===GT.en.none;const noPay=pay===GT.ja.none||pay===GT.en.none;
const isB=level.includes('Beginner');const isP=level.includes('Professional');
const _auth=resolveAuth(a);const _arch=resolveArch(a);
const _orm=_arch.isBaaS?(be.includes('Supabase')?'Supabase Client':be.includes('Firebase')?'Firebase SDK':'Convex'):!a.orm||a.orm.includes('Prisma')?'Prisma ORM':a.orm.includes('Drizzle')?'Drizzle ORM':a.orm.includes('TypeORM')?'TypeORM':a.orm.includes('SQLAlchemy')?'SQLAlchemy':a.orm.includes('Kysely')?'Kysely':'Prisma ORM';
const months=goal.includes('3')?3:goal.includes('12')?12:6;
const slug=pn.toLowerCase().replace(/[^a-z0-9]/g,'-');
/* ── 1. LEARNING_PATH.md ── */
const lpath=a.learning_path||'';
S.files['roadmap/LEARNING_PATH.md']=`# ${pn} — ${T('lp_title')}
> ${T('lp_skill')}: ${level} | ${T('lp_target')}: ${goal}${lpath?' | '+T('lp_path')+': '+lpath:''} | Generated by DevForge v9
## Layer 1: ${T('l1')} ${isB?'[Month 1-2]':'[Week 1-2]'}
${isB?`- [ ] ${T('html5b')}\n- [ ] ${T('css3b')}\n- [ ] ${T('jsb')}`:`- [ ] ${T('tsAdv')}\n- [ ] ${T('cssAdv')}`}
## Layer 2: ${T('l2')} [${isB?'Month 3-4':'Month 1-2'}]
- [ ] ${fe} ${T('setup')}
- [ ] Tailwind CSS + shadcn/ui
- [ ] ${T('stMgmt')} (Zustand/Redux)
- [ ] React Query (${T('dataFetch')})
- [ ] ${T('testing')} (Vitest + Playwright)
## Layer 3: ${T('l3')} [${isB?'Month 5-6':'Month 2-3'}]
- [ ] ${be} ${T('setup')}
- [ ] ${T('dbDesign')} + ${_orm}
- [ ] REST API / GraphQL
- [ ] ${T('auth')} (${_auth.sot})
${!noMob?`\n## Layer 3.5: ${T('l3m')} [Month ${isB?7:4}-${isB?8:5}]\n- [ ] ${mob} ${T('mobEnv')}\n- [ ] ${T('mobNav')}\n- [ ] ${T('mobNative')}\n- [ ] ${T('mobStore')}\n`:''}
## Layer 4: DevOps [${isB?'Month '+(noMob?7:9):'Month '+(noMob?4:6)}]
- [ ] Docker + DevContainer
- [ ] GitHub Actions CI/CD
- [ ] ${a.deploy||'Vercel'} ${T('deploy')}
- [ ] ${T('monitor')}
## Layer 5: ${T('l5')} [${isB?'Month '+(noMob?8:10):'Month '+(noMob?5:7)}]
- [ ] ${(a.ai_tools||'Cursor').split(', ')[0]} ${T('aiUse')}
- [ ] ${T('mcpCfg')}
- [ ] ${T('aiOpt')}
${!noAI?`- [ ] ${ai} ${T('practice')}\n`:''}${!noPay?`\n## Layer 6: ${T('l6')} [Month ${months-1}-${months}]\n- [ ] ${pay}\n- [ ] ${T('billing')}\n- [ ] ${T('opsScale')}\n`:''}
## Layer 7: ${T('l7')} [${T('l7span')}]
${(a.dev_methods||'TDD').split(', ').map(m=>'- [ ] '+m+' '+T('practice')).join('\n')}
${a.future_features?`\n## ${T('ff_title')} [${T('ff_span')}]\n${a.future_features.split(', ').map((f,i)=>'- [ ] Phase '+(i<2?2:3)+': '+f+' — '+T('ff_integrate')).join('\n')}\n`:''}`;
/* ── 2. TECH_STACK_GUIDE.md ── */
const feR=fe.includes('Next')?T('nextR'):fe.includes('Vue')?T('vueR'):T('feGenR');
const beR=be.includes('Supabase')?T('supaR'):be.includes('Express')?T('expR'):be.includes('NestJS')?T('nestR'):T('beGenR');
const dbVal=a.database||'PostgreSQL';
const dbR=dbVal.includes('Postgre')?T('pgR'):T('dbGenR');
const dpVal=a.deploy||'Vercel';
const dpR=dpVal.includes('Vercel')?T('vercelR'):T('deployGenR');
S.files['roadmap/TECH_STACK_GUIDE.md']=`# ${pn} — ${T('ts_title')}
> Generated by DevForge v9
## ${T('ts_selected')}
| ${T('cat')} | ${T('tech')} | ${T('rationale')} |
|---------|------|------|
| ${T('feLabel')} | ${fe} | ${feR} |
| ${T('beLabel')} | ${be} | ${beR} |
| ${T('dbLabel')} | ${dbVal} | ${dbR} |
| ${T('deployLabel')} | ${dpVal} | ${dpR} |
${!noMob?`| ${T('mobileLabel')} | ${mob} | ${mob.includes('Expo')?T('expoR'):T('mobGenR')} |\n`:''}${!noPay?`| ${T('payLabel')} | ${pay} | ${T('payR')} |\n`:''}
## ${T('ts_deps')}
\`\`\`
${fe} ←→ ${be} ←→ ${dbVal}
↓           ↓
Tailwind    ${_orm}
↓           ↓
shadcn/ui   ${dpVal}
\`\`\`
## ${T('ts_versions')}
- Node.js: 22 LTS
- React: 19+
- Next.js: 15+
- TypeScript: 5.7+
- ${_orm}: ${_arch.isBaaS?"SDK latest":"6+"}
`;
/* ── 3. MOBILE_GUIDE.md ── */
S.files['roadmap/MOBILE_GUIDE.md']=!noMob?`# ${pn} — ${T('mob_title')}
> ${mob} | Generated by DevForge v9
## ${T('mob_env')}
\`\`\`bash
npx create-expo-app ${slug}-mobile --template blank-typescript
cd ${slug}-mobile
npx expo install expo-router expo-camera expo-notifications
\`\`\`
## ${T('mob_dir')}
\`\`\`
app/
├── (tabs)/
│   ├── index.tsx       # ${T('mob_home')}
│   ├── explore.tsx     # ${T('mob_explore')}
│   └── profile.tsx     # ${T('mob_profile')}
├── _layout.tsx         # ${T('mob_root')}
└── +not-found.tsx      # 404
\`\`\`
## EAS Build${T('mob_eas')}
\`\`\`json
{ "build": { "production": { "distribution": "store" }, "preview": { "distribution": "internal" } } }
\`\`\`
## ${T('mob_libs')}
- NativeWind (Tailwind for RN)
- React Native Reanimated (${T('mob_anim')})
- FlashList (${T('mob_list')})
- Expo Image (${T('mob_img')})
`:`# ${T('mob_title')}\n\n${T('mob_none')}`;
/* ── 4. TOOLS_SETUP.md ── */
const aiTools=(a.ai_tools||'Cursor').split(', ');
const toolLines=aiTools.map(t=>`- **${t}**: ${t==='Cursor'?'https://cursor.sh/':t.includes('Antigravity')?'https://antigravity.google/':t.includes('Claude')?'Claude Code CLI: npm install -g @anthropic-ai/claude-code':t.includes('Aider')?'pip install aider-chat (BYOK)':t.includes('Amazon Q')?T('tool_vsInst')+' / aws.amazon.com/q/developer/':t.includes('Augment')?T('tool_vsInst')+' / augmentcode.com':t.includes('Tabnine')?T('tool_vsInst')+' / tabnine.com':t.includes('OpenRouter')?'https://openrouter.ai/ (API key)':t.includes('Copilot')?T('tool_vsInst'):T('tool_official')}`).join('\n');
S.files['roadmap/TOOLS_SETUP.md']=`# ${pn} — ${T('tool_title')}
> Generated by DevForge v9
## 1. ${T('tool_essential')}
\`\`\`bash
# Node.js (${T('tool_rec')}: v22 LTS)
# https://nodejs.org/
# ${T('tool_pkgmgr')}
npm install -g pnpm
# ${T('tool_init')}
pnpm create next-app ${slug} --typescript --tailwind --eslint
# ${T('tool_docker')}
docker compose up -d
\`\`\`
## 2. ${T('tool_ai')}
${toolLines}
## 3. VS Code ${T('tool_ext')}
- ESLint, Prettier, Tailwind CSS IntelliSense
- ${_arch.isBaaS?(be.includes("Supabase")?"supabase.supabase-vscode":"ms-azuretools.vscode-azurefunctions"):"prisma.prisma"}, GitLens, Error Lens
- GitHub Copilot (${T('tool_used')})
## 4. ${T('tool_env')} (.env.example)
\`\`\`
DATABASE_URL="postgresql://dev:devpass@localhost:5432/${slug.replace(/-/g,'_')}"
NEXTAUTH_SECRET="your-secret-here"
NEXTAUTH_URL="http://localhost:3000"
${pay.includes('Stripe')?'STRIPE_SECRET_KEY="sk_test_..."\nSTRIPE_PUBLISHABLE_KEY="pk_test_..."\nSTRIPE_WEBHOOK_SECRET="whsec_..."':''}
\`\`\`
`;
/* ── 5. RESOURCES.md ── */
S.files['roadmap/RESOURCES.md']=`# ${pn} — ${T('res_title')}
> Generated by DevForge v9
## ${T('res_official')}
${fe.includes('React')?'- [React](https://react.dev/)\n- [Next.js](https://nextjs.org/docs)':''}
${fe.includes('Vue')?'- [Vue 3](https://vuejs.org/)\n- [Nuxt](https://nuxt.com/)':''}
${be.includes('Node')?'- [Node.js](https://nodejs.org/docs/)':''}
${be.includes('Supabase')?'- [Supabase](https://supabase.com/docs)':''}
- [TypeScript](https://www.typescriptlang.org/docs/)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [${_orm}](${_arch.isBaaS?(be.includes("Supabase")?"https://supabase.com/docs":"https://firebase.google.com/docs"):"https://www.prisma.io/docs"})
## ${T('res_ai')}
- [CLAUDE.md ${T('res_bp')}](https://docs.anthropic.com/)
- [Cursor ${T('res_docs')}](https://docs.cursor.com/)
- [MCP ${T('res_proto')}](https://modelcontextprotocol.io/)
${!noAI?`- [Vibe Coding ${T('res_patterns')}](https://vibecoding.dev/)`:''}\
## ${T('res_books')}
- "${T('res_fullstack')}" (${isB?T('res_beg'):T('res_int')})
- "${T('res_tsPractice')}"
- "${(a.dev_methods||'TDD').split(', ')[0]}${T('res_design')}"
${!noPay?`- "${T('res_saas')}"\n- "${T('res_headless')}"`:''}\
`;
/* ── 6. MILESTONES.md ── */
const msLabels=T('ms_m');
S.files['roadmap/MILESTONES.md']=`# ${pn} — ${T('ms_title')}
> ${T('ms_target')}: ${goal} | Generated by DevForge v9
${Array.from({length:months},(_,i)=>`## Month ${i+1}: ${(typeof msLabels==='object'?msLabels:GT.en.ms_m)[Math.min(i,6)]}
- [ ] ${T('ms_criteria')}
- [ ] ${T('ms_review')}
- [ ] ${T('ms_retro')}`).join('\n\n')}
`;
/* ── 7. AI_WORKFLOW.md ── */
S.files['roadmap/AI_WORKFLOW.md']=`# ${pn} — ${T('aiw_title')}
> Generated by DevForge v9
## ${T('aiw_flow')}
\`\`\`
1. ${T('aiw_s1')} → 2. ${T('aiw_s2')} → 3. ${T('aiw_s3')} → 4. ${T('aiw_s4')} → 5. ${T('aiw_s5')} → 6. ${T('aiw_s6')}
\`\`\`
## ${T('aiw_select')}
| ${T('aiw_task')} | ${T('aiw_rec')} | ${T('rationale')} |
|--------|-----------|------|
| ${T('aiw_newfile')} | ${aiTools[0]} | ${T('aiw_ctx')} |
| ${T('aiw_bugfix')} | Claude Code | ${T('aiw_term')} |
| ${T('aiw_testgen')} | GitHub Copilot | ${T('aiw_inline')} |
| ${T('aiw_refactor')} | Cursor | ${T('aiw_multi')} |
## ${T('aiw_mcp')}
1. **context7**: ${T('aiw_mcp1')}
2. **filesystem**: ${T('aiw_mcp2')}
3. **playwright**: ${T('aiw_mcp3')}
## ${T('aiw_prompt')}
### 1. ${T('aiw_addFeature')}
\`\`\`
${T('aiw_promptText')}
\`\`\`
### 2. ${T('aiw_bugfixPrompt')}
\`\`\`
${T('aiw_bugfixText')}
\`\`\`
### 3. ${T('aiw_refactorPrompt')}
\`\`\`
${T('aiw_refactorText')}
\`\`\`
`;
/* ── 8. AI_AUTONOMOUS.md ── */
const aiIsVibe=ai.includes('Vibe');const aiIsMulti=ai.includes('マルチ')||ai.includes('Multi');const aiIsFull=ai.includes('フル')||ai.includes('Full');
S.files['roadmap/AI_AUTONOMOUS.md']=!noAI?`# ${pn} — ${T('aia_title')}
> ${T('aia_level')}: ${ai} | Generated by DevForge v9
## ${T('aia_vibe')}
${T('aia_vibeDesc')}
### ${T('aia_basic')}
1. **${T('aia_f1')}**: ${T('aia_f1ex')}
2. **${T('aia_f2')}**: ${T('aia_f2ex')}
3. **${T('aia_f3')}**: ${T('aia_f3ex')}
4. **${T('aia_f4')}**: ${T('aia_f4ex')}
### ${T('aia_tools')}
${aiIsVibe?`- ${T('aia_vibe1')}\n- ${T('aia_vibe2')}\n- ${T('aia_vibe3')}`:''}
${aiIsMulti?`- ${T('aia_multi1')}\n- ${T('aia_multi2')}\n- ${T('aia_multi3')}`:''}
${aiIsFull?`- ${T('aia_full1')}\n- ${T('aia_full2')}\n- ${T('aia_full3')}\n- ${T('aia_async1')}`:''}
### ${T('aia_bp')}
1. ${T('aia_bp1')}
2. ${T('aia_bp2')}
3. ${T('aia_bp3')}
4. ${T('aia_bp4')}
`:`# ${T('aia_title')}\n\n${T('aia_none')}${aiTools[0]}${T('aia_none2')}`;
/* ── 9. SAAS_COMMERCE_GUIDE.md ── */
S.files['roadmap/SAAS_COMMERCE_GUIDE.md']=!noPay?`# ${pn} — ${T('sc_title')}
> ${T('sc_selected')}: ${pay} | Generated by DevForge v9
## ${T('sc_compare')}
| ${T('sc_platform')} | ${T('sc_rate')} | MoR | ${T('sc_feat')} |
|---------------|------|-----|------|
| Stripe | 2.9%+30¢ | Beta | ${T('sc_stripe')} |
| Paddle | 5%+50¢ | ✅ | ${T('sc_paddle')} |
| Lemon Squeezy (Stripe) | 5%+50¢ | ✅ | ${T('sc_lemon')} |
${pay.includes('Stripe')?`## ${T('sc_impl')}
\`\`\`bash
npm install stripe @stripe/stripe-js
\`\`\`
### Checkout Session
\`\`\`typescript
import Stripe from 'stripe';
const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);
const session = await stripe.checkout.sessions.create({
line_items: [{ price: 'price_xxx', quantity: 1 }],
mode: 'subscription',
success_url: '/success',
cancel_url: '/cancel',
});
\`\`\`
### ${T('sc_webhook')}
\`\`\`typescript
// POST /api/webhooks/stripe
const event = stripe.webhooks.constructEvent(body, sig, secret);
switch(event.type) {
case 'checkout.session.completed': // ${T('sc_paid')}
case 'invoice.paid': // ${T('sc_renew')}
case 'customer.subscription.deleted': // ${T('sc_cancel')}
}
\`\`\`
`:''}${pay.includes('CMS')?`## ${T('sc_cms')} (microCMS)
\`\`\`bash
npm install microcms-js-sdk
\`\`\`
\`\`\`typescript
import { createClient } from 'microcms-js-sdk';
const client = createClient({
serviceDomain: 'your-domain',
apiKey: process.env.MICROCMS_API_KEY!,
});
const data = await client.getList({ endpoint: 'articles' });
\`\`\`
`:''}${pay.includes('EC')?`## ${T('sc_ec')} (Medusa)
\`\`\`bash
npx create-medusa-app@latest
\`\`\`
- ${T('sc_prodMgmt')}: Admin Dashboard
- ${T('sc_payment')}: Stripe Plugin
- ${T('sc_ship')}: ${T('sc_fulfill')}
`:''}
`:`# ${T('sc_title')}\n\n${T('sc_none')}`;
}
// Domain-specific color tokens
const _dc=(p,s,ac,cta,sj,se)=>({p,s,ac,cta,sj,se});
const DOMAIN_COLORS={
education:_dc('#4F46E5','#10B981','#F59E0B','#4F46E5','温かみ・信頼・集中','Warm, trustworthy, focus'),
ec:_dc('#EF4444','#F97316','#FCD34D','#EF4444','緊急感・行動促進・CTA強調','Urgency, action-driven, CTA emphasis'),
fintech:_dc('#1E3A5F','#0EA5E9','#10B981','#0EA5E9','信頼性・プロフェッショナル・安定感','Trust, professional, stability'),
health:_dc('#059669','#3B82F6','#E0F2FE','#3B82F6','清潔・信頼・安心感','Clean, trustworthy, reassuring'),
saas:_dc('#7C3AED','#0EA5E9','#F97316','#7C3AED','革新性・信頼性・エネルギー','Innovative, trustworthy, energetic'),
booking:_dc('#0EA5E9','#10B981','#F59E0B','#0EA5E9','開放感・信頼・緊急感','Open, trustworthy, urgency'),
marketplace:_dc('#F97316','#3B82F6','#10B981','#F97316','活気・信頼・安全','Vibrant, trustworthy, safe'),
community:_dc('#8B5CF6','#EC4899','#F59E0B','#8B5CF6','繋がり・楽しさ・創造性','Connection, fun, creativity'),
content:_dc('#1E293B','#3B82F6','#F59E0B','#3B82F6','可読性・集中・専門性','Readability, focus, expertise'),
iot:_dc('#06B6D4','#10B981','#F59E0B','#06B6D4','テクノロジー・清潔・データ','Technology, clean, data'),
realestate:_dc('#1F2937','#D97706','#10B981','#D97706','高級感・信頼・安定','Premium, trustworthy, stable'),
legal:_dc('#1F2937','#4B5563','#1E40AF','#1E40AF','権威・厳格・信頼','Authority, rigor, trust'),
hr:_dc('#7C3AED','#3B82F6','#10B981','#7C3AED','人間性・成長・調和','Humane, growth, harmony'),
portfolio:_dc('#1E293B','#0EA5E9','#F59E0B','#0EA5E9','シンプル・洗練・個性','Simple, refined, personality'),
_default:_dc('#0EA5E9','#6366F1','#F59E0B','#0EA5E9','汎用・バランス・信頼','General, balanced, trustworthy')
};
// Domain-specific visual strategy (effects, layouts, textures)
const _dvs=(ej,ee,lj,le,tj,te)=>({ej,ee,lj,le,tj,te});
const DOMAIN_VISUAL={
ec:_dvs('CTA振動,カウントダウン,在庫カウンタ','CTA pulse,countdown,stock counter','カード型グリッド,スティッキーカート','Card grid,sticky cart','商品画像ズーム,カルーセル,レビュースター','Product zoom,carousel,review stars'),
education:_dvs('進捗バー,ステップインジケータ,コンフェティ','Progress bar,step indicator,confetti','サイドバー型,ダッシュボードレイアウト','Sidebar,dashboard layout','暖色グラデ,ラウンド角,親しみやすいイラスト','Warm gradients,rounded corners,friendly illustrations'),
fintech:_dvs('数値アニメ,チャートトランジション,ステータスバッジ','Number animation,chart transition,status badge','固定ヘッダー,左ナビゲーション','Fixed header,left navigation','ダークUI,モノスペース数字,グラスモーフィズム','Dark UI,monospace numbers,glassmorphism'),
health:_dvs('カレンダー,タイムラインUI,バイタルグラフ','Calendar,timeline UI,vital graphs','カード型,タブ切替,清潔な余白','Card-based,tab switching,clean whitespace','ソフトシャドウ,グリーン系アクセント,アイコン多用','Soft shadows,green accents,heavy icon use'),
saas:_dvs('オンボーディングステッパー,ツールチップ,トースト','Onboarding stepper,tooltip,toast','フルスクリーンダッシュボード,コマンドパレット','Full dashboard,command palette','ニューモーフィズム,マイクロアニメ,パララックスHero','Neumorphism,micro-animations,parallax hero'),
booking:_dvs('日付ピッカー,可用性マップ,リアルタイム更新','Date picker,availability map,realtime updates','スプリットレイアウト(検索+結果)','Split layout(search+results)','スクロール連動マップ,フェードイン,ホバーエフェクト','Scroll-linked map,fade-in,hover effects'),
_default:_dvs('スクロール連動フェードイン,ホバーエフェクト','Scroll-linked fade-in,hover effects','レスポンシブグリッド,スティッキーヘッダー','Responsive grid,sticky header','パララックス,スムーズスクロール,マイクロアニメ','Parallax,smooth scroll,micro-animations')
};
// Domain-specific sequence flow templates
const _dsf=(nj,ne,steps)=>({nj,ne,steps});
const DOMAIN_SEQ_FLOWS={
ec:_dsf('購入フロー','Purchase Flow',[['U','C','商品をカートに追加','Add to cart'],['C','API','Checkout API呼出','Call Checkout API'],['API','API','在庫確認+ロック','Check stock+lock'],['API','C','注文作成+在庫減算','Create order+deduct stock'],['C','U','注文完了画面','Show confirmation']]),
education:_dsf('受講フロー','Enrollment Flow',[['U','C','コース選択','Select course'],['C','API','受講登録API','Enrollment API'],['API','C','Enrollment作成','Create enrollment'],['U','C','レッスン受講','Start lesson'],['C','API','進捗更新','Update progress'],['API','C','進捗保存+修了判定','Save+check completion']]),
booking:_dsf('予約フロー','Booking Flow',[['U','C','空き枠検索','Search slots'],['C','API','空き確認','Check availability'],['U','C','予約情報入力','Enter booking info'],['C','API','予約確定+枠ロック','Confirm+lock slot'],['API','C','確認メール送信','Send confirmation']]),
health:_dsf('診療予約','Appointment Flow',[['U','C','医師・日時選択','Select doctor+time'],['C','API','空き確認','Check availability'],['U','C','症状入力','Enter symptoms'],['C','API','予約確定','Confirm appointment'],['API','C','リマインド送信','Send reminder']]),
fintech:_dsf('送金フロー','Transfer Flow',[['U','C','送金先・金額入力','Enter recipient+amount'],['C','API','残高確認+凍結','Check balance+hold'],['API','API','KYCチェック','KYC verification'],['API','C','送金実行','Execute transfer'],['API','C','通知送信','Send notification']]),
saas:_dsf('オンボーディング','Onboarding Flow',[['U','C','サインアップ','Sign up'],['C','API','Workspace作成','Create workspace'],['C','U','初期設定ウィザード','Setup wizard'],['U','C','チーム招待','Invite team'],['C','API','メンバー追加+権限設定','Add members+set roles']])
};
function genPillar9_DesignSystem(a,pn){
const G=S.genLang==='ja';
const fe=a.frontend||'React + Next.js';
const be=a.backend||'Node.js + Express';
const auth=resolveAuth(a);
const arch=resolveArch(a);
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
const entities=(a.data_entities||'').split(/[,、]\s*/).map(s=>s.trim()).filter(Boolean);
const screens=(a.screens||'').split(/[,、]/).map(s=>s.trim()).filter(Boolean);
// Domain detection for color and flow customization
const domain=detectDomain(a.purpose)||'_default';
const dc=DOMAIN_COLORS[domain]||DOMAIN_COLORS._default;
// Framework-specific CSS approach
const isTailwind=fe.includes('Next')||fe.includes('Vite')||fe.includes('React');
const isVuetify=fe.includes('Vue');
const isMaterial=fe.includes('Angular');
// Design Tokens
const colorSection=G?'## デザイントークン':'## Design Tokens';
const colorPalette=G?'### カラーパレット':'### Color Palette';
const typography=G?'### タイポグラフィ':'### Typography Scale';
const spacing=G?'### スペーシング':'### Spacing Scale';
const breakpoints=G?'### ブレークポイント':'### Breakpoints';
const components=G?'## コンポーネントカタログ':'## Component Catalog';
const darkMode=G?'## ダーク/ライトモード':'## Dark/Light Mode';
const guidelines=G?'## AI実装ガイドライン':'## AI Implementation Guidelines';
let designDoc='# '+(G?'デザインシステム':'Design System')+'\n\n';
designDoc+=G?'**重要**: AIエージェントは、UI実装時に必ずこのデザインシステムを参照し、一貫性を保ってください。\n\n':'**IMPORTANT**: AI agents MUST reference this design system when implementing UI to maintain consistency.\n\n';
// Color Palette
designDoc+=colorSection+'\n\n'+colorPalette+'\n\n';
if(isTailwind){
designDoc+='```css\n/* Tailwind config (tailwind.config.js) */\ntheme: {\n  extend: {\n    colors: {\n      primary: \''+dc.p+'\',\n      secondary: \''+dc.s+'\',\n      accent: \''+dc.ac+'\',\n      cta: \''+dc.cta+'\',\n      success: \'#10b981\',\n      warning: \'#f59e0b\',\n      error: \'#ef4444\',\n      surface: {\n        light: \'#ffffff\',\n        dark: \'#1e293b\'\n      }\n    }\n  }\n}\n```\n';
}else if(isVuetify){
designDoc+='```js\n// Vuetify theme (vuetify.config.js)\ntheme: {\n  themes: {\n    light: {\n      primary: \''+dc.p+'\',\n      secondary: \''+dc.s+'\',\n      accent: \''+dc.ac+'\'\n    },\n    dark: {\n      primary: \''+dc.cta+'\',\n      secondary: \''+dc.s+'\',\n      accent: \''+dc.ac+'\'\n    }\n  }\n}\n```\n';
}else{
designDoc+='```css\n:root {\n  --color-primary: '+dc.p+';\n  --color-secondary: '+dc.s+';\n  --color-accent: '+dc.ac+';\n  --color-cta: '+dc.cta+';\n  --color-bg: #ffffff;\n  --color-surface: #f8fafc;\n  --color-text: #0f172a;\n  --color-success: #10b981;\n  --color-warning: #f59e0b;\n  --color-error: #ef4444;\n}\n[data-theme="dark"] {\n  --color-bg: #0f172a;\n  --color-surface: #1e293b;\n  --color-text: #f1f5f9;\n}\n```\n';
}
// Color Strategy
designDoc+=(G?'#### カラー戦略\n\n':'#### Color Strategy\n\n');
designDoc+=(G?dc.sj:dc.se)+'\n\n';
// Typography
designDoc+='\n'+typography+'\n\n| '+(G?'要素':'Element')+' | '+(G?'サイズ':'Size')+' | '+(G?'ウェイト':'Weight')+' | '+(G?'行間':'Line Height')+' |\n|------|------|--------|-------------|\n';
designDoc+='| h1 | 36px/2.25rem | 700 | 1.2 |\n| h2 | 30px/1.875rem | 600 | 1.3 |\n| h3 | 24px/1.5rem | 600 | 1.4 |\n| body | 16px/1rem | 400 | 1.5 |\n| small | 14px/0.875rem | 400 | 1.4 |\n| xs | 12px/0.75rem | 400 | 1.3 |\n\n';
// Spacing
designDoc+=spacing+'\n\n| '+(G?'トークン':'Token')+' | '+(G?'値':'Value')+' | '+(G?'用途':'Usage')+' |\n|------|-------|-------|\n';
designDoc+='| xs | 4px | '+(G?'アイコン間隔':'Icon gaps')+'|\n| sm | 8px | '+(G?'コンパクト間隔':'Compact spacing')+'|\n| md | 16px | '+(G?'標準間隔':'Standard spacing')+'|\n| lg | 24px | '+(G?'セクション間':'Section gaps')+'|\n| xl | 32px | '+(G?'カード間':'Card spacing')+'|\n| 2xl | 48px | '+(G?'大セクション間':'Large sections')+'|\n\n';
// Breakpoints
designDoc+=breakpoints+'\n\n```css\n/* Mobile: 0-640px */\n/* Tablet: 641-1024px */\n/* Desktop: 1025-1536px */\n/* Wide: 1537px+ */\n```\n\n';
// Component Catalog
designDoc+=components+'\n\n';
if(screens.length>0){
screens.forEach(scr=>{
const comps=getScreenComponents(scr,G);
if(comps){
designDoc+='### '+(G?'画面：':'Screen: ')+scr+'\n';
comps.forEach(c=>designDoc+='- '+c+'\n');
designDoc+='\n';
}
});
}
// Major Component Specifications
designDoc+=(G?'### 主要コンポーネント仕様\n\n':'### Core Component Specifications\n\n');
designDoc+='| '+(G?'コンポーネント':'Component')+' | '+(G?'Props':'Props')+' | '+(G?'バリエーション':'Variants')+' |\n|-------------|-------|------------|\n';
designDoc+='| Button | variant, size, disabled | primary, secondary, outline, ghost |\n';
designDoc+='| Input | type, placeholder, error | text, email, password, number |\n';
designDoc+='| Card | elevated, outlined | default, clickable, media |\n';
designDoc+='| Modal | open, onClose | sm, md, lg, fullscreen |\n';
designDoc+='| Table | data, columns, sortable | default, striped, compact |\n';
designDoc+='| Badge | color, size | success, warning, error, info |\n\n';
// Enterprise Component Specifications (conditional)
var isEnterprise=/マルチテナント|Multi-tenant|RBAC|承認|approval|admin|multi.*tenant/i.test(
(a.mvp_features||'')+(a.org_model||'')+(a.screens||''));
if(isEnterprise){
designDoc+=(G?'### エンタープライズコンポーネント仕様\n\n':'### Enterprise Component Specifications\n\n');
designDoc+=(G?'| コンポーネント | 主要Props | バリエーション | A11y |\n|------------|---------|------------|------|\n':
'| Component | Key Props | Variants | A11y |\n|-----------|-----------|----------|------|\n');
designDoc+='| StatusBadge | status, size, variant | pending/approved/rejected/active | role="status" aria-label |\n';
designDoc+='| ApprovalBar | request, onApprove, onReject, currentUserRole | pending/approved/rejected | button aria-label, aria-disabled |\n';
designDoc+='| DataTable | data, columns, sortable, filterable, paginated, bulkActions | basic/sortable/paginated | role="table", aria-sort |\n';
designDoc+='| NotificationBell | count, items, onRead | unread/empty | aria-label="N unread", aria-live |\n';
designDoc+='| OrgSwitcher | orgs, current, onChange | single/multi/create | combobox role, aria-expanded |\n';
designDoc+='| OnboardingStepper | steps, current, onComplete | horizontal/vertical/progress | aria-current="step" |\n';
designDoc+='| AuditTimeline | events, filter, maxItems | compact/detailed/filtered | role="feed", time datetime |\n';
designDoc+='| InviteManager | invites, onCreate, onRevoke | list/form/bulk | AlertDialog confirm, aria-live |\n\n';
designDoc+=(G?'> 詳細仕様は `docs/76_enterprise_components.md` を参照。\n\n':
'> See `docs/76_enterprise_components.md` for detailed specifications.\n\n');
}
// Framework Component Mapping
designDoc+=(G?'### コンポーネント対応表\n\n':'### Component Framework Mapping\n\n');
designDoc+='| '+(G?'コンポーネント':'Component')+' | Tailwind (shadcn/ui) | Vuetify | Angular Material |\n|-------------|----------------------|---------|------------------|\n';
designDoc+='| Button | `<Button>` | `<v-btn>` | `<mat-button>` |\n';
designDoc+='| Input | `<Input>` | `<v-text-field>` | `<mat-form-field>` + `<input matInput>` |\n';
designDoc+='| Card | `<Card>` | `<v-card>` | `<mat-card>` |\n';
designDoc+='| Modal/Dialog | `<Dialog>` | `<v-dialog>` | `<mat-dialog>` |\n';
designDoc+='| Table | `<Table>` | `<v-data-table>` | `<mat-table>` |\n';
designDoc+='| Select | `<Select>` | `<v-select>` | `<mat-select>` |\n';
designDoc+='| Checkbox | `<Checkbox>` | `<v-checkbox>` | `<mat-checkbox>` |\n';
designDoc+='| Tabs | `<Tabs>` | `<v-tabs>` | `<mat-tab-group>` |\n\n';
if(isTailwind){
designDoc+=(G?'**推奨**: shadcn/ui または Headless UI をベースに、デザイントークンを適用\n':'**Recommendation**: Use shadcn/ui or Headless UI as base, apply design tokens\n')+'\n';
}else if(isVuetify){
designDoc+=(G?'**推奨**: Vuetify の標準コンポーネントをカスタマイズ\n':'**Recommendation**: Customize Vuetify standard components\n')+'\n';
}else if(isMaterial){
designDoc+=(G?'**推奨**: Angular Material の標準コンポーネントを使用\n':'**Recommendation**: Use Angular Material standard components\n')+'\n';
}
// Motion & Transition
designDoc+=(G?'## モーション & トランジション\n\n':'## Motion & Transitions\n\n');
designDoc+='| '+(G?'トークン':'Token')+' | '+(G?'値':'Value')+' | '+(G?'用途':'Usage')+' |\n|---------|-------|-------|\n';
designDoc+='| duration-fast | 150ms | '+(G?'ホバー、フォーカス':'Hover, focus')+'|\n';
designDoc+='| duration-normal | 250ms | '+(G?'パネル開閉、トグル':'Panel, toggle')+'|\n';
designDoc+='| duration-slow | 400ms | '+(G?'モーダル、ページ遷移':'Modal, page transition')+'|\n';
designDoc+='| easing-default | cubic-bezier(0.4,0,0.2,1) | '+(G?'標準':'Default')+'|\n';
designDoc+='| easing-in | cubic-bezier(0.4,0,1,1) | '+(G?'退出':'Exit')+'|\n';
designDoc+='| easing-out | cubic-bezier(0,0,0.2,1) | '+(G?'進入':'Enter')+'|\n\n';
// Visual Enhancement Dictionary
designDoc+=(G?'## ビジュアルエンハンスメント辞書\n\n':'## Visual Enhancement Dictionary\n\n');
designDoc+=(G?'AIエージェントに以下のキーワードを指示することで、「AI感」を排除した高品質な演出が実装可能です。\n\n':'Use these keywords when instructing AI agents to implement professional-quality effects that eliminate the "AI look".\n\n');
designDoc+='| '+(G?'キーワード':'Keyword')+' | '+(G?'効果':'Effect')+' | CSS/JS |\n|---------|------|--------|\n';
designDoc+='| '+(G?'パララックス':'Parallax')+' | '+(G?'奥行きと躍動感':'Depth and dynamism')+' | `transform: translateZ()`, Intersection Observer |\n';
designDoc+='| '+(G?'ニューモーフィズム':'Neumorphism')+' | '+(G?'触覚的な高級感':'Tactile premium feel')+' | `box-shadow: inset ...`, same-hue bg |\n';
designDoc+='| '+(G?'グラスモーフィズム':'Glassmorphism')+' | '+(G?'透明感と奥行き':'Transparency and depth')+' | `backdrop-filter: blur()`, `bg-opacity` |\n';
designDoc+='| '+(G?'スクロール連動':'Scroll-linked')+' | '+(G?'没入型インタラクション':'Immersive interaction')+' | `IntersectionObserver`, `scroll-behavior` |\n';
designDoc+='| '+(G?'マイクロアニメーション':'Micro-animation')+' | '+(G?'応答性と洗練':'Responsiveness and polish')+' | `transition: 150ms`, `@keyframes` |\n';
designDoc+='| View Transitions | '+(G?'ページ遷移の余韻':'Smooth page transitions')+' | `document.startViewTransition()` |\n\n';
// Domain-specific visual recommendations
const dvs=DOMAIN_VISUAL[domain]||DOMAIN_VISUAL._default;
designDoc+=(G?'### '+pn+' 推奨ビジュアル戦略\n\n':'### '+pn+' Recommended Visual Strategy\n\n');
designDoc+='| '+(G?'カテゴリ':'Category')+' | '+(G?'推奨':'Recommendation')+' |\n|----------|------|\n';
designDoc+='| '+(G?'演出効果':'Effects')+' | '+(G?dvs.ej:dvs.ee)+' |\n';
designDoc+='| '+(G?'レイアウト':'Layout')+' | '+(G?dvs.lj:dvs.le)+' |\n';
designDoc+='| '+(G?'テクスチャ・質感':'Texture')+' | '+(G?dvs.tj:dvs.te)+' |\n\n';
// Design Token Export
designDoc+=(G?'## デザイントークン エクスポート\n\n':'## Design Token Export\n\n');
designDoc+=(G?'以下のJSON形式でトークンを管理することを推奨します：\n\n':'Recommended to manage tokens in JSON format:\n\n');
designDoc+='```json\n{\n  "color": {\n    "primary": "'+dc.p+'",\n    "secondary": "'+dc.s+'",\n    "accent": "'+dc.ac+'",\n    "cta": "'+dc.cta+'",\n    "success": "#10b981",\n    "warning": "#f59e0b",\n    "error": "#ef4444"\n  },\n  "spacing": {\n    "xs": "4px",\n    "sm": "8px",\n    "md": "16px",\n    "lg": "24px",\n    "xl": "32px",\n    "2xl": "48px"\n  },\n  "radius": {\n    "sm": "4px",\n    "md": "8px",\n    "lg": "16px",\n    "full": "9999px"\n  },\n  "shadow": {\n    "sm": "0 1px 2px 0 rgb(0 0 0 / 0.05)",\n    "md": "0 4px 6px -1px rgb(0 0 0 / 0.1)",\n    "lg": "0 10px 15px -3px rgb(0 0 0 / 0.1)"\n  }\n}\n```\n\n';
// Dark/Light Mode
designDoc+=darkMode+'\n\n';
if(isTailwind){
designDoc+='```jsx\n// app/layout.tsx\nimport { ThemeProvider } from "next-themes"\n\nexport default function RootLayout({ children }) {\n  return (\n    <html suppressHydrationWarning>\n      <body>\n        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>\n          {children}\n        </ThemeProvider>\n      </body>\n    </html>\n  )\n}\n```\n\n'+(G?'使用例: `className="bg-white dark:bg-gray-900"`':'Usage: `className="bg-white dark:bg-gray-900"`')+'\n\n';
}else{
designDoc+='```js\n// Toggle theme\nfunction toggleTheme() {\n  document.documentElement.dataset.theme = \n    document.documentElement.dataset.theme === "dark" ? "light" : "dark";\n}\n```\n\n';
}
// AI Guidelines
designDoc+=guidelines+'\n\n';
designDoc+=(G?'### AI Design Protocol（AI感を排除するルール）\n\n':'### AI Design Protocol (Rules to Eliminate AI Look)\n\n');
designDoc+=(G?'1. **トークン参照義務**: すべてのスタイル指定は、定義済みデザイントークン経由で行う。未定義の値を使用しない\n2. **未定義値の禁止**: トークンにない色・余白・サイズは使用禁止（例: `#123456`, `13px`, `font-size: 19px`）\n3. **装飾追加禁止**: 仕様にないシャドウ・グラデーション・アニメーションを追加しない\n4. **レイアウト改変禁止**: 指定されたグリッド構造・フレックスボックス配置を変更しない\n5. **コンポーネント対応表遵守**: フレームワーク標準コンポーネントを使用し、独自実装を避ける\n6. **一貫性検証**: 実装前にデザイントークンとの整合性をチェック\n7. **仕様外の最適化禁止**: 「より良く見せるため」の独自判断による変更は行わない\n\n':'1. **Token Reference Mandatory**: All style specifications must use predefined design tokens. No undefined values.\n2. **Undefined Values Prohibited**: Colors/spacing/sizes not in tokens are forbidden (e.g., `#123456`, `13px`, `font-size: 19px`)\n3. **Decoration Addition Prohibited**: Do not add shadows/gradients/animations not in spec\n4. **Layout Modification Prohibited**: Do not change specified grid structure/flexbox layouts\n5. **Component Mapping Compliance**: Use framework standard components, avoid custom implementations\n6. **Consistency Verification**: Check alignment with design tokens before implementation\n7. **No Unsolicited Optimization**: Do not make changes based on \"making it look better\" judgment\n\n');
designDoc+=(G?'### 基本ルール\n\n':'### Basic Rules\n\n');
designDoc+=(G?'1. **色**: 必ず定義済みトークンを使用。直接カラーコード（#000 等）を記述しない\n2. **スペーシング**: 4px グリッドに従う (xs/sm/md/lg/xl/2xl)\n3. **タイポグラフィ**: 定義されたスケールのみ使用\n4. **コンポーネント**: 推奨ライブラリから選択（独自実装は最小限）\n5. **ダークモード**: すべてのUI要素でLight/Dark対応を実装\n6. **レスポンシブ**: モバイルファースト設計（最小→最大）\n7. **アクセシビリティ**: ARIA属性、キーボードナビゲーション、コントラスト比 4.5:1 以上\n\n':'1. **Colors**: Always use predefined tokens. Never hardcode colors (#000)\n2. **Spacing**: Follow 4px grid (xs/sm/md/lg/xl/2xl)\n3. **Typography**: Use defined scale only\n4. **Components**: Choose from recommended library (minimize custom)\n5. **Dark Mode**: Implement Light/Dark support for all UI elements\n6. **Responsive**: Mobile-first design (min → max)\n7. **Accessibility**: ARIA attributes, keyboard navigation, contrast ratio ≥ 4.5:1\n\n');
designDoc+=(G?'### 禁止アクション\n\n':'### Prohibited Actions\n\n');
designDoc+=(G?'- ❌ トークンにない色を使う（例: `#1a2b3c`）\n- ❌ 独自の余白値（例: `margin: 13px`）\n- ❌ 仕様外のシャドウ追加（例: `box-shadow: 0 8px 16px ...`）\n- ❌ グラデーション追加（例: `background: linear-gradient(...)`）\n- ❌ フォントサイズの独自設定（例: `font-size: 17px`）\n- ❌ コンポーネントライブラリの独自改変\n- ❌ レイアウト構造の変更（例: Grid → Flexbox）\n\n':'- ❌ Using colors not in tokens (e.g., `#1a2b3c`)\n- ❌ Custom spacing values (e.g., `margin: 13px`)\n- ❌ Adding shadows not in spec (e.g., `box-shadow: 0 8px 16px ...`)\n- ❌ Adding gradients (e.g., `background: linear-gradient(...)`)\n- ❌ Custom font sizes (e.g., `font-size: 17px`)\n- ❌ Modifying component library defaults\n- ❌ Changing layout structure (e.g., Grid → Flexbox)\n\n');
// Figma Design Fidelity Protocol
designDoc+=(G?'### デザイン忠実度プロトコル（Figma MCP連携）\n\n':'### Design Fidelity Protocol (Figma MCP Integration)\n\n');
designDoc+=(G?
'**原則: Design as Single Source of Truth（SSOT）**\n\n'+
'AIにUIを「ガチャ」させず、Figmaデザインを確定的に再現する。\n\n'+
'#### ワークフロー\n\n'+
'1. **Figma MCPサーバー有効化**: `Preferences → Enable local MCP server`\n'+
'2. **Selection Link取得**: 対象要素を選択 → `Ctrl+L` でリンクコピー\n'+
'3. **セクション単位実装**: 1セクション=1プロンプトで精度を保つ\n'+
'4. **Live Preview検証**: VS Code Live Serverで即時確認\n'+
'5. **反復改善（Vibe Coding）**: 60点→80点→100点の段階的品質向上\n\n'+
'#### 画像永続化\n\n'+
'- Figma MCPの画像リンクはアプリ終了で無効化される\n'+
'- **対策A**: Figmaからエクスポート → ローカル `/images` に保存 → パス書換え\n'+
'- **対策B**: Unsplash API で永続リンクに差替え\n\n'
:
'**Principle: Design as Single Source of Truth (SSOT)**\n\n'+
'Eliminate "Design Gacha" — reproduce Figma designs deterministically.\n\n'+
'#### Workflow\n\n'+
'1. **Enable Figma MCP server**: `Preferences → Enable local MCP server`\n'+
'2. **Get Selection Link**: Select target element → `Ctrl+L` to copy link\n'+
'3. **Section-by-section implementation**: 1 section = 1 prompt for accuracy\n'+
'4. **Live Preview verification**: VS Code Live Server for instant feedback\n'+
'5. **Iterative refinement (Vibe Coding)**: 60→80→100 point quality improvement\n\n'+
'#### Image Persistence\n\n'+
'- Figma MCP image links invalidate when app closes\n'+
'- **Option A**: Export from Figma → save to local `/images` → rewrite paths\n'+
'- **Option B**: Replace with Unsplash API persistent links\n\n'
);
// Anti-AI Quality Checklist
designDoc+=(G?'### Anti-AI品質チェックリスト\n\n':'### Anti-AI Quality Checklist\n\n');
designDoc+=(G?
'実装完了時に以下を確認し、「AI感」の残存を防止する：\n\n'+
'- [ ] 全色がデザイントークン経由か（ハードコード `#xxx` がないか）\n'+
'- [ ] 余白が4pxグリッドに従っているか（13px, 17px等の中途半端な値がないか）\n'+
'- [ ] アニメーションのイージングが定義済みトークンを使用しているか\n'+
'- [ ] レスポンシブがモバイルファーストで実装されているか\n'+
'- [ ] ダークモード切替で全要素が適切に変化するか\n'+
'- [ ] ホバー/フォーカス状態が全インタラクティブ要素に定義されているか\n'+
'- [ ] コンポーネントライブラリの標準コンポーネントを使用しているか\n'+
'- [ ] フォントサイズが定義済みスケールのみか\n'+
'- [ ] Figmaデザインとのピクセル単位の差異がないか\n\n'
:
'Verify these items after implementation to prevent residual "AI look":\n\n'+
'- [ ] All colors use design tokens (no hardcoded `#xxx`)\n'+
'- [ ] Spacing follows 4px grid (no awkward values like 13px, 17px)\n'+
'- [ ] Animation easing uses defined tokens\n'+
'- [ ] Responsive is mobile-first\n'+
'- [ ] Dark mode toggle works for all elements\n'+
'- [ ] Hover/focus states defined for all interactive elements\n'+
'- [ ] Using component library standard components\n'+
'- [ ] Font sizes use defined scale only\n'+
'- [ ] Pixel-perfect match with Figma design\n\n'
);
S.files['docs/26_design_system.md']=designDoc;
// Sequence Diagrams
let seqDoc='# '+(G?'シーケンス図':'Sequence Diagrams')+'\n\n';
seqDoc+=G?'**重要**: AIエージェントは、複雑なフローを実装する前にこのシーケンス図を参照してください。\n\n':'**IMPORTANT**: AI agents MUST reference these sequence diagrams before implementing complex flows.\n\n';
// Auth Flow
seqDoc+=(G?'## 認証フロー':'## Authentication Flow')+'\n\n```mermaid\nsequenceDiagram\n  participant U as User\n  participant C as Client\n  participant ';
if(auth.provider==='supabase'){
seqDoc+='S as Supabase Auth\n  U->>C: '+(G?'ログイン要求':'Login request')+'\n  C->>S: signInWithPassword(email, password)\n  S-->>C: {access_token, refresh_token}\n  C->>C: '+(G?'トークン保存':'Store tokens')+'\n  C->>S: getUser() with access_token\n  S-->>C: User object\n  C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}else if(auth.provider==='firebase'){
seqDoc+='F as Firebase Auth\n  U->>C: '+(G?'ログイン要求':'Login request')+'\n  C->>F: signInWithEmailAndPassword()\n  F-->>C: User + ID Token\n  C->>C: '+(G?'トークン保存':'Store token')+'\n  C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}else if(auth.provider==='authjs'){
seqDoc+='A as Auth.js\n  U->>C: '+(G?'ログイン要求':'Login request')+'\n  C->>A: signIn("credentials")\n  A->>A: '+(G?'認証情報検証':'Verify credentials')+'\n  A-->>C: Session cookie\n  C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}else{
seqDoc+='API as Backend API\n  U->>C: '+(G?'ログイン要求':'Login request')+'\n  C->>API: POST /api/auth/login\n  API->>API: '+(G?'認証情報検証':'Verify credentials')+'\n  API-->>C: {token, user}\n  C->>C: '+(G?'トークン保存':'Store token')+'\n  C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}
// CRUD Flow
if(entities.length>0){
const firstEntity=entities[0];
seqDoc+=(G?'## CRUD操作（':'## CRUD Operation (')+firstEntity+(G?'）':')')+'\n\n```mermaid\nsequenceDiagram\n  participant U as User\n  participant C as Client\n  participant ';
if(arch.isBaaS){
const baasName=be.includes('Supabase')?'Supabase':be.includes('Firebase')?'Firebase':'Convex';
seqDoc+=baasName[0]+' as '+baasName+'\n  U->>C: '+(G?'作成ボタンクリック':'Click create button')+'\n  C->>'+baasName[0]+': insert({...data})\n  '+baasName[0]+'-->>C: '+(G?'作成成功':'Created successfully')+'\n  C-->>U: '+(G?'成功通知':'Show success')+'\n  U->>C: '+(G?'一覧表示要求':'Request list')+'\n  C->>'+baasName[0]+': select().eq(...)\n  '+baasName[0]+'-->>C: '+firstEntity+' list\n  C-->>U: '+(G?'一覧表示':'Display list')+'\n```\n\n';
}else{
seqDoc+='API as Backend API\n  U->>C: '+(G?'作成ボタンクリック':'Click create button')+'\n  C->>API: POST /api/'+pluralize(firstEntity)+'\n  API->>API: '+(G?'バリデーション':'Validate')+'\n  API->>API: '+(G?'DB保存':'Save to DB')+'\n  API-->>C: '+(G?'作成成功':'201 Created')+'\n  C-->>U: '+(G?'成功通知':'Show success')+'\n```\n\n';
}
// Related Entity Operation Flow
if(entities.length>1){
const ent1=entities[0];
const ent2=entities[1];
seqDoc+=(G?'## 関連エンティティ操作（':'## Related Entity Operation (')+ent1+' ↔ '+ent2+(G?'）':')')+'\n\n```mermaid\nsequenceDiagram\n  participant U as User\n  participant C as Client\n  participant API as Backend\n  U->>C: '+(G?ent1+'を選択':('Select '+ent1))+'\n  C->>API: GET /api/'+pluralize(ent1)+'/:id\n  API-->>C: '+ent1+' '+(G?'詳細':'details')+'\n  C->>API: GET /api/'+pluralize(ent1)+'/:id/'+pluralize(ent2)+'\n  API-->>C: '+(G?'関連する':'Related ')+ent2+' list\n  C-->>U: '+(G?'関連データ表示':'Display related data')+'\n  U->>C: '+(G?ent2+'を追加':('Add '+ent2))+'\n  C->>API: POST /api/'+pluralize(ent2)+'\n  API->>API: '+(G?ent1+'との関連付け':('Associate with '+ent1))+'\n  API-->>C: '+(G?'作成成功':'201 Created')+'\n  C-->>U: '+(G?'更新完了':'Updated')+'\n```\n\n';
}
}
// Domain-specific Sequence Flow
const dsf=DOMAIN_SEQ_FLOWS[domain];
if(dsf){
seqDoc+=(G?'## '+dsf.nj:'## '+dsf.ne)+'\n\n```mermaid\nsequenceDiagram\n  participant U as User\n  participant C as Client\n  participant API as Backend\n';
dsf.steps.forEach(step=>{
const [from,to,actJ,actE]=step;
seqDoc+='  '+from+'->>'+to+': '+(G?actJ:actE)+'\n';
});
seqDoc+='```\n\n';
}
// Payment Flow (if Stripe)
if(hasPay&&(a.payment||'').includes('Stripe')){
seqDoc+=(G?'## 決済フロー（Stripe）':'## Payment Flow (Stripe)')+'\n\n```mermaid\nsequenceDiagram\n  participant U as User\n  participant C as Client\n  participant API as Backend\n  participant S as Stripe\n  participant W as Webhook\n  U->>C: '+(G?'プラン選択':'Select plan')+'\n  C->>API: POST /api/checkout\n  API->>S: stripe.checkout.sessions.create()\n  S-->>API: session_id\n  API-->>C: {session_id}\n  C->>S: '+(G?'Checkoutページへリダイレクト':'Redirect to Checkout')+'\n  U->>S: '+(G?'カード情報入力':'Enter card info')+'\n  S->>W: webhook: checkout.session.completed\n  W->>W: '+(G?'DB更新（サブスク作成）':'Update DB (create subscription)')+'\n  W-->>S: 200 OK\n  S-->>U: '+(G?'完了ページへリダイレクト':'Redirect to success page')+'\n```\n\n';
}
// Error Handling
seqDoc+=(G?'## エラーハンドリング':'## Error Handling')+'\n\n```mermaid\nsequenceDiagram\n  participant C as Client\n  participant API as Backend\n  C->>API: '+(G?'リクエスト':'Request')+'\n  API-->>C: 400/401/403/500\n  C->>C: '+(G?'エラーメッセージ抽出':'Parse error message')+'\n  C->>C: '+(G?'トースト表示':'Show toast notification')+'\n  alt '+(G?'401 認証エラー':'401 Unauthorized')+'\n    C->>C: '+(G?'ログイン画面へリダイレクト':'Redirect to login')+'\n  else '+(G?'5xx サーバーエラー':'5xx Server Error')+'\n    C->>C: '+(G?'リトライボタン表示':'Show retry button')+'\n  end\n```\n\n';
S.files['docs/27_sequence_diagrams.md']=seqDoc;
}
// ── Domain-Specific Reverse Flow Map (15 domains + default) ──
const REVERSE_FLOW_MAP={
education:{
goal_ja:'学習成果の最大化',goal_en:'Maximize Learning Outcomes',
flow_ja:['学習成果・修了率KPI定義','カリキュラム・コンテンツ設計','学習進捗測定機能','リマインド・通知自動化'],
flow_en:['Define learning outcomes & completion KPIs','Design curriculum & content','Implement progress tracking','Automate reminders & notifications'],
kpi_ja:['コース修了率 ≥70%','平均学習時間/週 ≥3h','課題提出率 ≥80%','受講者満足度 ≥4.2/5'],
kpi_en:['Course completion rate ≥70%','Avg study time/week ≥3h','Assignment submission ≥80%','Learner satisfaction ≥4.2/5'],
risks_ja:['コンテンツ制作遅延','学習者離脱率高','評価基準曖昧'],
risks_en:['Content production delays','High learner dropout','Vague grading criteria']
},
ec:{
goal_ja:'売上・CVR最大化',goal_en:'Maximize Revenue & CVR',
flow_ja:['売上目標・CVR設定','商品戦略（価格・在庫）','UI/UX最適化（カート・決済）','集客施策（SEO・広告）'],
flow_en:['Set revenue & CVR targets','Product strategy (pricing/inventory)','Optimize UI/UX (cart/checkout)','Marketing (SEO/ads)'],
kpi_ja:['CVR ≥2.5%','平均注文額 ≥5,000円','カート放棄率 ≤60%','リピート率 ≥30%'],
kpi_en:['CVR ≥2.5%','Avg order value ≥$50','Cart abandonment ≤60%','Repeat rate ≥30%'],
risks_ja:['在庫切れ・欠品','決済エラー率高','物流遅延'],
risks_en:['Stock-outs','High payment errors','Shipping delays']
},
saas:{
goal_ja:'MRR成長・チャーン率低減',goal_en:'MRR Growth & Churn Reduction',
flow_ja:['MRR・チャーン率目標設定','機能優先度決定（MVPコア機能）','オンボーディング最適化','リテンション施策'],
flow_en:['Set MRR & churn targets','Prioritize features (MVP core)','Optimize onboarding','Retention strategies'],
kpi_ja:['MRR成長率 ≥10%/月','チャーン率 ≤5%/月','アクティベーション率 ≥60%','NPS ≥40'],
kpi_en:['MRR growth ≥10%/mo','Churn ≤5%/mo','Activation rate ≥60%','NPS ≥40'],
risks_ja:['機能スコープ過多','オンボーディング離脱','競合参入'],
risks_en:['Feature scope creep','Onboarding drop-offs','Competitor entry']
},
fintech:{
goal_ja:'取引量・信頼性・規制準拠',goal_en:'Transaction Volume, Trust & Compliance',
flow_ja:['規制準拠要件確認（金融庁・GDPR等）','セキュリティ基盤（暗号化・2FA）','取引フロー設計','監視・監査体制'],
flow_en:['Verify compliance (FSA/GDPR)','Security foundation (encryption/2FA)','Design transaction flow','Monitoring & audit'],
kpi_ja:['取引成功率 ≥99.5%','平均決済時間 ≤3秒','セキュリティインシデント 0件','監査合格率 100%'],
kpi_en:['Transaction success ≥99.5%','Avg payment time ≤3s','Security incidents: 0','Audit pass rate: 100%'],
risks_ja:['規制変更対応遅延','不正検知精度不足','システム障害時の資金保全'],
risks_en:['Slow regulatory adaptation','Weak fraud detection','Fund security during outages']
},
health:{
goal_ja:'患者満足度・診療効率向上',goal_en:'Patient Satisfaction & Efficiency',
flow_ja:['診療目標・待ち時間KPI設定','予約システム最適化','電子カルテ連携','患者フィードバック収集'],
flow_en:['Set care goals & wait time KPIs','Optimize booking system','EHR integration','Patient feedback collection'],
kpi_ja:['予約充足率 ≥85%','平均待ち時間 ≤15分','診察時間 15分/人','患者満足度 ≥4.5/5'],
kpi_en:['Booking rate ≥85%','Avg wait time ≤15min','Consult time: 15min/patient','Patient satisfaction ≥4.5/5'],
risks_ja:['医療情報漏洩','予約重複・ダブルブッキング','システム障害時の診療継続'],
risks_en:['Medical data breach','Booking conflicts','Service continuity during outages']
},
marketplace:{
goal_ja:'取引量・GMV最大化',goal_en:'Maximize Transactions & GMV',
flow_ja:['GMV目標設定','マッチング精度向上','エスクロー決済実装','評価システム信頼性'],
flow_en:['Set GMV targets','Improve matching accuracy','Implement escrow','Rating system trust'],
kpi_ja:['GMV成長率 ≥15%/月','マッチング成約率 ≥40%','平均評価 ≥4.3/5','紛争解決時間 ≤48h'],
kpi_en:['GMV growth ≥15%/mo','Match conversion ≥40%','Avg rating ≥4.3/5','Dispute resolution ≤48h'],
risks_ja:['不正出品・詐欺','決済トラブル','評価操作'],
risks_en:['Fraud listings','Payment disputes','Rating manipulation']
},
community:{
goal_ja:'ユーザーエンゲージメント向上',goal_en:'User Engagement Growth',
flow_ja:['エンゲージメントKPI設定（DAU/MAU）','コンテンツ推薦アルゴリズム','モデレーション自動化','コミュニティガイドライン策定'],
flow_en:['Set engagement KPIs (DAU/MAU)','Content recommendation algo','Automate moderation','Define community guidelines'],
kpi_ja:['DAU/MAU比率 ≥30%','投稿数 ≥500/日','平均滞在時間 ≥20分','通報処理時間 ≤2h'],
kpi_en:['DAU/MAU ratio ≥30%','Posts ≥500/day','Avg session ≥20min','Report handling ≤2h'],
risks_ja:['荒らし・スパム増加','コンテンツ品質低下','ユーザー離脱'],
risks_en:['Spam/trolling surge','Content quality decay','User churn']
},
content:{
goal_ja:'コンテンツ配信・エンゲージメント',goal_en:'Content Delivery & Engagement',
flow_ja:['配信KPI設定（PV・滞在時間）','コンテンツパイプライン構築','SEO最適化','収益化戦略'],
flow_en:['Set delivery KPIs (PV/session time)','Build content pipeline','SEO optimization','Monetization strategy'],
kpi_ja:['PV ≥10,000/日','平均滞在時間 ≥3分','直帰率 ≤60%','広告CTR ≥1.5%'],
kpi_en:['PV ≥10,000/day','Avg time ≥3min','Bounce rate ≤60%','Ad CTR ≥1.5%'],
risks_ja:['コンテンツ制作遅延','SEO順位下落','広告収益減'],
risks_en:['Content production delays','SEO ranking drop','Ad revenue decline']
},
analytics:{
goal_ja:'データ分析精度・レポート自動化',goal_en:'Analytics Accuracy & Automation',
flow_ja:['分析KPI・ダッシュボード設計','データパイプライン構築','可視化ツール選定','自動レポート生成'],
flow_en:['Design analytics KPIs & dashboards','Build data pipeline','Select viz tools','Auto report generation'],
kpi_ja:['データ鮮度 ≤1時間','ダッシュボード応答時間 ≤2秒','レポート自動化率 ≥80%','データ精度 ≥99%'],
kpi_en:['Data freshness ≤1h','Dashboard response ≤2s','Report automation ≥80%','Data accuracy ≥99%'],
risks_ja:['データパイプライン障害','分析精度不足','レポート遅延'],
risks_en:['Data pipeline failures','Poor analysis accuracy','Report delays']
},
booking:{
goal_ja:'予約充足率・キャンセル率最適化',goal_en:'Booking Rate & Cancellation Optimization',
flow_ja:['予約目標・キャンセルKPI設定','在庫管理システム構築','通知・リマインダー自動化','決済・キャンセルポリシー'],
flow_en:['Set booking & cancellation KPIs','Build inventory system','Automate notifications','Payment & cancellation policy'],
kpi_ja:['予約充足率 ≥75%','キャンセル率 ≤15%','平均予約単価 ≥8,000円','リピート率 ≥40%'],
kpi_en:['Booking rate ≥75%','Cancellation ≤15%','Avg booking value ≥$80','Repeat rate ≥40%'],
risks_ja:['ダブルブッキング','直前キャンセル','在庫更新遅延'],
risks_en:['Double booking','Last-minute cancellations','Inventory sync delays']
},
iot:{
goal_ja:'デバイス安定稼働・データ収集',goal_en:'Device Uptime & Data Collection',
flow_ja:['稼働率・データ収集KPI設定','デバイス管理・認証基盤','データストリーミング構築','異常検知・アラート'],
flow_en:['Set uptime & data KPIs','Device mgmt & auth','Build data streaming','Anomaly detection & alerts'],
kpi_ja:['デバイス稼働率 ≥99%','データ取得頻度 ≥1回/分','異常検知精度 ≥95%','アラート応答時間 ≤5分'],
kpi_en:['Device uptime ≥99%','Data frequency ≥1/min','Anomaly accuracy ≥95%','Alert response ≤5min'],
risks_ja:['デバイス接続不安定','データ欠損','セキュリティ侵害'],
risks_en:['Unstable connections','Data loss','Security breaches']
},
realestate:{
goal_ja:'成約率・物件掲載数最大化',goal_en:'Conversion & Listing Maximization',
flow_ja:['成約KPI・物件掲載目標設定','検索・フィルタ最適化','内見予約システム','契約書類デジタル化'],
flow_en:['Set conversion & listing KPIs','Optimize search/filters','Viewing booking system','Digital contracts'],
kpi_ja:['成約率 ≥15%','物件掲載数 ≥500件','内見予約率 ≥30%','契約処理時間 ≤7日'],
kpi_en:['Conversion ≥15%','Listings ≥500','Viewing rate ≥30%','Contract time ≤7 days'],
risks_ja:['物件情報更新遅延','内見日程調整トラブル','契約書類不備'],
risks_en:['Listing update delays','Viewing schedule conflicts','Contract errors']
},
legal:{
goal_ja:'案件処理効率・文書精度向上',goal_en:'Case Efficiency & Doc Accuracy',
flow_ja:['案件処理時間・精度KPI設定','文書管理・検索システム','契約レビュー自動化','請求・タイムトラッキング'],
flow_en:['Set case time & accuracy KPIs','Doc mgmt & search system','Auto contract review','Billing & time tracking'],
kpi_ja:['案件処理時間 ≤14日/件','文書検索精度 ≥98%','契約レビュー時間 ≤24h','請求精度 100%'],
kpi_en:['Case time ≤14 days','Doc search accuracy ≥98%','Contract review ≤24h','Billing accuracy 100%'],
risks_ja:['文書紛失・漏洩','契約ミス・解釈齟齬','請求ミス'],
risks_en:['Doc loss/leaks','Contract errors','Billing mistakes']
},
hr:{
goal_ja:'採用効率・従業員満足度向上',goal_en:'Hiring Efficiency & Employee Satisfaction',
flow_ja:['採用KPI・従業員満足度目標設定','ATS（採用管理）構築','オンボーディング自動化','パフォーマンス評価システム'],
flow_en:['Set hiring & satisfaction KPIs','Build ATS','Automate onboarding','Performance review system'],
kpi_ja:['採用充足率 ≥90%','Time to hire ≤30日','従業員満足度 ≥4.0/5','離職率 ≤10%/年'],
kpi_en:['Hiring fill rate ≥90%','Time to hire ≤30 days','Employee satisfaction ≥4.0/5','Turnover ≤10%/yr'],
risks_ja:['採用プロセス遅延','候補者離脱','従業員エンゲージメント低下'],
risks_en:['Hiring delays','Candidate drop-offs','Low engagement']
},
portfolio:{
goal_ja:'訪問者エンゲージメント・問い合わせ獲得',goal_en:'Visitor Engagement & Lead Generation',
flow_ja:['訪問・問い合わせKPI設定','作品ポートフォリオ構築','SEO・SNS連携','問い合わせフォーム最適化'],
flow_en:['Set visit & lead KPIs','Build project portfolio','SEO & social integration','Optimize contact form'],
kpi_ja:['月間訪問者 ≥500人','平均滞在時間 ≥2分','問い合わせ率 ≥3%','SNS流入 ≥30%'],
kpi_en:['Monthly visitors ≥500','Avg session ≥2min','Contact rate ≥3%','Social traffic ≥30%'],
risks_ja:['作品更新停滞','SEO順位低下','問い合わせ減少'],
risks_en:['Stale portfolio','SEO drop','Lead decline']
},
tool:{
goal_ja:'ユーザー利用頻度・機能満足度',goal_en:'User Frequency & Feature Satisfaction',
flow_ja:['利用KPI・機能満足度目標設定','コア機能実装優先','UI/UX最適化','ドキュメント・サポート'],
flow_en:['Set usage & satisfaction KPIs','Prioritize core features','Optimize UI/UX','Docs & support'],
kpi_ja:['週間利用頻度 ≥3回','機能満足度 ≥4.3/5','エラー率 ≤1%','問い合わせ応答時間 ≤24h'],
kpi_en:['Weekly usage ≥3x','Feature satisfaction ≥4.3/5','Error rate ≤1%','Support response ≤24h'],
risks_ja:['機能複雑化','使い方不明','競合ツール台頭'],
risks_en:['Feature complexity','Unclear usage','Competitor tools']
},
ai:{
goal_ja:'AI精度・応答速度・ユーザー満足度',goal_en:'AI Accuracy, Response Speed & User Satisfaction',
flow_ja:['AI精度・応答速度KPI設定','プロンプト最適化・モデル選定','コンテキスト管理・RAG構築','ユーザーフィードバック学習'],
flow_en:['Set AI accuracy & speed KPIs','Prompt optimization & model selection','Context management & RAG','User feedback learning'],
kpi_ja:['応答精度 ≥90%','平均応答時間 ≤2秒','ユーザー満足度 ≥4.5/5','フィードバック反映率 ≥80%'],
kpi_en:['Response accuracy ≥90%','Avg response time ≤2s','User satisfaction ≥4.5/5','Feedback incorporation ≥80%'],
risks_ja:['幻覚(ハルシネーション)','コンテキスト破綻','レート制限超過'],
risks_en:['Hallucinations','Context loss','Rate limit exceeded']
},
automation:{
goal_ja:'自動化率・エラー率・処理時間',goal_en:'Automation Rate, Error Rate & Processing Time',
flow_ja:['自動化率・エラー率KPI設定','ワークフロー設計・条件分岐','監視・リトライ機構','継続的改善ループ'],
flow_en:['Set automation & error KPIs','Workflow design & branching','Monitoring & retry mechanism','Continuous improvement loop'],
kpi_ja:['自動化率 ≥80%','エラー率 ≤3%','処理時間短縮 ≥50%','手動介入率 ≤10%'],
kpi_en:['Automation rate ≥80%','Error rate ≤3%','Processing time reduction ≥50%','Manual intervention ≤10%'],
risks_ja:['無限ループ','条件分岐ミス','監視漏れ'],
risks_en:['Infinite loops','Branching errors','Monitoring gaps']
},
event:{
goal_ja:'参加率・満足度・収益最大化',goal_en:'Participation, Satisfaction & Revenue Maximization',
flow_ja:['参加率・満足度KPI設定','チケット販売戦略','イベント管理システム','事後フォローアップ'],
flow_en:['Set participation & satisfaction KPIs','Ticket sales strategy','Event management system','Post-event follow-up'],
kpi_ja:['参加率 ≥85%','満足度 ≥4.5/5','チケット売上目標達成 ≥95%','リピート参加率 ≥40%'],
kpi_en:['Participation ≥85%','Satisfaction ≥4.5/5','Ticket sales goal ≥95%','Repeat participation ≥40%'],
risks_ja:['集客不足','当日キャンセル','運営トラブル'],
risks_en:['Low attendance','Last-minute cancellations','Operational issues']
},
gamify:{
goal_ja:'エンゲージメント・継続率向上',goal_en:'Engagement & Retention Improvement',
flow_ja:['エンゲージメントKPI設定','ポイント・バッジシステム設計','リーダーボード・チャレンジ','報酬最適化'],
flow_en:['Set engagement KPIs','Design points & badges system','Leaderboard & challenges','Reward optimization'],
kpi_ja:['DAU/MAU比率 ≥35%','平均セッション時間 ≥15分','ポイント獲得率 ≥70%','バッジ解除率 ≥50%'],
kpi_en:['DAU/MAU ratio ≥35%','Avg session ≥15min','Point earn rate ≥70%','Badge unlock rate ≥50%'],
risks_ja:['ポイントインフレ','不正獲得','モチベーション低下'],
risks_en:['Point inflation','Cheating','Motivation decline']
},
collab:{
goal_ja:'共同作業効率・同期精度',goal_en:'Collaboration Efficiency & Sync Accuracy',
flow_ja:['コラボレーションKPI設定','リアルタイム同期基盤','競合解決アルゴリズム','バージョン管理・履歴'],
flow_en:['Set collaboration KPIs','Real-time sync foundation','Conflict resolution algorithm','Version control & history'],
kpi_ja:['同期遅延 ≤200ms','競合発生率 ≤5%','データ損失 0件','同時編集ユーザー数 ≥10人'],
kpi_en:['Sync latency ≤200ms','Conflict rate ≤5%','Data loss: 0','Concurrent users ≥10'],
risks_ja:['データ競合','同期遅延','接続断'],
risks_en:['Data conflicts','Sync delays','Connection loss']
},
devtool:{
goal_ja:'開発者体験・API採用率',goal_en:'Developer Experience & API Adoption',
flow_ja:['DX・API採用率KPI設定','API設計・ドキュメント','SDK・サンプルコード','コミュニティ・サポート'],
flow_en:['Set DX & adoption KPIs','API design & docs','SDKs & sample code','Community & support'],
kpi_ja:['API採用率 ≥50社','ドキュメント満足度 ≥4.5/5','問い合わせ応答時間 ≤4h','SDK利用率 ≥70%'],
kpi_en:['API adoption ≥50 companies','Doc satisfaction ≥4.5/5','Support response ≤4h','SDK usage ≥70%'],
risks_ja:['API仕様変更','ドキュメント不足','サポート遅延'],
risks_en:['API breaking changes','Insufficient docs','Support delays']
},
creator:{
goal_ja:'クリエイター収益・ファンエンゲージメント',goal_en:'Creator Revenue & Fan Engagement',
flow_ja:['収益・ファンKPI設定','コンテンツ収益化戦略','ファンコミュニティ構築','分析・インサイト提供'],
flow_en:['Set revenue & fan KPIs','Content monetization strategy','Build fan community','Analytics & insights'],
kpi_ja:['月間収益 ≥100,000円','ファン数 ≥500人','エンゲージメント率 ≥8%','リピート課金率 ≥60%'],
kpi_en:['Monthly revenue ≥$1,000','Fans ≥500','Engagement rate ≥8%','Repeat payment ≥60%'],
risks_ja:['収益化遅延','ファン離脱','コンテンツ枯渇'],
risks_en:['Monetization delays','Fan churn','Content shortage']
},
newsletter:{
goal_ja:'開封率・クリック率・購読者増',goal_en:'Open Rate, Click Rate & Subscriber Growth',
flow_ja:['開封率・購読者KPI設定','コンテンツ戦略・配信頻度','セグメント配信・A/Bテスト','購読者獲得施策'],
flow_en:['Set open rate & subscriber KPIs','Content strategy & frequency','Segment delivery & A/B test','Subscriber acquisition'],
kpi_ja:['開封率 ≥25%','クリック率 ≥3%','購読者増加率 ≥10%/月','解除率 ≤2%'],
kpi_en:['Open rate ≥25%','Click rate ≥3%','Subscriber growth ≥10%/mo','Unsubscribe ≤2%'],
risks_ja:['スパム判定','コンテンツ質低下','配信遅延'],
risks_en:['Spam filtering','Content quality decline','Delivery delays']
},
manufacturing:{
goal_ja:'生産効率・品質・納期遵守',goal_en:'Production Efficiency, Quality & On-Time Delivery',
flow_ja:['生産目標・品質KPI設定','生産計画最適化','品質管理体制構築','設備保全スケジュール'],
flow_en:['Set production & quality KPIs','Optimize production plan','Build quality mgmt system','Equipment maintenance schedule'],
kpi_ja:['稼働率 ≥75%','不良率 ≤3%','納期遵守率 ≥95%','在庫回転率 ≥6回/年'],
kpi_en:['Utilization ≥75%','Defect rate ≤3%','On-time delivery ≥95%','Inventory turnover ≥6/yr'],
risks_ja:['設備故障','材料供給遅延','品質問題'],
risks_en:['Equipment failure','Material supply delays','Quality issues']
},
logistics:{
goal_ja:'配送速度・コスト・正確性',goal_en:'Delivery Speed, Cost & Accuracy',
flow_ja:['配送時間・コストKPI設定','ルート最適化','倉庫オペレーション効率化','追跡システム構築'],
flow_en:['Set delivery time & cost KPIs','Route optimization','Warehouse operations efficiency','Build tracking system'],
kpi_ja:['配送時間 ≤48h','配送精度 ≥99%','コスト/配送 ≤500円','不在率 ≤30%'],
kpi_en:['Delivery time ≤48h','Delivery accuracy ≥99%','Cost/delivery ≤$5','Absence rate ≤30%'],
risks_ja:['交通渋滞','不在配達','破損・紛失'],
risks_en:['Traffic congestion','Absence delivery','Damage/loss']
},
agriculture:{
goal_ja:'収穫量・品質・コスト削減',goal_en:'Harvest Yield, Quality & Cost Reduction',
flow_ja:['収穫目標・品質KPI設定','栽培計画策定','IoTセンサー配置','病害検知システム'],
flow_en:['Set harvest & quality KPIs','Cultivation plan','Deploy IoT sensors','Build pest detection system'],
kpi_ja:['収穫量 前年比+10%','A級品率 ≥70%','水使用量 -20%','病害損失 ≤5%'],
kpi_en:['Yield +10% YoY','Grade-A rate ≥70%','Water usage -20%','Pest loss ≤5%'],
risks_ja:['気象変動','病害発生','センサー故障'],
risks_en:['Weather changes','Pest outbreaks','Sensor failures']
},
energy:{
goal_ja:'安定供給・コスト削減・ピーク最適化',goal_en:'Stable Supply, Cost Reduction & Peak Optimization',
flow_ja:['需給予測・ピークKPI設定','スマートメーター導入','需給調整システム','請求自動化'],
flow_en:['Set demand forecast & peak KPIs','Deploy smart meters','Build supply-demand adjustment system','Automate billing'],
kpi_ja:['供給安定性 ≥99.9%','ピーク削減 -15%','請求誤差 ≤1%','顧客満足度 ≥4.0/5'],
kpi_en:['Supply stability ≥99.9%','Peak reduction -15%','Billing error ≤1%','Customer satisfaction ≥4.0/5'],
risks_ja:['需給予測外れ','設備故障','規制変更'],
risks_en:['Forecast miss','Equipment failure','Regulatory changes']
},
media:{
goal_ja:'視聴時間・継続率・収益化',goal_en:'Watch Time, Retention & Monetization',
flow_ja:['視聴時間・継続率KPI設定','コンテンツライブラリ拡充','レコメンド精度向上','広告・サブスク最適化'],
flow_en:['Set watch time & retention KPIs','Expand content library','Improve recommendation accuracy','Optimize ads/subscriptions'],
kpi_ja:['平均視聴時間 ≥45分/日','継続率 ≥70%','バッファリング率 ≤3%','ARPU ≥800円/月'],
kpi_en:['Avg watch time ≥45min/day','Retention ≥70%','Buffering rate ≤3%','ARPU ≥$8/mo'],
risks_ja:['コンテンツ不足','ストリーミング障害','DRM回避'],
risks_en:['Content shortage','Streaming failures','DRM bypass']
},
government:{
goal_ja:'処理効率・透明性・市民満足度',goal_en:'Processing Efficiency, Transparency & Citizen Satisfaction',
flow_ja:['処理時間・満足度KPI設定','申請システム構築','承認ワークフロー自動化','市民向けダッシュボード'],
flow_en:['Set processing time & satisfaction KPIs','Build application system','Automate approval workflow','Citizen dashboard'],
kpi_ja:['平均処理時間 ≤14日','市民満足度 ≥4.0/5','オンライン申請率 ≥60%','処理誤差 ≤1%'],
kpi_en:['Avg processing time ≤14d','Citizen satisfaction ≥4.0/5','Online application rate ≥60%','Processing error ≤1%'],
risks_ja:['個人情報漏洩','システム障害','規制変更'],
risks_en:['Data breach','System failures','Regulatory changes']
},
travel:{
goal_ja:'予約率・稼働率・顧客満足度',goal_en:'Booking Rate, Occupancy & Customer Satisfaction',
flow_ja:['予約目標・稼働率KPI設定','在庫管理・価格最適化','予約システム構築','レビュー管理'],
flow_en:['Set booking & occupancy KPIs','Inventory mgmt & price optimization','Build booking system','Review management'],
kpi_ja:['予約率 ≥65%','稼働率 ≥80%','キャンセル率 ≤15%','顧客満足度 ≥4.5/5'],
kpi_en:['Booking rate ≥65%','Occupancy ≥80%','Cancel rate ≤15%','Customer satisfaction ≥4.5/5'],
risks_ja:['ダブルブッキング','キャンセル多発','在庫管理ミス'],
risks_en:['Double booking','High cancellations','Inventory mgmt errors']
},
insurance:{
goal_ja:'契約率・請求処理速度・満足度',goal_en:'Contract Rate, Claims Speed & Satisfaction',
flow_ja:['契約・請求処理KPI設定','見積システム構築','AI審査導入','顧客サポート体制'],
flow_en:['Set contract & claims KPIs','Build quote system','Deploy AI review','Customer support system'],
kpi_ja:['見積精度 ≥95%','請求処理時間 ≤7日','契約率 ≥40%','顧客満足度 ≥4.3/5'],
kpi_en:['Quote accuracy ≥95%','Claims processing ≤7d','Contract rate ≥40%','Customer satisfaction ≥4.3/5'],
risks_ja:['不正請求','審査遅延','規制変更'],
risks_en:['Fraudulent claims','Review delays','Regulatory changes']
},
_default:{
goal_ja:'プロダクト完成・ローンチ',goal_en:'Product Completion & Launch',
flow_ja:['ゴール・成功指標定義','要件分解・優先順位付け','技術スタック選定','実装計画・スケジュール'],
flow_en:['Define goals & success metrics','Decompose requirements & prioritize','Select tech stack','Implementation plan & schedule'],
kpi_ja:['MVP完成率 100%','テストカバレッジ ≥80%','バグ修正率 ≥95%','ローンチ予定通り'],
kpi_en:['MVP completion 100%','Test coverage ≥80%','Bug fix rate ≥95%','Launch on schedule'],
risks_ja:['スコープ拡大','技術負債蓄積','リソース不足'],
risks_en:['Scope creep','Tech debt accumulation','Resource shortage']
}
};
// ── Mermaid-safe string sanitizer (shared by all doc generators) ──
const _mmSafe=s=>(s||'').replace(/&/g,' and ').replace(/[（）()\[\]{}<>"]/g,'');
// ── Sub-generators (P15 pattern: each returns a string) ──
function _genDoc29(G, rf, domain, flowSteps, kpis, risks, a) {
const purpose=a.purpose||'';
let doc='# '+(G?'リバースエンジニアリング（ゴール逆算型プランニング）':'Reverse Engineering (Goal-Driven Planning)')+'\n\n';
doc+=G?'**重要**: このドキュメントは「ゴールから逆算して実装ステップを導出する」リバースエンジニアリング手法を提示します。AIエージェントは、実装前にこのフローを参照し、目標達成に向けた最適な順序でタスクを進めてください。\n\n':'**IMPORTANT**: This document presents reverse engineering methodology to derive implementation steps from goals. AI agents MUST reference this flow before implementation to proceed in optimal order for goal achievement.\n\n';
// ── Goal Definition ──
doc+=(G?'## ゴール定義':'## Goal Definition')+'\n\n';
doc+='**'+(G?'プロダクトの目的':'Product Purpose')+'**: '+purpose+'\n\n';
doc+='**'+(G?'中心ゴール':'Central Goal')+'**: '+(G?rf.goal_ja:rf.goal_en)+'\n\n';
doc+='**'+(G?'成功指標（KPI）':'Success Metrics (KPIs)')+'**:\n';
kpis.forEach(k=>doc+='- '+k+'\n');
doc+='\n';
// ── Reverse Flow (Domain-Specific) ──
doc+=(G?'## 逆算フロー（'+domain+'ドメイン特化）':'## Reverse Flow ('+domain+' Domain-Specific)')+'\n\n';
doc+=G?'ゴールから逆算して、以下の順序で実装を進めます：\n\n':'Working backward from the goal, implement in this order:\n\n';
flowSteps.forEach((step,i)=>{
doc+=(i+1)+'. **'+step+'**\n';
if(i===0){
doc+=(G?'   - 測定可能なKPIを定義（定量的目標）\n   - 目標達成の判断基準を明確化\n':'   - Define measurable KPIs (quantitative targets)\n   - Clarify success criteria\n')+'\n';
}else if(i===1){
doc+=(G?'   - KPI達成に直結する機能・コンテンツを設計\n   - 優先順位付け（Impact × Effort マトリクス）\n':'   - Design features/content directly contributing to KPIs\n   - Prioritize (Impact × Effort matrix)\n')+'\n';
}else if(i===2){
doc+=(G?'   - 実装スケジュール・タスク分解\n   - 依存関係チェーン整理\n':'   - Implementation schedule & task decomposition\n   - Dependency chain organization\n')+'\n';
}else{
doc+=(G?'   - 自動化・効率化施策\n   - 継続的改善サイクル構築\n':'   - Automation & efficiency measures\n   - Continuous improvement cycle\n')+'\n';
}
});
// ── Implementation-Level Reverse Flow (Industry Playbook) ──
const pb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
if(pb&&pb.impl_ja&&pb.impl_ja.length>0&&pb.impl_ja[0]!==''){
doc+=(G?'## 実装レベル・リバースフロー（業種特化パターン）':'## Implementation-Level Reverse Flow (Industry-Specific Patterns)')+'\n\n';
doc+=G?'具体的なデータフロー・ビジネスロジックの実装パターン:\n\n':'Concrete data flow & business logic implementation patterns:\n\n';
const implPatterns=G?pb.impl_ja:pb.impl_en;
implPatterns.forEach((pattern,i)=>{
doc+=(i+1)+'. '+pattern+'\n\n';
});
}
// ── Milestone Schedule (Mermaid Gantt) ── Dynamic dates from today
const today=new Date();
const formatDate=(d)=>{const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');return y+'-'+m+'-'+day;};
const addDays=(d,days)=>{const r=new Date(d);r.setDate(r.getDate()+days);return r;};
const p1Start=addDays(today,7);
const p1Mid=addDays(today,14);
const p1End=addDays(today,21);
const p2Start=addDays(today,21);
const p2End=addDays(today,35);
const p3Start=addDays(today,35);
const p3End=addDays(today,56);
const p4Start=addDays(today,56);
const p4End=addDays(today,70);
doc+=(G?'## マイルストーン逆算スケジュール':'## Milestone Reverse Schedule')+'\n\n```mermaid\ngantt\n    title '+(G?'ゴール達成までのマイルストーン':'Milestones to Goal Achievement')+'\n    dateFormat YYYY-MM-DD\n    section '+(G?'Phase 1: 基盤構築':'Phase 1: Foundation')+'\n';
flowSteps.slice(0,2).forEach((step,i)=>{
const start=i===0?formatDate(p1Start):formatDate(p1Mid);
const end=i===0?formatDate(addDays(p1Mid,-1)):formatDate(p1End);
doc+='    '+step.replace(/[:\-（）()&]/g,' ')+' :'+start+', '+end+'\n';
});
doc+='    section '+(G?'Phase 2: MVP実装':'Phase 2: MVP Implementation')+'\n';
if(flowSteps.length>2){
const step=flowSteps[2];
doc+='    '+step.replace(/[:\-（）()]/g,' ')+' :'+formatDate(p2Start)+', '+formatDate(p2End)+'\n';
}
doc+='    section '+(G?'Phase 3: 最適化':'Phase 3: Optimization')+'\n';
if(flowSteps.length>3){
const step=flowSteps[3];
doc+='    '+step.replace(/[:\-（）()]/g,' ')+' :'+formatDate(p3Start)+', '+formatDate(p3End)+'\n';
}
doc+='    section '+(G?'Phase 4: ローンチ':'Phase 4: Launch')+'\n';
doc+='    '+(G?'最終テスト・デプロイ':'Final testing & deploy')+' :milestone, '+formatDate(p4End)+', 0d\n';
doc+='```\n\n';
// ── Risk & Blocker Analysis ── Use domain-specific prevent strategies
doc+=(G?'## リスク・ブロッカー分析':'## Risk & Blocker Analysis')+'\n\n';
doc+='| '+(G?'リスク項目':'Risk Item')+' | '+(G?'影響度':'Impact')+' | '+(G?'発生確率':'Probability')+' | '+(G?'対策':'Mitigation')+' |\n|------|------|------|------|\n';
const playbook=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
const preventList=playbook?(G?playbook.prevent_ja:playbook.prevent_en):[];
risks.forEach((risk,i)=>{
const impact=i===0?'High':(i===1?'Medium':'Low');
const prob=i===0?'Medium':(i===1?'High':'Low');
let mitigation='';
if(preventList&&preventList.length>i){
const preventEntry=preventList[i];
const segments=preventEntry.split(/[:|]/);
if(segments.length>=3){
mitigation=segments[segments.length-1].trim();
}else{
mitigation=segments[segments.length-1].trim();
}
}
if(!mitigation||mitigation===''){
mitigation=G?(i===0?'早期プロトタイプ検証':'定期レビュー会'):(i===0?'Early prototype validation':'Regular review meetings');
}
doc+='| '+risk+' | '+impact+' | '+prob+' | '+mitigation+' |\n';
});
doc+='\n';
// ── Progress Tracking ──
doc+=(G?'## 進捗トラッキング':'## Progress Tracking')+'\n\n';
doc+=G?'**重要**: `docs/24_progress.md` を使用して実装進捗を記録してください。各マイルストーン完了時にステータスを更新し、ブロッカーがあれば即座に記録してください。\n\n':'**IMPORTANT**: Use `docs/24_progress.md` to track implementation progress. Update status upon milestone completion and log blockers immediately.\n\n';
doc+=(G?'**推奨ワークフロー**:':'**Recommended Workflow**:')+'\n';
doc+='1. '+(G?'各Phase開始時: 24_progress.md にスプリント目標を記載':'Phase start: Log sprint goal in 24_progress.md')+'\n';
doc+='2. '+(G?'実装中: タスク完了ごとにステータス更新':'During implementation: Update status per task completion')+'\n';
doc+='3. '+(G?'ブロッカー発生時: 25_error_logs.md に原因・対策を記録':'On blocker: Log cause & mitigation in 25_error_logs.md')+'\n';
doc+='4. '+(G?'Phase完了時: KPI達成度を確認・記録':'Phase complete: Verify & log KPI achievement')+'\n\n';
return doc;
}
function _genDoc30(G, rf, flowSteps, kpis, features, entities, a) {
let doc='# '+(G?'ゴール分解・ギャップ分析':'Goal Decomposition & Gap Analysis')+'\n\n';
doc+=G?'**重要**: このドキュメントは、中心ゴールをサブゴール階層に分解し、現状とのギャップ・優先度を明確化します。AIエージェントは、実装順序を決定する際にこのマトリクスを参照してください。\n\n':'**IMPORTANT**: This document decomposes the central goal into sub-goal hierarchies and clarifies gaps & priorities. AI agents MUST reference this matrix when determining implementation order.\n\n';
// ── Goal Tree (Mermaid mindmap) ──
doc+=(G?'## ゴールツリー':'## Goal Tree')+'\n\n```mermaid\nmindmap\n  root(("'+_mmSafe(G?rf.goal_ja:rf.goal_en)+'"))\n';
// Level 1: Flow steps
flowSteps.slice(0,3).forEach((step,i)=>{
doc+='    '+_mmSafe(step)+'\n';
// Level 2: Features (sample 2 per step)
if(i===0&&kpis.length>0){
doc+='      '+_mmSafe(kpis[0].split(' ')[0])+'\n';
if(kpis.length>1)doc+='      '+_mmSafe(kpis[1].split(' ')[0])+'\n';
}else if(i===1&&features.length>0){
doc+='      '+_mmSafe(features[0])+'\n';
if(features.length>1)doc+='      '+_mmSafe(features[1])+'\n';
}else if(i===2&&entities.length>0){
doc+='      '+_mmSafe(entities[0])+(G?' 実装':' implementation')+'\n';
if(entities.length>1)doc+='      '+_mmSafe(entities[1])+(G?' 実装':' implementation')+'\n';
}
});
doc+='```\n\n';
// ── Sub-Goal Decomposition (3-5 levels) ──
doc+=(G?'## サブゴール分解（3-5階層）':'## Sub-Goal Decomposition (3-5 Levels)')+'\n\n';
doc+='### '+(G?'レベル1: 戦略目標':'Level 1: Strategic Goals')+'\n';
flowSteps.slice(0,2).forEach((step,i)=>{
doc+=(i+1)+'. **'+step+'**\n';
});
doc+='\n### '+(G?'レベル2: 戦術目標':'Level 2: Tactical Goals')+'\n';
if(features.length>0){
features.slice(0,4).forEach((f,i)=>{
doc+=(i+1)+'. '+f+'\n';
});
}else{
doc+='1. '+(G?'MVP機能実装':'MVP feature implementation')+'\n';
doc+='2. '+(G?'UI/UX最適化':'UI/UX optimization')+'\n';
}
doc+='\n### '+(G?'レベル3: 実装タスク':'Level 3: Implementation Tasks')+'\n';
if(entities.length>0){
entities.slice(0,3).forEach((ent,i)=>{
doc+=(i+1)+'. '+ent+(G?' CRUD実装':' CRUD implementation')+'\n';
});
}else{
doc+='1. '+(G?'データベース設計':'Database design')+'\n';
doc+='2. '+(G?'API実装':'API implementation')+'\n';
}
doc+='\n';
// ── Gap Analysis Matrix ──
doc+=(G?'## ギャップ分析マトリクス':'## Gap Analysis Matrix')+'\n\n';
doc+='| '+(G?'サブゴール':'Sub-Goal')+' | '+(G?'現状':'Current State')+' | '+(G?'目標':'Target')+' | '+(G?'ギャップ':'Gap')+' | '+(G?'対策':'Action')+' |\n|------|------|------|------|------|\n';
flowSteps.slice(0,3).forEach((step,i)=>{
const current=G?(i===0?'未定義':'未実装'):(i===0?'Undefined':'Not implemented');
const target=G?(i===0?'KPI定義完了':'MVP実装完了'):(i===0?'KPI defined':'MVP implemented');
const gap=G?(i===0?'測定可能な指標が不明':'機能未開発'):(i===0?'Measurable metrics unclear':'Features not developed');
const action=G?(i===0?'24_progress.mdに記載':'開発開始'):(i===0?'Log in 24_progress.md':'Start development');
doc+='| '+step+' | '+current+' | '+target+' | '+gap+' | '+action+' |\n';
});
doc+='\n';
// ── Priority Matrix (Impact × Effort) ──
doc+=(G?'## 優先度マトリクス（Impact × Effort）':'## Priority Matrix (Impact × Effort)')+'\n\n';
doc+='```\n';
doc+='          '+(G?'大':'High')+'      |\n';
doc+='  Impact  '+(G?'中':'Med')+'  '+(G?'🟢P1':'🟢P1')+'  | '+(G?'🟡P2':'🟡P2')+'\n';
doc+='          '+(G?'小':'Low')+'  '+(G?'🟡P2':'🟡P2')+'  | '+(G?'⚪P3':'⚪P3')+'\n';
doc+='          ─────┼─────\n';
doc+='          '+(G?'低':'Low')+'  '+(G?'高':'High')+'\n';
doc+='             Effort\n';
doc+='```\n\n';
doc+='**'+(G?'優先順位':'Priority')+'**:\n';
doc+='- '+(G?'🟢 P1 (高Impact・低Effort): ':'🟢 P1 (High Impact, Low Effort): ')+(flowSteps[0]||'Core feature')+'\n';
doc+='- '+(G?'🟡 P2 (高Impact・高Effort または 中Impact): ':'🟡 P2 (High Impact & Effort or Med Impact): ')+(flowSteps[1]||'Secondary features')+'\n';
doc+='- '+(G?'⚪ P3 (低Impact): ':'⚪ P3 (Low Impact): ')+(G?'Nice-to-have機能':'Nice-to-have features')+'\n\n';
// ── Dependency Chain (Mermaid flowchart) ── Stack-aware based on resolveArch
const arch=resolveArch(a);
doc+=(G?'## 依存関係チェーン':'## Dependency Chain')+'\n\n```mermaid\nflowchart TD\n';
const node1=G?'A[KPI定義]':'A[Define KPIs]';
const node2=G?'B[機能設計]':'B[Design Features]';
let node3,node4,node5,node6,node7;
if(arch.isBaaS){
// BaaS: No traditional API layer, use schema + RLS/Rules
node3=G?'C[スキーマ設計]':'C[Design Schema]';
node4=G?'D[RLS/Rules実装]':'D[Implement RLS/Rules]';
node5=G?'E[UI実装]':'E[Implement UI]';
node6=G?'F[テスト]':'F[Testing]';
node7=G?'G[デプロイ]':'G[Deploy]';
}else if(arch.pattern==='bff'){
// BFF: API Routes within Next.js
node3=G?'C[DB設計]':'C[Design DB]';
node4=G?'D[API Routes実装]':'D[Implement API Routes]';
node5=G?'E[Pages実装]':'E[Implement Pages]';
node6=G?'F[テスト]':'F[Testing]';
node7=G?'G[デプロイ]':'G[Deploy]';
}else{
// Traditional: Separate FE/BE
node3=G?'C[DB設計]':'C[Design DB]';
node4=G?'D[API実装]':'D[Implement API]';
node5=G?'E[UI実装]':'E[Implement UI]';
node6=G?'F[テスト]':'F[Testing]';
node7=G?'G[デプロイ]':'G[Deploy]';
}
doc+='  '+node1+' --> '+node2+'\n';
doc+='  '+node2+' --> '+node3+'\n';
doc+='  '+node3+' --> '+node4+'\n';
doc+='  '+node4+' --> '+node5+'\n';
doc+='  '+node5+' --> '+node6+'\n';
doc+='  '+node6+' --> '+node7+'\n';
doc+='  style A fill:#4ade80\n';
doc+='  style B fill:#4ade80\n';
doc+='  style C fill:#fbbf24\n';
doc+='  style D fill:#fbbf24\n';
doc+='  style E fill:#fbbf24\n';
doc+='  style F fill:#f87171\n';
doc+='  style G fill:#f87171\n';
doc+='```\n\n';
doc+=G?'**凡例**: 🟢 完了 | 🟡 進行中 | 🔴 未着手\n\n':'**Legend**: 🟢 Complete | 🟡 In Progress | 🔴 Not Started\n\n';
// ── Implementation Checklist ──
doc+=(G?'## 実装チェックリスト':'## Implementation Checklist')+'\n\n';
flowSteps.forEach((step,i)=>{
doc+='- [ ] **'+step+'**\n';
if(i===0){
doc+='  - [ ] '+(G?'KPI指標を24_progress.mdに記載':'Log KPI metrics in 24_progress.md')+'\n';
doc+='  - [ ] '+(G?'測定方法確定（Analytics等）':'Define measurement method (Analytics, etc.)')+'\n';
}else if(i===1){
doc+='  - [ ] '+(G?'機能要件定義':'Define feature requirements')+'\n';
doc+='  - [ ] '+(G?'優先度決定':'Determine priority')+'\n';
}else if(i===2){
doc+='  - [ ] '+(G?'DB/API実装':'Implement DB/API')+'\n';
doc+='  - [ ] '+(G?'テストケース作成':'Create test cases')+'\n';
}else{
doc+='  - [ ] '+(G?'自動化スクリプト作成':'Create automation scripts')+'\n';
doc+='  - [ ] '+(G?'継続的改善ループ構築':'Build continuous improvement loop')+'\n';
}
});
doc+='\n';
// ═══ C3: Goal Tracking Schema (~4KB) ═══
doc+=(G?'## Goal Tracking スキーマ':'## Goal Tracking Schema')+'\n\n';
doc+=G?'**重要**: 目標達成の進捗を追跡するための5テーブル構成。データベースに実装することで、KPIの可視化と継続的改善が可能になります。\n\n':'**IMPORTANT**: 5-table schema for tracking goal progress. Implement in database to enable KPI visualization and continuous improvement.\n\n';
doc+='### 1. UserGoal\n';
doc+=(G?'**目的**: ユーザー別・プロジェクト別の目標管理':'**Purpose**: Goal management per user/project')+'\n\n';
doc+='```sql\n';
doc+='CREATE TABLE user_goals (\n';
doc+='  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc+='  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n';
doc+='  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,\n';
doc+='  goal_type VARCHAR(50) NOT NULL, -- '+(G?'\'revenue\', \'cvr\', \'mrr\', \'churn\', \'engagement\' 等':'\'revenue\', \'cvr\', \'mrr\', \'churn\', \'engagement\', etc.')+'\n';
doc+='  target_value DECIMAL(10,2) NOT NULL, -- '+(G?'目標値':'Target value')+'\n';
doc+='  current_value DECIMAL(10,2) DEFAULT 0, -- '+(G?'現在値':'Current value')+'\n';
doc+='  deadline DATE,\n';
doc+='  status VARCHAR(20) DEFAULT \'active\', -- \'active\', \'completed\', \'failed\'\n';
doc+='  created_at TIMESTAMP DEFAULT NOW(),\n';
doc+='  updated_at TIMESTAMP DEFAULT NOW()\n';
doc+=');\n```\n\n';
doc+='### 2. ReversePlan\n';
doc+=(G?'**目的**: 目標達成のためのリバースプランニング':'**Purpose**: Reverse planning for goal achievement')+'\n\n';
doc+='```sql\n';
doc+='CREATE TABLE reverse_plans (\n';
doc+='  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc+='  goal_id UUID NOT NULL REFERENCES user_goals(id) ON DELETE CASCADE,\n';
doc+='  title VARCHAR(255) NOT NULL,\n';
doc+='  description TEXT,\n';
doc+='  total_steps INT DEFAULT 4, -- '+(G?'標準4ステップ':'Standard 4 steps')+'\n';
doc+='  completed_steps INT DEFAULT 0,\n';
doc+='  status VARCHAR(20) DEFAULT \'draft\', -- \'draft\', \'active\', \'completed\'\n';
doc+='  created_at TIMESTAMP DEFAULT NOW(),\n';
doc+='  updated_at TIMESTAMP DEFAULT NOW()\n';
doc+=');\n```\n\n';
doc+='### 3. PlanStep\n';
doc+=(G?'**目的**: プランの各ステップ詳細':'**Purpose**: Details of each plan step')+'\n\n';
doc+='```sql\n';
doc+='CREATE TABLE plan_steps (\n';
doc+='  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc+='  plan_id UUID NOT NULL REFERENCES reverse_plans(id) ON DELETE CASCADE,\n';
doc+='  step_order INT NOT NULL, -- 1, 2, 3, 4\n';
doc+='  title VARCHAR(255) NOT NULL,\n';
doc+='  description TEXT,\n';
doc+='  status VARCHAR(20) DEFAULT \'pending\', -- \'pending\', \'in_progress\', \'completed\'\n';
doc+='  started_at TIMESTAMP,\n';
doc+='  completed_at TIMESTAMP,\n';
doc+='  created_at TIMESTAMP DEFAULT NOW(),\n';
doc+='  updated_at TIMESTAMP DEFAULT NOW(),\n';
doc+='  UNIQUE(plan_id, step_order)\n';
doc+=');\n```\n\n';
doc+='### 4. ProgressTracking\n';
doc+=(G?'**目的**: KPI進捗の時系列データ':'**Purpose**: Time-series KPI progress data')+'\n\n';
doc+='```sql\n';
doc+='CREATE TABLE progress_tracking (\n';
doc+='  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc+='  goal_id UUID NOT NULL REFERENCES user_goals(id) ON DELETE CASCADE,\n';
doc+='  measured_value DECIMAL(10,2) NOT NULL,\n';
doc+='  measured_at TIMESTAMP DEFAULT NOW(),\n';
doc+='  notes TEXT,\n';
doc+='  created_at TIMESTAMP DEFAULT NOW()\n';
doc+=');\n\n';
doc+='CREATE INDEX idx_progress_goal_time ON progress_tracking(goal_id, measured_at DESC);\n';
doc+='```\n\n';
doc+='### 5. PlanAdjustment\n';
doc+=(G?'**目的**: プラン修正履歴（継続的改善）':'**Purpose**: Plan adjustment history (continuous improvement)')+'\n\n';
doc+='```sql\n';
doc+='CREATE TABLE plan_adjustments (\n';
doc+='  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc+='  plan_id UUID NOT NULL REFERENCES reverse_plans(id) ON DELETE CASCADE,\n';
doc+='  reason TEXT NOT NULL, -- '+(G?'調整理由':'Reason for adjustment')+'\n';
doc+='  before_value TEXT, -- JSON: '+(G?'調整前の値':'Before values')+'\n';
doc+='  after_value TEXT, -- JSON: '+(G?'調整後の値':'After values')+'\n';
doc+='  adjusted_by UUID REFERENCES users(id),\n';
doc+='  adjusted_at TIMESTAMP DEFAULT NOW()\n';
doc+=');\n```\n\n';
doc+=(G?'## スキーマ使用例':'## Schema Usage Example')+'\n\n';
doc+='```javascript\n';
doc+='// 1. '+(G?'目標作成':'Create goal')+'\n';
doc+='const goal = await supabase.from(\'user_goals\').insert({\n';
doc+='  user_id: userId,\n';
doc+='  goal_type: \'mrr\',\n';
doc+='  target_value: 100000, // '+(G?'目標MRR: 10万円/月':'Target MRR: $1000/mo')+'\n';
doc+='  deadline: \'2026-06-30\',\n';
doc+='}).select().single();\n\n';
doc+='// 2. '+(G?'リバースプラン作成':'Create reverse plan')+'\n';
doc+='const plan = await supabase.from(\'reverse_plans\').insert({\n';
doc+='  goal_id: goal.id,\n';
doc+='  title: \'MRR '+flowSteps[0]+'\',\n';
doc+='  total_steps: 4\n';
doc+='}).select().single();\n\n';
doc+='// 3. '+(G?'進捗記録':'Record progress')+'\n';
doc+='await supabase.from(\'progress_tracking\').insert({\n';
doc+='  goal_id: goal.id,\n';
doc+='  measured_value: 45000, // '+(G?'現在のMRR':'Current MRR')+'\n';
doc+='  notes: \'Month 2 progress\'\n';
doc+='}); \n\n';
doc+='// 4. '+(G?'目標達成率計算':'Calculate achievement rate')+'\n';
doc+='const achievementRate = (goal.current_value / goal.target_value) * 100;\n';
doc+='```\n\n';
return doc;
}
function _genDoc38(G, domain, rf, a, pn) {
let doc='# '+pn+' — '+(G?'ビジネスモデル・収益化戦略':'Business Model & Monetization Strategy')+'\n\n';
doc+=G?'**重要**: このドキュメントはビジネス視点からの収益モデル・価格戦略・コンバージョンファネルを定義します。エンジニアリングとビジネス戦略を接続する重要なドキュメントです。\n\n':'**IMPORTANT**: This document defines revenue model, pricing strategy, and conversion funnel from business perspective. Critical bridge between engineering and business strategy.\n\n';
// Revenue Model Analysis
doc+=(G?'## 収益モデル分析':'## Revenue Model Analysis')+'\n\n';
const revenueModels={
saas:{model:G?'サブスクリプション':'Subscription',tiers:G?'Free / Pro (¥980/月) / Enterprise (¥9,800/月)':'Free / Pro ($10/mo) / Enterprise ($100/mo)',primary:G?'月次定期課金':'Monthly recurring revenue'},
ec:{model:G?'手数料 + 決済手数料':'Commission + Payment fees',tiers:G?'出品者手数料5% + 決済手数料3.6%':'Seller fee 5% + Payment fee 3.6%',primary:G?'取引総額(GMV)の一定割合':'% of GMV'},
marketplace:{model:G?'取引手数料':'Transaction fees',tiers:G?'出品者5% + 購入者3% or 一律8%':'Seller 5% + Buyer 3% or Flat 8%',primary:G?'成約時手数料':'Commission on completion'},
education:{model:G?'フリーミアム':'Freemium',tiers:G?'無料コンテンツ → プレミアムコース購入':'Free content → Premium course purchase',primary:G?'コース販売 + サブスク':'Course sales + Subscription'},
fintech:{model:G?'取引手数料 + サブスク':'Transaction fees + Subscription',tiers:G?'無料取引(上限あり) / Pro (¥980/月 無制限)':'Free trades (limited) / Pro ($10/mo unlimited)',primary:G?'取引量 + 有料会員':'Transaction volume + Paid members'},
booking:{model:G?'予約手数料':'Booking fees',tiers:G?'予約1件あたり10% or 月額サブスク':'10% per booking or Monthly subscription',primary:G?'予約成立時の手数料':'Commission on booking'},
content:{model:G?'広告 + サブスク':'Ads + Subscription',tiers:G?'無料(広告表示) / プレミアム(¥480/月 広告なし)':'Free (with ads) / Premium ($5/mo ad-free)',primary:G?'広告収益 + 有料会員':'Ad revenue + Paid members'},
community:{model:G?'フリーミアム':'Freemium',tiers:G?'基本無料 / プレミアム機能(¥500/月)':'Free basic / Premium features ($5/mo)',primary:G?'有料会員 + 広告':'Paid members + Ads'}
};
const revModel=revenueModels[domain]||{model:G?'サブスクリプション':'Subscription',tiers:G?'Free / Pro / Enterprise':'Free / Pro / Enterprise',primary:G?'月次定期課金':'Monthly recurring revenue'};
doc+='**'+(G?'推奨モデル':'Recommended Model')+'** ('+domain+'): '+revModel.model+'\n\n';
doc+='**'+(G?'料金体系':'Pricing Tiers')+'**:\n'+revModel.tiers+'\n\n';
doc+='**'+(G?'主要収益源':'Primary Revenue')+'**: '+revModel.primary+'\n\n';
// Pricing Strategy
doc+=(G?'## 価格戦略':'## Pricing Strategy')+'\n\n';
doc+='### Tier'+(G?'設計':'Design')+'\n\n';
doc+='| Tier | '+(G?'価格':'Price')+' | '+(G?'主要機能':'Key Features')+' | '+(G?'ターゲット':'Target')+' |\n';
doc+='|------|------|------|------|\n';
doc+='| Free | ¥0 | '+(G?'基本機能・制限あり':'Basic features, limited')+' | '+(G?'個人・お試し':'Personal, trial')+' |\n';
doc+='| Pro | ¥980/'+( G?'月':'mo')+' | '+(G?'全機能・制限緩和':'All features, relaxed limits')+' | '+(G?'小規模チーム':'Small teams')+' |\n';
doc+='| Enterprise | ¥9,800/'+( G?'月':'mo')+' | '+(G?'無制限・専用サポート':'Unlimited, dedicated support')+' | '+(G?'大企業':'Enterprise')+' |\n\n';
// Conversion Funnel (Mermaid)
doc+=(G?'## コンバージョンファネル':'## Conversion Funnel')+'\n\n';
doc+='```mermaid\ngraph TD\n';
doc+='  A["'+(G?'訪問':'Visit')+' 🌐"] -->|30%| B["'+(G?'サインアップ':'Signup')+' ✍️"]\n';
doc+='  B -->|60%| C["'+(G?'アクティベーション':'Activate')+' ⚡"]\n';
doc+='  C -->|20%| D["'+(G?'有料転換':'Convert')+' 💳"]\n';
doc+='  D -->|70%| E["'+(G?'継続利用':'Retain')+' 🔁"]\n\n';
doc+='  style A fill:#e1f5ff\n';
doc+='  style B fill:#fff4e6\n';
doc+='  style C fill:#e8f5e9\n';
doc+='  style D fill:#f3e5f5\n';
doc+='  style E fill:#fce4ec\n';
doc+='```\n\n';
// KPI per stage
doc+='### '+(G?'ステージ別KPI':'KPIs per Stage')+'\n\n';
doc+='| '+(G?'ステージ':'Stage')+' | KPI | '+(G?'目標':'Target')+' | '+(G?'改善施策':'Improvement Actions')+' |\n';
doc+='|------|------|------|------|\n';
doc+='| '+(G?'訪問→サインアップ':'Visit→Signup')+' | '+( G?'サインアップ率':'Signup rate')+' | ≥30% | '+(G?'LP最適化・信頼性向上':'Optimize LP, build trust')+' |\n';
doc+='| '+(G?'サインアップ→アクティベーション':'Signup→Activation')+' | '+(G?'アクティベーション率':'Activation rate')+' | ≥60% | '+(G?'オンボーディング改善':'Improve onboarding')+' |\n';
doc+='| '+(G?'アクティベーション→有料転換':'Activation→Conversion')+' | '+(G?'有料転換率':'Conversion rate')+' | ≥20% | '+(G?'価値提示・限定オファー':'Show value, limited offer')+' |\n';
doc+='| '+(G?'有料転換→継続':'Conversion→Retention')+' | '+(G?'継続率':'Retention rate')+' | ≥70% | '+(G?'定期エンゲージメント':'Regular engagement')+' |\n\n';
// Unit Economics
doc+=(G?'## ユニットエコノミクス':'## Unit Economics')+'\n\n';
doc+='### '+(G?'概算テンプレート':'Estimation Template')+'\n\n';
doc+='**CAC** ('+(G?'顧客獲得コスト':'Customer Acquisition Cost')+')\n';
doc+='- '+(G?'広告費':'Ad spend')+': ¥100,000/'+( G?'月':'mo')+'\n';
doc+='- '+(G?'新規顧客':'New customers')+': 100/'+( G?'月':'mo')+'\n';
doc+='- **CAC = ¥1,000/'+( G?'顧客':'customer')+'**\n\n';
doc+='**LTV** ('+(G?'顧客生涯価値':'Lifetime Value')+')\n';
doc+='- ARPU ('+(G?'ユーザー単価':'Avg Revenue per User')+'): ¥980/'+( G?'月':'mo')+'\n';
doc+='- '+(G?'平均利用期間':'Avg lifetime')+': 12'+( G?'ヶ月':'months')+'\n';
doc+='- **LTV = ¥11,760**\n\n';
doc+='**LTV/CAC '+(G?'比率':'Ratio')+'**\n';
doc+='- LTV/CAC = ¥11,760 / ¥1,000 = **11.76**\n';
doc+='- '+(G?'目標':'Target')+': **≥3** ('+(G?'健全':'healthy')+')\n';
doc+='- '+(G?'評価':'Assessment')+': ✅ '+(G?'優秀':'Excellent')+'\n\n';
doc+='**Payback '+(G?'期間':'Period')+'**\n';
doc+='- CAC / ARPU = ¥1,000 / ¥980 = **1.02'+( G?'ヶ月':'months')+'**\n';
doc+='- '+(G?'目標':'Target')+': **≤12'+( G?'ヶ月':'months')+'**\n';
doc+='- '+(G?'評価':'Assessment')+': ✅ '+(G?'優秀':'Excellent')+'\n\n';
// Monetization Tactics
doc+=(G?'## 収益化戦術':'## Monetization Tactics')+'\n\n';
const domainTactics={
saas:G?['無料トライアル14日','使用量制限で有料誘導','年払い割引(2ヶ月分)']:['14-day free trial','Usage limits to drive upgrades','Annual discount (2mo free)'],
ec:G?['初回注文クーポン','まとめ買い割引','会員ランク制度']:['First order coupon','Bulk purchase discount','Member rank system'],
education:G?['最初の3レッスン無料','修了証発行は有料','コミュニティアクセス(有料)']:['First 3 lessons free','Paid certificate issuance','Premium community access'],
marketplace:G?['初回取引手数料無料','大口出品者割引','プレミアム掲載']:['First transaction fee-free','Volume seller discount','Premium listings'],
fintech:G?['少額取引無料','即時送金は有料','投資アドバイス(有料)']:['Small transaction free','Instant transfer paid','Investment advice (paid)']
};
const tactics=domainTactics[domain]||(G?['無料トライアル','使用量制限','年払い割引']:['Free trial','Usage limits','Annual discount']);
tactics.forEach((tactic,i)=>{
doc+=(i+1)+'. **'+tactic+'**\n';
});
doc+='\n';
// Growth Levers - use rfKpis to avoid variable shadowing
doc+=(G?'## 成長レバー':'## Growth Levers')+'\n\n';
doc+=G?'このドメインの主要なKPI（目標値は docs/30_goal_decomposition.md 参照）:\n\n':'Key KPIs for this domain (targets in docs/30_goal_decomposition.md):\n\n';
const rfKpis=G?rf.kpi_ja:rf.kpi_en;
rfKpis.forEach((kpi,i)=>{
doc+=(i+1)+'. '+kpi+'\n';
});
doc+='\n';
// Related Documents
doc+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc+='- **docs/30_goal_decomposition.md** — '+(G?'目標分解とKPI':'Goal decomposition & KPIs')+'\n';
doc+='- **.spec/constitution.md** — '+(G?'プロジェクトビジョン':'Project vision')+'\n';
doc+='- **docs/24_progress.md** — '+(G?'進捗追跡':'Progress tracking')+'\n';
doc+='- **docs/05_api_design.md** — '+(G?'決済API実装':'Payment API implementation')+'\n\n';
return doc;
}
function _genDoc41(G, domain, a, pn) {
const gd=DOMAIN_GROWTH[domain]||DOMAIN_GROWTH._default;
let doc='# '+pn+' — '+(G?'グロースインテリジェンス':'Growth Intelligence')+'\n\n';
// Section 1: Stack Compatibility Score
const syn=calcSynergy(a);
doc+='## '+(G?'1. スタック相性スコア':'1. Tech Stack Compatibility Score')+'\n\n';
doc+='| '+(G?'次元':'Dimension')+' | '+(G?'スコア':'Score')+' | '+(G?'説明':'Description')+' |\n|-----|-------|------|\n';
const dimNames=G?['FE↔BE親和性','エコシステム統一性','ドメイン適合度','デプロイ整合性','複雑度バランス']:['FE↔BE Affinity','Ecosystem Unity','Domain Fit','Deploy Alignment','Complexity Balance'];
[syn.d1,syn.d2,syn.d3,syn.d4,syn.d5].forEach((s,i)=>{
doc+='| '+dimNames[i]+' | '+s+'/100 | '+(s>=80?(G?'✅ 良好':'✅ Good'):s>=60?(G?'⚠️ 改善余地':'⚠️ Room to improve'):(G?'❌ 要対策':'❌ Action needed'))+' |\n';
});
doc+='\n'+(G?'**総合スタックスコア**: ':'**Overall Stack Score**: ')+syn.overall+'/100\n\n';
// Compat warnings
const cw=checkCompat(a);
if(cw.length>0){
doc+='### '+(G?'互換性アラート':'Compatibility Alerts')+'\n\n';
cw.slice(0,8).forEach(r=>{
doc+='- '+(r.severity==='error'?'❌':'⚠️')+' **'+r.id+'**: '+(G?r.msg_ja:r.msg_en)+'\n';
});
doc+='\n';
}
// Section 2: Growth Funnel (Mermaid)
const stages=G?gd.fj:gd.fe;
doc+='## '+(G?'2. ドメイン別グロースファネル':'2. Domain Growth Funnel')+'\n\n';
doc+='```mermaid\ngraph LR\n';
stages.forEach((s,i)=>{
if(i<stages.length-1) doc+='  S'+i+'["'+s+' ('+gd.cvr[i]+'%)"] --> S'+(i+1)+'["'+stages[i+1]+' ('+gd.cvr[i+1]+'%)"]\n';
});
doc+='```\n\n';
doc+='| '+(G?'ステージ':'Stage')+' | '+(G?'ベンチマーク':'Benchmark')+' | '+(G?'前段からのCVR':'Stage CVR')+' |\n|--------|-----------|----------|\n';
stages.forEach((s,i)=>{
const cvr=i===0?'-':((gd.cvr[i]/gd.cvr[i-1]*100).toFixed(1)+'%');
doc+='| '+s+' | '+gd.cvr[i]+'% | '+cvr+' |\n';
});
doc+='\n';
// Section 3: Growth Equation
doc+='## '+(G?'3. グロース方程式':'3. Growth Equation')+'\n\n';
doc+='```\n'+gd.eq+'\n```\n\n';
doc+=(G?'**感度分析**: 各変数を10%改善すると、全体収益は約10%向上（複利効果で実際はそれ以上）。複数のレバーを同時に改善することで掛け算的成長が可能。\n\n':'**Sensitivity**: Improving each variable by 10% yields ~10% revenue lift (compounding makes it higher). Simultaneously improving multiple levers creates multiplicative growth.\n\n');
// Section 4: Growth Levers
const levers=G?gd.lj:gd.le;
doc+='## '+(G?'4. グロースレバー（優先順）':'4. Growth Levers (Prioritized)')+'\n\n';
levers.forEach((l,i)=>{doc+=(i+1)+'. '+l+'\n';});
doc+='\n';
// Section 5: Pricing Strategy
doc+='## '+(G?'5. 価格戦略（松竹梅モデル）':'5. Pricing Strategy (Three-Tier Model)')+'\n\n';
const prices=G?gd.pj:gd.pe;
const tierNames=G?['🥉 松（エントリー）','🥈 竹（メイン）★推奨','🥇 梅（プレミアム）']:['🥉 Good (Entry)','🥈 Better (Main) ★Recommended','🥇 Best (Premium)'];
doc+='| '+(G?'ティア':'Tier')+' | '+(G?'価格帯':'Price Range')+' |\n|------|------|\n';
prices.forEach((p,i)=>{doc+='| '+tierNames[i]+' | '+p+' |\n';});
doc+='\n'+(G?'> **心理効果**: 3択を提示すると中間（竹）が選ばれやすい（妥協効果）。最上位は「アンカー」として竹の割安感を演出する。\n\n':'> **Psychology**: Presenting 3 options makes the middle tier most popular (compromise effect). The top tier serves as an anchor to make the middle tier feel like good value.\n\n');
// Section 6: Performance Budget
doc+='## '+(G?'6. パフォーマンス予算':'6. Performance Budget')+'\n\n';
doc+='| '+(G?'指標':'Metric')+' | '+(G?'目標':'Target')+' | '+(G?'ビジネスインパクト':'Business Impact')+' |\n|------|------|-------|\n';
doc+='| LCP | < 2.5s | '+(G?'離脱率-25%':'Bounce rate -25%')+' |\n';
doc+='| FID | < 100ms | '+(G?'UXスコア+20pt':'UX score +20pt')+' |\n';
doc+='| CLS | < 0.1 | '+(G?'信頼性+15%':'Trust +15%')+' |\n';
doc+='| '+(G?'初回バンドル':'Initial Bundle')+' | < 200KB (gzip) | '+(G?'FCP改善':'FCP improvement')+' |\n\n';
// Tech-specific tips
const fe=a.frontend||'';
if(fe.includes('Next')){
doc+=(G?'**Next.js最適化**: ISR活用, next/image, Edge Middleware, Server Components優先\n\n':'**Next.js Optimization**: Use ISR, next/image, Edge Middleware, prefer Server Components\n\n');
}else if(fe.includes('Vue')||fe.includes('Nuxt')){
doc+=(G?'**Vue/Nuxt最適化**: Lazy Hydration, コンポーネント分割, auto-imports\n\n':'**Vue/Nuxt Optimization**: Lazy Hydration, component splitting, auto-imports\n\n');
}else{
doc+=(G?'**SPA最適化**: React.lazy + Suspense, ルート分割, Dynamic Import\n\n':'**SPA Optimization**: React.lazy + Suspense, route splitting, Dynamic Import\n\n');
}
// Section 7: Cross-references
doc+='## '+(G?'7. 関連ドキュメント':'7. Related Documents')+'\n\n';
doc+='- **docs/30_goal_decomposition.md** — '+(G?'目標分解とKPI':'Goal decomposition & KPIs')+'\n';
doc+='- **docs/38_business_model.md** — '+(G?'ビジネスモデル詳細（決済設定時）':'Business model details (when payment configured)')+'\n';
doc+='- **docs/24_progress.md** — '+(G?'進捗追跡':'Progress tracking')+'\n';
doc+='- **docs/28_qa_strategy.md** — '+(G?'品質戦略':'QA strategy')+'\n\n';
return doc;
}
// ── Orchestrator (P15 pattern: short, delegates to sub-generators) ──
function genPillar10_ReverseEngineering(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'_default';
const rf=REVERSE_FLOW_MAP[domain]||REVERSE_FLOW_MAP._default;
const flowSteps=G?rf.flow_ja:rf.flow_en;
const kpis=G?rf.kpi_ja:rf.kpi_en;
const risks=G?rf.risks_ja:rf.risks_en;
const entities=(a.data_entities||'').split(/[,、]\s*/).map(s=>s.trim()).filter(Boolean);
const features=(a.mvp_features||'').split(/[,、\n]/).map(s=>s.trim()).filter(Boolean);
S.files['docs/29_reverse_engineering.md']=_genDoc29(G,rf,domain,flowSteps,kpis,risks,a);
S.files['docs/30_goal_decomposition.md']=_genDoc30(G,rf,flowSteps,kpis,features,entities,a);
if(a.payment&&!isNone(a.payment)){
S.files['docs/38_business_model.md']=_genDoc38(G,domain,rf,a,pn);
}
S.files['docs/41_growth_intelligence.md']=_genDoc41(G,domain,a,pn);
}


function genPillar11_ImplIntelligence(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'_default';
const appType=detectAppType(a);
const aiLevel=a.ai_auto||'none';
const frontend=a.frontend||'React + Vite';
const backend=a.backend||'Supabase';
const db=a.database||'PostgreSQL';
// ── docs/39_implementation_playbook.md ──
const pattern=DOMAIN_IMPL_PATTERN[domain]||DOMAIN_IMPL_PATTERN._default;
const appTypePattern=APP_TYPE_MAP[appType]||APP_TYPE_MAP.spa;
const entities=(a.data_entities||'User').split(',').map(e=>e.trim());
let doc39='';
doc39+='# '+(G?'実装プレイブック':'Implementation Playbook')+'\n\n';
doc39+=(G?'**プロジェクト**：':'**Project**: ')+pn+'\n';
doc39+=(G?'**業種**：':'**Domain**: ')+(G?'検知結果 - ':'Detected - ')+domain+'\n';
doc39+=(G?'**アプリタイプ**：':'**App Type**: ')+appType+'\n';
doc39+=(G?'**生成日**：':'**Generated**: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc39+='---\n\n';
// 1. Domain-Specific Implementation Patterns
doc39+='## '+(G?'1. 業種別実装パターン':'1. Domain-Specific Implementation Patterns')+'\n\n';
doc39+='### '+(G?'推奨実装手法':'Recommended Practices')+'\n';
(G?pattern.impl_ja:pattern.impl_en).forEach((p,i)=>{
doc39+=(i+1)+'. '+p+'\n';
});
doc39+='\n### '+(G?'ガードレール（防止すべき典型バグ）':'Guard Rails (Typical Bugs to Prevent)')+'\n';
(G?pattern.guard_ja:pattern.guard_en).forEach((g,i)=>{
doc39+='- ❌ '+g+'\n';
});
doc39+='\n### '+(G?'擬似コードテンプレート':'Pseudo-code Template')+'\n';
doc39+='```javascript\n';
doc39+=pattern.pseudo+'\n';
doc39+='```\n\n';
// 2. Stack-Specific Guidance
doc39+='## '+(G?'2. スタック固有ガイダンス':'2. Stack-Specific Guidance')+'\n\n';
doc39+='### '+(G?'フロントエンド：':'Frontend: ')+frontend+'\n';
if(frontend.includes('Next')){
doc39+=(G?'- App Routerを使用（Pages Routerは非推奨）\n':'- Use App Router (Pages Router deprecated)\n');
doc39+=(G?'- サーバーコンポーネントを優先、クライアントコンポーネントは必要最小限\n':'- Prefer Server Components, minimize Client Components\n');
doc39+=(G?'- データフェッチはasync/await直接記述\n':'- Data fetching with async/await directly\n');
}else if(frontend.includes('Vite')||frontend.includes('SPA')){
doc39+=(G?'- 状態管理はZustand推奨（Reduxは大規模のみ）\n':'- State management with Zustand (Redux for large-scale only)\n');
doc39+=(G?'- コード分割はReact.lazy+Suspense\n':'- Code splitting with React.lazy + Suspense\n');
doc39+=(G?'- ビルド最適化はVite plugin-react-swc\n':'- Build optimization with Vite plugin-react-swc\n');
}else if(frontend.includes('Vue')){
doc39+=(G?'- Composition API優先\n':'- Prefer Composition API\n');
doc39+=(G?'- 状態管理はPinia\n':'- State management with Pinia\n');
doc39+=(G?'- TypeScript strict mode推奨\n':'- Recommend TypeScript strict mode\n');
}
doc39+='\n### '+(G?'バックエンド：':'Backend: ')+backend+'\n';
if(backend.includes('Supabase')){
doc39+=(G?'- Row Level Security (RLS)を全テーブルに設定\n':'- Set Row Level Security (RLS) on all tables\n');
doc39+=(G?'- Supabase Edgeは軽量処理のみ（重い処理は別途API）\n':'- Supabase Edge for lightweight tasks only (heavy tasks in separate API)\n');
doc39+=(G?'- Realtime subscriptionsは必要最小限（コスト注意）\n':'- Minimize Realtime subscriptions (cost consideration)\n');
}else if(backend.includes('Firebase')){
doc39+=(G?'- Firestore Security Rulesを厳格に設定\n':'- Strictly configure Firestore Security Rules\n');
doc39+=(G?'- Cloud Functionsは第2世代推奨\n':'- Recommend Cloud Functions Gen 2\n');
doc39+=(G?'- コスト最適化：読み取り回数削減、複合クエリ活用\n':'- Cost optimization: reduce reads, use composite queries\n');
}else if(backend.includes('Node')){
doc39+=(G?'- Express middlewareでバリデーション統一\n':'- Unified validation with Express middleware\n');
doc39+=(G?'- エラーハンドリングは集約ハンドラ\n':'- Centralized error handler\n');
doc39+=(G?'- 環境変数は.envで管理、dotenv-safe推奨\n':'- Manage env vars with .env, recommend dotenv-safe\n');
}
doc39+='\n### '+(G?'データベース：':'Database: ')+db+'\n';
if(db.includes('PostgreSQL')){
doc39+=(G?'- マイグレーションツールはPrisma/Drizzle\n':'- Migration tool: Prisma/Drizzle\n');
doc39+=(G?'- インデックスは外部キー・検索条件カラムに必須\n':'- Indexes required on FKs and search columns\n');
doc39+=(G?'- トランザクション分離レベルはREAD COMMITTED（デフォルト）\n':'- Transaction isolation: READ COMMITTED (default)\n');
}else if(db.includes('MongoDB')){
doc39+=(G?'- スキーマ検証はMongooseで定義\n':'- Schema validation with Mongoose\n');
doc39+=(G?'- インデックスはクエリパフォーマンス分析後に作成\n':'- Create indexes after query performance analysis\n');
doc39+=(G?'- 大規模データはシャーディング検討\n':'- Consider sharding for large-scale data\n');
}
doc39+='\n';
// 3. App Type Best Practices
doc39+='## '+(G?'3. アプリタイプ別ベストプラクティス':'3. App Type Best Practices')+'\n\n';
doc39+='### '+(G?'推奨パターン':'Recommended Patterns')+' ('+appType+')\n';
(G?appTypePattern.patterns_ja:appTypePattern.patterns_en).forEach(p=>{
doc39+='- ✅ '+p+'\n';
});
doc39+='\n### '+(G?'アンチパターン（避けるべき）':'Anti-patterns (Avoid)')+'\n';
(G?appTypePattern.antipatterns_ja:appTypePattern.antipatterns_en).forEach(ap=>{
doc39+='- ⚠️ '+ap+'\n';
});
doc39+='\n';
// 4. Entity-Specific Pseudo-code
doc39+='## '+(G?'4. エンティティ別擬似コード':'4. Entity-Specific Pseudo-code')+'\n\n';
entities.slice(0,3).forEach(ent=>{
const cols=getEntityColumns(ent,G,entities);
if(!cols||cols.length===0){
doc39+='### '+ent+'\n';
doc39+=(G?'※ 未定義エンティティ。ENTITY_COLUMNSに追加してください。\n\n':'※ Undefined entity. Add to ENTITY_COLUMNS.\n\n');
return;
}
const methods=getEntityMethods(ent)||['GET','POST','PUT','DELETE'];
doc39+='### '+ent+'\n';
doc39+='```javascript\n';
if(methods.includes('POST')){
doc39+='// CREATE\n';
doc39+='async function create'+ent+'(data) {\n';
doc39+='  validateInput(data); // '+(G?'入力検証':'Input validation')+'\n';
doc39+='  const result = await db.insert("'+pluralize(ent)+'", data);\n';
doc39+='  logAudit("CREATE_'+ent.toUpperCase()+'", result.id); // '+(G?'監査ログ':'Audit log')+'\n';
doc39+='  return result;\n';
doc39+='}\n\n';
}
if(methods.includes('GET')){
doc39+='// READ\n';
doc39+='async function get'+ent+'(id) {\n';
doc39+='  const result = await db.query("SELECT * FROM '+pluralize(ent)+' WHERE id = ?", [id]);\n';
doc39+='  if (!result) throw new NotFoundError();\n';
doc39+='  return result;\n';
doc39+='}\n\n';
}
if(methods.includes('PUT')){
doc39+='// UPDATE\n';
doc39+='async function update'+ent+'(id, data) {\n';
doc39+='  validateInput(data);\n';
doc39+='  await db.transaction(async () => {\n';
doc39+='    const current = await db.query("SELECT * FROM '+pluralize(ent)+' WHERE id = ? FOR UPDATE", [id]);\n';
doc39+='    await db.execute("UPDATE '+pluralize(ent)+' SET ... WHERE id = ?", [..., id]);\n';
doc39+='    logAudit("UPDATE_'+ent.toUpperCase()+'", id);\n';
doc39+='  });\n';
doc39+='}\n\n';
}
if(methods.includes('DELETE')){
doc39+='// DELETE (Soft delete recommended)\n';
doc39+='async function delete'+ent+'(id) {\n';
doc39+='  await db.execute("UPDATE '+pluralize(ent)+' SET deleted_at = NOW() WHERE id = ?", [id]);\n';
doc39+='  logAudit("DELETE_'+ent.toUpperCase()+'", id);\n';
doc39+='}\n';
}
doc39+='```\n\n';
});
// 5. Cross-Cutting Concerns Checklist
doc39+='## '+(G?'5. 横断的関心事チェックリスト':'5. Cross-Cutting Concerns Checklist')+'\n\n';
Object.entries(CROSS_CUTTING_IMPL).forEach(([key,val])=>{
const title={auth:G?'認証・認可':'Auth',error:G?'エラーハンドリング':'Error Handling',cache:G?'キャッシュ':'Cache',i18n:G?'国際化':'i18n',audit:G?'監査ログ':'Audit Log',upload:G?'ファイルアップロード':'File Upload',rate:G?'レート制限':'Rate Limiting',validation:G?'入力検証':'Validation'}[key]||key;
doc39+='### '+title+'\n';
(G?val.ja:val.en).forEach(item=>{
doc39+='- [ ] '+item+'\n';
});
doc39+='\n';
});
doc39+='---\n';
doc39+=(G?'*このプレイブックはDevForge v9が自動生成しました。プロジェクト固有の要件に応じて調整してください。*\n':'*This playbook was auto-generated by DevForge v9. Adjust according to project-specific requirements.*\n');
S.files['docs/39_implementation_playbook.md']=doc39;
// ── docs/40_ai_dev_runbook.md ──
let doc40='';
doc40+='# '+(G?'AI開発運用手順書':'AI Development Runbook')+'\n\n';
doc40+=(G?'**プロジェクト**：':'**Project**: ')+pn+'\n';
doc40+=(G?'**AIレベル**：':'**AI Level**: ')+aiLevel+'\n';
doc40+=(G?'**生成日**：':'**Generated**: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc40+='---\n\n';
// 1. AI Operation Workflow
doc40+='## '+(G?'1. AI運用ワークフロー':'1. AI Operation Workflow')+'\n\n';
if(aiLevel==='none'||aiLevel==='なし'){
doc40+=(G?'※ AIレベルが「なし」のため、基本的なフローのみ記載します。\n\n':'※ AI level is "none", only basic flow described.\n\n');
doc40+='### '+(G?'基本フロー':'Basic Flow')+'\n';
doc40+='1. '+(G?'仕様書レビュー（手動）':'Manual spec review')+'\n';
doc40+='2. '+(G?'実装（コード記述）':'Implementation (coding)')+'\n';
doc40+='3. '+(G?'テスト実行':'Run tests')+'\n';
doc40+='4. '+(G?'デプロイ':'Deploy')+'\n';
}else{
doc40+='### '+(G?'Write → Select → Compress → Isolate サイクル':'Write → Select → Compress → Isolate Cycle')+'\n\n';
doc40+='#### Phase 1: Write (仕様生成)\n';
doc40+=(G?'- AI Brief (`AI_BRIEF.md`) を読み込み\n':'- Load AI Brief (`AI_BRIEF.md`)\n');
doc40+=(G?'- SDD仕様書 (`.spec/constitution.md`) を確認\n':'- Review SDD specs (`.spec/constitution.md`)\n');
doc40+=(G?'- 実装プレイブック (`docs/39_implementation_playbook.md`) で業種別パターン確認\n':'- Check domain patterns in Implementation Playbook (`docs/39_implementation_playbook.md`)\n');
doc40+=(G?'- タスク分解：`docs/30_goal_decomposition.md` 参照\n':'- Task decomposition: refer to `docs/30_goal_decomposition.md`\n');
doc40+='\n#### Phase 2: Select (ファイル選択)\n';
doc40+=(G?'- **タスク別ファイル選択マトリクス**を使用（下記参照）\n':'- Use **Task-Specific File Selection Matrix** (see below)\n');
doc40+=(G?'- トークン見積もり：1ファイル = 平均500-2000トークン\n':'- Token estimate: 1 file = avg 500-2000 tokens\n');
doc40+=(G?'- 優先度：仕様書 > エンティティ定義 > 実装ガイド > テストケース\n':'- Priority: Specs > Entity definitions > Impl guide > Test cases\n');
doc40+='\n#### Phase 3: Compress (コンテキスト圧縮)\n';
doc40+=(G?'- コンテキスト使用量80%超過時に発動\n':'- Activate when context usage exceeds 80%\n');
doc40+=(G?'- 圧縮対象：過去の会話履歴、参照済みファイルの要約化\n':'- Compress: past conversation history, summarize referenced files\n');
doc40+=(G?'- 保持対象：現在のタスク、直近のエラーログ\n':'- Preserve: current task, recent error logs\n');
doc40+='\n#### Phase 4: Isolate (サブエージェント分離)\n';
doc40+=(G?'- 独立タスクは専用エージェントに委譲\n':'- Delegate independent tasks to specialized agents\n');
doc40+=(G?'- ハンドオフ時はサマリーのみ共有（詳細は不要）\n':'- Share only summary on handoff (details unnecessary)\n');
doc40+=(G?'- エージェント間引継ぎ：YAMLフォーマット（`AGENTS.md`参照）\n':'- Inter-agent handoff: YAML format (see `AGENTS.md`)\n');
doc40+='\n';
}

// 2. File Selection Matrix
doc40+='## '+(G?'2. タスク別ファイル選択マトリクス':'2. Task-Specific File Selection Matrix')+'\n\n';
doc40+='| '+(G?'タスクタイプ':'Task Type')+' | '+(G?'必読ファイル':'Must-Read Files')+' | '+(G?'推奨ファイル':'Recommended Files')+' |\n';
doc40+='|---|---|---|\n';
doc40+='| '+(G?'新機能実装':'New Feature')+' | `.spec/constitution.md`, `docs/04_er_diagram.md`, `docs/39_implementation_playbook.md` | `docs/26_design_system.md`, `docs/06_screen_design.md` |\n';
doc40+='| '+(G?'バグ修正':'Bug Fix')+' | `docs/25_error_logs.md`, `docs/37_bug_prevention.md`, `docs/07_test_cases.md` | `docs/34_incident_response.md`, `docs/33_test_matrix.md` |\n';
doc40+='| '+(G?'テスト追加':'Add Tests')+' | `docs/07_test_cases.md`, `docs/36_test_strategy.md`, `docs/33_test_matrix.md` | `.spec/verification.md`, `docs/28_qa_strategy.md` |\n';
doc40+='| '+(G?'リファクタリング':'Refactoring')+' | `docs/03_architecture.md`, `docs/39_implementation_playbook.md` | `docs/26_design_system.md`, `CLAUDE.md` |\n';
doc40+='| '+(G?'ドキュメント更新':'Doc Update')+' | `.spec/specification.md`, `docs/24_progress.md` | `docs/31_industry_playbook.md`, `AI_BRIEF.md` |\n';
doc40+='| '+(G?'API実装':'API Impl')+' | `docs/05_api_design.md`, `docs/04_er_diagram.md`, `docs/08_security.md` | `docs/39_implementation_playbook.md`, `docs/28_qa_strategy.md` |\n';
doc40+='\n';
// 3. Error Recovery Protocol
doc40+='## '+(G?'3. エラー復旧プロトコル':'3. Error Recovery Protocol')+'\n\n';
doc40+='### '+(G?'業種別典型エラーと対処法':'Domain-Specific Typical Errors & Solutions')+'\n\n';
const domainErrors={
education:{ja:'進捗率100%超過 → イベントソーシングの集計ロジック確認',en:'Progress >100% → Check event sourcing aggregation logic'},
ec:{ja:'在庫マイナス → 楽観的ロックのversion列チェック漏れ',en:'Negative stock → Missing optimistic lock version check'},
fintech:{ja:'残高不一致 → トランザクション境界の見直し',en:'Balance mismatch → Review transaction boundaries'},
health:{ja:'同意なしアクセス → hasConsent()の条件分岐追加',en:'Unauthorized access → Add hasConsent() condition'},
marketplace:{ja:'手数料計算エラー → サーバーサイド検証の強化',en:'Fee calculation error → Strengthen server-side validation'},
_default:{ja:'データ不整合 → トランザクション漏れ確認',en:'Data inconsistency → Check missing transactions'}
};
const errMsg=domainErrors[domain]||domainErrors._default;
doc40+='**'+domain+'**: '+(G?errMsg.ja:errMsg.en)+'\n\n';
doc40+='### '+(G?'一般的エラー対処フロー':'General Error Handling Flow')+'\n';
doc40+='1. '+(G?'`docs/25_error_logs.md` にエラー記録':'Record error in `docs/25_error_logs.md`')+'\n';
doc40+='2. '+(G?'`docs/37_bug_prevention.md` のチェックリスト確認':'Check checklist in `docs/37_bug_prevention.md`')+'\n';
doc40+='3. '+(G?'該当ファイルの修正':'Fix relevant files')+'\n';
doc40+='4. '+(G?'テスト追加（再発防止）':'Add tests (prevent recurrence)')+'\n';
doc40+='5. '+(G?'`docs/24_progress.md` に対応記録':'Record response in `docs/24_progress.md`')+'\n';
doc40+='\n';
// 4. Context Management Strategy
doc40+='## '+(G?'4. コンテキスト管理戦略':'4. Context Management Strategy')+'\n\n';
doc40+='### '+(G?'トークン予算配分':'Token Budget Allocation')+'\n';
doc40+='- '+(G?'タスク指示・会話：40%':'Task instructions & conversation: 40%')+'\n';
doc40+='- '+(G?'仕様書・設計：30%':'Specs & design: 30%')+'\n';
doc40+='- '+(G?'実装ガイド・進捗：20%':'Impl guide & progress: 20%')+'\n';
doc40+='- '+(G?'バッファ（エラーログなど）：10%':'Buffer (error logs, etc.): 10%')+'\n';
doc40+='\n### '+(G?'圧縮タイミング':'Compression Timing')+'\n';
doc40+='- '+(G?'コンテキスト使用量 < 50%：圧縮不要':'Context usage < 50%: No compression needed')+'\n';
doc40+='- '+(G?'50% ~ 80%：過去の会話履歴を要約':'50% ~ 80%: Summarize past conversation')+'\n';
doc40+='- '+(G?'80% ~ 95%：参照ファイルを要約、古いエラーログ削除':'80% ~ 95%: Summarize files, delete old error logs')+'\n';
doc40+='- '+(G?'95%超：サブエージェント分離またはタスク分割':'> 95%: Isolate sub-agent or split task')+'\n';
doc40+='\n';
// 5. Agent Handoff Protocol
if(aiLevel==='multi'||aiLevel==='full'||aiLevel==='orch'){
doc40+='## '+(G?'5. エージェント間ハンドオフ手順':'5. Agent Handoff Protocol')+'\n\n';
doc40+=(G?'詳細は `AGENTS.md` の「Agent Specialization Matrix」参照。\n\n':'See `AGENTS.md` "Agent Specialization Matrix" for details.\n\n');
doc40+='### '+(G?'ハンドオフYAMLフォーマット':'Handoff YAML Format')+'\n';
doc40+='```yaml\n';
doc40+='from_agent: planning\n';
doc40+='to_agent: implementation\n';
doc40+='task: Implement User authentication flow\n';
doc40+='context:\n';
doc40+='  entities: [User, Session]\n';
doc40+='  auth_method: Supabase Auth\n';
doc40+='  files_to_read:\n';
doc40+='    - .spec/constitution.md\n';
doc40+='    - docs/04_er_diagram.md\n';
doc40+='    - docs/39_implementation_playbook.md\n';
doc40+='status: pending\n';
doc40+='```\n\n';
}

doc40+='---\n';
doc40+=(G?'*この運用手順書はDevForge v9が自動生成しました。AIレベルに応じて適宜カスタマイズしてください。*\n':'*This runbook was auto-generated by DevForge v9. Customize according to AI level.*\n');
S.files['docs/40_ai_dev_runbook.md']=doc40;
// ── skills/impl-patterns.md (conditional) ──
if(aiLevel!=='none'&&aiLevel!=='なし'){
let skillDoc='';
skillDoc+='# '+(G?'実装パターンスキルカタログ':'Implementation Patterns Skill Catalog')+'\n\n';
skillDoc+=(G?'> Manus Skills形式の実装スキル定義\n\n':'> Implementation skills in Manus Skills format\n\n');
skillDoc+='**'+(G?'業種':'Domain')+'**: '+domain+'\n';
skillDoc+='**'+(G?'スタック':'Stack')+'**: '+frontend+' + '+backend+'\n\n';
skillDoc+='---\n\n';
// Thinking Axis for Domain
skillDoc+='## '+(G?'思考軸（Thinking Axis）':'Thinking Axis')+'\n\n';
const thinkingAxis={
education:{ja:['学習進捗の可視化','コンテンツの段階的解放','修了判定の厳格性'],en:['Visualize learning progress','Gradual content unlocking','Strict completion criteria']},
ec:{ja:['在庫の正確性','決済の冪等性','カート放棄防止'],en:['Inventory accuracy','Payment idempotency','Cart abandonment prevention']},
fintech:{ja:['トランザクション整合性','監査ログの完全性','コンプライアンス準拠'],en:['Transaction consistency','Audit log completeness','Compliance adherence']},
health:{ja:['患者データ保護','同意管理','アクセス監査'],en:['Patient data protection','Consent management','Access auditing']},
_default:{ja:['データ整合性','セキュリティ','ユーザー体験'],en:['Data integrity','Security','User experience']}
};
const axis=(thinkingAxis[domain]||thinkingAxis._default);
(G?axis.ja:axis.en).forEach((a,i)=>{
skillDoc+=(i+1)+'. '+a+'\n';
});
skillDoc+='\n';
// 4-Layer Skills
skillDoc+='## '+(G?'4層スキル構造':'4-Layer Skill Structure')+'\n\n';
const layers=[
{id:'planning',name_ja:'企画層',name_en:'Planning',skills_ja:['要件定義','技術選定'],skills_en:['Requirement definition','Tech stack selection']},
{id:'design',name_ja:'設計層',name_en:'Design',skills_ja:['ER設計','API設計'],skills_en:['ER design','API design']},
{id:'production',name_ja:'制作層',name_en:'Production',skills_ja:['実装','テスト'],skills_en:['Implementation','Testing']},
{id:'operations',name_ja:'運用層',name_en:'Operations',skills_ja:['モニタリング','インシデント対応'],skills_en:['Monitoring','Incident response']}
];
layers.forEach(layer=>{
skillDoc+='### '+(G?layer.name_ja:layer.name_en)+'\n';
(G?layer.skills_ja:layer.skills_en).forEach(sk=>{
skillDoc+='- '+sk+'\n';
});
skillDoc+='\n';
});
// Detailed Skill: Domain-Specific Implementation
skillDoc+='## '+(G?'詳細スキル：業種別実装':'Detailed Skill: Domain Implementation')+'\n\n';
skillDoc+='### '+(G?'スキル名':'Skill Name')+'\n';
skillDoc+='**'+domain+' Implementation Pattern**\n\n';
skillDoc+='### Input\n';
skillDoc+='- '+(G?'エンティティ定義 (`docs/04_er_diagram.md`)':'Entity definitions (`docs/04_er_diagram.md`)')+'\n';
skillDoc+='- '+(G?'機能要件 (`.spec/constitution.md`)':'Feature requirements (`.spec/constitution.md`)')+'\n';
skillDoc+='- '+(G?'実装プレイブック (`docs/39_implementation_playbook.md`)':'Implementation playbook (`docs/39_implementation_playbook.md`)')+'\n';
skillDoc+='\n### Process\n';
skillDoc+='1. '+(G?'業種別パターンを確認':'Review domain-specific patterns')+'\n';
skillDoc+='2. '+(G?'擬似コードをプロジェクトエンティティに適用':'Apply pseudo-code to project entities')+'\n';
skillDoc+='3. '+(G?'ガードレール（典型バグ）を考慮した実装':'Implement considering guard rails (typical bugs)')+'\n';
skillDoc+='4. '+(G?'横断的関心事チェックリストで検証':'Validate with cross-cutting concerns checklist')+'\n';
skillDoc+='\n### Output\n';
skillDoc+='- '+(G?'実装コード（CRUD + ビジネスロジック）':'Implementation code (CRUD + business logic)')+'\n';
skillDoc+='- '+(G?'テストケース（ガードレール検証含む）':'Test cases (including guard rail validation)')+'\n';
skillDoc+='\n### '+(G?'判断基準':'Judgment Criteria')+'\n';
skillDoc+='- '+(G?'全てのガードレールに対応するテストが存在するか':'Tests exist for all guard rails?')+'\n';
skillDoc+='- '+(G?'横断的関心事チェックリストが全てチェック済みか':'All cross-cutting concerns checked?')+'\n';
skillDoc+='- '+(G?'業種固有の制約（コンプライアンス等）を満たしているか':'Domain-specific constraints (compliance, etc.) satisfied?')+'\n';
skillDoc+='\n### '+(G?'次のスキル':'Next Skill')+'\n';
skillDoc+='- '+(G?'テスト実行 → バグ修正 → デプロイ準備':'Run tests → Fix bugs → Prepare deploy')+'\n';
skillDoc+='\n';
skillDoc+='---\n';
skillDoc+=(G?'*このスキルカタログはDevForge v9が自動生成しました。*\n':'*This skill catalog was auto-generated by DevForge v9.*\n');
S.files['skills/impl-patterns.md']=skillDoc;
}

// ── docs/42_skill_guide.md ──
const skill=S.skill||'intermediate';
const skLabel={beginner:G?'初心者':'Beginner',intermediate:G?'中級者':'Intermediate',pro:G?'上級者':'Professional'};
const skIcon={beginner:'⭐',intermediate:'⭐⭐',pro:'⭐⭐⭐'};
const skMark=G?' **← あなたのレベル**':' **<-- YOUR LEVEL**';
const _lv=(lv,items)=>{
const active=lv===skill?skMark:'';
let s='### '+skIcon[lv]+' '+skLabel[lv]+active+'\n\n';
items.forEach(it=>{s+=it+'\n';});
s+='\n';
return s;
};
let doc42='# '+pn+' — '+(G?'スキルレベル別ガイド':'Skill-Level Guide')+'\n\n';
doc42+=(G?'**あなたのレベル**: ':'**Your Level**: ')+skIcon[skill]+' '+skLabel[skill]+'\n';
doc42+=(G?'**業種**: ':'**Domain**: ')+domain+'\n';
doc42+=(G?'**生成日**: ':'**Generated**: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc42+='---\n\n';
// Sec 1: Getting Started
doc42+='## '+(G?'1. 最初にやること（生成直後の第一歩）':'1. Getting Started (First Steps After Generation)')+'\n\n';
doc42+=_lv('beginner',G?[
'1. `CLAUDE.md` をAIツール（Cursor/Claude Code）にコピペ → AIがプロジェクト全体を理解',
'2. `.spec/constitution.md` を読んでプロジェクトの目的・範囲を確認',
'3. `docs/24_progress.md` を開いてタスク進捗管理を開始',
'4. `.devcontainer/` フォルダがある場合、VS Code/Cursorで「Reopen in Container」で開発環境を即構築',
'5. ZIP+JSONで必ずバックアップ。localStorageのみに依存しない'
]:[
'1. Copy `CLAUDE.md` into your AI tool (Cursor/Claude Code) — AI understands your entire project',
'2. Read `.spec/constitution.md` to understand project purpose and scope',
'3. Open `docs/24_progress.md` to start tracking progress',
'4. If `.devcontainer/` exists, use "Reopen in Container" in VS Code/Cursor for instant dev setup',
'5. Always backup with ZIP+JSON. Don\'t rely solely on localStorage'
]);
doc42+=_lv('intermediate',G?[
'1. `AI_BRIEF.md` をAIに投入（~1200トークンで全仕様を圧縮）',
'2. `docs/39_implementation_playbook.md` で業種別実装パターンを確認',
'3. `docs/40_ai_dev_runbook.md` のWSCI（Write/Select/Compress/Isolate）ワークフローに従う',
'4. `.cursorrules` / `.windsurfrules` をプロジェクトルートに配置してAIルールを自動適用',
'5. `.claude/rules/` の5ファイル（spec/frontend/backend/test/ops）をプロジェクトに合わせて確認'
]:[
'1. Feed `AI_BRIEF.md` to AI (~1200 tokens, compressed full spec)',
'2. Review domain patterns in `docs/39_implementation_playbook.md`',
'3. Follow WSCI (Write/Select/Compress/Isolate) workflow in `docs/40_ai_dev_runbook.md`',
'4. Place `.cursorrules` / `.windsurfrules` in project root for auto AI rules',
'5. Review 5 files in `.claude/rules/` (spec/frontend/backend/test/ops) for your project'
]);
doc42+=_lv('pro',G?[
'1. `.devcontainer/` でチーム全員の環境を統一（Docker Compose構成済み）',
'2. `AGENTS.md` の Agent Specialization Matrix でマルチエージェント役割定義',
'3. `mcp-config.json` を設定し、context7/filesystem/playwright等のMCPツールを有効化',
'4. `skills/pipelines.md` のCI/CDパイプラインを `.github/workflows/ci.yml` と統合',
'5. `.claude/` 3-layer構造（ルートCLAUDE.md ~1.5Kトークン + `.claude/rules/` + `.claude/settings.json`）でトークン消費を最小化'
]:[
'1. Deploy `.devcontainer/` to standardize team environments (Docker Compose pre-configured)',
'2. Define multi-agent roles via Agent Specialization Matrix in `AGENTS.md`',
'3. Configure `mcp-config.json` to enable context7/filesystem/playwright MCP tools',
'4. Integrate `skills/pipelines.md` CI/CD pipelines with `.github/workflows/ci.yml`',
'5. Optimize `.claude/` 3-layer structure (root CLAUDE.md ~1.5K tokens + `.claude/rules/` + `.claude/settings.json`) to minimize token consumption'
]);
// Sec 2: File Usage Map
doc42+='## '+(G?'2. ファイル活用マップ':'2. File Usage Map')+'\n\n';
doc42+='| '+(G?'タスク':'Task')+' | '+(G?'最初に読む':'Read First')+' | '+(G?'次に参照':'Then Refer')+' |\n|------|------------|----------|\n';
const fmap=G?[
['コーディング開始','CLAUDE.md','.spec/constitution.md'],
['DB設計理解','docs/04_er_diagram.md','docs/05_api_design.md'],
['テスト作成','docs/07_test_cases.md','docs/36_test_strategy.md'],
['セキュリティ確認','docs/08_security.md','docs/34_incident_response.md'],
['デプロイ準備','docs/09_release_checklist.md','.github/workflows/ci.yml'],
['成長戦略確認','docs/41_growth_intelligence.md','docs/30_goal_decomposition.md'],
['バグ予防','docs/37_bug_prevention.md','docs/25_error_logs.md'],
['セキュリティ監査','docs/43_security_intelligence.md','docs/44_threat_model.md'],
['コンプライアンス','docs/45_compliance_matrix.md','docs/47_security_testing.md'],
['業種別戦略','docs/48_industry_blueprint.md','docs/49_tech_radar.md'],
['運用設計','docs/53_ops_runbook.md','docs/54_ops_checklist.md'],
['AIルール確認','.claude/rules/','.claude/settings.json'],
['未来戦略確認','docs/56_market_positioning.md','docs/59_regulatory_foresight.md']
]:[
['Start coding','CLAUDE.md','.spec/constitution.md'],
['Understand DB','docs/04_er_diagram.md','docs/05_api_design.md'],
['Write tests','docs/07_test_cases.md','docs/36_test_strategy.md'],
['Security review','docs/08_security.md','docs/34_incident_response.md'],
['Deploy prep','docs/09_release_checklist.md','.github/workflows/ci.yml'],
['Growth strategy','docs/41_growth_intelligence.md','docs/30_goal_decomposition.md'],
['Bug prevention','docs/37_bug_prevention.md','docs/25_error_logs.md'],
['Security audit','docs/43_security_intelligence.md','docs/44_threat_model.md'],
['Compliance','docs/45_compliance_matrix.md','docs/47_security_testing.md'],
['Industry strategy','docs/48_industry_blueprint.md','docs/49_tech_radar.md'],
['Ops design','docs/53_ops_runbook.md','docs/54_ops_checklist.md'],
['AI rules check','.claude/rules/','.claude/settings.json'],
['Future strategy','docs/56_market_positioning.md','docs/59_regulatory_foresight.md']
];
fmap.forEach(r=>{doc42+='| '+r[0]+' | `'+r[1]+'` | `'+r[2]+'` |\n';});
doc42+='\n';
// Sec 3: Mistakes & Cautions
doc42+='## '+(G?'3. 注意事項とよくある失敗':'3. Common Mistakes & Cautions')+'\n\n';
doc42+=_lv('beginner',G?[
'- ❌ `.spec/` を読まずにコーディング開始 → ✅ 必ず `constitution.md` を先に読む',
'- ❌ `docs/08_security.md` を無視 → ✅ 認証・RLS・CORS設定を確認してから実装',
'- ❌ 全ファイルを一度に使おうとする → ✅ まず `.spec/tasks.md` の1タスクに集中',
'- ❌ テストを後回し → ✅ `docs/07_test_cases.md` のケースを実装と同時に書く',
'- ❌ エラーログを記録しない → ✅ `docs/25_error_logs.md` のフォーマットで記録'
]:[
'- ❌ Start coding without reading `.spec/` → ✅ Always read `constitution.md` first',
'- ❌ Ignoring `docs/08_security.md` → ✅ Review auth, RLS, CORS before implementation',
'- ❌ Trying to use all files at once → ✅ Focus on one task from `.spec/tasks.md`',
'- ❌ Postponing tests → ✅ Write tests alongside implementation using `docs/07_test_cases.md`',
'- ❌ Not logging errors → ✅ Use `docs/25_error_logs.md` format for tracking'
]);
doc42+=_lv('intermediate',G?[
'- ❌ `docs/39_implementation_playbook.md` のドメインパターンを無視 → ✅ 業種固有のバグパターンを事前確認',
'- ❌ 品質ゲートを省略 → ✅ `docs/32_qa_blueprint.md` のチェックリストを実施',
'- ❌ AIへのモノリシックプロンプト → ✅ `docs/22_prompt_playbook.md` のフェーズ別テンプレート使用',
'- ❌ 生成物をそのまま使う → ✅ プロジェクト固有の要件に合わせてカスタマイズ',
'- ❌ `docs/43-47` セキュリティインテリジェンスを未読 → ✅ OWASP/STRIDE/コンプライアンスを確認してから実装'
]:[
'- ❌ Ignoring domain patterns in `docs/39_implementation_playbook.md` → ✅ Review domain-specific bugs first',
'- ❌ Skipping quality gates → ✅ Run `docs/32_qa_blueprint.md` checklists',
'- ❌ Monolithic AI prompts → ✅ Use phase-specific templates from `docs/22_prompt_playbook.md`',
'- ❌ Using generated files as-is → ✅ Customize to project-specific requirements',
'- ❌ Skipping `docs/43-47` Security Intelligence → ✅ Review OWASP/STRIDE/Compliance before implementing'
]);
doc42+=_lv('pro',G?[
'- ❌ MVP段階での過剰設計 → ✅ `docs/30_goal_decomposition.md` の優先度マトリクスに従う',
'- ❌ Agent間のコンテキスト共有不足 → ✅ `AGENTS.md` のハンドオフプロトコル遵守',
'- ❌ パフォーマンス最適化の後回し → ✅ `docs/41_growth_intelligence.md` のCWV目標を初期から意識',
'- ❌ `docs/53-55` Ops設計書を無視 → ✅ SLO/SLI・Feature Flags・Circuit Breakerを実装前に確認',
'- ❌ `.claude/rules/` をデフォルトのまま → ✅ プロジェクト固有ルールにカスタマイズ'
]:[
'- ❌ Over-engineering at MVP stage → ✅ Follow priority matrix in `docs/30_goal_decomposition.md`',
'- ❌ Poor context sharing between agents → ✅ Follow handoff protocol in `AGENTS.md`',
'- ❌ Deferring performance optimization → ✅ Target CWV goals in `docs/41_growth_intelligence.md` from day 1',
'- ❌ Ignoring `docs/53-55` Ops docs → ✅ Review SLO/SLI, Feature Flags, Circuit Breaker before implementing',
'- ❌ Keeping `.claude/rules/` defaults → ✅ Customize to project-specific rules'
]);
// Sec 4: Workflow
doc42+='## '+(G?'4. 開発ワークフロー':'4. Development Workflow')+'\n\n';
doc42+=_lv('beginner',G?[
'```',
'.spec/tasks.md → 1タスク選択 → CLAUDE.mdをAIに渡す → コード実装 → テスト → docs/24_progress.md更新',
'```',
(G?'> **ポイント**: 1タスクずつ順番に。完了したら progress.md にチェック。':'> **Key**: One task at a time. Check off in progress.md when done.')
]:[
'```',
'.spec/tasks.md → Pick 1 task → Feed CLAUDE.md to AI → Implement → Test → Update docs/24_progress.md',
'```',
'> **Key**: One task at a time. Check off in progress.md when done.'
]);
doc42+=_lv('intermediate',G?[
'```',
'AI_BRIEF.md投入 → docs/39パターン確認 → docs/43セキュリティ確認 → 実装 → docs/32品質チェック → docs/22プロンプトでレビュー依頼',
'```',
'> **ポイント**: AI_BRIEF.md でコンテキスト圧縮、プレイブックでドメインパターン適用。'
]:[
'```',
'Feed AI_BRIEF.md → Check docs/39 patterns → docs/43 security check → Implement → docs/32 quality check → Review via docs/22 prompts',
'```',
'> **Key**: Compress context with AI_BRIEF.md, apply domain patterns from playbook.'
]);
doc42+=_lv('pro',G?[
'```',
'AGENTS.md役割定義 → skills/pipelines.md自動化 → 並列実装 → docs/53-55 Ops設計確認 → CI/CD統合 → docs/34インシデント対応準備',
'```',
'> **ポイント**: Agent Teams で並列開発。verification.md で品質判定を自動化。'
]:[
'```',
'AGENTS.md role setup → skills/pipelines.md automation → Parallel impl → docs/53-55 Ops design check → CI/CD → docs/34 incident prep',
'```',
'> **Key**: Parallel dev with Agent Teams. Automate quality judgment via verification.md.'
]);
// Sec 5: AI Tool Usage
doc42+='## '+(G?'5. AIツール活用戦略':'5. AI Tool Usage Strategy')+'\n\n';
doc42+=_lv('beginner',G?[
'1. `CLAUDE.md` 全文をAIにコピペ（Ctrl+Shift+Cで全ファイル一括コピーも可）',
'2. 「`.spec/tasks.md` の○○を実装して」と具体的に指示',
'3. エラーが出たら `docs/25_error_logs.md` のフォーマットで記録してAIに渡す'
]:[
'1. Copy entire `CLAUDE.md` into AI (or use Ctrl+Shift+C for bulk copy)',
'2. Give specific instructions: "Implement XX from `.spec/tasks.md`"',
'3. On errors, log in `docs/25_error_logs.md` format and share with AI'
]);
doc42+=_lv('intermediate',G?[
'1. `AI_BRIEF.md` でコンテキスト圧縮投入（~1200トークン）',
'2. `.cursorrules` / `.windsurfrules` でツール固有ルールを自動適用',
'3. `docs/22_prompt_playbook.md` のフェーズ別プロンプトテンプレート活用',
'4. 複数AIツールを使い分け：設計=Claude Code、実装=Cursor、レビュー=Copilot',
'5. `.claude/rules/` のパス別ルールでAIの動作をプロジェクトに最適化'
]:[
'1. Feed `AI_BRIEF.md` for compressed context (~1200 tokens)',
'2. Use `.cursorrules` / `.windsurfrules` for tool-specific auto rules',
'3. Use phase-specific prompt templates from `docs/22_prompt_playbook.md`',
'4. Multi-tool strategy: Design=Claude Code, Implement=Cursor, Review=Copilot',
'5. Optimize AI behavior with path-specific rules in `.claude/rules/`'
]);
doc42+=_lv('pro',G?[
'1. `AGENTS.md` の Agent Specialization Matrix で役割分担',
'2. `skills/pipelines.md` で自動パイプライン構築（Feature/BugFix/Release）',
'3. `mcp-config.json` でcontext7/filesystem/playwright等を統合',
'4. Claude Code Subagents / Antigravity Manager View で並列実行',
'5. `.claude/` 3-layer split でルートCLAUDE.md ~1.5Kトークンに圧縮。パス別ルールが自動ロード'
]:[
'1. Define role assignments via Agent Specialization Matrix in `AGENTS.md`',
'2. Build auto pipelines with `skills/pipelines.md` (Feature/BugFix/Release)',
'3. Integrate context7/filesystem/playwright via `mcp-config.json`',
'4. Run parallel with Claude Code Subagents / Antigravity Manager View',
'5. `.claude/` 3-layer split compresses root CLAUDE.md to ~1.5K tokens. Path-specific rules auto-load'
]);
// Sec 6: Quality Checklist
doc42+='## '+(G?'6. 品質チェックリスト':'6. Quality Checklist')+'\n\n';
doc42+=_lv('beginner',G?[
'- [ ] テストが通る（`npm test`）',
'- [ ] `console.log` を本番コードから除去',
'- [ ] `docs/08_security.md` のセキュリティ項目を確認',
'- [ ] `docs/24_progress.md` を更新',
'- [ ] `docs/25_error_logs.md` に未解決エラーがない'
]:[
'- [ ] Tests pass (`npm test`)',
'- [ ] Remove `console.log` from production code',
'- [ ] Review security items in `docs/08_security.md`',
'- [ ] Update `docs/24_progress.md`',
'- [ ] No unresolved errors in `docs/25_error_logs.md`'
]);
doc42+=_lv('intermediate',G?[
'- [ ] テストカバレッジ 80%以上',
'- [ ] `docs/32_qa_blueprint.md` の業種別チェック完了',
'- [ ] `docs/37_bug_prevention.md` のパターン対応済み',
'- [ ] `docs/26_design_system.md` のトークン準拠',
'- [ ] `docs/28_qa_strategy.md` のクロスカッティング項目確認',
'- [ ] APIレスポンスが `docs/05_api_design.md` と一致',
'- [ ] `.spec/verification.md` の検証基準をクリア',
'- [ ] `docs/27_sequence_diagrams.md` のフロー通りに実装',
'- [ ] `docs/43_security_intelligence.md` のOWASP Top 10チェック完了',
'- [ ] `docs/53_ops_runbook.md` のSLO目標を確認',
'- [ ] `docs/57_user_experience_strategy.md` のUX戦略・アクセシビリティ確認'
]:[
'- [ ] Test coverage >= 80%',
'- [ ] Domain checks in `docs/32_qa_blueprint.md` complete',
'- [ ] Bug patterns in `docs/37_bug_prevention.md` addressed',
'- [ ] Design tokens conform to `docs/26_design_system.md`',
'- [ ] Cross-cutting items in `docs/28_qa_strategy.md` verified',
'- [ ] API responses match `docs/05_api_design.md`',
'- [ ] Pass `.spec/verification.md` criteria',
'- [ ] Implementation follows `docs/27_sequence_diagrams.md` flows',
'- [ ] OWASP Top 10 check in `docs/43_security_intelligence.md` complete',
'- [ ] SLO targets in `docs/53_ops_runbook.md` confirmed',
'- [ ] UX strategy and accessibility review in `docs/57_user_experience_strategy.md`'
]);
doc42+=_lv('pro',G?[
'- [ ] 中級者チェック全項目 + 以下:',
'- [ ] `docs/41_growth_intelligence.md` のCore Web Vitals目標達成',
'- [ ] `docs/19_performance.md` のパフォーマンス基準クリア',
'- [ ] `docs/34_incident_response.md` のインシデント対応手順テスト済み',
'- [ ] `.spec/verification.md` の全検証項目を自動テストでカバー',
'- [ ] エッジケース: 同時アクセス、大量データ、ネットワーク障害',
'- [ ] `docs/20_a11y.md` のアクセシビリティ基準準拠',
'- [ ] `docs/44_threat_model.md` のSTRIDE脅威分析完了',
'- [ ] `docs/54_ops_checklist.md` の12 Ops Capabilities実装',
'- [ ] `docs/55_ops_plane_design.md` のCircuit Breaker設計確認',
'- [ ] `docs/56_market_positioning.md` のMOAT・GTM戦略レビュー',
'- [ ] `docs/59_regulatory_foresight.md` の規制フォーサイト確認',
'- [ ] `.claude/rules/` をプロジェクト固有ルールにカスタマイズ済み'
]:[
'- [ ] All intermediate checks PLUS:',
'- [ ] Core Web Vitals targets from `docs/41_growth_intelligence.md` met',
'- [ ] Performance criteria from `docs/19_performance.md` passed',
'- [ ] Incident response in `docs/34_incident_response.md` tested',
'- [ ] All `.spec/verification.md` criteria covered by automated tests',
'- [ ] Edge cases: concurrent access, large datasets, network failures',
'- [ ] Accessibility standards from `docs/20_a11y.md` met',
'- [ ] STRIDE threat analysis in `docs/44_threat_model.md` complete',
'- [ ] 12 Ops Capabilities from `docs/54_ops_checklist.md` implemented',
'- [ ] Circuit Breaker design in `docs/55_ops_plane_design.md` verified',
'- [ ] MOAT & GTM review in `docs/56_market_positioning.md`',
'- [ ] Regulatory foresight check in `docs/59_regulatory_foresight.md`',
'- [ ] `.claude/rules/` customized to project-specific rules'
]);
// Sec 7: Growth Path
doc42+='## '+(G?'7. レベルアップの道筋':'7. Growth Path')+'\n\n';
doc42+=_lv('beginner',G?[
'**⭐→⭐⭐ への道:**',
'1. `.spec/` の全ファイルを理解する（特に `specification.md` と `technical-plan.md`）',
'2. `docs/39_implementation_playbook.md` の業種パターンを1つ実装してみる',
'3. `AI_BRIEF.md` を使ったコンテキスト圧縮技法を習得',
'4. 2つ以上のAIツールを使い分けてみる',
'5. `.claude/rules/` の構造を理解し、パス別ルールの概念を学ぶ'
]:[
'**⭐→⭐⭐ Path:**',
'1. Understand all files in `.spec/` (especially `specification.md` and `technical-plan.md`)',
'2. Implement one domain pattern from `docs/39_implementation_playbook.md`',
'3. Learn context compression using `AI_BRIEF.md`',
'4. Try using 2+ AI tools for different tasks',
'5. Understand `.claude/rules/` structure and learn path-specific rule concepts'
]);
doc42+=_lv('intermediate',G?[
'**⭐⭐→⭐⭐⭐ への道:**',
'1. `AGENTS.md` を使ったマルチエージェント開発を試す',
'2. `skills/pipelines.md` のパイプラインをCI/CDと統合',
'3. `docs/41_growth_intelligence.md` のグロース方程式を実際のデータで検証',
'4. `mcp-config.json` でMCPツールチェーンを構築',
'5. `docs/43-47` セキュリティインテリジェンスでOWASP/STRIDE監査を実践',
'6. `docs/53-55` Ops設計書で12 Ops Capabilities を学習',
'7. `docs/56-59` 未来戦略で市場・UX・エコシステム・規制を把握'
]:[
'**⭐⭐→⭐⭐⭐ Path:**',
'1. Try multi-agent development with `AGENTS.md`',
'2. Integrate `skills/pipelines.md` pipelines with CI/CD',
'3. Validate growth equations from `docs/41_growth_intelligence.md` with real data',
'4. Build MCP tool chain via `mcp-config.json`',
'5. Practice OWASP/STRIDE audits with `docs/43-47` Security Intelligence',
'6. Learn 12 Ops Capabilities from `docs/53-55` Ops docs',
'7. Understand market, UX, ecosystem, and regulations with `docs/56-59` Future Strategy'
]);
doc42+=_lv('pro',G?[
'**⭐⭐⭐ マスターへの道:**',
'1. 独自のAIスキル定義（`skills/factory.md` のテンプレート活用）',
'2. チームメンバーへのDevForge導入とメンタリング',
'3. ドメイン固有のカスタムパイプライン構築',
'4. OSSコントリビューション・アーキテクチャレビューのリード',
'5. `docs/55_ops_plane_design.md` のCircuit Breaker・Evidence-Based Opsを完全実装',
'6. `docs/59_regulatory_foresight.md` のEU AI Act・ESGメトリクスを製品戦略に統合'
]:[
'**⭐⭐⭐ Path to Mastery:**',
'1. Define custom AI skills (using `skills/factory.md` templates)',
'2. Introduce DevForge to team and mentor adoption',
'3. Build domain-specific custom pipelines',
'4. Lead OSS contributions and architecture reviews',
'5. Fully implement Circuit Breaker and Evidence-Based Ops from `docs/55_ops_plane_design.md`',
'6. Integrate EU AI Act and ESG metrics into product strategy via `docs/59_regulatory_foresight.md`'
]);
// Sec 8: Domain Tips
const dtips={
education:G?['`docs/08_security.md` → FERPA/学生データ保護を必ず確認','進捗トラッキングはゲーミフィケーション要素と連携','コース完了率KPIを `docs/30_goal_decomposition.md` で設定','`docs/45_compliance_matrix.md` → FERPA準拠確認','`docs/57_user_experience_strategy.md` → 学習UX戦略・アクセシビリティ']:['Review FERPA/student data protection in `docs/08_security.md`','Link progress tracking with gamification elements','Set course completion KPIs in `docs/30_goal_decomposition.md`','Verify FERPA compliance in `docs/45_compliance_matrix.md`','`docs/57_user_experience_strategy.md` → Learning UX + accessibility'],
fintech:G?['`docs/08_security.md` → PCI DSS/KYC対応を最優先で確認','トランザクション整合性テストを `docs/07_test_cases.md` に追加','金融規制コンプライアンスを `docs/31_industry_playbook.md` で確認','`docs/43_security_intelligence.md` → PCI DSS自動監査プロンプト活用','`docs/53_ops_runbook.md` → SLO 99.99%目標を設定','`docs/59_regulatory_foresight.md` → 金融規制2026-2030展望']:['Prioritize PCI DSS/KYC in `docs/08_security.md`','Add transaction integrity tests to `docs/07_test_cases.md`','Check financial compliance in `docs/31_industry_playbook.md`','Use PCI DSS auto-audit prompts in `docs/43_security_intelligence.md`','Set SLO 99.99% target in `docs/53_ops_runbook.md`','`docs/59_regulatory_foresight.md` → Financial regulatory outlook 2026-2030'],
health:G?['`docs/08_security.md` → HIPAA準拠を確認','患者データ暗号化を `.spec/technical-plan.md` で検証','監査ログを `docs/05_api_design.md` に追加','`docs/45_compliance_matrix.md` → HIPAA準拠チェックリスト活用']:['Verify HIPAA compliance in `docs/08_security.md`','Validate patient data encryption in `.spec/technical-plan.md`','Add audit logging to `docs/05_api_design.md`','Use HIPAA compliance checklist in `docs/45_compliance_matrix.md`'],
ec:G?['決済テストは必ずStripeテストキーで実施','在庫管理の同時アクセス対策を `docs/37_bug_prevention.md` で確認','カート放棄防止策を `docs/41_growth_intelligence.md` で確認','`docs/48_industry_blueprint.md` → EC業界設計パターン確認','`docs/56_market_positioning.md` → EC市場ポジショニング・MOAT']:['Always test payments with Stripe test keys','Check concurrent access for inventory in `docs/37_bug_prevention.md`','Review cart abandonment prevention in `docs/41_growth_intelligence.md`','Review EC industry patterns in `docs/48_industry_blueprint.md`','`docs/56_market_positioning.md` → EC market positioning + MOAT'],
saas:G?['フリーミアム設計は `docs/41_growth_intelligence.md` のファネル参照','マルチテナント設計を `.spec/technical-plan.md` で確認','チャーン防止KPIを `docs/30_goal_decomposition.md` で設定','`docs/53_ops_runbook.md` → SLO 99.9%、Feature Flags設計確認','`docs/58_ecosystem_strategy.md` → API-as-Product・エコシステム']:['Reference funnel in `docs/41_growth_intelligence.md` for freemium design','Verify multi-tenant design in `.spec/technical-plan.md`','Set churn prevention KPIs in `docs/30_goal_decomposition.md`','Review SLO 99.9% and Feature Flags in `docs/53_ops_runbook.md`','`docs/58_ecosystem_strategy.md` → API-as-Product + ecosystem']
};
const tips=dtips[domain]||( G?['プロジェクト固有の制約を `.spec/constitution.md` で再確認','業種別プレイブックを `docs/31_industry_playbook.md` で確認','品質基準を `docs/32_qa_blueprint.md` で確認','`docs/53_ops_runbook.md` → 運用準備をOps Checklistで確認','`docs/56_market_positioning.md` → 市場ポジショニング・競合分析']:['Re-check project constraints in `.spec/constitution.md`','Review domain playbook in `docs/31_industry_playbook.md`','Verify quality criteria in `docs/32_qa_blueprint.md`','Verify ops readiness with `docs/53_ops_runbook.md` Ops Checklist','`docs/56_market_positioning.md` → Market positioning + competitive analysis']);
doc42+='## '+(G?'8. 業種別アドバイス（'+domain+'）':'8. Domain-Specific Tips ('+domain+')')+'\n\n';
tips.forEach((t,i)=>{doc42+=(i+1)+'. '+t+'\n';});
doc42+='\n';
// Sec 9: Evangelist Activities (Lv6+)
if(S.skillLv>=6){
doc42+='\n## '+(G?'🌟 エバンジェリスト活動':'🌟 Evangelist Activities')+'\n';
doc42+=(G?'設計書をコミュニティで共有し、フィードバックを収集する:\n':'Share specs with community and collect feedback:\n');
doc42+=(G?'- URLコピー機能で設計書リンクを共有\n':'- Share spec links using URL copy feature\n');
doc42+=(G?'- Twitterやブログで開発プロセスを発信\n':'- Share development process on Twitter or blog\n');
doc42+=(G?'- OSSコミュニティへのコントリビューション\n':'- Contribute to OSS community\n');
doc42+=(G?'- チームや組織内でDevForge活用を伝道\n':'- Evangelize DevForge usage within team/org\n');
}

// Footer
doc42+='---\n';
doc42+=(G?'*このガイドはDevForge v9.3が `S.skill='+skill+'` に基づいて自動生成しました。*\n':'*This guide was auto-generated by DevForge v9.3 based on `S.skill='+skill+'`.*\n');
S.files['docs/42_skill_guide.md']=doc42;
}

function gen81(){
var G=S.genLang==='ja';
var a=S.answers;
var pn=S.projectName||'MyProject';
var target=a.target||(G?'ユーザー':'users');
var screens=a.screens||(G?'主要画面':'main screens');
var auth=a.auth||(G?'認証方式':'auth method');
var mvp=a.mvp_features||(G?'主要機能':'main features');
var doc='';
doc+=(G?'# UX習熟度別監査テンプレート — ':'# UX Proficiency Audit Template — ')+pn+'\n\n';
doc+=G?'## 概要\n7段階のユーザーペルソナで'+pn+'のUXを監査するテンプレート。\n各レベルのプロンプトをAIに順番に投入し、構造的乖離マップを作成してください。\n\n':'## Overview\nTemplate for auditing '+pn+' UX using 7 user-level personas.\nFeed each level prompt to AI in order, then create a structural gap map.\n\n';
doc+=G?'## Lv.0 完全初心者 — 「最初の1分で離脱しない」\n':'## Lv.0 Absolute Beginner — "No dropout in the first minute"\n';
doc+=G?'**ペルソナ**: '+target+'を使ったことがない生活者\n':'**Persona**: A person who has never used '+target+'\n';
doc+=G?'**照査タスク**:\n':'**Audit Tasks**:\n';
doc+=G?'1. '+pn+'は何をするものか？（3秒で判断）\n':'1. What does '+pn+' do? (3-second judgment)\n';
doc+=G?'2. 使い始めるために何をすれば良いか分かるか？\n':'2. Is it clear what to do to get started?\n';
doc+=G?'3. 「自分には関係ない」と思う箇所は？\n':'3. What makes them think "this is not for me"?\n';
doc+=G?'4. 不安・抵抗感を感じる箇所は？（'+auth+' 画面含む）\n':'4. Where do they feel anxiety or resistance? (incl. '+auth+' screen)\n';
doc+=G?'5. 「続けてみよう」と思えるか？\n\n':'5. Can they be convinced to continue?\n\n';
doc+=G?'## Lv.1 初心者 — 「最初の成功体験」\n':'## Lv.1 Beginner — "First success experience"\n';
doc+=G?'**ペルソナ**: 登録済みだが'+mvp+'を1回も使っていない\n':'**Persona**: Registered but never used '+mvp+'\n';
doc+=G?'**照査タスク**:\n':'**Audit Tasks**:\n';
doc+=G?'1. '+screens+'への導線は明確か？\n':'1. Is the path to '+screens+' clear?\n';
doc+=G?'2. 最初のアクションを完了できるか？\n':'2. Can they complete the first action?\n';
doc+=G?'3. エラーメッセージは優しいか？\n':'3. Are error messages friendly?\n';
doc+=G?'4. 「小さな成功」を感じられる瞬間があるか？\n':'4. Is there a moment of "small success"?\n';
doc+=G?'5. 次のステップへの誘導はあるか？\n\n':'5. Is there guidance to the next step?\n\n';
doc+=G?'## Lv.2 慣れ始め — 「基本→応用ブリッジ」\n':'## Lv.2 Getting Started — "Basic to advanced bridge"\n';
doc+=G?'**ペルソナ**: 基本操作はできるが応用で手が止まる\n':'**Persona**: Can do basics but gets stuck on advanced features\n';
doc+=G?'**照査タスク**:\n':'**Audit Tasks**:\n';
doc+=G?'1. '+mvp+'の応用機能は発見しやすいか？\n':'1. Are advanced features of '+mvp+' easy to discover?\n';
doc+=G?'2. ヘルプ・ドキュメントは適切な場所にあるか？\n':'2. Is help/documentation in the right place?\n';
doc+=G?'3. 「もっと使いこなせる」感はあるか？\n':'3. Is there a sense of "I can do more with this"?\n';
doc+=G?'4. 隠れた機能の発見性は高いか？\n':'4. Is discoverability of hidden features high?\n';
doc+=G?'5. 中断・再開が容易か？\n\n':'5. Is it easy to pause and resume?\n\n';
doc+=G?'## Lv.3 中級者 — 「効率化・継続率向上」\n':'## Lv.3 Intermediate — "Efficiency and retention"\n';
doc+=G?'**ペルソナ**: 定期利用しているがルーティン化できていない\n':'**Persona**: Regular user but not yet in routine\n';
doc+=G?'**照査タスク**:\n':'**Audit Tasks**:\n';
doc+=G?'1. 繰り返し操作のショートカットはあるか？\n':'1. Are there shortcuts for repetitive operations?\n';
doc+=G?'2. 「使い続ける理由」は明確か？\n':'2. Is the "reason to keep using it" clear?\n';
doc+=G?'3. データの一括処理・テンプレート活用は可能か？\n':'3. Is bulk processing/template usage possible?\n';
doc+=G?'4. 通知・リマインダーは適切か？\n':'4. Are notifications/reminders appropriate?\n';
doc+=G?'5. '+pn+'なしでは困る状況を作れているか？\n\n':'5. Have they created a situation where they would be in trouble without '+pn+'?\n\n';
doc+=G?'## Lv.4 上級者 — 「使い倒し設計」\n':'## Lv.4 Advanced — "Power user design"\n';
doc+=G?'**ペルソナ**: フル活用しているがカスタマイズを求める\n':'**Persona**: Full user who seeks customization\n';
doc+=G?'**照査タスク**:\n':'**Audit Tasks**:\n';
doc+=G?'1. API・Webhookは利用可能か？（'+auth+' 連携含む）\n':'1. Is API/Webhook available? (incl. '+auth+' integration)\n';
doc+=G?'2. ショートカット・バッチ処理は十分か？\n':'2. Are shortcuts/batch operations sufficient?\n';
doc+=G?'3. カスタマイズ・個人設定の深さは十分か？\n':'3. Is the depth of customization/personal settings sufficient?\n';
doc+=G?'4. 公式ドキュメントの限界をどう超えられるか？\n':'4. How can they go beyond official documentation limits?\n';
doc+=G?'5. パフォーマンス・信頼性は上級者の基準を満たすか？\n\n':'5. Does performance/reliability meet power user standards?\n\n';
doc+=G?'## Lv.5 エキスパート — 「組織展開・深度活用」\n':'## Lv.5 Expert — "Org deployment and deep usage"\n';
doc+=G?'**ペルソナ**: チームや組織で'+pn+'を導入・管理する\n':'**Persona**: Deploying and managing '+pn+' for team/org\n';
doc+=G?'**照査タスク**:\n':'**Audit Tasks**:\n';
doc+=G?'1. チーム共有・権限管理は十分か？\n':'1. Is team sharing/permission management sufficient?\n';
doc+=G?'2. 組織レベルのダッシュボード・レポートはあるか？\n':'2. Are org-level dashboards/reports available?\n';
doc+=G?'3. Webhook/API/プラグイン拡張は可能か？\n':'3. Is Webhook/API/plugin extension possible?\n';
doc+=G?'4. 監査ログ・コンプライアンス対応は十分か？\n':'4. Is audit log/compliance support sufficient?\n';
doc+=G?'5. エンタープライズ導入の障壁は何か？\n\n':'5. What are the barriers to enterprise adoption?\n\n';
doc+=G?'## Lv.6 伝道者 — 「コミュニティ・伝道者設計」\n':'## Lv.6 Evangelist — "Community and evangelist design"\n';
doc+=G?'**ペルソナ**: '+pn+'を周囲に薦め、コミュニティを形成する\n':'**Persona**: Recommends '+pn+' to others and builds community\n';
doc+=G?'**照査タスク**:\n':'**Audit Tasks**:\n';
doc+=G?'1. 「薦めたくなる瞬間」のデザインはあるか？\n':'1. Is there a "want to recommend" moment designed in?\n';
doc+=G?'2. SNS共有・口コミ誘導のUI/UXはあるか？\n':'2. Is there UI/UX for social sharing/word-of-mouth?\n';
doc+=G?'3. コミュニティ・フォーラム連携はあるか？\n':'3. Is community/forum integration available?\n';
doc+=G?'4. コントリビューター・レビュー機能はあるか？\n':'4. Are contributor/review features available?\n';
doc+=G?'5. 伝道者を特別扱いする報酬設計はあるか？\n\n':'5. Is there a reward design that treats evangelists specially?\n\n';
doc+=G?'## 運用ガイド\n':'## Operating Guide\n';
doc+=G?'1. 各Lvのプロンプトを順番にAIに投入\n':'1. Feed each level prompt to AI in order\n';
doc+=G?'2. 全7段階の結果を並べて「構造的乖離マップ」を作成\n':'2. Arrange all 7 results to create a "structural gap map"\n';
doc+=G?'3. 最もギャップが大きい区間を優先改善\n':'3. Prioritize improvements for the segment with the largest gap\n';
doc+=G?'4. 離脱リスクが高いLvの改善から着手\n':'4. Start with improvements for Lv with highest dropout risk\n';
doc+=G?'5. 投資対効果TOP5施策を四半期サイクルで実施\n':'5. Implement TOP5 ROI measures in quarterly cycles\n';
S.files['docs/81_ux_proficiency_audit.md']=doc;
}


// OWASP Top 10 2025 Check Database
const OWASP_2025=[
{id:'A01',ja:'アクセス制御の不備',en:'Broken Access Control',
checks_ja:[
'RLS/Security Rules全テーブル有効化',
'Server Actions内認証チェック必須',
'IDOR防止(owner検証)',
'最小権限原則の適用',
'デフォルト拒否ポリシー'
],
checks_en:[
'Enable RLS/Security Rules for all tables',
'Auth check required in all Server Actions',
'IDOR prevention (owner verification)',
'Apply principle of least privilege',
'Default deny policy'
],
stack:{
supabase:['RLSポリシー全テーブル確認','service_roleキー隔離','anon keyのみクライアント公開'],
firebase:['Firestore Rules全コレクション確認','Admin SDK使用最小化','カスタムクレーム活用'],
express:['認可ミドルウェア全ルート適用','JWTスコープ検証','RBAC実装']
}},
{id:'A02',ja:'セキュリティ設定ミス',en:'Security Misconfiguration',
checks_ja:[
'BaaS管理画面でRLS有効化確認',
'API制限設定(リファラ/IPホワイトリスト)',
'Data API無効化推奨',
'CORS設定の厳格化',
'デフォルトクレデンシャル変更'
],
checks_en:[
'Verify RLS enabled in BaaS console',
'API restrictions (referrer/IP whitelist)',
'Disable Data API (recommended)',
'Strict CORS configuration',
'Change default credentials'
],
stack:{
supabase:['Database settings→RLS確認','API settings→制限設定','PostgREST API評価'],
firebase:['Firebase Console→Rules確認','App Check有効化','API key制限設定'],
vercel:['Environment Variables設定','Preview deployments保護','Edge Config活用']
}},
{id:'A03',ja:'ソフトウェアサプライチェーン',en:'Software Supply Chain',
checks_ja:[
'npm audit自動実行',
'Gitleaksでシークレットスキャン',
'SLSA Build Provenance生成',
'Scorecard評価',
'SBOMエクスポート'
],
checks_en:[
'Automate npm audit',
'Gitleaks secret scanning',
'Generate SLSA Build Provenance',
'Scorecard evaluation',
'Export SBOM'
],
stack:{
github:['Dependabot有効化','Secret scanning有効化','actions/attest-build-provenance使用'],
npm:['package-lock.json必須','npm audit fix定期実行','--ignore-scripts使用'],
docker:['ベースイメージ署名検証','Trivy脆弱性スキャン','multi-stage build']
}},
{id:'A04',ja:'サーバサイドリクエストフォージェリ',en:'Server-Side Request Forgery',
checks_ja:[
'Server Actions内URL検証',
'Edge Functions外部リクエスト制限',
'プライベートIP拒否',
'URLホワイトリスト',
'リダイレクト検証'
],
checks_en:[
'URL validation in Server Actions',
'Restrict external requests in Edge Functions',
'Deny private IPs',
'URL whitelist',
'Redirect validation'
],
stack:{
nextjs:['Server Actions入力検証','fetch制限実装','middleware活用'],
cloudflare:['Workers制限設定','env.ALLOWED_HOSTS定義'],
supabase:['Edge Functions制限','Deno.permissions確認']
}},
{id:'A05',ja:'安全でない設計',en:'Insecure Design',
checks_ja:[
'脅威モデリング実施',
'Security by Design原則',
'フェイルセーフ設計',
'Defense in Depth',
'セキュアデフォルト'
],
checks_en:[
'Conduct threat modeling',
'Security by Design principles',
'Fail-safe design',
'Defense in Depth',
'Secure defaults'
],
stack:{
design:['STRIDE分析実施','Trust Boundary定義','Attack Surface最小化'],
arch:['認証/認可分離','暗号化デフォルト','監査ログ設計']
}},
{id:'A06',ja:'脆弱で古いコンポーネント',en:'Vulnerable and Outdated Components',
checks_ja:[
'依存関係自動更新',
'EOLバージョン回避',
'セキュリティパッチ適用',
'未使用依存関係削除',
'ロックファイル必須'
],
checks_en:[
'Automate dependency updates',
'Avoid EOL versions',
'Apply security patches',
'Remove unused dependencies',
'Require lockfile'
],
stack:{
renovate:['自動PR作成','vulnerabilityAlerts有効'],
npm:['npm outdated定期確認','npx npm-check-updates'],
docker:['ベースイメージ更新','distroless推奨']
}},
{id:'A07',ja:'識別と認証の失敗',en:'Identification and Authentication Failures',
checks_ja:[
'MFA必須化',
'パスワード強度ポリシー',
'セッション管理強化',
'レートリミット実装',
'クレデンシャルスタッフィング防御'
],
checks_en:[
'Enforce MFA',
'Password strength policy',
'Strengthen session management',
'Implement rate limiting',
'Defend against credential stuffing'
],
stack:{
supabase:['Auth policies設定','MFA有効化','Email confirmations強制'],
firebase:['Firebase Auth MFA','reCAPTCHA統合','passwordPolicyOptions設定'],
nextauth:['session strategy設定','maxAge適切化','secret強化']
}},
{id:'A08',ja:'ソフトウェアとデータの整合性の不備',en:'Software and Data Integrity Failures',
checks_ja:[
'CDN SRI設定',
'コード署名検証',
'CI/CDパイプライン保護',
'auto-merge無効化',
'Webhook署名検証'
],
checks_en:[
'Configure CDN SRI',
'Verify code signatures',
'Protect CI/CD pipeline',
'Disable auto-merge',
'Verify webhook signatures'
],
stack:{
cdn:['SRI hashesすべてのCDN','integrity属性必須'],
github:['Branch protection有効','Signed commits推奨','CODEOWNERS設定'],
webhook:['HMAC署名検証','タイムスタンプ検証','replay attack防御']
}},
{id:'A09',ja:'セキュリティログと監視の不備',en:'Security Logging and Monitoring Failures',
checks_ja:[
'全認証イベント記録',
'異常検知アラート',
'ログ改ざん防止',
'インシデント対応手順',
'ログ保持ポリシー'
],
checks_en:[
'Log all auth events',
'Anomaly detection alerts',
'Prevent log tampering',
'Incident response procedures',
'Log retention policy'
],
stack:{
supabase:['pgAudit有効化','Log drains設定','Webhooks活用'],
datadog:['APM統合','Security Monitoring','Anomaly Detection'],
sentry:['Error tracking','Performance monitoring','Session Replay']
}},
{id:'A10',ja:'サーバサイドリクエストフォージェリ',en:'Server-Side Request Forgery',
checks_ja:[
'DNS Rebinding防御',
'メタデータAPI保護',
'ネットワーク分離',
'Egress制限',
'タイムアウト設定'
],
checks_en:[
'Defend against DNS Rebinding',
'Protect metadata APIs',
'Network isolation',
'Egress restrictions',
'Timeout configuration'
],
stack:{
cloud:['VPC設定','Security Groups','Private subnets'],
k8s:['Network Policies','Egress rules','Service mesh'],
serverless:['VPC integration','Outbound allowlist']
}}
];
// Compliance Requirements Database
const COMPLIANCE_DB={
pci:{
name:'PCI DSS 4.0.1',
domains:['fintech','ec'],
reqs_ja:[
{id:'6.4.3',title:'決済ページスクリプトインベントリ',desc:'すべてのJavaScriptをリスト化し、正当性を検証',impl:'CSP report-uri + inventory管理'},
{id:'11.6.1',title:'改ざん検知メカニズム',desc:'HTTPヘッダー/ペイロードの改ざん検知',impl:'Subresource Integrity (SRI) + CSP'},
{id:'8.3.6',title:'パスワード複雑度',desc:'12文字以上、大小英数記号',impl:'Auth provider設定 + クライアント検証'},
{id:'3.5.1',title:'カード情報非保存',desc:'PAN/CVV2保存禁止',impl:'Stripe Tokenization必須'},
{id:'12.10.4',title:'インシデント対応計画',desc:'決済システム侵害時の手順',impl:'docs/34_incident_response.md参照'}
],
reqs_en:[
{id:'6.4.3',title:'Payment Page Script Inventory',desc:'List all JavaScript and verify legitimacy',impl:'CSP report-uri + inventory management'},
{id:'11.6.1',title:'Tampering Detection Mechanism',desc:'Detect HTTP header/payload tampering',impl:'Subresource Integrity (SRI) + CSP'},
{id:'8.3.6',title:'Password Complexity',desc:'12+ chars, upper/lower/digit/symbol',impl:'Auth provider settings + client validation'},
{id:'3.5.1',title:'No Card Data Storage',desc:'Never store PAN/CVV2',impl:'Stripe Tokenization required'},
{id:'12.10.4',title:'Incident Response Plan',desc:'Procedures for payment system breach',impl:'See docs/34_incident_response.md'}
]
},
hipaa:{
name:'HIPAA',
domains:['health'],
reqs_ja:[
{id:'§164.312(a)',title:'アクセス制御',desc:'PHI(Protected Health Information)へのアクセス制限',impl:'RLS + RBAC + MFA必須'},
{id:'§164.312(c)',title:'整合性管理',desc:'PHI改ざん防止・検知',impl:'pgAudit + トリガー監査'},
{id:'§164.312(e)',title:'暗号化',desc:'保管時・転送時暗号化',impl:'AES-256 + TLS 1.3'},
{id:'§164.308(a)(1)',title:'BAA締結',desc:'Business Associate Agreement',impl:'Supabase Enterprise必須'},
{id:'§164.528',title:'開示記録',desc:'PHIアクセスログ3年保管',impl:'CloudWatch Logs + S3 Glacier'}
],
reqs_en:[
{id:'§164.312(a)',title:'Access Control',desc:'Restrict access to PHI (Protected Health Information)',impl:'RLS + RBAC + MFA required'},
{id:'§164.312(c)',title:'Integrity Controls',desc:'Prevent/detect PHI tampering',impl:'pgAudit + trigger audits'},
{id:'§164.312(e)',title:'Encryption',desc:'At-rest and in-transit encryption',impl:'AES-256 + TLS 1.3'},
{id:'§164.308(a)(1)',title:'BAA Execution',desc:'Business Associate Agreement',impl:'Supabase Enterprise required'},
{id:'§164.528',title:'Disclosure Records',desc:'PHI access logs for 3 years',impl:'CloudWatch Logs + S3 Glacier'}
]
},
gdpr:{
name:'GDPR',
domains:['hr','community','content','saas','default'],
reqs_ja:[
{id:'Art.6',title:'処理の適法性',desc:'法的根拠(同意/契約/正当利益)の文書化',impl:'同意管理UI + Privacy Policy'},
{id:'Art.15',title:'アクセス権',desc:'データ主体が自分のデータをダウンロード可能',impl:'Export機能実装'},
{id:'Art.17',title:'忘れられる権利',desc:'削除リクエスト対応',impl:'Delete Account機能 + CASCADE設定'},
{id:'Art.32',title:'セキュリティ対策',desc:'技術的・組織的対策',impl:'暗号化 + アクセス制御 + 監査ログ'},
{id:'Art.33',title:'侵害通知',desc:'72時間以内に監督当局通知',impl:'Incident Response手順書'}
],
reqs_en:[
{id:'Art.6',title:'Lawfulness of Processing',desc:'Document legal basis (consent/contract/legitimate interest)',impl:'Consent management UI + Privacy Policy'},
{id:'Art.15',title:'Right of Access',desc:'Data subjects can download their data',impl:'Implement Export feature'},
{id:'Art.17',title:'Right to be Forgotten',desc:'Respond to deletion requests',impl:'Delete Account feature + CASCADE settings'},
{id:'Art.32',title:'Security Measures',desc:'Technical and organizational measures',impl:'Encryption + Access control + Audit logs'},
{id:'Art.33',title:'Breach Notification',desc:'Notify supervisory authority within 72 hours',impl:'Incident Response procedures'}
]
},
ismap:{
name:'ISMAP (政府情報システムのためのセキュリティ評価制度)',
domains:['government'],
reqs_ja:[
{id:'1441',title:'データローカリティ',desc:'日本国内データセンター必須',impl:'東京/大阪リージョン限定'},
{id:'1442',title:'暗号化強度',desc:'CRYPTREC推奨暗号リスト準拠',impl:'AES-256/SHA-256/RSA-2048'},
{id:'1443',title:'監査ログ保存',desc:'7年間保存',impl:'S3 Glacier Deep Archive'},
{id:'1444',title:'クラウド事業者認証',desc:'ISMAP登録サービス利用推奨',impl:'AWS/Azure/GCP ISMAPサービス'},
{id:'1445',title:'インシデント報告',desc:'重大事象は24時間以内報告',impl:'エスカレーション手順書'}
],
reqs_en:[
{id:'1441',title:'Data Locality',desc:'Japan data center required',impl:'Tokyo/Osaka regions only'},
{id:'1442',title:'Encryption Strength',desc:'CRYPTREC recommended cipher list',impl:'AES-256/SHA-256/RSA-2048'},
{id:'1443',title:'Audit Log Retention',desc:'7 years retention',impl:'S3 Glacier Deep Archive'},
{id:'1444',title:'Cloud Provider Certification',desc:'Use ISMAP registered services',impl:'AWS/Azure/GCP ISMAP services'},
{id:'1445',title:'Incident Reporting',desc:'Report critical incidents within 24 hours',impl:'Escalation procedures'}
]
},
soc2:{
name:'SOC 2 Type II',
domains:['saas'],
reqs_ja:[
{id:'CC6.1',title:'論理アクセス制御',desc:'ロールベースアクセス制御実装',impl:'RBAC + 最小権限原則'},
{id:'CC6.6',title:'暗号化',desc:'保管時・転送時暗号化',impl:'TLS 1.3 + AES-256'},
{id:'CC7.2',title:'変更管理',desc:'本番変更の承認プロセス',impl:'Pull Request + Approval workflow'},
{id:'CC7.3',title:'セキュリティ監視',desc:'異常検知・アラート',impl:'CloudWatch/Datadog監視'},
{id:'CC9.2',title:'ベンダー管理',desc:'サードパーティリスク評価',impl:'Vendor Security Assessment'}
],
reqs_en:[
{id:'CC6.1',title:'Logical Access Control',desc:'Implement role-based access control',impl:'RBAC + least privilege'},
{id:'CC6.6',title:'Encryption',desc:'At-rest and in-transit encryption',impl:'TLS 1.3 + AES-256'},
{id:'CC7.2',title:'Change Management',desc:'Approval process for production changes',impl:'Pull Request + Approval workflow'},
{id:'CC7.3',title:'Security Monitoring',desc:'Anomaly detection and alerting',impl:'CloudWatch/Datadog monitoring'},
{id:'CC9.2',title:'Vendor Management',desc:'Third-party risk assessment',impl:'Vendor Security Assessment'}
]
},
ferpa:{
name:'FERPA (Family Educational Rights and Privacy Act)',
domains:['education'],
reqs_ja:[
{id:'§99.31',title:'同意なし開示制限',desc:'教育記録の第三者提供制限',impl:'保護者同意フロー + 開示記録'},
{id:'§99.32',title:'開示記録保管',desc:'開示履歴の記録・保管',impl:'Audit log + 5年保管'},
{id:'§99.35',title:'アクセス権',desc:'学生・保護者が記録を閲覧可能',impl:'View Records機能'},
{id:'§99.7',title:'セキュリティ対策',desc:'不正アクセス防止',impl:'認証 + 暗号化 + アクセス制御'}
],
reqs_en:[
{id:'§99.31',title:'Disclosure Restrictions',desc:'Limit third-party access to education records',impl:'Parental consent flow + disclosure records'},
{id:'§99.32',title:'Disclosure Record Retention',desc:'Maintain disclosure history',impl:'Audit log + 5-year retention'},
{id:'§99.35',title:'Right of Access',desc:'Students/parents can view records',impl:'View Records feature'},
{id:'§99.7',title:'Security Measures',desc:'Prevent unauthorized access',impl:'Auth + encryption + access control'}
]
},
asvs:{
name:'OWASP ASVS Level 2',
domains:['default'],
reqs_ja:[
{id:'V1.4',title:'アクセス制御設計',desc:'デフォルト拒否原則',impl:'RLS/Security Rules + 認可チェック'},
{id:'V2.1',title:'パスワードセキュリティ',desc:'10文字以上、pwned passwords回避',impl:'Auth provider設定'},
{id:'V3.4',title:'セッション管理',desc:'セッション無効化・タイムアウト',impl:'JWT有効期限 + refresh token'},
{id:'V5.2',title:'入力検証',desc:'ホワイトリスト検証',impl:'Zodスキーマ + サーバー検証'},
{id:'V8.1',title:'データ保護',desc:'機密データ暗号化',impl:'列レベル暗号化 + TLS'}
],
reqs_en:[
{id:'V1.4',title:'Access Control Design',desc:'Default deny principle',impl:'RLS/Security Rules + authz checks'},
{id:'V2.1',title:'Password Security',desc:'10+ chars, avoid pwned passwords',impl:'Auth provider settings'},
{id:'V3.4',title:'Session Management',desc:'Session invalidation and timeout',impl:'JWT expiration + refresh token'},
{id:'V5.2',title:'Input Validation',desc:'Whitelist validation',impl:'Zod schemas + server validation'},
{id:'V8.1',title:'Data Protection',desc:'Encrypt sensitive data',impl:'Column-level encryption + TLS'}
]
}
};
// STRIDE Threat Patterns
const STRIDE_PATTERNS={
hasUserId:{S:'HIGH',T:'MED',R:'MED',I:'HIGH',D:'LOW',E:'HIGH'},
isPayment:{S:'CRITICAL',T:'CRITICAL',R:'HIGH',I:'HIGH',D:'MED',E:'CRITICAL'},
isPublic:{S:'LOW',T:'LOW',R:'LOW',I:'MED',D:'MED',E:'LOW'},
hasFile:{S:'MED',T:'HIGH',I:'HIGH',D:'MED',E:'MED'},
default:{S:'MED',T:'MED',R:'LOW',I:'MED',D:'LOW',E:'MED'}
};
// Helper: Checkbox
function _chk(ja,en){const G=S.genLang==='ja';return'- [ ] '+(G?ja:en)+'\n';}

// Helper: Security level label
function _lvl(lv){
const m={CRITICAL:'🔴 Critical',HIGH:'🟠 High',MED:'🟡 Medium',LOW:'🟢 Low'};
return m[lv]||lv;
}

// Helper: OWASP section
function _owaspSection(item,backend){
const G=S.genLang==='ja';
let out='### '+item.id+': '+(G?item.ja:item.en)+'\n\n';
const checks=G?item.checks_ja:item.checks_en;
checks.forEach(c=>out+=_chk(c,c));
out+='\n';
// Stack-specific checks
if(item.stack){
out+=(G?'**技術スタック別チェック:**\n\n':'**Stack-Specific Checks:**\n\n');
const bk=backend||'express';
const key=bk.toLowerCase().includes('supabase')?'supabase':
bk.toLowerCase().includes('firebase')?'firebase':
bk.toLowerCase().includes('github')?'github':
bk.toLowerCase().includes('npm')?'npm':
bk.toLowerCase().includes('vercel')?'vercel':'express';
if(item.stack[key]){
item.stack[key].forEach(s=>out+='- '+s+'\n');
}
}
return out+'\n';
}

// Helper: Compliance section
function _compSection(comp,G){
const reqs=G?comp.reqs_ja:comp.reqs_en;
let out='## '+comp.name+'\n\n';
out+=(G?'**適用対象ドメイン:** ':'**Applicable Domains:** ')+comp.domains.join(', ')+'\n\n';
out+=(G?'### 必須要件チェックリスト\n\n':'### Required Compliance Checklist\n\n');
reqs.forEach(r=>{
out+='#### '+r.id+': '+r.title+'\n';
out+='- **'+(G?'説明':'Description')+':** '+r.desc+'\n';
out+='- **'+(G?'実装':'Implementation')+':** '+r.impl+'\n';
out+=_chk(r.title,r.title);
out+='\n';
});
return out;
}

// Main Generator
function genPillar12_SecurityIntelligence(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'default';
const backend=a.backend||'Supabase';
const frontend=a.frontend||'React + Next.js';
const database=a.database||'PostgreSQL';
const auth=resolveAuth(a);
const entities=(a.data_entities||'').split(/[,、]/).map(e=>e.trim()).filter(e=>e);
const features=(a.mvp_features||'').split(/[,、]/).map(f=>f.trim()).filter(f=>f);
const hasPayment=a.payment&&a.payment!=='none';
const hasAI=a.ai_auto&&a.ai_auto!=='none';
// ═══ DOC 43: Security Intelligence Report ═══
let doc43='';
doc43+='# '+(G?'セキュリティインテリジェンスレポート':'Security Intelligence Report')+'\n\n';
doc43+='> '+(G?'プロジェクト: ':'Project: ')+pn+'\n';
doc43+='> '+(G?'生成日: ':'Generated: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc43+=(G?'## 📋 目次\n\n':'## 📋 Table of Contents\n\n');
doc43+='1. [OWASP Top 10 (2025) Adaptive Audit](#owasp-top-10-2025-adaptive-audit)\n';
doc43+='2. [Security Headers Configuration](#security-headers-configuration)\n';
doc43+='3. [Shared Responsibility Model](#shared-responsibility-model)\n';
doc43+='4. [Secrets Management](#secrets-management)\n';
doc43+='5. [Authentication & Session Security](#authentication--session-security)\n\n';
doc43+='---\n\n';
// OWASP Section
doc43+='## OWASP Top 10 (2025) Adaptive Audit\n\n';
doc43+=(G?'このセクションではOWASP Top 10 2025の各項目について、プロジェクトの技術スタックに適応したチェックリストを提供します。\n\n':'This section provides stack-adaptive checklists for each OWASP Top 10 2025 category.\n\n');
OWASP_2025.forEach(item=>{
doc43+=_owaspSection(item,backend);
});
// Security Headers
doc43+='---\n\n## Security Headers Configuration\n\n';
doc43+=(G?'### Content Security Policy (CSP)\n\n':'### Content Security Policy (CSP)\n\n');
if(frontend.includes('Next.js')){
doc43+=(G?'**Next.js middleware実装例:**\n\n':'**Next.js middleware implementation:**\n\n');
doc43+='```typescript\n';
doc43+='// middleware.ts\n';
doc43+='import { NextResponse } from \'next/server\';\n';
doc43+='export function middleware(request: Request) {\n';
doc43+='  const nonce = Buffer.from(crypto.randomUUID()).toString(\'base64\');\n';
doc43+='  const cspHeader = `\n';
doc43+='    default-src \'self\';\n';
doc43+='    script-src \'self\' \'nonce-${nonce}\' \'strict-dynamic\';\n';
doc43+='    style-src \'self\' \'nonce-${nonce}\';\n';
doc43+='    img-src \'self\' blob: data:;\n';
doc43+='    font-src \'self\';\n';
doc43+='    object-src \'none\';\n';
doc43+='    base-uri \'self\';\n';
doc43+='    form-action \'self\';\n';
doc43+='    frame-ancestors \'none\';\n';
doc43+='    upgrade-insecure-requests;\n';
doc43+='  `.replace(/\\s{2,}/g, \' \').trim();\n';
doc43+='  const response = NextResponse.next();\n';
doc43+='  response.headers.set(\'Content-Security-Policy\', cspHeader);\n';
doc43+='  response.headers.set(\'X-Nonce\', nonce);\n';
doc43+='  return response;\n';
doc43+='}\n';
doc43+='```\n\n';
}else{
doc43+=(G?'**Express helmet実装例:**\n\n':'**Express helmet implementation:**\n\n');
doc43+='```javascript\n';
doc43+='const helmet = require(\'helmet\');\n';
doc43+='app.use(helmet.contentSecurityPolicy({\n';
doc43+='  directives: {\n';
doc43+='    defaultSrc: ["\'self\'"],\n';
doc43+='    scriptSrc: ["\'self\'", "\'unsafe-inline\'"],\n';
doc43+='    styleSrc: ["\'self\'", "\'unsafe-inline\'"],\n';
doc43+='    imgSrc: ["\'self\'", "data:", "blob:"],\n';
doc43+='    connectSrc: ["\'self\'"],\n';
doc43+='    fontSrc: ["\'self\'"],\n';
doc43+='    objectSrc: ["\'none\'"],\n';
doc43+='    upgradeInsecureRequests: []\n';
doc43+='  }\n';
doc43+='}));\n';
doc43+='```\n\n';
}

doc43+=(G?'### その他の必須ヘッダー\n\n':'### Other Essential Headers\n\n');
doc43+='```http\n';
doc43+='Strict-Transport-Security: max-age=63072000; includeSubDomains; preload\n';
doc43+='X-Frame-Options: DENY\n';
doc43+='X-Content-Type-Options: nosniff\n';
doc43+='Referrer-Policy: strict-origin-when-cross-origin\n';
doc43+='Permissions-Policy: geolocation=(), microphone=(), camera=()\n';
doc43+='```\n\n';
// Shared Responsibility Model
doc43+='---\n\n## Shared Responsibility Model\n\n';
const isBaaS=backend.includes('Supabase')||backend.includes('Firebase')||backend.includes('Convex');
if(isBaaS){
doc43+=(G?'### BaaSプロバイダ vs アプリケーション責任分界\n\n':'### BaaS Provider vs Application Responsibility\n\n');
doc43+='| '+(G?'セキュリティ領域':'Security Domain')+' | '+(G?'プロバイダ担当':'Provider')+' | '+(G?'あなたが担当':'Your Responsibility')+' |\n';
doc43+='|---|---|---|\n';
doc43+='| '+(G?'物理インフラ':'Physical Infrastructure')+' | ✅ | |\n';
doc43+='| '+(G?'ネットワーク':'Network Security')+' | ✅ | |\n';
doc43+='| '+(G?'データベース暗号化':'Database Encryption')+' | ✅ | |\n';
doc43+='| '+(G?'パッチ適用':'Patching')+' | ✅ | |\n';
doc43+='| **'+(G?'RLS/Security Rules':'RLS/Security Rules')+'** | | ✅ |\n';
doc43+='| **'+(G?'認証設定':'Auth Configuration')+'** | | ✅ |\n';
doc43+='| **'+(G?'アプリケーションロジック':'Application Logic')+'** | | ✅ |\n';
doc43+='| **'+(G?'入力検証':'Input Validation')+'** | | ✅ |\n';
doc43+='| **'+(G?'APIキー管理':'API Key Management')+'** | | ✅ |\n';
doc43+='| **'+(G?'監査ログ設定':'Audit Log Configuration')+'** | | ✅ |\n';
doc43+='\n';
doc43+=(G?'⚠️ **重要:** プロバイダがインフラを保護しても、RLS/Rulesやアプリロジックの脆弱性はあなたの責任です。\n\n':'⚠️ **Important:** Even if the provider secures infrastructure, RLS/Rules and app logic vulnerabilities are your responsibility.\n\n');
}else{
doc43+=(G?'### 自前サーバー — 完全責任モデル\n\n':'### Self-Hosted — Full Responsibility Model\n\n');
doc43+=(G?'あなたがすべてのレイヤーを担当します:\n\n':'You are responsible for all layers:\n\n');
doc43+='- '+(G?'サーバーOS・パッチ管理':'Server OS & patching')+'\n';
doc43+='- '+(G?'ファイアウォール・ネットワーク設定':'Firewall & network configuration')+'\n';
doc43+='- '+(G?'データベース暗号化設定':'Database encryption settings')+'\n';
doc43+='- '+(G?'TLS証明書管理':'TLS certificate management')+'\n';
doc43+='- '+(G?'アプリケーションセキュリティ':'Application security')+'\n';
doc43+='- '+(G?'監視・ログ収集':'Monitoring & logging')+'\n\n';
}

// Secrets Management
doc43+='---\n\n## Secrets Management\n\n';
doc43+=(G?'### シークレット管理の3段階\n\n':'### 3-Tier Secrets Management\n\n');
doc43+='1. **'+(G?'開発環境':'Development')+' (`.env.local`):** '+(G?'ローカルのみ、Gitignore必須':'Local only, must be in .gitignore')+'\n';
doc43+='2. **'+(G?'CI/CD':'CI/CD')+' (GitHub Secrets):** '+(G?'OIDC推奨、パーソナルトークン非推奨':'Use OIDC, avoid PATs')+'\n';
doc43+='3. **'+(G?'本番環境':'Production')+' (Secrets Manager):** AWS Secrets Manager / GCP Secret Manager / Azure Key Vault\n\n';
doc43+=(G?'### クライアントバンドル漏洩チェック\n\n':'### Client Bundle Leakage Check\n\n');
doc43+='```bash\n';
doc43+='# Next.js build output inspection\n';
doc43+='npm run build\n';
doc43+='grep -r "sk_live" .next/static/  # Stripe secret key should NOT appear\n';
doc43+='grep -r "SERVICE_ROLE" .next/static/  # Supabase service_role should NOT appear\n';
doc43+='```\n\n';
doc43+=_chk('環境変数がクライアントバンドルに含まれていないことを確認','Verify env vars not in client bundle')+'\n';
doc43+=_chk('NEXT_PUBLIC_プレフィックスの使用を最小限に','Minimize NEXT_PUBLIC_ usage')+'\n';
doc43+=_chk('Secrets Managerでローテーション戦略を設定','Set up rotation strategy in Secrets Manager')+'\n\n';
// Authentication & Session Security
doc43+='---\n\n## Authentication & Session Security\n\n';
doc43+=(G?'### 認証方式: ':'### Auth Method: ')+auth.sot+'\n\n';
if(auth.sot.includes('Supabase')){
doc43+='#### Supabase Auth Configuration\n\n';
doc43+=_chk('MFA有効化 (Dashboard → Auth → MFA)','Enable MFA (Dashboard → Auth → MFA)')+'\n';
doc43+=_chk('Email confirmation強制','Enforce email confirmation')+'\n';
doc43+=_chk('JWT有効期限を適切に設定 (デフォルト1時間)','Set appropriate JWT expiry (default 1h)')+'\n';
doc43+=_chk('Refresh token rotation有効化','Enable refresh token rotation')+'\n';
doc43+=_chk('カスタムClaimsでRBAC実装','Implement RBAC with custom claims')+'\n\n';
}else if(auth.sot.includes('Firebase')){
doc43+='#### Firebase Auth Configuration\n\n';
doc43+=_chk('Firebase Auth MFA有効化','Enable Firebase Auth MFA')+'\n';
doc43+=_chk('Email enumeration protection有効','Enable email enumeration protection')+'\n';
doc43+=_chk('passwordPolicyOptions設定','Configure passwordPolicyOptions')+'\n';
doc43+=_chk('reCAPTCHA統合','Integrate reCAPTCHA')+'\n\n';
}else if(auth.sot.includes('NextAuth')||auth.sot.includes('Auth.js')){
doc43+='#### NextAuth Configuration\n\n';
doc43+=_chk('NEXTAUTH_SECRET強化 (32文字以上ランダム)','Strengthen NEXTAUTH_SECRET (32+ random chars)')+'\n';
doc43+=_chk('session.maxAge適切化 (デフォルト30日→短縮検討)','Optimize session.maxAge (default 30d → consider shortening)')+'\n';
doc43+=_chk('session.updateAge設定','Set session.updateAge')+'\n';
doc43+=_chk('CSRFトークン検証有効','Verify CSRF token validation enabled')+'\n\n';
}else{
doc43+='#### Custom JWT Implementation\n\n';
doc43+=_chk('JWT署名アルゴリズムRS256推奨 (HS256非推奨)','Use RS256 for JWT signing (avoid HS256)')+'\n';
doc43+=_chk('Access token有効期限15分以内','Access token expiry ≤15 min')+'\n';
doc43+=_chk('Refresh token rotation実装','Implement refresh token rotation')+'\n';
doc43+=_chk('Token blacklist実装 (Redis推奨)','Implement token blacklist (Redis recommended)')+'\n\n';
}

doc43+=(G?'### セッション管理ベストプラクティス\n\n':'### Session Management Best Practices\n\n');
doc43+=_chk('ログアウト時にサーバー側でセッション無効化','Invalidate session server-side on logout')+'\n';
doc43+=_chk('並行セッション制限検討','Consider concurrent session limits')+'\n';
doc43+=_chk('異常なセッション活動を監視','Monitor abnormal session activity')+'\n';
doc43+=_chk('パスワード変更時に全セッション無効化','Invalidate all sessions on password change')+'\n\n';
doc43+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc43+='- [Threat Model](./44_threat_model.md)\n';
doc43+='- [Compliance Matrix](./45_compliance_matrix.md)\n';
doc43+='- [AI Security Playbook](./46_ai_security.md)\n';
doc43+='- [Security Testing](./47_security_testing.md)\n';
doc43+='- [Incident Response](./34_incident_response.md)\n';
doc43+='- [Security (Overview)](./08_security.md)\n';
// Org-scoped RLS (multi-tenant enhancement)
var _isMultiTenant=/マルチ|multi|RLS|組織|org.*hier/i.test((a.org_model||'')+(a.mvp_features||''));
if(_isMultiTenant){
doc43+='\n## '+(G?'🔒 組織スコープ RLSポリシー (マルチテナント)':'🔒 Org-Scoped RLS Policies (Multi-tenant)')+'\n\n';
doc43+=(G?'> マルチテナント環境での完全なテナント分離を実現するRLSポリシーテンプレート。\n\n':
'> RLS policy templates for complete tenant isolation in multi-tenant environments.\n\n');
doc43+='```sql\n';
doc43+='-- '+(G?'基本: 組織メンバーのみアクセス可能':'Base: org members only') +'\n';
doc43+='CREATE POLICY "org_isolation" ON resources\n';
doc43+='  FOR SELECT USING (\n';
doc43+='    org_id IN (\n';
doc43+='      SELECT org_id FROM org_members\n';
doc43+='      WHERE user_id = auth.uid()\n';
doc43+='    )\n';
doc43+='  );\n\n';
doc43+='-- '+(G?'Admin以上のみ書込可能':'Admin or above can write')+'\n';
doc43+='CREATE POLICY "admin_write" ON org_settings\n';
doc43+='  FOR ALL USING (\n';
doc43+='    org_id IN (\n';
doc43+='      SELECT org_id FROM org_members\n';
doc43+='      WHERE user_id = auth.uid()\n';
doc43+='      AND role IN (\'owner\', \'admin\')\n';
doc43+='    )\n';
doc43+='  );\n\n';
doc43+='-- '+(G?'Ownerのみ削除可能':'Owner only can delete')+'\n';
doc43+='CREATE POLICY "owner_delete" ON organizations\n';
doc43+='  FOR DELETE USING (\n';
doc43+='    id IN (\n';
doc43+='      SELECT org_id FROM org_members\n';
doc43+='      WHERE user_id = auth.uid() AND role = \'owner\'\n';
doc43+='    )\n';
doc43+='  );\n```\n\n';
doc43+=(G?'### クロステナントクエリ防止チェックリスト\n\n':'### Cross-tenant Query Prevention Checklist\n\n');
doc43+=(G?'- [ ] 全テーブルに `org_id` カラムが存在するか\n':'- [ ] All tables have `org_id` column\n');
doc43+=(G?'- [ ] 全テーブルでRLSが `ENABLED` になっているか\n':'- [ ] RLS is ENABLED on all tables\n');
doc43+=(G?'- [ ] `service_role` キーはサーバーサイドのみで使用されているか\n':'- [ ] `service_role` key used server-side only\n');
doc43+=(G?'- [ ] `auth.uid()` を使ったポリシーが全テーブルに設定されているか\n':'- [ ] `auth.uid()` policies set on all tables\n');
doc43+=(G?'- [ ] org_idでのINDEX設定 (`(org_id, id)`) が完了しているか\n':'- [ ] Index on `(org_id, id)` created for performance\n');
}

S.files['docs/43_security_intelligence.md']=doc43;
// ═══ DOC 44: STRIDE Threat Model ═══
let doc44='';
doc44+='# '+(G?'脅威モデル — STRIDE分析':'Threat Model — STRIDE Analysis')+'\n\n';
doc44+='> '+(G?'プロジェクト: ':'Project: ')+pn+'\n';
doc44+='> '+(G?'生成日: ':'Generated: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc44+='## '+(G?'システム概要':'System Overview')+'\n\n';
doc44+='- **Frontend:** '+frontend+'\n';
doc44+='- **Backend:** '+backend+'\n';
doc44+='- **Database:** '+database+'\n';
doc44+='- **Auth:** '+auth.sot+'\n';
doc44+='- **Domain:** '+domain+'\n\n';
// Trust Boundaries
doc44+='## '+(G?'トラストバウンダリ':'Trust Boundaries')+'\n\n';
doc44+='```mermaid\n';
doc44+='flowchart LR\n';
doc44+='  Client["👤 Client\\n(Browser)"] -->|HTTPS| CDN["🌐 CDN\\n(Vercel/Cloudflare)"]\n';
doc44+='  CDN -->|TLS| API["⚙️ API\\n('+backend+')"]\n';
doc44+='  API -->|Encrypted| DB["🗄️ Database\\n('+database+')"]\n';
doc44+='  API -->|JWT| Auth["🔐 Auth\\n('+auth.provider+')"]\n';
if(hasPayment){
doc44+='  API -->|Tokenized| Payment["💳 Payment\\n(Stripe)"]\n';
}
doc44+='  \n';
doc44+='  style Client fill:#e1f5ff\n';
doc44+='  style CDN fill:#fff4e1\n';
doc44+='  style API fill:#ffe1e1\n';
doc44+='  style DB fill:#e1ffe1\n';
doc44+='  style Auth fill:#f0e1ff\n';
if(hasPayment){
doc44+='  style Payment fill:#ffe1f0\n';
}
doc44+='```\n\n';
doc44+=(G?'**境界:**\n\n':'**Boundaries:**\n\n');
doc44+='1. **'+(G?'パブリックインターネット ↔ CDN':'Public Internet ↔ CDN')+'**\n';
doc44+='2. **CDN ↔ API** '+(G?'(信頼境界)':'(Trust boundary)')+'\n';
doc44+='3. **API ↔ Database** '+(G?'(内部境界)':'(Internal boundary)')+'\n\n';
// STRIDE per Entity
doc44+='## '+(G?'エンティティ別STRIDE脅威分析':'STRIDE Threat Analysis per Entity')+'\n\n';
if(entities.length===0){
doc44+=(G?'> ⚠️ data_entitiesが未定義のため、一般的な脅威のみ記載します。\n\n':'> ⚠️ No entities defined. Showing generic threats only.\n\n');
}else{
doc44+='| Entity | S (Spoofing) | T (Tampering) | R (Repudiation) | I (Info Disclosure) | D (DoS) | E (Elevation) |\n';
doc44+='|--------|--------------|---------------|-----------------|---------------------|---------|---------------|\n';
entities.forEach(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const hasUser=cols.some(c=>c.col==='user_id'||c.col.includes('user_id'));
const isPay=ent.toLowerCase().includes('payment')||ent.toLowerCase().includes('order')||ent.toLowerCase().includes('transaction');
const isPub=ent.toLowerCase().includes('post')||ent.toLowerCase().includes('article')||ent.toLowerCase().includes('blog');
const hasFileCol=cols.some(c=>c.col.includes('file')||c.col.includes('image')||c.col.includes('attachment'));
let pattern=STRIDE_PATTERNS.default;
if(isPay)pattern=STRIDE_PATTERNS.isPayment;
else if(hasUser)pattern=STRIDE_PATTERNS.hasUserId;
else if(isPub)pattern=STRIDE_PATTERNS.isPublic;
else if(hasFileCol)pattern=STRIDE_PATTERNS.hasFile;
doc44+='| '+ent+' | '+_lvl(pattern.S)+' | '+_lvl(pattern.T)+' | '+_lvl(pattern.R)+' | '+_lvl(pattern.I)+' | '+_lvl(pattern.D)+' | '+_lvl(pattern.E)+' |\n';
});
doc44+='\n';
}

// Attack Surface Analysis
doc44+='## '+(G?'攻撃対象領域分析':'Attack Surface Analysis')+'\n\n';
doc44+=(G?'### 外部入力ポイント\n\n':'### External Input Points\n\n');
const inputs=[];
if(features.some(f=>f.toLowerCase().includes('auth')||f.toLowerCase().includes('login')||f.toLowerCase().includes('signup'))){
inputs.push(G?'ログイン/サインアップフォーム':'Login/Signup forms');
}
if(features.some(f=>f.toLowerCase().includes('post')||f.toLowerCase().includes('comment')||f.toLowerCase().includes('review'))){
inputs.push(G?'コンテンツ投稿フォーム':'Content submission forms');
}
if(features.some(f=>f.toLowerCase().includes('search'))){
inputs.push(G?'検索クエリ':'Search queries');
}
if(features.some(f=>f.toLowerCase().includes('upload')||f.toLowerCase().includes('file')||f.toLowerCase().includes('image'))){
inputs.push(G?'ファイルアップロード':'File uploads');
}
if(features.some(f=>f.toLowerCase().includes('api'))){
inputs.push('REST/GraphQL API');
}
if(hasPayment){
inputs.push(G?'決済フォーム':'Payment forms');
}

if(inputs.length>0){
inputs.forEach(inp=>doc44+='- '+inp+'\n');
doc44+='\n';
}else{
doc44+=(G?'> 特定の入力ポイントは検出されませんでした。mvp_featuresを確認してください。\n\n':'> No specific input points detected. Review mvp_features.\n\n');
}

doc44+=(G?'### 高リスクフィーチャー\n\n':'### High-Risk Features\n\n');
const highRisk=[];
if(features.some(f=>f.toLowerCase().includes('auth')))highRisk.push(G?'認証機能 (CRITICAL)':'Authentication (CRITICAL)');
if(hasPayment)highRisk.push(G?'決済処理 (CRITICAL)':'Payment processing (CRITICAL)');
if(features.some(f=>f.toLowerCase().includes('upload')))highRisk.push(G?'ファイルアップロード (HIGH)':'File uploads (HIGH)');
if(hasAI)highRisk.push(G?'AI統合 (HIGH — プロンプトインジェクション)':'AI integration (HIGH — prompt injection)');
if(features.some(f=>f.toLowerCase().includes('admin')))highRisk.push(G?'管理機能 (HIGH)':'Admin features (HIGH)');
if(highRisk.length>0){
highRisk.forEach(hr=>doc44+='- '+hr+'\n');
doc44+='\n';
}

// Threat-Mitigation Matrix
doc44+='## '+(G?'脅威-対策マトリクス':'Threat-Mitigation Matrix')+'\n\n';
doc44+='| '+(G?'脅威':'Threat')+' | '+(G?'リスク':'Risk')+' | '+(G?'対策':'Mitigation')+' | '+(G?'実装':'Implementation')+' | Status |\n';
doc44+='|------|------|-----------|----------------|--------|\n';
// Generic threats
const threats=[
{threat_ja:'SQLインジェクション',threat_en:'SQL Injection',risk:'HIGH',mit_ja:'パラメータ化クエリ',mit_en:'Parameterized queries',impl:'ORM/Supabase RLS'},
{threat_ja:'XSS',threat_en:'XSS',risk:'HIGH',mit_ja:'入力サニタイズ + CSP',mit_en:'Input sanitization + CSP',impl:'DOMPurify + CSP headers'},
{threat_ja:'CSRF',threat_en:'CSRF',risk:'MED',mit_ja:'CSRFトークン',mit_en:'CSRF tokens',impl:'SameSite cookies + tokens'},
{threat_ja:'IDOR',threat_en:'IDOR',risk:'HIGH',mit_ja:'認可チェック',mit_en:'Authorization checks',impl:'RLS policies / owner checks'},
{threat_ja:'認証バイパス',threat_en:'Auth bypass',risk:'CRITICAL',mit_ja:'サーバー側検証',mit_en:'Server-side validation',impl:'Middleware / RLS'},
];
if(hasPayment){
threats.push({threat_ja:'カード情報漏洩',threat_en:'Card data leakage',risk:'CRITICAL',mit_ja:'トークナイゼーション',mit_en:'Tokenization',impl:'Stripe Elements'});
}
if(hasAI){
threats.push({threat_ja:'プロンプトインジェクション',threat_en:'Prompt injection',risk:'HIGH',mit_ja:'入力検証 + コンテキスト分離',mit_en:'Input validation + context isolation',impl:'See docs/46_ai_security.md'});
}

threats.forEach(t=>{
const threat=G?t.threat_ja:t.threat_en;
const mit=G?t.mit_ja:t.mit_en;
doc44+='| '+threat+' | '+_lvl(t.risk)+' | '+mit+' | '+t.impl+' | ⬜ |\n';
});
doc44+='\n';
doc44+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc44+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc44+='- [Security Testing](./47_security_testing.md)\n';
doc44+='- [Incident Response](./34_incident_response.md)\n';
S.files['docs/44_threat_model.md']=doc44;
// ═══ DOC 45: Compliance Matrix ═══
let doc45='';
doc45+='# '+(G?'コンプライアンスマトリクス':'Compliance Matrix')+'\n\n';
doc45+='> '+(G?'プロジェクト: ':'Project: ')+pn+'\n';
doc45+='> '+(G?'ドメイン: ':'Domain: ')+domain+'\n';
doc45+='> '+(G?'生成日: ':'Generated: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc45+=(G?'このドキュメントは、プロジェクトのドメインに基づいて該当するコンプライアンスフレームワークのチェックリストを提供します。\n\n':'This document provides compliance framework checklists based on your project domain.\n\n');
// Determine applicable compliance frameworks
const applicableComp=[];
Object.keys(COMPLIANCE_DB).forEach(key=>{
const comp=COMPLIANCE_DB[key];
if(comp.domains.includes(domain)){
applicableComp.push(comp);
}
});
// Always include ASVS as baseline
if(!applicableComp.some(c=>c.name.includes('ASVS'))){
applicableComp.push(COMPLIANCE_DB.asvs);
}

if(applicableComp.length===0){
applicableComp.push(COMPLIANCE_DB.asvs);
}

doc45+='## '+(G?'適用フレームワーク':'Applicable Frameworks')+'\n\n';
applicableComp.forEach(c=>doc45+='- **'+c.name+'** ('+c.domains.join(', ')+')\n');
doc45+='\n---\n\n';
applicableComp.forEach(comp=>{
doc45+=_compSection(comp,G);
doc45+='---\n\n';
});
doc45+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc45+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc45+='- [Incident Response](./34_incident_response.md)\n';
doc45+='- [QA Strategy](./28_qa_strategy.md)\n';
S.files['docs/45_compliance_matrix.md']=doc45;
// ═══ DOC 46: AI Security Playbook ═══
let doc46='';
doc46+='# '+(G?'AI時代のセキュリティプレイブック':'AI-Era Security Playbook')+'\n\n';
doc46+='> '+(G?'AI生成コード特有のリスクと対策を包括的にカバー':'Comprehensive coverage of AI-generated code risks and mitigations')+'\n\n';
doc46+='## '+(G?'1. Velocity Paradox — 速度のパラドックス':'1. Velocity Paradox')+'\n\n';
doc46+=(G?
'AI支援開発により開発速度は劇的に向上しますが、同時にセキュリティリスクも増大します。\n\n'+
'**統計:**\n'+
'- AI生成コードの45-62%に脆弱性が含まれる (Stanford研究)\n'+
'- 「正しさの幻想」(Illusion of Correctness): AIが生成したコードは人間より信頼されやすい\n'+
'- シャドーコード累積: レビューされないAI生成コードが積み重なるリスク\n\n'
:
'AI-assisted development dramatically increases velocity, but also security risks.\n\n'+
'**Statistics:**\n'+
'- 45-62% of AI-generated code contains vulnerabilities (Stanford study)\n'+
'- Illusion of Correctness: AI code is trusted more than human code\n'+
'- Shadow Code Accumulation: Unreviewed AI code accumulates\n\n'
);
doc46+='## '+(G?'2. Package Hallucination Detection — パッケージ幻覚検知':'2. Package Hallucination Detection')+'\n\n';
doc46+=(G?'AIは存在しないパッケージを「幻覚」として提案することがあります。\n\n':'AI can hallucinate non-existent packages.\n\n');
doc46+=(G?'### 検証ワークフロー\n\n':'### Verification Workflow\n\n');
doc46+='```bash\n';
doc46+='# Step 1: Verify package exists\n';
doc46+='npm view <package-name>\n\n';
doc46+='# Step 2: Check registry\n';
doc46+='curl https://registry.npmjs.org/<package-name>\n\n';
doc46+='# Step 3: Check downloads (low downloads = suspicious)\n';
doc46+='npm view <package-name> dist.tarball\n';
doc46+='```\n\n';
doc46+=(G?'### CI検証ステップ\n\n':'### CI Verification Step\n\n');
doc46+='```yaml\n';
doc46+='# .github/workflows/ci.yml\n';
doc46+='- name: Verify packages exist\n';
doc46+='  run: |\n';
doc46+='    for pkg in $(jq -r \'.dependencies | keys[]\' package.json); do\n';
doc46+='      npm view "$pkg" > /dev/null || (echo "Package $pkg not found" && exit 1)\n';
doc46+='    done\n';
doc46+='```\n\n';
doc46+=_chk('Lockfileを必ず使用 (package-lock.json / yarn.lock)','Always use lockfile (package-lock.json / yarn.lock)')+'\n';
doc46+=_chk('SCA (Software Composition Analysis) ツール導入 (Snyk/Dependabot)','Adopt SCA tools (Snyk/Dependabot)')+'\n\n';
doc46+='## '+(G?'3. AI生成コードレビューチェックリスト':'3. AI-Generated Code Review Checklist')+'\n\n';
doc46+=_chk('認可ロジック(Authorization)の存在確認 — IDORチェック','Verify authorization logic exists — check for IDOR')+'\n';
doc46+=_chk('シークレットのハードコード確認','Check for hardcoded secrets')+'\n';
doc46+=_chk('クライアントバンドルへのシークレット漏洩','Verify secrets not in client bundle')+'\n';
doc46+=_chk('入力バリデーションの網羅性','Verify comprehensive input validation')+'\n';
doc46+=_chk('エラーハンドリングの適切性 (情報漏洩回避)','Proper error handling (avoid info leakage)')+'\n';
doc46+=_chk('論理的欠陥の有無 (ビジネスロジック検証)','Check for logical flaws (business logic)')+'\n';
doc46+=_chk('レースコンディション脆弱性','Race condition vulnerabilities')+'\n';
doc46+=_chk('SQL/NoSQLインジェクション防止','SQL/NoSQL injection prevention')+'\n\n';
doc46+='## '+(G?'4. 敵対的AIレビュープロンプト':'4. Adversarial AI Review Prompts')+'\n\n';
doc46+=(G?'セキュリティ監査用プロンプトテンプレート:\n\n':'Security audit prompt templates:\n\n');
// Entity security classification (reuse pattern from doc44 STRIDE analysis)
const entClasses=entities.map(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const hasU=cols.some(c=>c.col==='user_id'||c.col.includes('user_id'));
const isPay=ent.toLowerCase().match(/payment|order|transaction/);
const hasF=cols.some(c=>c.col.includes('file')||c.col.includes('image'));
return ent+'('+(isPay?'CRITICAL':hasU?'HIGH':hasF?'MED':'STD')+')';
}).join(', ');
const rlsCtx=backend.includes('Supabase')
?(G?'Supabase RLSポリシーを全テーブルで検証':'Verify Supabase RLS policies on all tables')
:backend.includes('Firebase')
?(G?'Firestore Security Rulesを全コレクションで検証':'Verify Firestore Security Rules on all collections')
:(G?'認可ミドルウェアを全ルートで検証':'Verify authorization middleware on all routes');
// Context-aware prompts with project-specific details
const prompts_ja=[
'あなたはセキュリティ監査員です。このコードの認可ロジックの不備を見つけてください。特にIDOR (Insecure Direct Object Reference) 脆弱性に注目してください。\n\n'+
'**プロジェクトコンテキスト:**\n'+
'- エンティティとセキュリティ分類: '+entClasses+'\n'+
'- 認証方式: '+auth.sot+'\n'+
'- 認可検証ポイント: '+rlsCtx+'\n\n'+
'各エンティティのowner検証が適切か、RLS/ミドルウェアがデフォルト拒否原則に従っているかを重点的にチェックしてください。',

'このコードにおけるすべての外部入力ポイントをリストアップし、各入力に対するバリデーション・サニタイゼーションが適切か評価してください。\n\n'+
'**対象エンティティと入力カラム:**\n'+
entities.slice(0,5).map(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const inputCols=cols.filter(c=>!c.col.includes('_id')&&!c.col.includes('created')&&!c.col.includes('updated')).map(c=>c.col).join(', ');
return '- '+ent+': '+inputCols;
}).join('\n')+'\n\n'+
'Zodスキーマによるサーバーサイド検証が全入力に適用されているか確認してください。',

'このコードのエラーハンドリングを分析し、スタックトレースやデバッグ情報が本番環境で漏洩する可能性がないか確認してください。\n\n'+
'**技術スタック別の注意点:**\n'+
(backend.includes('Supabase')?'- Supabase: .error プロパティが詳細すぎないか確認\n':'')+
(backend.includes('Firebase')?'- Firebase: Cloud Functionsのエラーがクライアントに漏洩していないか確認\n':'')+
(frontend.includes('Next.js')?'- Next.js: Server Actionsのエラーが適切にキャッチされているか確認\n':'')+
'\n本番環境では一般的なエラーメッセージのみを返し、詳細はログに記録してください。',

'このコードにハードコードされたシークレット、APIキー、パスワードがないか探してください。環境変数が適切に使用されているか確認してください。\n\n'+
'**チェックすべき環境変数:**\n'+
(backend.includes('Supabase')?'- SUPABASE_SERVICE_ROLE_KEY (サーバーサイドのみ)\n- NEXT_PUBLIC_SUPABASE_ANON_KEY (クライアント公開OK)\n':'')+
(backend.includes('Firebase')?'- FIREBASE_SERVICE_ACCOUNT_KEY (サーバーサイドのみ)\n- NEXT_PUBLIC_FIREBASE_CONFIG (クライアント公開OK)\n':'')+
(hasPayment?'- STRIPE_SECRET_KEY (サーバーサイドのみ)\n- NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY (クライアント公開OK)\n':'')+
'\nクライアントバンドルに機密情報が含まれていないことを `npm run build` 後に検証してください。',

'このコードのセッション管理・トークン管理を分析し、セッション固定攻撃、トークン漏洩、不適切な有効期限設定がないか確認してください。\n\n'+
'**認証実装の詳細:**\n'+
'- Source of Truth: '+auth.sot+'\n'+
'- トークンタイプ: '+(auth.tokenType||'JWT')+'\n'+
'- 検証方式: '+(auth.tokenVerify||'署名検証')+'\n\n'+
(auth.sot.includes('Supabase')?'Supabase Auth: JWT有効期限、refresh token rotation、MFA設定を確認\n':'')+
(auth.sot.includes('Firebase')?'Firebase Auth: セッション有効期限、カスタムクレーム、reCAPTCHA統合を確認\n':'')+
(auth.sot.includes('NextAuth')?'NextAuth: NEXTAUTH_SECRET強度、session.maxAge、CSRF保護を確認\n':'')
];
const prompts_en=[
'You are a security auditor. Find authorization logic flaws in this code. Focus on IDOR (Insecure Direct Object Reference) vulnerabilities.\n\n'+
'**Project Context:**\n'+
'- Entities and Security Classes: '+entClasses+'\n'+
'- Auth Method: '+auth.sot+'\n'+
'- Authorization Verification: '+rlsCtx+'\n\n'+
'Focus on verifying owner checks for each entity and ensuring RLS/middleware follows default-deny principle.',

'List all external input points in this code and evaluate whether validation/sanitization is appropriate for each input.\n\n'+
'**Target Entities and Input Columns:**\n'+
entities.slice(0,5).map(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const inputCols=cols.filter(c=>!c.col.includes('_id')&&!c.col.includes('created')&&!c.col.includes('updated')).map(c=>c.col).join(', ');
return '- '+ent+': '+inputCols;
}).join('\n')+'\n\n'+
'Verify that Zod schema server-side validation is applied to all inputs.',

'Analyze error handling in this code and verify that stack traces or debug information cannot leak in production.\n\n'+
'**Stack-Specific Notes:**\n'+
(backend.includes('Supabase')?'- Supabase: Check if .error property is too detailed\n':'')+
(backend.includes('Firebase')?'- Firebase: Verify Cloud Functions errors do not leak to client\n':'')+
(frontend.includes('Next.js')?'- Next.js: Verify Server Actions errors are properly caught\n':'')+
'\nReturn generic error messages in production and log details server-side.',

'Search for hardcoded secrets, API keys, or passwords in this code. Verify environment variables are used appropriately.\n\n'+
'**Environment Variables to Check:**\n'+
(backend.includes('Supabase')?'- SUPABASE_SERVICE_ROLE_KEY (server-side only)\n- NEXT_PUBLIC_SUPABASE_ANON_KEY (client OK)\n':'')+
(backend.includes('Firebase')?'- FIREBASE_SERVICE_ACCOUNT_KEY (server-side only)\n- NEXT_PUBLIC_FIREBASE_CONFIG (client OK)\n':'')+
(hasPayment?'- STRIPE_SECRET_KEY (server-side only)\n- NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY (client OK)\n':'')+
'\nVerify no secrets in client bundle after `npm run build`.',

'Analyze session/token management in this code and check for session fixation, token leakage, or improper expiration settings.\n\n'+
'**Auth Implementation Details:**\n'+
'- Source of Truth: '+auth.sot+'\n'+
'- Token Type: '+(auth.tokenType||'JWT')+'\n'+
'- Verification: '+(auth.tokenVerify||'Signature verification')+'\n\n'+
(auth.sot.includes('Supabase')?'Supabase Auth: Check JWT expiry, refresh token rotation, MFA settings\n':'')+
(auth.sot.includes('Firebase')?'Firebase Auth: Check session expiry, custom claims, reCAPTCHA integration\n':'')+
(auth.sot.includes('NextAuth')?'NextAuth: Check NEXTAUTH_SECRET strength, session.maxAge, CSRF protection\n':'')
];
const prompts=G?prompts_ja:prompts_en;
// Add stack-specific prompts (conditional)
if(backend.includes('Supabase')){
prompts.push(G?
'Supabase RLSポリシーの網羅性を監査してください。\n\n'+
'**監査対象テーブル:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**チェックポイント:**\n'+
'1. 全テーブルでRLS有効化 (`ALTER TABLE ... ENABLE ROW LEVEL SECURITY`)\n'+
'2. SELECT/INSERT/UPDATE/DELETE 各操作にポリシー定義\n'+
'3. `auth.uid() = user_id` パターンの一貫適用\n'+
'4. `service_role` キーがサーバーサイドのみで使用\n'+
'5. `anon` キーの権限が最小限\n\n'+
'Database settings → Row Level Security でポリシーの有無を確認し、不足があれば具体的なCREATE POLICYステートメントを提案してください。'
:
'Audit Supabase RLS policy coverage.\n\n'+
'**Target Tables:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**Checkpoints:**\n'+
'1. RLS enabled on all tables (`ALTER TABLE ... ENABLE ROW LEVEL SECURITY`)\n'+
'2. Policies defined for SELECT/INSERT/UPDATE/DELETE\n'+
'3. Consistent `auth.uid() = user_id` pattern\n'+
'4. `service_role` key used server-side only\n'+
'5. `anon` key permissions minimized\n\n'+
'Check Database settings → Row Level Security and propose specific CREATE POLICY statements for any gaps.'
);
}

if(backend.includes('Firebase')){
prompts.push(G?
'Firestore Security Rulesの網羅性を監査してください。\n\n'+
'**監査対象コレクション:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**チェックポイント:**\n'+
'1. 全コレクションでルール定義 (デフォルト拒否)\n'+
'2. `request.auth.uid == resource.data.userId` パターンの一貫適用\n'+
'3. カスタムクレームによるロールベースアクセス制御\n'+
'4. サブコレクションへのルール継承\n'+
'5. Admin SDKの使用が最小限\n\n'+
'firestore.rules ファイルを生成し、不足があれば具体的なルール定義を提案してください。'
:
'Audit Firestore Security Rules coverage.\n\n'+
'**Target Collections:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**Checkpoints:**\n'+
'1. Rules defined for all collections (default deny)\n'+
'2. Consistent `request.auth.uid == resource.data.userId` pattern\n'+
'3. Role-based access control with custom claims\n'+
'4. Rule inheritance for subcollections\n'+
'5. Admin SDK usage minimized\n\n'+
'Generate firestore.rules file and propose specific rule definitions for any gaps.'
);
}

// Add compliance-specific prompts (conditional)
const compFrameworks=[];
Object.keys(COMPLIANCE_DB).forEach(key=>{
if(COMPLIANCE_DB[key].domains.includes(domain)) compFrameworks.push(COMPLIANCE_DB[key]);
});
if(compFrameworks.length>0){
const fwNames=compFrameworks.map(c=>c.name).join(', ');
prompts.push(G?
'コンプライアンス監査: '+fwNames+'\n\n'+
'このプロジェクトのドメイン ('+domain+') では以下のコンプライアンスフレームワークが該当します。\n\n'+
'docs/45_compliance_matrix.md を参照し、各フレームワークの必須要件がコードに実装されているか検証してください。\n\n'+
'**検証方法:**\n'+
'1. docs/45_compliance_matrix.md の要件チェックリストを確認\n'+
'2. 各要件IDに対応する実装箇所をコードから特定\n'+
'3. 未実装または不十分な要件をリストアップ\n'+
'4. 各要件の実装コード例を提示\n\n'+
'出力形式: Markdown表 (要件ID | 要件名 | 実装状況 | 不足事項 | 対策コード)'
:
'Compliance Audit: '+fwNames+'\n\n'+
'The following compliance frameworks apply to this project\'s domain ('+domain+').\n\n'+
'Reference docs/45_compliance_matrix.md and verify that each framework\'s mandatory requirements are implemented in the code.\n\n'+
'**Verification Method:**\n'+
'1. Review requirement checklist in docs/45_compliance_matrix.md\n'+
'2. Identify implementation locations in code for each requirement ID\n'+
'3. List unimplemented or insufficient requirements\n'+
'4. Provide implementation code examples for each requirement\n\n'+
'Output format: Markdown table (Req ID | Requirement | Status | Gaps | Fix Code)'
);
}

prompts.forEach((p,i)=>{
doc46+='### '+(G?'プロンプト':'Prompt')+' '+(i+1)+'\n\n';
doc46+='```\n'+p+'\n```\n\n';
});
doc46+='## '+(G?'5. Agent Security (when ai_auto ≠ None)':'5. Agent Security (when ai_auto ≠ None)')+'\n\n';
if(hasAI){
doc46+=(G?'### Human-in-the-Loop (HITL) ゲートパターン\n\n':'### Human-in-the-Loop (HITL) Gate Pattern\n\n');
doc46+=(G?'**不可逆操作の一覧:**\n\n':'**Irreversible Operations:**\n\n');
doc46+='- '+(G?'本番デプロイ':'Production deployment')+'\n';
doc46+='- '+(G?'データベース削除・マイグレーション':'Database deletion/migration')+'\n';
doc46+='- '+(G?'外部API課金操作':'External API billing operations')+'\n';
doc46+='- '+(G?'本番シークレット変更':'Production secret changes')+'\n';
doc46+='- Git force push / branch削除\n\n';
doc46+='```mermaid\n';
doc46+='flowchart TD\n';
doc46+='  A[Agent Action Request] --> B{Reversible?}\n';
doc46+='  B -->|Yes| C[Execute]\n';
doc46+='  B -->|No| D[HITL Gate]\n';
doc46+='  D --> E{Human Approval?}\n';
doc46+='  E -->|Yes| C\n';
doc46+='  E -->|No| F[Abort]\n';
doc46+='```\n\n';
doc46+=(G?'### サンドボックス設定\n\n':'### Sandbox Configuration\n\n');
doc46+=_chk('Docker/gVisor隔離環境でAgent実行','Run agents in Docker/gVisor isolation')+'\n';
doc46+=_chk('ネットワークホワイトリスト設定','Configure network whitelist')+'\n';
doc46+=_chk('最小権限APIキー使用','Use least-privilege API keys')+'\n';
doc46+=_chk('ファイルシステムアクセス制限','Restrict filesystem access')+'\n\n';
doc46+=(G?'### 間接プロンプトインジェクション防御\n\n':'### Indirect Prompt Injection Defense\n\n');
doc46+=(G?
'外部コンテンツ(Web、PDF、ユーザー投稿)をAIに処理させる際、悪意のある指示が埋め込まれている可能性があります。\n\n'+
'**対策:**\n\n'
:
'When processing external content (Web, PDF, user submissions), malicious instructions may be embedded.\n\n'+
'**Mitigations:**\n\n'
);
doc46+=_chk('外部コンテンツとシステムプロンプトを明確に分離','Clearly separate external content from system prompts')+'\n';
doc46+=_chk('コンテンツ取得時にメタデータ検証','Validate metadata when fetching content')+'\n';
doc46+=_chk('出力の検証・サニタイゼーション','Validate and sanitize outputs')+'\n';
doc46+=_chk('ユーザー入力にプレフィックス付与 (例: "User input: ...")','Prefix user input (e.g., "User input: ...")')+'\n\n';
}else{
doc46+=(G?'> ai_auto=noneのため、このセクションはスキップされます。\n\n':'> ai_auto=none, this section is skipped.\n\n');
}

doc46+='## '+(G?'6. Privacy Mode & Data Protection':'6. Privacy Mode & Data Protection')+'\n\n';
doc46+=(G?'### AI開発ツールのプライバシーモード設定\n\n':'### AI Development Tool Privacy Mode\n\n');
doc46+='- **GitHub Copilot:** Settings → Suggestions matching public code: Block\n';
doc46+='- **Cursor:** Settings → Privacy Mode: Enabled\n';
doc46+='- **Cline:** Privacy settings確認\n\n';
doc46+=_chk('コード学習データ除外設定を有効化','Enable code training data exclusion')+'\n';
doc46+=_chk('機密リポジトリでAI機能を無効化検討','Consider disabling AI features for sensitive repos')+'\n';
doc46+=_chk('.aiignoreファイルで機密ファイル除外','Exclude sensitive files with .aiignore')+'\n\n';
doc46+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc46+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc46+='- [Security Testing](./47_security_testing.md)\n';
doc46+='- [AI Dev Runbook](./40_ai_dev_runbook.md)\n';
if(hasAI){
doc46+='- [Skills Catalog](../skills/catalog.md)\n';
}

S.files['docs/46_ai_security.md']=doc46;
// ═══ DOC 47: Security Testing Templates ═══
let doc47='';
doc47+='# '+(G?'セキュリティテストテンプレート集':'Security Test Templates')+'\n\n';
doc47+='> '+(G?'実行可能なセキュリティテストコード':'Executable security test code')+'\n\n';
// RLS Tests (Supabase only)
if(backend.includes('Supabase')&&entities.length>0){
doc47+='## '+(G?'1. RLS Policy Tests (pgTAP)':'1. RLS Policy Tests (pgTAP)')+'\n\n';
doc47+=(G?'Supabaseのpostgresデータベースで直接実行するテストです。\n\n':'Tests to run directly on Supabase postgres database.\n\n');
entities.slice(0,3).forEach(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const hasUser=cols.some(c=>c.col==='user_id'||c.col.includes('user_id'));
if(!hasUser)return;
const tbl=pluralize(ent).toLowerCase();
doc47+='### '+ent+' RLS Test\n\n';
doc47+='```sql\n';
doc47+='BEGIN;\n';
doc47+='SELECT plan(3);\n\n';
doc47+='-- Setup: Insert test data as user-123\n';
doc47+='SET LOCAL ROLE authenticated;\n';
doc47+='SET LOCAL "request.jwt.claim.sub" TO \'user-123\';\n';
doc47+='INSERT INTO '+tbl+' (user_id, ...) VALUES (\'user-123\', ...);\n\n';
doc47+='-- Test 1: User sees own '+ent+'\n';
doc47+='SELECT results_eq(\n';
doc47+='  \'SELECT count(*)::int FROM '+tbl+' WHERE user_id = \'\'user-123\'\'\',\n';
doc47+='  ARRAY[1],\n';
doc47+='  \'User sees own '+ent+'\'\n';
doc47+=');\n\n';
doc47+='-- Test 2: User cannot see other user\'s '+ent+'\n';
doc47+='SELECT is_empty(\n';
doc47+='  \'SELECT * FROM '+tbl+' WHERE user_id = \'\'user-456\'\'\',\n';
doc47+='  \'User cannot see other user\\\'s '+ent+'\'\n';
doc47+=');\n\n';
doc47+='-- Test 3: Anon cannot insert\n';
doc47+='SET LOCAL ROLE anon;\n';
doc47+='SELECT throws_ok(\n';
doc47+='  \'INSERT INTO '+tbl+' (user_id, ...) VALUES (\'\'user-123\'\', ...)\',\n';
doc47+='  \'Anon cannot insert '+ent+'\'\n';
doc47+=');\n\n';
doc47+='ROLLBACK;\n';
doc47+='```\n\n';
});
}

// Input Validation Schemas (Next.js/Zod)
if(frontend.includes('Next.js')&&entities.length>0){
doc47+='## '+(G?'2. Input Validation Schemas (Zod)':'2. Input Validation Schemas (Zod)')+'\n\n';
entities.slice(0,3).forEach(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
doc47+='### '+ent+' Schema\n\n';
doc47+='```typescript\n';
doc47+='import { z } from \'zod\';\n\n';
doc47+='export const '+ent.toLowerCase()+'Schema = z.object({\n';
cols.slice(0,5).forEach(c=>{
const name=c.col;
const type=c.type||'VARCHAR';
const constraints=c.constraint||'';
if(name.includes('_id'))return; // Skip IDs

let zodType='z.string()';
if(type.includes('INT'))zodType='z.number().int()';
else if(type.includes('BOOL'))zodType='z.boolean()';
else if(type.includes('TEXT'))zodType='z.string()';
else if(type.includes('VARCHAR')){
const maxMatch=type.match(/VARCHAR\((\d+)\)/);
if(maxMatch)zodType='z.string().max('+maxMatch[1]+')';
}

if(constraints.includes('NOT NULL'))zodType+='.min(1)';
doc47+='  '+name+': '+zodType+',\n';
});
doc47+='});\n\n';
doc47+='export type '+ent+' = z.infer<typeof '+ent.toLowerCase()+'Schema>;\n';
doc47+='```\n\n';
});
}

// API Security Tests
doc47+='## '+(G?'3. API セキュリティテスト':'3. API Security Tests')+'\n\n';
doc47+=(G?'### 認証バイパステスト\n\n':'### Auth Bypass Test\n\n');
doc47+='```javascript\n';
doc47+='// Using Jest + Supertest\n';
doc47+='test(\'should reject unauthenticated requests\', async () => {\n';
doc47+='  const res = await request(app)\n';
doc47+='    .get(\'/api/protected\')\n';
doc47+='    .expect(401);\n';
doc47+='  expect(res.body.error).toMatch(/unauthorized/i);\n';
doc47+='});\n';
doc47+='```\n\n';
doc47+=(G?'### IDORテスト\n\n':'### IDOR Test\n\n');
doc47+='```javascript\n';
doc47+='test(\'should prevent IDOR attacks\', async () => {\n';
doc47+='  const user1Token = await getTokenForUser(\'user-1\');\n';
doc47+='  const user2Token = await getTokenForUser(\'user-2\');\n\n';
doc47+='  // User 2 tries to access User 1\'s resource\n';
doc47+='  const res = await request(app)\n';
doc47+='    .get(\'/api/posts/user-1-post-id\')\n';
doc47+='    .set(\'Authorization\', `Bearer ${user2Token}`)\n';
doc47+='    .expect(403);\n';
doc47+='});\n';
doc47+='```\n\n';
doc47+=(G?'### Rate Limitingテスト\n\n':'### Rate Limiting Test\n\n');
doc47+='```javascript\n';
doc47+='test(\'should enforce rate limits\', async () => {\n';
doc47+='  const requests = Array(101).fill(null).map(() =>\n';
doc47+='    request(app).get(\'/api/public\')\n';
doc47+='  );\n';
doc47+='  const results = await Promise.all(requests);\n';
doc47+='  const rateLimited = results.filter(r => r.status === 429);\n';
doc47+='  expect(rateLimited.length).toBeGreaterThan(0);\n';
doc47+='});\n';
doc47+='```\n\n';
// OWASP ZAP
doc47+='## '+(G?'4. OWASP ZAP Configuration':'4. OWASP ZAP Configuration')+'\n\n';
doc47+='```yaml\n';
doc47+='# .github/workflows/zap-scan.yml\n';
doc47+='name: OWASP ZAP Scan\n';
doc47+='on: [pull_request]\n\n';
doc47+='jobs:\n';
doc47+='  zap_scan:\n';
doc47+='    runs-on: ubuntu-latest\n';
doc47+='    steps:\n';
doc47+='      - uses: actions/checkout@v4\n';
doc47+='      - name: ZAP Scan\n';
doc47+='        uses: zaproxy/action-baseline@v0.7.0\n';
doc47+='        with:\n';
doc47+='          target: \'https://your-preview-url.vercel.app\'\n';
doc47+='          rules_file_name: \'.zap/rules.tsv\'\n';
doc47+='          cmd_options: \'-a\'\n';
doc47+='```\n\n';
// Penetration Testing Checklist
doc47+='## '+(G?'5. ペネトレーションテストチェックリスト':'5. Penetration Testing Checklist')+'\n\n';
doc47+=(G?'### 事前準備\n\n':'### Pre-Test Preparation\n\n');
doc47+=_chk('テスト環境準備 (本番データ使用禁止)','Prepare test environment (no production data)')+'\n';
doc47+=_chk('テストスコープ定義','Define test scope')+'\n';
doc47+=_chk('関係者への通知','Notify stakeholders')+'\n\n';
doc47+=(G?'### テスト実施項目\n\n':'### Test Execution Items\n\n');
doc47+='#### Authentication & Session\n';
doc47+=_chk('Brute force攻撃耐性','Brute force resistance')+'\n';
doc47+=_chk('パスワードリセット脆弱性','Password reset vulnerabilities')+'\n';
doc47+=_chk('セッション固定攻撃','Session fixation')+'\n';
doc47+=_chk('Remember me機能の安全性','Remember me security')+'\n\n';
doc47+='#### Input Validation\n';
doc47+=_chk('SQLインジェクション','SQL injection')+'\n';
doc47+=_chk('XSS (Reflected/Stored/DOM-based)','XSS (Reflected/Stored/DOM-based)')+'\n';
doc47+=_chk('コマンドインジェクション','Command injection')+'\n';
doc47+=_chk('パストラバーサル','Path traversal')+'\n\n';
doc47+='#### API Security\n';
doc47+=_chk('認証・認可バイパス','Auth/authz bypass')+'\n';
doc47+=_chk('IDOR (Insecure Direct Object Reference)','IDOR')+'\n';
doc47+=_chk('Mass Assignment','Mass Assignment')+'\n';
doc47+=_chk('Rate Limiting','Rate Limiting')+'\n\n';
doc47+='#### File Upload\n';
doc47+=_chk('悪意のあるファイルアップロード','Malicious file upload')+'\n';
doc47+=_chk('ファイル拡張子検証','File extension validation')+'\n';
doc47+=_chk('ファイルサイズ制限','File size limits')+'\n\n';
doc47+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc47+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc47+='- [Threat Model](./44_threat_model.md)\n';
doc47+='- [Test Strategy](./36_test_strategy.md)\n';
doc47+='- [QA Strategy](./28_qa_strategy.md)\n';
S.files['docs/47_security_testing.md']=doc47;
}


// Strategic Intelligence helper (10 args → 10 bilingual properties)
const _si = (reg_ja,reg_en, arch_ja,arch_en, fail_ja,fail_en, trend_ja,trend_en, bm_ja,bm_en) => ({
reg_ja, reg_en,      // 業種別規制・コンプライアンス (string[], 3-4 items)
arch_ja, arch_en,    // アーキテクチャパターン (string[], 2-3 items)
fail_ja, fail_en,    // 失敗要因 (string[], 3 items)
trend_ja, trend_en,  // 2026-2030トレンド (string[], 3-4 items)
bm_ja, bm_en         // ビジネスモデル (string[], 2-3 items, format: "model|revenue|target")
});
// Industry Intelligence Database (32 domains + default)
const INDUSTRY_INTEL = {
education: _si(
['FERPA準拠(学生記録保護)','COPPA準拠(13歳未満ユーザー)','アクセシビリティ(WCAG 2.1 AA以上)'],
['FERPA compliance (student record protection)','COPPA compliance (users under 13)','Accessibility (WCAG 2.1 AA minimum)'],
['適応学習システム(AI活用)','マイクロラーニング設計','xAPI/SCORM標準対応'],
['Adaptive learning (AI-powered)','Microlearning architecture','xAPI/SCORM standards compliance'],
['進捗追跡の不備→離脱率増加','動画配信コスト過小見積もり','証明書偽造防止不足'],
['Poor progress tracking → high dropout','Video streaming cost underestimation','Insufficient certificate anti-fraud measures'],
['生成AI統合(パーソナライズ学習)','VR/AR実習コンテンツ','ブロックチェーン証明書'],
['Generative AI integration (personalized learning)','VR/AR practical training','Blockchain certificates'],
['サブスク|月額課金|個人・企業研修','マーケットプレイス|手数料15-30%|講師・受講者','フリーミアム|プレミアム機能課金|個人学習者'],
['Subscription|Monthly fee|Individuals & corporate training','Marketplace|15-30% commission|Instructors & learners','Freemium|Premium features|Individual learners']
),
ec: _si(
['PCI DSS 4.0.1(カード情報)','景品表示法(誇大広告規制)','特定商取引法(返品・キャンセルポリシー)'],
['PCI DSS 4.0.1 (card data)','Consumer protection laws','Refund & cancellation policy compliance'],
['ヘッドレスコマース(Shopify Storefront API)','在庫最適化(需要予測AI)','Jamstack構成(Next.js + Stripe)'],
['Headless commerce (Shopify Storefront API)','Inventory optimization (demand forecasting AI)','Jamstack architecture (Next.js + Stripe)'],
['カゴ落ち率70%超え(決済UX不備)','在庫切れ表示遅延→信用失墜','SEO対策不足→集客失敗'],
['Cart abandonment >70% (poor checkout UX)','Stock-out display delay → loss of trust','Insufficient SEO → customer acquisition failure'],
['ライブコマース統合','音声検索対応','AR試着機能','サステナビリティ表示(CO2排出量)'],
['Live commerce integration','Voice search optimization','AR try-on features','Sustainability labels (CO2 emissions)'],
['直販|商品販売|消費者','マーケットプレイス|手数料10-20%|出品者・購入者','D2C|定期購入|ブランドファン'],
['Direct sales|Product revenue|Consumers','Marketplace|10-20% commission|Sellers & buyers','D2C|Subscription box|Brand fans']
),
marketplace: _si(
['エスクロー決済必須(消費者保護)','出品者KYC(本人確認)','レビュー操作防止'],
['Escrow payment (consumer protection)','Seller KYC verification','Review manipulation prevention'],
['二面市場設計(supply/demand balance)','レビュー・評価システム(信頼構築)','検索ランキングアルゴリズム'],
['Two-sided marketplace design (supply/demand balance)','Review & rating system (trust building)','Search ranking algorithm'],
['供給側不足→品質低下悪循環','手数料高すぎ→競合流出','不正出品者排除遅延'],
['Supply shortage → quality decline spiral','Excessive fees → seller churn','Delayed fraud seller removal'],
['ギグエコノミー拡大','Stripe Connect進化(即時決済)','AIマッチング精度向上'],
['Gig economy expansion','Stripe Connect evolution (instant payouts)','AI-powered matching accuracy'],
['手数料|取引額の15-25%|出品者・購入者','広告収益|スポンサー枠|出品者','サブスク|プレミアム機能|パワーセラー'],
['Commission|15-25% of transaction|Sellers & buyers','Advertising|Sponsored listings|Sellers','Subscription|Premium features|Power sellers']
),
community: _si(
['GDPR準拠(ユーザーデータ保護)','コンテンツモデレーション(違法コンテンツ対策)','未成年保護(年齢確認)'],
['GDPR compliance (user data protection)','Content moderation (illegal content removal)','Minor protection (age verification)'],
['WebSocket/SSE(リアルタイム通信)','スレッド型ディスカッション設計','ユーザーレピュテーションシステム'],
['WebSocket/SSE (real-time communication)','Threaded discussion architecture','User reputation system'],
['スパム・荒らし対策不足→品質低下','モデレーション負荷過多','エンゲージメント低下→過疎化'],
['Insufficient spam prevention → quality degradation','Moderation overload','Low engagement → ghost town effect'],
['AI自動モデレーション','分散型SNS(ActivityPub)','音声・動画コミュニティ拡大'],
['AI-powered auto-moderation','Decentralized social (ActivityPub)','Voice & video community expansion'],
['広告|インプレッション課金|企業広告主','プレミアム会員|月額・年額|コアユーザー','投げ銭|手数料10%|クリエイター'],
['Advertising|CPM/CPC|Corporate advertisers','Premium membership|Monthly/annual|Core users','Tipping|10% fee|Creators']
),
content: _si(
['著作権管理(DMCA対応)','アクセシビリティ(字幕・音声説明)','広告表示規制'],
['Copyright management (DMCA compliance)','Accessibility (captions & audio description)','Advertising regulations'],
['ヘッドレスCMS(Strapi/Contentful)','CDN配信最適化(画像WebP化)','検索エンジン最適化(構造化データ)'],
['Headless CMS (Strapi/Contentful)','CDN optimization (WebP images)','SEO (structured data)'],
['コンテンツ重複(SEOペナルティ)','画像最適化不足→読込遅延','更新頻度低下→検索順位下落'],
['Content duplication (SEO penalty)','Insufficient image optimization → slow loading','Low update frequency → ranking drop'],
['生成AI記事作成支援','動画要約AI','パーソナライズドコンテンツ配信'],
['Generative AI writing assistance','Video summarization AI','Personalized content delivery'],
['広告|PV・広告枠|読者','サブスク|有料記事・会員限定|コアファン','アフィリエイト|成果報酬|読者→購入'],
['Advertising|PV & ad slots|Readers','Subscription|Paywalled articles|Core fans','Affiliate|Performance fee|Reader purchases']
),
analytics: _si(
['データローカリティ(GDPR/CCPA)','匿名化処理(個人特定防止)','監査ログ保存'],
['Data locality (GDPR/CCPA)','Anonymization (PII removal)','Audit log retention'],
['リアルタイムストリーム処理(Apache Kafka/Flink)','列指向DB(ClickHouse/BigQuery)','埋め込み分析SDK'],
['Real-time stream processing (Kafka/Flink)','Columnar DB (ClickHouse/BigQuery)','Embedded analytics SDK'],
['データパイプライン障害→分析停止','可視化複雑すぎ→ユーザー混乱','コスト爆発(クエリ最適化不足)'],
['Data pipeline failure → analysis halt','Overly complex dashboards → user confusion','Cost explosion (poor query optimization)'],
['自然言語クエリ(生成AI)','予測分析精度向上(ML)','リアルタイム異常検知'],
['Natural language queries (generative AI)','Predictive analytics accuracy (ML)','Real-time anomaly detection'],
['SaaS|ユーザー数・データ量課金|企業分析チーム','埋め込み|導入企業課金|SaaS提供者','コンサル|導入・カスタマイズ支援|エンタープライズ'],
['SaaS|Users & data volume|Enterprise analytics teams','Embedded|Per-deployment|SaaS providers','Consulting|Implementation & customization|Enterprise']
),
booking: _si(
['個人情報保護(予約者情報)','キャンセルポリシー明示','決済代行業者登録(必要に応じ)'],
['Personal data protection (reservation info)','Clear cancellation policy','Payment facilitator registration (if applicable)'],
['カレンダー同期(Google/Outlook)','タイムゾーン自動変換','空き枠リアルタイム更新'],
['Calendar sync (Google/Outlook)','Automatic timezone conversion','Real-time availability updates'],
['ダブルブッキング発生(排他制御不足)','キャンセル処理遅延→返金トラブル','リマインド通知漏れ→ノーショー増加'],
['Double booking (insufficient locking)','Delayed cancellation → refund issues','Missed reminders → no-show increase'],
['AIスケジュール最適化','動的価格設定(需要予測)','ビデオ会議統合(Zoom/Teams)'],
['AI schedule optimization','Dynamic pricing (demand forecasting)','Video conferencing integration (Zoom/Teams)'],
['手数料|予約額の10-15%|サービス提供者・顧客','SaaS|月額固定・予約数課金|店舗・施設','フリーミアム|基本無料・上位機能課金|個人事業主'],
['Commission|10-15% of booking|Service providers & customers','SaaS|Monthly fee + per-booking|Stores & facilities','Freemium|Basic free + premium features|Solopreneurs']
),
saas: _si(
['SOC 2 Type II認証','GDPR/CCPA準拠','SLA保証(稼働率99.9%以上)'],
['SOC 2 Type II certification','GDPR/CCPA compliance','SLA guarantee (99.9%+ uptime)'],
['マルチテナント設計(tenant isolation)','API-first設計(拡張性)','使用量ベース課金システム'],
['Multi-tenant architecture (tenant isolation)','API-first design (extensibility)','Usage-based billing system'],
['チャーン率高い(オンボーディング不足)','スケーラビリティ不足→障害頻発','セキュリティ事故→信用失墜'],
['High churn (poor onboarding)','Scalability issues → frequent outages','Security breach → trust collapse'],
['PLG(Product-Led Growth)戦略','AI Copilot機能標準化','Vertical SaaS台頭'],
['PLG (Product-Led Growth) strategy','AI Copilot features standardization','Vertical SaaS rise'],
['サブスク|月額・年額・ユーザー数課金|企業・チーム','フリーミアム|基本無料・上位機能課金|個人・中小企業','使用量課金|API呼び出し・ストレージ従量|開発者'],
['Subscription|Monthly/annual/per-user|Enterprises & teams','Freemium|Basic free + premium|Individuals & SMBs','Usage-based|API calls & storage|Developers']
),
portfolio: _si(
['著作権表示(作品保護)','プライバシーポリシー(問い合わせフォーム)','アクセシビリティ(WCAG準拠)'],
['Copyright notice (work protection)','Privacy policy (contact forms)','Accessibility (WCAG compliance)'],
['静的サイト生成(Next.js/Astro)','CMS統合(Notion/Contentful)','高速CDN配信(Vercel/Cloudflare)'],
['Static site generation (Next.js/Astro)','CMS integration (Notion/Contentful)','Fast CDN delivery (Vercel/Cloudflare)'],
['読込速度遅い(画像最適化不足)','更新頻度低い→陳腐化','SEO対策不足→発見されない'],
['Slow loading (insufficient image optimization)','Low update frequency → outdated','Insufficient SEO → not discoverable'],
['Bento Grid UIトレンド','3Dインタラクション(Three.js)','ダークモードデフォルト'],
['Bento Grid UI trend','3D interactions (Three.js)','Dark mode by default'],
['直接受注|プロジェクト単価|クライアント企業','コンテンツ販売|有料note・教材|個人学習者','コンサル|時間単価|企業・個人'],
['Direct orders|Project fee|Client companies','Content sales|Paid articles & courses|Individual learners','Consulting|Hourly rate|Companies & individuals']
),
tool: _si(
['GDPR準拠(ユーザーデータ)','APIキー管理(セキュリティ)','利用規約明示'],
['GDPR compliance (user data)','API key management (security)','Clear terms of service'],
['PWA対応(オフライン動作)','クライアントサイド処理優先(プライバシー)','拡張機能提供(Browser Extension)'],
['PWA support (offline functionality)','Client-side processing (privacy)','Browser extension availability'],
['複雑すぎて使われない','ブラウザ依存機能(互換性問題)','競合ツールに埋もれる'],
['Too complex to use','Browser-dependent features (compatibility issues)','Lost in competitive landscape'],
['ローカルファーストツール','WebAssembly活用(高速化)','プライバシー重視設計'],
['Local-first tools','WebAssembly adoption (performance)','Privacy-focused design'],
['フリーミアム|基本無料・上位機能課金|個人・開発者','買い切り|一括購入|プロユーザー','オープンソース|寄付・スポンサー|コミュニティ'],
['Freemium|Basic free + premium|Individuals & developers','One-time purchase|Upfront payment|Pro users','Open source|Donations & sponsors|Community']
),
iot: _si(
['データプライバシー(センサーデータ)','セキュリティ認証(デバイス接続)','電波法準拠(無線デバイス)'],
['Data privacy (sensor data)','Security certification (device connection)','Radio law compliance (wireless devices)'],
['MQTT/CoAP(軽量プロトコル)','時系列DB(InfluxDB/TimescaleDB)','エッジコンピューティング(遅延削減)'],
['MQTT/CoAP (lightweight protocols)','Time-series DB (InfluxDB/TimescaleDB)','Edge computing (latency reduction)'],
['デバイスファームウェア脆弱性','通信途絶時のデータロスト','スケーラビリティ不足(デバイス急増時)'],
['Device firmware vulnerabilities','Data loss during communication outages','Scalability issues (rapid device growth)'],
['5G活用(低遅延通信)','AIエッジ推論(リアルタイム処理)','デジタルツイン統合'],
['5G utilization (low-latency communication)','AI edge inference (real-time processing)','Digital twin integration'],
['SaaS|デバイス数・データ量課金|企業IoT管理','ハードウェア販売|デバイス販売・保守|製造業・施設','データ販売|分析データ提供|データ活用企業'],
['SaaS|Per-device & data volume|Enterprise IoT management','Hardware sales|Device sales & maintenance|Manufacturers & facilities','Data monetization|Analytics data|Data-driven companies']
),
realestate: _si(
['宅建業法準拠(物件情報正確性)','個人情報保護(内覧者情報)','電子契約法対応'],
['Real estate transaction law compliance','Personal data protection (viewing applicants)','Electronic contract law compliance'],
['地図統合(Google Maps API)','VRツアー(360度動画)','AI物件レコメンド'],
['Map integration (Google Maps API)','VR tours (360° video)','AI property recommendations'],
['物件情報更新遅延→トラブル','内覧スケジュール重複','契約書電子化対応遅れ'],
['Delayed property info updates → disputes','Double-booked viewings','Slow adoption of electronic contracts'],
['AIバーチャル内覧','ブロックチェーン登記','スマートコントラクト契約'],
['AI virtual viewings','Blockchain property registry','Smart contract agreements'],
['仲介手数料|物件価格の3-6%|売主・買主','広告収益|物件掲載料|不動産会社','SaaS|月額・物件数課金|不動産会社'],
['Brokerage fee|3-6% of property price|Sellers & buyers','Advertising|Listing fees|Real estate agencies','SaaS|Monthly + per-property|Real estate agencies']
),
legal: _si(
['弁護士法準拠(非弁行為禁止)','秘匿特権保護(クライアント情報)','電子契約法対応'],
['Attorney law compliance (unauthorized practice prohibition)','Attorney-client privilege protection','Electronic signature law compliance'],
['ドキュメント管理(バージョン管理)','検索精度(全文検索・タグ)','暗号化保存(機密文書)'],
['Document management (version control)','Search accuracy (full-text & tags)','Encrypted storage (confidential documents)'],
['検索機能貧弱→文書発見困難','バージョン管理不備→差分不明','アクセス制御不足→情報漏洩'],
['Poor search → document discovery difficulty','Inadequate version control → diff tracking issues','Insufficient access control → data leakage'],
['契約レビューAI(リスク検出)','自動契約書生成','eディスカバリー対応'],
['AI contract review (risk detection)','Automated contract generation','eDiscovery support'],
['SaaS|ユーザー数・ストレージ課金|法律事務所','コンサル|導入支援・カスタマイズ|大手事務所','テンプレート販売|契約書雛形販売|中小企業'],
['SaaS|Per-user & storage|Law firms','Consulting|Implementation & customization|Large firms','Template sales|Contract template sales|SMBs']
),
hr: _si(
['労働基準法準拠(勤怠管理)','個人情報保護(応募者情報)','差別禁止(公平採用)'],
['Labor standards law compliance','Personal data protection (applicant info)','Non-discrimination (fair hiring)'],
['ATS(応募者追跡システム)','評価管理(360度評価)','勤怠管理統合'],
['ATS (Applicant Tracking System)','Performance management (360° reviews)','Attendance management integration'],
['応募者体験悪い→優秀人材逃す','評価基準曖昧→不満増加','システム複雑→利用率低下'],
['Poor candidate experience → talent loss','Vague evaluation criteria → dissatisfaction','System complexity → low adoption'],
['AIスクリーニング(応募書類)','スキルベース採用拡大','リモートワーク管理統合'],
['AI screening (applications)','Skills-based hiring expansion','Remote work management integration'],
['SaaS|従業員数課金|企業人事部','採用代行|手数料・成功報酬|企業','評価コンサル|導入・運用支援|大手企業'],
['SaaS|Per-employee|Corporate HR departments','Recruitment agency|Fee & success fee|Companies','Evaluation consulting|Implementation & support|Large enterprises']
),
fintech: _si(
['金融商品取引法準拠','資金決済法(資金移動業)','マネーロンダリング対策(KYC/AML)'],
['Financial instruments law compliance','Payment services law','Anti-money laundering (KYC/AML)'],
['リアルタイム残高更新(イベントソーシング)','二要素認証必須(セキュリティ)','監査ログ(全取引記録)'],
['Real-time balance updates (event sourcing)','Mandatory 2FA (security)','Audit logs (all transactions)'],
['セキュリティ事故→信用失墜','規制対応遅延→サービス停止','UX複雑→離脱率高'],
['Security breach → trust collapse','Regulatory delay → service suspension','Complex UX → high churn'],
['埋め込み金融(Embedded Finance)','即時決済拡大(リアルタイムグロス決済)','CBDC(中央銀行デジタル通貨)対応'],
['Embedded finance','Instant payment expansion (real-time gross settlement)','CBDC (Central Bank Digital Currency) readiness'],
['手数料|送金・為替手数料|個人・企業','金利収益|預金・融資金利差|個人・企業','SaaS|API利用・取引量課金|フィンテック企業'],
['Transaction fees|Transfer & FX fees|Individuals & companies','Interest income|Deposit-loan spread|Individuals & companies','SaaS|API usage & transaction volume|Fintech companies']
),
health: _si(
['HIPAA準拠(米国・患者情報保護)','医療法準拠(日本)','電子カルテ標準規格(HL7 FHIR)'],
['HIPAA compliance (US patient data protection)','Medical law compliance','Electronic health records standard (HL7 FHIR)'],
['暗号化必須(保管・転送時)','アクセス制御厳格(最小権限)','監査ログ(全アクセス記録)'],
['Encryption required (at-rest & in-transit)','Strict access control (least privilege)','Audit logs (all access records)'],
['情報漏洩→巨額罰金','システム障害→診療停止','連携不備→データ分断'],
['Data breach → massive fines','System outage → treatment halt','Integration issues → data silos'],
['遠隔診療拡大(オンライン診療)','AIドクター支援(診断補助)','ウェアラブル統合(健康データ)'],
['Telemedicine expansion','AI doctor assistance (diagnosis support)','Wearable integration (health data)'],
['診療報酬|保険請求|患者・保険者','SaaS|月額・施設数課金|クリニック・病院','データ活用|匿名化データ販売|製薬・研究機関'],
['Medical fees|Insurance claims|Patients & insurers','SaaS|Monthly + per-facility|Clinics & hospitals','Data monetization|Anonymized data sales|Pharma & research']
),
ai: _si(
['AI倫理ガイドライン準拠','個人データ学習制限(GDPR)','生成物著作権明示'],
['AI ethics guidelines compliance','Personal data training restrictions (GDPR)','Generated content copyright disclosure'],
['プロンプト管理(バージョン管理)','RAG(Retrieval-Augmented Generation)','コンテキスト圧縮(トークン節約)'],
['Prompt management (version control)','RAG (Retrieval-Augmented Generation)','Context compression (token optimization)'],
['幻覚(Hallucination)→誤情報提供','コスト爆発(API呼び出し過多)','プロンプトインジェクション攻撃'],
['Hallucinations → misinformation','Cost explosion (excessive API calls)','Prompt injection attacks'],
['マルチモーダルAI(画像・動画・音声)','ローカルLLM活用(プライバシー)','AI Agent自律化'],
['Multimodal AI (image/video/audio)','Local LLM adoption (privacy)','Autonomous AI agents'],
['API課金|トークン・リクエスト従量|開発者・企業','SaaS|月額・ユーザー数課金|企業チーム','コンサル|導入・カスタマイズ支援|エンタープライズ'],
['API billing|Tokens & requests|Developers & companies','SaaS|Monthly + per-user|Enterprise teams','Consulting|Implementation & customization|Enterprise']
),
automation: _si(
['データプライバシー(自動処理データ)','API利用規約準拠(連携サービス)','監査ログ保存'],
['Data privacy (automated processing)','API terms compliance (integrated services)','Audit log retention'],
['ワークフロー設計(DAG管理)','エラーハンドリング(リトライ戦略)','WebHook受信(イベント駆動)'],
['Workflow design (DAG management)','Error handling (retry strategies)','WebHook reception (event-driven)'],
['ワークフロー複雑化→保守困難','エラー通知不足→障害気づかず','連携サービス変更→動作停止'],
['Workflow complexity → maintenance difficulty','Insufficient error notifications → undetected failures','Service API changes → workflow breakage'],
['AI Agentワークフロー','ノーコード自動化拡大','リアルタイムトリガー精度向上'],
['AI agent workflows','No-code automation expansion','Real-time trigger accuracy improvement'],
['SaaS|ワークフロー数・実行回数課金|企業・個人','フリーミアム|基本無料・上位機能課金|中小企業','コンサル|業務自動化設計支援|エンタープライズ'],
['SaaS|Workflows & executions|Companies & individuals','Freemium|Basic free + premium|SMBs','Consulting|Business automation design|Enterprise']
),
event: _si(
['個人情報保護(参加者情報)','チケット転売防止(規制準拠)','払い戻しポリシー明示'],
['Personal data protection (attendee info)','Ticket resale prevention (regulation compliance)','Clear refund policy'],
['チケット販売(Stripe決済)','QRコードチェックイン','参加者管理(バッジ印刷)'],
['Ticket sales (Stripe payment)','QR code check-in','Attendee management (badge printing)'],
['チケット偽造対策不足','当日混雑→チェックイン遅延','キャンセル処理トラブル'],
['Insufficient anti-counterfeit measures','Check-in delays on event day','Cancellation processing issues'],
['ハイブリッドイベント拡大(オンライン配信)','NFTチケット','AIネットワーキング支援'],
['Hybrid event expansion (online streaming)','NFT tickets','AI networking assistance'],
['チケット販売|手数料10-20%|主催者・参加者','スポンサー収益|広告・ブース販売|企業スポンサー','SaaS|月額・イベント数課金|イベント運営会社'],
['Ticket sales|10-20% commission|Organizers & attendees','Sponsor revenue|Ads & booth sales|Corporate sponsors','SaaS|Monthly + per-event|Event management companies']
),
gamify: _si(
['個人情報保護(ユーザー行動データ)','景品規制(高額報酬制限)','ギャンブル性回避'],
['Personal data protection (user behavior data)','Prize regulations (high-value reward limits)','Gambling avoidance'],
['ポイント管理(残高・履歴)','バッジシステム(達成トリガー)','リーダーボード(ランキング更新)'],
['Point management (balance & history)','Badge system (achievement triggers)','Leaderboard (ranking updates)'],
['報酬インフレ→モチベーション低下','不正獲得対策不足','ゲーミフィケーション設計失敗→飽きられる'],
['Reward inflation → motivation decline','Insufficient fraud prevention','Poor gamification design → user boredom'],
['NFTバッジ(ブロックチェーン)','AIパーソナライズチャレンジ','ソーシャルゲーミフィケーション'],
['NFT badges (blockchain)','AI personalized challenges','Social gamification'],
['広告|インプレッション課金|企業広告主','アプリ内課金|ポイント・アイテム購入|ユーザー','SaaS|月額・ユーザー数課金|企業導入'],
['Advertising|CPM/CPC|Corporate advertisers','In-app purchases|Points & items|Users','SaaS|Monthly + per-user|Enterprise adoption']
),
collab: _si(
['データプライバシー(共同編集データ)','GDPR準拠(ユーザーデータ)','アクセス制御(権限管理)'],
['Data privacy (collaborative data)','GDPR compliance (user data)','Access control (permission management)'],
['CRDT(衝突解決アルゴリズム)','WebSocket(リアルタイム同期)','バージョン履歴(変更追跡)'],
['CRDT (conflict resolution)','WebSocket (real-time sync)','Version history (change tracking)'],
['同期ラグ→編集衝突頻発','権限管理複雑→誤操作','オフライン対応不足→データロスト'],
['Sync lag → frequent edit conflicts','Complex permissions → user errors','Insufficient offline support → data loss'],
['AIコラボ支援(要約・提案)','音声・動画コラボ拡大','ブロックチェーン所有権証明'],
['AI collaboration assistance (summaries & suggestions)','Voice & video collaboration expansion','Blockchain ownership proof'],
['SaaS|月額・ユーザー数課金|企業・チーム','フリーミアム|基本無料・上位機能課金|個人・中小企業','エンタープライズ|カスタマイズ・専用環境|大手企業'],
['SaaS|Monthly + per-user|Companies & teams','Freemium|Basic free + premium|Individuals & SMBs','Enterprise|Customization & dedicated env|Large enterprises']
),
devtool: _si(
['APIキー管理(セキュリティ)','利用規約明示(レート制限・SLA)','オープンソースライセンス'],
['API key management (security)','Clear terms (rate limits & SLA)','Open source licensing'],
['APIファースト設計','SDK提供(多言語)','WebHook配信(イベント通知)'],
['API-first design','SDK provision (multi-language)','WebHook delivery (event notifications)'],
['ドキュメント不足→導入障壁','レート制限厳しすぎ→離脱','障害通知遅延→信頼低下'],
['Insufficient documentation → adoption barrier','Overly strict rate limits → churn','Delayed outage notifications → trust decline'],
['OpenAPI 3.1標準化','GraphQL採用拡大','開発者体験(DX)重視設計'],
['OpenAPI 3.1 standardization','GraphQL adoption expansion','Developer experience (DX) focused design'],
['API課金|リクエスト従量|開発者・企業','SaaS|月額・機能課金|企業','オープンソース|エンタープライズサポート有償|大手企業'],
['API billing|Per-request|Developers & companies','SaaS|Monthly + features|Companies','Open source|Paid enterprise support|Large enterprises']
),
creator: _si(
['著作権保護(コンテンツ)','決済代行業者登録(手数料収受)','税務対応(クリエイター収益)'],
['Copyright protection (content)','Payment facilitator registration (fee collection)','Tax compliance (creator revenue)'],
['サブスク管理(Stripe Billing)','投げ銭決済(少額決済)','コンテンツ配信(DRM保護)'],
['Subscription management (Stripe Billing)','Tipping payment (micro-transactions)','Content delivery (DRM protection)'],
['手数料高すぎ→クリエイター不満','コンテンツ海賊版対策不足','収益化ハードル高い→離脱'],
['Excessive fees → creator dissatisfaction','Insufficient piracy prevention','High monetization barrier → churn'],
['AI生成コンテンツ統合','NFTコンテンツ販売','ライブストリーミング収益化'],
['AI-generated content integration','NFT content sales','Live streaming monetization'],
['手数料|クリエイター収益の10-20%|クリエイター・ファン','サブスク|月額会員費|ファン','投げ銭|少額課金・手数料|ファン'],
['Commission|10-20% of creator revenue|Creators & fans','Subscription|Monthly membership|Fans','Tipping|Micro-transactions + fee|Fans']
),
newsletter: _si(
['GDPR準拠(購読者データ)','CAN-SPAM法準拠(米国・配信規制)','オプトイン必須(同意取得)'],
['GDPR compliance (subscriber data)','CAN-SPAM Act compliance (US anti-spam)','Opt-in required (consent acquisition)'],
['配信管理(SendGrid/Resend)','購読者セグメント(タグ付け)','A/Bテスト(件名・本文)'],
['Delivery management (SendGrid/Resend)','Subscriber segmentation (tagging)','A/B testing (subject & body)'],
['スパム判定→到達率低下','配信停止処理遅延→苦情','コンテンツ単調→開封率低下'],
['Spam flagging → low deliverability','Delayed unsubscribe → complaints','Monotonous content → low open rate'],
['AI記事生成支援','パーソナライズド配信(行動ベース)','音声ニュースレター'],
['AI article generation assistance','Personalized delivery (behavior-based)','Audio newsletters'],
['サブスク|有料ニュースレター月額|読者','広告|スポンサード記事|企業広告主','アフィリエイト|紹介手数料|読者→購入'],
['Subscription|Paid newsletter monthly|Readers','Advertising|Sponsored articles|Corporate advertisers','Affiliate|Referral commission|Reader purchases']
),
manufacturing: _si(
['ISO 9001品質','IEC 62443産業制御セキュリティ','製造物責任法(PL法)トレーサビリティ'],
['ISO 9001 quality management','IEC 62443 industrial control security','Product liability law traceability'],
['Digital Twin(工場シミュレーション)','Edge AI(予知保全)','OPC UA(設備連携標準)'],
['Digital Twin (factory simulation)','Edge AI (predictive maintenance)','OPC UA (equipment interoperability)'],
['予知保全未導入→突発停止','品質データ分断→原因追跡困難','OTセキュリティ脆弱性'],
['No predictive maintenance → sudden downtime','Quality data silos → root cause tracking difficulty','OT security vulnerabilities'],
['予知保全AI拡大','協働ロボット(cobot)統合','Scope1-3カーボン管理'],
['Predictive maintenance AI expansion','Collaborative robot (cobot) integration','Scope 1-3 carbon management'],
['ライセンス|工場・デバイス数課金|製造業','SaaS|月額・機能課金|製造業','SI|導入・カスタマイズ|大手製造業'],
['License|Per-factory/device|Manufacturers','SaaS|Monthly + features|Manufacturers','SI|Implementation & customization|Large manufacturers']
),
logistics: _si(
['貨物運送事業法','2024年問題(労働時間規制)','倉庫業法','関税法(NACCS連携)'],
['Freight carrier business law','2024 problem (driver hour limits)','Warehouse business law','Customs law (NACCS integration)'],
['ルート最適化(OR-Tools)','WMS(倉庫管理)','GPS+5G追跡','ブロックチェーン(トレーサビリティ)'],
['Route optimization (OR-Tools)','WMS (warehouse management)','GPS + 5G tracking','Blockchain traceability'],
['配送遅延→顧客不満','在庫不足・過剰→コスト増','ドライバー不足→需要対応困難'],
['Delivery delays → customer dissatisfaction','Stock shortage/excess → cost increase','Driver shortage → demand response difficulty'],
['自動配送ロボット・ドローン','ブロックチェーン透明化','AGV(無人搬送車)','リアルタイム需給マッチ'],
['Autonomous delivery robots/drones','Blockchain transparency','AGV (automated guided vehicles)','Real-time supply-demand matching'],
['SaaS|配送・在庫管理|物流企業','手数料|配送マッチング|荷主・配送業者','SI|導入・カスタマイズ|大手物流'],
['SaaS|Delivery & inventory mgmt|Logistics companies','Commission|Delivery matching|Shippers & carriers','SI|Implementation & customization|Large logistics']
),
agriculture: _si(
['農薬取締法','種苗法(品種保護)','GAP(農業生産工程管理)','ドローン規制(航空法)'],
['Agricultural chemicals control law','Plant variety protection law','GAP (Good Agricultural Practice)','Drone regulations (aviation law)'],
['LoRaWAN(センサー通信)','衛星画像分析(Sentinel-2)','AI病害虫診断','需給マッチングプラットフォーム'],
['LoRaWAN (sensor communication)','Satellite imagery analysis (Sentinel-2)','AI pest/disease diagnosis','Supply-demand matching platform'],
['センサー故障→データ欠損','天候依存リスク高い','IT習熟度低い→導入困難'],
['Sensor failures → data loss','High weather dependency risk','Low IT literacy → adoption difficulty'],
['精密農業(変量施肥)','ドローン散布','需給マッチング拡大','カーボンクレジット取引'],
['Precision agriculture (variable rate application)','Drone spraying','Supply-demand matching expansion','Carbon credit trading'],
['SaaS|センサー・データ分析|農家','ハードウェア販売|デバイス販売|農家','データ販売|気象・需給データ|JA・食品メーカー'],
['SaaS|Sensors & data analytics|Farmers','Hardware sales|Device sales|Farmers','Data monetization|Weather & supply data|Co-ops & food manufacturers']
),
energy: _si(
['電気事業法(保安・需給調整)','再エネ特措法(FIT/FIP)','省エネ法・温対法','GHGプロトコル(Scope1-3)'],
['Electricity business law (safety & supply-demand)','Renewable energy law (FIT/FIP)','Energy conservation & climate laws','GHG Protocol (Scope 1-3)'],
['DERMS(分散電源管理)','スマートメーター連携','発電予測AI(気象データ)','P2P電力取引プラットフォーム'],
['DERMS (distributed energy resource mgmt)','Smart meter integration','Generation forecasting AI (weather data)','P2P electricity trading platform'],
['系統不安定(再エネ変動)','蓄電池劣化管理不足','出力制御→収益減'],
['Grid instability (renewable fluctuations)','Insufficient battery degradation mgmt','Output curtailment → revenue loss'],
['P2P電力取引拡大','VPP(仮想発電所)','カーボンNFT','AI需要予測高度化'],
['P2P electricity trading expansion','VPP (virtual power plant)','Carbon NFT','Advanced AI demand forecasting'],
['SaaS|発電・需給管理|発電事業者','PPA(電力購入契約)|長期契約|企業','データ販売|需給・カーボンデータ|エネルギー企業'],
['SaaS|Generation & demand mgmt|Power producers','PPA (power purchase agreement)|Long-term contract|Corporations','Data monetization|Supply & carbon data|Energy companies']
),
media: _si(
['著作権法(権利処理・DRM)','放送法(番組基準)','青少年保護育成条例','景品表示法(ガチャ確率)'],
['Copyright law (rights & DRM)','Broadcasting law (program standards)','Youth protection ordinances','Prize labeling law (gacha rates)'],
['HLS/DASH/CMAF配信(低遅延)','DRM(Widevine/FairPlay)','AI生成コンテンツ補助','インタラクティブ配信'],
['HLS/DASH/CMAF streaming (low latency)','DRM (Widevine/FairPlay)','AI-generated content assistance','Interactive streaming'],
['海賊版対策不足','審査遅延→配信開始遅れ','配信コスト過大'],
['Insufficient anti-piracy measures','Review delays → delayed launch','Excessive streaming costs'],
['インタラクティブストリーミング','空間Computing(VR/AR)','AI制作支援拡大','UGC収益化'],
['Interactive streaming','Spatial computing (VR/AR)','AI production assistance expansion','UGC monetization'],
['サブスク|月額課金|視聴者','広告|インプレッション課金|企業広告主','ライセンス|コンテンツ販売|配信プラットフォーム'],
['Subscription|Monthly fee|Viewers','Advertising|CPM/CPC|Corporate advertisers','Licensing|Content sales|Streaming platforms']
),
government: _si(
['公的個人認証法(JPKI)','行政機関個人情報保護法','デジタル手続法(オンライン化原則)','ISMAP(政府調達基準)'],
['JPKI (public key infrastructure)','Administrative personal data protection law','Digital procedure law (online-first)','ISMAP (government procurement standards)'],
['Gov Cloud(AWS/Azure/GCP)','LGWAN接続','FIDO2(パスワードレス)','オープンデータプラットフォーム'],
['Gov Cloud (AWS/Azure/GCP)','LGWAN (government network) integration','FIDO2 (passwordless)','Open data platform'],
['レガシー移行失敗','アクセシビリティ不足(a11y)','セキュリティインシデント→信用失墜'],
['Legacy migration failure','Insufficient accessibility (a11y)','Security incidents → trust collapse'],
['オープンデータ拡大','AIチャットボット(行政手続き)','ブロックチェーン公証','マイナンバー連携拡大'],
['Open data expansion','AI chatbot (administrative procedures)','Blockchain notarization','My Number integration expansion'],
['受託|システム開発|政府機関','SaaS|Gov Cloud・行政サービス|地方自治体','保守|運用・サポート|政府機関'],
['Contract|System development|Government agencies','SaaS|Gov Cloud & admin services|Local governments','Maintenance|Operations & support|Government agencies']
),
travel: _si(
['旅行業法(登録・約款)','旅館業法・民泊新法','PCI DSS(予約決済)','GDPR(訪日客データ)'],
['Travel agency law (registration & terms)','Hotel business law & vacation rental law','PCI DSS (reservation payment)','GDPR (international visitor data)'],
['PMS統合(Oracle/Cloudbeds)','チャネルマネージャー(OTA在庫統合)','動的価格設定(需要予測AI)','多言語対応(DeepL API)'],
['PMS integration (Oracle/Cloudbeds)','Channel manager (OTA inventory integration)','Dynamic pricing (demand forecasting AI)','Multi-language support (DeepL API)'],
['OTA依存度高い→手数料負担','シーズン変動大きい→稼働率低下','口コミ管理不足→評価低下'],
['High OTA dependency → commission burden','Large seasonal fluctuations → low occupancy','Insufficient review mgmt → rating decline'],
['AIコンシェルジュ(24h対応)','VRプレビュー(予約前内見)','サステナブルツーリズム','非接触チェックイン拡大'],
['AI concierge (24h support)','VR preview (pre-booking tours)','Sustainable tourism','Contactless check-in expansion'],
['手数料|予約手数料10-20%|宿泊施設・OTA','SaaS|月額・施設数課金|宿泊施設','広告|スポンサー枠|観光施設'],
['Commission|10-20% booking fee|Accommodations & OTAs','SaaS|Monthly + per-facility|Accommodations','Advertising|Sponsored listings|Tourist facilities']
),
insurance: _si(
['保険業法(募集・引受・ソルベンシー)','保険法(告知義務)','IFRS 17(国際会計基準)','金融ADR(紛争解決)'],
['Insurance business law (solicitation/underwriting/solvency)','Insurance law (duty of disclosure)','IFRS 17 (accounting standards)','Financial ADR (dispute resolution)'],
['Guidewire/Duck Creek(基幹)','テレマティクス(運転スコア分析)','Wearable統合(健康保険)','パラメトリック保険(スマートコントラクト)'],
['Guidewire/Duck Creek (core systems)','Telematics (driving score analysis)','Wearable integration (health insurance)','Parametric insurance (smart contracts)'],
['引受プロセス遅延','不正請求検知不足','商品設計複雑→顧客理解困難'],
['Underwriting process delays','Insufficient fraud detection','Complex product design → customer confusion'],
['組み込み保険(Embedded)拡大','AIリスク評価高度化','オンデマンド保険(短期・細分化)','健康増進型保険'],
['Embedded insurance expansion','Advanced AI risk assessment','On-demand insurance (short-term/micro)','Wellness-linked insurance'],
['保険料|契約保険料|契約者','代理店手数料|販売手数料|代理店','SaaS|保険業務効率化|保険会社'],
['Premium|Contract premium|Policyholders','Agent commission|Sales commission|Agents','SaaS|Insurance operations efficiency|Insurance companies']
),
_default: _si(
['GDPR/CCPA準拠(一般データ保護)','利用規約・プライバシーポリシー必須','アクセシビリティ(WCAG 2.1)'],
['GDPR/CCPA compliance (general data protection)','Terms & privacy policy required','Accessibility (WCAG 2.1)'],
['3層アーキテクチャ(UI/API/DB)','認証・認可分離','RESTful API設計'],
['3-tier architecture (UI/API/DB)','Auth/authz separation','RESTful API design'],
['セキュリティ対策不足→情報漏洩','スケーラビリティ不足→障害','UX設計不備→離脱率高'],
['Insufficient security → data breach','Scalability issues → outages','Poor UX design → high churn'],
['AI統合加速','リアルタイム機能拡大','プライバシー重視設計'],
['Accelerated AI integration','Real-time feature expansion','Privacy-focused design'],
['SaaS|月額課金|企業・個人','フリーミアム|基本無料・上位機能課金|個人・中小企業','広告|インプレッション課金|企業広告主'],
['SaaS|Monthly fee|Companies & individuals','Freemium|Basic free + premium|Individuals & SMBs','Advertising|CPM/CPC|Corporate advertisers']
)
};
// Stakeholder Strategy Database (4 types)
const STAKEHOLDER_STRATEGY = {
startup: {
name_ja: 'スタートアップ',
name_en: 'Startup',
phases_ja: ['MVP構築(2-4週)','PMF検証(1-3ヶ月)','スケール準備(3-6ヶ月)','成長フェーズ(6ヶ月〜)'],
phases_en: ['MVP Build (2-4 weeks)','PMF Validation (1-3 months)','Scale Prep (3-6 months)','Growth Phase (6+ months)'],
tech_debt_ja: 'MVP期は技術的負債許容。PMF後にリファクタリング集中投資。スケール前に負債返済80%目標。',
tech_debt_en: 'Tolerate tech debt during MVP. Invest in refactoring post-PMF. Target 80% debt repayment before scaling.',
team_ja: 'フルスタック1-2名 → フロント/バック分離(3-5名) → 専門化(10名〜)',
team_en: 'Full-stack 1-2 → Front/Back split (3-5) → Specialization (10+)',
budget_ja: '開発70% / インフラ10% / マーケ15% / セキュリティ5%',
budget_en: 'Dev 70% / Infra 10% / Marketing 15% / Security 5%'
},
enterprise: {
name_ja: 'エンタープライズ',
name_en: 'Enterprise',
phases_ja: ['PoC実施(1-2ヶ月)','パイロット導入(3-6ヶ月)','段階的展開(6-12ヶ月)','最適化(継続)'],
phases_en: ['PoC (1-2 months)','Pilot Deployment (3-6 months)','Phased Rollout (6-12 months)','Optimization (ongoing)'],
tech_debt_ja: 'レガシー移行計画必須。Strangler Figパターン推奨。技術的負債管理をKPI化(SQALE Rating)。',
tech_debt_en: 'Legacy migration plan required. Strangler Fig pattern recommended. Manage tech debt as KPI (SQALE Rating).',
team_ja: 'アーキテクト主導 → 複数チーム(機能別) → Platform Engineering組織',
team_en: 'Architect-led → Multi-teams (feature-based) → Platform Engineering org',
budget_ja: '開発50% / インフラ20% / セキュリティ20% / コンプライアンス10%',
budget_en: 'Dev 50% / Infra 20% / Security 20% / Compliance 10%'
},
developer: {
name_ja: '開発者(個人・少人数)',
name_en: 'Developer (Solo/Small Team)',
phases_ja: ['週末プロジェクト(1-2週)','サイドプロジェクト(1-3ヶ月)','プロダクト化(3-6ヶ月)','運用・成長'],
phases_en: ['Weekend Project (1-2 weeks)','Side Project (1-3 months)','Productization (3-6 months)','Operations & Growth'],
tech_debt_ja: '初期はスピード優先。ユーザー獲得後にリファクタリング。自動化ツール積極活用。',
tech_debt_en: 'Prioritize speed initially. Refactor after user acquisition. Leverage automation tools.',
team_ja: 'ソロ → デュアル(フロント/バック分担) → 小規模チーム(3-5名)',
team_en: 'Solo → Duo (front/back split) → Small team (3-5)',
budget_ja: '開発80%(時間投資) / インフラ15% / マーケ5%(オーガニック重視)',
budget_en: 'Dev 80% (time investment) / Infra 15% / Marketing 5% (organic focus)'
},
team: {
name_ja: '標準チーム',
name_en: 'Standard Team',
phases_ja: ['Sprint 0(環境構築)','MVP開発(2-4週)','v1.0リリース(2-3ヶ月)','成長フェーズ'],
phases_en: ['Sprint 0 (Setup)','MVP Dev (2-4 weeks)','v1.0 Release (2-3 months)','Growth Phase'],
tech_debt_ja: '20%ルール適用(Sprint時間の20%を負債返済)。四半期ごとにリファクタリングSprint実施。',
tech_debt_en: '20% rule (dedicate 20% of sprint to debt repayment). Quarterly refactoring sprints.',
team_ja: 'クロスファンクショナルチーム(5-9名) → Two-Pizza Team原則',
team_en: 'Cross-functional team (5-9) → Two-Pizza Team principle',
budget_ja: '開発60% / インフラ15% / マーケ15% / セキュリティ10%',
budget_en: 'Dev 60% / Infra 15% / Marketing 15% / Security 10%'
}
};
// Operational Excellence Frameworks
const OPERATIONAL_FRAMEWORKS = {
tech_debt: {
title_ja: '技術的負債管理フレームワーク',
title_en: 'Technical Debt Management Framework',
quadrant_ja: ['意図的・戦略的(MVP速度優先)','意図的・戦術的(一時的回避)','非意図的・戦略的(設計誤認識)','非意図的・戦術的(スキル不足)'],
quadrant_en: ['Deliberate-Strategic (MVP speed)','Deliberate-Tactical (temporary workaround)','Inadvertent-Strategic (design misunderstanding)','Inadvertent-Tactical (skill gap)'],
sqale_ja: 'SQALE金額換算: 負債1時間 = エンジニア時給 × 1.5倍(遅延コスト込)',
sqale_en: 'SQALE monetization: 1hr debt = Engineer hourly rate × 1.5 (delay cost included)',
rule_ja: '20%ルール: Sprint時間の20%を負債返済に割り当て',
rule_en: '20% Rule: Dedicate 20% of sprint time to debt repayment'
},
dr_bcp: {
title_ja: '災害復旧・BCP',
title_en: 'Disaster Recovery & BCP',
rto_rpo_ja: 'RTO(Recovery Time Objective): 目標復旧時間 / RPO(Recovery Point Objective): 目標復旧時点',
rto_rpo_en: 'RTO (Recovery Time Objective) / RPO (Recovery Point Objective)',
tier_ja: ['Tier 1: RTO<1h, RPO<15min (Critical)','Tier 2: RTO<4h, RPO<1h (High)','Tier 3: RTO<24h, RPO<4h (Medium)'],
tier_en: ['Tier 1: RTO<1h, RPO<15min (Critical)','Tier 2: RTO<4h, RPO<1h (High)','Tier 3: RTO<24h, RPO<4h (Medium)'],
backup_ja: '3-2-1ルール: 3コピー・2種類メディア・1オフサイト',
backup_en: '3-2-1 Rule: 3 copies, 2 media types, 1 offsite',
incident_ja: '検知 → トリアージ → 対応 → 復旧 → 事後レビュー(Postmortem)',
incident_en: 'Detection → Triage → Response → Recovery → Postmortem'
},
green_it: {
title_ja: 'Green IT・カーボンニュートラル',
title_en: 'Green IT & Carbon Neutrality',
framework_ja: ['Serverless優先(アイドル時間削減)','CDN活用(ネットワーク排出削減)','画像最適化(WebP/AVIF)','不要リソース削除(Zombie resources)'],
framework_en: ['Serverless-first (reduce idle time)','CDN utilization (reduce network emissions)','Image optimization (WebP/AVIF)','Remove zombie resources'],
carbon_ja: 'Cloud Carbon Footprint計測(AWS/Azure/GCP)',
carbon_en: 'Cloud Carbon Footprint measurement (AWS/Azure/GCP)',
sla_ja: '再エネ100%データセンター選択(Google Cloud/AWS Graviton)',
sla_en: 'Choose 100% renewable energy data centers (Google Cloud/AWS Graviton)'
},
team_design: {
title_ja: 'チーム設計・Conway\'s Law対応',
title_en: 'Team Design & Conway\'s Law',
conway_ja: 'アーキテクチャと組織構造を一致させる(マイクロサービス → 機能別チーム)',
conway_en: 'Align architecture with org structure (Microservices → Feature teams)',
two_pizza_ja: 'Two-Pizza Team: 1チーム5-9名(ピザ2枚で足りる人数)',
two_pizza_en: 'Two-Pizza Team: 5-9 members per team',
dora_ja: 'DORA metrics計測(デプロイ頻度・変更リードタイム・MTTR・変更失敗率)',
dora_en: 'DORA metrics (Deployment frequency, Lead time, MTTR, Change failure rate)'
}
};
// Extended Operational Frameworks (4 new topics)
const OPERATIONAL_FRAMEWORKS_EXT = {
ai_ethics: {
title_ja: 'AI倫理・ガバナンス',
title_en: 'AI Ethics & Governance',
principles_ja: ['公平性(Fairness)','説明可能性(Explainability)','透明性(Transparency)','プライバシー','セキュリティ'],
principles_en: ['Fairness','Explainability','Transparency','Privacy','Security'],
impl_ja: 'Fairlearn/AIF360でバイアス検知、SHAP/LIMEで説明可能性、Human-in-the-loop(低信頼度時)',
impl_en: 'Bias detection (Fairlearn/AIF360), Explainability (SHAP/LIME), Human-in-the-loop (low confidence)',
compliance_ja: 'EU AI Act準拠、AIリスク分類(高/限定/最小/禁止)',
compliance_en: 'EU AI Act compliance, AI risk classification (High/Limited/Minimal/Prohibited)'
},
zero_trust: {
title_ja: 'ゼロトラストセキュリティ',
title_en: 'Zero Trust Security',
principles_ja: '境界防御撤廃、常に検証、最小特権、セグメンテーション、暗号化、監視',
principles_en: 'No perimeter, Always verify, Least privilege, Segmentation, Encryption, Monitoring',
impl_ja: 'IAM(Azure AD/Okta)+FIDO2、マイクロセグメンテーション(Kubernetes NetworkPolicy)、EDR/XDR',
impl_en: 'IAM (Azure AD/Okta) + FIDO2, Micro-segmentation (Kubernetes NetworkPolicy), EDR/XDR',
beyondcorp_ja: 'BeyondCorp 7原則: デバイス信頼、ユーザー検証、コンテキスト認識',
beyondcorp_en: 'BeyondCorp 7 principles: Device trust, User verification, Context awareness'
},
data_governance: {
title_ja: 'データガバナンス',
title_en: 'Data Governance',
elements_ja: ['データカタログ','品質管理(DQ)','リネージ(系譜)','セキュリティ','データメッシュ'],
elements_en: ['Data Catalog','Data Quality (DQ)','Lineage','Security','Data Mesh'],
stack_ja: 'DataHub/Amundsen(カタログ)、Great Expectations(品質)、動的マスキング(Snowflake/BigQuery)',
stack_en: 'DataHub/Amundsen (catalog), Great Expectations (quality), Dynamic masking (Snowflake/BigQuery)',
mesh_ja: 'データメッシュ原則: ドメイン所有、データプロダクト思考、セルフサービスインフラ',
mesh_en: 'Data Mesh principles: Domain ownership, Data as product, Self-serve infrastructure'
},
globalization: {
title_ja: 'グローバル展開(i18n/l10n)',
title_en: 'Globalization (i18n/l10n)',
i18n_ja: 'Unicode対応、RTL(右→左)対応、ハードコード排除、pluralization',
i18n_en: 'Unicode support, RTL (right-to-left), No hardcoded strings, Pluralization',
l10n_ja: '言語リソース管理(Locize/Phrase)、地域別フォーマット(日付・通貨・住所)',
l10n_en: 'Language resource mgmt (Locize/Phrase), Regional formats (date/currency/address)',
infra_ja: 'エッジロケーション(CDN)活用、データレジデンシー(GDPR/各国法令)',
infra_en: 'Edge locations (CDN), Data residency (GDPR/local regulations)'
}
};
// Extreme Implementation Scenarios (6 advanced patterns)
const EXTREME_SCENARIOS = {
break_glass: {
title_ja: 'Break-glass緊急アクセス(Healthcare/Gov)',
title_en: 'Break-glass Emergency Access (Healthcare/Gov)',
desc_ja: '通常はアクセス不可、緊急時のみ理由入力で全医師許可。監査ログ必須。',
desc_en: 'Normally denied, emergency mode allows all doctors with reason input. Audit log required.',
tech: 'OPA/Rego, ABAC (Attribute-Based Access Control)',
domains: ['health', 'government']
},
k_anonymity: {
title_ja: 'k-匿名化パイプライン(個人特定防止)',
title_en: 'k-Anonymity Pipeline (De-identification)',
desc_ja: '準識別子(年齢・郵便番号・性別)の組み合わせでk人以上のグループを形成。',
desc_en: 'Form groups of k+ individuals using quasi-identifiers (age/zip/gender).',
tech: 'Pandas (generalization), k≥3 enforcement',
domains: ['health', 'hr', 'fintech']
},
geo_partition: {
title_ja: 'ジオパーティショニング(データレジデンシー)',
title_en: 'Geo-Partitioning (Data Residency)',
desc_ja: 'SQLレベルでデータ配置リージョンを制御。GDPR/各国法令対応。',
desc_en: 'Control physical data placement at SQL level. GDPR/local law compliance.',
tech: 'CockroachDB / YugabyteDB (geo-partitioning)',
domains: ['fintech', 'ec', 'saas', 'health', 'government']
},
carbon_aware: {
title_ja: 'カーボンアウェアスケーリング(Green IT)',
title_en: 'Carbon-Aware Scaling (Green IT)',
desc_ja: '電力CO2排出係数に基づき、非必須処理を抑制。KEDA外部トリガー。',
desc_en: 'Scale down non-critical workloads based on carbon intensity. KEDA external trigger.',
tech: 'KEDA, Carbon Intensity API',
domains: ['manufacturing', 'energy', 'ec', 'analytics']
},
post_quantum: {
title_ja: 'ポスト量子暗号+DID(未来対応)',
title_en: 'Post-Quantum Cryptography + DID (Future-Ready)',
desc_ja: 'NIST標準ML-KEM(Kyber)ハイブリッド鍵交換、Verifiable Credentials。',
desc_en: 'NIST-standardized ML-KEM (Kyber) hybrid key exchange, Verifiable Credentials.',
tech: 'ML-KEM (Kyber), DID (Decentralized Identifiers)',
domains: ['fintech', 'government', 'legal']
},
strangler_fig: {
title_ja: 'Strangler Figパターン(段階的移行)',
title_en: 'Strangler Fig Pattern (Gradual Migration)',
desc_ja: 'Nginxでトラフィック分割。レガシー→新システムへ徐々に移行。',
desc_en: 'Traffic splitting via Nginx. Gradual migration from legacy to new system.',
tech: 'Nginx split_clients, Canary release',
domains: ['_all']
}
};
// Pragmatic Implementation Scenarios (5 high-impact patterns)
const PRAGMATIC_SCENARIOS = {
disposable_arch: {
title_ja: '使い捨てアーキテクチャ(PMF前スピード特化)',
title_en: 'Disposable Architecture (Pre-PMF Speed)',
desc_ja: 'BaaS極限活用(Supabase RLS)、API開発スキップ。PMF後に再設計。',
desc_en: 'Extreme BaaS usage (Supabase RLS), Skip API development. Redesign post-PMF.',
stakeholder: 'startup',
tech: 'Supabase / Firebase + Next.js (Vercel)'
},
ai_hitl: {
title_ja: 'AI協働型(Human-in-the-loop)',
title_en: 'AI Collaboration (Human-in-the-loop)',
desc_ja: 'AI回答を人間が修正→修正データを学習サイクルへ即座に還元。',
desc_en: 'Humans correct AI responses → Corrections fed back to learning cycle.',
stakeholder: 'team',
tech: 'LangChain, Streamlit, Feedback DB'
},
small_data_stack: {
title_ja: 'スモールデータ基盤(中堅企業DX)',
title_en: 'Small Data Stack (Mid-size Enterprise DX)',
desc_ja: '高価なデータ基盤不要。dbt+Great Expectationsで品質担保。',
desc_en: 'No expensive data platform. dbt + Great Expectations for quality.',
stakeholder: 'enterprise',
tech: 'Fivetran (Extract) → Snowflake → dbt (Transform)'
},
silver_tech: {
title_ja: 'シルバーテック(高齢者対応)',
title_en: 'Silver Tech (Elderly-Friendly)',
desc_ja: '脱パスワード、LINE完結、音声UI優先。日本市場必須対応。',
desc_en: 'Passwordless, LINE-first, Voice UI priority. Essential for Japanese market.',
stakeholder: 'team',
tech: 'FIDO2, LINE Login, Web Speech API'
},
dora_platform: {
title_ja: 'DORA指標+Platform Engineering',
title_en: 'DORA Metrics + Platform Engineering',
desc_ja: 'Backstageで"Golden Path"提供。開発者の認知負荷削減。',
desc_en: 'Backstage provides "Golden Path". Reduce developer cognitive load.',
stakeholder: 'enterprise',
tech: 'Backstage, GitHub Actions, DORA metrics dashboard'
}
};
// Tech Radar Base Data (Adopt/Trial/Assess/Hold)
const TECH_RADAR_BASE = {
frontend: {
adopt: ['React 19','Next.js 15','Tailwind CSS','TypeScript','Zod'],
trial: ['Astro','Qwik','htmx','React Server Components'],
assess: ['Svelte 5','Solid.js','Web Components'],
hold: ['jQuery','Angular.js','Backbone.js']
},
backend: {
adopt: ['Node.js 22 LTS','Hono','Fastify','PostgreSQL','Redis'],
trial: ['Bun','Deno 2','Cloudflare Workers','Edge Runtime','gRPC'],
assess: ['Rust (Actix/Axum)','Go (Gin/Echo)','Zig','WebAssembly (WASI)'],
hold: ['PHP 7.x','Python 2.x','MongoDB (as primary DB)']
},
infrastructure: {
adopt: ['Docker','Vercel','Railway','Supabase','Stripe'],
trial: ['SST (Serverless Stack)','Terraform','Pulumi','Cloudflare Pages','Backstage'],
assess: ['Kubernetes (for scale)','Fly.io','Render'],
hold: ['Heroku','AWS Elastic Beanstalk','Self-hosted without automation']
},
ai: {
adopt: ['Claude 4.5/4.6','GPT-4o','Vercel AI SDK','OpenAI SDK'],
trial: ['Claude Code','Cursor','Anthropic MCP','AI Agents'],
assess: ['Local LLMs (Ollama)','Fine-tuning','Vector DBs (Pinecone/Weaviate)'],
hold: ['GPT-3.5 (outdated)','Non-streaming responses','Prompt without streaming']
},
mobile: {
adopt: ['React Native (Expo)','Flutter'],
trial: ['Kotlin Multiplatform (KMP)','Compose Multiplatform','SwiftUI','Jetpack Compose'],
assess: ['Tauri v2','visionOS / RealityKit'],
hold: ['Cordova','Ionic 4','Xamarin']
}
};
/// Helper: Industry detection (wraps detectDomain - 32 domains)
function detectIndustry(purpose) {
// Simplified wrapper - detectDomain() now handles all 32 domains
const d = detectDomain(purpose);
return d || '_default';
}

// Helper: Detect stakeholder type from target
function detectStakeholder(target) {
if (!target) return 'team';
const t = target.toLowerCase();
if (t.includes('startup') || t.includes('スタートアップ') || t.includes('起業') || t.includes('freelancer') || t.includes('フリーランス')) return 'startup';
if (t.includes('executive') || t.includes('役員') || t.includes('enterprise') || t.includes('大企業') || t.includes('admin') || t.includes('管理者')) return 'enterprise';
if (t.includes('engineer') && !t.includes('startup') || t.includes('エンジニア') || t.includes('developer') || t.includes('開発者')) return 'developer';
return 'team';
}

// Main Generator Function
function genPillar13_StrategicIntelligence(a, pn) {
const G = S.genLang === 'ja';
const domain = detectIndustry(a.purpose) || '_default';
const intel = INDUSTRY_INTEL[domain] || INDUSTRY_INTEL._default;
const target = a.target || '';
const stakeholderType = detectStakeholder(target);
const stakeholder = STAKEHOLDER_STRATEGY[stakeholderType];
const frontend = a.frontend || 'React + Next.js';
const backend = a.backend || 'Supabase';
const database = a.database || 'PostgreSQL';
const deploy = a.deploy || 'Vercel';
// ═══ DOC 48: Industry Blueprint ═══
let doc48 = '';
doc48 += '# ' + (G ? '業種別設計図: ' : 'Industry Blueprint: ') + (G ? domain : domain) + '\n\n';
doc48 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc48 += '> ' + (G ? 'ドメイン: ' : 'Domain: ') + domain + '\n';
doc48 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc48 += '## ' + (G ? '1. 規制・コンプライアンス要件' : '1. Regulatory & Compliance Requirements') + '\n\n';
const regs = G ? intel.reg_ja : intel.reg_en;
regs.forEach(r => doc48 += '- ' + r + '\n');
doc48 += '\n' + (G ? '**関連ドキュメント:** ' : '**Related Documents:** ') + '[Compliance Matrix](./45_compliance_matrix.md) | [Security Intelligence](./43_security_intelligence.md)\n\n';
doc48 += '## ' + (G ? '2. 推奨アーキテクチャパターン' : '2. Recommended Architecture Patterns') + '\n\n';
const archs = G ? intel.arch_ja : intel.arch_en;
archs.forEach(ar => doc48 += '- **' + ar + '**\n');
doc48 += '\n### ' + (G ? '現在のスタック適合度' : 'Current Stack Compatibility') + '\n\n';
doc48 += '| ' + (G ? 'レイヤー' : 'Layer') + ' | ' + (G ? '選択技術' : 'Selected Tech') + ' | ' + (G ? '業種推奨' : 'Industry Rec') + ' | ' + (G ? '適合度' : 'Fit') + ' |\n';
doc48 += '|---|---|---|---|\n';
// Frontend compatibility
const isFrontendGood = frontend.includes('Next.js') || frontend.includes('React') || frontend.includes('Vue');
doc48 += '| Frontend | ' + frontend + ' | React/Next.js/Vue | ' + (isFrontendGood ? '✅ ' + (G ? '良好' : 'Good') : '⚠️ ' + (G ? '要検討' : 'Review')) + ' |\n';
// Backend compatibility
const isBackendGood = backend.includes('Supabase') || backend.includes('Firebase') || backend.includes('Express') || backend.includes('Fastify') || backend.includes('Hono');
doc48 += '| Backend | ' + backend + ' | BaaS/Node.js | ' + (isBackendGood ? '✅ ' + (G ? '良好' : 'Good') : '⚠️ ' + (G ? '要検討' : 'Review')) + ' |\n';
// Database compatibility
const isDbGood = database.includes('PostgreSQL') || database.includes('Supabase') || database.includes('Firebase');
doc48 += '| Database | ' + database + ' | PostgreSQL/Firebase | ' + (isDbGood ? '✅ ' + (G ? '良好' : 'Good') : '⚠️ ' + (G ? '要検討' : 'Review')) + ' |\n\n';
doc48 += '## ' + (G ? '3. 失敗要因 Top 3' : '3. Top 3 Failure Factors') + '\n\n';
const fails = G ? intel.fail_ja : intel.fail_en;
fails.forEach((f, i) => {
doc48 += '### ' + (G ? '失敗要因' : 'Failure Factor') + ' ' + (i + 1) + ': ' + f + '\n\n';
doc48 += (G ? '**回避策:**\n' : '**Mitigation:**\n');
doc48 += '- [ ] ' + (G ? 'チェックリスト項目を追加' : 'Add checklist item') + '\n';
doc48 += '- [ ] ' + (G ? 'モニタリング設定' : 'Set up monitoring') + '\n';
doc48 += '- [ ] ' + (G ? 'テスト戦略に組み込み' : 'Incorporate into test strategy') + '\n\n';
});
doc48 += '## ' + (G ? '4. ビジネスモデル比較' : '4. Business Model Comparison') + '\n\n';
const bms = G ? intel.bm_ja : intel.bm_en;
doc48 += '| ' + (G ? 'モデル' : 'Model') + ' | ' + (G ? '収益源' : 'Revenue') + ' | ' + (G ? 'ターゲット' : 'Target') + ' |\n';
doc48 += '|---|---|---|\n';
bms.forEach(bm => {
const parts = bm.split('|');
if (parts.length === 3) {
doc48 += '| ' + parts[0] + ' | ' + parts[1] + ' | ' + parts[2] + ' |\n';
}
});
doc48 += '\n';
doc48 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc48 += (G ? '**戦略:** ' : '**Strategy:** ');
doc48 += '[Tech Radar](./49_tech_radar.md), [Stakeholder Strategy](./50_stakeholder_strategy.md), [Market Positioning](./56_market_positioning.md)\n\n';
doc48 += (G ? '**運用:** ' : '**Operations:** ');
doc48 += '[Operational Excellence](./51_operational_excellence.md)\n\n';
doc48 += (G ? '**基盤:** ' : '**Foundation:** ');
doc48 += '[Architecture](./03_architecture.md), [Business Model](./38_business_model.md)\n';
S.files['docs/48_industry_blueprint.md'] = doc48;
// ═══ DOC 49: Tech Radar ═══
let doc49 = '';
doc49 += '# ' + (G ? '技術トレンドレーダー 2026-2030' : 'Technology Radar 2026-2030') + '\n\n';
doc49 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc49 += '> ' + (G ? '基準日: ' : 'As of: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc49 += '## ' + (G ? '1. 技術分類マトリクス' : '1. Technology Classification Matrix') + '\n\n';
['frontend', 'backend', 'infrastructure', 'ai'].forEach(cat => {
const radar = TECH_RADAR_BASE[cat];
doc49 += '### ' + cat.charAt(0).toUpperCase() + cat.slice(1) + '\n\n';
doc49 += '| ' + (G ? 'カテゴリ' : 'Category') + ' | ' + (G ? '技術' : 'Technologies') + ' |\n';
doc49 += '|---|---|\n';
doc49 += '| 🟢 **Adopt** ' + (G ? '(即採用)' : '(Adopt Now)') + ' | ' + radar.adopt.join(', ') + ' |\n';
doc49 += '| 🔵 **Trial** ' + (G ? '(試験導入)' : '(Trial)') + ' | ' + radar.trial.join(', ') + ' |\n';
doc49 += '| 🟡 **Assess** ' + (G ? '(評価中)' : '(Assess)') + ' | ' + radar.assess.join(', ') + ' |\n';
doc49 += '| 🔴 **Hold** ' + (G ? '(保留・非推奨)' : '(Hold/Avoid)') + ' | ' + radar.hold.join(', ') + ' |\n\n';
});
doc49 += '## ' + (G ? '2. 業種別注目技術(2026-2030)' : '2. Domain-Specific Trends (2026-2030)') + '\n\n';
const trends = G ? intel.trend_ja : intel.trend_en;
trends.forEach((tr, i) => {
doc49 += '### ' + (G ? 'トレンド' : 'Trend') + ' ' + (i + 1) + ': ' + tr + '\n\n';
doc49 += (G ? '**採用タイムライン:**\n' : '**Adoption Timeline:**\n');
doc49 += '- ' + (G ? '即時(2026 Q1-Q2): 技術検証・PoC実施' : 'Immediate (2026 Q1-Q2): Tech validation & PoC') + '\n';
doc49 += '- ' + (G ? '中期(2026 Q3-Q4): パイロット導入' : 'Mid-term (2026 Q3-Q4): Pilot deployment') + '\n';
doc49 += '- ' + (G ? '長期(2027-2030): 本格展開' : 'Long-term (2027-2030): Full rollout') + '\n\n';
});
doc49 += '## ' + (G ? '3. スタック進化ロードマップ' : '3. Stack Evolution Roadmap') + '\n\n';
doc49 += '```mermaid\n';
doc49 += 'timeline\n';
doc49 += '  title ' + (G ? 'スタック進化ロードマップ' : 'Stack Evolution Roadmap') + '\n';
// Sanitize tech names for timeline (remove colons that break syntax)
const safeFE = frontend.replace(/:/g, ' -');
const safeBE = backend.replace(/:/g, ' -');
const safeDB = database.replace(/:/g, ' -');
doc49 += '  ' + (G ? '現在(2026 Q1)' : 'Current (2026 Q1)') + ' : ' + safeFE + ' : ' + safeBE + ' : ' + safeDB + '\n';
doc49 += '  ' + (G ? '6ヶ月後(2026 Q3)' : '6 Months (2026 Q3)') + ' : ' + (G ? 'パフォーマンス最適化' : 'Performance optimization') + ' : ' + (G ? 'AI機能統合' : 'AI feature integration') + '\n';
doc49 += '  ' + (G ? '1年後(2027 Q1)' : '1 Year (2027 Q1)') + ' : ' + (G ? 'スケーラビリティ強化' : 'Scalability enhancement') + ' : ' + (G ? 'リアルタイム機能拡充' : 'Real-time features expansion') + '\n';
doc49 += '  ' + (G ? '3年後(2029 Q1)' : '3 Years (2029 Q1)') + ' : ' + (G ? '次世代アーキテクチャ移行' : 'Next-gen architecture migration') + ' : ' + (G ? '完全AI統合' : 'Full AI integration') + '\n';
doc49 += '```\n\n';
doc49 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc49 += (G ? '**戦略基盤:** ' : '**Strategy Foundation:** ');
doc49 += '[Industry Blueprint](./48_industry_blueprint.md), [Architecture](./03_architecture.md)\n\n';
doc49 += (G ? '**実装:** ' : '**Implementation:** ');
doc49 += '[Implementation Playbook](./39_implementation_playbook.md), [Roadmap](./10_gantt.md)\n\n';
doc49 += (G ? '**運用:** ' : '**Operations:** ');
doc49 += '[Operational Excellence](./51_operational_excellence.md)\n';
S.files['docs/49_tech_radar.md'] = doc49;
// ═══ DOC 50: Stakeholder Strategy ═══
let doc50 = '';
doc50 += '# ' + (G ? 'ステークホルダー別開発戦略: ' : 'Stakeholder Strategy: ') + (G ? stakeholder.name_ja : stakeholder.name_en) + '\n\n';
doc50 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc50 += '> ' + (G ? 'タイプ: ' : 'Type: ') + stakeholderType + '\n';
doc50 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc50 += '## ' + (G ? '1. 開発フェーズ戦略' : '1. Development Phase Strategy') + '\n\n';
const phases = G ? stakeholder.phases_ja : stakeholder.phases_en;
phases.forEach((ph, i) => {
doc50 += '### ' + (G ? 'フェーズ' : 'Phase') + ' ' + (i + 1) + ': ' + ph + '\n\n';
doc50 += (G ? '**主要タスク:**\n' : '**Key Tasks:**\n');
doc50 += '- [ ] ' + (G ? 'タスク1' : 'Task 1') + '\n';
doc50 += '- [ ] ' + (G ? 'タスク2' : 'Task 2') + '\n';
doc50 += '- [ ] ' + (G ? 'タスク3' : 'Task 3') + '\n\n';
});
doc50 += '## ' + (G ? '2. 技術的負債管理戦略' : '2. Technical Debt Management Strategy') + '\n\n';
doc50 += (G ? stakeholder.tech_debt_ja : stakeholder.tech_debt_en) + '\n\n';
doc50 += (G ? '**具体的アクション:**\n' : '**Concrete Actions:**\n');
doc50 += '- [ ] ' + (G ? '負債リストを作成(Issue tracking)' : 'Create debt list (Issue tracking)') + '\n';
doc50 += '- [ ] ' + (G ? 'SQALE Rating計測ツール導入(SonarQube)' : 'Implement SQALE Rating tool (SonarQube)') + '\n';
doc50 += '- [ ] ' + (G ? '四半期ごとにリファクタリングSprint実施' : 'Conduct quarterly refactoring sprints') + '\n\n';
doc50 += '## ' + (G ? '3. チーム構成推奨' : '3. Team Composition Recommendations') + '\n\n';
doc50 += (G ? stakeholder.team_ja : stakeholder.team_en) + '\n\n';
doc50 += '```mermaid\n';
doc50 += 'graph LR\n';
if (stakeholderType === 'startup') {
doc50 += '  A[Full-stack 1-2] --> B[Front/Back 3-5]\n';
doc50 += '  B --> C[Specialized 10+]\n';
} else if (stakeholderType === 'enterprise') {
doc50 += '  A[Architect] --> B[Team 1]\n';
doc50 += '  A --> C[Team 2]\n';
doc50 += '  A --> D[Platform Eng]\n';
} else if (stakeholderType === 'developer') {
doc50 += '  A[Solo] --> B[Duo]\n';
doc50 += '  B --> C[Small Team 3-5]\n';
} else {
doc50 += '  A[Cross-functional 5-9] --> B[Two-Pizza Team]\n';
}
doc50 += '```\n\n';
doc50 += '## ' + (G ? '4. 予算配分ガイド' : '4. Budget Allocation Guide') + '\n\n';
doc50 += '**' + (G ? '推奨配分:' : 'Recommended allocation:') + '**\n\n';
doc50 += (G ? stakeholder.budget_ja : stakeholder.budget_en) + '\n\n';
doc50 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc50 += (G ? '**戦略:** ' : '**Strategy:** ');
doc50 += '[Industry Blueprint](./48_industry_blueprint.md), [Operational Excellence](./51_operational_excellence.md)\n\n';
doc50 += (G ? '**計画:** ' : '**Planning:** ');
doc50 += '[Goal Decomposition](./30_goal_decomposition.md), [WBS](./11_wbs.md), [Roadmap](./10_gantt.md)\n\n';
doc50 += (G ? '**成長:** ' : '**Growth:** ');
doc50 += '[Growth Intelligence](./41_growth_intelligence.md)\n';
S.files['docs/50_stakeholder_strategy.md'] = doc50;
// ═══ DOC 51: Operational Excellence ═══
let doc51 = '';
doc51 += '# ' + (G ? '運用卓越性' : 'Operational Excellence') + '\n\n';
doc51 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc51 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
// Tech Debt
const td = OPERATIONAL_FRAMEWORKS.tech_debt;
doc51 += '## ' + (G ? '1. 技術的負債管理' : '1. Technical Debt Management') + '\n\n';
doc51 += '### ' + (G ? td.title_ja : td.title_en) + '\n\n';
doc51 += (G ? '**4象限分類:**\n' : '**4-Quadrant Classification:**\n');
const quadrants = G ? td.quadrant_ja : td.quadrant_en;
quadrants.forEach((q, i) => doc51 += (i + 1) + '. ' + q + '\n');
doc51 += '\n**SQALE:** ' + (G ? td.sqale_ja : td.sqale_en) + '\n\n';
doc51 += '**' + (G ? td.rule_ja : td.rule_en) + '**\n\n';
// DR/BCP
const dr = OPERATIONAL_FRAMEWORKS.dr_bcp;
doc51 += '## ' + (G ? '2. 災害復旧・BCP' : '2. Disaster Recovery & BCP') + '\n\n';
doc51 += '### ' + (G ? dr.title_ja : dr.title_en) + '\n\n';
doc51 += (G ? dr.rto_rpo_ja : dr.rto_rpo_en) + '\n\n';
const tiers = G ? dr.tier_ja : dr.tier_en;
tiers.forEach(t => doc51 += '- ' + t + '\n');
doc51 += '\n**' + (G ? 'バックアップ戦略:' : 'Backup Strategy:') + '** ' + (G ? dr.backup_ja : dr.backup_en) + '\n\n';
doc51 += '**' + (G ? 'インシデント対応フロー:' : 'Incident Response Flow:') + '** ' + (G ? dr.incident_ja : dr.incident_en) + '\n\n';
// Green IT
const green = OPERATIONAL_FRAMEWORKS.green_it;
doc51 += '## ' + (G ? '3. Green IT・カーボンニュートラル' : '3. Green IT & Carbon Neutrality') + '\n\n';
const frameworks = G ? green.framework_ja : green.framework_en;
frameworks.forEach(f => doc51 += '- ' + f + '\n');
doc51 += '\n**' + (G ? '計測:' : 'Measurement:') + '** ' + (G ? green.carbon_ja : green.carbon_en) + '\n\n';
doc51 += '**' + (G ? 'インフラ選択:' : 'Infrastructure:') + '** ' + (G ? green.sla_ja : green.sla_en) + '\n\n';
// Team Design
const team = OPERATIONAL_FRAMEWORKS.team_design;
doc51 += '## ' + (G ? '4. チーム設計・Conway\'s Law対応' : '4. Team Design & Conway\'s Law') + '\n\n';
doc51 += '**' + (G ? 'Conway\'s Law:' : 'Conway\'s Law:') + '** ' + (G ? team.conway_ja : team.conway_en) + '\n\n';
doc51 += '**' + (G ? team.two_pizza_ja : team.two_pizza_en) + '**\n\n';
doc51 += '**DORA Metrics:** ' + (G ? team.dora_ja : team.dora_en) + '\n\n';
doc51 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc51 += (G ? '**戦略:** ' : '**Strategy:** ');
doc51 += '[Stakeholder Strategy](./50_stakeholder_strategy.md), [Industry Blueprint](./48_industry_blueprint.md)\n\n';
doc51 += (G ? '**運用実装:** ' : '**Ops Implementation:** ');
doc51 += '[Ops Runbook](./53_ops_runbook.md), [Ops Checklist](./54_ops_checklist.md)\n\n';
doc51 += (G ? '**品質:** ' : '**Quality:** ');
doc51 += '[QA Strategy](./28_qa_strategy.md), [Test Strategy](./36_test_strategy.md), [Incident Response](./34_incident_response.md)\n';
S.files['docs/51_operational_excellence.md'] = doc51;
// ═══ DOC 52: Advanced Scenarios ═══
let doc52 = '';
doc52 += '# ' + (G ? '先端実装シナリオ集' : 'Advanced Implementation Scenarios') + '\n\n';
doc52 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc52 += '> ' + (G ? 'ドメイン: ' : 'Domain: ') + domain + '\n';
doc52 += '> ' + (G ? 'ステークホルダー: ' : 'Stakeholder: ') + stakeholderType + '\n';
doc52 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc52 += '## ' + (G ? '1. 拡張運用フレームワーク' : '1. Extended Operational Frameworks') + '\n\n';
// AI Ethics
const ai_eth = OPERATIONAL_FRAMEWORKS_EXT.ai_ethics;
doc52 += '### ' + (G ? ai_eth.title_ja : ai_eth.title_en) + '\n\n';
doc52 += (G ? '**5原則:** ' : '**5 Principles:** ');
const principles = G ? ai_eth.principles_ja : ai_eth.principles_en;
doc52 += principles.join(', ') + '\n\n';
doc52 += (G ? '**実装:** ' : '**Implementation:** ') + (G ? ai_eth.impl_ja : ai_eth.impl_en) + '\n\n';
doc52 += (G ? '**コンプライアンス:** ' : '**Compliance:** ') + (G ? ai_eth.compliance_ja : ai_eth.compliance_en) + '\n\n';
// Zero Trust
const zt = OPERATIONAL_FRAMEWORKS_EXT.zero_trust;
doc52 += '### ' + (G ? zt.title_ja : zt.title_en) + '\n\n';
doc52 += (G ? '**原則:** ' : '**Principles:** ') + (G ? zt.principles_ja : zt.principles_en) + '\n\n';
doc52 += (G ? '**実装:** ' : '**Implementation:** ') + (G ? zt.impl_ja : zt.impl_en) + '\n\n';
doc52 += (G ? '**BeyondCorp:** ' : '**BeyondCorp:** ') + (G ? zt.beyondcorp_ja : zt.beyondcorp_en) + '\n\n';
// Data Governance
const dg = OPERATIONAL_FRAMEWORKS_EXT.data_governance;
doc52 += '### ' + (G ? dg.title_ja : dg.title_en) + '\n\n';
doc52 += (G ? '**要素:** ' : '**Elements:** ');
const elements = G ? dg.elements_ja : dg.elements_en;
doc52 += elements.join(', ') + '\n\n';
doc52 += (G ? '**スタック:** ' : '**Stack:** ') + (G ? dg.stack_ja : dg.stack_en) + '\n\n';
doc52 += (G ? '**データメッシュ:** ' : '**Data Mesh:** ') + (G ? dg.mesh_ja : dg.mesh_en) + '\n\n';
// Globalization
const glob = OPERATIONAL_FRAMEWORKS_EXT.globalization;
doc52 += '### ' + (G ? glob.title_ja : glob.title_en) + '\n\n';
doc52 += (G ? '**i18n:** ' : '**i18n:** ') + (G ? glob.i18n_ja : glob.i18n_en) + '\n\n';
doc52 += (G ? '**l10n:** ' : '**l10n:** ') + (G ? glob.l10n_ja : glob.l10n_en) + '\n\n';
doc52 += (G ? '**インフラ:** ' : '**Infrastructure:** ') + (G ? glob.infra_ja : glob.infra_en) + '\n\n';
doc52 += '## ' + (G ? '2. 極限実装シナリオ' : '2. Extreme Implementation Scenarios') + '\n\n';
doc52 += (G ? '**対象:** このドメインに関連する先端実装パターン\n\n' : '**Scope:** Advanced patterns relevant to this domain\n\n');
// Filter extreme scenarios by domain
Object.keys(EXTREME_SCENARIOS).forEach(key => {
const sc = EXTREME_SCENARIOS[key];
if (sc.domains.includes('_all') || sc.domains.includes(domain)) {
doc52 += '### ' + (G ? sc.title_ja : sc.title_en) + '\n\n';
doc52 += (G ? sc.desc_ja : sc.desc_en) + '\n\n';
doc52 += '**' + (G ? '技術:' : 'Technology:') + '** ' + sc.tech + '\n\n';
}
});
doc52 += '## ' + (G ? '3. 実利シナリオ' : '3. Pragmatic Scenarios') + '\n\n';
doc52 += (G ? '**対象:** このステークホルダータイプに推奨される高効率パターン\n\n' : '**Scope:** High-impact patterns for this stakeholder type\n\n');
// Filter pragmatic scenarios by stakeholder
Object.keys(PRAGMATIC_SCENARIOS).forEach(key => {
const sc = PRAGMATIC_SCENARIOS[key];
if (sc.stakeholder === stakeholderType || sc.stakeholder === 'team') {
doc52 += '### ' + (G ? sc.title_ja : sc.title_en) + '\n\n';
doc52 += (G ? sc.desc_ja : sc.desc_en) + '\n\n';
doc52 += '**' + (G ? '技術:' : 'Technology:') + '** ' + sc.tech + '\n\n';
}
});
doc52 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc52 += '- [Industry Blueprint](./48_industry_blueprint.md)\n';
doc52 += '- [Tech Radar](./49_tech_radar.md)\n';
doc52 += '- [Stakeholder Strategy](./50_stakeholder_strategy.md)\n';
doc52 += '- [Operational Excellence](./51_operational_excellence.md)\n';
doc52 += '- [Security Intelligence](./43_security_intelligence.md)\n';
doc52 += '- [Compliance Matrix](./45_compliance_matrix.md)\n';
S.files['docs/52_advanced_scenarios.md'] = doc52;
}


function genPillar14_OpsIntelligence(a, pn) {
const G = S.genLang === 'ja';
const domain = detectDomain(a.purpose) || '_default';
const arch = resolveArch(a);
const ops = DOMAIN_OPS[domain] || DOMAIN_OPS._default;
const deployTarget = a.deploy || 'Vercel';
const isBaaS = arch.isBaaS;
const db = a.database || 'PostgreSQL';
// ═══ File 53: Ops Runbook (Ops Plane Design) ═══
let runbook = `# ${pn} ${G ? '— 運用設計書 (Ops Plane)' : '— Ops Runbook (Ops Plane)'}\n\n`;
runbook += G
? `**ドメイン**: ${domain} | **SLO**: ${ops.slo} | **アーキテクチャ**: ${arch.pattern}\n\n`
: `**Domain**: ${domain} | **SLO**: ${ops.slo} | **Architecture**: ${arch.pattern}\n\n`;
// Section 1: Ops Plane Architecture
runbook += `## ${G ? '1. Ops Plane アーキテクチャ' : '1. Ops Plane Architecture'}\n\n`;
runbook += G
? `**設計原則**: アプリケーション平面(App Plane)と運用平面(Ops Plane)を明確に分離し、運用操作が開発フローを阻害しないようにする。\n\n`
: `**Design Principle**: Clearly separate Application Plane (App Plane) and Operations Plane (Ops Plane) so operational tasks don't interfere with development flow.\n\n`;
runbook += '```mermaid\ngraph TB\n';
runbook += '  subgraph "App Plane"\n';
runbook += '    A1[' + (G ? 'ユーザーリクエスト' : 'User Requests') + ']\n';
runbook += '    A2[' + (G ? 'ビジネスロジック' : 'Business Logic') + ']\n';
runbook += '    A3[' + (G ? 'データベース' : 'Database') + ']\n';
runbook += '  end\n';
runbook += '  subgraph "Ops Plane"\n';
runbook += '    O1[' + (G ? 'Feature Flags' : 'Feature Flags') + ']\n';
runbook += '    O2[' + (G ? 'Observability' : 'Observability') + ']\n';
runbook += '    O3[' + (G ? 'Job Queue' : 'Job Queue') + ']\n';
runbook += '    O4[' + (G ? 'Backup/Recovery' : 'Backup/Recovery') + ']\n';
runbook += '  end\n';
runbook += '  A1 --> A2\n  A2 --> A3\n';
runbook += '  O1 -.-> A2\n  O2 -.-> A1\n  O2 -.-> A2\n  O2 -.-> A3\n';
runbook += '  A2 --> O3\n  A3 --> O4\n';
runbook += '```\n\n';
// Section 2: Feature Flags & Kill Switches
runbook += `## ${G ? '2. Feature Flags & Kill Switches' : '2. Feature Flags & Kill Switches'}\n\n`;
runbook += G
? `**目的**: 本番環境でコード変更なしに機能の有効化/無効化を制御し、障害時の迅速な対応を可能にする。\n\n`
: `**Purpose**: Control feature enable/disable in production without code changes, enabling rapid response to incidents.\n\n`;
runbook += `### ${G ? 'ドメイン固有フラグ' : 'Domain-Specific Flags'}\n\n`;
const flags = G ? ops.flags_ja : ops.flags_en;
flags.forEach((flag, i) => {
runbook += `${i + 1}. **${flag}**\n`;
});
runbook += '\n';
// Implementation pattern
runbook += `### ${G ? '実装パターン' : 'Implementation Pattern'}\n\n`;
if (isBaaS) {
runbook += G
? `**環境変数ベース** (推奨): \`NEXT_PUBLIC_FEATURE_*\` でクライアント側制御、Server Actions で \`process.env.FEATURE_*\` でサーバー側制御\n\n`
: `**Environment Variables** (recommended): \`NEXT_PUBLIC_FEATURE_*\` for client-side, \`process.env.FEATURE_*\` for server-side in Server Actions\n\n`;
runbook += '```typescript\n';
runbook += '// Client-side flag check\n';
runbook += 'const isPaymentEnabled = process.env.NEXT_PUBLIC_FEATURE_PAYMENT === \'true\';\n\n';
runbook += '// Server-side flag check (Server Action)\n';
runbook += 'export async function processPayment() {\n';
runbook += '  if (process.env.FEATURE_PAYMENT_PROCESSING !== \'true\') {\n';
runbook += '    throw new Error(\'Payment processing is disabled\');\n';
runbook += '  }\n';
runbook += '  // ... payment logic\n';
runbook += '}\n```\n\n';
} else {
runbook += G
? `**データベーステーブル** (柔軟性): \`feature_flags\` テーブルで管理し、API経由で動的に変更\n\n`
: `**Database Table** (flexible): Manage in \`feature_flags\` table, dynamically change via API\n\n`;
runbook += '```sql\n';
runbook += 'CREATE TABLE feature_flags (\n';
runbook += '  name VARCHAR(100) PRIMARY KEY,\n';
runbook += '  enabled BOOLEAN NOT NULL DEFAULT false,\n';
runbook += '  description TEXT,\n';
runbook += '  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n';
runbook += ');\n';
runbook += '```\n\n';
}

// Section 3: SLO/SLI Definition
runbook += `## ${G ? '3. SLO/SLI 定義' : '3. SLO/SLI Definition'}\n\n`;
runbook += G
? `**目標SLO**: ${ops.slo} (ドメイン: ${domain})\n\n`
: `**Target SLO**: ${ops.slo} (Domain: ${domain})\n\n`;
runbook += `### ${G ? 'SLI (Service Level Indicators)' : 'SLI (Service Level Indicators)'}\n\n`;
runbook += G
? `| 指標 | 目標値 | 計測方法 |\n|------|--------|----------|\n`
: `| Indicator | Target | Measurement |\n|-----------|--------|-------------|\n`;
// Domain-specific SLI targets
const sliTargets = {
fintech: [
{ metric: G ? '取引成功率' : 'Transaction Success Rate', target: '99.99%', method: G ? 'transaction_logs集計' : 'Aggregate transaction_logs' },
{ metric: G ? 'API応答時間 (P99)' : 'API Response Time (P99)', target: '200ms', method: G ? 'APM/ログ' : 'APM/Logs' },
{ metric: G ? '不正検知精度' : 'Fraud Detection Accuracy', target: '92%+', method: G ? 'ML評価指標' : 'ML evaluation metrics' }
],
health: [
{ metric: G ? 'データ可用性' : 'Data Availability', target: '99.99%', method: G ? 'ヘルスチェックエンドポイント' : 'Health check endpoint' },
{ metric: G ? 'PHI暗号化率' : 'PHI Encryption Rate', target: '100%', method: G ? '監査ログ検証' : 'Audit log verification' },
{ metric: G ? '通知到達率' : 'Notification Delivery Rate', target: '95%+', method: G ? '送信/配信ログ比較' : 'Compare sent/delivered logs' }
],
education: [
{ metric: G ? '学習進捗保存率' : 'Progress Save Rate', target: '99.9%', method: G ? 'localStorage + バックエンド同期' : 'localStorage + backend sync' },
{ metric: G ? 'コンテンツ配信成功率' : 'Content Delivery Success', target: '99.9%', method: G ? 'CDN/ストレージログ' : 'CDN/storage logs' },
{ metric: G ? '試験可用性' : 'Exam Availability', target: '99.95%', method: G ? '試験開始成功率' : 'Exam start success rate' }
],
ec: [
{ metric: G ? '決済成功率' : 'Payment Success Rate', target: '99.5%', method: G ? 'Stripe Webhookログ' : 'Stripe webhook logs' },
{ metric: G ? 'カート処理時間' : 'Cart Processing Time', target: '<500ms', method: G ? 'APMトレース' : 'APM traces' },
{ metric: G ? '在庫同期精度' : 'Inventory Sync Accuracy', target: '99.9%', method: G ? '差分検証ジョブ' : 'Diff verification job' }
],
_default: [
{ metric: G ? 'アップタイム' : 'Uptime', target: ops.slo, method: G ? 'ヘルスチェックエンドポイント' : 'Health check endpoint' },
{ metric: G ? 'API応答時間 (P95)' : 'API Response Time (P95)', target: '<1s', method: G ? 'APM' : 'APM' },
{ metric: G ? 'エラー率' : 'Error Rate', target: '<1%', method: G ? 'ログ集計' : 'Log aggregation' }
]
};
const slis = sliTargets[domain] || sliTargets._default;
slis.forEach(sli => {
runbook += `| ${sli.metric} | ${sli.target} | ${sli.method} |\n`;
});
runbook += '\n';
// Section 4: Observability Stack
runbook += `## ${G ? '4. Observability Stack' : '4. Observability Stack'}\n\n`;
runbook += `### ${G ? 'ログ・メトリクス・トレース' : 'Logs, Metrics, Traces'}\n\n`;
// Deploy target specific observability
if (deployTarget.includes('Vercel')) {
runbook += G
? `**Vercel統合**: Vercel Analytics (Core Web Vitals), Vercel Log Drains → Datadog/Axiom\n\n`
: `**Vercel Integration**: Vercel Analytics (Core Web Vitals), Vercel Log Drains → Datadog/Axiom\n\n`;
runbook += '```typescript\n';
runbook += '// app/layout.tsx\n';
runbook += 'import { Analytics } from \'@vercel/analytics/react\';\n';
runbook += 'export default function RootLayout({ children }) {\n';
runbook += '  return <html><body>{children}<Analytics /></body></html>;\n';
runbook += '}\n```\n\n';
} else if (deployTarget.includes('Railway') || deployTarget.includes('Render')) {
runbook += G
? `**Container環境**: Prometheus (メトリクス), Grafana (可視化), Loki (ログ集約)\n\n`
: `**Container Environment**: Prometheus (metrics), Grafana (visualization), Loki (log aggregation)\n\n`;
runbook += '```yaml\n';
runbook += '# docker-compose.yml (monitoring stack)\n';
runbook += 'services:\n';
runbook += '  prometheus:\n';
runbook += '    image: prom/prometheus\n';
runbook += '    volumes:\n';
runbook += '      - ./prometheus.yml:/etc/prometheus/prometheus.yml\n';
runbook += '  grafana:\n';
runbook += '    image: grafana/grafana\n';
runbook += '    depends_on: [prometheus]\n';
runbook += '```\n\n';
} else if (deployTarget.includes('AWS')) {
runbook += G
? `**AWS統合**: CloudWatch (ログ+メトリクス), X-Ray (トレース), CloudWatch Insights (クエリ)\n\n`
: `**AWS Integration**: CloudWatch (logs+metrics), X-Ray (traces), CloudWatch Insights (queries)\n\n`;
} else {
runbook += G
? `**汎用スタック**: Sentry (エラー追跡), Axiom (ログ), ホスティングプラットフォームのビルトインツール\n\n`
: `**Generic Stack**: Sentry (error tracking), Axiom (logs), hosting platform built-in tools\n\n`;
}

// Section 5: Job Management & Queues
runbook += `## ${G ? '5. Job Management & Queues' : '5. Job Management & Queues'}\n\n`;
runbook += `### ${G ? 'バックグラウンドジョブ' : 'Background Jobs'}\n\n`;
const jobs = G ? ops.jobs_ja : ops.jobs_en;
jobs.forEach((job, i) => {
runbook += `${i + 1}. **${job}**\n`;
});
runbook += '\n';
runbook += `### ${G ? '実装方法' : 'Implementation'}\n\n`;
if (isBaaS) {
runbook += G
? `**BaaS環境**: \n- **Vercel Cron Jobs**: \`vercel.json\` で定期実行 (簡易ジョブ)\n- **Supabase pg_cron**: PostgreSQL拡張で定期SQL実行 (DB操作)\n- **Inngest/Trigger.dev**: 複雑ワークフロー向けサードパーティ\n\n`
: `**BaaS Environment**: \n- **Vercel Cron Jobs**: Define in \`vercel.json\` for periodic execution (simple jobs)\n- **Supabase pg_cron**: PostgreSQL extension for scheduled SQL (DB operations)\n- **Inngest/Trigger.dev**: Third-party for complex workflows\n\n`;
runbook += '```json\n';
runbook += '// vercel.json\n';
runbook += '{\n';
runbook += '  "crons": [{\n';
runbook += '    "path": "/api/cron/daily-aggregation",\n';
runbook += '    "schedule": "0 0 * * *"\n';
runbook += '  }]\n';
runbook += '}\n```\n\n';
} else {
runbook += G
? `**Traditional/Container環境**: \n- **BullMQ** (Node.js): Redis ベースのジョブキュー (推奨)\n- **node-cron**: シンプルな定期実行\n- **Celery** (Python): 分散タスクキュー\n\n`
: `**Traditional/Container Environment**: \n- **BullMQ** (Node.js): Redis-based job queue (recommended)\n- **node-cron**: Simple scheduled execution\n- **Celery** (Python): Distributed task queue\n\n`;
runbook += '```typescript\n';
runbook += '// BullMQ example\n';
runbook += 'import { Queue, Worker } from \'bullmq\';\n';
runbook += 'const myQueue = new Queue(\'aggregation\');\n';
runbook += 'await myQueue.add(\'daily\', { date: new Date() }, { repeat: { cron: \'0 0 * * *\' } });\n';
runbook += '```\n\n';
}

// Section 6: Backup & Recovery
runbook += `## ${G ? '6. Backup & Recovery' : '6. Backup & Recovery'}\n\n`;
const backups = G ? ops.backup_ja : ops.backup_en;
backups.forEach((backup, i) => {
runbook += `${i + 1}. ${backup}\n`;
});
runbook += '\n';
runbook += `### ${G ? '実装パス' : 'Implementation Path'}\n\n`;
if (db === 'PostgreSQL' || db === 'Supabase') {
runbook += '```bash\n';
runbook += '# PostgreSQL WAL-based continuous backup\n';
runbook += 'pg_basebackup -D /backup/base -Fp -Xs -P\n';
runbook += '# Point-in-time recovery (PITR)\n';
runbook += 'restore_command = \'cp /archive/%f %p\'\n';
runbook += 'recovery_target_time = \'2026-02-13 12:00:00\'\n';
runbook += '```\n\n';
} else if (db.includes('Firebase') || db.includes('MongoDB')) {
runbook += '```bash\n';
runbook += '# Firestore export (daily)\n';
runbook += 'gcloud firestore export gs://[BUCKET]/backups/$(date +%Y%m%d)\n';
runbook += '# MongoDB backup\n';
runbook += 'mongodump --uri="mongodb://..." --out=/backup/$(date +%Y%m%d)\n';
runbook += '```\n\n';
}

// Section 7: Rate Limiting & Throttling
runbook += `## ${G ? '7. Rate Limiting & Throttling' : '7. Rate Limiting & Throttling'}\n\n`;
runbook += G
? `**ドメイン別デフォルト閾値**:\n\n`
: `**Domain-Specific Default Thresholds**:\n\n`;
const rateLimits = {
fintech: { api: '100 req/min/user', payment: '10 txn/min/user', alert: '5 failed/min → 一時ロック' },
health: { api: '60 req/min/user', diagnostic: '5 req/min/user', alert: '3 failed → 手動確認' },
education: { api: '120 req/min/user', quiz: '10 submit/min', alert: '連続失敗5回 → カンニング検知' },
ec: { api: '100 req/min/user', checkout: '3 attempt/min', alert: '10 failed → 不正検知' },
saas: { api: '100 req/min/user', signup: '5/hour/IP', alert: 'rate limit超過 → スロットリング' },
_default: { api: '60 req/min/user', write: '30 req/min/user', alert: '閾値80% → アラート' }
};
const limits = rateLimits[domain] || rateLimits._default;
runbook += G
? `- **API全体**: ${limits.api}\n- **重要操作**: ${limits.write || limits.payment || limits.diagnostic || limits.quiz || limits.checkout || limits.signup}\n- **アラート**: ${limits.alert}\n\n`
: `- **Overall API**: ${limits.api}\n- **Critical Operations**: ${limits.write || limits.payment || limits.diagnostic || limits.quiz || limits.checkout || limits.signup}\n- **Alerting**: ${limits.alert}\n\n`;
if (!isBaaS) {
runbook += '```typescript\n';
runbook += '// Redis-based rate limiter (express middleware)\n';
runbook += 'import rateLimit from \'express-rate-limit\';\n';
runbook += 'import RedisStore from \'rate-limit-redis\';\n';
runbook += 'const limiter = rateLimit({\n';
runbook += '  store: new RedisStore({ client: redis }),\n';
runbook += '  windowMs: 60 * 1000, max: 100\n';
runbook += '});\n';
runbook += 'app.use(\'/api\', limiter);\n';
runbook += '```\n\n';
}

runbook += G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n';
runbook += G ? '**運用設計:** ' : '**Ops Design:** ';
runbook += '[Ops Checklist](./54_ops_checklist.md), [Ops Plane Design](./55_ops_plane_design.md)\n\n';
runbook += G ? '**戦略:** ' : '**Strategy:** ';
runbook += '[Operational Excellence](./51_operational_excellence.md), [Industry Blueprint](./48_industry_blueprint.md)\n\n';
runbook += G ? '**対応:** ' : '**Response:** ';
runbook += '[Incident Response](./34_incident_response.md)\n\n';
S.files['docs/53_ops_runbook.md'] = runbook;
// ═══ File 54: Ops Checklist (Day-1 Operations) ═══
let checklist = `# ${pn} ${G ? '— 運用準備チェックリスト (Day-1)' : '— Ops Readiness Checklist (Day-1)'}\n\n`;
checklist += G
? `**目的**: 本番環境リリース前に、運用に必要な12のカテゴリーの準備状況を確認する。\n\n`
: `**Purpose**: Verify readiness across 12 operational capability categories before production release.\n\n`;
// 12 Ops Capabilities Matrix
checklist += `## ${G ? '12 Ops Capabilities Matrix' : '12 Ops Capabilities Matrix'}\n\n`;
const capabilities = [
// 観測 (Observability) - 4 categories
{
cat: G ? '🔍 1. ログ集約' : '🔍 1. Log Aggregation',
items: G
? ['アプリケーションログ出力先設定済み', 'エラーログ構造化 (JSON形式)', 'ログレベル設定 (info/warn/error)', 'センシティブ情報マスキング']
: ['Application log destination configured', 'Error logs structured (JSON format)', 'Log levels configured (info/warn/error)', 'Sensitive info masked']
},
{
cat: G ? '📊 2. メトリクス収集' : '📊 2. Metrics Collection',
items: G
? ['SLI指標計測コード実装済み', 'APM/計測ツール統合', 'ビジネスメトリクス定義', 'メトリクス保持期間設定']
: ['SLI measurement code implemented', 'APM/instrumentation integrated', 'Business metrics defined', 'Metrics retention configured']
},
{
cat: G ? '🔔 3. アラート設定' : '🔔 3. Alerting Setup',
items: G
? ['SLO違反アラート設定', 'エラー率閾値アラート', '通知チャネル設定 (Slack/Email)', 'エスカレーションパス定義']
: ['SLO breach alerts configured', 'Error rate threshold alerts', 'Notification channels (Slack/Email)', 'Escalation path defined']
},
{
cat: G ? '🔎 4. トレーシング' : '🔎 4. Distributed Tracing',
items: G
? ['重要パストレース実装', 'トレースIDログ出力', 'ボトルネック特定可能', 'トレース保持期間設定']
: ['Critical path tracing implemented', 'Trace ID in logs', 'Bottleneck identification enabled', 'Trace retention configured']
},
// 制御 (Control) - 3 categories
{
cat: G ? '🚩 5. Feature Flags' : '🚩 5. Feature Flags',
items: G
? ['フラグ管理システム選定済み', 'ドメイン固有フラグ定義', 'Kill Switch実装', 'フラグ変更ログ記録']
: ['Flag management system chosen', 'Domain-specific flags defined', 'Kill switches implemented', 'Flag change logging']
},
{
cat: G ? '⚖️ 6. Rate Limiting' : '⚖️ 6. Rate Limiting',
items: G
? ['API Rate Limit実装', 'ドメイン別閾値設定', '超過時レスポンス定義', 'ホワイトリスト機能']
: ['API rate limits implemented', 'Domain-specific thresholds set', 'Exceeded response defined', 'Whitelist capability']
},
{
cat: G ? '🎛️ 7. Admin Console' : '🎛️ 7. Admin Console',
items: G
? ['管理画面アクセス制御 (RBAC)', '監査ログ記録', 'Feature Flag切替UI', '緊急停止機能']
: ['Admin console access control (RBAC)', 'Audit logging', 'Feature flag toggle UI', 'Emergency stop feature']
},
// 復旧 (Recovery) - 3 categories
{
cat: G ? '💾 8. バックアップ' : '💾 8. Backup',
items: G
? ['自動バックアップ設定', 'RPO/RTO定義文書化', 'バックアップ検証手順', 'オフサイト保存']
: ['Automated backup configured', 'RPO/RTO documented', 'Backup verification procedure', 'Off-site storage']
},
{
cat: G ? '🔄 9. リストア手順' : '🔄 9. Restore Procedure',
items: G
? ['リストアRunbook作成', 'PITR手順文書化', 'リストアテスト実施済み', 'RTO目標達成確認']
: ['Restore runbook created', 'PITR procedure documented', 'Restore test completed', 'RTO target verified']
},
{
cat: G ? '🚨 10. インシデント対応' : '🚨 10. Incident Response',
items: G
? ['対応フロー定義 (docs/34参照)', 'オンコール体制', 'エスカレーション基準', 'ポストモーテムプロセス']
: ['Response flow defined (see docs/34)', 'On-call rotation', 'Escalation criteria', 'Post-mortem process']
},
// ガバナンス (Governance) - 2 categories
{
cat: G ? '📝 11. 変更管理' : '📝 11. Change Management',
items: G
? ['デプロイ承認プロセス', 'Canary/Blue-Green戦略', 'ロールバック手順', '変更ログ記録']
: ['Deploy approval process', 'Canary/Blue-Green strategy', 'Rollback procedure', 'Change log recording']
},
{
cat: G ? '🔐 12. セキュリティ監査' : '🔐 12. Security Audit',
items: G
? ['OWASP Top 10対策確認 (docs/48参照)', 'シークレット管理検証', 'アクセスログ監視', '定期脆弱性スキャン']
: ['OWASP Top 10 mitigations verified (see docs/48)', 'Secrets management validated', 'Access log monitoring', 'Regular vulnerability scans']
}
];
capabilities.forEach(cap => {
checklist += `### ${cap.cat}\n\n`;
cap.items.forEach(item => {
checklist += `- [ ] ${item}\n`;
});
checklist += '\n';
});
// Domain-Specific Hardening
checklist += `## ${G ? 'ドメイン固有強化項目' : 'Domain-Specific Hardening'}\n\n`;
checklist += G ? `**${domain}ドメイン** の追加要件:\n\n` : `**${domain} Domain** additional requirements:\n\n`;
const hardening = G ? ops.hardening_ja : ops.hardening_en;
hardening.forEach((item, i) => {
checklist += `- [ ] ${item}\n`;
});
checklist += '\n';
// Admin Console Security
checklist += `## ${G ? 'Admin Console セキュリティ' : 'Admin Console Security'}\n\n`;
checklist += G
? `**原則**: 管理機能は最強の攻撃面。通常ユーザーと同じ認証フローではなく、追加の保護層が必要。\n\n`
: `**Principle**: Admin features are the strongest attack surface. They require additional protection layers beyond normal user auth.\n\n`;
checklist += G
? `- [ ] **多要素認証 (MFA) 必須**: 管理者アカウントは全員MFA有効化\n`
: `- [ ] **MFA Mandatory**: All admin accounts must have MFA enabled\n`;
checklist += G
? `- [ ] **IP制限**: 管理画面アクセスを社内IP/VPNに制限\n`
: `- [ ] **IP Restriction**: Limit admin console access to office IP/VPN\n`;
checklist += G
? `- [ ] **権限分離**: 閲覧者/編集者/管理者の3段階以上\n`
: `- [ ] **Permission Separation**: At least 3 tiers (viewer/editor/admin)\n`;
checklist += G
? `- [ ] **監査ログ**: 全管理操作をログ記録 (who/what/when)\n`
: `- [ ] **Audit Logging**: Log all admin operations (who/what/when)\n`;
checklist += G
? `- [ ] **セッションタイムアウト**: 15分無操作で自動ログアウト\n`
: `- [ ] **Session Timeout**: Auto-logout after 15min inactivity\n`;
checklist += G
? `- [ ] **操作確認**: 破壊的操作 (削除/無効化) は確認ダイアログ必須\n\n`
: `- [ ] **Confirmation Dialog**: Destructive actions (delete/disable) require confirmation\n\n`;
// Monitoring Thresholds
checklist += `## ${G ? 'モニタリング閾値' : 'Monitoring Thresholds'}\n\n`;
checklist += G ? `**${domain}ドメイン** のデフォルトアラート設定:\n\n` : `**${domain} Domain** default alert settings:\n\n`;
checklist += G
? `| メトリクス | Warning | Critical | アクション |\n|----------|---------|----------|----------|\n`
: `| Metric | Warning | Critical | Action |\n|--------|---------|----------|--------|\n`;
const thresholds = {
fintech: [
{ metric: G ? 'エラー率' : 'Error Rate', warn: '0.1%', crit: '0.5%', action: G ? 'Kill Switch検討' : 'Consider Kill Switch' },
{ metric: G ? '取引遅延' : 'Txn Latency', warn: '500ms', crit: '1s', action: G ? 'スケール検討' : 'Consider Scaling' },
{ metric: G ? '不正検知スコア' : 'Fraud Score', warn: '5%', crit: '10%', action: G ? '手動レビュー' : 'Manual Review' }
],
education: [
{ metric: G ? 'エラー率' : 'Error Rate', warn: '1%', crit: '3%', action: G ? '調査' : 'Investigate' },
{ metric: G ? '進捗保存失敗' : 'Progress Save Fail', warn: '0.5%', crit: '1%', action: G ? 'バックアップ確認' : 'Check Backup' },
{ metric: G ? 'CDN遅延' : 'CDN Latency', warn: '2s', crit: '5s', action: G ? 'CDN確認' : 'Check CDN' }
],
_default: [
{ metric: G ? 'エラー率' : 'Error Rate', warn: '1%', crit: '5%', action: G ? '調査' : 'Investigate' },
{ metric: G ? 'API遅延 (P95)' : 'API Latency (P95)', warn: '1s', crit: '3s', action: G ? 'スケール検討' : 'Consider Scaling' },
{ metric: G ? 'ディスク使用率' : 'Disk Usage', warn: '80%', crit: '90%', action: G ? 'クリーンアップ' : 'Cleanup' }
]
};
const thresholdsTable = thresholds[domain] || thresholds._default;
thresholdsTable.forEach(t => {
checklist += `| ${t.metric} | ${t.warn} | ${t.crit} | ${t.action} |\n`;
});
checklist += '\n';
checklist += G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n';
checklist += G ? '**運用設計:** ' : '**Ops Design:** ';
checklist += '[Ops Runbook](./53_ops_runbook.md), [Ops Plane Design](./55_ops_plane_design.md)\n\n';
checklist += G ? '**戦略:** ' : '**Strategy:** ';
checklist += '[Operational Excellence](./51_operational_excellence.md), [Industry Blueprint](./48_industry_blueprint.md)\n\n';
checklist += G ? '**品質:** ' : '**Quality:** ';
checklist += '[QA Blueprint](./32_qa_blueprint.md), [Incident Response](./34_incident_response.md)\n\n';
checklist += G
? `## 次のステップ\n\n1. 上記チェックリストを全項目確認\n2. 不足項目は \`docs/34_incident_response.md\` および \`docs/53_ops_runbook.md\` を参照して実装\n3. ステージング環境で障害シミュレーション実施\n4. 本番リリース後、最初の1週間は密に監視\n`
: `## Next Steps\n\n1. Verify all checklist items above\n2. Implement missing items referencing \`docs/34_incident_response.md\` and \`docs/53_ops_runbook.md\`\n3. Run failure simulations in staging environment\n4. Monitor closely for the first week after production release\n`;
S.files['docs/54_ops_checklist.md'] = checklist;
// ── docs/55: Ops Plane Design ──
let opsPlane = `# ${G ? 'Ops Plane 設計書' : 'Ops Plane Design'}\n\n`;
opsPlane += `**${G ? 'プロジェクト' : 'Project'}**: ${S.projectName}  \n`;
opsPlane += `**${G ? '生成日時' : 'Generated'}**: ${new Date().toISOString().split('T')[0]}  \n`;
opsPlane += `**${G ? '対象ドメイン' : 'Domain'}**: ${domain}  \n`;
opsPlane += `**${G ? 'SLO' : 'SLO'}**: ${ops.slo}  \n\n`;
opsPlane += G
? `> **この文書の目的**: DevForge v9は世界で唯一、ドメイン×アーキテクチャ×デプロイ先の組み合わせから **Ops Plane (運用面)** を自動設計します。App Plane (アプリケーション面) とOps Planeの責任分離、12 Ops Capabilities の実装パターン、Circuit Breaker 設計、Dev×Ops AI Agent 分離を含む、実運用を見据えた設計書です。\n\n`
: `> **Purpose of this document**: DevForge v9 is the world's only tool that auto-designs the **Ops Plane** based on Domain × Architecture × Deployment target combinations. This document covers App Plane / Ops Plane responsibility separation, 12 Ops Capabilities implementation patterns, Circuit Breaker design, and Dev×Ops AI Agent separation for production-ready operations.\n\n`;
// § 1. Ops Plane Architecture
opsPlane += `---\n\n## ${G ? '§ 1. Ops Plane アーキテクチャ（深層設計）' : '§ 1. Ops Plane Architecture (Deep Design)'}\n\n`;
opsPlane += G
? `### App Plane vs Ops Plane の分離原則\n\n**参考**: 「アプリケーションに運用の仕組みを内蔵させる」(12 Ops Capabilities / Ops Plane設計)\n\n- **App Plane**: ビジネスロジック・UI・API・データモデル\n- **Ops Plane**: 監視・制御・復旧・ガバナンス\n\n分離により、**運用変更がアプリコードに影響しない** 設計を実現。\n\n`
: `### App Plane vs Ops Plane Separation Principles\n\n**Reference**: "Build Operations into Applications" (12 Ops Capabilities / Ops Plane Design)\n\n- **App Plane**: Business logic, UI, API, Data model\n- **Ops Plane**: Observation, Control, Recovery, Governance\n\nSeparation ensures **operational changes don't affect app code**.\n\n`;
// Mermaid diagram
opsPlane += '```mermaid\n';
opsPlane += 'graph TB\n';
opsPlane += '  subgraph Observation\n';
opsPlane += '    O1[Logs] --> O2[Metrics]\n';
opsPlane += '    O2 --> O3[Traces]\n';
opsPlane += '    O3 --> O4[Business Analytics]\n';
opsPlane += '  end\n';
opsPlane += '  subgraph Control\n';
opsPlane += '    C1[Feature Flags] --> C2[Circuit Breaker]\n';
opsPlane += '    C2 --> C3[Rate Limiting]\n';
opsPlane += '  end\n';
opsPlane += '  subgraph Recovery\n';
opsPlane += '    R1[Job Retry] --> R2[Data Recovery]\n';
opsPlane += '    R2 --> R3[Backup Validation]\n';
opsPlane += '  end\n';
opsPlane += '  subgraph Governance\n';
opsPlane += '    G1[Audit Log] --> G2[RBAC+Approval]\n';
opsPlane += '  end\n';
opsPlane += '  Observation --> Control\n';
opsPlane += '  Control --> Recovery\n';
opsPlane += '  Recovery --> Governance\n';
opsPlane += '```\n\n';
// Built-in vs External decision framework
opsPlane += G
? `### 内蔵 vs 外付け 判断フレーム\n\n| 機能 | 内蔵推奨 | 外付け推奨 | 理由 |\n|------|---------|-----------|------|\n| Feature Flag | ✅ | | アプリケーションロジックと密結合 |\n| Kill Switch | ✅ | | 緊急停止は最速レスポンス必須 |\n| Rate Limiting | ✅ | △ | BaaS: Edge Function, Traditional: アプリ層 + CDN/LB |\n| Logs | | ✅ | 集約・分析は外部サービスが高機能 |\n| SIEM | | ✅ | セキュリティ分析は専門ツール必須 |\n| Backup | △ | ✅ | BaaS: プロバイダ機能、Traditional: 自前設計 |\n\n`
: `### Built-in vs External Decision Framework\n\n| Feature | Built-in | External | Reason |\n|---------|----------|----------|--------|\n| Feature Flag | ✅ | | Tightly coupled with app logic |\n| Kill Switch | ✅ | | Emergency stop requires fastest response |\n| Rate Limiting | ✅ | △ | BaaS: Edge Function, Traditional: App layer + CDN/LB |\n| Logs | | ✅ | Aggregation & analysis require external services |\n| SIEM | | ✅ | Security analysis needs specialized tools |\n| Backup | △ | ✅ | BaaS: provider feature, Traditional: self-designed |\n\n`;
// Domain-specific Ops Plane priority
opsPlane += G
? `### ドメイン別 Ops Plane 優先度\n\n| ドメイン | 最優先層 | 理由 |\n|---------|---------|------|\n| fintech | Governance | 監査ログ・承認フローが規制要件 |\n| ec | Control | Feature Flag でキャンペーン制御 |\n| health | Governance | PHI アクセス監査必須 |\n| education | Observation | 学習分析がビジネス価値直結 |\n| portfolio | Recovery | データロストはキャリア損失 |\n\n`
: `### Domain-Specific Ops Plane Priority\n\n| Domain | Top Priority | Reason |\n|--------|--------------|--------|\n| fintech | Governance | Audit log & approval flow for regulations |\n| ec | Control | Feature flags for campaign control |\n| health | Governance | PHI access audit required |\n| education | Observation | Learning analytics = direct business value |\n| portfolio | Recovery | Data loss = career loss |\n\n`;
// § 2. 12 Ops Capabilities Implementation Guide
opsPlane += `---\n\n## ${G ? '§ 2. 12 Ops Capabilities 実装ガイド' : '§ 2. 12 Ops Capabilities Implementation Guide'}\n\n`;
opsPlane += G
? `> **参照**: \`docs/54_ops_checklist.md\` はチェックリスト形式。本セクションは実装パターンを詳述。\n\n`
: `> **Reference**: \`docs/54_ops_checklist.md\` provides a checklist. This section details implementation patterns.\n\n`;
// Observation Capabilities
opsPlane += `### ${G ? 'Observation Layer (Cap 1-4)' : 'Observation Layer (Cap 1-4)'}\n\n`;
opsPlane += G
? `**Cap 1: ログ集約**\n- **BaaS**: Vercel Log Drains → Datadog/Axiom\n- **Traditional**: Winston/Pino → Elasticsearch/Loki\n- **構造化ログ例**: \`{ timestamp, level, service, traceId, userId, action, result, duration }\`\n\n`
: `**Cap 1: Log Aggregation**\n- **BaaS**: Vercel Log Drains → Datadog/Axiom\n- **Traditional**: Winston/Pino → Elasticsearch/Loki\n- **Structured log example**: \`{ timestamp, level, service, traceId, userId, action, result, duration }\`\n\n`;
opsPlane += G
? `**Cap 2: メトリクス (RED Method)**\n- **Rate** (req/sec): ドメイン別正常範囲 (fintech: 100-500, ec: 200-1000)\n- **Errors** (error %): SLO 閾値から自動導出 (99.99% → 0.01% error budget)\n- **Duration** (p50/p95/p99): スタック別ベースライン (Next.js SSR: p95 < 500ms)\n\n`
: `**Cap 2: Metrics (RED Method)**\n- **Rate** (req/sec): Domain-specific normal range (fintech: 100-500, ec: 200-1000)\n- **Errors** (error %): Auto-derived from SLO threshold (99.99% → 0.01% error budget)\n- **Duration** (p50/p95/p99): Stack-specific baseline (Next.js SSR: p95 < 500ms)\n\n`;
opsPlane += G
? `**Cap 3: 分散トレーシング**\n- **BaaS**: Vercel + OpenTelemetry → Honeycomb\n- **Traditional**: OpenTelemetry SDK + Jaeger/Tempo\n- **重点トレース**: 決済フロー (fintech/ec)、PHI アクセス (health)、認証 (all)\n\n`
: `**Cap 3: Distributed Tracing**\n- **BaaS**: Vercel + OpenTelemetry → Honeycomb\n- **Traditional**: OpenTelemetry SDK + Jaeger/Tempo\n- **Key traces**: Payment flow (fintech/ec), PHI access (health), Auth (all)\n\n`;
opsPlane += G
? `**Cap 4: ビジネス分析**\n- **ドメイン別 KPI メトリクス**:\n  - fintech: 取引成功率、不正検知率\n  - education: 学習完了率、エンゲージメント時間\n  - ec: カート放棄率、決済成功率\n\n`
: `**Cap 4: Business Analytics**\n- **Domain-specific KPI metrics**:\n  - fintech: Transaction success rate, fraud detection rate\n  - education: Course completion rate, engagement time\n  - ec: Cart abandonment rate, payment success rate\n\n`;
// Control Capabilities
opsPlane += `### ${G ? 'Control Layer (Cap 5-7)' : 'Control Layer (Cap 5-7)'}\n\n`;
opsPlane += G
? `**Cap 5: Feature Flag**\n- **env var vs DB vs External Service 比較**:\n\n| 方式 | デプロイ不要 | 動的切替 | ユーザー別 | 推奨ケース |\n|------|------------|---------|----------|----------|\n| env var | ✗ | ✗ | ✗ | 開発環境のみ |\n| DB | ✓ | ✓ | △ | BaaS (Supabase RLS) |\n| External (LaunchDarkly) | ✓ | ✓ | ✓ | エンタープライズ |\n\n`
: `**Cap 5: Feature Flag**\n- **env var vs DB vs External Service comparison**:\n\n| Method | No Deploy | Dynamic | Per-User | Recommended Use |\n|--------|-----------|---------|----------|------------------|\n| env var | ✗ | ✗ | ✗ | Dev environment only |\n| DB | ✓ | ✓ | △ | BaaS (Supabase RLS) |\n| External (LaunchDarkly) | ✓ | ✓ | ✓ | Enterprise |\n\n`;
opsPlane += G
? `**Cap 6: Kill Switch / Circuit Breaker** (§ 3 で詳述)\n\n`
: `**Cap 6: Kill Switch / Circuit Breaker** (detailed in § 3)\n\n`;
opsPlane += G
? `**Cap 7: Rate Limiting**\n- **Token Bucket vs Sliding Window 比較**:\n\n| 方式 | バースト許容 | 実装複雑度 | 推奨ユースケース |\n|------|------------|-----------|----------------|\n| Token Bucket | ✓ | 低 | API 一般保護 |\n| Sliding Window | ✗ | 中 | 厳密な分単位制限 |\n\n- **スタック別実装**: BaaS (Upstash Rate Limit), Traditional (Express middleware + Redis)\n\n`
: `**Cap 7: Rate Limiting**\n- **Token Bucket vs Sliding Window comparison**:\n\n| Method | Burst Allow | Complexity | Recommended Use |\n|--------|-------------|------------|------------------|\n| Token Bucket | ✓ | Low | General API protection |\n| Sliding Window | ✗ | Medium | Strict per-minute limits |\n\n- **Stack-specific impl**: BaaS (Upstash Rate Limit), Traditional (Express middleware + Redis)\n\n`;
// Recovery Capabilities
opsPlane += `### ${G ? 'Recovery Layer (Cap 8-10)' : 'Recovery Layer (Cap 8-10)'}\n\n`;
opsPlane += G
? `**Cap 8: ジョブ再実行**\n- **DLQ + Exponential Backoff パターン**:\n  - 初回: 即座\n  - 2回目: 1分後\n  - 3回目: 5分後\n  - 4回目以降: DLQ (Dead Letter Queue) へ\n- **スタック別実装**: BaaS (Inngest/Trigger.dev), Traditional (BullMQ)\n\n`
: `**Cap 8: Job Retry**\n- **DLQ + Exponential Backoff pattern**:\n  - 1st: Immediate\n  - 2nd: After 1 min\n  - 3rd: After 5 min\n  - 4th+: Move to DLQ (Dead Letter Queue)\n- **Stack-specific impl**: BaaS (Inngest/Trigger.dev), Traditional (BullMQ)\n\n`;
opsPlane += G
? `**Cap 9: データリカバリ**\n- **Soft Delete + Event Replay パターン**:\n  - 削除は \`deleted_at\` フラグのみ (物理削除しない)\n  - イベントソーシング活用時は過去の状態を再現可能\n- **復旧手順**: \`UPDATE SET deleted_at = NULL WHERE id = ?;\` (管理画面 + 4-eyes 承認必須)\n\n`
: `**Cap 9: Data Recovery**\n- **Soft Delete + Event Replay pattern**:\n  - Deletion = \`deleted_at\` flag only (no physical delete)\n  - Event sourcing enables past state reconstruction\n- **Recovery procedure**: \`UPDATE SET deleted_at = NULL WHERE id = ?;\` (Admin UI + 4-eyes approval required)\n\n`;
opsPlane += G
? `**Cap 10: バックアップ検証**\n- **自動リストアテスト (CI統合)**:\n  - 週次: ステージング環境で最新バックアップから復元\n  - 検証項目: データ整合性、FK制約、パフォーマンス\n- **RPO/RTO**: \`docs/53_ops_runbook.md\` 参照 (ドメイン別要件)\n\n`
: `**Cap 10: Backup Validation**\n- **Automated restore testing (CI integration)**:\n  - Weekly: Restore from latest backup in staging\n  - Validation: Data integrity, FK constraints, performance\n- **RPO/RTO**: See \`docs/53_ops_runbook.md\` (domain-specific requirements)\n\n`;
// Governance Capabilities
opsPlane += `### ${G ? 'Governance Layer (Cap 11-12)' : 'Governance Layer (Cap 11-12)'}\n\n`;
opsPlane += G
? `**Cap 11: 監査ログ** (§ 4 で詳述)\n\n`
: `**Cap 11: Audit Log** (detailed in § 4)\n\n`;
opsPlane += G
? `**Cap 12: RBAC + 承認フロー** (§ 6 で詳述)\n\n`
: `**Cap 12: RBAC + Approval Flow** (detailed in § 6)\n\n`;
// § 3. Circuit Breaker
opsPlane += `---\n\n## ${G ? '§ 3. Circuit Breaker / Graceful Degradation' : '§ 3. Circuit Breaker / Graceful Degradation'}\n\n`;
// Mermaid state diagram
opsPlane += '```mermaid\n';
opsPlane += 'stateDiagram-v2\n';
opsPlane += '  [*] --> Closed\n';
opsPlane += '  Closed --> Open : Failure threshold exceeded\n';
opsPlane += '  Open --> HalfOpen : Timeout elapsed\n';
opsPlane += '  HalfOpen --> Closed : Success\n';
opsPlane += '  HalfOpen --> Open : Failure\n';
opsPlane += '```\n\n';
// Auto-derive thresholds from SLO
const cbThresholds = {
'99.99%': { fail: 3, window: '10s', timeout: '30s' },
'99.9%': { fail: 5, window: '30s', timeout: '45s' },
'99.5%': { fail: 5, window: '60s', timeout: '60s' },
'99%': { fail: 10, window: '60s', timeout: '60s' }
};
const cbThreshold = cbThresholds[ops.slo] || cbThresholds['99%'];
opsPlane += G
? `### ドメイン別閾値 (SLO から自動導出)\n\n**${domain} (SLO: ${ops.slo})**\n- 失敗回数閾値: ${cbThreshold.fail} 回\n- 監視ウィンドウ: ${cbThreshold.window}\n- タイムアウト: ${cbThreshold.timeout}\n\n`
: `### Domain-Specific Thresholds (Auto-derived from SLO)\n\n**${domain} (SLO: ${ops.slo})**\n- Failure threshold: ${cbThreshold.fail} failures\n- Monitoring window: ${cbThreshold.window}\n- Timeout: ${cbThreshold.timeout}\n\n`;
// Fallback strategies
opsPlane += G
? `### フォールバック戦略テーブル\n\n| ドメイン | フォールバック戦略 | 例 |\n|---------|------------------|----|\n| fintech | Queue → Retry | 決済失敗時キューイング + 非同期リトライ |\n| ec | Cached Price | 在庫APIダウン時、最終価格表示 + 注文保留 |\n| education | Offline Mode | 動画視聴オフライン、進捗は再接続時同期 |\n| health | Read-only Mode | 書き込みAPI停止、参照のみ許可 |\n\n`
: `### Fallback Strategy Table\n\n| Domain | Fallback Strategy | Example |\n|--------|-------------------|----------|\n| fintech | Queue → Retry | Queue payment failures + async retry |\n| ec | Cached Price | Display last price when inventory API down + hold order |\n| education | Offline Mode | Video playback offline, sync progress on reconnect |\n| health | Read-only Mode | Stop write API, allow read-only access |\n\n`;
// Implementation pattern
opsPlane += G
? `### 実装パターン\n\n**BaaS**: Edge Function timeout + retry\n- Vercel: \`maxDuration: 60\` + Inngest retry policy\n\n**Traditional**: opossum (Node.js) / resilience4j (Java)\n\`\`\`javascript\nconst breaker = new CircuitBreaker(externalAPI, {\n  timeout: ${cbThreshold.timeout.replace('s', '000')},\n  errorThresholdPercentage: 50,\n  resetTimeout: 30000\n});\n\`\`\`\n\n`
: `### Implementation Pattern\n\n**BaaS**: Edge Function timeout + retry\n- Vercel: \`maxDuration: 60\` + Inngest retry policy\n\n**Traditional**: opossum (Node.js) / resilience4j (Java)\n\`\`\`javascript\nconst breaker = new CircuitBreaker(externalAPI, {\n  timeout: ${cbThreshold.timeout.replace('s', '000')},\n  errorThresholdPercentage: 50,\n  resetTimeout: 30000\n});\n\`\`\`\n\n`;
// § 4. Evidence-Based Operations
opsPlane += `---\n\n## ${G ? '§ 4. Evidence-Based Operations (証拠ベース運用)' : '§ 4. Evidence-Based Operations'}\n\n`;
opsPlane += G
? `### AuditEvent スキーマ\n\n\`\`\`typescript\ninterface AuditEvent {\n  run_id: string;        // 操作セッションID\n  actor: string;         // ユーザーID or AgentID\n  action: string;        // CREATE/UPDATE/DELETE/EXECUTE\n  target: string;        // 対象リソース (table.id)\n  result: 'success' | 'failure';\n  metadata: Record<string, any>; // ドメイン固有フィールド\n  ip: string;\n  user_agent: string;\n  timestamp: Date;\n}\n\`\`\`\n\n`
: `### AuditEvent Schema\n\n\`\`\`typescript\ninterface AuditEvent {\n  run_id: string;        // Operation session ID\n  actor: string;         // UserID or AgentID\n  action: string;        // CREATE/UPDATE/DELETE/EXECUTE\n  target: string;        // Target resource (table.id)\n  result: 'success' | 'failure';\n  metadata: Record<string, any>; // Domain-specific fields\n  ip: string;\n  user_agent: string;\n  timestamp: Date;\n}\n\`\`\`\n\n`;
// Domain-specific required audit fields
opsPlane += G
? `### ドメイン別必須証跡フィールド\n\n| ドメイン | metadata 必須フィールド | コンプライアンス対応 |\n|---------|---------------------|------------------|\n| fintech | amount, currency, transaction_id | PCI DSS, SOX |\n| health | patient_id, PHI_flag, access_reason | HIPAA |\n| legal | contract_id, version, signatory | 電子契約法 |\n| ec | order_id, payment_method | 特定商取引法 |\n\n`
: `### Domain-Specific Required Audit Fields\n\n| Domain | Required metadata fields | Compliance |\n|--------|------------------------|-------------|\n| fintech | amount, currency, transaction_id | PCI DSS, SOX |\n| health | patient_id, PHI_flag, access_reason | HIPAA |\n| legal | contract_id, version, signatory | Digital Contract Law |\n| ec | order_id, payment_method | Consumer Protection Law |\n\n`;
// Implementation pattern
opsPlane += G
? `### 実装パターン\n\n**BaaS (Supabase)**:\n\`\`\`sql\nCREATE TABLE audit_events (...) WITH (oids = false);\nCREATE POLICY "Admin read audit" ON audit_events FOR SELECT USING (auth.role() = 'admin');\n-- Trigger: INSERT時に自動記録\n\`\`\`\n\n**Traditional (Express)**:\n\`\`\`javascript\napp.use((req, res, next) => {\n  res.on('finish', () => {\n    db.audit_events.insert({\n      run_id: req.headers['x-run-id'],\n      actor: req.user?.id || 'anonymous',\n      action: req.method,\n      target: req.path,\n      result: res.statusCode < 400 ? 'success' : 'failure',\n      metadata: { body: req.body },\n      ip: req.ip,\n      user_agent: req.headers['user-agent'],\n      timestamp: new Date()\n    });\n  });\n  next();\n});\n\`\`\`\n\n`
: `### Implementation Pattern\n\n**BaaS (Supabase)**:\n\`\`\`sql\nCREATE TABLE audit_events (...) WITH (oids = false);\nCREATE POLICY "Admin read audit" ON audit_events FOR SELECT USING (auth.role() = 'admin');\n-- Trigger: Auto-record on INSERT\n\`\`\`\n\n**Traditional (Express)**:\n\`\`\`javascript\napp.use((req, res, next) => {\n  res.on('finish', () => {\n    db.audit_events.insert({\n      run_id: req.headers['x-run-id'],\n      actor: req.user?.id || 'anonymous',\n      action: req.method,\n      target: req.path,\n      result: res.statusCode < 400 ? 'success' : 'failure',\n      metadata: { body: req.body },\n      ip: req.ip,\n      user_agent: req.headers['user-agent'],\n      timestamp: new Date()\n    });\n  });\n  next();\n});\n\`\`\`\n\n`;
// Retention policy
opsPlane += G
? `### 保持期間 × コンプライアンス\n\n| ドメイン | 最低保持期間 | 根拠法令 | 参照 |\n|---------|------------|---------|------|\n| fintech | 7年 | 法人税法、PCI DSS | \`docs/45_compliance_matrix.md\` |\n| health | 5年 (未成年は20歳まで) | 医療法 | \`docs/45_compliance_matrix.md\` |\n| legal | 10年 | 民法 | \`docs/45_compliance_matrix.md\` |\n| ec | 2年 | 特定商取引法 | \`docs/45_compliance_matrix.md\` |\n\n`
: `### Retention Period × Compliance\n\n| Domain | Min Retention | Legal Basis | Reference |\n|--------|--------------|-------------|------------|\n| fintech | 7 years | Corporate Tax Law, PCI DSS | \`docs/45_compliance_matrix.md\` |\n| health | 5 years (minors until age 20) | Medical Care Act | \`docs/45_compliance_matrix.md\` |\n| legal | 10 years | Civil Code | \`docs/45_compliance_matrix.md\` |\n| ec | 2 years | Consumer Protection Law | \`docs/45_compliance_matrix.md\` |\n\n`;
// § 5. Dev × Ops AI Responsibility Separation
opsPlane += `---\n\n## ${G ? '§ 5. Dev × Ops AI 責任分離マトリクス' : '§ 5. Dev × Ops AI Responsibility Separation Matrix'}\n\n`;
opsPlane += G
? `> **参考**: 「OpenClawとはセルフホスト型パーソナルAIアシスタントエージェント」(Dev×Ops責任分離)\n\n`
: `> **Reference**: "OpenClaw Self-Hosted Personal AI Assistant Agent" (Dev×Ops Responsibility Separation)\n\n`;
// Mermaid diagram
opsPlane += '```mermaid\n';
opsPlane += 'graph LR\n';
opsPlane += '  DevAgent[Dev Agent<br/>Claude Code] -->|Code/Test/PR| SharedContract[Shared Contract<br/>.spec/ + CLAUDE.md<br/>docs/53-55]\n';
opsPlane += '  OpsAgent[Ops Agent<br/>Human/AI] -->|Monitor/Flag/Incident| SharedContract\n';
opsPlane += '  SharedContract -->|Spec| DevAgent\n';
opsPlane += '  SharedContract -->|SLO/Runbook| OpsAgent\n';
opsPlane += '```\n\n';
// Responsibility table
opsPlane += G
? `### 責任分担テーブル\n\n| 責務 | Dev Agent (Claude Code) | Ops Agent (Human/AI) | 共有契約 |\n|------|------------------------|---------------------|----------|\n| 機能実装 | ✅ | | .spec/tasks.md |\n| テスト作成 | ✅ | | docs/36_test_strategy.md |\n| コードレビュー | ✅ | | .cursor/rules |\n| バグ修正 | ✅ | | docs/37_bug_prevention.md |\n| モニタリング | | ✅ | docs/53_ops_runbook.md |\n| Feature Flag 操作 | | ✅ | docs/53_ops_runbook.md |\n| インシデント対応 | | ✅ | docs/34_incident_response.md |\n| バックアップ検証 | | ✅ | docs/54_ops_checklist.md |\n| SLO 定義 | | ✅ | docs/53_ops_runbook.md |\n| 破壊的操作 (DELETE) | | ✅ (4-eyes) | CLAUDE.md (permission) |\n\n`
: `### Responsibility Table\n\n| Responsibility | Dev Agent (Claude Code) | Ops Agent (Human/AI) | Shared Contract |\n|----------------|------------------------|---------------------|------------------|\n| Feature Impl | ✅ | | .spec/tasks.md |\n| Test Creation | ✅ | | docs/36_test_strategy.md |\n| Code Review | ✅ | | .cursor/rules |\n| Bug Fix | ✅ | | docs/37_bug_prevention.md |\n| Monitoring | | ✅ | docs/53_ops_runbook.md |\n| Feature Flag Ops | | ✅ | docs/53_ops_runbook.md |\n| Incident Response | | ✅ | docs/34_incident_response.md |\n| Backup Validation | | ✅ | docs/54_ops_checklist.md |\n| SLO Definition | | ✅ | docs/53_ops_runbook.md |\n| Destructive Ops (DELETE) | | ✅ (4-eyes) | CLAUDE.md (permission) |\n\n`;
// CLAUDE.md bloat prevention
opsPlane += G
? `### CLAUDE.md 肥大化防止パターン\n\n**v9.3.0 3-layer split 戦略**:\n1. **CLAUDE.md (薄いルート)**: ~1.5K tokens (プロジェクト概要のみ)\n2. **\`.claude/rules/\` (パス別ルール)**: spec.md / frontend.md / backend.md / test.md / ops.md\n3. **\`.claude/settings.json\`**: パーミッション・危険コマンド警告\n\n**自動ロード**: Claude Code が \`docs/53-55\` を編集 → \`.claude/rules/ops.md\` が自動的にコンテキスト注入\n\n`
: `### CLAUDE.md Bloat Prevention Pattern\n\n**v9.3.0 3-layer split strategy**:\n1. **CLAUDE.md (thin root)**: ~1.5K tokens (project overview only)\n2. **\`.claude/rules/\` (path-specific rules)**: spec.md / frontend.md / backend.md / test.md / ops.md\n3. **\`.claude/settings.json\`**: Permissions, dangerous command warnings\n\n**Auto-load**: Claude Code edits \`docs/53-55\` → \`.claude/rules/ops.md\` auto-injected to context\n\n`;
// Skills utilization
opsPlane += G
? `### Skills の活用指針\n\n- **Manus Skills 形式** (\`skills/\` ディレクトリ) を活用し、反復タスクを自動化\n- **agents/** サブディレクトリで Coordinator/Reviewer エージェントを定義\n- **skill_map.md**: スキル間の依存関係マップ\n\n**参照**: \`docs/42_skill_guide.md\`, \`skills/project.md\`\n\n`
: `### Skills Utilization Guidelines\n\n- Use **Manus Skills format** (\`skills/\` directory) to automate repetitive tasks\n- Define Coordinator/Reviewer agents in **agents/** subdirectory\n- **skill_map.md**: Inter-skill dependency map\n\n**Reference**: \`docs/42_skill_guide.md\`, \`skills/project.md\`\n\n`;
// Safety boundaries
opsPlane += G
? `### 安全境界\n\n**サンドボックス**: Dev Agent は \`src/\` 配下のみ編集可 (Ops Agent は全体)\n\n**パーミッション** (\`.claude/settings.json\`):\n- \`"disallowedCommands": ["rm -rf", "DROP TABLE", "git push --force main"]\`\n- \`"requireConfirmation": ["git push", "npm publish", "kubectl delete"]\`\n\n**危険コマンド確認リスト** (→ \`.claude/settings.json\` 参照):\n- git reset --hard\n- git clean -f\n- docker system prune -a\n\n`
: `### Safety Boundaries\n\n**Sandbox**: Dev Agent can only edit \`src/\` (Ops Agent: full access)\n\n**Permissions** (\`.claude/settings.json\`):\n- \`"disallowedCommands": ["rm -rf", "DROP TABLE", "git push --force main"]\`\n- \`"requireConfirmation": ["git push", "npm publish", "kubectl delete"]\`\n\n**Dangerous Command Confirmation List** (→ see \`.claude/settings.json\`):\n- git reset --hard\n- git clean -f\n- docker system prune -a\n\n`;
// § 6. Admin Console Architecture
opsPlane += `---\n\n## ${G ? '§ 6. Admin Console アーキテクチャ' : '§ 6. Admin Console Architecture'}\n\n`;
opsPlane += G
? `> **警告**: Admin Console = 最大の攻撃面。実装は慎重に。\n\n`
: `> **Warning**: Admin Console = largest attack surface. Implement carefully.\n\n`;
// RBAC 4-tier model
opsPlane += G
? `### RBAC 4段階モデル\n\n| Role | 権限 | 例 |\n|------|------|----|\n| Viewer | 参照のみ | ダッシュボード閲覧、ログ検索 |\n| Operator | 非破壊的操作 | Feature Flag ON/OFF、ジョブ再実行 |\n| Admin | 破壊的操作 (4-eyes) | ユーザー削除、データ復元 |\n| SuperAdmin | システム設定変更 | RBAC変更、バックアップ削除 |\n\n`
: `### RBAC 4-Tier Model\n\n| Role | Permissions | Examples |\n|------|-------------|----------|\n| Viewer | Read-only | Dashboard view, log search |\n| Operator | Non-destructive ops | Feature Flag ON/OFF, job retry |\n| Admin | Destructive ops (4-eyes) | User delete, data recovery |\n| SuperAdmin | System config changes | RBAC change, backup delete |\n\n`;
// 4-eyes approval pattern
opsPlane += G
? `### 4-eyes 承認パターン\n\n破壊的操作 (DELETE, DROP, TRUNCATE) は **2名承認必須**:\n\n1. Operator が操作リクエスト作成\n2. Admin が承認\n3. 自動実行 or 手動実行 (操作種別による)\n4. 監査ログに run_id 記録\n\n**実装例** (BaaS):\n\`\`\`sql\nCREATE TABLE approval_requests (\n  id UUID PRIMARY KEY,\n  requester_id UUID NOT NULL,\n  approver_id UUID,\n  action TEXT NOT NULL,\n  target TEXT NOT NULL,\n  status TEXT DEFAULT 'pending',\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\`\`\`\n\n`
: `### 4-Eyes Approval Pattern\n\nDestructive ops (DELETE, DROP, TRUNCATE) require **2-person approval**:\n\n1. Operator creates operation request\n2. Admin approves\n3. Auto-execute or manual execute (depends on operation type)\n4. Record run_id in audit log\n\n**Implementation example** (BaaS):\n\`\`\`sql\nCREATE TABLE approval_requests (\n  id UUID PRIMARY KEY,\n  requester_id UUID NOT NULL,\n  approver_id UUID,\n  action TEXT NOT NULL,\n  target TEXT NOT NULL,\n  status TEXT DEFAULT 'pending',\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\`\`\`\n\n`;
// Domain-specific admin features
opsPlane += G
? `### ドメイン別 Admin 機能テーブル\n\n| ドメイン | 必須機能 | セキュリティ要件 |\n|---------|---------|----------------|\n| fintech | 取引管理、不正検知ダッシュボード | MFA必須、IP制限 |\n| health | PHI アクセスログ、患者データ匿名化 | HIPAA準拠、監査証跡 |\n| ec | 在庫オーバーライド、返金処理 | 承認フロー、金額上限 |\n| education | 学習進捗管理、証明書発行 | FERPA準拠、保護者同意 |\n\n`
: `### Domain-Specific Admin Features Table\n\n| Domain | Required Features | Security Requirements |\n|--------|-------------------|----------------------|\n| fintech | Transaction mgmt, fraud detection dashboard | MFA required, IP restriction |\n| health | PHI access log, patient data anonymization | HIPAA compliant, audit trail |\n| ec | Inventory override, refund processing | Approval flow, amount limit |\n| education | Learning progress mgmt, certificate issuance | FERPA compliant, parental consent |\n\n`;
// Security hardening checklist
opsPlane += G
? `### セキュリティ強化チェックリスト\n\n- [ ] **MFA 必須** (Admin 以上)\n- [ ] **IP 制限** (オフィス IP のみ許可)\n- [ ] **セッションタイムアウト**: 15分\n- [ ] **確認ダイアログ**: 破壊的操作は「DELETE」と入力必須\n- [ ] **監査ログ**: 全操作を \`audit_events\` に記録\n- [ ] **RLS (Row Level Security)**: Supabase 利用時は role 別にポリシー設定\n- [ ] **Rate Limiting**: Admin API も保護 (100 req/min)\n\n`
: `### Security Hardening Checklist\n\n- [ ] **MFA required** (Admin and above)\n- [ ] **IP restriction** (office IP only)\n- [ ] **Session timeout**: 15 minutes\n- [ ] **Confirmation dialog**: Type \"DELETE\" for destructive ops\n- [ ] **Audit log**: Record all ops in \`audit_events\`\n- [ ] **RLS (Row Level Security)**: Set role-based policies in Supabase\n- [ ] **Rate Limiting**: Protect Admin API too (100 req/min)\n\n`;
// Related documents
opsPlane += `---\n\n## ${G ? '📚 関連ドキュメント' : '📚 Related Documents'}\n\n`;
opsPlane += G ? '**運用設計:** ' : '**Ops Design:** ';
opsPlane += '[Ops Runbook](./53_ops_runbook.md), [Ops Checklist](./54_ops_checklist.md)\n\n';
opsPlane += G ? '**戦略:** ' : '**Strategy:** ';
opsPlane += '[Operational Excellence](./51_operational_excellence.md), [Market Positioning](./56_market_positioning.md)\n\n';
opsPlane += G ? '**UX:** ' : '**UX:** ';
opsPlane += '[User Experience Strategy](./57_user_experience_strategy.md)\n\n';
// Final notes
opsPlane += `---\n\n## ${G ? '次のステップ' : 'Next Steps'}\n\n`;
opsPlane += G
? `1. **\`docs/53_ops_runbook.md\` を熟読** — SLO/SLI、Feature Flags、Observability スタックの詳細\n2. **\`docs/54_ops_checklist.md\` で準備状況確認** — 12 Ops Capabilities の実装状況をチェック\n3. **Admin Console を実装** — RBAC + 4-eyes 承認 + 監査ログ\n4. **ステージング環境で障害シミュレーション実施**\n5. **本番デプロイ前に SRE レビュー** (可能なら外部レビュー)\n\n`
: `1. **Read \`docs/53_ops_runbook.md\` thoroughly** — SLO/SLI, Feature Flags, Observability stack details\n2. **Verify readiness with \`docs/54_ops_checklist.md\`** — Check 12 Ops Capabilities implementation status\n3. **Implement Admin Console** — RBAC + 4-eyes approval + audit log\n4. **Run failure simulations in staging**\n5. **SRE review before production deploy** (external review if possible)\n\n`;
opsPlane += G
? `---\n\n**🌍 世界で唯一のポイント**: DevForge v9 は **ドメイン適応型 Ops Plane 設計自動生成エンジン** です。他のジェネレータ (Yeoman, create-t3-app, Projen) は運用設計を一切出力しません。Circuit Breaker をドメイン SLO から自動導出し、Evidence-Based Operations スキーマを「設計時」に定義し、Dev×Ops AI 責任分離マトリクスを生成ドキュメントとして出力する初のツールです。\n`
: `---\n\n**🌍 World's Only Feature**: DevForge v9 is the **Domain-Adaptive Ops Plane Design Auto-Generation Engine**. Other generators (Yeoman, create-t3-app, Projen) do not generate operational design documents. It is the first tool to auto-derive Circuit Breaker thresholds from domain SLO, define Evidence-Based Operations schema at design time, and output Dev×Ops AI responsibility separation matrix as generated documentation.\n`;
S.files['docs/55_ops_plane_design.md'] = opsPlane;
}
// P15: Future Strategy Intelligence Generator
// Generates: docs/56_market_positioning.md, 57_user_experience_strategy.md, 58_ecosystem_strategy.md, 59_regulatory_foresight.md
// ============================================================================
// DATA CONSTANTS
// ============================================================================
// DOMAIN_MARKET: Market positioning & strategy data (32 domains + default)
const DOMAIN_MARKET = {
education: {
moat_ja: 'ネットワーク効果（学習コミュニティ）、データモート（学習分析）',
moat_en: 'Network effects (learning community), Data moat (learning analytics)',
gtm_ja: 'PLG（フリーミアム）+ 学校向けエンタープライズSLG',
gtm_en: 'PLG (freemium) + Enterprise SLG for schools',
ux_ja: 'ゲーミフィケーション、ストリーク維持、修了証、ソーシャル学習',
ux_en: 'Gamification, streak maintenance, certificates, social learning',
eco_ja: 'LTI統合、SSO（学校アカウント）、教材マーケットプレイス',
eco_en: 'LTI integration, SSO (school accounts), content marketplace',
reg_ja: 'FERPA（米）、COPPA（児童）、EU教育データ保護、日本個人情報保護法',
reg_en: 'FERPA (US), COPPA (children), EU education data protection, Japan APPI',
esg_ja: 'デジタル格差解消、アクセシビリティ、オープン教材',
esg_en: 'Digital divide reduction, accessibility, open educational resources'
},
ec: {
moat_ja: 'データモート（購買行動）、スイッチングコスト（ウィッシュリスト）',
moat_en: 'Data moat (purchase behavior), Switching costs (wishlists)',
gtm_ja: 'マーケットプレイス型PLG + SEO/SNS広告',
gtm_en: 'Marketplace PLG + SEO/social ads',
ux_ja: 'ウィッシュリスト、レコメンド、ワンクリック決済、リピート購入割引',
ux_en: 'Wishlists, recommendations, one-click checkout, repeat discounts',
eco_ja: '配送API統合、決済プロバイダ、在庫管理SaaS連携',
eco_en: 'Shipping API integration, payment providers, inventory SaaS',
reg_ja: '特定商取引法、割賦販売法、EU消費者保護指令、PSD2',
reg_en: 'E-commerce regulations, consumer protection, PSD2 (EU)',
esg_ja: 'サステナブル配送、返品削減、カーボンニュートラル配送オプション',
esg_en: 'Sustainable shipping, return reduction, carbon-neutral delivery'
},
fintech: {
moat_ja: 'ブランド信頼（セキュリティ実績）、規制参入障壁',
moat_en: 'Brand trust (security track record), regulatory barriers',
gtm_ja: 'エンタープライズSLG、規制準拠先行',
gtm_en: 'Enterprise SLG, compliance-first approach',
ux_ja: 'セキュリティ透明性、リアルタイム通知、簡潔な取引履歴',
ux_en: 'Security transparency, real-time alerts, clear transaction history',
eco_ja: 'Banking API（Open Banking）、会計ソフト連携、KYC/AMLサービス',
eco_en: 'Banking APIs (Open Banking), accounting software, KYC/AML services',
reg_ja: '金融商品取引法、資金決済法、PSD2、EU AI Act高リスク、DORA',
reg_en: 'Financial regulations, PSD2, EU AI Act high-risk, DORA',
esg_ja: '金融包摂、責任ある融資、カーボンフットプリント開示',
esg_en: 'Financial inclusion, responsible lending, carbon disclosure'
},
health: {
moat_ja: 'データモート（健康記録）、規制参入障壁、信頼ブランド',
moat_en: 'Data moat (health records), regulatory barriers, trust brand',
gtm_ja: 'B2B2C（医療機関経由）、規制準拠先行',
gtm_en: 'B2B2C (via healthcare providers), compliance-first',
ux_ja: 'プライバシー透明性、アクセシビリティ、多言語対応',
ux_en: 'Privacy transparency, accessibility, multilingual support',
eco_ja: 'EHR統合（HL7 FHIR）、遠隔診療API、医療機器連携',
eco_en: 'EHR integration (HL7 FHIR), telemedicine APIs, device connectivity',
reg_ja: 'HIPAA（米）、医療法、EU AI Act高リスク、MDR/IVDR、GDPR特別カテゴリ',
reg_en: 'HIPAA (US), medical device regulations, EU AI Act high-risk, GDPR special categories',
esg_ja: '健康格差解消、アクセシビリティ、医療データ倫理',
esg_en: 'Health equity, accessibility, medical data ethics'
},
saas: {
moat_ja: 'スイッチングコスト（データロックイン）、ネットワーク効果（マルチテナント）',
moat_en: 'Switching costs (data lock-in), Network effects (multi-tenant)',
gtm_ja: 'PLG（フリートライアル）+ エンタープライズSLG',
gtm_en: 'PLG (free trial) + Enterprise SLG',
ux_ja: 'セルフサービスオンボード、プログレッシブディスクロージャー、使用量可視化',
ux_en: 'Self-service onboarding, progressive disclosure, usage visibility',
eco_ja: 'SSO/SCIM統合、API公開、Webhooks、マーケットプレイス（Salesforce/Slack）',
eco_en: 'SSO/SCIM integration, public APIs, webhooks, marketplace (Salesforce/Slack)',
reg_ja: 'GDPR、SOC2、ISO27001、各国データローカライゼーション',
reg_en: 'GDPR, SOC2, ISO27001, data localization laws',
esg_ja: 'クラウドカーボン最適化、リモートワーク支援、デジタルウェルビーイング',
esg_en: 'Cloud carbon optimization, remote work enablement, digital wellbeing'
},
marketplace: {
moat_ja: 'ネットワーク効果（両面市場）、データモート（マッチング精度）',
moat_en: 'Network effects (two-sided market), Data moat (matching accuracy)',
gtm_ja: '供給側先行獲得 → 需要側獲得、地域集中戦略',
gtm_en: 'Supply-side acquisition first, geographic clustering',
ux_ja: '信頼シグナル（レビュー・認証）、摩擦低減（即時マッチング）',
ux_en: 'Trust signals (reviews, verification), friction reduction (instant matching)',
eco_ja: '決済エスクロー、ID検証API、保険パートナー、配送統合',
eco_en: 'Payment escrow, ID verification APIs, insurance partners, shipping integration',
reg_ja: 'プラットフォーム責任法、DMA（EU）、DSA（EU）、独禁法',
reg_en: 'Platform liability, DMA (EU), DSA (EU), antitrust laws',
esg_ja: 'ギグワーカー保護、透明な手数料、地域経済活性化',
esg_en: 'Gig worker protection, transparent fees, local economy support'
},
community: {
moat_ja: 'ネットワーク効果（強）、スイッチングコスト（ソーシャルグラフ）',
moat_en: 'Strong network effects, Switching costs (social graph)',
gtm_ja: 'バイラルPLG、インフルエンサー活用、ニッチコミュニティ先行',
gtm_en: 'Viral PLG, influencer activation, niche community first',
ux_ja: 'デイリーエンゲージメントフック、UGC推奨、モデレーション品質',
ux_en: 'Daily engagement hooks, UGC promotion, moderation quality',
eco_ja: 'OAuth統合、通知API、UGCモデレーションAI、広告ネットワーク',
eco_en: 'OAuth integration, notification APIs, UGC moderation AI, ad networks',
reg_ja: 'DSA（EU）、COPPA（児童）、名誉毀損法、EU AI Act（コンテンツ推薦）',
reg_en: 'DSA (EU), COPPA (children), defamation laws, EU AI Act (content recommendation)',
esg_ja: 'デジタルウェルビーイング、ヘイトスピーチ対策、児童保護',
esg_en: 'Digital wellbeing, hate speech prevention, child protection'
},
content: {
moat_ja: 'ブランド信頼、コンテンツライブラリ、ネットワーク効果（購読者）',
moat_en: 'Brand trust, content library, Network effects (subscribers)',
gtm_ja: 'コンテンツSEO、ニュースレター、フリーミアム',
gtm_en: 'Content SEO, newsletters, freemium model',
ux_ja: 'パーソナライゼーション、読書進捗、オフラインアクセス',
ux_en: 'Personalization, reading progress, offline access',
eco_ja: 'CMS統合、CDN、広告ネットワーク、サブスクリプション決済',
eco_en: 'CMS integration, CDN, ad networks, subscription payments',
reg_ja: '著作権法、DSA（EU）、プライバシー（Cookie同意）',
reg_en: 'Copyright laws, DSA (EU), privacy (cookie consent)',
esg_ja: 'ジャーナリズム倫理、アクセシビリティ、ファクトチェック',
esg_en: 'Journalism ethics, accessibility, fact-checking'
},
booking: {
moat_ja: '在庫独占契約、データモート（需要予測）、ブランド信頼',
moat_en: 'Exclusive inventory, Data moat (demand forecasting), Brand trust',
gtm_ja: 'SEO（予約キーワード）、メタサーチ統合、提携先拡大',
gtm_en: 'SEO (booking keywords), metasearch integration, partner expansion',
ux_ja: 'リアルタイム在庫、価格比較、柔軟キャンセルポリシー',
ux_en: 'Real-time availability, price comparison, flexible cancellation',
eco_ja: 'GDS統合（旅行）、カレンダー同期、決済・エスクロー',
eco_en: 'GDS integration (travel), calendar sync, payment/escrow',
reg_ja: '旅行業法、消費者保護法、EU Package Travel Directive',
reg_en: 'Travel industry regulations, consumer protection, EU Package Travel Directive',
esg_ja: 'サステナブルツーリズム、カーボンオフセット、地域経済支援',
esg_en: 'Sustainable tourism, carbon offset, local economy support'
},
iot: {
moat_ja: '技術モート（デバイス統合）、データモート（センサーデータ）',
moat_en: 'Technology moat (device integration), Data moat (sensor data)',
gtm_ja: 'B2B（デバイスメーカー提携）、垂直統合戦略',
gtm_en: 'B2B (device manufacturer partnerships), vertical integration',
ux_ja: 'デバイス自動検出、ゼロタッチプロビジョニング、リアルタイムダッシュボード',
ux_en: 'Auto device discovery, zero-touch provisioning, real-time dashboards',
eco_ja: 'デバイスSDK、MQTT/CoAP、クラウドプロバイダIoTサービス',
eco_en: 'Device SDKs, MQTT/CoAP, cloud provider IoT services',
reg_ja: 'サイバーセキュリティ法、EU Cyber Resilience Act、電波法',
reg_en: 'Cybersecurity laws, EU Cyber Resilience Act, radio regulations',
esg_ja: 'デバイス長寿命化、電力効率、e-waste削減',
esg_en: 'Device longevity, power efficiency, e-waste reduction'
},
realestate: {
moat_ja: '在庫独占（物件データ）、ブランド信頼、地域ネットワーク',
moat_en: 'Exclusive inventory (property data), Brand trust, local networks',
gtm_ja: 'SEO（地域検索）、不動産会社提携、オフライン連携',
gtm_en: 'SEO (local search), realtor partnerships, offline integration',
ux_ja: 'VRツアー、AIマッチング、モバイルファースト',
ux_en: 'VR tours, AI matching, mobile-first',
eco_ja: 'MLS統合、住宅ローンAPI、スマートホーム連携',
eco_en: 'MLS integration, mortgage APIs, smart home connectivity',
reg_ja: '宅建業法、不動産登記法、Fair Housing Act（米）',
reg_en: 'Real estate licensing, property registration, Fair Housing Act (US)',
esg_ja: 'エネルギー効率開示、グリーンビルディング認証',
esg_en: 'Energy efficiency disclosure, green building certifications'
},
legal: {
moat_ja: 'ブランド信頼（機密性）、規制参入障壁、データモート（判例）',
moat_en: 'Brand trust (confidentiality), regulatory barriers, Data moat (case law)',
gtm_ja: 'エンタープライズSLG、弁護士会提携、垂直特化',
gtm_en: 'Enterprise SLG, bar association partnerships, vertical specialization',
ux_ja: 'セキュリティ透明性、文書バージョニング、電子署名',
ux_en: 'Security transparency, document versioning, e-signatures',
eco_ja: '電子署名API、裁判所ファイリングシステム、リーガルリサーチDB',
eco_en: 'E-signature APIs, court filing systems, legal research databases',
reg_ja: '弁護士法、EU AI Act高リスク（司法）、電子署名法',
reg_en: 'Legal practice regulations, EU AI Act high-risk (judiciary), e-signature laws',
esg_ja: '司法アクセス向上、プロボノ支援、透明な料金',
esg_en: 'Access to justice, pro bono support, transparent pricing'
},
hr: {
moat_ja: 'データモート（人材マッチング）、スイッチングコスト（統合HCM）',
moat_en: 'Data moat (talent matching), Switching costs (integrated HCM)',
gtm_ja: 'PLG（小規模）+ エンタープライズSLG、HR Tech展示会',
gtm_en: 'PLG (SMB) + Enterprise SLG, HR Tech conferences',
ux_ja: 'セルフサービスESS、モバイルファースト、多言語対応',
ux_en: 'Self-service ESS, mobile-first, multilingual support',
eco_ja: 'HRIS統合、給与計算API、バックグラウンドチェック、SSO/SCIM',
eco_en: 'HRIS integration, payroll APIs, background checks, SSO/SCIM',
reg_ja: '労働法、GDPR（従業員データ）、EU AI Act高リスク（採用AI）',
reg_en: 'Labor laws, GDPR (employee data), EU AI Act high-risk (recruitment AI)',
esg_ja: 'DEI指標、賃金透明性、従業員ウェルビーイング',
esg_en: 'DEI metrics, pay transparency, employee wellbeing'
},
analytics: {
moat_ja: 'データモート（蓄積データ）、スイッチングコスト（ダッシュボード依存）',
moat_en: 'Data moat (accumulated data), Switching costs (dashboard dependency)',
gtm_ja: 'PLG（無料枠）、データエンジニアコミュニティ、CLG',
gtm_en: 'PLG (free tier), data engineer community, CLG',
ux_ja: 'ノーコードダッシュボード、リアルタイムアラート、共有可能レポート',
ux_en: 'No-code dashboards, real-time alerts, shareable reports',
eco_ja: 'データソース統合（50+）、BI tool連携、Reverse ETL',
eco_en: 'Data source integrations (50+), BI tool connectivity, Reverse ETL',
reg_ja: 'GDPR（分析データ）、CCPA、Cookie同意',
reg_en: 'GDPR (analytics data), CCPA, cookie consent',
esg_ja: 'データ倫理、透明なアルゴリズム、プライバシー保護分析',
esg_en: 'Data ethics, transparent algorithms, privacy-preserving analytics'
},
portfolio: {
moat_ja: 'ブランド信頼（実績）、ネットワーク効果（テンプレート共有）',
moat_en: 'Brand trust (track record), Network effects (template sharing)',
gtm_ja: 'フリーミアム、コンテンツマーケティング、SEO',
gtm_en: 'Freemium, content marketing, SEO',
ux_ja: 'テンプレート選択、ドラッグ&ドロップ、カスタムドメイン',
ux_en: 'Template selection, drag & drop, custom domains',
eco_ja: 'CMS統合、CDN、SNS連携、Analytics統合',
eco_en: 'CMS integration, CDN, social media connectivity, analytics',
reg_ja: 'GDPR（訪問者データ）、著作権、アクセシビリティ法',
reg_en: 'GDPR (visitor data), copyright, accessibility laws',
esg_ja: 'アクセシビリティ標準、カーボン効率（ホスティング）',
esg_en: 'Accessibility standards, carbon-efficient hosting'
},
tool: {
moat_ja: 'ネットワーク効果（プラグインエコシステム）、技術モート',
moat_en: 'Network effects (plugin ecosystem), Technology moat',
gtm_ja: '開発者PLG、GitHub/VSCode Marketplace、CLG',
gtm_en: 'Developer PLG, GitHub/VSCode Marketplace, CLG',
ux_ja: 'CLI優先、ドキュメント充実、クイックスタート',
ux_en: 'CLI-first, comprehensive docs, quick start guides',
eco_ja: 'プラグインAPI、CI/CD統合、Language Server Protocol',
eco_en: 'Plugin APIs, CI/CD integration, Language Server Protocol',
reg_ja: 'オープンソースライセンス、GDPR（テレメトリ）',
reg_en: 'Open source licenses, GDPR (telemetry)',
esg_ja: 'オープンソース貢献、開発者教育、アクセシビリティ',
esg_en: 'Open source contribution, developer education, accessibility'
},
ai: {
moat_ja: 'データモート（トレーニングデータ）、技術モート（モデル）、規制参入障壁',
moat_en: 'Data moat (training data), Technology moat (models), Regulatory barriers',
gtm_ja: 'API-first PLG、開発者コミュニティ、垂直特化',
gtm_en: 'API-first PLG, developer community, vertical specialization',
ux_ja: 'プロンプトガイド、レート制限可視化、モデル選択UI',
ux_en: 'Prompt guides, rate limit visibility, model selection UI',
eco_ja: 'モデルプロバイダAPI、Vector DB、MLOpsツール統合',
eco_en: 'Model provider APIs, Vector DBs, MLOps tool integration',
reg_ja: 'EU AI Act、著作権（生成AI）、透明性義務、日本AI原則',
reg_en: 'EU AI Act, copyright (generative AI), transparency obligations, Japan AI principles',
esg_ja: 'AIカーボンフットプリント、バイアス監査、説明可能性',
esg_en: 'AI carbon footprint, bias auditing, explainability'
},
automation: {
moat_ja: 'ネットワーク効果（統合数）、スイッチングコスト（ワークフロー依存）',
moat_en: 'Network effects (integration count), Switching costs (workflow dependency)',
gtm_ja: 'PLG（テンプレート）、統合マーケットプレイス',
gtm_en: 'PLG (templates), integration marketplace',
ux_ja: 'ノーコードビルダー、テンプレートライブラリ、エラーハンドリング可視化',
ux_en: 'No-code builder, template library, error handling visibility',
eco_ja: '1000+統合、Webhooks、API公開、RPA連携',
eco_en: '1000+ integrations, webhooks, public APIs, RPA connectivity',
reg_ja: 'GDPR（データ処理）、各種業界規制（金融・医療）',
reg_en: 'GDPR (data processing), industry-specific regulations (finance, health)',
esg_ja: '業務効率化（CO2削減）、デジタルスキル向上',
esg_en: 'Operational efficiency (CO2 reduction), digital skill enhancement'
},
event: {
moat_ja: 'ネットワーク効果（参加者）、データモート（イベントデータ）',
moat_en: 'Network effects (attendees), Data moat (event data)',
gtm_ja: 'フリーミアム、イベント主催者コミュニティ、提携',
gtm_en: 'Freemium, event organizer community, partnerships',
ux_ja: 'モバイルチケット、ネットワーキング機能、ハイブリッドイベント対応',
ux_en: 'Mobile ticketing, networking features, hybrid event support',
eco_ja: '決済統合、CRM連携、ストリーミングAPI、カレンダー同期',
eco_en: 'Payment integration, CRM connectivity, streaming APIs, calendar sync',
reg_ja: 'チケット販売規制、GDPR、アクセシビリティ法',
reg_en: 'Ticket sales regulations, GDPR, accessibility laws',
esg_ja: 'バーチャル参加オプション、カーボンオフセット、インクルーシブデザイン',
esg_en: 'Virtual attendance options, carbon offset, inclusive design'
},
gamify: {
moat_ja: 'ネットワーク効果（マルチプレイヤー）、データモート（プレイヤー行動）',
moat_en: 'Network effects (multiplayer), Data moat (player behavior)',
gtm_ja: 'フリーミアム、バイラル拡散、インフルエンサー',
gtm_en: 'Freemium, viral spread, influencer marketing',
ux_ja: 'オンボーディングチュートリアル、進捗可視化、ソーシャル共有',
ux_en: 'Onboarding tutorial, progress visualization, social sharing',
eco_ja: '決済統合（IAP）、ゲームエンジン統合、広告ネットワーク',
eco_en: 'Payment integration (IAP), game engine integration, ad networks',
reg_ja: 'COPPA（児童）、ガチャ規制、GDPR、各国ゲーム規制',
reg_en: 'COPPA (children), loot box regulations, GDPR, gaming regulations',
esg_ja: 'デジタルウェルビーイング、健全なコミュニティ、依存症対策',
esg_en: 'Digital wellbeing, healthy community, addiction prevention'
},
collab: {
moat_ja: 'ネットワーク効果（チーム）、スイッチングコスト（共同作業データ）',
moat_en: 'Network effects (teams), Switching costs (collaborative data)',
gtm_ja: 'PLG（個人）→ チーム拡大 → エンタープライズ',
gtm_en: 'PLG (individual) → team expansion → enterprise',
ux_ja: 'リアルタイム同期、コメント・メンション、バージョン履歴',
ux_en: 'Real-time sync, comments/mentions, version history',
eco_ja: 'SSO/SCIM、Slack/Teams統合、ファイルストレージ連携',
eco_en: 'SSO/SCIM, Slack/Teams integration, file storage connectivity',
reg_ja: 'GDPR、SOC2、各国データローカライゼーション',
reg_en: 'GDPR, SOC2, data localization laws',
esg_ja: 'リモートワーク促進、アクセシビリティ、デジタルウェルビーイング',
esg_en: 'Remote work enablement, accessibility, digital wellbeing'
},
devtool: {
moat_ja: 'ネットワーク効果（エコシステム）、技術モート、開発者ロイヤルティ',
moat_en: 'Network effects (ecosystem), Technology moat, developer loyalty',
gtm_ja: '開発者PLG、GitHub/ドキュメント、CLG',
gtm_en: 'Developer PLG, GitHub/docs, CLG',
ux_ja: 'CLI優先、豊富なドキュメント、活発なコミュニティ',
ux_en: 'CLI-first, comprehensive docs, active community',
eco_ja: 'CI/CD統合、IDE拡張、Language Server、パッケージマネージャ',
eco_en: 'CI/CD integration, IDE extensions, Language Server, package managers',
reg_ja: 'オープンソースライセンス、GDPR（テレメトリ）',
reg_en: 'Open source licenses, GDPR (telemetry)',
esg_ja: 'オープンソース貢献、開発者教育、インクルーシブコミュニティ',
esg_en: 'Open source contribution, developer education, inclusive community'
},
creator: {
moat_ja: 'ネットワーク効果（クリエイター×ファン）、データモート（オーディエンス分析）',
moat_en: 'Network effects (creator × fans), Data moat (audience analytics)',
gtm_ja: 'クリエイターPLG、インフルエンサー先行獲得',
gtm_en: 'Creator PLG, influencer early acquisition',
ux_ja: 'コンテンツスケジューラ、収益ダッシュボード、ファンエンゲージメントツール',
ux_en: 'Content scheduler, revenue dashboard, fan engagement tools',
eco_ja: '決済統合、SNS連携、Email/SMS API、ストリーミング統合',
eco_en: 'Payment integration, social media connectivity, email/SMS APIs, streaming',
reg_ja: 'GDPR、著作権、決済規制、各国税法',
reg_en: 'GDPR, copyright, payment regulations, tax laws',
esg_ja: 'クリエイター公正報酬、コンテンツモデレーション、透明な手数料',
esg_en: 'Fair creator compensation, content moderation, transparent fees'
},
newsletter: {
moat_ja: 'データモート（購読者）、ブランド信頼、スイッチングコスト（メールリスト）',
moat_en: 'Data moat (subscribers), Brand trust, Switching costs (email list)',
gtm_ja: 'コンテンツSEO、紹介プログラム、フリーミアム',
gtm_en: 'Content SEO, referral programs, freemium',
ux_ja: 'パーソナライゼーション、配信時間最適化、読了率可視化',
ux_en: 'Personalization, send time optimization, read rate visibility',
eco_ja: 'Email API、CMS統合、決済統合、広告ネットワーク',
eco_en: 'Email APIs, CMS integration, payment integration, ad networks',
reg_ja: 'CAN-SPAM（米）、GDPR、ePrivacy指令',
reg_en: 'CAN-SPAM (US), GDPR, ePrivacy Directive',
esg_ja: 'スパム対策、アクセシビリティ（HTML Email）、購読管理透明性',
esg_en: 'Anti-spam, accessibility (HTML email), subscription transparency'
},
manufacturing: {
moat_ja: '技術モート（生産ノウハウ）、規模の経済、品質実績',
moat_en: 'Technical moat (production know-how), Economies of scale, Quality track record',
gtm_ja: 'エンタープライズSLG、品質認証先行、業界特化',
gtm_en: 'Enterprise SLG, quality certification first, industry-specific',
ux_ja: 'リアルタイム稼働監視、予知保全、品質ダッシュボード',
ux_en: 'Real-time operation monitoring, predictive maintenance, quality dashboard',
eco_ja: 'ERP統合、IoTプラットフォーム、PLM連携、SCM統合',
eco_en: 'ERP integration, IoT platforms, PLM collaboration, SCM integration',
reg_ja: 'ISO 9001、製造物責任法、環境規制（RoHS、REACH）',
reg_en: 'ISO 9001, Product Liability Act, Environmental regs (RoHS, REACH)',
esg_ja: 'カーボンニュートラル製造、循環経済、労働安全',
esg_en: 'Carbon-neutral manufacturing, circular economy, worker safety'
},
logistics: {
moat_ja: 'ネットワーク効果（配送網）、規模の経済、データモート（ルート最適化）',
moat_en: 'Network effects (delivery network), Economies of scale, Data moat (route optimization)',
gtm_ja: 'PLG（トラッキング無料）+ エンタープライズSLG',
gtm_en: 'PLG (free tracking) + Enterprise SLG',
ux_ja: 'リアルタイム追跡、配送時間予測、不在対策、置き配',
ux_en: 'Real-time tracking, delivery time prediction, absence handling, contactless delivery',
eco_ja: 'EC連携、WMS統合、ラストワンマイルAPI、配送業者統合',
eco_en: 'E-commerce integration, WMS integration, last-mile APIs, carrier integration',
reg_ja: '運送約款、個人情報保護法、EU AI Act（ルート最適化）',
reg_en: 'Shipping terms, privacy laws, EU AI Act (route optimization)',
esg_ja: 'EV配送、カーボンオフセット、梱包材削減、再配達削減',
esg_en: 'EV delivery, carbon offset, packaging reduction, redelivery reduction'
},
agriculture: {
moat_ja: 'データモート（農地分析）、技術モート（AI病害検知）',
moat_en: 'Data moat (farmland analysis), Technical moat (AI pest detection)',
gtm_ja: 'PLG（基本無料）+ 農協・JA向けSLG',
gtm_en: 'PLG (basic free) + SLG for agricultural cooperatives',
ux_ja: 'シンプルセンサー設置、視覚化ダッシュボード、アラート',
ux_en: 'Simple sensor setup, visualization dashboard, alerts',
eco_ja: 'IoTセンサー、気象API、ドローン連携、スマート農機統合',
eco_en: 'IoT sensors, weather APIs, drone integration, smart machinery integration',
reg_ja: 'GAP認証、食品衛生法、農薬取締法、トレーサビリティ',
reg_en: 'GAP certification, food safety laws, pesticide regulations, traceability',
esg_ja: '節水灌漑、有機農業支援、生物多様性保全',
esg_en: 'Water-saving irrigation, organic farming support, biodiversity conservation'
},
energy: {
moat_ja: '規制参入障壁、インフラロックイン、データモート（需給予測）',
moat_en: 'Regulatory barriers, Infrastructure lock-in, Data moat (demand forecasting)',
gtm_ja: 'エンタープライズSLG、規制準拠先行、公益事業向け',
gtm_en: 'Enterprise SLG, compliance-first, utility-focused',
ux_ja: 'リアルタイムダッシュボード、使用量可視化、省エネ提案',
ux_en: 'Real-time dashboard, usage visualization, energy-saving suggestions',
eco_ja: 'スマートメーター連携、HEMS/BEMS統合、グリッドAPI',
eco_en: 'Smart meter integration, HEMS/BEMS integration, grid APIs',
reg_ja: '電気事業法、省エネ法、再エネ特措法、EU AI Act',
reg_en: 'Electricity Act, Energy Conservation Act, renewable energy laws, EU AI Act',
esg_ja: '再生可能エネルギー促進、カーボンニュートラル、エネルギー公平性',
esg_en: 'Renewable energy promotion, carbon neutrality, energy equity'
},
media: {
moat_ja: 'ネットワーク効果（視聴者）、コンテンツライブラリ、ブランド信頼',
moat_en: 'Network effects (viewers), Content library, Brand trust',
gtm_ja: 'PLG（フリーミアム）+ コンテンツSEO',
gtm_en: 'PLG (freemium) + Content SEO',
ux_ja: 'パーソナライズドレコメンド、オフライン視聴、字幕・吹替',
ux_en: 'Personalized recommendations, offline viewing, subtitles/dubs',
eco_ja: 'CDN、DRM、広告ネットワーク、コンテンツAPI',
eco_en: 'CDN, DRM, ad networks, content APIs',
reg_ja: '著作権法、放送法、EU DSA/DMA、GDPR',
reg_en: 'Copyright law, broadcasting regulations, EU DSA/DMA, GDPR',
esg_ja: 'コンテンツ多様性、アクセシビリティ、デジタル格差解消',
esg_en: 'Content diversity, accessibility, digital divide reduction'
},
government: {
moat_ja: '規制独占、データモート（市民データ）、信頼性',
moat_en: 'Regulatory monopoly, Data moat (citizen data), Trust',
gtm_ja: '公共調達、RFP対応、先行自治体実績',
gtm_en: 'Public procurement, RFP response, early municipality track record',
ux_ja: 'WCAG 2.1 AA準拠、マイナンバー連携、多言語対応',
ux_en: 'WCAG 2.1 AA compliance, national ID integration, multilingual',
eco_ja: '電子署名、本人確認API、行政システム連携',
eco_en: 'Digital signature, identity verification APIs, government system integration',
reg_ja: '個人情報保護法、公文書管理法、行政手続法、EU AI Act高リスク',
reg_en: 'Privacy laws, public records laws, administrative procedure laws, EU AI Act high-risk',
esg_ja: 'デジタル格差解消、透明性、市民参加、オープンデータ',
esg_en: 'Digital divide reduction, transparency, citizen participation, open data'
},
travel: {
moat_ja: 'ネットワーク効果（在庫）、ブランド信頼、データモート（価格最適化）',
moat_en: 'Network effects (inventory), Brand trust, Data moat (price optimization)',
gtm_ja: 'PLG（比較検索）+ OTA連携',
gtm_en: 'PLG (price comparison) + OTA partnerships',
ux_ja: 'ワンストップ予約、リアルタイム価格比較、旅程管理',
ux_en: 'One-stop booking, real-time price comparison, itinerary management',
eco_ja: 'GDS統合、ホテルAPI、航空会社API、決済統合',
eco_en: 'GDS integration, hotel APIs, airline APIs, payment integration',
reg_ja: '旅行業法、個人情報保護法、EU Package Travel Directive',
reg_en: 'Travel business laws, privacy laws, EU Package Travel Directive',
esg_ja: 'サステナブルツーリズム、カーボンオフセット、地域経済支援',
esg_en: 'Sustainable tourism, carbon offset, local economy support'
},
insurance: {
moat_ja: 'ブランド信頼（保険金支払実績）、規制参入障壁、データモート（リスク分析）',
moat_en: 'Brand trust (claims payout record), Regulatory barriers, Data moat (risk analysis)',
gtm_ja: 'エンタープライズSLG、規制準拠先行、提携代理店',
gtm_en: 'Enterprise SLG, compliance-first, partner agents',
ux_ja: '簡易見積、オンライン契約、迅速な保険金請求処理',
ux_en: 'Simple quotes, online contracts, fast claims processing',
eco_ja: '代理店システム統合、医療機関API、修理業者ネットワーク',
eco_en: 'Agent system integration, healthcare APIs, repair shop networks',
reg_ja: '保険業法、金融商品取引法、EU Solvency II、AI Act高リスク',
reg_en: 'Insurance laws, financial regulations, EU Solvency II, AI Act high-risk',
esg_ja: '金融包摂、責任ある保険、ESGリスク評価',
esg_en: 'Financial inclusion, responsible insurance, ESG risk assessment'
},
_default: {
moat_ja: 'ネットワーク効果、データモート、スイッチングコスト、ブランド信頼、技術モート',
moat_en: 'Network effects, Data moat, Switching costs, Brand trust, Technology moat',
gtm_ja: 'PLG（プロダクト主導成長）+ SLG（営業主導）ハイブリッド',
gtm_en: 'PLG (Product-Led Growth) + SLG (Sales-Led) hybrid',
ux_ja: 'セルフサービスオンボード、プログレッシブディスクロージャー、リテンションフック',
ux_en: 'Self-service onboarding, progressive disclosure, retention hooks',
eco_ja: 'API公開、主要SaaS統合、マーケットプレイス戦略',
eco_en: 'Public APIs, major SaaS integrations, marketplace strategy',
reg_ja: 'GDPR、各国データ保護法、業界固有規制',
reg_en: 'GDPR, data protection laws, industry-specific regulations',
esg_ja: 'カーボンフットプリント最適化、アクセシビリティ、デジタル倫理',
esg_en: 'Carbon footprint optimization, accessibility, digital ethics'
}
};
// PERSONA_ARCHETYPES: 32 domains × 3 personas (primary/secondary/edge)
const PERSONA_ARCHETYPES = {
education: {
primary_ja: '大学生（18-24歳、スキル習得、キャリア準備）',
primary_en: 'University student (18-24, skill acquisition, career prep)',
secondary_ja: '社会人学習者（25-45歳、リスキリング、時間制約）',
secondary_en: 'Working professional (25-45, reskilling, time-constrained)',
edge_ja: '教育機関管理者（LMS導入、ROI評価、コンプライアンス）',
edge_en: 'Educational admin (LMS adoption, ROI assessment, compliance)'
},
ec: {
primary_ja: 'オンライン買い物客（25-45歳、利便性重視、モバイル）',
primary_en: 'Online shopper (25-45, convenience-focused, mobile)',
secondary_ja: '比較検討型購入者（価格・レビュー重視、デスクトップ）',
secondary_en: 'Research-driven buyer (price/review-focused, desktop)',
edge_ja: 'ギフト購入者（時間制約、ラッピング・配送重視）',
edge_en: 'Gift buyer (time-constrained, gift wrap/shipping-focused)'
},
fintech: {
primary_ja: 'スモールビジネスオーナー（30-50歳、財務管理、時間効率）',
primary_en: 'Small business owner (30-50, financial management, time efficiency)',
secondary_ja: '個人投資家（25-40歳、リスク管理、リアルタイムデータ）',
secondary_en: 'Individual investor (25-40, risk management, real-time data)',
edge_ja: 'CFO/経理担当（コンプライアンス、監査証跡、統合）',
edge_en: 'CFO/Accountant (compliance, audit trail, integration)'
},
health: {
primary_ja: '患者（慢性疾患管理、服薬遵守、医師コミュニケーション）',
primary_en: 'Patient (chronic disease mgmt, medication adherence, doctor comms)',
secondary_ja: '医療提供者（効率化、EHR統合、リモートモニタリング）',
secondary_en: 'Healthcare provider (efficiency, EHR integration, remote monitoring)',
edge_ja: '高齢者（アクセシビリティ、シンプルUI、介護者連携）',
edge_en: 'Elderly patient (accessibility, simple UI, caregiver coordination)'
},
saas: {
primary_ja: 'チームリード（5-20人、生産性向上、予算管理）',
primary_en: 'Team lead (5-20 people, productivity boost, budget management)',
secondary_ja: 'エンドユーザー（日常業務、使いやすさ、学習コスト低）',
secondary_en: 'End user (daily tasks, ease of use, low learning curve)',
edge_ja: 'IT管理者（セキュリティ、SSO/SCIM、API統合）',
edge_en: 'IT admin (security, SSO/SCIM, API integration)'
},
marketplace: {
primary_ja: 'サービス提供者（収益最大化、評価管理、集客）',
primary_en: 'Service provider (revenue maximization, rating mgmt, customer acquisition)',
secondary_ja: '顧客（信頼性、価格比較、レビュー）',
secondary_en: 'Customer (trust, price comparison, reviews)',
edge_ja: 'プラットフォーム運営者（不正防止、品質管理、手数料最適化）',
edge_en: 'Platform operator (fraud prevention, quality control, fee optimization)'
},
community: {
primary_ja: 'アクティブメンバー（毎日投稿、コミュニティ貢献、評価）',
primary_en: 'Active member (daily posts, community contribution, reputation)',
secondary_ja: 'ラーカー（情報収集、投稿少、モバイル）',
secondary_en: 'Lurker (info gathering, low posting, mobile)',
edge_ja: 'モデレーター（コミュニティ健全性、ルール執行、紛争解決）',
edge_en: 'Moderator (community health, rule enforcement, dispute resolution)'
},
content: {
primary_ja: '定期読者（25-45歳、トピック追跡、ニュースレター購読）',
primary_en: 'Regular reader (25-45, topic tracking, newsletter subscription)',
secondary_ja: 'SNS流入者（バイラル記事、スキミング、モバイル）',
secondary_en: 'Social media referral (viral articles, skimming, mobile)',
edge_ja: '有料購読者（深い分析、アーカイブアクセス、広告なし）',
edge_en: 'Paid subscriber (deep analysis, archive access, ad-free)'
},
booking: {
primary_ja: '旅行者（30-50歳、価格比較、レビュー重視）',
primary_en: 'Traveler (30-50, price comparison, review-focused)',
secondary_ja: 'ビジネス旅行者（時間効率、ロイヤルティプログラム、経費精算）',
secondary_en: 'Business traveler (time efficiency, loyalty programs, expense reporting)',
edge_ja: 'グループオーガナイザー（複数予約、柔軟キャンセル、グループ割引）',
edge_en: 'Group organizer (bulk bookings, flexible cancellation, group discounts)'
},
iot: {
primary_ja: 'コンシューマー（スマートホーム、簡単セットアップ、モバイル管理）',
primary_en: 'Consumer (smart home, easy setup, mobile management)',
secondary_ja: '産業ユーザー（運用効率、予知保全、ROI）',
secondary_en: 'Industrial user (operational efficiency, predictive maintenance, ROI)',
edge_ja: 'システムインテグレーター（複雑統合、カスタマイズ、API）',
edge_en: 'System integrator (complex integration, customization, APIs)'
},
realestate: {
primary_ja: '住宅購入者（初回・リピート、エリア検索、価格比較）',
primary_en: 'Home buyer (first-time/repeat, area search, price comparison)',
secondary_ja: '賃貸希望者（モバイル、迅速対応、バーチャルツアー）',
secondary_en: 'Renter (mobile, quick response, virtual tours)',
edge_ja: '不動産エージェント（リード管理、CRM統合、マーケティング）',
edge_en: 'Real estate agent (lead mgmt, CRM integration, marketing)'
},
legal: {
primary_ja: '弁護士（ケース管理、文書作成、時間追跡）',
primary_en: 'Attorney (case management, document drafting, time tracking)',
secondary_ja: '法務チーム（契約管理、コンプライアンス、コラボレーション）',
secondary_en: 'Legal team (contract mgmt, compliance, collaboration)',
edge_ja: 'クライアント（ケース進捗可視化、セキュア通信、請求透明性）',
edge_en: 'Client (case progress visibility, secure comms, billing transparency)'
},
hr: {
primary_ja: 'HR担当者（採用、オンボード、従業員記録）',
primary_en: 'HR professional (recruitment, onboarding, employee records)',
secondary_ja: '従業員（セルフサービスESS、給与明細、休暇申請）',
secondary_en: 'Employee (self-service ESS, pay stubs, leave requests)',
edge_ja: 'マネージャー（パフォーマンス管理、承認ワークフロー、チーム分析）',
edge_en: 'Manager (performance mgmt, approval workflows, team analytics)'
},
analytics: {
primary_ja: 'データアナリスト（ダッシュボード作成、SQL、可視化）',
primary_en: 'Data analyst (dashboard creation, SQL, visualization)',
secondary_ja: 'ビジネスユーザー（ノーコード、定型レポート、KPI追跡）',
secondary_en: 'Business user (no-code, standard reports, KPI tracking)',
edge_ja: 'データエンジニア（ETL、パフォーマンス最適化、API統合）',
edge_en: 'Data engineer (ETL, performance optimization, API integration)'
},
portfolio: {
primary_ja: 'クリエイティブプロフェッショナル（デザイナー・開発者、作品展示、顧客獲得）',
primary_en: 'Creative professional (designer/developer, work showcase, client acquisition)',
secondary_ja: '求職者（実績アピール、PDF/印刷、シンプルUI）',
secondary_en: 'Job seeker (achievement showcase, PDF/print, simple UI)',
edge_ja: 'エージェンシー（クライアントポータル、複数プロジェクト、ブランディング）',
edge_en: 'Agency (client portal, multiple projects, branding)'
},
tool: {
primary_ja: '開発者（効率化、自動化、CLI優先）',
primary_en: 'Developer (efficiency, automation, CLI-first)',
secondary_ja: 'パワーユーザー（カスタマイズ、ショートカット、拡張機能）',
secondary_en: 'Power user (customization, shortcuts, extensions)',
edge_ja: 'チームリード（標準化、ベストプラクティス、オンボード）',
edge_en: 'Team lead (standardization, best practices, onboarding)'
},
ai: {
primary_ja: '開発者（API統合、プロンプトエンジニアリング、コスト最適化）',
primary_en: 'Developer (API integration, prompt engineering, cost optimization)',
secondary_ja: 'ビジネスユーザー（ノーコードAI、テンプレート、即効性）',
secondary_en: 'Business user (no-code AI, templates, quick wins)',
edge_ja: 'MLエンジニア（ファインチューニング、モデル評価、パフォーマンス）',
edge_en: 'ML engineer (fine-tuning, model evaluation, performance)'
},
automation: {
primary_ja: 'ビジネスユーザー（ノーコード、テンプレート、時間節約）',
primary_en: 'Business user (no-code, templates, time savings)',
secondary_ja: '開発者（API統合、複雑ワークフロー、エラーハンドリング）',
secondary_en: 'Developer (API integration, complex workflows, error handling)',
edge_ja: 'IT管理者（セキュリティ、監査、ガバナンス）',
edge_en: 'IT admin (security, auditing, governance)'
},
event: {
primary_ja: 'イベント主催者（チケット販売、参加者管理、ROI）',
primary_en: 'Event organizer (ticket sales, attendee mgmt, ROI)',
secondary_ja: '参加者（モバイルチケット、スケジュール、ネットワーキング）',
secondary_en: 'Attendee (mobile tickets, schedule, networking)',
edge_ja: 'スポンサー（ブランド露出、リード獲得、分析）',
edge_en: 'Sponsor (brand exposure, lead generation, analytics)'
},
gamify: {
primary_ja: 'カジュアルプレイヤー（モバイル、短セッション、ソーシャル）',
primary_en: 'Casual player (mobile, short sessions, social)',
secondary_ja: 'ハードコアプレイヤー（競争、ランキング、進捗）',
secondary_en: 'Hardcore player (competition, leaderboards, progression)',
edge_ja: 'ゲーム開発者（分析、A/Bテスト、マネタイズ最適化）',
edge_en: 'Game developer (analytics, A/B testing, monetization optimization)'
},
collab: {
primary_ja: 'チームメンバー（日常コラボ、リアルタイム同期、通知）',
primary_en: 'Team member (daily collaboration, real-time sync, notifications)',
secondary_ja: 'プロジェクトマネージャー（進捗追跡、タスク割当、レポート）',
secondary_en: 'Project manager (progress tracking, task assignment, reporting)',
edge_ja: '外部コラボレーター（ゲストアクセス、権限制限、セキュア共有）',
edge_en: 'External collaborator (guest access, limited permissions, secure sharing)'
},
devtool: {
primary_ja: 'フルスタック開発者（CLI、IDE統合、ドキュメント）',
primary_en: 'Full-stack developer (CLI, IDE integration, docs)',
secondary_ja: 'フロントエンド開発者（DX、デバッグ、ホットリロード）',
secondary_en: 'Frontend developer (DX, debugging, hot reload)',
edge_ja: 'DevOps/SRE（CI/CD統合、監視、パフォーマンス）',
edge_en: 'DevOps/SRE (CI/CD integration, monitoring, performance)'
},
creator: {
primary_ja: 'コンテンツクリエイター（収益化、オーディエンス成長、分析）',
primary_en: 'Content creator (monetization, audience growth, analytics)',
secondary_ja: 'ファン（限定コンテンツ、クリエイター支援、コミュニティ）',
secondary_en: 'Fan (exclusive content, creator support, community)',
edge_ja: 'マネージャー/エージェント（複数クリエイター、契約、レポート）',
edge_en: 'Manager/Agent (multiple creators, contracts, reporting)'
},
newsletter: {
primary_ja: 'ライター（執筆、スケジュール、成長）',
primary_en: 'Writer (writing, scheduling, growth)',
secondary_ja: '購読者（パーソナライゼーション、読みやすさ、購読管理）',
secondary_en: 'Subscriber (personalization, readability, subscription mgmt)',
edge_ja: '編集者（複数ライター、承認ワークフロー、分析）',
edge_en: 'Editor (multiple writers, approval workflows, analytics)'
},
manufacturing: {
primary_ja: '生産管理者（稼働率、品質、納期）',
primary_en: 'Production manager (utilization, quality, delivery)',
secondary_ja: '現場作業者（操作性、エラー検知、保守）',
secondary_en: 'Floor worker (usability, error detection, maintenance)',
edge_ja: '経営層（KPI、最適化、規制対応）',
edge_en: 'Executive (KPIs, optimization, compliance)'
},
logistics: {
primary_ja: '配送ドライバー（ルート、時間、荷物）',
primary_en: 'Delivery driver (route, time, packages)',
secondary_ja: '倉庫管理者（在庫、ピッキング、出荷）',
secondary_en: 'Warehouse manager (inventory, picking, shipping)',
edge_ja: 'オペレーション責任者（最適化、コスト、SLA）',
edge_en: 'Operations lead (optimization, cost, SLA)'
},
agriculture: {
primary_ja: '農家（灌漑、収穫、病害対策）',
primary_en: 'Farmer (irrigation, harvest, pest control)',
secondary_ja: '農業技術者（センサー、分析、改善提案）',
secondary_en: 'Agricultural technician (sensors, analysis, improvement suggestions)',
edge_ja: '農協・JA職員（統計、支援、トレーサビリティ）',
edge_en: 'Cooperative staff (statistics, support, traceability)'
},
energy: {
primary_ja: 'エネルギー管理者（需給、最適化、コスト）',
primary_en: 'Energy manager (supply-demand, optimization, cost)',
secondary_ja: 'エンドユーザー（使用量、省エネ、請求）',
secondary_en: 'End user (usage, energy saving, billing)',
edge_ja: '規制担当者（コンプライアンス、報告、監査）',
edge_en: 'Compliance officer (regulations, reporting, audit)'
},
media: {
primary_ja: '視聴者（発見、視聴、エンゲージ）',
primary_en: 'Viewer (discovery, watching, engagement)',
secondary_ja: 'コンテンツクリエイター（アップロード、分析、収益化）',
secondary_en: 'Content creator (upload, analytics, monetization)',
edge_ja: 'プラットフォーム運営者（DRM、CDN、レコメンド）',
edge_en: 'Platform operator (DRM, CDN, recommendations)'
},
government: {
primary_ja: '市民（申請、照会、交付）',
primary_en: 'Citizen (application, inquiry, issuance)',
secondary_ja: '窓口職員（受付、審査、承認）',
secondary_en: 'Clerk (reception, review, approval)',
edge_ja: 'システム管理者（セキュリティ、監査、統計）',
edge_en: 'System admin (security, audit, statistics)'
},
travel: {
primary_ja: '旅行者（検索、比較、予約）',
primary_en: 'Traveler (search, compare, book)',
secondary_ja: '旅行代理店（顧客管理、旅程作成、サポート）',
secondary_en: 'Travel agent (customer mgmt, itinerary creation, support)',
edge_ja: 'サプライヤー（在庫管理、価格設定、連携）',
edge_en: 'Supplier (inventory mgmt, pricing, integration)'
},
insurance: {
primary_ja: '契約者（見積、契約、請求）',
primary_en: 'Policyholder (quote, contract, claim)',
secondary_ja: '代理店（販売、サポート、更新管理）',
secondary_en: 'Agent (sales, support, renewal mgmt)',
edge_ja: '査定担当者（審査、承認、不正検知）',
edge_en: 'Claims adjuster (review, approval, fraud detection)'
},
_default: {
primary_ja: 'エンドユーザー（日常利用、使いやすさ、価値実現）',
primary_en: 'End user (daily use, ease of use, value realization)',
secondary_ja: 'ビジネスユーザー（ROI、効率化、統合）',
secondary_en: 'Business user (ROI, efficiency, integration)',
edge_ja: '管理者（セキュリティ、コンプライアンス、ガバナンス）',
edge_en: 'Admin (security, compliance, governance)'
}
};
// GTM_STRATEGY: 4 stakeholder types
const GTM_STRATEGY = {
startup: {
model_ja: 'PLG（プロダクト主導成長）',
model_en: 'PLG (Product-Led Growth)',
channel_ja: 'フリーミアム、バイラル拡散、コンテンツマーケティング、コミュニティ',
channel_en: 'Freemium, viral spread, content marketing, community',
cac_ltv_ja: 'CAC: $50-200, LTV: $500-2000, ペイバック: 6-12ヶ月',
cac_ltv_en: 'CAC: $50-200, LTV: $500-2000, Payback: 6-12 months'
},
enterprise: {
model_ja: 'SLG（営業主導成長）',
model_en: 'SLG (Sales-Led Growth)',
channel_ja: 'エンタープライズ営業、パートナー、展示会、ホワイトペーパー',
channel_en: 'Enterprise sales, partnerships, conferences, whitepapers',
cac_ltv_ja: 'CAC: $5000-50000, LTV: $50000-500000, ペイバック: 12-24ヶ月',
cac_ltv_en: 'CAC: $5000-50000, LTV: $50000-500000, Payback: 12-24 months'
},
developer: {
model_ja: 'CLG（コミュニティ主導成長）',
model_en: 'CLG (Community-Led Growth)',
channel_ja: 'GitHub、ドキュメント、開発者コミュニティ、OSS、技術ブログ',
channel_en: 'GitHub, documentation, dev community, OSS, technical blogs',
cac_ltv_ja: 'CAC: $20-100, LTV: $200-2000, ペイバック: 3-6ヶ月',
cac_ltv_en: 'CAC: $20-100, LTV: $200-2000, Payback: 3-6 months'
},
team: {
model_ja: 'ハイブリッド（PLG + SLG）',
model_en: 'Hybrid (PLG + SLG)',
channel_ja: 'フリートライアル → チーム拡大 → エンタープライズ営業',
channel_en: 'Free trial → team expansion → enterprise sales',
cac_ltv_ja: 'CAC: $200-2000, LTV: $2000-20000, ペイバック: 9-18ヶ月',
cac_ltv_en: 'CAC: $200-2000, LTV: $2000-20000, Payback: 9-18 months'
}
};
// REGULATORY_HORIZON: Global regulations timeline 2026-2030
const REGULATORY_HORIZON = {
timeline_ja: [
'2026年: EU AI Act全面施行 - 高リスクAI規制',
'2027年: ePrivacy規則施行 - Cookie規制強化',
'2028年: DMA完全適用 - プラットフォーム規制',
'2029年: 米国連邦プライバシー法成立見込み',
'2030年: EU Cyber Resilience Act完全施行'
],
timeline_en: [
'2026: EU AI Act full enforcement - high-risk AI regulations',
'2027: ePrivacy Regulation enforcement - stricter cookie rules',
'2028: DMA full applicability - platform regulations',
'2029: US federal privacy law expected',
'2030: EU Cyber Resilience Act full enforcement'
],
ai_act_risk_ja: {
high: 'fintech, health, legal, hr（採用AI）— 厳格義務（透明性・監査・人間監視）',
limited: 'community, content, ai（汎用）— 透明性義務のみ',
minimal: 'portfolio, tool, devtool — 自主規制'
},
ai_act_risk_en: {
high: 'fintech, health, legal, hr (recruitment AI) — strict obligations (transparency, auditing, human oversight)',
limited: 'community, content, ai (general) — transparency obligations only',
minimal: 'portfolio, tool, devtool — self-regulation'
},
data_sovereignty_ja: [
'EU: Schrems II後継判決でクラウド法対応必須',
'中国: データ越境規制強化（PIPL）',
'日本: デジタル庁によるガバメントクラウド推進'
],
data_sovereignty_en: [
'EU: Post-Schrems II rulings require Cloud Act compliance',
'China: Stricter cross-border data rules (PIPL)',
'Japan: Digital Agency promotes government cloud adoption'
]
};
// ============================================================================
// GENERATOR FUNCTION
// ============================================================================
function genPillar15(answers) {
const G = S.genLang === 'ja';
const domain = detectDomain(answers.purpose || '');
const mkt = DOMAIN_MARKET[domain] || DOMAIN_MARKET._default;
const personas = PERSONA_ARCHETYPES[domain] || PERSONA_ARCHETYPES._default;
const stakeholder = answers.stakeholder || 'startup';
const gtm = GTM_STRATEGY[stakeholder] || GTM_STRATEGY.startup;
const arch = answers.architecture || 'baas';
const deploy = answers.deployment || 'vercel';
S.files['docs/56_market_positioning.md'] = gen56Market(G, domain, mkt, gtm, stakeholder);
S.files['docs/57_user_experience_strategy.md'] = gen57UX(G, domain, personas, mkt);
S.files['docs/58_ecosystem_strategy.md'] = gen58Ecosystem(G, domain, mkt, arch, deploy, answers);
S.files['docs/59_regulatory_foresight.md'] = gen59Regulatory(G, domain, mkt, answers);
}
// ============================================================================
// DOC 56: Market Positioning & Competitive Intelligence
// ============================================================================
function gen56Market(G, domain, mkt, gtm, stakeholder) {
let doc = '';
doc += G ? '# 56. 市場ポジショニング & 競合インテリジェンス\n\n' : '# 56. Market Positioning & Competitive Intelligence\n\n';
doc += G ? '**対象:** ビジネス/PdM、投資家/経営層\n\n' : '**Audience:** Business/PdM, Investors/Executives\n\n';
// 1. Market Landscape
doc += G ? '## 1. 市場ランドスケープ概観\n\n' : '## 1. Market Landscape Overview\n\n';
doc += G
? '**ドメイン:** ' + domain + '\n\n'
: '**Domain:** ' + domain + '\n\n';
const tamMap = {
education: G ? '$300B（グローバルEdTech市場、2026）' : '$300B (Global EdTech, 2026)',
ec: G ? '$6T（グローバルEC市場、2026）' : '$6T (Global E-commerce, 2026)',
fintech: G ? '$310B（フィンテック市場、2026）' : '$310B (Fintech market, 2026)',
health: G ? '$500B（デジタルヘルス市場、2026）' : '$500B (Digital health, 2026)',
saas: G ? '$200B（グローバルSaaS市場、2026）' : '$200B (Global SaaS, 2026)',
marketplace: G ? '$2T（シェアリングエコノミー、2026）' : '$2T (Sharing economy, 2026)',
_default: G ? '$XB（市場規模は個別調査が必要）' : '$XB (Market size requires custom research)'
};
const tam = tamMap[domain] || tamMap._default;
doc += G ? '**TAM（総有効市場）:** ' + tam + '\n\n' : '**TAM (Total Addressable Market):** ' + tam + '\n\n';
doc += G
? '**SAM/SOM:** 地域・顧客セグメント・価格帯で絞り込み（例: 日本大学向けLMS = TAMの0.5%）\n\n'
: '**SAM/SOM:** Narrow by region, customer segment, pricing (e.g., Japan university LMS = 0.5% TAM)\n\n';
// 2. SWOT Analysis
doc += G ? '## 2. SWOT分析フレームワーク\n\n' : '## 2. SWOT Analysis Framework\n\n';
doc += '| ' + (G ? '項目' : 'Item') + ' | ' + (G ? '説明' : 'Description') + ' |\n';
doc += '|---|---|\n';
doc += '| **Strengths** | ' + (G ? '技術スタック選択の強み（例: BaaS=高速MVP、TypeScript=型安全）' : 'Tech stack strengths (e.g., BaaS=fast MVP, TypeScript=type safety)') + ' |\n';
doc += '| **Weaknesses** | ' + (G ? 'ベンダーロックイン、スケール制約、初期スキル要件' : 'Vendor lock-in, scale constraints, initial skill requirements') + ' |\n';
doc += '| **Opportunities** | ' + (G ? '市場成長、規制追い風、新規セグメント' : 'Market growth, regulatory tailwinds, new segments') + ' |\n';
doc += '| **Threats** | ' + (G ? '競合、規制リスク、技術陳腐化' : 'Competition, regulatory risks, tech obsolescence') + ' |\n\n';
// 3. MOAT Analysis
doc += G ? '## 3. MOAT分析（5類型）\n\n' : '## 3. MOAT Analysis (5 Types)\n\n';
doc += G ? '**ドメイン別MOAT:** ' + mkt.moat_ja + '\n\n' : '**Domain-specific MOAT:** ' + mkt.moat_en + '\n\n';
doc += '```mermaid\nmindmap\n  root((MOAT))\n';
doc += '    ' + (G ? 'ネットワーク効果' : 'Network Effects') + '\n';
doc += '      ' + (G ? 'ユーザー増→価値増' : 'More users → More value') + '\n';
doc += '    ' + (G ? 'データモート' : 'Data Moat') + '\n';
doc += '      ' + (G ? '蓄積データ→精度向上' : 'Accumulated data → Better accuracy') + '\n';
doc += '    ' + (G ? 'スイッチングコスト' : 'Switching Costs') + '\n';
doc += '      ' + (G ? 'データ移行困難' : 'Data migration difficulty') + '\n';
doc += '    ' + (G ? 'ブランド信頼' : 'Brand Trust') + '\n';
doc += '      ' + (G ? 'セキュリティ実績' : 'Security track record') + '\n';
doc += '    ' + (G ? '技術モート' : 'Technology Moat') + '\n';
doc += '      ' + (G ? '独自技術・特許' : 'Proprietary tech/patents') + '\n';
doc += '```\n\n';
// 4. Go-to-Market Strategy
doc += G ? '## 4. Go-to-Market戦略\n\n' : '## 4. Go-to-Market Strategy\n\n';
doc += G ? '**ステークホルダー型:** ' + stakeholder + '\n\n' : '**Stakeholder Type:** ' + stakeholder + '\n\n';
doc += '- **' + (G ? 'モデル' : 'Model') + ':** ' + (G ? gtm.model_ja : gtm.model_en) + '\n';
doc += '- **' + (G ? 'チャネル' : 'Channels') + ':** ' + (G ? gtm.channel_ja : gtm.channel_en) + '\n';
doc += '- **' + (G ? 'ユニットエコノミクス' : 'Unit Economics') + ':** ' + (G ? gtm.cac_ltv_ja : gtm.cac_ltv_en) + '\n\n';
doc += G ? '**ドメイン別推奨チャネル:** ' + mkt.gtm_ja + '\n\n' : '**Domain-specific Channels:** ' + mkt.gtm_en + '\n\n';
// 5. Unit Economics
doc += G ? '## 5. ユニットエコノミクス指標\n\n' : '## 5. Unit Economics Metrics\n\n';
doc += '```mermaid\ngraph LR\n';
doc += '  A[' + (G ? 'CAC<br/>顧客獲得コスト' : 'CAC<br/>Customer Acquisition Cost') + '] -->|' + (G ? 'ペイバック期間' : 'Payback Period') + '| B[' + (G ? 'LTV<br/>顧客生涯価値' : 'LTV<br/>Lifetime Value') + ']\n';
doc += '  B --> C[' + (G ? 'LTV/CAC比率<br/>3:1が健全' : 'LTV/CAC Ratio<br/>3:1 is healthy') + ']\n';
doc += '  A --> D[' + (G ? 'マーケティング' : 'Marketing') + ']\n';
doc += '  A --> E[' + (G ? 'セールス' : 'Sales') + ']\n';
doc += '  A --> F[' + (G ? 'オンボード' : 'Onboarding') + ']\n';
doc += '```\n\n';
doc += G
? '**ドメイン別ペイバック期間ベンチマーク:**\n- fintech/health: 18-24ヶ月（規制・信頼構築コスト）\n- education/SaaS: 6-12ヶ月（標準的PLG）\n- marketplace: 3-6ヶ月（ネットワーク効果加速）\n\n'
: '**Domain-specific Payback Benchmarks:**\n- fintech/health: 18-24 months (regulatory/trust costs)\n- education/SaaS: 6-12 months (standard PLG)\n- marketplace: 3-6 months (network effects acceleration)\n\n';
doc += G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n';
doc += G ? '**戦略基盤:** ' : '**Strategy Foundation:** ';
doc += '[Industry Blueprint](./48_industry_blueprint.md), [Stakeholder Strategy](./50_stakeholder_strategy.md)\n\n';
doc += G ? '**成長:** ' : '**Growth:** ';
doc += '[Growth Intelligence](./41_growth_intelligence.md), [User Experience Strategy](./57_user_experience_strategy.md)\n\n';
doc += G ? '**エコシステム:** ' : '**Ecosystem:** ';
doc += '[Ecosystem Strategy](./58_ecosystem_strategy.md)\n\n';
doc += G ? '---\n\n**次のステップ:** doc 57（UX戦略）、doc 58（エコシステム戦略）で市場ポジショニングを実行戦術に落とし込む。\n' : '---\n\n**Next Steps:** Translate market positioning into execution tactics in doc 57 (UX Strategy), doc 58 (Ecosystem Strategy).\n';
return doc;
}
// ============================================================================
// DOC 57: User Experience & Retention Strategy
// ============================================================================
function gen57UX(G, domain, personas, mkt) {
let doc = '';
doc += G ? '# 57. ユーザー体験 & リテンション戦略\n\n' : '# 57. User Experience & Retention Strategy\n\n';
doc += G ? '**対象:** エンドユーザー、ビジネス/PdM\n\n' : '**Audience:** End Users, Business/PdM\n\n';
// 1. Persona Matrix
doc += G ? '## 1. ペルソナ定義マトリクス\n\n' : '## 1. Persona Definition Matrix\n\n';
doc += '| ' + (G ? 'タイプ' : 'Type') + ' | ' + (G ? 'ペルソナ' : 'Persona') + ' |\n';
doc += '|---|---|\n';
doc += '| ' + (G ? 'プライマリ' : 'Primary') + ' | ' + (G ? personas.primary_ja : personas.primary_en) + ' |\n';
doc += '| ' + (G ? 'セカンダリ' : 'Secondary') + ' | ' + (G ? personas.secondary_ja : personas.secondary_en) + ' |\n';
doc += '| ' + (G ? 'エッジケース' : 'Edge Case') + ' | ' + (G ? personas.edge_ja : personas.edge_en) + ' |\n\n';
// 2. User Journey Map
doc += G ? '## 2. ユーザージャーニーマップ（5ステージ）\n\n' : '## 2. User Journey Map (5 Stages)\n\n';
doc += '```mermaid\njourney\n';
doc += '  title ' + (G ? 'ユーザージャーニー' : 'User Journey') + '\n';
doc += '  section ' + (G ? '発見' : 'Discovery') + '\n';
doc += '    ' + (G ? 'SEO/SNS流入: 3: ' : 'SEO/Social inflow: 3: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '    ' + (G ? 'ランディングページ: 4: ' : 'Landing page: 4: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '  section ' + (G ? '評価' : 'Evaluation') + '\n';
doc += '    ' + (G ? '機能確認: 4: ' : 'Feature check: 4: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '    ' + (G ? '価格比較: 3: ' : 'Pricing compare: 3: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '  section ' + (G ? 'オンボード' : 'Onboarding') + '\n';
doc += '    ' + (G ? 'サインアップ: 5: ' : 'Sign up: 5: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '    ' + (G ? '初期設定: 2: ' : 'Initial setup: 2: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '  section ' + (G ? 'エンゲージ' : 'Engagement') + '\n';
doc += '    ' + (G ? '日常利用: 5: ' : 'Daily use: 5: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '    ' + (G ? '価値実現: 5: ' : 'Value realization: 5: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '  section ' + (G ? '推奨' : 'Advocacy') + '\n';
doc += '    ' + (G ? '友人紹介: 4: ' : 'Referral: 4: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '    ' + (G ? 'レビュー投稿: 3: ' : 'Review posting: 3: ') + (G ? 'ユーザー' : 'User') + '\n';
doc += '```\n\n';
doc += G
? '**ドロップオフリスクポイント:**\n- 発見→評価: 複雑な価格表、遅いページ\n- 評価→オンボード: 長いサインアップフォーム\n- オンボード→エンゲージ: 初期設定の複雑さ（**Time-to-Value最優先**）\n\n'
: '**Drop-off Risk Points:**\n- Discovery → Evaluation: Complex pricing, slow page\n- Evaluation → Onboarding: Long signup forms\n- Onboarding → Engagement: Complex initial setup (**Time-to-Value is critical**)\n\n';
// 3. Onboarding Strategy
doc += G ? '## 3. オンボーディング戦略\n\n' : '## 3. Onboarding Strategy\n\n';
doc += G
? '**Time-to-Value目標:** ドメイン別\n- SaaS/tool/devtool: **5分以内**（クイックスタート必須）\n- education/content: **15分以内**（初回コンテンツ消費）\n- marketplace/ec: **30分以内**（初回取引/購入）\n\n'
: '**Time-to-Value Goals:** By domain\n- SaaS/tool/devtool: **Within 5 minutes** (quick start required)\n- education/content: **Within 15 minutes** (first content consumption)\n- marketplace/ec: **Within 30 minutes** (first transaction/purchase)\n\n';
doc += G
? '**プログレッシブディスクロージャー原則:**\n1. 最小限の初期設定（email + password のみ）\n2. 段階的機能開示（使用頻度順）\n3. コンテキストヘルプ（ツールチップ、ウォークスルー）\n\n'
: '**Progressive Disclosure Principles:**\n1. Minimal initial setup (email + password only)\n2. Gradual feature exposure (by usage frequency)\n3. Contextual help (tooltips, walkthroughs)\n\n';
// 4. Retention & Expansion
doc += G ? '## 4. リテンション & 拡張フレームワーク\n\n' : '## 4. Retention & Expansion Framework\n\n';
doc += G ? '**ドメイン別リテンションレバー:** ' + mkt.ux_ja + '\n\n' : '**Domain-specific Retention Levers:** ' + mkt.ux_en + '\n\n';
doc += '```mermaid\ngraph TD\n';
doc += '  A[' + (G ? '新規ユーザー' : 'New User') + '] --> B[' + (G ? 'アクティブ化' : 'Activation') + ']\n';
doc += '  B --> C[' + (G ? 'エンゲージメント' : 'Engagement') + ']\n';
doc += '  C --> D[' + (G ? 'リテンション' : 'Retention') + ']\n';
doc += '  D --> E[' + (G ? '収益化' : 'Monetization') + ']\n';
doc += '  E --> F[' + (G ? '推奨' : 'Referral') + ']\n';
doc += '  F -.->|' + (G ? 'バイラルループ' : 'Viral Loop') + '| A\n';
doc += '  C -.->|' + (G ? 'チャーン' : 'Churn') + '| G[' + (G ? '離脱' : 'Exit') + ']\n';
doc += '```\n\n';
doc += G
? '**チャーン予測シグナル:**\n- ログイン頻度低下（7日間未ログイン）\n- 主要機能未使用（30日間）\n- サポート問い合わせ増加\n- ダウングレードリクエスト\n\n'
: '**Churn Prediction Signals:**\n- Decreased login frequency (7 days inactive)\n- Core feature non-usage (30 days)\n- Increased support tickets\n- Downgrade requests\n\n';
doc += G
? '**RICE優先度テンプレート（機能開発）:**\n- **Reach（リーチ）:** 影響ユーザー数/月\n- **Impact（影響）:** 1-3スケール（3=高）\n- **Confidence（確信度）:** %（データ有=100%, 仮説=50%）\n- **Effort（工数）:** 人月\n- **スコア:** (R × I × C) / E\n\n'
: '**RICE Prioritization Template (Feature Development):**\n- **Reach:** # users impacted/month\n- **Impact:** 1-3 scale (3=high)\n- **Confidence:** % (data-backed=100%, hypothesis=50%)\n- **Effort:** person-months\n- **Score:** (R × I × C) / E\n\n';
// 5. Accessibility
doc += G ? '## 5. アクセシビリティ競争優位\n\n' : '## 5. Accessibility Competitive Advantage\n\n';
doc += G
? '**WCAG 2.2 AA準拠チェックリスト:**\n- [ ] キーボードナビゲーション完全対応\n- [ ] スクリーンリーダー最適化（ARIA属性）\n- [ ] 色コントラスト比 4.5:1以上\n- [ ] フォーカスインジケータ可視化\n- [ ] 動画字幕・音声説明\n\n'
: '**WCAG 2.2 AA Compliance Checklist:**\n- [ ] Full keyboard navigation\n- [ ] Screen reader optimization (ARIA attributes)\n- [ ] Color contrast ratio ≥4.5:1\n- [ ] Visible focus indicators\n- [ ] Video captions & audio descriptions\n\n';
doc += G
? '**EU Accessibility Act 2025対応:** EC/fintech/booking/content は2025年6月までに対応義務。\n\n'
: '**EU Accessibility Act 2025:** EC/fintech/booking/content must comply by June 2025.\n\n';
// 6. Digital Wellbeing
doc += G ? '## 6. デジタルウェルビーイング設計\n\n' : '## 6. Digital Wellbeing Design\n\n';
doc += G
? '**ダークパターン回避（ドメイン別）:**\n- **EC:** 偽の在庫切れ、偽のタイマー → 透明な在庫表示\n- **community/gamify:** 無限スクロール → 明示的な「もっと見る」\n- **SaaS:** 解約妨害 → 1クリック解約\n\n'
: '**Dark Pattern Avoidance (by domain):**\n- **EC:** Fake scarcity, fake timers → Transparent inventory\n- **community/gamify:** Infinite scroll → Explicit "Load more"\n- **SaaS:** Cancellation obstruction → 1-click cancellation\n\n';
doc += G
? '**倫理的デザイン指標:**\n- ユーザー自律性（設定コントロール）\n- 透明性（アルゴリズム説明）\n- データ最小化（必要最小限収集）\n\n'
: '**Ethical Design Metrics:**\n- User autonomy (control settings)\n- Transparency (algorithm explanations)\n- Data minimization (collect only essentials)\n\n';
doc += G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n';
doc += G ? '**デザイン:** ' : '**Design:** ';
doc += '[Design System](./26_design_system.md)\n\n';
doc += G ? '**戦略:** ' : '**Strategy:** ';
doc += '[Market Positioning](./56_market_positioning.md), [Ecosystem Strategy](./58_ecosystem_strategy.md)\n\n';
doc += G ? '**運用:** ' : '**Operations:** ';
doc += '[Ops Plane Design](./55_ops_plane_design.md)\n\n';
doc += G ? '---\n\n**次のステップ:** doc 58（エコシステム戦略）でパートナーシップを通じたUX向上を検討。\n' : '---\n\n**Next Steps:** Explore UX enhancement through partnerships in doc 58 (Ecosystem Strategy).\n';
return doc;
}
// ============================================================================
// DOC 58: Ecosystem & Platform Strategy
// ============================================================================
function gen58Ecosystem(G, domain, mkt, arch, deploy, answers) {
let doc = '';
doc += G ? '# 58. エコシステム & プラットフォーム戦略\n\n' : '# 58. Ecosystem & Platform Strategy\n\n';
doc += G ? '**対象:** パートナー、開発チーム、投資家\n\n' : '**Audience:** Partners, Dev Team, Investors\n\n';
// 1. API-as-Product Strategy
doc += G ? '## 1. API-as-Product戦略\n\n' : '## 1. API-as-Product Strategy\n\n';
doc += '```mermaid\ngraph LR\n';
doc += '  A[Internal API] --> B[Partner API]\n';
doc += '  B --> C[Public API]\n';
doc += '  C --> D[API Marketplace]\n';
doc += '  A -.->|' + (G ? 'DX改善' : 'DX Improvement') + '| A\n';
doc += '  B -.->|' + (G ? 'SLA・認証' : 'SLA/Auth') + '| B\n';
doc += '  C -.->|' + (G ? 'ドキュメント・SDK' : 'Docs/SDKs') + '| C\n';
doc += '  D -.->|' + (G ? 'マネタイズ' : 'Monetization') + '| D\n';
doc += '```\n\n';
doc += G
? '**成熟モデル:**\n1. **Internal（内部）:** 自社プロダクト用API、DX投資開始\n2. **Partner（パートナー）:** 選定パートナーにAPI提供、SLA・認証追加\n3. **Public（公開）:** 開発者向けドキュメント・SDK、レート制限\n4. **Marketplace（マーケットプレイス）:** API収益化、サードパーティアプリ\n\n'
: '**Maturity Model:**\n1. **Internal:** APIs for own products, DX investment begins\n2. **Partner:** API access for select partners, SLA/auth added\n3. **Public:** Developer docs/SDKs, rate limiting\n4. **Marketplace:** API monetization, third-party apps\n\n';
doc += G ? '**ドメイン別APIプロダクト機会:** ' + mkt.eco_ja + '\n\n' : '**Domain-specific API Product Opportunities:** ' + mkt.eco_en + '\n\n';
const apiMonetize = G
? '**マネタイズモデル:** リクエスト課金、ティア制、プレミアムエンドポイント、SLA保証プラン'
: '**Monetization Models:** Per-request pricing, tier-based, premium endpoints, SLA-backed plans';
doc += apiMonetize + '\n\n';
// 2. Integration Partnership Map
doc += G ? '## 2. インテグレーションパートナーシップマップ\n\n' : '## 2. Integration Partnership Map\n\n';
doc += '| ' + (G ? 'ティア' : 'Tier') + ' | ' + (G ? '優先度' : 'Priority') + ' | ' + (G ? '例' : 'Examples') + ' |\n';
doc += '|---|---|---|\n';
doc += '| Tier 1 | ' + (G ? '必須統合' : 'Essential integrations') + ' | ' + (G ? 'SSO、決済、Email（全ドメイン）' : 'SSO, payments, email (all domains)') + ' |\n';
doc += '| Tier 2 | ' + (G ? 'ドメイン特化' : 'Domain-specific') + ' | ' + (G ? mkt.eco_ja : mkt.eco_en) + ' |\n';
doc += '| Tier 3 | ' + (G ? 'ニッチ・地域特化' : 'Niche/regional') + ' | ' + (G ? 'ローカル決済、地域規制ツール' : 'Local payments, regional compliance tools') + ' |\n\n';
// 3. Developer Experience (DX) Strategy
doc += G ? '## 3. Developer Experience (DX) 戦略\n\n' : '## 3. Developer Experience (DX) Strategy\n\n';
doc += '```mermaid\ngraph TD\n';
doc += '  A[' + (G ? 'Golden Path' : 'Golden Path') + '] --> B[' + (G ? 'ドキュメント' : 'Documentation') + ']\n';
doc += '  A --> C[' + (G ? 'CLI/SDK' : 'CLI/SDKs') + ']\n';
doc += '  A --> D[' + (G ? 'テンプレート' : 'Templates') + ']\n';
doc += '  B --> E[' + (G ? 'クイックスタート' : 'Quick Start') + ']\n';
doc += '  B --> F[' + (G ? 'APIリファレンス' : 'API Reference') + ']\n';
doc += '  C --> G[' + (G ? '多言語SDK' : 'Multi-lang SDKs') + ']\n';
doc += '  D --> H[' + (G ? 'ボイラープレート' : 'Boilerplates') + ']\n';
doc += '```\n\n';
doc += G
? '**内部プラットフォームエンジニアリング（IDP）:**\n- **Golden Path:** 推奨技術スタック・デプロイ手順の標準化\n- **セルフサービス:** 開発者が承認待ちなしでリソースプロビジョニング\n- **ドキュメント駆動:** Architecture Decision Records (ADR)、Runbook\n\n'
: '**Internal Platform Engineering (IDP):**\n- **Golden Path:** Standardized tech stack & deployment procedures\n- **Self-Service:** Developers provision resources without approval wait\n- **Docs-Driven:** Architecture Decision Records (ADR), Runbooks\n\n';
// 4. FinOps / Cloud Cost Strategy
doc += G ? '## 4. FinOps / クラウドコスト戦略\n\n' : '## 4. FinOps / Cloud Cost Strategy\n\n';
const finopsArch = arch === 'baas'
? (G ? 'BaaS（Supabase/Firebase）: 従量課金、スケール時コスト急増リスク → コスト監視必須' : 'BaaS (Supabase/Firebase): Pay-as-you-go, risk of cost surge at scale → Cost monitoring essential')
: (G ? 'Traditional（PostgreSQL+Express）: 固定コスト（VPS/RDS）、スケール予測容易' : 'Traditional (PostgreSQL+Express): Fixed costs (VPS/RDS), easier scale prediction');
doc += '**アーキテクチャ別コスト特性:**\n- ' + finopsArch + '\n\n';
const finopsDeploy = deploy === 'vercel'
? (G ? 'Vercel/Netlify: 無料枠超過後$$$、帯域課金注意' : 'Vercel/Netlify: $$$ after free tier, watch bandwidth costs')
: deploy === 'cloudflare'
? (G ? 'Cloudflare Pages: 最安（無料枠広い）、Workers KV課金' : 'Cloudflare Pages: Cheapest (generous free tier), Workers KV billing')
: deploy === 'aws'
? (G ? 'AWS: 柔軟だが複雑、Reserved Instances/Savings Plans活用' : 'AWS: Flexible but complex, use Reserved Instances/Savings Plans')
: (G ? 'VPS（$5-20/月）、予測可能' : 'VPS ($5-20/mo), predictable');
doc += '**デプロイ先別推奨:**\n- ' + finopsDeploy + '\n\n';
doc += G
? '**ドメイン別コストホットスポット:**\n- **analytics/ai:** データストレージ・計算量\n- **community/content:** CDN帯域\n- **marketplace/ec:** トランザクション・決済手数料\n\n'
: '**Domain-specific Cost Hotspots:**\n- **analytics/ai:** Data storage & compute\n- **community/content:** CDN bandwidth\n- **marketplace/ec:** Transactions & payment fees\n\n';
// 5. Community & OSS Strategy
doc += G ? '## 5. コミュニティ & OSS戦略\n\n' : '## 5. Community & OSS Strategy\n\n';
const ossStrategy = ['tool', 'devtool', 'ai'].includes(domain)
? (G ? '**OSS-First戦略:** コア機能OSSで公開 → コミュニティ貢献 → エンタープライズ機能で収益化（例: GitLab、Supabase）' : '**OSS-First Strategy:** Open-source core → community contributions → monetize enterprise features (e.g., GitLab, Supabase)')
: (G ? '**選択的OSS:** ツール・ライブラリのみOSS、コアビジネスロジックはプロプライエタリ' : '**Selective OSS:** Tools/libraries OSS, core business logic proprietary');
doc += ossStrategy + '\n\n';
doc += G
? '**ドメイン別コミュニティパターン:**\n- **developer/devtool:** GitHub Discussions、Discord、技術ブログ\n- **education:** 教育者コミュニティ、コース共有\n- **community/content:** UGCプラットフォーム、モデレーター育成\n\n'
: '**Domain-specific Community Patterns:**\n- **developer/devtool:** GitHub Discussions, Discord, technical blogs\n- **education:** Educator community, course sharing\n- **community/content:** UGC platform, moderator training\n\n';
doc += G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n';
doc += G ? '**技術基盤:** ' : '**Tech Foundation:** ';
doc += '[Tech Radar](./49_tech_radar.md), [Architecture](./03_architecture.md)\n\n';
doc += G ? '**実装:** ' : '**Implementation:** ';
doc += '[Implementation Playbook](./39_implementation_playbook.md)\n\n';
doc += G ? '**戦略:** ' : '**Strategy:** ';
doc += '[Market Positioning](./56_market_positioning.md), [User Experience Strategy](./57_user_experience_strategy.md)\n\n';
doc += G ? '---\n\n**次のステップ:** doc 59（規制フォーサイト）でエコシステム拡大時の規制リスクを評価。\n' : '---\n\n**Next Steps:** Assess regulatory risks during ecosystem expansion in doc 59 (Regulatory Foresight).\n';
return doc;
}
// ============================================================================
// DOC 59: Regulatory Foresight & Sustainability
// ============================================================================
function gen59Regulatory(G, domain, mkt, answers) {
const deploy = answers.deployment || 'vercel';
let doc = '';
doc += G ? '# 59. 規制フォーサイト & サステナビリティ\n\n' : '# 59. Regulatory Foresight & Sustainability\n\n';
doc += G ? '**対象:** 規制/コンプライアンス、投資家、ビジネス\n\n' : '**Audience:** Regulatory/Compliance, Investors, Business\n\n';
// 1. Regulatory Horizon Scanner
doc += G ? '## 1. 規制ホライズンスキャナー（2026-2030）\n\n' : '## 1. Regulatory Horizon Scanner (2026-2030)\n\n';
doc += '```mermaid\ntimeline\n';
doc += '  title ' + (G ? '規制タイムライン' : 'Regulatory Timeline') + '\n';
const timeline = G ? REGULATORY_HORIZON.timeline_ja : REGULATORY_HORIZON.timeline_en;
timeline.forEach(item => {
const year = item.match(/\d{4}/)[0];
const desc = item.replace(/^\d{4}年?:\s*/, '');
doc += '  ' + year + ' : ' + desc + '\n';
});
doc += '```\n\n';
doc += G ? '**ドメイン別規制影響度:** ' + mkt.reg_ja + '\n\n' : '**Domain-specific Regulatory Impact:** ' + mkt.reg_en + '\n\n';
// 2. EU AI Act Assessment
doc += G ? '## 2. EU AI Act対応度アセスメント\n\n' : '## 2. EU AI Act Compliance Assessment\n\n';
const useAI = answers.ai_auto && answers.ai_auto !== 'none';
if (useAI) {
const aiRisk = ['fintech', 'health', 'legal', 'hr'].includes(domain);
const riskLevel = aiRisk ? (G ? '高リスク' : 'High-Risk') : (G ? '限定リスク' : 'Limited Risk');
const aiActDesc = G ? REGULATORY_HORIZON.ai_act_risk_ja : REGULATORY_HORIZON.ai_act_risk_en;
doc += '**AIリスク分類:** ' + riskLevel + '\n\n';
doc += '**該当規制:** ' + (aiRisk ? aiActDesc.high : aiActDesc.limited) + '\n\n';
if (aiRisk) {
doc += G
? '**必須ドキュメント:**\n- [ ] AIシステムリスク評価書\n- [ ] データセット品質・バイアス監査\n- [ ] 透明性レポート（ユーザー向けAI使用説明）\n- [ ] 人間監視プロセス文書\n\n'
: '**Required Documentation:**\n- [ ] AI system risk assessment\n- [ ] Dataset quality & bias audit\n- [ ] Transparency report (user-facing AI usage explanation)\n- [ ] Human oversight process documentation\n\n';
}
} else {
doc += G ? '**AI未使用** — EU AI Act直接適用なし（ただし将来のAI導入時は再評価）\n\n' : '**No AI usage** — EU AI Act not directly applicable (re-assess upon future AI adoption)\n\n';
}
// 3. ESG & Sustainability
doc += G ? '## 3. ESG & サステナビリティ指標\n\n' : '## 3. ESG & Sustainability Metrics\n\n';
doc += '```mermaid\nmindmap\n  root((ESG))\n    ' + (G ? '環境' : 'Environmental') + '\n      ' + (G ? 'カーボンフットプリント' : 'Carbon Footprint') + '\n      ' + (G ? 'グリーンホスティング' : 'Green Hosting') + '\n    ' + (G ? '社会' : 'Social') + '\n      ' + (G ? 'アクセシビリティ' : 'Accessibility') + '\n      ' + (G ? 'DEI指標' : 'DEI Metrics') + '\n    ' + (G ? 'ガバナンス' : 'Governance') + '\n      ' + (G ? 'データ倫理' : 'Data Ethics') + '\n      ' + (G ? '透明性' : 'Transparency') + '\n```\n\n';
const carbonDeploy = deploy === 'cloudflare'
? (G ? 'Cloudflare（100%再生可能エネルギー）' : 'Cloudflare (100% renewable energy)')
: deploy === 'vercel'
? (G ? 'Vercel（カーボンニュートラル目標、AWS Graviton使用）' : 'Vercel (carbon-neutral goal, AWS Graviton)')
: (G ? 'クラウドプロバイダの再生可能エネルギー利用率を確認' : 'Check cloud provider renewable energy usage');
doc += G
? '**カーボンフットプリント推定:**\n- デプロイ先: ' + carbonDeploy + '\n- ドメイン別: analytics/ai（高計算量）> community/content（帯域）> portfolio（低）\n\n'
: '**Carbon Footprint Estimation:**\n- Deployment: ' + carbonDeploy + '\n- By domain: analytics/ai (high compute) > community/content (bandwidth) > portfolio (low)\n\n';
doc += G ? '**ドメイン別ESG優先事項:** ' + mkt.esg_ja + '\n\n' : '**Domain-specific ESG Priorities:** ' + mkt.esg_en + '\n\n';
doc += G
? '**CSRD/SEC開示要件（2026-2027）:**\n- EU CSRD: 大企業は2024年度から、中小企業は2026年度から（段階適用）\n- SEC Climate Rule: 米国上場企業、Scope 1/2排出量開示義務\n\n'
: '**CSRD/SEC Disclosure Requirements (2026-2027):**\n- EU CSRD: Large companies from FY2024, SMEs from FY2026 (phased)\n- SEC Climate Rule: US public companies, Scope 1/2 emissions disclosure\n\n';
// 4. Data Sovereignty & Privacy Evolution
doc += G ? '## 4. データ主権 & プライバシー進化\n\n' : '## 4. Data Sovereignty & Privacy Evolution\n\n';
const sovereignty = G ? REGULATORY_HORIZON.data_sovereignty_ja : REGULATORY_HORIZON.data_sovereignty_en;
sovereignty.forEach(item => {
doc += '- ' + item + '\n';
});
doc += '\n';
doc += G
? '**PETs（プライバシー強化技術）ロードマップ:**\n- **2026:** 連合学習（Federated Learning）の主流化（health/fintech）\n- **2027:** 差分プライバシー（Differential Privacy）義務化検討\n- **2028:** 完全同型暗号（FHE）商用化加速\n\n'
: '**PETs (Privacy-Enhancing Technologies) Roadmap:**\n- **2026:** Federated Learning mainstream (health/fintech)\n- **2027:** Differential Privacy regulation consideration\n- **2028:** Fully Homomorphic Encryption (FHE) commercialization accelerates\n\n';
doc += G
? '**児童プライバシー進化:**\n- COPPA改正（米、2026予定）: 13歳→16歳に引き上げ検討\n- UK Age Appropriate Design Code: EU全域への拡大\n\n'
: '**Children Privacy Evolution:**\n- COPPA revision (US, expected 2026): Age threshold 13→16 under consideration\n- UK Age Appropriate Design Code: Expansion to EU-wide\n\n';
// 5. Resilience Engineering
doc += G ? '## 5. レジリエンスエンジニアリング\n\n' : '## 5. Resilience Engineering\n\n';
doc += G
? '**カオスエンジニアリング準備度チェックリスト:**\n- [ ] 本番環境で障害注入実験（Chaos Monkey）\n- [ ] Incident Response Playbook整備\n- [ ] ポストモーテム文化（Blameless）\n- [ ] SLOベースアラート（P14参照）\n\n'
: '**Chaos Engineering Readiness Checklist:**\n- [ ] Fault injection experiments in production (Chaos Monkey)\n- [ ] Incident Response Playbook\n- [ ] Blameless postmortem culture\n- [ ] SLO-based alerting (see P14)\n\n';
if (domain === 'fintech') {
doc += G
? '**EU DORA（金融）コンプライアンス（2025年1月施行）:**\n- [ ] ICTリスク管理フレームワーク\n- [ ] サードパーティリスク評価（クラウドプロバイダ）\n- [ ] インシデント報告（72時間以内）\n- [ ] デジタルレジリエンステスト（年次）\n\n'
: '**EU DORA (Finance) Compliance (Effective Jan 2025):**\n- [ ] ICT risk management framework\n- [ ] Third-party risk assessment (cloud providers)\n- [ ] Incident reporting (within 72 hours)\n- [ ] Digital resilience testing (annual)\n\n';
}
doc += G
? '**アンチフラジャイル原則:**\n- 障害から学習（ポストモーテム）\n- 小さな障害を歓迎（大障害を防ぐ）\n- オプショナリティ（技術選択の柔軟性維持）\n\n'
: '**Antifragile Principles:**\n- Learn from failures (postmortems)\n- Welcome small failures (prevent large ones)\n- Optionality (maintain tech choice flexibility)\n\n';
doc += G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n';
doc += G ? '**セキュリティ:** ' : '**Security:** ';
doc += '[Security Intelligence](./43_security_intelligence.md), [Compliance Matrix](./45_compliance_matrix.md), [AI Security](./46_ai_security.md)\n\n';
doc += G ? '**戦略:** ' : '**Strategy:** ';
doc += '[Industry Blueprint](./48_industry_blueprint.md), [Ecosystem Strategy](./58_ecosystem_strategy.md)\n\n';
doc += G ? '**計画:** ' : '**Planning:** ';
doc += '[Roadmap](./10_gantt.md)\n\n';
doc += G ? '---\n\n**次のステップ:** 規制タイムラインをプロダクトロードマップ（docs/10_gantt.md）に反映。四半期ごとにこのドキュメントを更新し、新規制を監視。\n' : '---\n\n**Next Steps:** Reflect regulatory timeline into product roadmap (docs/10_gantt.md). Update this document quarterly to monitor new regulations.\n';
return doc;
}
// ============================================================================
// EXPORTS
// ============================================================================
if (typeof module !== 'undefined' && module.exports) {
module.exports = { genPillar15, DOMAIN_MARKET, PERSONA_ARCHETYPES, GTM_STRATEGY, REGULATORY_HORIZON };
}
// P16: Polymorphic Development Intelligence Generator
// Generates: docs/60_methodology_intelligence.md, 61_ai_brainstorm_playbook.md, 62_industry_deep_dive.md, 63_next_gen_ux_strategy.md

// ============================================================================
// DATA CONSTANTS
// ============================================================================

// DEV_METHODOLOGY_MAP: Domain-specific optimal methodology combinations (32 domains + default)
// Maps domains to optimal combinations of 12 design approaches from 駆動開発 AI壁打ちプロンプトテンプレート集
const DEV_METHODOLOGY_MAP = {
education: {
primary_ja: 'フロー状態設計 + プログレッシブ開示',
primary_en: 'Flow State + Progressive Disclosure',
secondary_ja: '認知負荷最小化 + インクルーシブ',
secondary_en: 'Cognitive Load Min. + Inclusive',
rationale_ja: '学習は集中フロー維持が最重要。情報を段階的に開示し、認知負荷を抑えつつ、多様な学習スタイルに対応する必要がある。',
rationale_en: 'Learning requires sustained flow. Information should be progressively disclosed while minimizing cognitive load and supporting diverse learning styles.',
kw_ja: ['フロー維持','マイクロラーニング','段階的開示','アクセシブル'],
kw_en: ['Flow state','Microlearning','Progressive disclosure','Accessible']
},
ec: {
primary_ja: 'エモーショナル + 時間価値最大化',
primary_en: 'Emotional + Time Value Max.',
secondary_ja: 'コンテキスト適応 + データドリブン',
secondary_en: 'Context Adaptive + Data-Driven',
rationale_ja: 'ECは感情価値（欲しい！）と効率（すぐ買える）の両立が鍵。文脈に応じたレコメンド、データ分析による継続的CVR改善が必須。',
rationale_en: 'E-commerce requires balancing emotional value (desire) with efficiency (quick purchase). Context-aware recommendations and data-driven CVR optimization are essential.',
kw_ja: ['一目惚れUI','ワンクリック購入','パーソナライズ','A/Bテスト'],
kw_en: ['Love at first sight UI','One-click purchase','Personalization','A/B testing']
},
fintech: {
primary_ja: 'レジリエント + データドリブン',
primary_en: 'Resilient + Data-Driven',
secondary_ja: '認知負荷最小化 + インクルーシブ',
secondary_en: 'Cognitive Load Min. + Inclusive',
rationale_ja: '金融は信頼が命。エラー回復力、セキュリティ透明性、誰にでも分かりやすいUI、データに基づく不正検知が重要。',
rationale_en: 'Finance demands trust. Error resilience, security transparency, intuitive UI for all users, and data-driven fraud detection are critical.',
kw_ja: ['冪等性','自己修復','透明な取引履歴','金融リテラシー配慮'],
kw_en: ['Idempotency','Self-healing','Transparent transaction history','Financial literacy consideration']
},
health: {
primary_ja: 'レジリエント + インクルーシブ',
primary_en: 'Resilient + Inclusive',
secondary_ja: 'プログレッシブ開示 + 認知負荷最小化',
secondary_en: 'Progressive Disclosure + Cognitive Load Min.',
rationale_ja: '医療は可用性99.99%必須。高齢者・障がい者対応、プライバシー配慮、専門用語の段階的説明が求められる。',
rationale_en: 'Healthcare requires 99.99% availability. Elderly/disabled support, privacy consideration, and progressive explanation of medical terms are essential.',
kw_ja: ['WCAG AAA','緊急時フェイルセーフ','平易な医療情報','多言語対応'],
kw_en: ['WCAG AAA','Emergency failsafe','Plain medical info','Multilingual']
},
saas: {
primary_ja: 'プログレッシブ開示 + データドリブン',
primary_en: 'Progressive Disclosure + Data-Driven',
secondary_ja: '時間価値最大化 + アトミック設計',
secondary_en: 'Time Value Max. + Atomic Design',
rationale_ja: 'SaaSは自己学習とオンボーディングが成否を分ける。段階的に機能を開示し、使用量データでUX改善、再利用可能なコンポーネント設計。',
rationale_en: 'SaaS success depends on self-learning and onboarding. Progressive feature disclosure, usage data for UX improvement, and reusable component design.',
kw_ja: ['セルフサービス','使用量可視化','コンポーネントライブラリ','PQLトラッキング'],
kw_en: ['Self-service','Usage visibility','Component library','PQL tracking']
},
marketplace: {
primary_ja: 'データドリブン + レジリエント',
primary_en: 'Data-Driven + Resilient',
secondary_ja: 'エモーショナル + インクルーシブ',
secondary_en: 'Emotional + Inclusive',
rationale_ja: 'マーケットプレイスは信頼シグナル（レビュー）とマッチング精度がKPI。エラー回復（決済失敗等）、多様なユーザー層対応が必須。',
rationale_en: 'Marketplace KPIs are trust signals (reviews) and matching accuracy. Error recovery (payment failure) and diverse user support are essential.',
kw_ja: ['レビュー信頼性','リアルタイムマッチング','エスクロー','多様性配慮'],
kw_en: ['Review credibility','Real-time matching','Escrow','Diversity consideration']
},
community: {
primary_ja: 'エモーショナル + データドリブン',
primary_en: 'Emotional + Data-Driven',
secondary_ja: 'フロー状態設計 + インクルーシブ',
secondary_en: 'Flow State + Inclusive',
rationale_ja: 'コミュニティはエンゲージメントが全て。感情的つながり、フロー状態維持（無限スクロール）、データ分析による有害コンテンツ排除。',
rationale_en: 'Community is all about engagement. Emotional connection, flow state maintenance (infinite scroll), and data-driven harmful content removal.',
kw_ja: ['UGC推奨','デイリーストリーク','モデレーション','セーフスペース'],
kw_en: ['UGC promotion','Daily streak','Moderation','Safe space']
},
content: {
primary_ja: 'フロー状態設計 + エモーショナル',
primary_en: 'Flow State + Emotional',
secondary_ja: 'プログレッシブ開示 + データドリブン',
secondary_en: 'Progressive Disclosure + Data-Driven',
rationale_ja: 'コンテンツ消費は没入体験とストーリーテリングが鍵。読了率・視聴完了率をKPIにデータ分析。',
rationale_en: 'Content consumption requires immersive experience and storytelling. Read/watch completion rates are key KPIs for data analysis.',
kw_ja: ['ストーリーテリング','読了率','レコメンドエンジン','没入UI'],
kw_en: ['Storytelling','Completion rate','Recommendation engine','Immersive UI']
},
analytics: {
primary_ja: 'データドリブン + 認知負荷最小化',
primary_en: 'Data-Driven + Cognitive Load Min.',
secondary_ja: 'プログレッシブ開示 + 時間価値最大化',
secondary_en: 'Progressive Disclosure + Time Value Max.',
rationale_ja: '分析ツールは複雑性との戦い。情報の段階的開示、直感的ダッシュボード、クイック分析機能が重要。',
rationale_en: 'Analytics tools battle complexity. Progressive information disclosure, intuitive dashboards, and quick analysis features are crucial.',
kw_ja: ['ビジュアル分析','ドリルダウン','クイックインサイト','認知負荷設計'],
kw_en: ['Visual analytics','Drill-down','Quick insights','Cognitive load design']
},
booking: {
primary_ja: '時間価値最大化 + コンテキスト適応',
primary_en: 'Time Value Max. + Context Adaptive',
secondary_ja: 'レジリエント + プログレッシブ開示',
secondary_en: 'Resilient + Progressive Disclosure',
rationale_ja: '予約は時間軸が命。最短での予約完了、キャンセル/変更の柔軟性、在庫リアルタイム反映が必須。',
rationale_en: 'Booking is all about time. Quick reservation completion, flexible cancellation/changes, and real-time inventory are essential.',
kw_ja: ['カレンダーUI','リアルタイム在庫','ワンクリック予約','自動リマインド'],
kw_en: ['Calendar UI','Real-time inventory','One-click booking','Auto reminder']
},
iot: {
primary_ja: 'レジリエント + コンテキスト適応',
primary_en: 'Resilient + Context Adaptive',
secondary_ja: 'データドリブン + サステナブル',
secondary_en: 'Data-Driven + Sustainable',
rationale_ja: 'IoTはオフライン耐性とエッジ処理が鍵。センサーデータ分析、省電力設計、自己修復機能。',
rationale_en: 'IoT requires offline resilience and edge processing. Sensor data analysis, power-saving design, and self-healing functions.',
kw_ja: ['エッジコンピューティング','オフラインファースト','省電力','異常検知'],
kw_en: ['Edge computing','Offline-first','Power-saving','Anomaly detection']
},
realestate: {
primary_ja: 'エモーショナル + データドリブン',
primary_en: 'Emotional + Data-Driven',
secondary_ja: 'コンテキスト適応 + プログレッシブ開示',
secondary_en: 'Context Adaptive + Progressive Disclosure',
rationale_ja: '不動産は感情的決断と理性的比較の両立。VRツアー、周辺情報、価格トレンド分析、ライフスタイル提案。',
rationale_en: 'Real estate balances emotional decisions with rational comparison. VR tours, neighborhood info, price trend analysis, lifestyle proposals.',
kw_ja: ['VRツアー','周辺情報統合','価格分析','ライフスタイル提案'],
kw_en: ['VR tour','Neighborhood integration','Price analysis','Lifestyle proposal']
},
legal: {
primary_ja: 'レジリエント + 認知負荷最小化',
primary_en: 'Resilient + Cognitive Load Min.',
secondary_ja: 'データドリブン + インクルーシブ',
secondary_en: 'Data-Driven + Inclusive',
rationale_ja: '法務は正確性とトレーサビリティが命。専門用語の平易化、バージョン管理、監査ログ、アクセシビリティ。',
rationale_en: 'Legal requires accuracy and traceability. Plain language for jargon, version control, audit logs, and accessibility.',
kw_ja: ['バージョン管理','監査ログ','平易な法律用語','電子署名'],
kw_en: ['Version control','Audit log','Plain legal language','E-signature']
},
hr: {
primary_ja: 'インクルーシブ + データドリブン',
primary_en: 'Inclusive + Data-Driven',
secondary_ja: 'エモーショナル + 認知負荷最小化',
secondary_en: 'Emotional + Cognitive Load Min.',
rationale_ja: 'HRは多様性と公平性が最重要。バイアス排除、データ駆動採用、従業員体験（EX）設計。',
rationale_en: 'HR prioritizes diversity and equity. Bias elimination, data-driven recruitment, and employee experience (EX) design.',
kw_ja: ['バイアス排除','従業員体験','スキル可視化','多様性指標'],
kw_en: ['Bias elimination','Employee experience','Skill visibility','Diversity metrics']
},
portfolio: {
primary_ja: 'エモーショナル + アトミック設計',
primary_en: 'Emotional + Atomic Design',
secondary_ja: 'フロー状態設計 + サステナブル',
secondary_en: 'Flow State + Sustainable',
rationale_ja: 'ポートフォリオはストーリーテリングと美的体験。再利用可能コンポーネント、滑らかな遷移、軽量設計。',
rationale_en: 'Portfolio is about storytelling and aesthetic experience. Reusable components, smooth transitions, and lightweight design.',
kw_ja: ['ストーリーテリング','マイクロインタラクション','コンポーネント','軽量化'],
kw_en: ['Storytelling','Micro-interactions','Components','Lightweight']
},
tool: {
primary_ja: '時間価値最大化 + 認知負荷最小化',
primary_en: 'Time Value Max. + Cognitive Load Min.',
secondary_ja: 'プログレッシブ開示 + アトミック設計',
secondary_en: 'Progressive Disclosure + Atomic Design',
rationale_ja: 'ツールは生産性が全て。最短操作、ショートカット、段階的な高度機能開示、一貫したUI。',
rationale_en: 'Tools are all about productivity. Minimal operations, shortcuts, progressive advanced feature disclosure, consistent UI.',
kw_ja: ['ショートカット','クイックアクション','コマンドパレット','一貫性'],
kw_en: ['Shortcuts','Quick actions','Command palette','Consistency']
},
ai: {
primary_ja: 'AIファースト + コンテキスト適応',
primary_en: 'AI-First + Context Adaptive',
secondary_ja: 'データドリブン + プログレッシブ開示',
secondary_en: 'Data-Driven + Progressive Disclosure',
rationale_ja: 'AIアプリは文脈理解と継続学習が鍵。プロンプト設計、フィードバックループ、段階的な信頼構築。',
rationale_en: 'AI apps require context understanding and continuous learning. Prompt design, feedback loops, and progressive trust building.',
kw_ja: ['プロンプト最適化','フィードバックループ','信頼構築','説明可能性'],
kw_en: ['Prompt optimization','Feedback loop','Trust building','Explainability']
},
automation: {
primary_ja: 'レジリエント + AIファースト',
primary_en: 'Resilient + AI-First',
secondary_ja: '時間価値最大化 + データドリブン',
secondary_en: 'Time Value Max. + Data-Driven',
rationale_ja: '自動化は信頼性と効率。エラー自己修復、AI判断、実行ログ、ROI可視化。',
rationale_en: 'Automation requires reliability and efficiency. Error self-healing, AI judgment, execution logs, ROI visibility.',
kw_ja: ['自己修復','AI判断','実行ログ','ROI可視化'],
kw_en: ['Self-healing','AI judgment','Execution log','ROI visibility']
},
event: {
primary_ja: '時間価値最大化 + エモーショナル',
primary_en: 'Time Value Max. + Emotional',
secondary_ja: 'コンテキスト適応 + データドリブン',
secondary_en: 'Context Adaptive + Data-Driven',
rationale_ja: 'イベントは時間軸とワクワク感。リアルタイム更新、ソーシャル機能、参加前後の体験設計。',
rationale_en: 'Events are about timeline and excitement. Real-time updates, social features, pre/post-event experience design.',
kw_ja: ['リアルタイム','ソーシャル','カウントダウン','思い出機能'],
kw_en: ['Real-time','Social','Countdown','Memory feature']
},
gamify: {
primary_ja: 'フロー状態設計 + エモーショナル',
primary_en: 'Flow State + Emotional',
secondary_ja: 'データドリブン + プログレッシブ開示',
secondary_en: 'Data-Driven + Progressive Disclosure',
rationale_ja: 'ゲーミフィケーションは没入とモチベーション。難易度調整、報酬設計、プログレス可視化。',
rationale_en: 'Gamification is about immersion and motivation. Difficulty adjustment, reward design, progress visualization.',
kw_ja: ['難易度調整','報酬設計','プログレス可視化','ストリーク'],
kw_en: ['Difficulty adjustment','Reward design','Progress visualization','Streak']
},
collab: {
primary_ja: 'レジリエント + フロー状態設計',
primary_en: 'Resilient + Flow State',
secondary_ja: 'コンテキスト適応 + データドリブン',
secondary_en: 'Context Adaptive + Data-Driven',
rationale_ja: 'コラボツールは同期性と競合解決。リアルタイムOT/CRDT、プレゼンス、コンフリクト自動解決。',
rationale_en: 'Collaboration tools require synchronization and conflict resolution. Real-time OT/CRDT, presence, auto conflict resolution.',
kw_ja: ['リアルタイム同期','CRDT','プレゼンス','競合解決'],
kw_en: ['Real-time sync','CRDT','Presence','Conflict resolution']
},
devtool: {
primary_ja: '時間価値最大化 + アトミック設計',
primary_en: 'Time Value Max. + Atomic Design',
secondary_ja: 'データドリブン + 認知負荷最小化',
secondary_en: 'Data-Driven + Cognitive Load Min.',
rationale_ja: '開発ツールは生産性とDX。ショートカット、拡張性、メトリクス可視化、学習曲線最小化。',
rationale_en: 'Dev tools prioritize productivity and DX. Shortcuts, extensibility, metrics visualization, minimal learning curve.',
kw_ja: ['CLI/GUI両立','拡張性','メトリクス','ドキュメント'],
kw_en: ['CLI/GUI hybrid','Extensibility','Metrics','Documentation']
},
creator: {
primary_ja: 'フロー状態設計 + エモーショナル',
primary_en: 'Flow State + Emotional',
secondary_ja: 'AIファースト + アトミック設計',
secondary_en: 'AI-First + Atomic Design',
rationale_ja: 'クリエイターツールは創作フロー維持が命。AI補助、テンプレート、無限キャンバス、保存の自動化。',
rationale_en: 'Creator tools prioritize creative flow. AI assistance, templates, infinite canvas, auto-save.',
kw_ja: ['無限キャンバス','AI補助','自動保存','テンプレート'],
kw_en: ['Infinite canvas','AI assistance','Auto-save','Templates']
},
newsletter: {
primary_ja: 'エモーショナル + データドリブン',
primary_en: 'Emotional + Data-Driven',
secondary_ja: '時間価値最大化 + コンテキスト適応',
secondary_en: 'Time Value Max. + Context Adaptive',
rationale_ja: 'ニュースレターは開封率とエンゲージメント。A/Bテスト、セグメント配信、パーソナライズ、配信時間最適化。',
rationale_en: 'Newsletters prioritize open rates and engagement. A/B testing, segmented delivery, personalization, optimal timing.',
kw_ja: ['開封率最適化','セグメント','A/Bテスト','パーソナライズ'],
kw_en: ['Open rate optimization','Segmentation','A/B testing','Personalization']
},
manufacturing: {
primary_ja: 'レジリエント + データドリブン',
primary_en: 'Resilient + Data-Driven',
secondary_ja: '時間価値最大化 + サステナブル',
secondary_en: 'Time Value Max. + Sustainable',
rationale_ja: '製造は稼働率と品質。予知保全、リアルタイムモニタリング、省エネ、トレーサビリティ。',
rationale_en: 'Manufacturing prioritizes uptime and quality. Predictive maintenance, real-time monitoring, energy-saving, traceability.',
kw_ja: ['予知保全','IoT連携','省エネ','品質管理'],
kw_en: ['Predictive maintenance','IoT integration','Energy-saving','Quality control']
},
logistics: {
primary_ja: '時間価値最大化 + レジリエント',
primary_en: 'Time Value Max. + Resilient',
secondary_ja: 'データドリブン + コンテキスト適応',
secondary_en: 'Data-Driven + Context Adaptive',
rationale_ja: '物流はスピードと正確性。リアルタイム追跡、ルート最適化、異常検知、配送時間予測。',
rationale_en: 'Logistics prioritizes speed and accuracy. Real-time tracking, route optimization, anomaly detection, delivery time prediction.',
kw_ja: ['リアルタイム追跡','ルート最適化','異常検知','配送予測'],
kw_en: ['Real-time tracking','Route optimization','Anomaly detection','Delivery prediction']
},
agriculture: {
primary_ja: 'データドリブン + サステナブル',
primary_en: 'Data-Driven + Sustainable',
secondary_ja: 'IoT連携 + コンテキスト適応',
secondary_en: 'IoT Integration + Context Adaptive',
rationale_ja: '農業はデータ活用と環境配慮。センサーデータ分析、気象予測連携、資源最適化、トレーサビリティ。',
rationale_en: 'Agriculture prioritizes data utilization and environmental care. Sensor data analysis, weather forecast integration, resource optimization, traceability.',
kw_ja: ['センサー分析','気象連携','資源最適化','トレーサビリティ'],
kw_en: ['Sensor analysis','Weather integration','Resource optimization','Traceability']
},
energy: {
primary_ja: 'レジリエント + サステナブル',
primary_en: 'Resilient + Sustainable',
secondary_ja: 'データドリブン + 時間価値最大化',
secondary_en: 'Data-Driven + Time Value Max.',
rationale_ja: 'エネルギーは安定供給と脱炭素。需給予測、ピークシフト、再エネ統合、停電耐性。',
rationale_en: 'Energy prioritizes stable supply and decarbonization. Demand forecasting, peak shifting, renewable integration, blackout resilience.',
kw_ja: ['需給予測','ピークシフト','再エネ統合','停電耐性'],
kw_en: ['Demand forecasting','Peak shifting','Renewable integration','Blackout resilience']
},
media: {
primary_ja: 'フロー状態設計 + エモーショナル',
primary_en: 'Flow State + Emotional',
secondary_ja: 'データドリブン + コンテキスト適応',
secondary_en: 'Data-Driven + Context Adaptive',
rationale_ja: 'メディアは没入とストーリーテリング。視聴完了率、レコメンド、デバイス最適化、オフライン再生。',
rationale_en: 'Media prioritizes immersion and storytelling. Completion rate, recommendations, device optimization, offline playback.',
kw_ja: ['没入体験','レコメンド','デバイス最適化','オフライン'],
kw_en: ['Immersive experience','Recommendations','Device optimization','Offline']
},
government: {
primary_ja: 'インクルーシブ + レジリエント',
primary_en: 'Inclusive + Resilient',
secondary_ja: '認知負荷最小化 + データドリブン',
secondary_en: 'Cognitive Load Min. + Data-Driven',
rationale_ja: '行政はアクセシビリティと信頼性。WCAG AAA準拠、多言語対応、災害時稼働、監査ログ。',
rationale_en: 'Government prioritizes accessibility and reliability. WCAG AAA compliance, multilingual support, disaster resilience, audit logs.',
kw_ja: ['WCAG AAA','多言語','災害対応','監査ログ'],
kw_en: ['WCAG AAA','Multilingual','Disaster response','Audit log']
},
travel: {
primary_ja: 'エモーショナル + コンテキスト適応',
primary_en: 'Emotional + Context Adaptive',
secondary_ja: 'データドリブン + 時間価値最大化',
secondary_en: 'Data-Driven + Time Value Max.',
rationale_ja: '旅行はワクワク感と利便性。パーソナライズ提案、リアルタイム情報、オフライン対応、思い出機能。',
rationale_en: 'Travel prioritizes excitement and convenience. Personalized suggestions, real-time info, offline support, memory features.',
kw_ja: ['パーソナライズ','リアルタイム','オフライン','思い出'],
kw_en: ['Personalized','Real-time','Offline','Memory']
},
insurance: {
primary_ja: 'レジリエント + 認知負荷最小化',
primary_en: 'Resilient + Cognitive Load Min.',
secondary_ja: 'データドリブン + インクルーシブ',
secondary_en: 'Data-Driven + Inclusive',
rationale_ja: '保険は信頼性と分かりやすさ。専門用語の平易化、リスク可視化、迅速な審査・支払い、バイアス排除。',
rationale_en: 'Insurance prioritizes reliability and clarity. Plain language for jargon, risk visualization, quick claims processing, bias elimination.',
kw_ja: ['平易な約款','リスク可視化','迅速審査','バイアス排除'],
kw_en: ['Plain policy','Risk visualization','Quick claims','Bias elimination']
},
_default: {
primary_ja: 'データドリブン + 認知負荷最小化',
primary_en: 'Data-Driven + Cognitive Load Min.',
secondary_ja: '時間価値最大化 + レジリエント',
secondary_en: 'Time Value Max. + Resilient',
rationale_ja: '汎用アプリは測定可能性とユーザビリティが基本。データ分析、直感的UI、効率性、エラー回復力。',
rationale_en: 'General apps prioritize measurability and usability. Data analysis, intuitive UI, efficiency, error resilience.',
kw_ja: ['測定可能性','直感的UI','効率性','回復力'],
kw_en: ['Measurability','Intuitive UI','Efficiency','Resilience']
}
};
// PHASE_PROMPTS: 6-phase AI brainstorming prompt templates (from 駆動開発 AI壁打ちプロンプトテンプレート集)
const PHASE_PROMPTS = {
p0: {
title_ja: 'Phase 0: プロジェクト初期構想',
title_en: 'Phase 0: Project Conception',
tpl: [
{
id: 'approach_select',
label_ja: '設計アプローチ選定',
label_en: 'Design Approach Selection',
prompt_ja: 'プロジェクト「{projectName}」（業種: {domain}）において、最適な設計アプローチを12の選択肢（フロー状態、認知負荷最小化、時間価値最大化、コンテキスト適応、プログレッシブ開示、レジリエント、アトミック、データドリブン、インクルーシブ、エモーショナル、AIファースト、サステナブル）から3-5個選定してください。各アプローチの選定理由と期待効果を明記し、組み合わせシナジーを分析してください。',
prompt_en: 'For project "{projectName}" (domain: {domain}), select 3-5 optimal design approaches from 12 options (Flow State, Cognitive Load Min., Time Value Max., Context Adaptive, Progressive Disclosure, Resilient, Atomic, Data-Driven, Inclusive, Emotional, AI-First, Sustainable). Provide selection rationale, expected effects, and analyze synergies.'
},
{
id: 'constraint_analysis',
label_ja: '制約条件分析',
label_en: 'Constraint Analysis',
prompt_ja: 'プロジェクト「{projectName}」の制約条件（予算/期間/リソース/技術スタック: {stack}）を分析し、トレードオフパターン（速度優先/品質優先/バランス型）を提示してください。各パターンのメリット・デメリット、リスク管理計画、段階的実装ロードマップを含めてください。',
prompt_en: 'Analyze constraints for "{projectName}" (budget/timeline/resources/tech stack: {stack}). Present trade-off patterns (speed-first/quality-first/balanced). Include merits, demerits, risk management plan, and phased implementation roadmap.'
},
{
id: 'kpi_define',
label_ja: '成功指標（KPI）定義',
label_en: 'Success Metrics (KPI) Definition',
prompt_ja: 'プロジェクト「{projectName}」の選定設計アプローチ（{methodology}）に基づき、測定可能な成功指標を定義してください。ユーザー体験指標（例: タスク完了時間、初回成功率）、ビジネス指標（CVR、継続率、LTV）、技術指標（LCP、FID、CLS、エラー率）を含め、測定方法とダッシュボード設計を提案してください。',
prompt_en: 'Define measurable success metrics for "{projectName}" based on selected methodology ({methodology}). Include UX metrics (e.g., task completion time, first-time success rate), business metrics (CVR, retention, LTV), and technical metrics (LCP, FID, CLS, error rate). Propose measurement methods and dashboard design.'
}
]
},
p1: {
title_ja: 'Phase 1: 要件定義',
title_en: 'Phase 1: Requirements',
tpl: [
{
id: 'user_analysis',
label_ja: '多角的ユーザー分析',
label_en: 'Multi-faceted User Analysis',
prompt_ja: 'プロジェクト「{projectName}」のターゲットユーザーを、行動分析（データドリブン視点）、認知分析（認知負荷視点）、感情分析（エモーショナル視点）、文脈分析（コンテキスト視点）の4軸で深掘りしてください。各視点から得られるインサイトと設計への示唆を明記してください。',
prompt_en: 'Deep-dive target users for "{projectName}" from 4 perspectives: behavioral analysis (data-driven), cognitive analysis (cognitive load), emotional analysis (emotional), and contextual analysis (context). Clarify insights and design implications from each perspective.'
},
{
id: 'problem_mapping',
label_ja: '問題構造マッピング',
label_en: 'Problem Structure Mapping',
prompt_ja: 'プロジェクト「{projectName}」が解決する問題を構造化してください。根本原因（5 Whys分析）、問題の影響範囲、競合他社の解決策、差別化ポイント、価値提案をマッピングし、Mermaidマインドマップ形式で可視化してください。',
prompt_en: 'Structure the problem "{projectName}" solves. Map root causes (5 Whys analysis), impact scope, competitor solutions, differentiation points, and value proposition. Visualize as Mermaid mindmap.'
},
{
id: 'feature_priority',
label_ja: '機能優先度マトリクス',
label_en: 'Feature Priority Matrix',
prompt_ja: 'プロジェクト「{projectName}」の機能候補を、MoSCoW法（Must/Should/Could/Won\'t）で分類し、さらにKano分析（基本品質/性能品質/魅力品質）でユーザー満足度への影響を評価してください。MVP（最小実行可能製品）に含める機能を明示してください。',
prompt_en: 'Classify feature candidates for "{projectName}" using MoSCoW (Must/Should/Could/Won\'t) and evaluate user satisfaction impact with Kano analysis (basic/performance/delight). Specify features for MVP.'
}
]
},
p2: {
title_ja: 'Phase 2: 設計',
title_en: 'Phase 2: Design',
tpl: [
{
id: 'info_arch',
label_ja: '情報アーキテクチャ設計',
label_en: 'Information Architecture Design',
prompt_ja: 'プロジェクト「{projectName}」の情報アーキテクチャを、認知負荷最小化の観点で設計してください。ナビゲーション階層（最大3クリックルール）、カテゴリー分類（カードソート結果を反映）、検索設計（ファセット/フィルター）、パンくずリスト設計を含めてください。Mermaid図で可視化してください。',
prompt_en: 'Design information architecture for "{projectName}" from cognitive load minimization perspective. Include navigation hierarchy (max 3-click rule), category classification (reflecting card sort results), search design (faceted/filtered), breadcrumb design. Visualize with Mermaid.'
},
{
id: 'interaction',
label_ja: 'インタラクション設計',
label_en: 'Interaction Design',
prompt_ja: 'プロジェクト「{projectName}」の主要インタラクションを、フロー状態維持の観点で設計してください。マイクロインタラクション（ボタンフィードバック、ローディング、エラー表示）、画面遷移アニメーション、ジェスチャー対応、キーボードショートカット、音声入力対応を検討してください。',
prompt_en: 'Design key interactions for "{projectName}" from flow state maintenance perspective. Consider micro-interactions (button feedback, loading, error display), screen transition animations, gesture support, keyboard shortcuts, and voice input support.'
},
{
id: 'design_system',
label_ja: 'デザインシステム構築',
label_en: 'Design System Construction',
prompt_ja: 'プロジェクト「{projectName}」のデザインシステムを、アトミック設計の観点で構築してください。デザイントークン（色/タイポグラフィ/スペーシング）、コンポーネントライブラリ（Atoms/Molecules/Organisms）、アクセシビリティガイドライン（WCAG 2.1 AA準拠）、ダークモード対応を含めてください。',
prompt_en: 'Build design system for "{projectName}" from atomic design perspective. Include design tokens (color/typography/spacing), component library (Atoms/Molecules/Organisms), accessibility guidelines (WCAG 2.1 AA compliance), and dark mode support.'
}
]
},
p3: {
title_ja: 'Phase 3: 実装',
title_en: 'Phase 3: Implementation',
tpl: [
{
id: 'arch_design',
label_ja: 'アーキテクチャ設計',
label_en: 'Architecture Design',
prompt_ja: 'プロジェクト「{projectName}」（技術スタック: {stack}）のアーキテクチャを、レジリエント設計の観点で構築してください。レイヤー構造（プレゼンテーション/ビジネスロジック/データアクセス）、依存性注入、エラーハンドリング（リトライ/サーキットブレーカー）、ロギング戦略、ヘルスチェックを含めてください。',
prompt_en: 'Design architecture for "{projectName}" (tech stack: {stack}) from resilient design perspective. Include layer structure (presentation/business logic/data access), dependency injection, error handling (retry/circuit breaker), logging strategy, and health checks.'
},
{
id: 'perf_strategy',
label_ja: 'パフォーマンス戦略',
label_en: 'Performance Strategy',
prompt_ja: 'プロジェクト「{projectName}」のパフォーマンス戦略を、時間価値最大化の観点で策定してください。Core Web Vitals目標値（LCP<2.5s、FID<100ms、CLS<0.1）、バンドルサイズ削減、画像最適化、CDN活用、キャッシュ戦略、遅延ローディングを含めてください。',
prompt_en: 'Develop performance strategy for "{projectName}" from time value maximization perspective. Include Core Web Vitals targets (LCP<2.5s, FID<100ms, CLS<0.1), bundle size reduction, image optimization, CDN utilization, caching strategy, and lazy loading.'
},
{
id: 'error_recovery',
label_ja: 'エラー回復設計',
label_en: 'Error Recovery Design',
prompt_ja: 'プロジェクト「{projectName}」のエラー回復戦略を設計してください。エラー分類（リトライ可能/不可能）、ユーザー通知（エラーメッセージのトーン＆マナー）、自動リトライロジック、ロールバック戦略、フォールバック処理を含めてください。',
prompt_en: 'Design error recovery strategy for "{projectName}". Include error classification (retryable/non-retryable), user notification (error message tone & manner), auto-retry logic, rollback strategy, and fallback processing.'
}
]
},
p4: {
title_ja: 'Phase 4: テスト',
title_en: 'Phase 4: Testing',
tpl: [
{
id: 'test_strategy',
label_ja: 'テスト戦略立案',
label_en: 'Test Strategy Planning',
prompt_ja: 'プロジェクト「{projectName}」のテスト戦略を、データドリブンの観点で立案してください。テストピラミッド（ユニット70%/統合20%/E2E10%）、カバレッジ目標（statements 80%、branches 70%）、テスト自動化（Vitest/Playwright）、性能テスト、セキュリティテスト（OWASP Top 10）を含めてください。',
prompt_en: 'Plan test strategy for "{projectName}" from data-driven perspective. Include test pyramid (unit 70%/integration 20%/E2E 10%), coverage targets (statements 80%, branches 70%), test automation (Vitest/Playwright), performance testing, and security testing (OWASP Top 10).'
},
{
id: 'user_test',
label_ja: 'ユーザーテスト設計',
label_en: 'User Testing Design',
prompt_ja: 'プロジェクト「{projectName}」のユーザーテストを設計してください。テストシナリオ（タスク完了/エラー回復）、評価指標（タスク成功率/完了時間/満足度）、リクルート基準（ペルソナ適合性）、ファシリテーションスクリプト、インサイト抽出方法を含めてください。',
prompt_en: 'Design user testing for "{projectName}". Include test scenarios (task completion/error recovery), evaluation metrics (task success rate/completion time/satisfaction), recruitment criteria (persona fit), facilitation script, and insight extraction method.'
},
{
id: 'ab_test',
label_ja: 'A/Bテスト設計',
label_en: 'A/B Test Design',
prompt_ja: 'プロジェクト「{projectName}」のA/Bテストを設計してください。仮説設定（改善候補とその根拠）、サンプルサイズ計算（統計的有意水準α=0.05、検出力β=0.8）、セグメント分割、測定指標（プライマリ/セカンダリ）、実験期間、判定基準を含めてください。',
prompt_en: 'Design A/B testing for "{projectName}". Include hypothesis setting (improvement candidates and rationale), sample size calculation (α=0.05, β=0.8), segmentation, measurement metrics (primary/secondary), experiment duration, and decision criteria.'
}
]
},
p5: {
title_ja: 'Phase 5: 改善・運用',
title_en: 'Phase 5: Improvement & Operations',
tpl: [
{
id: 'data_analysis',
label_ja: 'データ分析と改善',
label_en: 'Data Analysis & Improvement',
prompt_ja: 'プロジェクト「{projectName}」のデータ分析基盤を構築してください。ファネル分析（コンバージョン率）、コホート分析（定着率）、ユーザー行動分析（ヒートマップ/セッションリプレイ）、異常検知（アラート設定）、ダッシュボード設計（経営/現場向け）を含めてください。',
prompt_en: 'Build data analysis infrastructure for "{projectName}". Include funnel analysis (conversion rate), cohort analysis (retention rate), user behavior analysis (heatmap/session replay), anomaly detection (alert settings), and dashboard design (for management/operations).'
},
{
id: 'tech_debt',
label_ja: '技術的負債管理',
label_en: 'Technical Debt Management',
prompt_ja: 'プロジェクト「{projectName}」の技術的負債を管理してください。負債の分類（コード品質/設計/ドキュメント/テスト）、優先度評価（ビジネス影響×解消難易度）、返済計画（20%ルール: スプリントの20%を負債返済に充てる）、予防策を含めてください。',
prompt_en: 'Manage technical debt for "{projectName}". Include debt classification (code quality/design/documentation/testing), priority evaluation (business impact × resolution difficulty), repayment plan (20% rule: allocate 20% of sprint to debt repayment), and prevention measures.'
},
{
id: 'continuous_improvement',
label_ja: '継続的改善サイクル',
label_en: 'Continuous Improvement Cycle',
prompt_ja: 'プロジェクト「{projectName}」の継続的改善サイクルを設計してください。改善のトリガー（KPI悪化/ユーザーフィードバック/競合動向）、仮説生成プロセス、実験設計（A/Bテスト/Feature Flag）、効果測定、ナレッジ蓄積（成功/失敗事例のドキュメント化）を含めてください。',
prompt_en: 'Design continuous improvement cycle for "{projectName}". Include improvement triggers (KPI degradation/user feedback/competitor trends), hypothesis generation process, experiment design (A/B testing/Feature Flags), impact measurement, and knowledge accumulation (documenting success/failure cases).'
}
]
}
};
// INDUSTRY_STRATEGY: Industry-specific deep-dive strategies (15 industries from 全方位・アプリ開発戦略完全ガイド)
const INDUSTRY_STRATEGY = {
healthcare: {
regs_ja: ['HIPAA（米）', '医療法', '薬機法', 'GDPR特別カテゴリ', 'EU AI Act高リスク'],
regs_en: ['HIPAA (US)', 'Medical Practitioner\'s Act', 'Pharmaceutical Act', 'GDPR special categories', 'EU AI Act high-risk'],
stack_ja: 'FHIR + HIPAA準拠クラウド（AWS/Azure/GCP） + E2E暗号化 + 監査ログ + バックアップ',
stack_en: 'FHIR + HIPAA-compliant cloud (AWS/Azure/GCP) + E2E encryption + audit logs + backup',
pitfalls_ja: ['PHI（個人健康情報）漏洩', '同意管理不備', 'アクセス制御の甘さ', '監査ログ不足'],
pitfalls_en: ['PHI leakage', 'Consent management gaps', 'Weak access control', 'Insufficient audit logs']
},
finance: {
regs_ja: ['金融商品取引法', '資金決済法', 'PSD2（EU）', 'DORA', 'SOX法'],
regs_en: ['Financial Instruments Act', 'Payment Services Act', 'PSD2 (EU)', 'DORA', 'SOX Act'],
stack_ja: 'Banking API（Plaid/Yodlee） + KYC/AML + 冪等性設計 + サーキットブレーカー + トランザクション管理',
stack_en: 'Banking APIs (Plaid/Yodlee) + KYC/AML + idempotent design + circuit breaker + transaction management',
pitfalls_ja: ['二重請求', 'トランザクション不整合', '不正検知の遅れ', 'KYC手続きの煩雑さ'],
pitfalls_en: ['Double charging', 'Transaction inconsistency', 'Delayed fraud detection', 'Complex KYC procedures']
},
manufacturing: {
regs_ja: ['ISO 9001（品質）', 'ISO 14001（環境）', 'ISO 45001（労働安全）', 'CE認証'],
regs_en: ['ISO 9001 (quality)', 'ISO 14001 (environment)', 'ISO 45001 (occupational safety)', 'CE marking'],
stack_ja: 'IoT連携（MQTT/OPC-UA） + エッジコンピューティング + 予知保全AI + デジタルツイン',
stack_en: 'IoT integration (MQTT/OPC-UA) + edge computing + predictive maintenance AI + digital twin',
pitfalls_ja: ['ダウンタイム', 'データサイロ', 'レガシー機器統合', '省エネ目標未達'],
pitfalls_en: ['Downtime', 'Data silos', 'Legacy equipment integration', 'Energy-saving target shortfall']
},
education: {
regs_ja: ['FERPA（米）', 'COPPA（児童）', '個人情報保護法', 'EU教育データ保護'],
regs_en: ['FERPA (US)', 'COPPA (children)', 'APPI (Japan)', 'EU education data protection'],
stack_ja: 'LTI統合 + SSO（学校アカウント） + LRS（学習記録） + SCORM/xAPI + アクセシビリティ（WCAG AA）',
stack_en: 'LTI integration + SSO (school accounts) + LRS (learning records) + SCORM/xAPI + accessibility (WCAG AA)',
pitfalls_ja: ['児童データ保護不備', 'LMS統合の失敗', 'アクセシビリティ未対応', '学習分析の倫理問題'],
pitfalls_en: ['Child data protection gaps', 'LMS integration failure', 'Accessibility non-compliance', 'Learning analytics ethics']
},
retail: {
regs_ja: ['特定商取引法', '割賦販売法', '景品表示法', 'EU消費者保護指令'],
regs_en: ['Act on Specified Commercial Transactions', 'Installment Sales Act', 'Act against Unjustifiable Premiums', 'EU consumer protection directives'],
stack_ja: 'Stripe/PayPal + 在庫管理SaaS + 配送API統合 + レコメンドエンジン + ポイントシステム',
stack_en: 'Stripe/PayPal + inventory management SaaS + shipping API integration + recommendation engine + loyalty system',
pitfalls_ja: ['在庫切れ表示遅延', '決済失敗', '配送遅延', 'レコメンド精度低下'],
pitfalls_en: ['Delayed out-of-stock display', 'Payment failure', 'Shipping delays', 'Recommendation accuracy decline']
},
realestate: {
regs_ja: ['宅地建物取引業法', '建築基準法', '都市計画法', '不動産登記法'],
regs_en: ['Real Estate Transaction Act', 'Building Standards Act', 'City Planning Act', 'Real Estate Registration Act'],
stack_ja: 'GIS/地図API（Mapbox/Google Maps） + VRツアー + 不動産DB連携 + 価格推定AI',
stack_en: 'GIS/map APIs (Mapbox/Google Maps) + VR tours + real estate DB integration + price estimation AI',
pitfalls_ja: ['物件情報の古さ', '周辺情報不足', 'VR体験の重さ', '価格推定の不正確さ'],
pitfalls_en: ['Outdated property info', 'Insufficient neighborhood data', 'Heavy VR experience', 'Inaccurate price estimation']
},
logistics: {
regs_ja: ['貨物自動車運送事業法', '道路交通法', '関税法', 'IATA規則（航空）'],
regs_en: ['Motor Freight Transportation Act', 'Road Traffic Act', 'Customs Act', 'IATA regulations (air)'],
stack_ja: 'GPS追跡 + ルート最適化AI + 倉庫管理システム（WMS） + 配送API統合',
stack_en: 'GPS tracking + route optimization AI + warehouse management system (WMS) + delivery API integration',
pitfalls_ja: ['配送遅延', 'ルート非最適化', '在庫不一致', 'ラストワンマイル問題'],
pitfalls_en: ['Delivery delays', 'Route non-optimization', 'Inventory mismatch', 'Last-mile problem']
},
agriculture: {
regs_ja: ['農薬取締法', '食品衛生法', '有機JAS規格', 'GAP認証'],
regs_en: ['Agricultural Chemicals Regulation Act', 'Food Sanitation Act', 'Organic JAS standards', 'GAP certification'],
stack_ja: 'IoTセンサー（土壌/気象） + 気象予測API + トレーサビリティ（ブロックチェーン） + ドローン連携',
stack_en: 'IoT sensors (soil/weather) + weather forecast API + traceability (blockchain) + drone integration',
pitfalls_ja: ['センサーデータ欠損', '気象予測の不正確さ', 'トレーサビリティ不備', '資源の無駄'],
pitfalls_en: ['Sensor data loss', 'Inaccurate weather forecasts', 'Traceability gaps', 'Resource waste']
},
energy: {
regs_ja: ['電気事業法', '省エネ法', 'FIT/FIP制度', 'カーボンニュートラル目標'],
regs_en: ['Electricity Business Act', 'Energy Conservation Act', 'FIT/FIP schemes', 'Carbon neutral targets'],
stack_ja: '需給予測AI + スマートメーター連携 + 再エネ統合（VPP） + ピークシフト制御',
stack_en: 'Demand forecasting AI + smart meter integration + renewable integration (VPP) + peak shifting control',
pitfalls_ja: ['需給予測ミス', '停電リスク', '再エネ統合の難しさ', 'ピークカット不足'],
pitfalls_en: ['Demand forecast errors', 'Blackout risk', 'Renewable integration challenges', 'Insufficient peak cutting']
},
media: {
regs_ja: ['著作権法', '放送法', 'EU著作権指令', 'DMCA（米）'],
regs_en: ['Copyright Act', 'Broadcasting Act', 'EU Copyright Directive', 'DMCA (US)'],
stack_ja: 'CDN（Cloudflare/Fastly） + DRM + レコメンドエンジン + ABRストリーミング + オフライン再生',
stack_en: 'CDN (Cloudflare/Fastly) + DRM + recommendation engine + ABR streaming + offline playback',
pitfalls_ja: ['著作権侵害', 'バッファリング', 'レコメンド精度低下', 'DRM複雑さ'],
pitfalls_en: ['Copyright infringement', 'Buffering', 'Recommendation accuracy decline', 'DRM complexity']
},
government: {
regs_ja: ['行政機関個人情報保護法', '情報公開法', 'デジタル庁ガイドライン', 'ウェブアクセシビリティ指針'],
regs_en: ['Act on Protection of Personal Information held by Administrative Organs', 'Information Disclosure Act', 'Digital Agency guidelines', 'Web accessibility guidelines'],
stack_ja: 'WCAG AAA準拠 + 多言語対応（機械翻訳） + マイナンバー連携 + 災害時BCP + 監査ログ',
stack_en: 'WCAG AAA compliance + multilingual support (machine translation) + My Number integration + disaster BCP + audit logs',
pitfalls_ja: ['アクセシビリティ不備', '災害時ダウン', '多言語対応不足', '監査ログ不備'],
pitfalls_en: ['Accessibility gaps', 'Disaster downtime', 'Insufficient multilingual support', 'Inadequate audit logs']
},
travel: {
regs_ja: ['旅行業法', '旅券法', 'IATA規則', 'EU Package Travel Directive'],
regs_en: ['Travel Agency Act', 'Passport Act', 'IATA regulations', 'EU Package Travel Directive'],
stack_ja: 'GDS/OTA API統合 + 地図API + 多言語対応 + オフライン地図 + リアルタイム情報',
stack_en: 'GDS/OTA API integration + map APIs + multilingual support + offline maps + real-time info',
pitfalls_ja: ['予約情報の不一致', 'リアルタイム情報不足', 'オフライン対応不備', '多言語品質'],
pitfalls_en: ['Booking info mismatch', 'Insufficient real-time info', 'Poor offline support', 'Multilingual quality']
},
hr: {
regs_ja: ['労働基準法', '雇用機会均等法', '個人情報保護法', 'GDPR（EU人事データ）'],
regs_en: ['Labor Standards Act', 'Equal Employment Opportunity Act', 'APPI', 'GDPR (EU HR data)'],
stack_ja: 'ATS（採用管理） + スキル可視化 + バイアス排除AI + 勤怠管理 + タレントマネジメント',
stack_en: 'ATS (applicant tracking) + skill visualization + bias elimination AI + attendance management + talent management',
pitfalls_ja: ['採用バイアス', 'スキル評価の曖昧さ', '勤怠データ不正確', '離職率予測の難しさ'],
pitfalls_en: ['Hiring bias', 'Vague skill assessment', 'Inaccurate attendance data', 'Turnover prediction challenges']
},
legal: {
regs_ja: ['弁護士法', '司法書士法', '個人情報保護法', 'EU法務データ保護'],
regs_en: ['Attorney Act', 'Judicial Scrivener Act', 'APPI', 'EU legal data protection'],
stack_ja: 'バージョン管理（Git） + 電子署名 + 監査ログ + 文書検索（全文検索） + AI契約レビュー',
stack_en: 'Version control (Git) + e-signature + audit logs + document search (full-text) + AI contract review',
pitfalls_ja: ['バージョン管理不備', '監査ログ不足', '電子署名の法的有効性', 'AI誤判定'],
pitfalls_en: ['Version control gaps', 'Insufficient audit logs', 'E-signature legal validity', 'AI misjudgment']
},
insurance: {
regs_ja: ['保険業法', '金融商品取引法', 'EU保険販売指令（IDD）', 'ソルベンシー規制'],
regs_en: ['Insurance Business Act', 'Financial Instruments Act', 'EU Insurance Distribution Directive (IDD)', 'Solvency regulations'],
stack_ja: 'リスク評価AI + 迅速審査 + バイアス排除 + 透明な保険料計算 + クレーム管理',
stack_en: 'Risk assessment AI + quick underwriting + bias elimination + transparent premium calculation + claims management',
pitfalls_ja: ['リスク評価バイアス', '審査遅延', '保険料計算の不透明さ', 'クレーム処理遅延'],
pitfalls_en: ['Risk assessment bias', 'Underwriting delays', 'Opaque premium calculation', 'Claims processing delays']
}
};
// NEXT_GEN_UX: Next-generation UX keywords (from キーワード別有能な壁打ちプロンプト集)
const NEXT_GEN_UX = {
agentic: {
label_ja: 'エージェンティック・ワークフロー',
label_en: 'Agentic Workflow',
desc_ja: 'AIが自律的にタスクを分解・実行し、ユーザーは「承認」だけを行う。操作ではなく、依頼する体験。',
desc_en: 'AI autonomously decomposes and executes tasks; users only approve. Experience of delegation, not operation.',
prompt_ja: 'プロジェクト「{projectName}」の機能「{feature}」について、現在はユーザーが手動で操作する仕様になっています。これを「Agentic Workflow（自律的エージェント）」の観点で再設計してください。\n\n1. **User-in-the-loopの最小化**: ユーザーの承認が必要な「決定的な瞬間」だけを残し、それ以外のプロセス（前準備・後処理）を自動化するフロー図を描いてください。\n2. **例外処理の自律化**: エラーが起きた際、ユーザーに通知する前にエージェントが自己解決（リトライ、代替案の探索）を行うロジックを提案してください。\n3. **成果物**: 従来のUI画面遷移図ではなく、エージェントの「思考プロセス（Chain of Thought）」と「状態遷移図」を出力してください。',
prompt_en: 'For feature "{feature}" in project "{projectName}", currently users manually operate. Redesign from "Agentic Workflow" perspective.\n\n1. **Minimize User-in-the-loop**: Keep only "critical moments" requiring user approval; automate pre/post-processing. Draw flow diagram.\n2. **Autonomous Exception Handling**: Propose logic where agents self-resolve (retry, alternative exploration) before notifying users.\n3. **Deliverable**: Output agent "Chain of Thought" and state transition diagram, not traditional UI flow.'
},
generative_ui: {
label_ja: 'ジェネレーティブUI',
label_en: 'Generative UI',
desc_ja: '固定画面を廃止し、文脈（Context）に応じてAIがUIコンポーネントを即座に生成。Vercel v0的な体験。',
desc_en: 'Abolish fixed screens; AI generates UI components instantly based on context. Vercel v0-like experience.',
prompt_ja: 'プロジェクト「{projectName}」の機能「{feature}」において、固定的なレイアウトを廃止し、「Generative UI（文脈に応じたUI生成）」を導入したいと考えています。\n\n以下の3つの異なるシチュエーションにおいて、AIが生成すべき「最適なUIコンポーネントの構成」をそれぞれ定義してください。\n\n- **Case A**: ユーザーが急いでおり、結論だけを知りたい時\n- **Case B**: ユーザーが探索モードで、詳細な情報を比較検討したい時\n- **Case C**: 通信環境が悪く、最小限のテキストベースで操作したい時\n\nそれぞれのケースで、どの情報を優先表示し、どの装飾を削ぎ落とすべきかのルールを提示してください。',
prompt_en: 'For feature "{feature}" in project "{projectName}", abolish fixed layouts and introduce "Generative UI".\n\nDefine optimal UI component composition AI should generate for each scenario:\n\n- **Case A**: User is in a hurry, wants only conclusions\n- **Case B**: User is in exploration mode, wants detailed comparison\n- **Case C**: Poor network, wants minimal text-based operation\n\nFor each case, present rules for what info to prioritize and what decoration to remove.'
},
spatial: {
label_ja: 'スペーシャル・コンピューティング',
label_en: 'Spatial Computing',
desc_ja: '2D画面内でも「奥行き」や「重なり」を用いて情報の優先度を直感的に伝える。Vision Pro的な深度設計。',
desc_en: 'Use depth and layering to intuitively convey info priority even in 2D screens. Vision Pro-like depth design.',
prompt_ja: 'プロジェクト「{projectName}」の画面「{screen}」は情報量が多く、平面的なUIでは煩雑です。\n\nここに「Spatial Computing（空間と深度の概念）」を取り入れ、情報の階層構造をZ軸（奥行き）で整理してください。\n\n1. **マテリアル設計**: 最も重要な要素、背景要素、一時的な要素それぞれに、どのような「質感（Glassmorphism等）」と「影（Elevation）」を与えるべきか？\n2. **フォーカス制御**: ユーザーが注目している要素以外をどのように「ボケ（Blur）」させたり、暗くしたりして、視線誘導を行うべきか？\n3. **汎用ルール**: 今後機能が増えても破綻しないための「レイヤー深度のガイドライン（Level 1〜Level 5）」を策定してください。',
prompt_en: 'Screen "{screen}" in project "{projectName}" has high info density; flat UI is cluttered.\n\nApply "Spatial Computing" to organize info hierarchy with Z-axis depth.\n\n1. **Material Design**: What texture (Glassmorphism, etc.) and shadow (Elevation) for most important, background, and temporary elements?\n2. **Focus Control**: How to blur or darken non-focused elements for gaze guidance?\n3. **General Rules**: Establish layer depth guidelines (Level 1~5) resilient to future feature additions.'
},
calm: {
label_ja: 'カーム・テクノロジー',
label_en: 'Calm Technology',
desc_ja: 'ユーザーの注意を奪わず、生活の背景（アンビエント）に溶け込む技術。穏やかな通知、周辺視野での気配。',
desc_en: 'Technology that doesn\'t demand attention; blends into life background (ambient). Gentle notifications, peripheral presence.',
prompt_ja: 'プロジェクト「{projectName}」の機能「{feature}」は、ユーザーにとって有用ですが、頻繁な通知や派手な主張は避けたいと考えています。\n\n以下の制約で仕様を洗練させてください。\n\n1. **周辺視野への配置**: ユーザーが意識的に見ようとした時だけ詳細が見え、普段は視界の端で「気配」だけを感じさせるUI表現（色相の変化、微細なアニメーションなど）は？\n2. **非侵襲的なフィードバック**: アラート音やバイブレーションを使わず、ユーザーに状態変化（完了、エラーなど）を伝える、五感に訴えるアイデア（Hapticの波形、光の明滅リズムなど）を提案してください。',
prompt_en: 'Feature "{feature}" in project "{projectName}" is useful but should avoid frequent notifications or flashy assertions.\n\nRefine spec with these constraints:\n\n1. **Peripheral Vision Placement**: UI expressions (hue changes, subtle animations) where details appear only when user consciously looks, otherwise just "presence" at vision edge?\n2. **Non-invasive Feedback**: Ideas appealing to senses (haptic waveforms, light blinking rhythms) to convey state changes (completion, error) without alert sounds or vibrations.'
}
};
// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

// Map domain to closest industry (for INDUSTRY_STRATEGY lookup)
function mapDomainToIndustry(domain) {
const mapping = {
health: 'healthcare',
fintech: 'finance',
manufacturing: 'manufacturing',
education: 'education',
ec: 'retail',
realestate: 'realestate',
logistics: 'logistics',
agriculture: 'agriculture',
energy: 'energy',
content: 'media',
media: 'media',
government: 'government',
travel: 'travel',
hr: 'hr',
legal: 'legal',
insurance: 'insurance'
};
return mapping[domain] || null;
}

// ============================================================================
// GENERATOR FUNCTIONS
// ============================================================================

function gen60(G, domain, meth, a, pn) {
let doc = '';
doc += G ? '# 60. 開発手法インテリジェンス\n\n' : '# 60. Methodology Intelligence\n\n';
doc += G ? '> **プロジェクト**: ' + pn + '\n' : '> **Project**: ' + pn + '\n';
doc += G ? '> **ドメイン**: ' + domain + '\n\n' : '> **Domain**: ' + domain + '\n\n';
doc += G ? '## 最適開発手法の選定\n\n' : '## Optimal Methodology Selection\n\n';
doc += G ? '### 選定結果\n\n' : '### Selection Result\n\n';
doc += G ? '**第一選択**: ' + meth.primary_ja + '\n\n' : '**Primary**: ' + meth.primary_en + '\n\n';
doc += G ? '**第二選択**: ' + meth.secondary_ja + '\n\n' : '**Secondary**: ' + meth.secondary_en + '\n\n';
doc += G ? '**選定理由**:\n\n' + meth.rationale_ja + '\n\n' : '**Rationale**:\n\n' + meth.rationale_en + '\n\n';
doc += G ? '**キーワード**: ' : '**Keywords**: ';
doc += (G ? meth.kw_ja : meth.kw_en).join(', ') + '\n\n';
doc += G ? '## 12設計アプローチ適合度評価\n\n' : '## 12 Design Approaches Fit Evaluation\n\n';
doc += G ? '各アプローチのドメイン適合度を5段階評価（★★★★★ = 最適、☆☆☆☆☆ = 不適）:\n\n' : 'Domain fit for each approach (★★★★★ = optimal, ☆☆☆☆☆ = unsuitable):\n\n';
const approaches = [
{ja: 'フロー状態設計', en: 'Flow State Design'},
{ja: '認知負荷最小化', en: 'Cognitive Load Min.'},
{ja: '時間価値最大化', en: 'Time Value Max.'},
{ja: 'コンテキスト適応', en: 'Context Adaptive'},
{ja: 'プログレッシブ開示', en: 'Progressive Disclosure'},
{ja: 'レジリエント設計', en: 'Resilient Design'},
{ja: 'アトミック設計', en: 'Atomic Design'},
{ja: 'データドリブン', en: 'Data-Driven'},
{ja: 'インクルーシブ', en: 'Inclusive'},
{ja: 'エモーショナル', en: 'Emotional'},
{ja: 'AIファースト', en: 'AI-First'},
{ja: 'サステナブル', en: 'Sustainable'}
];
const primaryKw = G ? meth.kw_ja : meth.kw_en;
doc += '| ' + (G ? 'アプローチ' : 'Approach') + ' | ' + (G ? '適合度' : 'Fit') + ' | ' + (G ? '理由' : 'Rationale') + ' |\n';
doc += '|---|---|---|\n';
approaches.forEach(ap => {
const name = G ? ap.ja : ap.en;
const isPrimary = (G ? meth.primary_ja : meth.primary_en).includes(name);
const isSecondary = (G ? meth.secondary_ja : meth.secondary_en).includes(name);
const stars = isPrimary ? '★★★★★' : isSecondary ? '★★★★☆' : primaryKw.some(k => name.includes(k.split('').slice(0,2).join(''))) ? '★★★☆☆' : '★★☆☆☆';
const reason = isPrimary ? (G ? 'ドメイン最適解' : 'Domain optimal') : isSecondary ? (G ? '重要な補完要素' : 'Important complement') : (G ? '状況次第で有効' : 'Situationally useful');
doc += '| ' + name + ' | ' + stars + ' | ' + reason + ' |\n';
});
doc += '\n';
doc += G ? '## 実装優先順位\n\n' : '## Implementation Priority\n\n';
doc += G ? '### Phase 1: 基盤構築（MVP）\n\n' : '### Phase 1: Foundation (MVP)\n\n';
doc += '- ' + (G ? meth.primary_ja : meth.primary_en) + '\n';
doc += G ? '  - ' + (G ? meth.kw_ja[0] : meth.kw_en[0]) + 'を最優先で実装\n' : '  - Implement ' + (G ? meth.kw_en[0] : meth.kw_en[0]) + ' first\n';
doc += G ? '  - 基本的なユーザーフロー確立\n\n' : '  - Establish basic user flow\n\n';
doc += G ? '### Phase 2: 拡張\n\n' : '### Phase 2: Expansion\n\n';
doc += '- ' + (G ? meth.secondary_ja : meth.secondary_en) + '\n';
doc += G ? '  - 第一選択の弱点を補完\n' : '  - Complement primary weaknesses\n';
doc += G ? '  - 追加機能の実装\n\n' : '  - Implement additional features\n\n';
doc += G ? '### Phase 3: 最適化\n\n' : '### Phase 3: Optimization\n\n';
doc += G ? '- データドリブン + 継続的改善\n' : '- Data-Driven + Continuous Improvement\n';
doc += G ? '  - A/Bテストによる検証\n' : '  - Validation via A/B testing\n';
doc += G ? '  - KPI測定と改善サイクル確立\n\n' : '  - Establish KPI measurement and improvement cycle\n\n';
doc += G ? '## 組み合わせシナジー分析\n\n' : '## Combination Synergy Analysis\n\n';
doc += '**' + (G ? meth.primary_ja : meth.primary_en) + '** × **' + (G ? meth.secondary_ja : meth.secondary_en) + '**\n\n';
doc += G ? '→ **相乗効果**: ' + domain + 'ドメインにおいて、' : '→ **Synergy**: In ' + domain + ' domain, ';
doc += G ? '第一選択が「強み」を、第二選択が「弱点補完」を担うことで、バランスの取れた体験を実現。\n\n' : 'primary provides "strengths" while secondary "complements weaknesses" for balanced experience.\n\n';
doc += G ? '## 適合度スコアリング（Mermaid互換性マトリクス）\n\n' : '## Fit Scoring (Mermaid Compatibility Matrix)\n\n';
doc += '```mermaid\n';
doc += 'graph TD\n';
doc += '  A[' + domain + ' ' + (G ? 'ドメイン' : 'Domain') + '] --> B[' + (G ? meth.primary_ja : meth.primary_en) + ']\n';
doc += '  A --> C[' + (G ? meth.secondary_ja : meth.secondary_en) + ']\n';
doc += '  B --> D[' + (G ? meth.kw_ja[0] : meth.kw_en[0]) + ']\n';
doc += '  B --> E[' + (G ? meth.kw_ja[1] : meth.kw_en[1]) + ']\n';
doc += '  C --> F[' + (G ? meth.kw_ja[2] : meth.kw_en[2]) + ']\n';
doc += '  C --> G[' + (G ? meth.kw_ja[3] : meth.kw_en[3]) + ']\n';
doc += '```\n\n';
doc += G ? '---\n\n**次のステップ**: `docs/61_ai_brainstorm_playbook.md` で、このプロジェクト専用のAI壁打ちプロンプト集を確認してください。\n' : '---\n\n**Next Step**: Check `docs/61_ai_brainstorm_playbook.md` for project-specific AI brainstorming prompts.\n';
return doc;
}

function gen61(G, domain, meth, a, pn) {
let doc = '';
doc += G ? '# 61. AI壁打ちプロンプト・プレイブック\n\n' : '# 61. AI Brainstorming Prompt Playbook\n\n';
doc += G ? '> **プロジェクト**: ' + pn + '\n' : '> **Project**: ' + pn + '\n';
doc += G ? '> **ドメイン**: ' + domain + '\n' : '> **Domain**: ' + domain + '\n';
doc += G ? '> **選定手法**: ' + meth.primary_ja + ' + ' + meth.secondary_ja + '\n\n' : '> **Selected Methodology**: ' + meth.primary_en + ' + ' + meth.secondary_en + '\n\n';
doc += G ? '## 使い方\n\n' : '## How to Use\n\n';
doc += G ? 'このドキュメントは、**プロジェクト固有の文脈を注入済み**のAI壁打ちプロンプト集です。\n\n' : 'This document contains **project-specific context-injected** AI brainstorming prompts.\n\n';
doc += G ? '各プロンプトをコピーし、Claude/ChatGPT/Copilotに貼り付けて、高度な提案を引き出してください。\n\n' : 'Copy each prompt and paste into Claude/ChatGPT/Copilot to extract high-level proposals.\n\n';
const stack = (a.frontend || '') + ' + ' + (a.backend || '') + ' + ' + (a.database || '');
const feature = G ? '主要機能（例: ダッシュボード/検索/予約など）' : 'main feature (e.g., dashboard/search/booking)';
Object.keys(PHASE_PROMPTS).forEach(phaseKey => {
const phase = PHASE_PROMPTS[phaseKey];
doc += '## ' + (G ? phase.title_ja : phase.title_en) + '\n\n';
phase.tpl.forEach((tpl, idx) => {
doc += '### ' + (idx + 1) + '. ' + (G ? tpl.label_ja : tpl.label_en) + '\n\n';
doc += '```\n';
let prompt = G ? tpl.prompt_ja : tpl.prompt_en;
prompt = prompt.replace(/{projectName}/g, pn);
prompt = prompt.replace(/{domain}/g, domain);
prompt = prompt.replace(/{methodology}/g, G ? meth.primary_ja + ' + ' + meth.secondary_ja : meth.primary_en + ' + ' + meth.secondary_en);
prompt = prompt.replace(/{stack}/g, stack);
prompt = prompt.replace(/{feature}/g, feature);
doc += prompt + '\n';
doc += '```\n\n';
});
});
doc += G ? '---\n\n**Tips**: プロンプト実行後、得られた回答を `docs/` 配下の該当ドキュメント（例: `docs/03_architecture.md`、`docs/07_test_cases.md`）に反映してください。\n' : '---\n\n**Tips**: After running prompts, reflect answers into relevant docs (e.g., `docs/03_architecture.md`, `docs/07_test_cases.md`).\n';
return doc;
}

function gen62(G, domain, indStrategy, a, pn) {
let doc = '';
doc += G ? '# 62. 業界特化ディープダイブ\n\n' : '# 62. Industry-Specific Deep Dive\n\n';
doc += G ? '> **プロジェクト**: ' + pn + '\n' : '> **Project**: ' + pn + '\n';
doc += G ? '> **ドメイン**: ' + domain + '\n\n' : '> **Domain**: ' + domain + '\n\n';
if (!indStrategy) {
doc += G ? '**注意**: このドメインに対応する業界特化戦略はまだ定義されていません。\n\n' : '**Note**: Industry-specific strategy for this domain is not yet defined.\n\n';
doc += G ? '汎用的なベストプラクティスに従ってください。\n' : 'Follow general best practices.\n';
return doc;
}

doc += G ? '## 規制・コンプライアンス\n\n' : '## Regulations & Compliance\n\n';
doc += G ? '### 主要規制\n\n' : '### Key Regulations\n\n';
const regs = G ? indStrategy.regs_ja : indStrategy.regs_en;
regs.forEach(r => {
doc += '- ' + r + '\n';
});
doc += '\n';
doc += G ? '### 推奨技術スタック\n\n' : '### Recommended Tech Stack\n\n';
doc += (G ? indStrategy.stack_ja : indStrategy.stack_en) + '\n\n';
doc += G ? '## 業界特有の落とし穴\n\n' : '## Industry-Specific Pitfalls\n\n';
doc += G ? '以下は、この業界でよくある失敗パターンです。設計・実装時に必ず確認してください。\n\n' : 'Common failure patterns in this industry. Always verify during design/implementation.\n\n';
const pitfalls = G ? indStrategy.pitfalls_ja : indStrategy.pitfalls_en;
doc += '| # | ' + (G ? '落とし穴' : 'Pitfall') + ' | ' + (G ? '対策' : 'Countermeasure') + ' |\n';
doc += '|---|---|---|\n';
pitfalls.forEach((p, i) => {
const counter = G ?
(p.includes('漏洩') ? 'E2E暗号化 + アクセス制御' :
p.includes('不備') ? '監査ログ + バージョン管理' :
p.includes('遅延') ? 'リアルタイム処理 + 優先度キュー' :
p.includes('不正確') ? 'データ検証 + 異常検知' : 'ベストプラクティス準拠') :
(p.includes('leakage') ? 'E2E encryption + access control' :
p.includes('gaps') ? 'Audit logs + version control' :
p.includes('delays') ? 'Real-time processing + priority queue' :
p.includes('Inaccurate') ? 'Data validation + anomaly detection' : 'Follow best practices');
doc += '| ' + (i + 1) + ' | ' + p + ' | ' + counter + ' |\n';
});
doc += '\n';
doc += G ? '## アーキテクチャ推奨パターン\n\n' : '## Recommended Architecture Patterns\n\n';
doc += '```mermaid\n';
doc += 'graph LR\n';
doc += '  A[' + (G ? 'クライアント' : 'Client') + '] --> B[API Gateway]\n';
doc += '  B --> C[' + (G ? '認証レイヤー' : 'Auth Layer') + ']\n';
doc += '  C --> D[' + (G ? 'ビジネスロジック' : 'Business Logic') + ']\n';
doc += '  D --> E[' + (G ? 'データレイヤー' : 'Data Layer') + ']\n';
doc += '  E --> F[' + (G ? '暗号化ストレージ' : 'Encrypted Storage') + ']\n';
doc += '  D --> G[' + (G ? '監査ログ' : 'Audit Log') + ']\n';
doc += '```\n\n';
doc += G ? '---\n\n**参考**: `docs/43_security_intelligence.md` で業界特化のセキュリティチェックリストを確認してください。\n' : '---\n\n**Reference**: Check `docs/43_security_intelligence.md` for industry-specific security checklists.\n';
return doc;
}

function gen63(G, domain, meth, a, pn) {
let doc = '';
doc += G ? '# 63. 次世代UX戦略 — Polymorphic Engine\n\n' : '# 63. Next-Gen UX Strategy — Polymorphic Engine\n\n';
doc += G ? '> **プロジェクト**: ' + pn + '\n' : '> **Project**: ' + pn + '\n';
doc += G ? '> **ドメイン**: ' + domain + '\n\n' : '> **Domain**: ' + domain + '\n\n';
doc += G ? '## Polymorphic Engineとは\n\n' : '## What is Polymorphic Engine\n\n';
doc += G ? 'このアプリに「完成形」はありません。ユーザーの状況、スキル、感情に合わせて、**アプリ自体がアメーバのように機能と姿をリアルタイムに書き換え続ける（Polymorph）**システムです。\n\n' : 'This app has no "final form". It **polymorphs like an amoeba**, continuously rewriting functionality and appearance in real-time based on user context, skills, and emotions.\n\n';
doc += G ? '### The Context Loop（4段階フレーム）\n\n' : '### The Context Loop (4-Stage Framework)\n\n';
doc += '```mermaid\n';
doc += 'graph LR\n';
doc += '  A[1. Sensing ' + (G ? '感知' : 'Perception') + '] --> B[2. Thinking ' + (G ? '推論' : 'Reasoning') + ']\n';
doc += '  B --> C[3. Morphing ' + (G ? '変異' : 'Transformation') + ']\n';
doc += '  C --> D[4. Acting ' + (G ? '作用' : 'Action') + ']\n';
doc += '  D --> A\n';
doc += '```\n\n';
doc += '1. **Sensing (' + (G ? '感知' : 'Perception') + ')**: ' + (G ? 'タップの強さ、迷い、時間、位置から「心理状態」を読む' : 'Read psychological state from tap strength, hesitation, time, location') + '\n';
doc += '2. **Thinking (' + (G ? '推論' : 'Reasoning') + ')**: ' + (G ? 'ユーザーの意図を予測し、バックグラウンド処理を開始' : 'Predict user intent and start background processing') + '\n';
doc += '3. **Morphing (' + (G ? '変異' : 'Transformation') + ')**: ' + (G ? 'UI構造と情報の深度（Z軸）をリアルタイムに再構築' : 'Rebuild UI structure and info depth (Z-axis) in real-time') + '\n';
doc += '4. **Acting (' + (G ? '作用' : 'Action') + ')**: ' + (G ? '最もストレスのない方法で結果を伝える' : 'Convey results in the least stressful way') + '\n\n';
doc += G ? '## 4つの次世代UXキーワード適用\n\n' : '## Applying 4 Next-Gen UX Keywords\n\n';
Object.keys(NEXT_GEN_UX).forEach(key => {
const ux = NEXT_GEN_UX[key];
doc += '### ' + (G ? ux.label_ja : ux.label_en) + '\n\n';
doc += '**' + (G ? '概要' : 'Overview') + '**: ' + (G ? ux.desc_ja : ux.desc_en) + '\n\n';
doc += '**' + (G ? 'プロジェクト適用プロンプト' : 'Project-Specific Prompt') + '**:\n\n';
doc += '```\n';
let prompt = G ? ux.prompt_ja : ux.prompt_en;
prompt = prompt.replace(/{projectName}/g, pn);
prompt = prompt.replace(/{feature}/g, G ? '主要機能' : 'main feature');
prompt = prompt.replace(/{screen}/g, G ? '主要画面' : 'main screen');
doc += prompt + '\n';
doc += '```\n\n';
});
doc += G ? '## ドメイン特化適用例\n\n' : '## Domain-Specific Application Examples\n\n';
doc += G ? '**' + domain + 'ドメインにおける推奨適用**:\n\n' : '**Recommended application for ' + domain + ' domain**:\n\n';
if (domain === 'education') {
doc += G ? '- **Agentic**: AI学習アシスタントが自律的に次の学習コンテンツを提案\n' : '- **Agentic**: AI learning assistant autonomously suggests next learning content\n';
doc += G ? '- **Generative UI**: 学習者の理解度に応じて説明の詳細度を動的調整\n' : '- **Generative UI**: Dynamically adjust explanation detail based on learner comprehension\n';
doc += G ? '- **Spatial**: 重要な概念を手前に配置、補足情報は奥にボカして配置\n' : '- **Spatial**: Place key concepts in front, blur supplementary info in back\n';
doc += G ? '- **Calm**: 集中フロー維持のため、通知は最小限に\n\n' : '- **Calm**: Minimize notifications to maintain concentration flow\n\n';
} else if (domain === 'fintech') {
doc += G ? '- **Agentic**: 異常取引検知時、AIが自動で一時停止・ユーザー確認\n' : '- **Agentic**: AI auto-pauses and confirms with user upon anomaly detection\n';
doc += G ? '- **Generative UI**: 取引状況（急ぎ/確認）に応じてUI構成を切り替え\n' : '- **Generative UI**: Switch UI composition based on transaction context (urgent/confirm)\n';
doc += G ? '- **Spatial**: セキュリティ警告を最前面、通常情報は背景化\n' : '- **Spatial**: Security alerts in foreground, normal info in background\n';
doc += G ? '- **Calm**: 取引完了は穏やかな通知、不正検知時のみアラート\n\n' : '- **Calm**: Gentle notification for transaction completion, alert only for fraud detection\n\n';
} else {
doc += G ? '- **Agentic**: ユーザーの意図を予測し、先回りして処理\n' : '- **Agentic**: Predict user intent and process ahead\n';
doc += G ? '- **Generative UI**: 文脈に応じてUIを動的生成\n' : '- **Generative UI**: Dynamically generate UI based on context\n';
doc += G ? '- **Spatial**: 情報の優先度を深度（Z軸）で表現\n' : '- **Spatial**: Express info priority with depth (Z-axis)\n';
doc += G ? '- **Calm**: 通知は周辺視野に配置、侵襲性を最小化\n\n' : '- **Calm**: Place notifications in peripheral vision, minimize intrusiveness\n\n';
}

doc += G ? '---\n\n**実装ガイド**: `docs/39_implementation_playbook.md` でドメイン別実装パターンを確認し、次世代UXを技術的に実現する方法を学んでください。\n' : '---\n\n**Implementation Guide**: Check `docs/39_implementation_playbook.md` for domain-specific implementation patterns to technically realize next-gen UX.\n';
return doc;
}

// Main P16 generator function
function genPillar16_DevIQ(a, pn) {
const G = S.genLang === 'ja';
const domain = detectDomain(a.purpose || '');
const meth = DEV_METHODOLOGY_MAP[domain] || DEV_METHODOLOGY_MAP._default;
const ind = mapDomainToIndustry(domain);
const indStrategy = ind ? (INDUSTRY_STRATEGY[ind] || null) : null;
S.files['docs/60_methodology_intelligence.md'] = gen60(G, domain, meth, a, pn);
S.files['docs/61_ai_brainstorm_playbook.md'] = gen61(G, domain, meth, a, pn);
S.files['docs/62_industry_deep_dive.md'] = gen62(G, domain, indStrategy, a, pn);
S.files['docs/63_next_gen_ux_strategy.md'] = gen63(G, domain, meth, a, pn);
}
// P17: Prompt Genome Engine
// Generates: docs/65_prompt_genome.md, 66_ai_maturity_assessment.md, 67_prompt_composition_guide.md, 68_prompt_kpi_dashboard.md
// ============================================================================
// DATA CONSTANTS
// ============================================================================
// CRITERIA_FRAMEWORK: 8-axis prompt quality scoring (total weight = 100)
function _cri(key, weight, rubric_ja, rubric_en, guide_ja, guide_en) {
return { key, weight, rubric_ja, rubric_en, guide_ja, guide_en };
}
const CRITERIA_FRAMEWORK = [
_cri('Context', 15,
'コンテキスト設定', 'Context Setting',
'1=文脈なし, 3=基本的な背景, 5=完全なプロジェクト文脈・ドメイン知識・制約条件を含む',
'1=No context, 3=Basic background, 5=Full project context, domain knowledge, and constraints'),
_cri('Role', 10,
'役割定義', 'Role Definition',
'1=役割なし, 3=一般的な役割, 5=具体的な専門スキル・経験年数・視点を明示した役割',
'1=No role, 3=Generic role, 5=Specific expertise, years of experience, and perspective defined'),
_cri('Instructions', 20,
'指示の明確性', 'Instruction Clarity',
'1=曖昧な指示, 3=ステップあり, 5=番号付き手順・成果物・制約・除外事項を含む詳細指示',
'1=Vague instructions, 3=Has steps, 5=Numbered steps with deliverables, constraints, and exclusions'),
_cri('Thought Process', 10,
'思考プロセス要求', 'Thought Process Request',
'1=要求なし, 3=考えてから答えて, 5=CoT/ToT/ReAct等の思考フレームワーク指定',
'1=Not requested, 3=Think before answer, 5=CoT/ToT/ReAct or other thinking framework specified'),
_cri('Execution Rules', 15,
'実行ルール', 'Execution Rules',
'1=ルールなし, 3=基本制約, 5=禁止事項・形式要件・品質基準を明示した実行ルール',
'1=No rules, 3=Basic constraints, 5=Explicit prohibitions, format requirements, and quality standards'),
_cri('Reflection', 10,
'振り返り要求', 'Reflection Request',
'1=なし, 3=最後に確認して, 5=自己批評→改善ループ(WSCI)の明示的指示',
'1=None, 3=Review at end, 5=Explicit self-critique and improvement loop (WSCI) instructions'),
_cri('Iteration', 10,
'イテレーション設計', 'Iteration Design',
'1=一回きり, 3=フィードバック可, 5=反復プロセス・評価基準・収束条件を設計済み',
'1=One-shot, 3=Feedback possible, 5=Iterative process with evaluation criteria and convergence conditions'),
_cri('Adaptation', 10,
'適応性', 'Adaptation',
'1=固定, 3=言語切替可, 5=コンテキスト・スキルレベル・出力形式を動的に適応',
'1=Fixed, 3=Language switchable, 5=Dynamically adapts context, skill level, and output format')
];
// AI_MATURITY_MODEL: 3-level organizational AI maturity
function _mat(lv, label_ja, label_en, chars_ja, chars_en, pats_ja, pats_en, prac_ja, prac_en) {
return { lv, label_ja, label_en, chars_ja, chars_en, pats_ja, pats_en, prac_ja, prac_en };
}
const AI_MATURITY_MODEL = [
_mat(1, 'AI支援 (Assisted)', 'AI Assisted',
'コード補完・コードレビュー限定、手動レビュー必須、個人ベースのAI活用',
'Code completion and review only, mandatory manual review, individual-based AI usage',
'定型テンプレート使用、CRITERIA準拠の基本プロンプト、単一AIとの対話',
'Using standard templates, basic CRITERIA-compliant prompts, single AI interaction',
'プロンプトライブラリ構築、成功例の共有、基本CRITERIA評価',
'Build prompt library, share success cases, basic CRITERIA evaluation'),
_mat(2, 'AI協調 (Augmented)', 'AI Augmented',
'アーキテクチャ提案・設計レビュー、CRITERIA準拠プロンプト設計、チームでAI活用',
'Architecture proposals and design reviews, CRITERIA-compliant prompt design, team-based AI usage',
'マルチAgent協調パターン、反復改善ループ、文脈注入テンプレート',
'Multi-agent coordination patterns, iterative improvement loops, context injection templates',
'ペアプログラミング(人間+AI)、CRITERIA定期評価、チームプロンプト管理',
'Pair programming (human+AI), regular CRITERIA evaluation, team prompt management'),
_mat(3, 'AI自律 (Autonomous)', 'AI Autonomous',
'自律実行・継続的改善、戦略判断のみ人間、組織全体でAI活用',
'Autonomous execution and continuous improvement, humans for strategic decisions only, organization-wide AI usage',
'ゲノム駆動プロンプト・自己進化、オーケストレーション設計、品質自動評価',
'Genome-driven self-evolving prompts, orchestration design, automated quality evaluation',
'AIオーケストレーション、プロンプトCI/CD、効果自動測定・最適化',
'AI orchestration, prompt CI/CD, automated measurement and optimization')
];
// _APPROACHES: 12 design approaches (from DEV_METHODOLOGY_MAP primary/secondary)
const _APPROACHES = [
{id:'flow', ja:'フロー状態設計', en:'Flow State Design'},
{id:'emo', ja:'エモーショナル', en:'Emotional Design'},
{id:'prog', ja:'プログレッシブ開示', en:'Progressive Disclosure'},
{id:'data', ja:'データドリブン', en:'Data-Driven'},
{id:'cog', ja:'認知負荷最小化', en:'Cognitive Load Min.'},
{id:'time', ja:'時間価値最大化', en:'Time Value Max.'},
{id:'ctx', ja:'コンテキスト適応', en:'Context Adaptive'},
{id:'res', ja:'レジリエント', en:'Resilient'},
{id:'inc', ja:'インクルーシブ', en:'Inclusive'},
{id:'atm', ja:'アトミック設計', en:'Atomic Design'},
{id:'eco', ja:'エコシステム統合', en:'Ecosystem Integration'},
{id:'prf', ja:'パフォーマンス最優先', en:'Performance First'}
];
// _SYNERGY_RAW: Upper-triangle synergy matrix (12x12)
// Values: 1=conflict, 3=neutral, 5=strong synergy
// Row order matches _APPROACHES index (flow,emo,prog,data,cog,time,ctx,res,inc,atm,eco,prf)
const _SYNERGY_RAW = [
[5,4,5,3,5,4,4,3,4,3,3,3], // flow
[0,5,4,5,3,5,4,2,5,3,3,2], // emo
[0,0,5,4,5,4,5,3,5,4,3,3], // prog
[0,0,0,5,4,4,5,4,3,4,4,4], // data
[0,0,0,0,5,5,4,3,4,5,3,4], // cog
[0,0,0,0,0,5,4,3,3,4,3,5], // time
[0,0,0,0,0,0,5,4,4,3,5,4], // ctx
[0,0,0,0,0,0,0,5,3,4,4,4], // res
[0,0,0,0,0,0,0,0,5,3,3,2], // inc
[0,0,0,0,0,0,0,0,0,5,4,4], // atm
[0,0,0,0,0,0,0,0,0,0,5,3], // eco
[0,0,0,0,0,0,0,0,0,0,0,5]  // prf
];
function getSynergy(i, j) {
if (i === j) return 5;
var r = Math.min(i, j), c = Math.max(i, j);
return _SYNERGY_RAW[r][c];
}
// APPROACH_KPI: KPIs for each of 12 approaches
const APPROACH_KPI = {
flow:  {metrics_ja:['セッション継続時間','タスク完了率','中断回数','再訪問率'],       metrics_en:['Session duration','Task completion rate','Interruption count','Return visit rate'],       tools_ja:'Hotjar, FullStory', tools_en:'Hotjar, FullStory'},
emo:   {metrics_ja:['NPS(推奨意向)','感情評価スコア','SNSシェア率','離脱率'],         metrics_en:['NPS','Emotional rating score','SNS share rate','Bounce rate'],                           tools_ja:'SurveyMonkey, Amplitude', tools_en:'SurveyMonkey, Amplitude'},
prog:  {metrics_ja:['段階完了率','離脱ステップ','機能発見率','チュートリアル完了率'], metrics_en:['Stage completion rate','Drop-off step','Feature discovery rate','Tutorial completion'],    tools_ja:'Mixpanel, Heap', tools_en:'Mixpanel, Heap'},
data:  {metrics_ja:['CVR','A/Bテスト勝率','予測精度','データ活用率'],                 metrics_en:['CVR','A/B test win rate','Prediction accuracy','Data utilization rate'],                  tools_ja:'Optimizely, Statsig', tools_en:'Optimizely, Statsig'},
cog:   {metrics_ja:['タスク完了時間','エラー率','ヘルプアクセス数','認知負荷スコア'], metrics_en:['Task completion time','Error rate','Help access count','Cognitive load score'],            tools_ja:'UserZoom, Maze', tools_en:'UserZoom, Maze'},
time:  {metrics_ja:['Time to Value','操作ステップ数','自動化率','1クリック達成率'],   metrics_en:['Time to value','Operation steps','Automation rate','One-click achievement rate'],         tools_ja:'Amplitude, PostHog', tools_en:'Amplitude, PostHog'},
ctx:   {metrics_ja:['パーソナライズ効果','文脈一致率','レコメンド精度','戻り率'],     metrics_en:['Personalization effect','Context match rate','Recommendation accuracy','Return rate'],    tools_ja:'Segment, Braze', tools_en:'Segment, Braze'},
res:   {metrics_ja:['SLA達成率','MTTR','障害頻度','エラー自動復旧率'],                metrics_en:['SLA achievement rate','MTTR','Failure frequency','Auto-recovery rate'],                  tools_ja:'Datadog, PagerDuty', tools_en:'Datadog, PagerDuty'},
inc:   {metrics_ja:['WCAG準拠率','アクセシビリティスコア','多様性カバレッジ','支援技術対応率'], metrics_en:['WCAG compliance rate','Accessibility score','Diversity coverage','Assistive tech support'], tools_ja:'axe-core, WAVE', tools_en:'axe-core, WAVE'},
atm:   {metrics_ja:['コンポーネント再利用率','デザイン一貫性スコア','実装速度','バグ発生率'], metrics_en:['Component reuse rate','Design consistency score','Implementation speed','Bug rate'],      tools_ja:'Storybook, Chromatic', tools_en:'Storybook, Chromatic'},
eco:   {metrics_ja:['API統合数','エコシステム活用率','外部連携CVR','プラットフォーム効果'], metrics_en:['API integration count','Ecosystem utilization rate','External integration CVR','Platform effect'], tools_ja:'Zapier, MuleSoft', tools_en:'Zapier, MuleSoft'},
prf:   {metrics_ja:['Core Web Vitals','p95レイテンシ','リソース使用率','スループット'],   metrics_en:['Core Web Vitals','p95 latency','Resource utilization','Throughput'],                      tools_ja:'Lighthouse, k6', tools_en:'Lighthouse, k6'}
};
// ============================================================================
// GENERATOR FUNCTIONS
// ============================================================================
function gen65(G, domain, meth, matLv, a, pn) {
var d = G ? '# プロンプトゲノム — ' + pn + '\n\n' : '# Prompt Genome — ' + pn + '\n\n';
d += G ? '> プロジェクト固有の"プロンプトDNA"ライブラリ。CRITERIA 8軸品質スコア付き。\n\n' :
'> Project-specific "Prompt DNA" library with CRITERIA 8-axis quality scoring.\n\n';
// DNA Profile
d += G ? '## 🧬 プロンプトDNAプロファイル\n\n' : '## 🧬 Prompt DNA Profile\n\n';
d += G ? '| 項目 | 値 |\n|------|----|\n' : '| Item | Value |\n|------|-------|\n';
d += G ? '| プロジェクト | ' + pn + ' |\n' : '| Project | ' + pn + ' |\n';
d += G ? '| ドメイン | ' + domain + ' |\n' : '| Domain | ' + domain + ' |\n';
d += G ? '| 主要アプローチ | ' + meth.primary_ja + ' |\n' : '| Primary Approach | ' + meth.primary_en + ' |\n';
d += G ? '| 副次アプローチ | ' + meth.secondary_ja + ' |\n' : '| Secondary Approach | ' + meth.secondary_en + ' |\n';
d += G ? '| AI成熟度レベル | Level ' + matLv + ' (' + AI_MATURITY_MODEL[matLv-1].label_ja + ') |\n' :
'| AI Maturity Level | Level ' + matLv + ' (' + AI_MATURITY_MODEL[matLv-1].label_en + ') |\n';
d += G ? '| スタック | ' + (a.frontend||'') + ' + ' + (a.backend||'') + ' |\n\n' :
'| Stack | ' + (a.frontend||'') + ' + ' + (a.backend||'') + ' |\n\n';
// Genome signature Mermaid
d += '```mermaid\n';
d += 'graph TD\n';
d += '  DNA[🧬 Prompt DNA] --> C[CRITERIA Framework]\n';
d += '  DNA --> M[' + (G ? 'AI成熟度 Level ' : 'AI Maturity Level ') + matLv + ']\n';
d += '  DNA --> A[' + (G ? meth.primary_ja.split(' ')[0] : meth.primary_en.split(' ')[0]) + ']\n';
d += '  C --> C1[Context 15%]\n';
d += '  C --> C2[Instructions 20%]\n';
d += '  C --> C3[Execution 15%]\n';
d += '  M --> M1[' + (G ? AI_MATURITY_MODEL[matLv-1].pats_ja.split('、')[0] : AI_MATURITY_MODEL[matLv-1].pats_en.split(',')[0].trim()) + ']\n';
d += '  A --> A1[' + (G ? meth.kw_ja[0] : meth.kw_en[0]) + ']\n';
d += '  A --> A2[' + (G ? meth.kw_ja[1] : meth.kw_en[1]) + ']\n';
d += '```\n\n';
// CRITERIA Scoring Guide
d += G ? '## 📊 CRITERIA 8軸品質スコアリング\n\n' : '## 📊 CRITERIA 8-Axis Quality Scoring\n\n';
d += G ? '| 軸 | 重み | 評価基準 | 5点ガイド |\n|-----|------|----------|----------|\n' :
'| Axis | Weight | Rubric | 5-Point Guide |\n|------|--------|--------|---------------|\n';
CRITERIA_FRAMEWORK.forEach(function(c) {
d += '| ' + c.key + ' | ' + c.weight + '% | ' + (G ? c.rubric_ja : c.rubric_en) + ' | ' + (G ? c.guide_ja : c.guide_en) + ' |\n';
});
d += '\n';
// Phase-by-phase prompts with CRITERIA scores
var phases = [
{ph:'0', ja:'コンセプト検証', en:'Concept Validation'},
{ph:'1', ja:'設計・仕様化', en:'Design & Specification'},
{ph:'2', ja:'実装', en:'Implementation'},
{ph:'3', ja:'品質保証', en:'Quality Assurance'},
{ph:'4', ja:'デプロイ', en:'Deployment'},
{ph:'5', ja:'運用・改善', en:'Operations & Improvement'}
];
d += G ? '## 🎯 フェーズ別プロンプトライブラリ\n\n' : '## 🎯 Phase-by-Phase Prompt Library\n\n';
var criteriaScores = [
{ctx:4, role:4, inst:5, tp:4, er:4, rf:3, it:4, ad:3}, // Phase 0
{ctx:5, role:5, inst:5, tp:5, er:5, rf:4, it:4, ad:4}, // Phase 1
{ctx:5, role:5, inst:5, tp:4, er:5, rf:5, it:5, ad:4}, // Phase 2
{ctx:4, role:4, inst:5, tp:4, er:5, rf:5, it:5, ad:3}, // Phase 3
{ctx:4, role:5, inst:5, tp:3, er:5, rf:4, it:3, ad:4}, // Phase 4
{ctx:5, role:4, inst:5, tp:5, er:4, rf:5, it:5, ad:5}  // Phase 5
];
phases.forEach(function(ph, idx) {
var sc = criteriaScores[idx];
var total = Math.round(
sc.ctx*0.15 + sc.role*0.10 + sc.inst*0.20 + sc.tp*0.10 +
sc.er*0.15 + sc.rf*0.10 + sc.it*0.10 + sc.ad*0.10
);
d += '### Phase ' + ph.ph + ': ' + (G ? ph.ja : ph.en) + '\n\n';
d += G ? '**CRITERIA スコア**: ' : '**CRITERIA Score**: ';
d += 'C=' + sc.ctx + ' R=' + sc.role + ' I=' + sc.inst + ' T=' + sc.tp +
' E=' + sc.er + ' Rf=' + sc.rf + ' It=' + sc.it + ' A=' + sc.ad +
' → **' + total + '/5**\n\n';
// Level-adaptive prompt
if (matLv === 1) {
d += G ? '**Level 1 (AI支援) 推奨プロンプト:**\n\n' : '**Level 1 (Assisted) Recommended Prompt:**\n\n';
d += G ? '```\nあなたは' + domain + 'ドメインの専門家です。\n' + pn + 'プロジェクトの' + ph.ja + 'フェーズで、\n' +
'ステップバイステップで' + (meth.kw_ja[idx % 4] || meth.kw_ja[0]) + 'を考慮した提案をしてください。\n各提案には根拠と具体的なアクションを含めてください。\n```\n\n' :
'```\nYou are a ' + domain + ' domain expert.\nFor ' + pn + ' project\'s ' + ph.en + ' phase,\nprovide step-by-step suggestions considering ' + (meth.kw_en[idx % 4] || meth.kw_en[0]) + '.\nInclude rationale and specific actions for each suggestion.\n```\n\n';
} else if (matLv === 2) {
d += G ? '**Level 2 (AI協調) 推奨プロンプト:**\n\n' : '**Level 2 (Augmented) Recommended Prompt:**\n\n';
d += G ? '```\n役割: ' + domain + 'ドメインのシニアアーキテクト\nプロジェクト: ' + pn + '\nフェーズ: ' + ph.ja + '\n\n' +
'CRITERIA準拠の思考プロセス:\n1. コンテキスト確認: ' + meth.rationale_ja.substring(0, 60) + '...\n' +
'2. ' + (G ? meth.kw_ja[0] : meth.kw_en[0]) + 'の観点から3つの選択肢を提案\n3. 各選択肢のトレードオフを評価\n4. 最終推奨と実装ロードマップを提示\n' +
'\n禁止: 根拠なしの断言、実装不可能な提案\n形式: Markdown表 + アクションリスト\n```\n\n' :
'```\nRole: Senior architect in ' + domain + ' domain\nProject: ' + pn + '\nPhase: ' + ph.en + '\n\n' +
'CRITERIA-compliant thinking process:\n1. Context check: ' + meth.rationale_en.substring(0, 60) + '...\n' +
'2. Propose 3 options from ' + meth.kw_en[0] + ' perspective\n3. Evaluate trade-offs for each option\n4. Present final recommendation and roadmap\n' +
'\nProhibited: Unsubstantiated assertions, infeasible suggestions\nFormat: Markdown table + action list\n```\n\n';
} else {
d += G ? '**Level 3 (AI自律) 推奨プロンプト:**\n\n' : '**Level 3 (Autonomous) Recommended Prompt:**\n\n';
d += G ? '```\n# Autonomous Agent Prompt — ' + ph.ja + '\n\nCONTEXT_GENOME:\n  domain: ' + domain + '\n  project: ' + pn + '\n  phase: phase_' + ph.ph + '\n  methodology: ' + meth.primary_ja.split(' + ')[0] + '\n  maturity: level_3\n\nAGENT_DIRECTIVE:\n  - 自律的に' + ph.ja + 'を完遂せよ\n  - CRITERIA全8軸で自己評価後に出力\n  - 不確実性がある場合は最良推定と信頼度(%)を明示\n  - 次フェーズへの引き継ぎサマリーを生成\n\nSUCCESS_CRITERIA:\n  - ' + (meth.kw_ja[0] || 'quality') + 'が達成される\n  - CRITERIA総合スコア ≥ 4.0\n```\n\n' :
'```\n# Autonomous Agent Prompt — ' + ph.en + '\n\nCONTEXT_GENOME:\n  domain: ' + domain + '\n  project: ' + pn + '\n  phase: phase_' + ph.ph + '\n  methodology: ' + meth.primary_en.split(' + ')[0] + '\n  maturity: level_3\n\nAGENT_DIRECTIVE:\n  - Autonomously complete ' + ph.en + '\n  - Self-evaluate on all 8 CRITERIA axes before output\n  - State best estimate and confidence (%) for uncertainties\n  - Generate handoff summary for next phase\n\nSUCCESS_CRITERIA:\n  - ' + (meth.kw_en[0] || 'quality') + ' is achieved\n  - CRITERIA total score >= 4.0\n```\n\n';
}
});
return d;
}
function gen66(G, matLv, a, pn) {
var d = G ? '# AI成熟度アセスメント — ' + pn + '\n\n' : '# AI Maturity Assessment — ' + pn + '\n\n';
d += G ? '> チームAI成熟度の5次元評価と段階的採用ロードマップ。\n\n' :
'> 5-dimension team AI maturity evaluation and phased adoption roadmap.\n\n';
// Current level
var mat = AI_MATURITY_MODEL[matLv - 1];
d += G ? '## 📊 現在の成熟度レベル\n\n' : '## 📊 Current Maturity Level\n\n';
d += G ? '**Level ' + matLv + ': ' + mat.label_ja + '**\n\n' : '**Level ' + matLv + ': ' + mat.label_en + '**\n\n';
d += G ? '特徴: ' + mat.chars_ja + '\n\n' : 'Characteristics: ' + mat.chars_en + '\n\n';
d += G ? 'プロンプトパターン: ' + mat.pats_ja + '\n\n' : 'Prompt patterns: ' + mat.pats_en + '\n\n';
d += G ? '推奨プラクティス: ' + mat.prac_ja + '\n\n' : 'Recommended practices: ' + mat.prac_en + '\n\n';
// 5-dimension evaluation matrix
d += G ? '## 🎯 5次元評価マトリクス\n\n' : '## 🎯 5-Dimension Evaluation Matrix\n\n';
var dims = G ? [
['プロンプト設計力', 'テンプレート活用', 'CRITERIA準拠設計', 'ゲノム駆動設計'],
['AI協調力', '単発タスク依頼', 'マルチターン対話', 'マルチAgent統合'],
['品質保証', '手動レビュー', '半自動品質チェック', '自動CRITERIA評価'],
['チームプラクティス', '個人学習', 'ペアプログラミング', 'AIオーケストレーション'],
['効果測定', '定性的感想', 'KPI定期計測', 'リアルタイム最適化']
] : [
['Prompt Design', 'Template usage', 'CRITERIA-compliant design', 'Genome-driven design'],
['AI Collaboration', 'One-shot task requests', 'Multi-turn dialogue', 'Multi-agent integration'],
['Quality Assurance', 'Manual review', 'Semi-automated QA', 'Automated CRITERIA evaluation'],
['Team Practices', 'Individual learning', 'Pair programming', 'AI orchestration'],
['Measurement', 'Qualitative feedback', 'Regular KPI tracking', 'Real-time optimization']
];
d += G ? '| 次元 | Level 1 | Level 2 | Level 3 |\n|------|---------|---------|----------|\n' :
'| Dimension | Level 1 | Level 2 | Level 3 |\n|-----------|---------|---------|----------|\n';
dims.forEach(function(dim) {
d += '| **' + dim[0] + '** | ' + dim[1] + ' | ' + dim[2] + ' | ' + dim[3] + ' |\n';
});
d += '\n';
// Maturity transition flow
d += '```mermaid\n';
d += 'graph LR\n';
d += '  L1[Level 1<br/>' + (G ? 'AI支援' : 'Assisted') + '] -->|' + (G ? 'CRITERIA習得' : 'CRITERIA mastery') + '| L2[Level 2<br/>' + (G ? 'AI協調' : 'Augmented') + ']\n';
d += '  L2 -->|' + (G ? 'オーケストレーション' : 'Orchestration') + '| L3[Level 3<br/>' + (G ? 'AI自律' : 'Autonomous') + ']\n';
d += '  style L' + matLv + ' fill:#4f46e5,color:#fff\n';
d += '```\n\n';
// 3-phase adoption roadmap
d += G ? '## 🗺️ 段階的採用ロードマップ\n\n' : '## 🗺️ Phased Adoption Roadmap\n\n';
var roadmap = G ? [
['フェーズ1: 基盤構築 (0-3ヶ月)', 'プロンプトライブラリ構築、CRITERIA基礎学習、成功例の共有と文書化'],
['フェーズ2: チーム展開 (3-6ヶ月)', 'ペアプログラミング導入、CRITERIA定期評価、チームプロンプト管理ツール選定'],
['フェーズ3: 自律化 (6-12ヶ月)', 'AIオーケストレーション導入、プロンプトCI/CD構築、効果自動測定と継続最適化']
] : [
['Phase 1: Foundation (0-3 months)', 'Build prompt library, learn CRITERIA basics, share and document success cases'],
['Phase 2: Team Rollout (3-6 months)', 'Introduce pair programming, regular CRITERIA evaluation, select team prompt management tools'],
['Phase 3: Autonomy (6-12 months)', 'Deploy AI orchestration, build prompt CI/CD, automate measurement and continuous optimization']
];
roadmap.forEach(function(r, i) {
var active = (i + 1 === matLv) ? (G ? ' ← **現在地**' : ' ← **Current**') : '';
d += '### ' + r[0] + active + '\n' + r[1] + '\n\n';
});
// Next level actions
if (matLv < 3) {
d += G ? '## ⬆️ 次レベルへのアクション\n\n' : '## ⬆️ Actions for Next Level\n\n';
var nextMat = AI_MATURITY_MODEL[matLv];
d += G ? '**目標: Level ' + (matLv + 1) + ' ' + nextMat.label_ja + '**\n\n' :
'**Target: Level ' + (matLv + 1) + ' ' + nextMat.label_en + '**\n\n';
d += G ? '推奨アクション: ' + nextMat.prac_ja + '\n' : 'Recommended actions: ' + nextMat.prac_en + '\n';
}
return d;
}
function gen67(G, domain, meth, a, pn) {
var d = G ? '# プロンプト合成ガイド — ' + pn + '\n\n' : '# Prompt Composition Guide — ' + pn + '\n\n';
d += G ? '> 12設計アプローチのシナジーマトリクス + 4層テンプレートアーキテクチャ。\n\n' :
'> Synergy matrix of 12 design approaches + 4-layer template architecture.\n\n';
// Synergy matrix
d += G ? '## 🔀 12×12 シナジーマトリクス\n\n' : '## 🔀 12×12 Synergy Matrix\n\n';
d += G ? '凡例: 5=強シナジー, 3=中立, 1=競合\n\n' : 'Legend: 5=Strong synergy, 3=Neutral, 1=Conflict\n\n';
var header = '| ' + (G ? 'アプローチ' : 'Approach') + ' |';
_APPROACHES.forEach(function(ap) { header += ' ' + ap.id + ' |'; });
d += header + '\n';
d += '|' + '--------|'.repeat(_APPROACHES.length + 1) + '\n';
_APPROACHES.forEach(function(ap, i) {
var row = '| **' + (G ? ap.ja : ap.en) + '** |';
_APPROACHES.forEach(function(_, j) {
var s = getSynergy(i, j);
var cell = s === 5 ? '**5**' : s === 1 ? '*1*' : String(s);
row += ' ' + cell + ' |';
});
d += row + '\n';
});
d += '\n';
// Project-specific synergy analysis
var primIdx = _APPROACHES.findIndex(function(ap) { return meth.primary_en.toLowerCase().includes(ap.en.toLowerCase().split(' ')[0].toLowerCase()); });
var secIdx = _APPROACHES.findIndex(function(ap) { return meth.secondary_en.toLowerCase().includes(ap.en.toLowerCase().split(' ')[0].toLowerCase()); });
if (primIdx < 0) primIdx = 0;
if (secIdx < 0) secIdx = 2;
d += G ? '## 🎯 プロジェクト固有シナジー分析\n\n' : '## 🎯 Project-Specific Synergy Analysis\n\n';
d += G ? '**ドメイン**: ' + domain + '\n' : '**Domain**: ' + domain + '\n';
d += G ? '**主要アプローチ**: ' + meth.primary_ja + ' (index: ' + primIdx + ')\n' :
'**Primary Approach**: ' + meth.primary_en + ' (index: ' + primIdx + ')\n';
d += G ? '**副次アプローチ**: ' + meth.secondary_ja + ' (index: ' + secIdx + ')\n\n' :
'**Secondary Approach**: ' + meth.secondary_en + ' (index: ' + secIdx + ')\n\n';
var synergyScore = getSynergy(primIdx, secIdx);
d += G ? '**組合せシナジースコア**: ' + synergyScore + '/5 ' :
'**Combination Synergy Score**: ' + synergyScore + '/5 ';
d += synergyScore >= 4 ? (G ? '✅ 高シナジー\n\n' : '✅ High Synergy\n\n') :
synergyScore >= 3 ? (G ? '⚡ 中程度\n\n' : '⚡ Moderate\n\n') :
(G ? '⚠️ トレードオフあり\n\n' : '⚠️ Trade-off exists\n\n');
// High-synergy partners for primary approach
d += G ? '**主要アプローチとの高シナジーパートナー (スコア≥4):**\n\n' :
'**High-synergy partners for primary approach (score>=4):**\n\n';
_APPROACHES.forEach(function(ap, i) {
if (i === primIdx) return;
var s = getSynergy(primIdx, i);
if (s >= 4) {
d += '- ' + (G ? ap.ja : ap.en) + ': ' + s + '/5\n';
}
});
d += '\n';
// 4-layer template architecture
d += G ? '## 🏗️ 4層テンプレートアーキテクチャ\n\n' : '## 🏗️ 4-Layer Template Architecture\n\n';
var layers = G ? [
['Layer 1: Meta (不変層)', '目的・役割・倫理制約。プロジェクト横断で共有。変更頻度: 低',
'```\nMETA: あなたは{domain}の専門家。倫理的・安全・根拠ある提案のみ行う。\n```'],
['Layer 2: Structure (骨格層)', 'タスク構造・思考フロー・出力フォーマット。フェーズ単位で共有。変更頻度: 中',
'```\nSTRUCTURE:\n1. 現状分析 → 2. 選択肢生成 → 3. 評価 → 4. 推奨\n形式: Markdown表\n```'],
['Layer 3: Content (コンテンツ層)', 'プロジェクト固有の文脈・データ・制約。タスク単位で変更。変更頻度: 高',
'```\nCONTENT:\n  project: ' + pn + '\n  stack: ' + (a.frontend||'') + '\n  domain: ' + domain + '\n```'],
['Layer 4: Adaptation (適応層)', '言語・スキルレベル・出力形式の動的調整。実行時に注入。変更頻度: 動的',
'```\nADAPTATION:\n  lang: ja\n  skill: intermediate\n  format: markdown\n```']
] : [
['Layer 1: Meta (Immutable)', 'Purpose, role, ethical constraints. Shared across projects. Change frequency: Low',
'```\nMETA: You are a {domain} expert. Only ethical, safe, evidence-based suggestions.\n```'],
['Layer 2: Structure (Skeleton)', 'Task structure, thinking flow, output format. Shared per phase. Change frequency: Medium',
'```\nSTRUCTURE:\n1. Current state analysis → 2. Option generation → 3. Evaluation → 4. Recommendation\nFormat: Markdown table\n```'],
['Layer 3: Content (Content)', 'Project-specific context, data, constraints. Changed per task. Change frequency: High',
'```\nCONTENT:\n  project: ' + pn + '\n  stack: ' + (a.frontend||'') + '\n  domain: ' + domain + '\n```'],
['Layer 4: Adaptation (Adaptive)', 'Dynamic adjustment of language, skill level, output format. Injected at runtime. Change frequency: Dynamic',
'```\nADAPTATION:\n  lang: en\n  skill: intermediate\n  format: markdown\n```']
];
layers.forEach(function(layer) {
d += '### ' + layer[0] + '\n' + layer[1] + '\n\n' + layer[2] + '\n\n';
});
// Composite prompt patterns (3 trade-off patterns)
d += G ? '## ⚖️ 複合プロンプトパターン（3つのトレードオフ）\n\n' : '## ⚖️ Composite Prompt Patterns (3 Trade-offs)\n\n';
var patterns = G ? [
['詳細 vs 速度', 'CRITERIA高スコア(I=5,Er=5)は詳細だが時間がかかる。Level 1ではI=3で速度優先',
'解決策: フェーズ初期はI=3の軽量テンプレート、設計フェーズはI=5の詳細テンプレートを使い分け'],
['汎用 vs 特化', '汎用プロンプトは再利用性高いが精度低下。特化プロンプトは精度高いが保守コスト',
'解決策: Layer 1-2を汎用、Layer 3-4を特化にする4層分離パターン'],
['自律 vs 制御', 'Level 3 (自律)は速いが予測困難。Level 1 (手動)は安全だが遅い',
'解決策: 成熟度に応じた段階的自律化。失敗コストが高いタスクはLevel 1を維持']
] : [
['Detail vs Speed', 'High CRITERIA score (I=5, Er=5) is detailed but time-consuming. Level 1 prioritizes speed with I=3',
'Solution: Use lightweight I=3 templates in early phases, detailed I=5 templates in design phases'],
['Generic vs Specialized', 'Generic prompts have high reusability but lower accuracy. Specialized prompts have high accuracy but maintenance cost',
'Solution: 4-layer separation: Layers 1-2 generic, Layers 3-4 specialized'],
['Autonomy vs Control', 'Level 3 (Autonomous) is fast but unpredictable. Level 1 (Manual) is safe but slow',
'Solution: Gradual autonomy based on maturity. Keep Level 1 for high-failure-cost tasks']
];
patterns.forEach(function(p, i) {
d += '**' + (i+1) + '. ' + p[0] + '**\n\n' + p[1] + '\n\n' + p[2] + '\n\n';
});
// ai_tools: tool-specific prompt optimization table
var aiTools = (a.ai_tools || 'Cursor').split(', ');
d += G ? '## 🛠️ AIツール別プロンプト最適化\n\n' : '## 🛠️ Tool-Specific Prompt Optimization\n\n';
d += '| ' + (G ? 'ツール' : 'Tool') + ' | ' + (G ? '最適パターン' : 'Optimal Pattern') + ' | ' + (G ? '推奨アプローチ' : 'Recommended Approach') + ' |\n';
d += '|---|---|---|\n';
aiTools.forEach(function(t) {
var tt = t.trim();
if (tt.includes('Cursor')) {
d += '| Cursor | ' + (G ? 'ワークスペース参照 (@workspace)' : 'Workspace reference (@workspace)') + ' | ' + (G ? 'コンテキスト付き指示で高精度' : 'Context-rich instructions for precision') + ' |\n';
} else if (tt.includes('Claude')) {
d += '| Claude Code | ' + (G ? 'サブエージェント委任' : 'Subagent delegation') + ' | ' + (G ? 'タスク分割+autonomous実行' : 'Task decomposition + autonomous execution') + ' |\n';
} else if (tt.includes('Copilot')) {
d += '| GitHub Copilot | ' + (G ? 'インライン補完' : 'Inline completion') + ' | ' + (G ? 'テスト→実装の順序でTDD' : 'TDD: tests first, then implementation') + ' |\n';
} else if (tt.includes('Aider')) {
d += '| Aider | ' + (G ? 'Git統合編集' : 'Git-integrated editing') + ' | ' + (G ? '差分ベースの指示' : 'Diff-based instructions') + ' |\n';
} else if (tt.includes('Antigravity')) {
d += '| Antigravity | ' + (G ? 'Agent-first IDE' : 'Agent-first IDE') + ' | ' + (G ? 'Managerビューでタスク管理' : 'Manager view for task orchestration') + ' |\n';
} else {
d += '| ' + tt + ' | ' + (G ? '汎用プロンプト' : 'General prompt') + ' | ' + (G ? 'CoT+制約明示' : 'CoT + explicit constraints') + ' |\n';
}
});
d += '\n';
return d;
}
function gen68(G, domain, meth, a, pn) {
var d = G ? '# プロンプトKPIダッシュボード — ' + pn + '\n\n' : '# Prompt KPI Dashboard — ' + pn + '\n\n';
d += G ? '> アプローチ別成功指標 + 測定計画 + AI効果測定。\n\n' :
'> Approach-specific success metrics + measurement plan + AI effectiveness tracking.\n\n';
// Primary/secondary approach KPI matrix
var approaches = meth.primary_en.toLowerCase();
var primKey = 'flow';
var secKey = 'prog';
Object.keys(APPROACH_KPI).forEach(function(key) {
if (approaches.includes(key.substring(0, 3))) primKey = key;
});
var secApproaches = meth.secondary_en.toLowerCase();
Object.keys(APPROACH_KPI).forEach(function(key) {
if (secApproaches.includes(key.substring(0, 3))) secKey = key;
});
var primKPI = APPROACH_KPI[primKey];
var secKPI = APPROACH_KPI[secKey];
d += G ? '## 📊 アプローチ別KPIマトリクス\n\n' : '## 📊 Approach-Specific KPI Matrix\n\n';
d += G ? '### 主要アプローチ: ' + meth.primary_ja + '\n\n' : '### Primary Approach: ' + meth.primary_en + '\n\n';
d += G ? '| KPI | ベースライン | 目標値 | 計測ツール |\n|-----|------------|--------|----------|\n' :
'| KPI | Baseline | Target | Measurement Tool |\n|-----|----------|--------|------------------|\n';
(G ? primKPI.metrics_ja : primKPI.metrics_en).forEach(function(m) {
d += '| ' + m + ' | TBD | TBD | ' + (G ? primKPI.tools_ja : primKPI.tools_en) + ' |\n';
});
d += '\n';
d += G ? '### 副次アプローチ: ' + meth.secondary_ja + '\n\n' : '### Secondary Approach: ' + meth.secondary_en + '\n\n';
d += G ? '| KPI | ベースライン | 目標値 | 計測ツール |\n|-----|------------|--------|----------|\n' :
'| KPI | Baseline | Target | Measurement Tool |\n|-----|----------|--------|------------------|\n';
(G ? secKPI.metrics_ja : secKPI.metrics_en).forEach(function(m) {
d += '| ' + m + ' | TBD | TBD | ' + (G ? secKPI.tools_ja : secKPI.tools_en) + ' |\n';
});
d += '\n';
// Measurement plan
d += G ? '## 📅 測定計画\n\n' : '## 📅 Measurement Plan\n\n';
var mplan = G ? [
['Baseline計測 (Week 1-2)', '現状KPIを計測してベースラインを確立。ツールのセットアップと初期データ収集'],
['Optimization (Week 3-8)', 'CRITERIA評価とKPI計測を週次で実施。A/Bテストでプロンプト改善を検証'],
['Continuous (Week 9+)', '月次レポートとKPI評価。四半期ごとにプロンプトゲノムを更新・進化']
] : [
['Baseline Measurement (Week 1-2)', 'Measure current KPIs to establish baseline. Set up tools and collect initial data'],
['Optimization (Week 3-8)', 'Weekly CRITERIA evaluation and KPI measurement. Validate prompt improvements with A/B tests'],
['Continuous (Week 9+)', 'Monthly reports and KPI review. Update and evolve prompt genome quarterly']
];
mplan.forEach(function(mp) {
d += '### ' + mp[0] + '\n' + mp[1] + '\n\n';
});
// AI effectiveness metrics
d += G ? '## 🤖 AI効果測定指標\n\n' : '## 🤖 AI Effectiveness Metrics\n\n';
d += G ? '| 指標 | 計算式 | 目標値 |\n|------|--------|--------|\n' :
'| Metric | Formula | Target |\n|--------|---------|--------|\n';
var metrics = G ? [
['プロンプト成功率', '(期待出力数 / 総プロンプト数) × 100', '≥ 80%'],
['自動化率', '(AI処理タスク数 / 総タスク数) × 100', '≥ 60%'],
['CRITERIA平均スコア', '全プロンプトのCRITERIA加重平均', '≥ 4.0 / 5'],
['反復改善効率', '(改善後スコア - 初回スコア) / 反復回数', '≥ 0.3 / 回'],
['開発速度向上率', '(AI導入後速度 / 導入前速度 - 1) × 100', '≥ 30%']
] : [
['Prompt Success Rate', '(Expected output count / Total prompts) × 100', '≥ 80%'],
['Automation Rate', '(AI-handled tasks / Total tasks) × 100', '≥ 60%'],
['Average CRITERIA Score', 'Weighted CRITERIA average across all prompts', '≥ 4.0 / 5'],
['Iterative Improvement Efficiency', '(Post-improvement score - Initial score) / Iterations', '≥ 0.3 / iteration'],
['Development Speed Improvement', '(Post-AI speed / Pre-AI speed - 1) × 100', '≥ 30%']
];
metrics.forEach(function(m) {
d += '| ' + m[0] + ' | `' + m[1] + '` | ' + m[2] + ' |\n';
});
d += '\n';
// KPI measurement flow Mermaid
d += '```mermaid\n';
d += 'graph TD\n';
d += '  M[' + (G ? 'KPI計測開始' : 'KPI Measurement Start') + '] --> B[' + (G ? 'Baseline確立' : 'Establish Baseline') + ']\n';
d += '  B --> P[' + (G ? 'プロンプト実行' : 'Execute Prompts') + ']\n';
d += '  P --> C[' + (G ? 'CRITERIA評価' : 'CRITERIA Evaluation') + ']\n';
d += '  C --> K[' + (G ? 'KPI計測' : 'KPI Measurement') + ']\n';
d += '  K --> R{' + (G ? '目標達成?' : 'Target Met?') + '}\n';
d += '  R -->|' + (G ? 'YES' : 'YES') + '| N[' + (G ? '次フェーズ' : 'Next Phase') + ']\n';
d += '  R -->|' + (G ? 'NO' : 'NO') + '| I[' + (G ? 'プロンプト改善' : 'Improve Prompts') + ']\n';
d += '  I --> P\n';
d += '```\n';
return d;
}
function genPillar17_PromptGenome(a, pn) {
var G = S.genLang === 'ja';
var domain = detectDomain(a.purpose || '');
var meth = DEV_METHODOLOGY_MAP[domain] || DEV_METHODOLOGY_MAP._default;
var aiAuto = a.ai_auto || '';
var matLv = /自律|orch|autonomous/i.test(aiAuto) ? 3 :
/マルチ|multi|full/i.test(aiAuto) ? 2 : 1;
S.files['docs/65_prompt_genome.md'] = gen65(G, domain, meth, matLv, a, pn);
S.files['docs/66_ai_maturity_assessment.md'] = gen66(G, matLv, a, pn);
S.files['docs/67_prompt_composition_guide.md'] = gen67(G, domain, meth, a, pn);
S.files['docs/68_prompt_kpi_dashboard.md'] = gen68(G, domain, meth, a, pn);
}
// P18: Prompt Engineering OS
// Generates: docs/69_prompt_ops_pipeline.md, 70_react_workflow.md, 71_llmops_dashboard.md, 72_prompt_registry.md
// ============================================================================
// DATA CONSTANTS
// ============================================================================
// REACT_PROTOCOL: 6 phases x 4 ReAct stages
function _rp(id,name_ja,name_en,r_ja,r_en,a_ja,a_en,o_ja,o_en,v_ja,v_en){
return {id,name_ja,name_en,reason:{ja:r_ja,en:r_en},act:{ja:a_ja,en:a_en},
observe:{ja:o_ja,en:o_en},verify:{ja:v_ja,en:v_en}};
}
var REACT_PROTOCOL=[
_rp('concept','Phase 0: 構想','Phase 0: Concept',
'要件分解・依存分析・不確実性の特定','Decompose requirements, analyze dependencies, identify uncertainties',
'read_spec, search_similar, list_constraints','read_spec, search_similar, list_constraints',
'類似事例の適用可能性を評価','Evaluate applicability of similar cases',
'要件網羅性チェック（漏れ・矛盾・あいまい性）','Requirement coverage check (omissions, contradictions, ambiguities)'
),
_rp('design','Phase 1: 設計','Phase 1: Design',
'アーキテクチャ選定・ToT3案生成・トレードオフ評価','Architecture selection, ToT 3-option generation, trade-off evaluation',
'read_docs, grep_patterns, compare_options','read_docs, grep_patterns, compare_options',
'設計案の実現可能性と整合性を比較','Compare feasibility and consistency of design options',
'SOLID/DRY準拠・スケーラビリティ・セキュリティ確認','SOLID/DRY compliance, scalability, security check'
),
_rp('implement','Phase 2: 実装','Phase 2: Implement',
'タスク分解・優先順位決定・依存関係の解決','Task decomposition, priority setting, dependency resolution',
'write_code, read_file, run_lint','write_code, read_file, run_lint',
'コンパイル結果・型エラー・lint警告を確認','Check compilation results, type errors, lint warnings',
'型安全・lint通過・テスト通過を確認','Verify type safety, lint pass, test pass'
),
_rp('test','Phase 3: テスト','Phase 3: Test',
'テスト戦略立案・カバレッジ計画・リスク優先度設定','Plan test strategy, coverage targets, risk prioritization',
'run_test, read_coverage, analyze_failures','run_test, read_coverage, analyze_failures',
'テスト結果・失敗分析・カバレッジギャップを確認','Check test results, failure analysis, coverage gaps',
'カバレッジ閾値達成・全テスト通過・回帰なし','Coverage threshold met, all tests pass, no regressions'
),
_rp('review','Phase 4: レビュー','Phase 4: Review',
'コード品質・セキュリティ・パフォーマンスの評価基準設定','Set criteria for code quality, security, performance evaluation',
'grep_code, read_diff, static_analysis','grep_code, read_diff, static_analysis',
'脆弱性・複雑度・テスト不足箇所を特定','Identify vulnerabilities, complexity issues, insufficient tests',
'OWASP/CRITERIA準拠・SOLID違反なし・レビューコメント解決','OWASP/CRITERIA compliance, no SOLID violations, review comments resolved'
),
_rp('deploy','Phase 5: デプロイ','Phase 5: Deploy',
'リスク評価・ロールバック計画・デプロイ戦略の決定','Risk assessment, rollback planning, deployment strategy decision',
'run_deploy, check_health, monitor_logs','run_deploy, check_health, monitor_logs',
'ヘルスチェック結果・エラーレート・レイテンシを確認','Check health status, error rate, latency',
'SLO達成・監視アラート正常・ロールバック手順確認済み','SLO achieved, monitoring alerts normal, rollback procedure verified'
)
];
// LLMOPS_STACK: 3 maturity levels x tool recommendations
function _los(lv,label_ja,label_en,tools_ja,tools_en,metrics_ja,metrics_en,setup_ja,setup_en){
return {lv,label_ja,label_en,tools_ja,tools_en,metrics_ja,metrics_en,setup_ja,setup_en};
}
var LLMOPS_STACK=[
_los(1,'AI支援 (Assisted)','AI Assisted',
'スプレッドシート・手動ログ・Notionプロンプトデータベース',
'Spreadsheet, manual logs, Notion prompt database',
['成功/失敗率','平均応答時間','主観的品質スコア','コスト/月'],
['Success/failure rate','Avg response time','Subjective quality score','Cost/month'],
'CSVテンプレート配布・週次レビューチェックリスト・Slackでの成功例共有',
'Distribute CSV templates, weekly review checklist, share success cases via Slack'
),
_los(2,'AI協調 (Augmented)','AI Augmented',
'LangSmith / Langfuse・GitHub Actions CI統合・プロンプトバージョン管理',
'LangSmith / Langfuse, GitHub Actions CI integration, prompt version control',
['CRITERIA平均スコア','コスト/クエリ','レイテンシP95','プロンプト成功率'],
['CRITERIA avg score','Cost/query','Latency P95','Prompt success rate'],
'API キー設定・Webhook連携・ダッシュボード構築・自動アラート設定',
'API key setup, webhook integration, dashboard build, automated alert configuration'
),
_los(3,'AI自律 (Autonomous)','AI Autonomous',
'カスタム評価パイプライン・Self-Eval Agent・Prompt CI/CD自動化',
'Custom evaluation pipeline, Self-Eval Agent, Prompt CI/CD automation',
['自動CRITERIAスコア','A/B勝率','プロンプト劣化検知レート','自動改善回数'],
['Auto CRITERIA score','A/B win rate','Prompt degradation detection rate','Auto-improvement count'],
'Prompt CI/CDパイプライン構築・自動ロールバック設定・継続評価ループ',
'Build Prompt CI/CD pipeline, configure auto-rollback, set up continuous evaluation loop'
)
];
// PROMPT_LIFECYCLE: 5 stages
var PROMPT_LIFECYCLE=[
{id:'draft',name_ja:'起草',name_en:'Draft',
desc_ja:'プロンプト初稿の作成。目的・役割・指示を明確化しCRITERIA 8軸で自己採点。',
desc_en:'Create initial prompt draft. Clarify purpose, role, instructions; self-score with CRITERIA 8 axes.',
check_ja:['目的と期待出力が明確か','役割定義が具体的か','CRITERIA Context≥3を達成しているか','テンプレートリテラル汚染がないか（変数展開構文の混入禁止）'],
check_en:['Is purpose and expected output clear','Is role definition specific','Does Context CRITERIA score ≥3','No template literal contamination (no variable interpolation syntax)']},
{id:'review',name_ja:'レビュー',name_en:'Review',
desc_ja:'CRITERIA 8軸スコアリング実施。チームレビューまたはAIセルフレビュー。閾値未達は差し戻し。',
desc_en:'Conduct CRITERIA 8-axis scoring. Team review or AI self-review. Return if below threshold.',
check_ja:['CRITERIA総合スコア≥3.5/5','Instructions軸≥4 (詳細な手順が明記)','Execution Rules軸≥3 (禁止事項・形式が明示)','ピアレビュー完了'],
check_en:['CRITERIA total score ≥3.5/5','Instructions axis ≥4 (detailed steps documented)','Execution Rules ≥3 (prohibitions and format explicit)','Peer review complete']},
{id:'test',name_ja:'テスト',name_en:'Test',
desc_ja:'5ケース以上のテスト入力で出力品質を検証。A/Bテストで旧バージョンと比較。',
desc_en:'Validate output quality with 5+ test inputs. Compare with previous version via A/B test.',
check_ja:['正常系5件以上でテスト実施','境界値ケースを含むか','旧バージョン比で品質改善確認','エラーハンドリング応答が適切か'],
check_en:['5+ normal case tests executed','Boundary value cases included','Quality improvement vs previous version verified','Error handling response appropriate']},
{id:'deploy',name_ja:'デプロイ',name_en:'Deploy',
desc_ja:'バージョンタグを付与してプロンプトレジストリに登録。段階的ロールアウト（10%→50%→100%）。',
desc_en:'Assign version tag and register in prompt registry. Staged rollout (10%→50%→100%).',
check_ja:['バージョン番号(v1.2.3形式)が付与済み','レジストリへの登録完了','ロールバックポイント設定済み','10%トラフィックで24h監視済み'],
check_en:['Version number (v1.2.3 format) assigned','Registry registration complete','Rollback point configured','10% traffic monitored for 24h']},
{id:'monitor',name_ja:'監視',name_en:'Monitor',
desc_ja:'本番メトリクスをリアルタイム監視。品質劣化を検知した場合は自動アラートとロールバック。',
desc_en:'Real-time monitoring of production metrics. Auto-alert and rollback on quality degradation.',
check_ja:['成功率<80%でアラート発火','コスト/クエリが予算内か','P95レイテンシが閾値内か','月次でプロンプトゲノム(doc65)更新'],
check_en:['Alert fires if success rate <80%','Cost/query within budget','P95 latency within threshold','Monthly prompt genome (doc65) update']}
];
// ============================================================================
// GENERATOR FUNCTIONS
// ============================================================================
function gen69(G, domain, meth, matLv, a, pn) {
var d = G ? '# Prompt Ops パイプライン — ' + pn + '\n\n' : '# Prompt Ops Pipeline — ' + pn + '\n\n';
d += G ? '> プロンプトCI/CDパイプライン。ライフサイクル管理・バージョン制御・A/Bテスト・ロールバック。\n\n' :
'> Prompt CI/CD pipeline. Lifecycle management, version control, A/B testing, rollback.\n\n';
// Lifecycle stages
d += G ? '## 🔄 Prompt Lifecycle 5ステージ\n\n' : '## 🔄 Prompt Lifecycle 5 Stages\n\n';
d += G ? '| ステージ | 説明 | 主要チェック |\n|----------|------|-------------|\n' :
'| Stage | Description | Key Checks |\n|-------|-------------|------------|\n';
PROMPT_LIFECYCLE.forEach(function(s) {
var checks = G ? s.check_ja.slice(0, 2).join(' / ') : s.check_en.slice(0, 2).join(' / ');
d += '| **' + (G ? s.name_ja : s.name_en) + '** | ' + (G ? s.desc_ja.substring(0, 60) : s.desc_en.substring(0, 60)) + '... | ' + checks + ' |\n';
});
d += '\n';
// Detailed checklist per stage
d += G ? '## ✅ ステージ別チェックリスト\n\n' : '## ✅ Stage-by-Stage Checklist\n\n';
PROMPT_LIFECYCLE.forEach(function(s) {
d += '### ' + (G ? s.name_ja : s.name_en) + '\n\n';
d += G ? s.desc_ja + '\n\n' : s.desc_en + '\n\n';
var checks = G ? s.check_ja : s.check_en;
checks.forEach(function(c) { d += '- [ ] ' + c + '\n'; });
// Domain-specific extra check
if (domain === 'fintech') {
d += G ? '- [ ] ' + (s.id === 'review' ? '規制要件チェック（金融庁・PCI DSS準拠）' : '金融ドメイン固有の検証完了') + '\n' :
'- [ ] ' + (s.id === 'review' ? 'Regulatory compliance check (FSA, PCI DSS)' : 'Finance domain-specific validation complete') + '\n';
} else if (domain === 'health') {
d += G ? '- [ ] PHI（個人健康情報）の漏洩リスクなし\n' : '- [ ] No PHI (personal health info) leak risk\n';
}
d += '\n';
});
// Version control strategy
d += G ? '## 🗂️ バージョン制御戦略\n\n' : '## 🗂️ Version Control Strategy\n\n';
d += G ? '### Gitベースのプロンプト管理\n\n' : '### Git-based Prompt Management\n\n';
d += G ? '```\nprompts/\n  {domain}/\n    {usecase}-v{major}.{minor}.{patch}.md   # バージョン付きプロンプト\n    {usecase}-CURRENT.md                   # 現行バージョンへのシンボリックリンク\n    CHANGELOG.md                           # 変更履歴\n    EVALUATION.md                          # CRITERIA評価ログ\n```\n\n' :
'```\nprompts/\n  {domain}/\n    {usecase}-v{major}.{minor}.{patch}.md   # Versioned prompt\n    {usecase}-CURRENT.md                   # Symlink to current version\n    CHANGELOG.md                           # Change history\n    EVALUATION.md                          # CRITERIA evaluation log\n```\n\n';
d += G ? '**バージョニング規則:**\n\n' : '**Versioning Rules:**\n\n';
d += G ? '- `MAJOR`: 役割・目的の根本的変更\n- `MINOR`: 新しい指示ブロック追加・CRITERIA軸の改善\n- `PATCH`: 誤字修正・表現の微調整\n\n' :
'- `MAJOR`: Fundamental change to role or purpose\n- `MINOR`: New instruction blocks, CRITERIA axis improvements\n- `PATCH`: Typo fixes, minor expression adjustments\n\n';
// A/B test framework
d += G ? '## 🧪 A/Bテストフレームワーク\n\n' : '## 🧪 A/B Test Framework\n\n';
d += G ? '### メトリクス定義\n\n' : '### Metrics Definition\n\n';
d += G ? '| メトリクス | 計算式 | 有意差基準 |\n|-----------|--------|----------|\n' :
'| Metric | Formula | Significance Threshold |\n|--------|---------|------------------------|\n';
var metrics = G ? [
['CRITERIA改善率', '(新スコア - 旧スコア) / 旧スコア × 100', '≥ 10%'],
['タスク成功率', '期待出力数 / 総テスト数 × 100', '≥ 80%'],
['応答品質スコア', 'CRITERIA 8軸加重平均', '≥ 4.0/5'],
['コスト効率', '(旧コスト - 新コスト) / 旧コスト × 100', '≥ 5%']
] : [
['CRITERIA improvement rate', '(New score - Old score) / Old score × 100', '≥ 10%'],
['Task success rate', 'Expected outputs / Total tests × 100', '≥ 80%'],
['Response quality score', 'CRITERIA 8-axis weighted average', '≥ 4.0/5'],
['Cost efficiency', '(Old cost - New cost) / Old cost × 100', '≥ 5%']
];
metrics.forEach(function(m) {
d += '| ' + m[0] + ' | `' + m[1] + '` | ' + m[2] + ' |\n';
});
d += '\n';
// Rollback procedure
d += G ? '## 🔙 ロールバック手順\n\n' : '## 🔙 Rollback Procedure\n\n';
d += G ? '**自動ロールバック判定基準** (Level ' + matLv + ' 対応):\n\n' :
'**Auto-Rollback Criteria** (Level ' + matLv + ' adapted):\n\n';
if (matLv >= 2) {
d += G ? '- 成功率が24時間で10%以上低下した場合\n- CRITERIA平均スコアが3.0を下回った場合\n- P95レイテンシが閾値の150%を超えた場合\n\n' :
'- Success rate drops >10% over 24 hours\n- CRITERIA avg score falls below 3.0\n- P95 latency exceeds 150% of threshold\n\n';
} else {
d += G ? '- 手動モニタリングで品質低下を検知した場合にロールバック\n\n' :
'- Manual rollback when quality degradation detected via monitoring\n\n';
}
d += G ? '**手順:**\n1. 前バージョンのプロンプトID確認\n2. `CURRENT.md`を前バージョンへ切り戻し\n3. インシデントレポートに記録\n4. 根本原因分析後に再デプロイ\n\n' :
'**Steps:**\n1. Confirm previous version prompt ID\n2. Revert `CURRENT.md` to previous version\n3. Record in incident report\n4. Re-deploy after root cause analysis\n\n';
// Mermaid pipeline diagram
d += '```mermaid\n';
d += 'graph LR\n';
d += '  D[' + (G ? '起草' : 'Draft') + '] -->|CRITERIA≥3| R[' + (G ? 'レビュー' : 'Review') + ']\n';
d += '  R -->|' + (G ? 'スコア≥3.5' : 'Score≥3.5') + '| T[' + (G ? 'テスト' : 'Test') + ']\n';
d += '  R -->|' + (G ? '不合格' : 'Fail') + '| D\n';
d += '  T -->|A/B' + (G ? '勝利' : ' Win') + '| P[' + (G ? 'デプロイ' : 'Deploy') + ']\n';
d += '  T -->|' + (G ? '不合格' : 'Fail') + '| D\n';
d += '  P -->|10%→50%→100%| M[' + (G ? '監視' : 'Monitor') + ']\n';
d += '  M -->|' + (G ? '品質劣化' : 'Degradation') + '| D\n';
d += '  style P fill:#4f46e5,color:#fff\n';
d += '```\n';
return d;
}
function gen70(G, domain, matLv, a, pn) {
var d = G ? '# ReAct 自律ワークフロー — ' + pn + '\n\n' : '# ReAct Autonomous Workflow — ' + pn + '\n\n';
d += G ? '> 6フェーズ × Reason→Act→Observe→Verify の自律開発サイクル。自己デバッグループ付き。\n\n' :
'> 6 phases × Reason→Act→Observe→Verify autonomous development cycle. Self-debug loop included.\n\n';
// ReAct protocol definition
d += G ? '## 🔄 ReActプロトコル定義\n\n' : '## 🔄 ReAct Protocol Definition\n\n';
d += G ? '| ステージ | 役割 | 説明 |\n|----------|------|------|\n' :
'| Stage | Role | Description |\n|-------|------|-------------|\n';
var stages = G ? [
['Reason (思考)', 'プランニング', '次のアクションを決定する前に、現状・目標・制約を分析する'],
['Act (実行)', 'ツール実行', 'reasonで決定したアクションを具体的なツール呼び出しで実行する'],
['Observe (観察)', '結果評価', 'ツール実行の結果を客観的に観察し、期待との差異を特定する'],
['Verify (検証)', '品質確認', '事前定義した成功基準に照らして、出力の品質を検証する']
] : [
['Reason', 'Planning', 'Before next action, analyze current state, goals, and constraints'],
['Act', 'Tool execution', 'Execute action determined in Reason phase via specific tool calls'],
['Observe', 'Result evaluation', 'Objectively observe tool execution results, identify gaps from expectations'],
['Verify', 'Quality check', 'Validate output quality against predefined success criteria']
];
stages.forEach(function(s) {
d += '| **' + s[0] + '** | ' + s[1] + ' | ' + s[2] + ' |\n';
});
d += '\n';
// 6-phase ReAct cycles
d += G ? '## 📋 6フェーズ × ReActサイクル\n\n' : '## 📋 6 Phases × ReAct Cycles\n\n';
REACT_PROTOCOL.forEach(function(phase) {
d += '### ' + (G ? phase.name_ja : phase.name_en) + '\n\n';
d += G ? '| ReActステージ | 内容 |\n|--------------|------|\n' :
'| ReAct Stage | Content |\n|-------------|----------|\n';
d += '| **Reason** | ' + (G ? phase.reason.ja : phase.reason.en) + ' |\n';
d += '| **Act** | `' + (G ? phase.act.ja : phase.act.en) + '` |\n';
d += '| **Observe** | ' + (G ? phase.observe.ja : phase.observe.en) + ' |\n';
d += '| **Verify** | ' + (G ? phase.verify.ja : phase.verify.en) + ' |\n';
// Domain-specific tool extensions
if (domain === 'fintech') {
d += G ? '| **Domain+** | `compliance_check` (金融規制自動チェック) |\n' :
'| **Domain+** | `compliance_check` (automated financial regulation check) |\n';
} else if (domain === 'health') {
d += G ? '| **Domain+** | `phi_scan` (PHI漏洩リスク検出) |\n' :
'| **Domain+** | `phi_scan` (PHI leak risk detection) |\n';
}
d += '\n';
});
// Self-debug loop
d += G ? '## 🔁 自己デバッグループ\n\n' : '## 🔁 Self-Debug Loop\n\n';
d += G ? '**エラー発生時の自律修復プロセス (最大3反復):**\n\n' :
'**Autonomous repair process on error (max 3 iterations):**\n\n';
d += G ? '```\nError → Reason (根本原因分析)\n      → Act (修正実行)\n      → Observe (修正結果確認)\n      → Verify (修正の有効性確認)\n      → [まだ失敗の場合] → 次の反復 (max 3回)\n      → [3回失敗] → 人間へのエスカレーション\n```\n\n' :
'```\nError → Reason (root cause analysis)\n      → Act (apply fix)\n      → Observe (verify fix result)\n      → Verify (validate fix effectiveness)\n      → [still failing] → next iteration (max 3)\n      → [3 failures] → escalate to human\n```\n\n';
d += G ? '**失敗復旧パターン:**\n\n' : '**Failure Recovery Patterns:**\n\n';
var recovery = G ? [
['retry', '一時的エラー（ネットワーク・タイムアウト）', '同じActを最大3回リトライ。指数バックオフ適用'],
['fallback', '機能的エラー（ツール失敗・API拒否）', '代替ツールまたはアプローチに切り替え'],
['escalate', '判断が必要な複合エラー', '人間への委譲。エラー内容・試行履歴を要約して提供']
] : [
['retry', 'Transient errors (network, timeout)', 'Retry same Act up to 3 times with exponential backoff'],
['fallback', 'Functional errors (tool failure, API rejection)', 'Switch to alternative tool or approach'],
['escalate', 'Complex errors requiring judgment', 'Delegate to human with error summary and attempt history']
];
recovery.forEach(function(r) {
d += '**' + r[0].toUpperCase() + '**: ' + r[1] + '\n→ ' + r[2] + '\n\n';
});
// Mermaid ReAct state machine
d += '```mermaid\n';
d += 'graph TD\n';
d += '  S[' + (G ? '開始' : 'Start') + '] --> R[Reason]\n';
d += '  R --> A[Act]\n';
d += '  A --> O[Observe]\n';
d += '  O --> V{Verify}\n';
d += '  V -->|' + (G ? '成功' : 'Pass') + '| N[' + (G ? '次フェーズ' : 'Next Phase') + ']\n';
d += '  V -->|' + (G ? '失敗 iter<3' : 'Fail iter<3') + '| R\n';
d += '  V -->|' + (G ? '失敗 iter=3' : 'Fail iter=3') + '| E[' + (G ? 'エスカレーション' : 'Escalate') + ']\n';
d += '  style N fill:#22c55e,color:#fff\n';
d += '  style E fill:#ef4444,color:#fff\n';
d += '```\n';
return d;
}
function gen71(G, matLv, a, pn) {
var d = G ? '# LLMOps 評価ダッシュボード — ' + pn + '\n\n' : '# LLMOps Evaluation Dashboard — ' + pn + '\n\n';
d += G ? '> AI成熟度レベル ' + matLv + ' に最適化されたLLMOpsスタック・評価メトリクス・コスト最適化戦略。\n\n' :
'> LLMOps stack, evaluation metrics, and cost optimization strategies optimized for AI Maturity Level ' + matLv + '.\n\n';
// Recommended stack for current maturity level
var stack = LLMOPS_STACK[matLv - 1];
d += G ? '## 🛠️ 推奨LLMOpsスタック (Level ' + matLv + ': ' + stack.label_ja + ')\n\n' :
'## 🛠️ Recommended LLMOps Stack (Level ' + matLv + ': ' + stack.label_en + ')\n\n';
d += G ? '**ツール:** ' + stack.tools_ja + '\n\n' : '**Tools:** ' + stack.tools_en + '\n\n';
d += G ? '**セットアップ:** ' + stack.setup_ja + '\n\n' : '**Setup:** ' + stack.setup_en + '\n\n';
// All 3 levels comparison
d += G ? '## 📊 成熟度別LLMOpsスタック比較\n\n' : '## 📊 LLMOps Stack Comparison by Maturity\n\n';
d += G ? '| レベル | ツール | 主要メトリクス | セットアップ |\n|--------|--------|--------------|-------------|\n' :
'| Level | Tools | Key Metrics | Setup |\n|-------|-------|-------------|-------|\n';
LLMOPS_STACK.forEach(function(s) {
var active = s.lv === matLv ? ' ← **現在**' : '';
d += '| **Level ' + s.lv + ': ' + (G ? s.label_ja : s.label_en) + '**' + (G ? active : active.replace('現在', 'Current')) + ' | ' +
(G ? s.tools_ja.substring(0, 40) : s.tools_en.substring(0, 40)) + '... | ' +
(G ? s.metrics_ja.slice(0, 2).join(', ') : s.metrics_en.slice(0, 2).join(', ')) + ' | ' +
(G ? s.setup_ja.substring(0, 30) : s.setup_en.substring(0, 30)) + '... |\n';
});
d += '\n';
// CRITERIA integration metrics
d += G ? '## 📈 評価メトリクス定義 (CRITERIA連携)\n\n' : '## 📈 Evaluation Metrics Definition (CRITERIA Integration)\n\n';
d += G ? '> docs/65 Prompt Genome の CRITERIA 8軸をLLMOpsメトリクスに自動統合します。\n\n' :
'> Automatically integrates CRITERIA 8-axis from docs/65 Prompt Genome into LLMOps metrics.\n\n';
d += G ? '| CRITERIA軸 | 重み | LLMOpsメトリクス | 計測方法 |\n|-----------|------|----------------|----------|\n' :
'| CRITERIA Axis | Weight | LLMOps Metric | Measurement |\n|--------------|--------|---------------|-------------|\n';
var criteriaMetrics = G ? [
['Context', '15%', 'コンテキスト品質スコア', 'LangSmith評価テンプレートで自動採点'],
['Instructions', '20%', '指示明確性スコア', 'テスト入力5件の出力整合率で計算'],
['Execution Rules', '15%', 'ルール遵守率', '出力の禁止事項違反数をカウント'],
['Thought Process', '10%', 'CoT品質スコア', '推論ステップの論理的一貫性を評価'],
['Reflection', '10%', '自己修正率', 'セルフクリティーク後の改善度を計測'],
['Iteration', '10%', '反復改善効率', '各反復での品質向上率を算出'],
['Adaptation', '10%', 'コンテキスト適応率', 'ドメイン別出力品質の一致度'],
['Role', '10%', '役割一貫性スコア', '役割逸脱回数 / 総出力数']
] : [
['Context', '15%', 'Context quality score', 'Auto-scored with LangSmith evaluation template'],
['Instructions', '20%', 'Instruction clarity score', 'Output consistency rate across 5 test inputs'],
['Execution Rules', '15%', 'Rule adherence rate', 'Count prohibition violations in output'],
['Thought Process', '10%', 'CoT quality score', 'Evaluate logical consistency of reasoning steps'],
['Reflection', '10%', 'Self-correction rate', 'Measure improvement after self-critique'],
['Iteration', '10%', 'Iterative improvement efficiency', 'Calculate quality gain rate per iteration'],
['Adaptation', '10%', 'Context adaptation rate', 'Domain-specific output quality match rate'],
['Role', '10%', 'Role consistency score', 'Role deviations / total outputs']
];
criteriaMetrics.forEach(function(m) {
d += '| **' + m[0] + '** | ' + m[1] + ' | ' + m[2] + ' | ' + m[3] + ' |\n';
});
d += '\n';
// Cost optimization
d += G ? '## 💰 コスト最適化戦略\n\n' : '## 💰 Cost Optimization Strategy\n\n';
var costStrategies = G ? [
['トークン予算管理', 'Phase 0-1は簡潔プロンプト(I=3)、Phase 2-3は詳細プロンプト(I=5)に分けてコスト管理'],
['キャッシュ戦略', '同一コンテキストへの繰り返しクエリはセマンティックキャッシュで70%コスト削減'],
['モデル選定ガイド', '探索タスク→Haiku、設計・実装→Sonnet、アーキテクチャ・監査→Opus/Gemini Pro'],
['バッチ処理', 'リアルタイム不要なA/Bテスト・評価処理はバッチAPIで50%コスト削減']
] : [
['Token budget management', 'Use concise prompts (I=3) for Phase 0-1, detailed (I=5) for Phase 2-3'],
['Cache strategy', 'Semantic cache for repeated queries on same context, 70% cost reduction'],
['Model selection guide', 'Exploration→Haiku, Design/Implementation→Sonnet, Architecture/Audit→Opus/Gemini Pro'],
['Batch processing', 'Use batch API for non-real-time A/B tests and evaluations, 50% cost reduction']
];
costStrategies.forEach(function(c) {
d += '**' + c[0] + ':** ' + c[1] + '\n\n';
});
// Mermaid LLMOps architecture
d += '```mermaid\n';
d += 'graph TD\n';
d += '  P[' + (G ? 'プロンプト実行' : 'Prompt Execution') + '] --> T[' + (G ? 'トレーシング' : 'Tracing') + ']\n';
d += '  T --> C[CRITERIA ' + (G ? '自動評価' : 'Auto Eval') + ']\n';
d += '  C --> D[' + (G ? 'ダッシュボード' : 'Dashboard') + ']\n';
d += '  D --> A{' + (G ? 'アラート閾値?' : 'Alert threshold?') + '}\n';
d += '  A -->|' + (G ? '超過' : 'Exceeded') + '| R[' + (G ? 'ロールバック' : 'Rollback') + ']\n';
d += '  A -->|OK| O[' + (G ? '継続最適化' : 'Continuous Opt') + ']\n';
d += '  O --> AB[A/B ' + (G ? 'テスト' : 'Test') + ']\n';
d += '  AB --> P\n';
d += '  style C fill:#4f46e5,color:#fff\n';
d += '```\n';
return d;
}
function gen72(G, domain, meth, matLv, a, pn) {
var d = G ? '# [META]プロンプトレジストリ — ' + pn + '\n\n' : '# [META] Prompt Registry — ' + pn + '\n\n';
d += G ? '> Template-ID管理・バージョニング・ドメイン別テンプレートカタログ。P17 docs/65との連携運用。\n\n' :
'> Template-ID management, versioning, domain-specific template catalog. Operates with P17 docs/65.\n\n';
// [META] template structure
d += G ? '## 🧬 [META]テンプレート構造定義\n\n' : '## 🧬 [META] Template Structure Definition\n\n';
d += G ? '> [META]ブロックは4層アーキテクチャのLayer 1（不変層）に対応します。\n\n' :
'> The [META] block corresponds to Layer 1 (Immutable) in the 4-layer architecture.\n\n';
d += '```\n[META]\nTemplate-ID: {DOMAIN}-{USECASE}-v{MAJOR}.{MINOR}.{PATCH}\nDomain: ' + domain + '\nUsecase: {specific-task}\nMaturity-Level: ' + matLv + '\nCRITERIA-Targets:\n  Context: {target}/5\n  Role: {target}/5\n  Instructions: {target}/5\n  Thought-Process: {target}/5\n  Execution-Rules: {target}/5\n  Reflection: {target}/5\n  Iteration: {target}/5\n  Adaptation: {target}/5\n  Total-Weighted: {target}/5\nVersion-History:\n  - v1.0.0: {initial creation}\n  - v1.1.0: {improvement note}\nRegistry-Path: docs/72_prompt_registry.md\nRef-Genome: docs/65_prompt_genome.md\n[/META]\n```\n\n';
// Template-ID naming convention
d += G ? '## 📋 Template-ID 命名規則\n\n' : '## 📋 Template-ID Naming Convention\n\n';
d += G ? '```\n{DOMAIN}-{PHASE}-{USECASE}-v{MAJOR}.{MINOR}.{PATCH}\n例: ' + domain.toUpperCase() + '-P2-IMPLEMENT-v1.2.0\n    ' + domain.toUpperCase() + '-P4-REVIEW-v2.0.0\n    ' + domain.toUpperCase() + '-P5-DEPLOY-v1.0.3\n```\n\n' :
'```\n{DOMAIN}-{PHASE}-{USECASE}-v{MAJOR}.{MINOR}.{PATCH}\nExample: ' + domain.toUpperCase() + '-P2-IMPLEMENT-v1.2.0\n         ' + domain.toUpperCase() + '-P4-REVIEW-v2.0.0\n         ' + domain.toUpperCase() + '-P5-DEPLOY-v1.0.3\n```\n\n';
// Domain-specific template catalog
d += G ? '## 📚 ' + domain + 'ドメイン テンプレートカタログ\n\n' :
'## 📚 ' + domain + ' Domain Template Catalog\n\n';
// Top 5 prompts for detected domain
var domainTemplates = [];
if (domain === 'fintech') {
domainTemplates = G ? [
{id: 'FINTECH-P1-RISK-DESIGN-v1.0.0', use: 'リスクエンジン設計', ctx: 5, inst: 5, er: 5, total: '4.8'},
{id: 'FINTECH-P2-TRANSACTION-v1.2.0', use: '取引フロー実装', ctx: 5, inst: 5, er: 5, total: '4.7'},
{id: 'FINTECH-P3-COMPLIANCE-v1.0.0', use: 'コンプライアンスチェック', ctx: 4, inst: 5, er: 5, total: '4.6'},
{id: 'FINTECH-P4-AUDIT-v2.0.0', use: 'セキュリティ監査', ctx: 5, inst: 5, er: 5, total: '4.8'},
{id: 'FINTECH-P5-INCIDENT-v1.0.0', use: 'インシデント対応', ctx: 4, inst: 4, er: 5, total: '4.4'}
] : [
{id: 'FINTECH-P1-RISK-DESIGN-v1.0.0', use: 'Risk engine design', ctx: 5, inst: 5, er: 5, total: '4.8'},
{id: 'FINTECH-P2-TRANSACTION-v1.2.0', use: 'Transaction flow implementation', ctx: 5, inst: 5, er: 5, total: '4.7'},
{id: 'FINTECH-P3-COMPLIANCE-v1.0.0', use: 'Compliance check', ctx: 4, inst: 5, er: 5, total: '4.6'},
{id: 'FINTECH-P4-AUDIT-v2.0.0', use: 'Security audit', ctx: 5, inst: 5, er: 5, total: '4.8'},
{id: 'FINTECH-P5-INCIDENT-v1.0.0', use: 'Incident response', ctx: 4, inst: 4, er: 5, total: '4.4'}
];
} else if (domain === 'education') {
domainTemplates = G ? [
{id: 'EDU-P1-CURRICULUM-v1.0.0', use: 'カリキュラム設計', ctx: 4, inst: 5, er: 4, total: '4.4'},
{id: 'EDU-P2-LEARNING-FLOW-v1.1.0', use: '学習フロー実装', ctx: 5, inst: 5, er: 4, total: '4.6'},
{id: 'EDU-P3-ASSESSMENT-v1.0.0', use: '評価・テスト設計', ctx: 4, inst: 5, er: 4, total: '4.4'},
{id: 'EDU-P4-PROGRESS-v1.0.0', use: '進捗トラッキング', ctx: 4, inst: 4, er: 4, total: '4.2'},
{id: 'EDU-P5-ENGAGEMENT-v1.0.0', use: 'エンゲージメント改善', ctx: 5, inst: 4, er: 3, total: '4.1'}
] : [
{id: 'EDU-P1-CURRICULUM-v1.0.0', use: 'Curriculum design', ctx: 4, inst: 5, er: 4, total: '4.4'},
{id: 'EDU-P2-LEARNING-FLOW-v1.1.0', use: 'Learning flow implementation', ctx: 5, inst: 5, er: 4, total: '4.6'},
{id: 'EDU-P3-ASSESSMENT-v1.0.0', use: 'Assessment & test design', ctx: 4, inst: 5, er: 4, total: '4.4'},
{id: 'EDU-P4-PROGRESS-v1.0.0', use: 'Progress tracking', ctx: 4, inst: 4, er: 4, total: '4.2'},
{id: 'EDU-P5-ENGAGEMENT-v1.0.0', use: 'Engagement improvement', ctx: 5, inst: 4, er: 3, total: '4.1'}
];
} else {
// Generic domain templates
var domUpper = domain.substring(0, 4).toUpperCase();
domainTemplates = G ? [
{id: domUpper + '-P1-DESIGN-v1.0.0', use: 'アーキテクチャ設計', ctx: 5, inst: 5, er: 4, total: '4.6'},
{id: domUpper + '-P2-IMPLEMENT-v1.0.0', use: 'コア機能実装', ctx: 5, inst: 5, er: 5, total: '4.7'},
{id: domUpper + '-P3-TEST-v1.0.0', use: 'テスト戦略', ctx: 4, inst: 5, er: 4, total: '4.4'},
{id: domUpper + '-P4-REVIEW-v1.0.0', use: 'コードレビュー', ctx: 4, inst: 4, er: 5, total: '4.3'},
{id: domUpper + '-P5-DEPLOY-v1.0.0', use: 'デプロイ・運用', ctx: 4, inst: 4, er: 5, total: '4.3'}
] : [
{id: domUpper + '-P1-DESIGN-v1.0.0', use: 'Architecture design', ctx: 5, inst: 5, er: 4, total: '4.6'},
{id: domUpper + '-P2-IMPLEMENT-v1.0.0', use: 'Core feature implementation', ctx: 5, inst: 5, er: 5, total: '4.7'},
{id: domUpper + '-P3-TEST-v1.0.0', use: 'Test strategy', ctx: 4, inst: 5, er: 4, total: '4.4'},
{id: domUpper + '-P4-REVIEW-v1.0.0', use: 'Code review', ctx: 4, inst: 4, er: 5, total: '4.3'},
{id: domUpper + '-P5-DEPLOY-v1.0.0', use: 'Deploy & operations', ctx: 4, inst: 4, er: 5, total: '4.3'}
];
}
d += G ? '| Template-ID | ユースケース | Context | Instructions | Exec.Rules | 総合 |\n|-------------|------------|---------|-------------|-----------|------|\n' :
'| Template-ID | Usecase | Context | Instructions | Exec.Rules | Total |\n|-------------|---------|---------|-------------|-----------|-------|\n';
domainTemplates.forEach(function(t) {
d += '| `' + t.id + '` | ' + t.use + ' | ' + t.ctx + '/5 | ' + t.inst + '/5 | ' + t.er + '/5 | **' + t.total + '/5** |\n';
});
d += '\n';
// Version history format
d += G ? '## 📝 バージョン履歴フォーマット\n\n' : '## 📝 Version History Format\n\n';
d += G ? '```markdown\n## CHANGELOG — {Template-ID}\n\n### v1.1.0 — {date}\n- **改善**: Instructionsブロックに禁止事項5条を追加 (+0.5 CRITERIA)\n- **測定**: 成功率 72% → 85% (+13%)\n- **理由**: テスト5件中3件でルール違反が検出されたため\n\n### v1.0.0 — {date}\n- **初回**: 基本テンプレート作成\n- **CRITERIA**: Context=4, Instructions=4, ExecRules=3, Total=3.8\n```\n\n' :
'```markdown\n## CHANGELOG — {Template-ID}\n\n### v1.1.0 — {date}\n- **Improvement**: Added 5 prohibition rules to Instructions block (+0.5 CRITERIA)\n- **Measurement**: Success rate 72% → 85% (+13%)\n- **Reason**: Rule violations detected in 3/5 test cases\n\n### v1.0.0 — {date}\n- **Initial**: Basic template creation\n- **CRITERIA**: Context=4, Instructions=4, ExecRules=3, Total=3.8\n```\n\n';
// Cross-reference
d += G ? '## 🔗 クロスリファレンス\n\n' : '## 🔗 Cross-Reference\n\n';
d += G ? '| ドキュメント | 関係性 |\n|------------|--------|\n' :
'| Document | Relationship |\n|----------|-------------|\n';
d += G ? '| docs/65_prompt_genome.md | プロンプトDNA設計 → このRegistryで運用化 |\n' :
'| docs/65_prompt_genome.md | Prompt DNA design → operationalized in this Registry |\n';
d += G ? '| docs/66_ai_maturity_assessment.md | 成熟度Level ' + matLv + ' → スタック選定に反映 |\n' :
'| docs/66_ai_maturity_assessment.md | Maturity Level ' + matLv + ' → reflected in stack selection |\n';
d += G ? '| docs/69_prompt_ops_pipeline.md | Lifecycle管理 → RegistryのDeploy/Monitorステージと連携 |\n' :
'| docs/69_prompt_ops_pipeline.md | Lifecycle management → linked with Registry Deploy/Monitor stages |\n';
d += G ? '| docs/71_llmops_dashboard.md | メトリクス収集 → Registryのパフォーマンストラッキング |\n' :
'| docs/71_llmops_dashboard.md | Metrics collection → Registry performance tracking |\n';
d += '\n';
// Mermaid registry architecture
d += '```mermaid\n';
d += 'graph TD\n';
d += '  G65[docs/65<br/>Prompt Genome] -->|' + (G ? 'DNA設計' : 'DNA Design') + '| R[' + (G ? 'Registryに登録' : 'Register in Registry') + ']\n';
d += '  R --> V[' + (G ? 'バージョン管理' : 'Version Control') + ']\n';
d += '  V --> D[' + (G ? 'デプロイ' : 'Deploy') + ']\n';
d += '  D --> M[docs/71<br/>LLMOps ' + (G ? '監視' : 'Monitor') + ']\n';
d += '  M -->|' + (G ? '品質低下' : 'Degradation') + '| G65\n';
d += '  D --> P[docs/69<br/>Pipeline]\n';
d += '  style R fill:#4f46e5,color:#fff\n';
d += '```\n';
return d;
}
function genPillar18_PromptOps(a, pn) {
var G = S.genLang === 'ja';
var domain = detectDomain(a.purpose || '') || 'saas';
var meth = DEV_METHODOLOGY_MAP[domain] || DEV_METHODOLOGY_MAP._default;
var aiAuto = a.ai_auto || '';
var matLv = /自律|orch|autonomous/i.test(aiAuto) ? 3 :
/マルチ|multi|full/i.test(aiAuto) ? 2 : 1;
S.files['docs/69_prompt_ops_pipeline.md'] = gen69(G, domain, meth, matLv, a, pn);
S.files['docs/70_react_workflow.md'] = gen70(G, domain, matLv, a, pn);
S.files['docs/71_llmops_dashboard.md'] = gen71(G, matLv, a, pn);
S.files['docs/72_prompt_registry.md'] = gen72(G, domain, meth, matLv, a, pn);
}
// P19: Enterprise SaaS Blueprint
// Generates: docs/73_enterprise_architecture.md, 74_workflow_engine.md,
//            75_admin_dashboard_spec.md, 76_enterprise_components.md

// ============================================================================
// DATA CONSTANTS
// ============================================================================

// Factory: Enterprise Architecture Pattern
function _ep(pattern, tenantIsolation, rbacModel, scalingStrategy, rlsExample) {
return {pattern, tenantIsolation, rbacModel, scalingStrategy, rlsExample};
}
var ENTERPRISE_ARCH_PATTERNS = {
rls: _ep('Row-Level Security (RLS)',
'org_id column on all tables + Supabase/Postgres RLS policies',
'Owner > Admin > Member > Viewer (4-tier)',
'Single DB, scales to millions of tenants with row filtering',
'USING (org_id IN (SELECT org_id FROM org_members WHERE user_id = auth.uid()))'
),
schema: _ep('Schema-per-tenant',
'Separate Postgres schema per tenant (search_path = tenant_{id})',
'Role inherited from schema owner + row-level for sub-roles',
'Good isolation, ~1K tenant limit per instance; use with pgBouncer',
'SET search_path TO tenant_<org_id>; -- per connection'
),
db: _ep('Database-per-tenant',
'Separate DB instance per tenant (connection string in config table)',
'Full DB-level role separation, no cross-tenant queries possible',
'Maximum isolation; high cost; use for regulated industries (fintech/health)',
'N/A — isolation at DB level; use separate Supabase projects'
),
hybrid: _ep('Hybrid (RLS + Feature Flags)',
'RLS for data + LaunchDarkly/Unleash for feature gating per org plan',
'RLS roles + plan-based feature entitlements (free/pro/enterprise)',
'Best of both: data isolation + flexible feature rollout per org tier',
'USING (org_id IN (...)) AND EXISTS (SELECT 1 FROM org_features WHERE org_id = org_members.org_id AND feature = \'advanced_reports\')'
)
};
// Factory: Workflow state machine
function _wf(name, name_ja, states, transitions, roles, sla_ja, sla_en) {
return {name, name_ja, states, transitions, roles, sla_ja, sla_en};
}
var WORKFLOW_TEMPLATES = {
approval: _wf('Approval', '承認ワークフロー',
['draft', 'pending', 'approved', 'rejected', 'cancelled'],
[['draft','pending','Submit for review'],['pending','approved','Approver approves'],['pending','rejected','Approver rejects'],['rejected','draft','Requester revises'],['pending','cancelled','Requester cancels']],
['Requester: create/edit draft, cancel', 'Approver: approve/reject', 'Admin: override any state'],
'承認期限: SLA 48h / エスカレーション: 72h で上位承認者へ自動通知',
'Approval SLA: 48h / Escalation: auto-notify senior approver after 72h'
),
ticket: _wf('Ticket', 'チケット管理',
['open', 'in_progress', 'review', 'resolved', 'closed'],
[['open','in_progress','Assign to agent'],['in_progress','review','Mark for review'],['review','resolved','Verify fix'],['resolved','closed','Auto-close after 7d'],['resolved','open','Customer re-opens']],
['Customer: create/reopen', 'Agent: move to in_progress/review', 'Manager: close/escalate'],
'応答時間: P1=1h, P2=4h, P3=24h / 解決時間: P1=4h, P2=8h, P3=72h',
'Response: P1=1h, P2=4h, P3=24h / Resolution: P1=4h, P2=8h, P3=72h'
),
order: _wf('Order', '注文フロー',
['created', 'paid', 'processing', 'shipped', 'delivered', 'cancelled'],
[['created','paid','Payment confirmed'],['paid','processing','Fulfillment starts'],['processing','shipped','Carrier pickup'],['shipped','delivered','Delivery confirmed'],['created','cancelled','Customer cancels'],['paid','cancelled','Refund initiated']],
['Customer: create/cancel unpaid', 'Warehouse: processing/ship', 'System: auto-delivered via webhook'],
'処理時間: 支払→発送 24h以内 / 配達確認: 配送完了から48h以内に自動確認',
'Processing: payment→ship within 24h / Delivery confirm: auto-confirm within 48h'
),
contract: _wf('Contract', '契約管理',
['draft', 'review', 'negotiation', 'signed', 'active', 'expired'],
[['draft','review','Submit for review'],['review','negotiation','Request changes'],['negotiation','review','Re-submit revised'],['review','signed','All parties sign'],['signed','active','Effective date reached'],['active','expired','End date reached']],
['Author: create/edit draft', 'Legal: review/negotiate', 'Signatory: sign', 'System: activate/expire'],
'レビュー期限: 5営業日 / 署名期限: 10営業日 / 期限切れ: 終了日+30日でアーカイブ',
'Review deadline: 5 business days / Signing deadline: 10 days / Expiry: archive 30d after end date'
),
onboarding: _wf('Onboarding', 'オンボーディング',
['invited', 'registered', 'profile_setup', 'team_joined', 'active'],
[['invited','registered','User registers'],['registered','profile_setup','Complete profile'],['profile_setup','team_joined','Join/create team'],['team_joined','active','Complete checklist']],
['System: send invite/reminders', 'User: progress through steps', 'Admin: monitor/resend invites'],
'フォローアップ: 招待後24h未登録→リマインダー / 7日未完了→管理者通知',
'Follow-up: 24h no register→reminder / 7d incomplete→admin notify'
)
};
// Factory: Admin dashboard specification
function _adm(category, category_ja, kpis, widgets_ja, widgets_en) {
return {category, category_ja, kpis, widgets_ja, widgets_en};
}
var ADMIN_DASHBOARD_SPECS = {
overview: _adm('Overview', '概要', ['total_users', 'active_orgs', 'mrr', 'churn_rate'],
['総ユーザー数 (前週比)', 'アクティブ組織数', 'MRR (月次課金収入)', 'チャーン率 (7日移動平均)', '日次新規登録グラフ', '機能別利用率ヒートマップ'],
['Total users (vs. last week)', 'Active organizations', 'MRR (monthly recurring revenue)', 'Churn rate (7-day moving avg)', 'Daily registration chart', 'Feature adoption heatmap']
),
users: _adm('User Analytics', 'ユーザー分析', ['dau_mau', 'retention', 'cohort'],
['DAU/MAU比率', '7日/30日リテンション', 'コホート分析テーブル', 'ユーザーセグメント分布', 'スキルレベル別利用パターン', 'オンボーディング完了率'],
['DAU/MAU ratio', '7-day / 30-day retention', 'Cohort analysis table', 'User segment distribution', 'Usage patterns by skill level', 'Onboarding completion rate']
),
billing: _adm('Billing', '課金管理', ['mrr', 'arr', 'arpu', 'ltv'],
['プラン別収益内訳', 'MRR推移グラフ (12ヶ月)', 'アップグレード/ダウングレード率', 'ARPU (ユーザー単価)', 'LTV予測', 'Stripe Webhook受信ステータス'],
['Revenue by plan', 'MRR trend (12 months)', 'Upgrade/downgrade rate', 'ARPU (average revenue per user)', 'LTV forecast', 'Stripe Webhook status']
),
ops: _adm('Operations', '運用管理', ['sla_compliance', 'ticket_resolution', 'uptime'],
['SLA遵守率 (目標99%)', 'チケット平均解決時間', 'サービス稼働率', '未解決チケット (優先度別)', '監査ログ最近50件', 'APIエラー率ダッシュボード'],
['SLA compliance rate (target 99%)', 'Avg ticket resolution time', 'Service uptime', 'Open tickets by priority', 'Recent 50 audit log entries', 'API error rate dashboard']
)
};
// Factory: Enterprise UI Component
function _ec(name, props_ja, variants_ja, a11y_ja, framework) {
return {name, props_ja, variants_ja, a11y_ja, framework};
}
var ENTERPRISE_COMPONENTS = {
StatusBadge: _ec('StatusBadge',
['status: string (draft|pending|approved|rejected|active|expired)', 'size?: sm|md|lg', 'variant?: solid|outline|subtle'],
['pending → 黄色 (⏳)', 'approved → 緑 (✅)', 'rejected → 赤 (❌)', 'active → 青 (🔵)', 'expired → グレー'],
['role="status" aria-label="{status}"', 'カラーだけでなくアイコン+テキストで状態を伝達'],
'shadcn/ui Badge + カスタムバリアント / Vuetify v-chip / Angular Material chip'
),
ApprovalBar: _ec('ApprovalBar',
['request: ApprovalRequest', 'onApprove: (id) => void', 'onReject: (id, reason) => void', 'currentUserRole: string'],
['pending (承認待ち: 承認/却下ボタン表示)', 'approved (完了: 緑バナー)', 'rejected (却下: 理由表示)'],
['button aria-label="承認"/"却下"', '却下時はモーダルでreason入力必須', 'aria-disabled={!canApprove}'],
'shadcn/ui AlertDialog + Button / Headless UI Dialog'
),
DataTable: _ec('DataTable',
['data: T[]', 'columns: ColumnDef<T>[]', 'sortable?: boolean', 'filterable?: boolean', 'paginated?: boolean', 'onRowSelect?: (rows) => void', 'bulkActions?: Action[]'],
['基本テーブル', 'ソート有効', 'フィルタ有効', 'ページネーション', '行選択+一括操作'],
['role="table" + aria-sort', 'ページネーション aria-label="ページ {n}"', 'フィルタ label 対応'],
'TanStack Table v8 + shadcn/ui / AG Grid Community / Vuetify v-data-table'
),
NotificationBell: _ec('NotificationBell',
['count: number', 'items: Notification[]', 'onRead: (id) => void', 'onReadAll: () => void', 'maxDisplay?: number'],
['未読あり (赤バッジ+数字)', '未読なし (通常アイコン)', 'ドロップダウン展開 (最新5件)'],
['aria-label="通知 {count}件未読"', 'role="alert" aria-live="polite" (新着時)', '通知リスト role="list"'],
'shadcn/ui Popover + Badge / Radix UI Popover'
),
OrgSwitcher: _ec('OrgSwitcher',
['orgs: Organization[]', 'current: Organization', 'onChange: (org) => void', 'canCreate?: boolean'],
['単一組織 (表示のみ)', '複数組織 (切替ドロップダウン)', '組織作成ボタン付き'],
['combobox role + aria-expanded', '選択中組織に aria-selected="true"', 'キーボードナビゲーション対応'],
'shadcn/ui Command + Popover / Headless UI Combobox'
),
OnboardingStepper: _ec('OnboardingStepper',
['steps: Step[]', 'current: number', 'onComplete: () => void', 'onStepClick?: (n) => void'],
['水平ステッパー (デスクトップ)', '垂直ステッパー (モバイル)', '進捗バー付き'],
['aria-current="step" for active', 'completed steps aria-label="{step} 完了"', 'progress bar aria-valuenow'],
'shadcn/ui Steps (custom) / Vuetify v-stepper / Angular Material stepper'
),
AuditTimeline: _ec('AuditTimeline',
['events: AuditEvent[]', 'filter?: { action, user, dateRange }', 'maxItems?: number'],
['コンパクト (アイコン+サマリー)', '詳細 (フルメタデータ表示)', 'フィルタパネル付き'],
['role="feed" aria-label="監査ログ"', '各エントリ role="article"', 'time datetime="{ISO}"'],
'カスタムコンポーネント (shadcn/ui Card) / Vuetify v-timeline'
),
InviteManager: _ec('InviteManager',
['invites: OrgInvite[]', 'onCreate: (email, role) => void', 'onRevoke: (id) => void', 'onResend: (id) => void'],
['招待一覧テーブル (保留中/期限切れ)', '招待作成フォーム (メール+ロール選択)', '一括招待 (CSVインポート)'],
['フォーム label 対応', '削除確認 AlertDialog', 'aria-live="polite" (招待送信完了)'],
'shadcn/ui Table + Dialog + Form / React Hook Form + Zod validation'
)
};
// ============================================================================
// GENERATOR FUNCTIONS
// ============================================================================

function gen73(G, domain, orgModel, isMultiTenant, a, pn) {
var d = G ? '# エンタープライズアーキテクチャ — ' + pn + '\n\n' :
'# Enterprise Architecture — ' + pn + '\n\n';
d += G ? '> マルチテナント設計・組織データモデル・権限マトリクス・RLSポリシーテンプレート。\n\n' :
'> Multi-tenant design, organization data model, permission matrix, RLS policy templates.\n\n';
// Architecture pattern selection — map chip values to pattern keys
var selKey = 'rls';
if (/ワークスペース|workspace/i.test(orgModel)) selKey = 'schema';
else if (/組織.*チーム|org.*team|hierarchy|階層/i.test(orgModel)) selKey = 'hybrid';
else if (/database.*per|db.*per/i.test(orgModel)) selKey = 'db';
var pat = ENTERPRISE_ARCH_PATTERNS[selKey];
d += G ? '## 🏗️ テナント分離戦略\n\n' : '## 🏗️ Tenant Isolation Strategy\n\n';
d += G ? '| パターン | テナント分離 | RBACモデル | スケーリング |\n|---------|------------|------------|------------|\n' :
'| Pattern | Tenant Isolation | RBAC Model | Scaling |\n|---------|-----------------|------------|----------|\n';
Object.entries(ENTERPRISE_ARCH_PATTERNS).forEach(function(entry) {
var k = entry[0]; var p = entry[1];
var sel = (k === selKey);
d += '| ' + (sel ? '**✅ ' : '') + p.pattern + (sel ? ' (' + (G ? '選択中' : 'selected') + ')**' : '') + ' | ' + p.tenantIsolation.substring(0, 40) + '... | ' + p.rbacModel + ' | ' + p.scalingStrategy.substring(0, 45) + '... |\n';
});
d += '\n';
d += G ? '### 採用パターン詳細: ' + pat.pattern + '\n\n' : '### Selected Pattern Detail: ' + pat.pattern + '\n\n';
d += G ? '- **テナント分離**: ' + pat.tenantIsolation + '\n' : '- **Tenant Isolation**: ' + pat.tenantIsolation + '\n';
d += G ? '- **RBACモデル**: ' + pat.rbacModel + '\n' : '- **RBAC Model**: ' + pat.rbacModel + '\n';
d += G ? '- **スケーリング**: ' + pat.scalingStrategy + '\n\n' : '- **Scaling**: ' + pat.scalingStrategy + '\n\n';
// Organization ER Diagram
d += G ? '## 📊 組織データモデル (ER図)\n\n' : '## 📊 Organization Data Model (ER Diagram)\n\n';
d += '```mermaid\nerDiagram\n';
d += '  User {\n    uuid id PK\n    varchar email UK\n    varchar role\n  }\n';
d += '  Organization {\n    uuid id PK\n    varchar slug UK\n    varchar plan\n    varchar status\n  }\n';
d += '  OrgMember {\n    uuid org_id FK\n    uuid user_id FK\n    varchar role\n    timestamp joined_at\n  }\n';
d += '  OrgInvite {\n    uuid id PK\n    uuid org_id FK\n    varchar email\n    varchar role\n    uuid token UK\n    timestamp expires_at\n  }\n';
if (domain === 'saas' || domain === 'collab' || domain === 'tool') {
d += '  Workspace {\n    uuid id PK\n    uuid org_id FK\n    varchar slug\n    varchar plan\n  }\n';
d += '  Organization ||--o{ Workspace : "has"\n';
}
d += '  Organization ||--o{ OrgMember : "has"\n';
d += '  Organization ||--o{ OrgInvite : "sends"\n';
d += '  User ||--o{ OrgMember : "belongs to"\n';
d += '```\n\n';
// Permission Matrix
d += G ? '## 🔐 権限マトリクス\n\n' : '## 🔐 Permission Matrix\n\n';
d += G ? '| リソース | Owner | Admin | Member | Viewer |\n|--------|-------|-------|--------|--------|\n' :
'| Resource | Owner | Admin | Member | Viewer |\n|---------|-------|-------|--------|--------|\n';
var resources = G ? [
['組織設定', '✅ CRUD', '✅ 読込・更新', '❌', '❌'],
['メンバー管理', '✅ CRUD', '✅ 招待・削除', '👁️ 一覧表示', '❌'],
['招待管理', '✅ CRUD', '✅ 招待・取消', '❌', '❌'],
['プロジェクト', '✅ CRUD', '✅ CRUD', '✅ 作成・更新', '👁️ 読込のみ'],
['請求・課金', '✅ CRUD', '👁️ 読込のみ', '❌', '❌'],
['監査ログ', '✅ 読込', '✅ 読込', '❌', '❌']
] : [
['Org Settings', '✅ CRUD', '✅ Read/Update', '❌', '❌'],
['Member Mgmt', '✅ CRUD', '✅ Invite/Remove', '👁️ List only', '❌'],
['Invite Mgmt', '✅ CRUD', '✅ Invite/Revoke', '❌', '❌'],
['Projects', '✅ CRUD', '✅ CRUD', '✅ Create/Update', '👁️ Read only'],
['Billing', '✅ CRUD', '👁️ Read only', '❌', '❌'],
['Audit Log', '✅ Read', '✅ Read', '❌', '❌']
];
resources.forEach(function(r) {
d += '| ' + r.join(' | ') + ' |\n';
});
d += '\n';
// RLS Policy Templates
d += G ? '## 🛡️ RLSポリシーテンプレート\n\n' : '## 🛡️ RLS Policy Templates\n\n';
d += G ? '### 組織スコープ分離 (全テーブル共通)\n\n' : '### Org-scoped isolation (shared across tables)\n\n';
d += '```sql\n';
d += '-- ' + (G ? '組織メンバーのみ読込可能' : 'Only org members can read') + '\n';
d += 'CREATE POLICY "org_isolation" ON resources\n';
d += '  FOR SELECT USING (\n';
d += '    org_id IN (\n';
d += '      SELECT org_id FROM org_members\n';
d += '      WHERE user_id = auth.uid()\n';
d += '    )\n';
d += '  );\n\n';
d += '-- ' + (G ? 'Admin以上のみ書込可能' : 'Admin or above can write') + '\n';
d += 'CREATE POLICY "admin_write" ON org_settings\n';
d += '  FOR ALL USING (\n';
d += '    org_id IN (\n';
d += '      SELECT org_id FROM org_members\n';
d += '      WHERE user_id = auth.uid()\n';
d += '      AND role IN (\'owner\', \'admin\')\n';
d += '    )\n';
d += '  );\n\n';
d += '-- ' + (G ? 'Ownerのみ組織削除可能' : 'Only owner can delete org') + '\n';
d += 'CREATE POLICY "owner_only_delete" ON organizations\n';
d += '  FOR DELETE USING (\n';
d += '    id IN (\n';
d += '      SELECT org_id FROM org_members\n';
d += '      WHERE user_id = auth.uid()\n';
d += '      AND role = \'owner\'\n';
d += '    )\n';
d += '  );\n```\n\n';
// Invite Flow Sequence
d += G ? '## 📧 招待フロー シーケンス図\n\n' : '## 📧 Invite Flow Sequence Diagram\n\n';
d += '```mermaid\nsequenceDiagram\n';
d += '  participant A as Admin\n';
d += '  participant S as Server\n';
d += '  participant E as Email\n';
d += '  participant U as ' + (G ? '招待ユーザー' : 'Invited User') + '\n';
d += '  A->>S: POST /invites {email, role}\n';
d += '  S->>S: ' + (G ? 'OrgInvite 作成 (token=UUID, expires=+7d)' : 'Create OrgInvite (token=UUID, expires=+7d)') + '\n';
d += '  S->>E: ' + (G ? '招待メール送信 (/invite?token=UUID)' : 'Send invite email (/invite?token=UUID)') + '\n';
d += '  U->>S: GET /invite?token=UUID\n';
d += '  S->>S: ' + (G ? 'token検証・期限チェック' : 'Validate token & expiry') + '\n';
d += '  U->>S: POST /invite/accept {token}\n';
d += '  S->>S: ' + (G ? 'OrgMember作成 / redeemed_at=NOW()' : 'Create OrgMember / set redeemed_at=NOW()') + '\n';
d += '  S->>U: ' + (G ? '組織ダッシュボードへリダイレクト' : 'Redirect to org dashboard') + '\n';
d += '```\n\n';
// Scaling decision tree
d += G ? '## 📈 スケーリング判断基準\n\n' : '## 📈 Scaling Decision Tree\n\n';
d += '```mermaid\ngraph TD\n';
d += '  S{' + (G ? '規制要件は?' : 'Regulatory req?') + '} -->|' + (G ? '金融/医療' : 'Fintech/Health') + '| DB[' + (G ? 'DB-per-tenant' : 'DB-per-tenant') + ']\n';
d += '  S -->|' + (G ? 'なし' : 'None') + '| T{' + (G ? 'テナント数?' : 'Tenant count?') + '}\n';
d += '  T -->|< 100| R[RLS]\n';
d += '  T -->|100-1000| H[' + (G ? 'Hybrid (RLS+FF)' : 'Hybrid (RLS+FF)') + ']\n';
d += '  T -->|> 1000| SC[' + (G ? 'Schema-per-tenant' : 'Schema-per-tenant') + ']\n';
d += '  style R fill:#22c55e,color:#fff\n';
d += '  style H fill:#f59e0b,color:#fff\n';
d += '  style SC fill:#3b82f6,color:#fff\n';
d += '  style DB fill:#ef4444,color:#fff\n';
d += '```\n';
return d;
}

function gen74(G, domain, orgModel, isMultiTenant, a, pn) {
var d = G ? '# ワークフローエンジン設計 — ' + pn + '\n\n' :
'# Workflow Engine Design — ' + pn + '\n\n';
d += G ? '> ビジネスプロセスのステートマシン定義・承認チェーン・SLAトラッキング。\n\n' :
'> Business process state machines, approval chains, SLA tracking.\n\n';
// Select relevant workflows by domain
var selectedWorkflows = [];
if (/saas|collab|tool|automation|hr/i.test(domain)) selectedWorkflows.push('approval');
if (/saas|tool|automation|ai/i.test(domain)) selectedWorkflows.push('ticket');
if (/ec|marketplace|logistics/i.test(domain)) selectedWorkflows.push('order');
if (/legal|fintech|insurance/i.test(domain)) selectedWorkflows.push('contract');
if (/saas|hr|collab/i.test(domain)) selectedWorkflows.push('onboarding');
if (selectedWorkflows.length === 0) selectedWorkflows = ['approval', 'onboarding'];
// State machine diagrams
d += G ? '## 🔄 ステートマシン定義\n\n' : '## 🔄 State Machine Definitions\n\n';
selectedWorkflows.forEach(function(wfKey) {
var wf = WORKFLOW_TEMPLATES[wfKey];
d += '### ' + (G ? wf.name_ja : wf.name) + '\n\n';
d += '```mermaid\nstateDiagram-v2\n';
d += '  [*] --> ' + wf.states[0] + '\n';
wf.transitions.forEach(function(t) {
d += '  ' + t[0] + ' --> ' + t[1] + ' : ' + t[2] + '\n';
});
d += '  ' + wf.states[wf.states.length - 1] + ' --> [*]\n';
d += '```\n\n';
// Roles per workflow
d += G ? '**ロール別操作権限:**\n\n' : '**Role-based operations:**\n\n';
wf.roles.forEach(function(r) { d += '- ' + r + '\n'; });
d += '\n';
// SLA
d += G ? '**SLA / エスカレーション:** ' + wf.sla_ja + '\n\n' :
'**SLA / Escalation:** ' + wf.sla_en + '\n\n';
d += '---\n\n';
});
// Approval chain patterns
d += G ? '## 🔗 承認チェーンパターン\n\n' : '## 🔗 Approval Chain Patterns\n\n';
d += G ? '| パターン | 説明 | 適用シーン |\n|---------|------|----------|\n' :
'| Pattern | Description | Use Case |\n|---------|-------------|----------|\n';
var chains = G ? [
['単一承認', '1人の承認者が承認/却下', '小規模チーム・軽微な変更'],
['順次承認 (Sequential)', 'A→B→C の順で全員の承認が必要', '予算申請・契約締結'],
['並列承認 (Parallel)', 'A・B・C 全員が同時並行で承認', '複数部署承認が必要な案件'],
['委任承認 (Delegation)', '上位承認者が代理承認者を指定可能', '長期不在・権限委任'],
['閾値承認 (Threshold)', 'N人中M人以上が承認で通過', '過半数決議・委員会承認']
] : [
['Single approval', 'One approver approves/rejects', 'Small team, minor changes'],
['Sequential', 'A→B→C all must approve in order', 'Budget requests, contracts'],
['Parallel', 'A, B, C all approve simultaneously', 'Multi-department approvals'],
['Delegation', 'Senior approver can designate proxy', 'Long absence, delegated authority'],
['Threshold', 'M of N approvers must approve', 'Majority vote, committee decisions']
];
chains.forEach(function(c) { d += '| ' + c.join(' | ') + ' |\n'; });
d += '\n';
// SLA tracking
d += G ? '## ⏱️ SLAトラッキング実装\n\n' : '## ⏱️ SLA Tracking Implementation\n\n';
d += '```typescript\n';
d += '// SLA ' + (G ? '期限管理' : 'deadline management') + '\n';
d += 'interface SLAConfig {\n  workflowType: string;\n  slaHours: number;\n  escalationHours: number;\n  escalateTo: string; // role\n}\n\n';
d += '// Cron job: ' + (G ? '期限チェック（15分ごと）' : 'deadline check (every 15 min)') + '\n';
d += 'async function checkSLABreaches() {\n';
d += '  const overdue = await db.query(`\n';
d += '    SELECT * FROM approval_requests\n';
d += '    WHERE status = \'pending\'\n';
d += '    AND created_at < NOW() - INTERVAL \'1 hour\' * sla_hours\n';
d += '    AND escalated_at IS NULL\n';
d += '  `);\n';
d += '  for (const req of overdue) {\n';
d += '    await notifyEscalation(req);\n';
d += '    await markEscalated(req.id);\n';
d += '  }\n';
d += '}\n```\n\n';
// Domain-specific workflow customization
d += G ? '## 🎯 ' + domain + 'ドメイン固有のワークフロー最適化\n\n' :
'## 🎯 ' + domain + ' Domain Workflow Customization\n\n';
var customizations = {
saas: G ? ['プランアップグレード承認フロー', 'サブスクキャンセル確認フロー', 'カスタム機能リクエスト管理'] :
['Plan upgrade approval flow', 'Subscription cancellation confirmation', 'Custom feature request management'],
hr: G ? ['採用承認ステップ', 'オファー承認チェーン', '入社チェックリスト自動化'] :
['Hiring approval steps', 'Offer approval chain', 'Onboarding checklist automation'],
fintech: G ? ['送金承認ワークフロー (金額閾値)', 'コンプライアンスレビュー', 'KYC/AML承認プロセス'] :
['Transfer approval (amount threshold)', 'Compliance review', 'KYC/AML approval process'],
legal: G ? ['契約書レビューチェーン', 'eSign統合 (DocuSign)', '条項交渉ステップ'] :
['Contract review chain', 'eSign integration (DocuSign)', 'Clause negotiation steps'],
ec: G ? ['返金承認フロー', '大口注文承認', '在庫アラート承認'] :
['Refund approval flow', 'Large order approval', 'Inventory alert approval'],
collab: G ? ['コンテンツ公開承認', 'メンバー招待承認', 'ワークスペース作成申請'] :
['Content publish approval', 'Member invite approval', 'Workspace creation request']
};
var domCustom = customizations[domain] || (G ? ['承認ワークフロー', 'オンボーディング自動化', '状態変更通知'] :
['Approval workflow', 'Onboarding automation', 'State change notifications']);
domCustom.forEach(function(c) { d += '- ' + c + '\n'; });
d += '\n';
// Notification triggers
d += G ? '## 🔔 状態変化通知トリガー\n\n' : '## 🔔 State Change Notification Triggers\n\n';
d += G ? '| 状態変化 | 通知先 | チャネル |\n|---------|-------|--------|\n' :
'| State change | Notify to | Channel |\n|-------------|-----------|----------|\n';
var triggers = G ? [
['draft → pending', '承認者全員', 'メール + アプリ内通知'],
['pending → approved', '申請者 + Slackチャンネル', 'メール + Slack Webhook'],
['pending → rejected', '申請者', 'メール + アプリ内通知 (理由付き)'],
['SLA超過', '申請者 + 管理者', 'メール + Slack @mention'],
['invited → registered', '招待者 + 管理者', 'アプリ内通知']
] : [
['draft → pending', 'All approvers', 'Email + in-app notification'],
['pending → approved', 'Requester + Slack channel', 'Email + Slack Webhook'],
['pending → rejected', 'Requester', 'Email + in-app (with reason)'],
['SLA breach', 'Requester + Admin', 'Email + Slack @mention'],
['invited → registered', 'Inviter + Admin', 'In-app notification']
];
triggers.forEach(function(t) { d += '| ' + t.join(' | ') + ' |\n'; });
return d;
}

function gen75(G, domain, orgModel, isMultiTenant, a, pn) {
var d = G ? '# 管理ダッシュボード仕様 — ' + pn + '\n\n' :
'# Admin Dashboard Specification — ' + pn + '\n\n';
d += G ? '> KPIカード定義・チャート仕様・ユーザー分析・ロールベースビュー。\n\n' :
'> KPI card definitions, chart specs, user analytics, role-based views.\n\n';
// Dashboard layout wireframe
d += G ? '## 🖥️ 管理画面レイアウト\n\n' : '## 🖥️ Admin Dashboard Layout\n\n';
d += '```\n';
d += '┌─────────────────────────────────────────────────────────────┐\n';
d += '│  ' + (G ? '組織スイッチャー' : 'OrgSwitcher') + '    ' + pn + ' Admin     🔔 ' + (G ? '通知' : 'Notif') + '  👤 ' + (G ? 'プロフィール' : 'Profile') + '  │\n';
d += '├──────────┬──────────────────────────────────────────────────┤\n';
d += '│          │  📊 ' + (G ? '概要' : 'Overview') + '                                      │\n';
d += '│  📊 ' + (G ? '概要' : 'Ovrvw') + '   │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐  │\n';
d += '│  👥 ' + (G ? 'ユーザー' : 'Users ') + '  │  │ ' + (G ? '総ユーザー' : 'Total  ') + ' │ │ MRR    │ │ ' + (G ? 'チャーン' : 'Churn ') + ' │ │ ' + (G ? 'アクティブ' : 'Active ') + '│  │\n';
d += '│  💰 ' + (G ? '課金' : 'Billing') + '  │  │ 12,450 │ │ $48K   │ │ 2.1%  │ │ 87%   │  │\n';
d += '│  🎫 ' + (G ? 'チケット' : 'Tickets') + '│  └────────┘ └────────┘ └────────┘ └────────┘  │\n';
d += '│  ⚙️ ' + (G ? '設定' : 'Settings') + '  │  📈 ' + (G ? '週次トレンド (折れ線グラフ)' : 'Weekly Trend (line chart)') + '               │\n';
d += '│          │  ┌───────────────────────────────────────────┐  │\n';
d += '│          │  │  [Chart.js / Recharts Line Chart]         │  │\n';
d += '│          │  └───────────────────────────────────────────┘  │\n';
d += '│          │  📋 ' + (G ? '最近のアクティビティ' : 'Recent Activity') + '   ⚠️ ' + (G ? 'SLAアラート' : 'SLA Alerts') + '         │\n';
d += '└──────────┴──────────────────────────────────────────────────┘\n';
d += '```\n\n';
// KPI Card definitions
d += G ? '## 📊 KPIカード定義\n\n' : '## 📊 KPI Card Definitions\n\n';
Object.entries(ADMIN_DASHBOARD_SPECS).forEach(function(entry) {
var spec = entry[1];
d += '### ' + (G ? spec.category_ja : spec.category) + '\n\n';
d += G ? '| ウィジェット | クエリ/計算式 | 閾値/警告 |\n|------------|-------------|----------|\n' :
'| Widget | Query / Formula | Threshold / Alert |\n|--------|-----------------|-------------------|\n';
spec.widgets_ja.forEach(function(w, i) {
var we = spec.widgets_en[i] || w;
d += '| ' + (G ? w : we) + ' | ' + (G ? '`SELECT COUNT(*) FROM ...`' : '`SELECT COUNT(*) FROM ...`') + ' | — |\n';
});
d += '\n';
});
// Weekly trends chart spec
d += G ? '## 📈 週次トレンドチャート仕様\n\n' : '## 📈 Weekly Trend Chart Specification\n\n';
d += '```typescript\n';
d += '// Recharts ' + (G ? 'ライン チャート設定' : 'Line Chart Config') + '\n';
d += 'const weeklyTrendConfig = {\n';
d += '  dataKey: \'date\',\n';
d += '  lines: [\n';
d += '    { dataKey: \'new_users\', color: \'#4f46e5\', name: \'' + (G ? '新規ユーザー' : 'New Users') + '\' },\n';
d += '    { dataKey: \'active_users\', color: \'#22c55e\', name: \'' + (G ? 'アクティブユーザー' : 'Active Users') + '\' },\n';
d += '    { dataKey: \'mrr\', color: \'#f59e0b\', name: \'MRR ($)\' }\n';
d += '  ],\n';
d += '  timeRange: \'last_12_weeks\',\n';
d += '  refreshInterval: 300 // ' + (G ? '5分ごと' : 'every 5 min') + '\n';
d += '};\n```\n\n';
// User workload analytics
d += G ? '## 👥 ユーザー作業量分析\n\n' : '## 👥 User Workload Analytics\n\n';
d += G ? '| メトリクス | 説明 | アクション |\n|-----------|------|----------|\n' :
'| Metric | Description | Action |\n|--------|-------------|--------|\n';
var workload = G ? [
['上位承認者', '承認待ち件数が最も多い担当者', '負荷分散・委任推奨'],
['ボトルネック特定', '平均待機時間が長いステップ', 'SLA見直し・担当者追加'],
['期限超過率', 'SLA違反の割合 (目標<5%)', 'エスカレーション設定見直し'],
['非アクティブメンバー', '30日間ログインなし', 'リテンションキャンペーン']
] : [
['Top approvers', 'Users with most pending approvals', 'Load balance / suggest delegation'],
['Bottleneck identification', 'Steps with longest avg wait time', 'Revise SLA / add staff'],
['SLA breach rate', 'Ratio of SLA violations (target <5%)', 'Review escalation settings'],
['Inactive members', '30d no login', 'Retention campaign']
];
workload.forEach(function(w) { d += '| ' + w.join(' | ') + ' |\n'; });
d += '\n';
// Stale item alerts
d += G ? '## ⚠️ 滞留アイテムアラート\n\n' : '## ⚠️ Stale Item Alerts\n\n';
var staleItems = G ? [
'承認待ち 48h超 → 承認者と申請者に自動リマインダー',
'チケット未対応 24h超 → 管理者にSlack通知',
'期限切れ招待 → 管理画面でバッジ表示 (自動再送オプション付き)',
'MRRダウン 10%超 → アラートメール + 原因分析レポート生成'
] : [
'Approval pending > 48h → auto-reminder to approver and requester',
'Ticket unassigned > 24h → Slack notify to manager',
'Expired invites → badge in admin panel (with auto-resend option)',
'MRR drop > 10% → alert email + cause analysis report'
];
staleItems.forEach(function(s) { d += '- ' + s + '\n'; });
d += '\n';
// Role-based dashboard views
d += G ? '## 🔐 ロールベース ダッシュボードビュー\n\n' : '## 🔐 Role-based Dashboard Views\n\n';
d += G ? '| 表示要素 | Owner | Admin | Manager | Member |\n|---------|-------|-------|---------|--------|\n' :
'| Element | Owner | Admin | Manager | Member |\n|---------|-------|-------|---------|--------|\n';
var views = G ? [
['課金・MRR', '✅', '👁️ 読込', '❌', '❌'],
['ユーザー管理', '✅', '✅', '👁️ 自チームのみ', '❌'],
['監査ログ', '✅', '✅', '❌', '❌'],
['SLAダッシュボード', '✅', '✅', '✅', '❌'],
['自分のチケット', '✅', '✅', '✅', '✅']
] : [
['Billing / MRR', '✅', '👁️ Read', '❌', '❌'],
['User management', '✅', '✅', '👁️ Own team', '❌'],
['Audit log', '✅', '✅', '❌', '❌'],
['SLA dashboard', '✅', '✅', '✅', '❌'],
['Own tickets', '✅', '✅', '✅', '✅']
];
views.forEach(function(v) { d += '| ' + v.join(' | ') + ' |\n'; });
return d;
}

function gen76(G, domain, orgModel, isMultiTenant, a, pn) {
var d = G ? '# エンタープライズコンポーネントカタログ — ' + pn + '\n\n' :
'# Enterprise Component Catalog — ' + pn + '\n\n';
d += G ? '> 8つのエンタープライズUIコンポーネント仕様。Props・バリアント・A11y・フレームワーク対応。\n\n' :
'> 8 enterprise UI component specifications. Props, Variants, A11y, Framework mapping.\n\n';
// Component specs
d += G ? '## 🧩 コンポーネント仕様\n\n' : '## 🧩 Component Specifications\n\n';
Object.entries(ENTERPRISE_COMPONENTS).forEach(function(entry) {
var name = entry[0]; var comp = entry[1];
d += '### `<' + name + '>`\n\n';
d += G ? '**Props:**\n\n' : '**Props:**\n\n';
comp.props_ja.forEach(function(p) { d += '- `' + p + '`\n'; });
d += '\n';
d += G ? '**バリアント:**\n\n' : '**Variants:**\n\n';
comp.variants_ja.forEach(function(v) { d += '- ' + v + '\n'; });
d += '\n';
d += G ? '**アクセシビリティ:**\n\n' : '**Accessibility:**\n\n';
comp.a11y_ja.forEach(function(a) { d += '- ' + a + '\n'; });
d += '\n';
d += G ? '**フレームワーク対応:** ' + comp.framework + '\n\n' :
'**Framework mapping:** ' + comp.framework + '\n\n';
d += '---\n\n';
});
// Composition patterns
d += G ? '## 🔧 コンポジションパターン\n\n' : '## 🔧 Composition Patterns\n\n';
d += '```tsx\n';
d += '// ' + (G ? '承認管理ページの組み合わせ例' : 'Approval management page composition') + '\n';
d += 'export function ApprovalPage() {\n';
d += '  return (\n';
d += '    <OrgSwitcher orgs={orgs} current={current} onChange={switchOrg} />\n';
d += '    <DataTable\n';
d += '      data={approvals}\n';
d += '      columns={approvalColumns}\n';
d += '      sortable filterable paginated\n';
d += '      bulkActions={[{ label: \'' + (G ? '一括承認' : 'Bulk Approve') + '\', action: bulkApprove }]}\n';
d += '    />\n';
d += '    <ApprovalBar\n';
d += '      request={selected}\n';
d += '      onApprove={approve}\n';
d += '      onReject={reject}\n';
d += '      currentUserRole={userRole}\n';
d += '    />\n';
d += '    <NotificationBell count={unread} items={notifications} onRead={markRead} />\n';
d += '  );\n';
d += '}\n```\n\n';
// MVP → Pro → Enterprise roadmap
d += G ? '## 🗺️ MVP → Pro → Enterprise コンポーネントロードマップ\n\n' :
'## 🗺️ MVP → Pro → Enterprise Component Roadmap\n\n';
d += G ? '| コンポーネント | MVP | Pro | Enterprise |\n|-------------|-----|-----|------------|\n' :
'| Component | MVP | Pro | Enterprise |\n|-----------|-----|-----|------------|\n';
var roadmap = [
['DataTable', G ? '基本テーブル' : 'Basic table', G ? 'ソート+フィルタ' : 'Sort + filter', G ? 'バーチャルスクロール+一括操作' : 'Virtual scroll + bulk ops'],
['StatusBadge', G ? '色+テキスト' : 'Color + text', G ? '全ステータス+アイコン' : 'All statuses + icon', G ? 'カスタムステータス+API連携' : 'Custom statuses + API'],
['ApprovalBar', G ? 'シンプル承認' : 'Simple approve', G ? '理由入力+通知' : 'Reason + notify', G ? 'マルチ承認+委任' : 'Multi-approver + delegation'],
['OrgSwitcher', G ? 'なし' : 'N/A', G ? '組織切替' : 'Org switch', G ? '組織作成+招待' : 'Create org + invite'],
['AuditTimeline', G ? 'なし' : 'N/A', G ? '基本ログ' : 'Basic log', G ? 'フィルタ+エクスポート' : 'Filter + export'],
['InviteManager', G ? 'メール招待のみ' : 'Email invite only', G ? 'ロール選択' : 'Role selection', G ? 'CSV一括招待+SSO' : 'CSV bulk invite + SSO']
];
roadmap.forEach(function(r) { d += '| ' + r.join(' | ') + ' |\n'; });
d += '\n';
// Real-time update patterns
d += G ? '## ⚡ リアルタイム更新パターン\n\n' : '## ⚡ Real-time Update Patterns\n\n';
d += '```typescript\n';
d += '// Supabase Realtime ' + (G ? '統合例 (NotificationBell)' : 'integration (NotificationBell)') + '\n';
d += 'useEffect(() => {\n';
d += '  const sub = supabase\n';
d += '    .channel(\'notifications\')\n';
d += '    .on(\'postgres_changes\', {\n';
d += '      event: \'INSERT\',\n';
d += '      schema: \'public\',\n';
d += '      table: \'notifications\',\n';
d += '      filter: \'user_id=eq.\' + userId\n';
d += '    }, (payload) => {\n';
d += '      setNotifications(prev => [payload.new, ...prev]);\n';
d += '    })\n';
d += '    .subscribe();\n';
d += '  return () => supabase.removeChannel(sub);\n';
d += '}, [userId]);\n```\n\n';
// Dark/Light mode adaptation
d += G ? '## 🎨 ダーク/ライトモード対応\n\n' : '## 🎨 Dark / Light Mode Adaptation\n\n';
d += '```css\n';
d += '/* ' + (G ? 'ステータスバッジ カラーシステム' : 'Status badge color system') + ' */\n';
d += ':root {\n';
d += '  --status-pending: hsl(45 90% 50%);\n  --status-approved: hsl(142 70% 45%);\n';
d += '  --status-rejected: hsl(0 72% 51%);\n  --status-active: hsl(221 83% 53%);\n';
d += '}\n[data-theme="dark"] {\n';
d += '  --status-pending: hsl(45 80% 60%);\n  --status-approved: hsl(142 60% 55%);\n';
d += '  --status-rejected: hsl(0 65% 62%);\n  --status-active: hsl(221 75% 65%);\n}\n```\n';
return d;
}

function genPillar19_EnterpriseSaaS(a, pn) {
var G = S.genLang === 'ja';
var domain = detectDomain(a.purpose || '') || 'saas';
var orgModel = a.org_model || '';
var mvpFeatures = a.mvp_features || '';
var isMultiTenant = /マルチ|multi|RLS|組織|org/i.test(orgModel) ||
/マルチテナント|Multi-tenant|RBAC/i.test(mvpFeatures);
// Only generate for relevant domains
var relevantDomain = /saas|analytics|hr|collab|tool|automation|fintech|legal|ec|marketplace|logistics|insurance/i.test(domain);
if (!relevantDomain && !isMultiTenant) return;
S.files['docs/73_enterprise_architecture.md'] = gen73(G, domain, orgModel, isMultiTenant, a, pn);
S.files['docs/74_workflow_engine.md'] = gen74(G, domain, orgModel, isMultiTenant, a, pn);
S.files['docs/75_admin_dashboard_spec.md'] = gen75(G, domain, orgModel, isMultiTenant, a, pn);
S.files['docs/76_enterprise_components.md'] = gen76(G, domain, orgModel, isMultiTenant, a, pn);
}
// P20: CI/CD Intelligence
// Generates: docs/77_cicd_pipeline_design.md, 78_deployment_strategy.md,
//            79_quality_gate_matrix.md, 80_release_engineering.md

// ============================================================================
// DATA CONSTANTS
// ============================================================================

// Factory: Pipeline stage
function _ps(id, name_ja, name_en, desc_ja, desc_en, tools, gate_ja, gate_en) {
return {id, name_ja, name_en, desc_ja, desc_en, tools, gate_ja, gate_en};
}
var PIPELINE_STAGES = [
_ps('checkout', 'チェックアウト', 'Checkout', 'ソースコード取得・ブランチ検証', 'Fetch source code, validate branch', 'actions/checkout@v4', 'ブランチ保護ルール', 'Branch protection rules'),
_ps('install', 'インストール', 'Install', '依存関係のキャッシュ付きインストール', 'Install dependencies with cache', 'npm ci / pnpm i --frozen-lockfile', 'lockfileの整合性', 'lockfile integrity'),
_ps('lint', 'Lint/型チェック', 'Lint & Type Check', 'ESLint・TypeScript・Prettier検査', 'ESLint, TypeScript, Prettier checks', 'eslint, tsc --noEmit, prettier --check', 'エラー0件', 'Zero errors'),
_ps('test', 'テスト実行', 'Run Tests', 'ユニット・統合テスト並列実行', 'Unit & integration tests in parallel', 'vitest, jest, playwright', 'カバレッジ閾値達成', 'Coverage threshold met'),
_ps('build', 'ビルド', 'Build', 'プロダクションビルド・バンドル最適化', 'Production build & bundle optimization', 'next build / vite build / tsc', 'ビルド成功・サイズ予算内', 'Build success & size budget'),
_ps('security_scan', 'セキュリティスキャン', 'Security Scan', 'SAST・依存関係脆弱性スキャン', 'SAST & dependency vulnerability scan', 'trivy, snyk, semgrep, npm audit', '重大脆弱性0件', 'Zero critical vulnerabilities'),
_ps('deploy_staging', 'ステージングデプロイ', 'Deploy Staging', 'ステージング環境への自動デプロイ', 'Auto-deploy to staging environment', 'deploy CLI / container push', 'デプロイ成功・ヘルスチェックOK', 'Deploy success & health check OK'),
_ps('e2e_test', 'E2Eテスト', 'E2E Tests', 'ステージング環境でのE2E・スモーク', 'E2E & smoke tests on staging', 'playwright, cypress, k6', '主要フロー全パス', 'All critical flows pass'),
_ps('deploy_prod', '本番デプロイ', 'Deploy Production', '本番環境への段階的デプロイ', 'Staged deploy to production', 'deploy CLI / kubectl apply', 'ヘルスチェック・SLO維持', 'Health check & SLO maintained'),
];
// Factory: Deploy strategy
function _ds(id, name_ja, name_en, desc_ja, desc_en, pros_ja, cons_ja, when_ja, rollback_ja) {
return {id, name_ja, name_en, desc_ja, desc_en, pros_ja, cons_ja, when_ja, rollback_ja};
}
var DEPLOY_STRATEGIES = [
_ds('blue_green', 'ブルーグリーン', 'Blue-Green',
'2環境を並列維持しトラフィックを瞬時切替', 'Maintain 2 envs, instant traffic switch',
'ゼロダウンタイム・瞬時ロールバック', 'インフラコスト×2・データ同期必要',
'fintech/healthcare/EC 本番デプロイ', 'ロードバランサーを旧環境に戻す（秒単位）'),
_ds('canary', 'カナリアリリース', 'Canary',
'一部トラフィック(5-20%)から段階的に展開', 'Gradually expand from 5-20% traffic',
'リスク最小化・メトリクス監視で早期検知', 'ロールアウト期間が長い・複雑なルーティング',
'SaaS新機能・リスク軽減重視', 'カナリア割合を0%に戻しデプロイ削除'),
_ds('rolling', 'ローリング', 'Rolling',
'インスタンスを順次置換（ダウンタイム最小）', 'Replace instances sequentially (minimal downtime)',
'リソース効率◎・シンプル', '部分的バージョン混在・ロールバック遅め',
'標準Webアプリ・Kubernetes標準戦略', '前リビジョンにロールアウト'),
_ds('recreate', 'Recreate', 'Recreate',
'旧版を全停止してから新版を起動', 'Stop all old, then start all new',
'実装シンプル・バージョン混在なし', 'ダウンタイム発生',
'開発/ステージング環境・非重要サービス', '旧イメージで再デプロイ'),
];
// Factory: Quality gate
function _qg(id, name_ja, name_en, tools_ja, tools_en, threshold_ja, threshold_en, blocking) {
return {id, name_ja, name_en, tools_ja, tools_en, threshold_ja, threshold_en, blocking};
}
var QUALITY_GATES = [
_qg('code_quality', 'コード品質', 'Code Quality', 'ESLint / TypeScript / Prettier', 'ESLint / TypeScript / Prettier', 'エラー0件・警告50件以下', 'Zero errors, max 50 warnings', true),
_qg('test_coverage', 'テストカバレッジ', 'Test Coverage', 'Vitest / Jest / Istanbul', 'Vitest / Jest / Istanbul', 'ライン80%以上・ブランチ75%以上', 'Line ≥80%, Branch ≥75%', true),
_qg('security', 'セキュリティ', 'Security', 'Trivy / Snyk / Semgrep / npm audit', 'Trivy / Snyk / Semgrep / npm audit', 'Critical 0件・High 0件（SLA内修正）', 'Critical=0, High=0 (fix within SLA)', true),
_qg('performance', 'パフォーマンス', 'Performance', 'Lighthouse CI / k6 / Bundle Analyzer', 'Lighthouse CI / k6 / Bundle Analyzer', 'LCP<2.5s・FCP<1.8s・バンドル予算内', 'LCP<2.5s, FCP<1.8s, bundle within budget', false),
_qg('accessibility', 'アクセシビリティ', 'Accessibility', 'axe-core / pa11y / WAVE', 'axe-core / pa11y / WAVE', 'WCAG 2.1 AA Critical 0件', 'WCAG 2.1 AA Critical violations=0', false),
];
// Factory: Release model
function _rm(id, name_ja, name_en, branches_ja, best_for_ja, branches_en, best_for_en) {
return {id, name_ja, name_en, branches_ja, best_for_ja, branches_en, best_for_en};
}
var RELEASE_MODELS = [
_rm('trunk', 'トランクベース開発', 'Trunk-Based Development',
'main（単一）+ 短命フィーチャーブランチ（<2日）+ Feature Flags',
'SaaS・スタートアップ・高頻度リリース（複数回/日）',
'main (single) + short-lived feature branches (<2 days) + Feature Flags',
'SaaS, startups, high-frequency releases (multiple/day)'),
_rm('gitflow', 'GitFlow', 'GitFlow',
'main / develop / feature/* / release/* / hotfix/*',
'従来型・大規模チーム・定期リリース・安定性重視',
'main / develop / feature/* / release/* / hotfix/*',
'Traditional, large teams, scheduled releases, stability-focused'),
_rm('github_flow', 'GitHub Flow', 'GitHub Flow',
'main + PR（feature/fix/*）+ 本番即時デプロイ',
'小規模チーム・継続的デリバリー・シンプル運用',
'main + PR (feature/fix/*) + immediate production deploy',
'Small teams, continuous delivery, simple operations'),
];
// Deploy target config: cmd, preview, env, features
var DEPLOY_TARGET_CONFIG = {
'Vercel': {
cmd: 'vercel --prod --token $VERCEL_TOKEN',
preview: 'vercel --token $VERCEL_TOKEN',
env: 'VERCEL_TOKEN, VERCEL_ORG_ID, VERCEL_PROJECT_ID',
features: 'Preview deployments per PR, Edge Runtime, Analytics, ISR',
features_ja: 'PR毎プレビューデプロイ、Edge Runtime、Analytics、ISR'
},
'Firebase': {
cmd: 'firebase deploy --only hosting --token $FIREBASE_TOKEN',
preview: 'firebase hosting:channel:deploy pr-$PR_NUMBER',
env: 'FIREBASE_TOKEN, FIREBASE_PROJECT_ID',
features: 'Preview channels, CDN, Firebase Extensions, Emulator Suite',
features_ja: 'プレビューチャンネル、CDN、Firebase拡張、エミュレータ'
},
'Cloudflare Pages': {
cmd: 'wrangler pages deploy dist/ --project-name $CF_PROJECT',
preview: 'wrangler pages deploy dist/ --branch pr-$PR_NUMBER',
env: 'CF_API_TOKEN, CF_ACCOUNT_ID, CF_PROJECT',
features: 'Edge deployment, Workers integration, D1 database, R2 storage',
features_ja: 'エッジデプロイ、Workers統合、D1 DB、R2ストレージ'
},
'Railway': {
cmd: 'railway up --service $RAILWAY_SERVICE',
preview: 'railway up --service $RAILWAY_SERVICE --detach',
env: 'RAILWAY_TOKEN, RAILWAY_SERVICE',
features: 'Auto-deploy from git, private networking, managed Postgres',
features_ja: 'git自動デプロイ、プライベートネット、マネージドPostgres'
},
'Fly.io': {
cmd: 'fly deploy --app $FLY_APP --remote-only',
preview: 'fly deploy --app $FLY_APP-pr-$PR_NUMBER --remote-only',
env: 'FLY_API_TOKEN, FLY_APP',
features: 'Anycast routing, Machines API, LiteFS, global distribution',
features_ja: 'Anycastルーティング、Machines API、LiteFS、グローバル配信'
},
'Render': {
cmd: 'curl -X POST "$RENDER_DEPLOY_HOOK"',
preview: 'curl -X POST "$RENDER_PREVIEW_HOOK?branch=pr-$PR_NUMBER"',
env: 'RENDER_DEPLOY_HOOK, RENDER_PREVIEW_HOOK',
features: 'Preview envs, managed databases, cron jobs, private services',
features_ja: 'プレビュー環境、マネージドDB、cronジョブ、プライベートサービス'
},
'AWS': {
cmd: 'aws ecs update-service --cluster $ECS_CLUSTER --service $ECS_SERVICE --force-new-deployment',
preview: 'aws lightsail create-deployment --service-name $LS_SERVICE',
env: 'AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION, ECS_CLUSTER, ECS_SERVICE',
features: 'ECS/EKS, CDK IaC, CodePipeline, CloudWatch, multi-AZ HA',
features_ja: 'ECS/EKS、CDK IaC、CodePipeline、CloudWatch、マルチAZ HA'
},
'Docker': {
cmd: 'kubectl set image deployment/$K8S_DEPLOY app=$IMAGE_TAG --namespace=$K8S_NS',
preview: 'kubectl apply -f k8s/preview/$PR_NUMBER/ --namespace=preview',
env: 'KUBECONFIG, K8S_DEPLOY, K8S_NS, REGISTRY_URL',
features: 'Kubernetes orchestration, Helm charts, Horizontal Pod Autoscaler, rolling updates',
features_ja: 'Kubernetesオーケストレーション、Helmチャート、HPA、ローリングアップデート'
},
'Netlify': {
cmd: 'netlify deploy --prod --auth $NETLIFY_AUTH_TOKEN --site $NETLIFY_SITE_ID',
preview: 'netlify deploy --auth $NETLIFY_AUTH_TOKEN --site $NETLIFY_SITE_ID',
env: 'NETLIFY_AUTH_TOKEN, NETLIFY_SITE_ID',
features: 'Deploy previews, Edge Functions, Forms, Identity, Split Testing',
features_ja: 'デプロイプレビュー、Edge Functions、フォーム、ID管理、A/Bテスト'
},
};
// ============================================================================
// GENERATOR: doc 77 — CI/CD Pipeline Design
// ============================================================================
function gen77(G, domain, dtCfg, a, pn) {
var dt = a.deploy || 'Vercel';
var fe = a.frontend || 'React + Next.js';
var be = a.backend || '';
var pm = /pnpm/i.test(fe + be) ? 'pnpm' : /yarn/i.test(fe + be) ? 'yarn' : 'npm';
var isPM = pm === 'pnpm' ? 'pnpm i --frozen-lockfile' : pm === 'yarn' ? 'yarn install --frozen-lockfile' : 'npm ci';
var isFintechOrInsurance = /fintech|insurance/i.test(domain);
var isHealthcare = /health/i.test(domain);
var isEC = /^(ec|marketplace)$/.test(domain);
var isIoT = /iot/i.test(domain);
var doc = '';
doc += '# ' + (G ? 'CI/CDパイプライン設計' : 'CI/CD Pipeline Design') + '\n\n';
doc += '> **Project:** ' + pn + '  \n';
doc += '> **Deploy Target:** ' + dt + '  \n';
doc += '> **Domain:** ' + domain + '  \n';
doc += '> **Generated:** ' + new Date().toISOString().split('T')[0] + '\n\n';
doc += '## ' + (G ? '9ステージパイプライン全体図' : '9-Stage Pipeline Overview') + '\n\n';
doc += '```mermaid\n';
doc += 'graph TD\n';
doc += '  A[📥 ' + (G ? 'チェックアウト' : 'Checkout') + '] --> B[📦 ' + (G ? 'インストール' : 'Install') + ']\n';
doc += '  B --> C[🔍 Lint & Type Check]\n';
doc += '  C --> D[🧪 ' + (G ? 'テスト実行' : 'Run Tests') + ']\n';
doc += '  D --> E[🏗️ ' + (G ? 'ビルド' : 'Build') + ']\n';
doc += '  E --> F[🔒 ' + (G ? 'セキュリティスキャン' : 'Security Scan') + ']\n';
doc += '  F --> G1[🚀 ' + (G ? 'ステージングデプロイ' : 'Deploy Staging') + ']\n';
doc += '  G1 --> H[🎭 E2E ' + (G ? 'テスト' : 'Tests') + ']\n';
doc += '  H --> I[🌐 ' + (G ? '本番デプロイ' : 'Deploy Production') + ']\n';
if (isFintechOrInsurance) {
doc += '  I --> J[✅ ' + (G ? 'デュアル承認ゲート' : 'Dual Approval Gate') + ']\n';
doc += '  J --> K[🏦 ' + (G ? 'コンプライアンス監査' : 'Compliance Audit') + ']\n';
}
if (isHealthcare) {
doc += '  I --> J[🏥 ' + (G ? 'HIPAA準拠ステージング' : 'HIPAA Compliance Stage') + ']\n';
}
doc += '\n';
doc += '  style A fill:#4a9eff,color:#fff\n';
doc += '  style I fill:#28a745,color:#fff\n';
if (isFintechOrInsurance || isHealthcare) doc += '  style J fill:#dc3545,color:#fff\n';
doc += '```\n\n';
doc += '## ' + (G ? 'ステージ詳細' : 'Stage Details') + '\n\n';
doc += '| # | ' + (G ? 'ステージ' : 'Stage') + ' | ' + (G ? 'ツール' : 'Tools') + ' | ' + (G ? '品質ゲート' : 'Quality Gate') + ' |\n';
doc += '|---|' + (G ? 'ステージ' : 'Stage') + '|' + (G ? 'ツール' : 'Tools') + '|' + (G ? '品質ゲート' : 'Quality Gate') + '|\n';
doc += '|---|---|---|---|\n';
PIPELINE_STAGES.forEach(function(s, i) {
doc += '| ' + (i + 1) + ' | ' + (G ? s.name_ja : s.name_en) + ' | `' + s.tools + '` | ' + (G ? s.gate_ja : s.gate_en) + ' |\n';
});
doc += '\n';
// Domain-specific stages
if (isFintechOrInsurance) {
doc += '### ' + (G ? '⚠️ Fintech/Insurance 追加ステージ' : '⚠️ Fintech/Insurance Additional Stages') + '\n\n';
doc += '| ' + (G ? 'ステージ' : 'Stage') + ' | ' + (G ? '内容' : 'Content') + ' |\n';
doc += '|---|---|\n';
doc += '| ' + (G ? 'デュアル承認デプロイ' : 'Dual Approval Deploy') + ' | ' + (G ? '本番デプロイ前に2名以上の承認者が必要。GitHub Environments + Required Reviewers で実装' : 'Require 2+ approvers before production deploy. Implement via GitHub Environments + Required Reviewers') + ' |\n';
doc += '| ' + (G ? 'コンプライアンス監査ログ' : 'Compliance Audit Log') + ' | ' + (G ? '全デプロイをAudit Logに記録（JFSA/PCI-DSS要件）' : 'Record all deployments in Audit Log (JFSA/PCI-DSS requirements)') + ' |\n';
doc += '| ' + (G ? '変更管理チケット' : 'Change Management Ticket') + ' | ' + (G ? 'Jira/GitHub Issueの承認チケットとパイプラインを連携' : 'Link pipeline to Jira/GitHub Issue approval tickets') + ' |\n\n';
}
if (isHealthcare) {
doc += '### ' + (G ? '⚠️ Healthcare HIPAA 追加ステージ' : '⚠️ Healthcare HIPAA Additional Stages') + '\n\n';
doc += '| ' + (G ? 'ステージ' : 'Stage') + ' | ' + (G ? '内容' : 'Content') + ' |\n';
doc += '|---|---|\n';
doc += '| PHI ' + (G ? 'スキャン' : 'Scan') + ' | ' + (G ? 'PHI（保護対象医療情報）がコードやログに漏れていないか検査。git-secrets / Semgrep PHI rules' : 'Scan for PHI (Protected Health Information) leakage in code/logs. git-secrets / Semgrep PHI rules') + ' |\n';
doc += '| BAA ' + (G ? '確認' : 'Check') + ' | ' + (G ? 'Business Associate Agreement 締結状況の定期確認' : 'Periodic verification of Business Associate Agreement status') + ' |\n\n';
}
if (isEC) {
doc += '### ' + (G ? '⚠️ EC/Marketplace 追加ステージ' : '⚠️ EC/Marketplace Additional Stages') + '\n\n';
doc += '| ' + (G ? 'ステージ' : 'Stage') + ' | ' + (G ? '内容' : 'Content') + ' |\n';
doc += '|---|---|\n';
doc += '| ' + (G ? '決済スモークテスト' : 'Payment Smoke Test') + ' | ' + (G ? 'Stripe testモードで決済フロー確認（チェックアウト→webhook受信）' : 'Verify payment flow in Stripe test mode (checkout → webhook received)') + ' |\n';
doc += '| ' + (G ? '負荷テスト' : 'Load Test') + ' | ' + (G ? 'k6で同時100ユーザーシミュレーション（セール時を想定）' : 'k6 simulation with 100 concurrent users (simulating sales events)') + ' |\n\n';
}
if (isIoT) {
doc += '### ' + (G ? '⚠️ IoT 追加ステージ' : '⚠️ IoT Additional Stages') + '\n\n';
doc += '| ' + (G ? 'ステージ' : 'Stage') + ' | ' + (G ? '内容' : 'Content') + ' |\n';
doc += '|---|---|\n';
doc += '| ' + (G ? 'ファームウェアビルド' : 'Firmware Build') + ' | ' + (G ? 'クロスコンパイル（ARM/RISC-V）・フラッシュイメージ生成' : 'Cross-compile (ARM/RISC-V), generate flash image') + ' |\n';
doc += '| OTA ' + (G ? '署名検証' : 'Signature Verify') + ' | ' + (G ? 'OTAパッケージの署名・整合性検証' : 'Sign and verify integrity of OTA update packages') + ' |\n\n';
}

doc += '## ' + (G ? 'デプロイ先別GitHub Actions設定' : 'GitHub Actions Config by Deploy Target') + ' (' + dt + ')\n\n';
doc += '```yaml\n';
doc += '# .github/workflows/ci-cd.yml\n';
doc += 'name: CI/CD Pipeline\n';
doc += 'on:\n';
doc += '  push:\n';
doc += '    branches: [main, develop]\n';
doc += '  pull_request:\n';
doc += '    branches: [main]\n\n';
doc += 'env:\n';
doc += '  NODE_VERSION: "20"\n';
doc += '  ' + dtCfg.env.split(',')[0].trim() + ': ${{ secrets.' + dtCfg.env.split(',')[0].trim() + ' }}\n\n';
doc += 'jobs:\n';
doc += '  ci:\n';
doc += '    runs-on: ubuntu-latest\n';
doc += '    steps:\n';
doc += '      - uses: actions/checkout@v4\n';
doc += '      - uses: actions/setup-node@v4\n';
doc += '        with: { node-version: ${{ env.NODE_VERSION }}, cache: "' + pm + '" }\n';
doc += '      - run: ' + isPM + '\n';
doc += '      - run: ' + pm + ' run lint\n';
doc += '      - run: ' + pm + ' run type-check\n';
doc += '      - run: ' + pm + ' test --coverage\n';
doc += '      - run: ' + pm + ' run build\n';
doc += '      - uses: aquasecurity/trivy-action@master\n';
doc += '        with: { scan-type: "fs", severity: "CRITICAL,HIGH" }\n\n';
doc += '  deploy-staging:\n';
doc += '    needs: ci\n';
doc += '    if: github.ref == \'refs/heads/develop\'\n';
doc += '    runs-on: ubuntu-latest\n';
doc += '    steps:\n';
doc += '      - uses: actions/checkout@v4\n';
doc += '      - run: ' + dtCfg.preview + '\n\n';
doc += '  deploy-prod:\n';
doc += '    needs: [ci, deploy-staging]\n';
doc += '    if: github.ref == \'refs/heads/main\'\n';
if (isFintechOrInsurance) {
doc += '    environment:\n';
doc += '      name: production\n';
doc += '      # Required reviewers: set 2+ in GitHub repo settings\n';
}
doc += '    runs-on: ubuntu-latest\n';
doc += '    steps:\n';
doc += '      - uses: actions/checkout@v4\n';
doc += '      - run: ' + dtCfg.cmd + '\n';
doc += '```\n\n';
doc += '## ' + (G ? 'キャッシュ戦略' : 'Cache Strategy') + '\n\n';
doc += '| ' + (G ? 'キャッシュ対象' : 'Cache Target') + ' | ' + (G ? 'キー' : 'Key') + ' | ' + (G ? '効果' : 'Effect') + ' |\n';
doc += '|---|---|---|\n';
doc += '| node_modules | `${{ runner.os }}-' + pm + '-${{ hashFiles(\'**/lockfile\') }}` | ' + (G ? 'インストール時間60-80%削減' : 'Reduce install time 60-80%') + ' |\n';
doc += '| Next.js .next/cache | `${{ runner.os }}-nextjs-${{ hashFiles(\'**/*.ts\') }}` | ' + (G ? '差分ビルドで50-70%高速化' : 'Incremental build 50-70% faster') + ' |\n';
doc += '| Playwright browsers | `${{ runner.os }}-playwright-${{ hashFiles(\'**/package-lock.json\') }}` | ' + (G ? 'ブラウザDL不要（〜2分短縮）' : 'Skip browser download (~2min saved)') + ' |\n\n';
doc += '## ' + (G ? 'マトリクステスト（Node × OS）' : 'Matrix Tests (Node × OS)') + '\n\n';
doc += '```yaml\n';
doc += 'strategy:\n';
doc += '  matrix:\n';
doc += '    node: [18, 20, 22]\n';
doc += '    os: [ubuntu-latest, windows-latest]  # macOS optional\n';
doc += '```\n\n';
doc += '## ' + (G ? 'デプロイ先固有機能' : 'Deploy Target Features') + ': ' + dt + '\n\n';
doc += (G ? dtCfg.features_ja : dtCfg.features) + '\n\n';
doc += '**' + (G ? 'プレビューデプロイコマンド' : 'Preview Deploy Command') + ':**\n';
doc += '```bash\n' + dtCfg.preview + '\n```\n';
return doc;
}

// ============================================================================
// GENERATOR: doc 78 — Deployment Strategy
// ============================================================================
function gen78(G, domain, dtCfg, a, pn) {
var dt = a.deploy || 'Vercel';
var isFintechOrInsurance = /fintech|insurance/i.test(domain);
var isHealthcare = /health/i.test(domain);
var isSaaS = /saas/.test(domain);
// Choose recommended strategy
var recStrategy = isFintechOrInsurance ? 'blue_green' :
isSaaS ? 'canary' :
/iot|manufacturing|logistics/.test(domain) ? 'rolling' : 'canary';
var rec = DEPLOY_STRATEGIES.filter(function(s) { return s.id === recStrategy; })[0] || DEPLOY_STRATEGIES[0];
var doc = '';
doc += '# ' + (G ? 'デプロイ戦略' : 'Deployment Strategy') + '\n\n';
doc += '> **Project:** ' + pn + ' | **Domain:** ' + domain + '\n\n';
doc += '## ' + (G ? '環境戦略 (dev / staging / prod)' : 'Environment Strategy (dev / staging / prod)') + '\n\n';
doc += '```mermaid\n';
doc += 'flowchart LR\n';
doc += '  Dev[🖥️ ' + (G ? 'ローカル開発\nLocalhost' : 'Local Dev\nLocalhost') + ']\n';
doc += '  PR[🔀 PR ' + (G ? 'プレビュー\n自動生成URL' : 'Preview\nAuto-generated URL') + ']\n';
doc += '  Stg[🧪 Staging\n' + (G ? 'main→staging' : 'main→staging') + ']\n';
doc += '  Prod[🌐 Production\n' + (G ? 'タグ/承認後' : 'Tag/Approval') + ']\n';
doc += '  Dev -->|PR作成| PR\n';
doc += '  PR -->|マージ| Stg\n';
doc += '  Stg -->|' + (isFintechOrInsurance ? G ? '承認×2' : '2× Approval' : G ? '自動昇格' : 'Auto-promote') + '| Prod\n';
doc += '```\n\n';
doc += '| ' + (G ? '環境' : 'Env') + ' | ' + (G ? '目的' : 'Purpose') + ' | ' + (G ? 'トリガー' : 'Trigger') + ' | ' + (G ? 'データ' : 'Data') + ' |\n';
doc += '|---|---|---|---|\n';
doc += '| ' + (G ? '開発' : 'Dev') + ' | ' + (G ? 'ローカル開発・TDD' : 'Local dev & TDD') + ' | `git push` | ' + (G ? 'モックデータ' : 'Mock data') + ' |\n';
doc += '| PR ' + (G ? 'プレビュー' : 'Preview') + ' | ' + (G ? 'コードレビュー・QA確認' : 'Code review & QA check') + ' | PR ' + (G ? '作成' : 'created') + ' | ' + (G ? 'シードデータ' : 'Seeded data') + ' |\n';
doc += '| Staging | ' + (G ? 'E2E・負荷テスト・リリース前確認' : 'E2E, load test, pre-release check') + ' | main ' + (G ? 'マージ' : 'merge') + ' | ' + (G ? '本番相当の匿名化データ' : 'Anonymized prod-equivalent data') + ' |\n';
doc += '| Production | ' + (G ? 'エンドユーザー向け本番稼動' : 'End-user production') + ' | ' + (G ? 'タグ付け/承認' : 'Tag/approval') + ' | ' + (G ? '本番データ' : 'Live data') + ' |\n\n';
doc += '## ' + (G ? 'デプロイ戦略選択' : 'Deploy Strategy Selection') + '\n\n';
doc += '### ' + (G ? '推奨: ' : 'Recommended: ') + rec.name_ja + ' (' + rec.name_en + ')\n\n';
doc += '> ' + (G ? rec.desc_ja : rec.desc_en) + '\n\n';
doc += '| ' + (G ? '項目' : 'Item') + ' | ' + (G ? '内容' : 'Detail') + ' |\n';
doc += '|---|---|\n';
doc += '| ' + (G ? 'メリット' : 'Pros') + ' | ' + rec.pros_ja + ' |\n';
doc += '| ' + (G ? 'デメリット' : 'Cons') + ' | ' + rec.cons_ja + ' |\n';
doc += '| ' + (G ? '適用場面' : 'When') + ' | ' + rec.when_ja + ' |\n';
doc += '| ' + (G ? 'ロールバック' : 'Rollback') + ' | ' + rec.rollback_ja + ' |\n\n';
doc += '### ' + (G ? '全戦略比較' : 'All Strategies Comparison') + '\n\n';
doc += '| ' + (G ? '戦略' : 'Strategy') + ' | ' + (G ? 'ダウンタイム' : 'Downtime') + ' | ' + (G ? 'コスト' : 'Cost') + ' | ' + (G ? 'ロールバック速度' : 'Rollback Speed') + ' | ' + (G ? '推奨ドメイン' : 'Best for') + ' |\n';
doc += '|---|---|---|---|---|\n';
doc += '| ' + (G ? 'ブルーグリーン' : 'Blue-Green') + ' | なし/None | 高/High | 秒/Seconds | ' + (G ? 'fintech/EC/healthcare' : 'fintech/EC/healthcare') + ' |\n';
doc += '| ' + (G ? 'カナリア' : 'Canary') + ' | なし/None | 中/Med | 分/Minutes | SaaS/SNS |\n';
doc += '| ' + (G ? 'ローリング' : 'Rolling') + ' | ' + (G ? '最小' : 'Min') + ' | 低/Low | 分/Minutes | ' + (G ? '一般Webアプリ' : 'General web apps') + ' |\n';
doc += '| Recreate | あり/Yes | 最低/Min | ' + (G ? '即時' : 'Instant') + ' | ' + (G ? '開発/ステージング' : 'Dev/Staging') + ' |\n\n';
doc += '## ' + (G ? 'ロールバック自動化' : 'Rollback Automation') + '\n\n';
doc += '```yaml\n';
doc += '# ' + (G ? '自動ロールバック条件' : 'Auto-rollback conditions') + '\n';
doc += 'rollback_triggers:\n';
doc += '  - error_rate: "> 1%"  # ' + (G ? 'エラー率閾値' : 'Error rate threshold') + '\n';
doc += '  - p95_latency: "> 2000ms"\n';
doc += '  - health_check: "fail × 3"\n';
doc += '  - ' + (isFintechOrInsurance ? 'payment_error_rate: "> 0.1%"\n' : 'slo_breach: "true"\n');
doc += 'rollback_command: "' + (rec.id === 'blue_green' ? G ? 'LBを旧環境に切り替え' : 'Switch LB to old environment' : G ? '前リリースにrevert' : 'Revert to previous release') + '"\n';
doc += 'notify: ["slack:#deploy-alerts", "pagerduty"]\n';
doc += '```\n\n';
doc += '## ' + (G ? 'シークレット管理' : 'Secrets Management') + '\n\n';
doc += '| ' + (G ? 'シークレット' : 'Secret') + ' | ' + (G ? '保管場所' : 'Storage') + ' | ' + (G ? 'ローテーション' : 'Rotation') + ' |\n';
doc += '|---|---|---|\n';
doc += '| API Keys | GitHub Secrets / Vault | ' + (G ? '90日毎' : 'Every 90 days') + ' |\n';
doc += '| ' + (G ? 'DB接続文字列' : 'DB Connection String') + ' | ' + (G ? 'Env（暗号化）' : 'Env (encrypted)') + ' | ' + (G ? 'DB更新時' : 'On DB update') + ' |\n';
doc += '| JWT Secret | GitHub Secrets | ' + (G ? '30日毎' : 'Every 30 days') + ' |\n';
if (isFintechOrInsurance) {
doc += '| PCI-DSS Keys | AWS KMS / HashiCorp Vault | ' + (G ? '15日毎（PCI要件）' : 'Every 15 days (PCI req)') + ' |\n';
}
if (isHealthcare) {
doc += '| PHI Encryption Key | AWS KMS | ' + (G ? 'HIPAA要件に従い定期更新' : 'Regular rotation per HIPAA') + ' |\n';
}
doc += '\n';
doc += '## ' + (G ? 'ドメイン固有カスタマイズ' : 'Domain-Specific Customization') + '\n\n';
if (isFintechOrInsurance) {
doc += '### 🏦 Fintech/Insurance\n';
doc += '- ' + (G ? '本番デプロイに2名以上の承認者（GitHub Environments Required Reviewers）' : 'Production deploy requires 2+ approvers (GitHub Environments Required Reviewers)') + '\n';
doc += '- ' + (G ? '変更凍結期間（決算期・規制報告期）の自動デプロイロック' : 'Auto deploy-lock during change freeze periods (fiscal reporting)') + '\n';
doc += '- ' + (G ? '全デプロイ履歴のイミュータブル監査ログ（JFSA/PCI-DSS要件）' : 'Immutable audit log of all deployments (JFSA/PCI-DSS)') + '\n\n';
} else if (isHealthcare) {
doc += '### 🏥 Healthcare (HIPAA)\n';
doc += '- ' + (G ? 'ステージング環境は本番と同一VPCアーキテクチャで隔離' : 'Staging in isolated VPC matching production architecture') + '\n';
doc += '- ' + (G ? 'PHIを含む環境変数はAWS Secrets Manager必須' : 'PHI env vars must use AWS Secrets Manager') + '\n';
doc += '- ' + (G ? 'BAA締結済みサービスのみCIパイプラインに使用可' : 'Only BAA-signed services may be used in CI pipeline') + '\n\n';
} else if (isSaaS) {
doc += '### ☁️ SaaS\n';
doc += '- ' + (G ? 'Feature Flag連携で段階的機能ロールアウト（org単位）' : 'Feature Flag integration for per-org gradual rollout') + '\n';
doc += '- ' + (G ? 'テナント分離ポリシーをデプロイ後の自動テストで検証' : 'Verify tenant isolation policy via automated post-deploy tests') + '\n\n';
} else {
doc += '### 🌐 ' + domain + '\n';
doc += '- ' + (G ? '標準カナリアデプロイ（5% → 25% → 100%）' : 'Standard canary deploy (5% → 25% → 100%)') + '\n';
doc += '- ' + (G ? 'SLO監視を継続し自動ロールバック閾値を設定' : 'Monitor SLO continuously with auto-rollback threshold') + '\n\n';
}

return doc;
}

// ============================================================================
// GENERATOR: doc 79 — Quality Gate Matrix
// ============================================================================
function gen79(G, domain, dtCfg, a, pn) {
var isFintechOrInsurance = /fintech|insurance/i.test(domain);
var isHealthcare = /health/i.test(domain);
var isEC = /^(ec|marketplace)$/.test(domain);
var doc = '';
doc += '# ' + (G ? '品質ゲートマトリクス' : 'Quality Gate Matrix') + '\n\n';
doc += '> **Project:** ' + pn + ' | **Domain:** ' + domain + '\n\n';
doc += '## ' + (G ? 'パイプラインステージ × 品質ゲート' : 'Pipeline Stage × Quality Gate Matrix') + '\n\n';
doc += '| ' + (G ? 'ステージ' : 'Stage') + ' | ' + (G ? 'コード品質' : 'Code Quality') + ' | ' + (G ? 'テストカバレッジ' : 'Test Coverage') + ' | ' + (G ? 'セキュリティ' : 'Security') + ' | ' + (G ? 'パフォーマンス' : 'Performance') + ' | A11y |\n';
doc += '|---|:---:|:---:|:---:|:---:|:---:|\n';
doc += '| ' + (G ? 'Lint/型チェック' : 'Lint & Type Check') + ' | 🔴必須 | - | - | - | - |\n';
doc += '| ' + (G ? 'テスト' : 'Test') + ' | ✅ | 🔴必須 | 🔴必須 | - | - |\n';
doc += '| ' + (G ? 'ビルド' : 'Build') + ' | ✅ | ✅ | ✅ | ⚠️ | - |\n';
doc += '| ' + (G ? 'ステージングデプロイ後' : 'Post Staging') + ' | ✅ | ✅ | 🔴必須 | 🔴必須 | ⚠️ |\n';
doc += '| E2E | ✅ | ✅ | ✅ | 🔴必須 | 🔴必須 |\n';
doc += '| ' + (G ? '本番デプロイ後' : 'Post Production') + ' | ✅ | ✅ | ✅ | 🔴必須 | ✅ |\n\n';
doc += '🔴 = ' + (G ? 'ブロッキング (失敗時デプロイ停止)' : 'Blocking (stop deploy on fail)') + '  ⚠️ = ' + (G ? '警告 (継続可)' : 'Warning (continue OK)') + '\n\n';
doc += '## ' + (G ? '品質ゲート詳細' : 'Quality Gate Details') + '\n\n';
QUALITY_GATES.forEach(function(qg) {
doc += '### ' + (G ? qg.name_ja : qg.name_en) + ' ' + (qg.blocking ? '🔴' : '⚠️') + '\n\n';
doc += '| ' + (G ? '項目' : 'Item') + ' | ' + (G ? '詳細' : 'Detail') + ' |\n';
doc += '|---|---|\n';
doc += '| ' + (G ? 'ツール' : 'Tools') + ' | ' + (G ? qg.tools_ja : qg.tools_en) + ' |\n';
doc += '| ' + (G ? '閾値' : 'Threshold') + ' | ' + (G ? qg.threshold_ja : qg.threshold_en) + ' |\n';
doc += '| ' + (G ? 'ブロッキング' : 'Blocking') + ' | ' + (qg.blocking ? G ? '✅ はい' : '✅ Yes' : G ? '❌ いいえ（警告のみ）' : '❌ No (warning only)') + ' |\n\n';
});
doc += '## ' + (G ? 'カバレッジ閾値' : 'Coverage Thresholds') + '\n\n';
doc += '```json\n';
doc += '// vitest.config.ts / jest.config.ts\n';
doc += '{\n';
doc += '  "coverage": {\n';
doc += '    "thresholds": {\n';
doc += '      "lines": ' + (isFintechOrInsurance ? 90 : isHealthcare ? 85 : 80) + ',\n';
doc += '      "branches": ' + (isFintechOrInsurance ? 85 : 75) + ',\n';
doc += '      "functions": ' + (isFintechOrInsurance ? 90 : 80) + ',\n';
doc += '      "statements": ' + (isFintechOrInsurance ? 90 : 80) + '\n';
doc += '    }\n';
doc += '  }\n';
doc += '}\n';
doc += '```\n\n';
doc += '## ' + (G ? 'パフォーマンス予算' : 'Performance Budget') + '\n\n';
doc += '| ' + (G ? '指標' : 'Metric') + ' | ' + (G ? '目標値' : 'Target') + ' | ' + (G ? 'ツール' : 'Tool') + ' |\n';
doc += '|---|---|---|\n';
doc += '| LCP | < 2.5s | Lighthouse CI |\n';
doc += '| FCP | < 1.8s | Lighthouse CI |\n';
doc += '| TBT | < 200ms | Lighthouse CI |\n';
doc += '| CLS | < 0.1 | Lighthouse CI |\n';
doc += '| ' + (G ? 'JSバンドル' : 'JS Bundle') + ' | < 250KB (gzip) | Bundle Analyzer |\n';
doc += '| API p95 | < ' + (isFintechOrInsurance ? '200' : '500') + 'ms | k6 |\n';
if (isEC) {
doc += '| ' + (G ? '決済フロー完了時間' : 'Checkout Flow Time') + ' | < 3s | Playwright |\n';
}
doc += '\n';
doc += '## ' + (G ? 'ドメイン固有品質ゲート' : 'Domain-Specific Quality Gates') + '\n\n';
if (isFintechOrInsurance) {
doc += '### 🏦 Fintech/Insurance\n\n';
doc += '| ' + (G ? 'ゲート' : 'Gate') + ' | ' + (G ? '条件' : 'Condition') + ' | ' + (G ? 'ツール' : 'Tool') + ' |\n';
doc += '|---|---|---|\n';
doc += '| ' + (G ? 'コンプライアンス監査' : 'Compliance Audit') + ' | ' + (G ? 'PCI-DSS/JFSA要件チェックリスト100%' : 'PCI-DSS/JFSA checklist 100%') + ' | Custom script |\n';
doc += '| ' + (G ? '暗号化検証' : 'Encryption Check') + ' | ' + (G ? 'TLS 1.3以上・AES-256確認' : 'TLS 1.3+ & AES-256 verification') + ' | ssllabs-scan |\n';
doc += '| ' + (G ? '冪等性テスト' : 'Idempotency Test') + ' | ' + (G ? '同一リクエスト×3で重複処理なし' : 'No duplicate processing on 3x same request') + ' | Custom E2E |\n\n';
} else if (isHealthcare) {
doc += '### 🏥 Healthcare\n\n';
doc += '| ' + (G ? 'ゲート' : 'Gate') + ' | ' + (G ? '条件' : 'Condition') + ' | ' + (G ? 'ツール' : 'Tool') + ' |\n';
doc += '|---|---|---|\n';
doc += '| PHI ' + (G ? 'リーク検査' : 'Leak Check') + ' | ' + (G ? 'PHIパターンがコード/ログ/APIレスポンスに存在しない' : 'No PHI pattern in code/logs/API responses') + ' | git-secrets, Semgrep |\n';
doc += '| HIPAA ' + (G ? '監査' : 'Audit') + ' | ' + (G ? '全アクセスログに医療従事者IDと患者IDの記録' : 'All access logs record provider ID + patient ID') + ' | Custom |\n\n';
} else if (isEC) {
doc += '### 🛒 EC/Marketplace\n\n';
doc += '| ' + (G ? 'ゲート' : 'Gate') + ' | ' + (G ? '条件' : 'Condition') + ' | ' + (G ? 'ツール' : 'Tool') + ' |\n';
doc += '|---|---|---|\n';
doc += '| ' + (G ? '決済E2E' : 'Payment E2E') + ' | ' + (G ? 'Stripe testモードで全決済フロー成功' : 'All payment flows succeed in Stripe test mode') + ' | Playwright + Stripe CLI |\n';
doc += '| ' + (G ? '在庫整合性' : 'Inventory Check') + ' | ' + (G ? '在庫数が負にならない（同時購入シナリオ）' : 'Stock never goes negative (concurrent purchase scenario)') + ' | k6 custom scenario |\n\n';
} else {
doc += '### 🌐 ' + domain + '\n\n';
doc += (G ? '標準品質ゲートを適用。ドメイン固有の追加ゲートは必要に応じて設定してください。' : 'Apply standard quality gates. Add domain-specific gates as needed.') + '\n\n';
}

doc += '## ' + (G ? '品質ゲートMermaid' : 'Quality Gate Flow (Mermaid)') + '\n\n';
doc += '```mermaid\n';
doc += 'flowchart TD\n';
doc += '  S[' + (G ? 'PR作成' : 'PR Created') + '] --> L{Lint OK?}\n';
doc += '  L -->|No| F1[❌ ' + (G ? 'ブロック' : 'Block') + ']\n';
doc += '  L -->|Yes| T{' + (G ? 'テスト+カバレッジ' : 'Test+Coverage') + ' OK?}\n';
doc += '  T -->|No| F2[❌ ' + (G ? 'ブロック' : 'Block') + ']\n';
doc += '  T -->|Yes| SC{' + (G ? 'セキュリティスキャン' : 'Security Scan') + ' OK?}\n';
doc += '  SC -->|No| F3[❌ ' + (G ? 'ブロック' : 'Block') + ']\n';
doc += '  SC -->|Yes| D[✅ ' + (G ? 'ステージングデプロイ' : 'Deploy Staging') + ']\n';
doc += '  D --> P{' + (G ? 'パフォーマンス予算' : 'Perf Budget') + ' OK?}\n';
doc += '  P -->|No| F4[⚠️ ' + (G ? '警告' : 'Warning') + ']\n';
doc += '  P -->|Yes| PROD[🌐 ' + (G ? '本番デプロイ' : 'Deploy Prod') + ']\n';
doc += '```\n';
return doc;
}

// ============================================================================
// GENERATOR: doc 80 — Release Engineering
// ============================================================================
function gen80(G, domain, dtCfg, a, pn) {
var isSaaS = /saas/.test(domain);
var isFintechOrInsurance = /fintech|insurance/i.test(domain);
var isSmallTeam = /tool|portfolio|creator/.test(domain);
// Choose branch model
var recModel = isFintechOrInsurance ? 'gitflow' :
isSaaS || isSmallTeam ? 'trunk' : 'github_flow';
var rec = RELEASE_MODELS.filter(function(m) { return m.id === recModel; })[0] || RELEASE_MODELS[0];
var doc = '';
doc += '# ' + (G ? 'リリースエンジニアリング' : 'Release Engineering') + '\n\n';
doc += '> **Project:** ' + pn + ' | **Domain:** ' + domain + '\n\n';
doc += '## ' + (G ? 'ブランチモデル' : 'Branch Model') + '\n\n';
doc += '### ' + (G ? '推奨: ' : 'Recommended: ') + rec.name_ja + '\n\n';
doc += '> ' + (G ? rec.branches_ja : rec.branches_en) + '\n\n';
doc += '**' + (G ? '最適なケース:' : 'Best for:') + '** ' + (G ? rec.best_for_ja : rec.best_for_en) + '\n\n';
doc += '```mermaid\n';
doc += 'gitGraph\n';
if (rec.id === 'trunk') {
doc += '   commit id: "main: feat-A"\n';
doc += '   branch feature/short-lived\n';
doc += '   commit id: "feat: new feature"\n';
doc += '   checkout main\n';
doc += '   merge feature/short-lived id: "merge+deploy"\n';
doc += '   commit id: "main: feat-B"\n';
} else if (rec.id === 'gitflow') {
doc += '   commit id: "main: v1.0.0"\n';
doc += '   branch develop\n';
doc += '   commit id: "develop: init"\n';
doc += '   branch feature/auth\n';
doc += '   commit id: "feat: auth"\n';
doc += '   checkout develop\n';
doc += '   merge feature/auth\n';
doc += '   branch release/1.1.0\n';
doc += '   commit id: "release: bump"\n';
doc += '   checkout main\n';
doc += '   merge release/1.1.0 id: "v1.1.0"\n';
} else {
doc += '   commit id: "main: v1.0"\n';
doc += '   branch feat/user-auth\n';
doc += '   commit id: "feat: auth impl"\n';
doc += '   checkout main\n';
doc += '   merge feat/user-auth id: "deploy"\n';
}
doc += '```\n\n';
doc += '| ' + (G ? 'モデル' : 'Model') + ' | ' + (G ? 'ブランチ構成' : 'Branches') + ' | ' + (G ? '推奨シーン' : 'Best for') + ' |\n';
doc += '|---|---|---|\n';
RELEASE_MODELS.forEach(function(m) {
doc += '| **' + m.name_en + '** | `' + (G ? m.branches_ja : m.branches_en).substring(0, 40) + '...` | ' + (G ? m.best_for_ja : m.best_for_en) + ' |\n';
});
doc += '\n';
doc += '## ' + (G ? 'セマンティックバージョニング' : 'Semantic Versioning') + '\n\n';
doc += '```\n';
doc += 'MAJOR.MINOR.PATCH[-PRERELEASE][+BUILD]\n\n';
doc += 'MAJOR: ' + (G ? '破壊的変更（APIの後方非互換）' : 'Breaking changes (backward-incompatible API)') + '\n';
doc += 'MINOR: ' + (G ? '新機能追加（後方互換）' : 'New features (backward-compatible)') + '\n';
doc += 'PATCH: ' + (G ? 'バグ修正（後方互換）' : 'Bug fixes (backward-compatible)') + '\n\n';
doc += G ? '例:' : 'Example:';
doc += '\n  1.0.0 → 1.0.1  (バグ修正/bugfix)\n';
doc += '  1.0.1 → 1.1.0  (新機能/feature)\n';
doc += '  1.1.0 → 2.0.0  (破壊的変更/breaking)\n';
doc += '```\n\n';
doc += '```yaml\n';
doc += '# .github/workflows/release.yml\n';
doc += '# ' + (G ? 'セマンティックリリース自動化' : 'Semantic release automation') + '\n';
doc += 'name: Release\n';
doc += 'on:\n';
doc += '  push:\n';
doc += '    branches: [main]\n';
doc += 'jobs:\n';
doc += '  release:\n';
doc += '    runs-on: ubuntu-latest\n';
doc += '    steps:\n';
doc += '      - uses: actions/checkout@v4\n';
doc += '        with: { fetch-depth: 0 }\n';
doc += '      - uses: cycjimmy/semantic-release-action@v4\n';
doc += '        env:\n';
doc += '          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n';
doc += '          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}\n';
doc += '```\n\n';
doc += '## CHANGELOG ' + (G ? '自動化 (Conventional Commits)' : 'Automation (Conventional Commits)') + '\n\n';
doc += '```\n';
doc += G ? 'コミットメッセージ規約:' : 'Commit message convention:';
doc += '\n  feat: '     + (G ? '新機能（MINOR）' : 'New feature (MINOR)') + '\n';
doc += '  fix: '       + (G ? 'バグ修正（PATCH）' : 'Bug fix (PATCH)') + '\n';
doc += '  feat!: '     + (G ? '破壊的変更（MAJOR）' : 'Breaking change (MAJOR)') + '\n';
doc += '  chore: '     + (G ? 'ビルド・ツール変更（リリースなし）' : 'Build/tooling (no release)') + '\n';
doc += '  docs: '      + (G ? 'ドキュメント（リリースなし）' : 'Docs (no release)') + '\n';
doc += '  refactor: '  + (G ? 'リファクタリング（PATCH or リリースなし）' : 'Refactor (PATCH or no release)') + '\n';
doc += '  test: '      + (G ? 'テスト追加（リリースなし）' : 'Test additions (no release)') + '\n';
doc += '```\n\n';
doc += '## ' + (G ? '依存関係の自動更新' : 'Dependency Auto-Update') + '\n\n';
doc += '```yaml\n';
doc += '# .github/renovate.json\n';
doc += '{\n';
doc += '  "$schema": "https://docs.renovatebot.com/renovate-schema.json",\n';
doc += '  "extends": ["config:best-practices"],\n';
doc += '  "schedule": ["before 6am on monday"],\n';
doc += '  "automerge": true,\n';
doc += '  "packageRules": [\n';
doc += '    {\n';
doc += '      "matchDepTypes": ["devDependencies"],\n';
doc += '      "automerge": true\n';
doc += '    },\n';
if (isFintechOrInsurance) {
doc += '    {\n';
doc += '      "matchPackagePatterns": [".*"],\n';
doc += '      "automerge": false,\n';
doc += '      "reviewers": ["@security-team"],\n';
doc += '      "labels": ["security-review"]\n';
doc += '    },\n';
}
doc += '    {\n';
doc += '      "matchUpdateTypes": ["major"],\n';
doc += '      "automerge": false,\n';
doc += '      "reviewers": ["@team/lead"]\n';
doc += '    }\n';
doc += '  ]\n';
doc += '}\n';
doc += '```\n\n';
doc += '## SBOM (' + (G ? 'ソフトウェア部品表)' : 'Software Bill of Materials)') + '\n\n';
doc += '```yaml\n';
doc += '# GitHub Actions - SBOM generation\n';
doc += '- uses: anchore/sbom-action@v0\n';
doc += '  with:\n';
doc += '    artifact-name: sbom-' + pn.toLowerCase().replace(/\s/g, '-') + '.spdx.json\n';
doc += '    format: spdx-json\n';
doc += '    output-file: sbom.spdx.json\n';
doc += '```\n\n';
doc += (G ? 'SBOMはリリースアーティファクトとして保存し、サプライチェーンセキュリティ（SLSA Level 2以上）に使用します。' : 'Store SBOM as release artifact for supply chain security (SLSA Level 2+).') + '\n\n';
doc += '## ' + (G ? '緊急ホットフィックスフロー' : 'Emergency Hotfix Flow') + '\n\n';
doc += '```mermaid\n';
doc += 'flowchart LR\n';
doc += '  A[🚨 ' + (G ? '本番障害検知' : 'Production incident') + '] --> B[hotfix/' + (G ? '障害内容' : 'issue') + ' ' + (G ? 'ブランチ作成' : 'branch') + ']\n';
doc += '  B --> C[' + (G ? '修正実装' : 'Implement fix') + ']\n';
doc += '  C --> D[CI ' + (G ? 'パス確認' : 'pass check') + ']\n';
doc += '  D --> E[main ' + (G ? 'へPR/マージ' : 'PR & merge') + ']\n';
doc += '  E --> F[🚀 ' + (G ? '緊急デプロイ' : 'Emergency deploy') + ']\n';
if (rec.id === 'gitflow') {
doc += '  F --> G[develop ' + (G ? 'にバックポート' : 'backport') + ']\n';
}
doc += '```\n\n';
// dev_env_type: branch strategy by dev environment
var devEnv = a.dev_env_type || '';
var isCloud = /Cloud|クラウド/i.test(devEnv);
var isHybrid = /Hybrid|ハイブリッド/i.test(devEnv);
doc += '## ' + (G ? '開発環境別ブランチ戦略' : 'Branch Strategy by Dev Environment') + '\n\n';
if (isCloud) {
doc += (G ? '**クラウド開発**: Trunk-Based Development推奨 — プレビューデプロイでPR単位の確認が可能\n' : '**Cloud Dev**: Trunk-Based Development — preview deploys enable PR-level verification\n');
} else if (isHybrid) {
doc += (G ? '**ハイブリッド**: GitHub Flow推奨 — ローカルテスト+クラウドプレビューの併用\n' : '**Hybrid**: GitHub Flow — combine local tests with cloud previews\n');
} else {
doc += (G ? '**ローカル開発**: Feature Branch + CI推奨 — ローカルテスト完了後にPR作成\n' : '**Local Dev**: Feature Branch + CI — create PRs after local tests pass\n');
}
doc += '\n';
return doc;
}

// ============================================================================
// ORCHESTRATOR
// ============================================================================
function genPillar20_CICDIntelligence(a, pn) {
var G = S.genLang === 'ja';
var domain = detectDomain(a.purpose || '') || 'saas';
var dt = a.deploy || 'Vercel';
// Normalize Docker key (JA: 'Docker (自前)', EN: 'Docker (self-hosted)' → 'Docker')
var dtKey = /Docker/i.test(dt) ? 'Docker' : dt;
var dtCfg = DEPLOY_TARGET_CONFIG[dtKey] || DEPLOY_TARGET_CONFIG['Vercel'];
S.files['docs/77_cicd_pipeline_design.md'] = gen77(G, domain, dtCfg, a, pn);
S.files['docs/78_deployment_strategy.md'] = gen78(G, domain, dtCfg, a, pn);
S.files['docs/79_quality_gate_matrix.md'] = gen79(G, domain, dtCfg, a, pn);
S.files['docs/80_release_engineering.md'] = gen80(G, domain, dtCfg, a, pn);
}
function genDocs21(a,pn){
const G=S.genLang==='ja';
const date=new Date().toISOString().split('T')[0];
const ganttStart=new Date().toISOString().split('T')[0];
const fe=a.frontend||'React';const be=a.backend||'Node.js';
const auth=resolveAuth(a);
const arch=resolveArch(a);
const orm=arch.isBaaS?(be.includes('Supabase')?'Supabase Client':be.includes('Firebase')?'Firebase SDK':'Convex'):(a.orm&&a.orm.includes('Drizzle')?'Drizzle':'Prisma');
const stripPri=s=>(s||'').replace(/\[P[0-2]\]\s*/g,'');
const entities=(stripPri(a.data_entities)||'users, items').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const features=(stripPri(a.mvp_features)||(G?'CRUD操作':'CRUD')).split(', ').filter(Boolean);
const screens=(stripPri(a.screens)||(G?'ダッシュボード, ログイン':'Dashboard, Login')).split(', ').filter(Boolean);
const methods=(stripPri(a.dev_methods)||'TDD').split(', ').filter(Boolean);
const target=(a.target||'').toLowerCase();
const hasAdmin=/管理者|admin|管理/i.test(target)||features.some(f=>/管理ダッシュボード|admin/i.test(f));
const hasInstructor=/講師|instructor|teacher/i.test(target);
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
// 1. Project Overview
S.files['docs/01_project_overview.md']=`# ${pn} — ${G?'プロジェクト概要書':'Project Overview'}\n> ${date}\n\n${G?'## 目的':'## Purpose'}\n${a.purpose||'N/A'}\n\n${G?'## ターゲット':'## Target'}\n${a.target||'N/A'}\n\n${G?'## 成功指標':'## Success Metrics'}\n${a.success||'N/A'}\n\n${G?'## スケジュール':'## Schedule'}\n${a.deadline||(G?'6ヶ月':'6 months')}\n\n## ${G?'技術スタック':'Tech Stack'}\n- Frontend: ${fe}\n- Backend: ${be}\n- DB: ${a.database||'PostgreSQL'}\n- Deploy: ${a.deploy||'Vercel'}`;
// 2. Requirements
S.files['docs/02_requirements.md']=`# ${pn} — ${G?'要件定義書':'Requirements'}\n> ${date}\n\n${G?'## 機能要件':'## Functional Requirements'}\n${features.map(f=>'- '+f).join('\n')}\n\n${G?'## 非機能要件':'## Non-functional'}\n- ${G?'レスポンス':'Response'}: ${S.skill==='pro'?'<200ms (p95)':S.skill==='intermediate'?'<500ms (p95)':'<1000ms (p95)'}\n- ${G?'可用性':'Availability'}: ${S.skill==='pro'?'99.9%':S.skill==='intermediate'?'99%':(G?'ベストエフォート':'Best effort')}\n- ${G?'セキュリティ':'Security'}: OWASP Top 10`;
// 3. Architecture
const archLabelD=G?{baas:'BaaS統合型',bff:'BFF（API Routes統合）',split:'FE/BE分離型',traditional:'従来型クライアント-サーバー'}[arch.pattern]:{baas:'BaaS Integration',bff:'BFF (API Routes)',split:'FE/BE Split',traditional:'Traditional Client-Server'}[arch.pattern];
const layersD=arch.isBaaS?'1. Presentation Layer ('+fe+')\\n2. BaaS SDK Layer ('+be+')\\n3. Functions Layer (Edge/Cloud Functions)\\n4. Data Layer ('+(a.database||'PostgreSQL')+')':arch.pattern==='bff'?'1. Presentation Layer ('+fe+')\\n2. API Routes Layer (Next.js Route Handlers)\\n3. Domain Layer (Business Logic)\\n4. Data Layer ('+(a.database||'PostgreSQL')+')':'1. Presentation Layer ('+fe+')\\n2. Application Layer (API Routes)\\n3. Domain Layer (Business Logic)\\n4. Infrastructure Layer ('+(a.database||'PostgreSQL')+')';
S.files['docs/03_architecture.md']=`# ${pn} — ${G?'アーキテクチャ設計書':'Architecture Design'}\n> ${date}\n\n${G?'## アーキテクチャパターン':'## Architecture Pattern'}\n${archLabelD}\n\n${G?'## システム構成図':'## System Diagram'}\n\n\`\`\`\n${arch.diagram}\n\`\`\`\n${arch.note?'\n> '+arch.note+'\n':''}\n${G?'## レイヤー構造':'## Layer Structure'}\n${layersD}`;
// 4. ER Diagram (Mermaid erDiagram) — with rich columns from ENTITY_COLUMNS
const erLines=[];
entities.forEach(e=>{
const cols=getEntityColumns(e,G,entities);
const colLines=['    uuid id PK'];
cols.forEach(c=>{
const mT=c.type.includes('VARCHAR')?'string':c.type.includes('INT')||c.type.includes('DECIMAL')?'int':c.type.includes('BOOLEAN')?'boolean':c.type.includes('TIMESTAMP')||c.type.includes('DATE')||c.type.includes('TIME')?'timestamp':c.type.includes('JSONB')?'json':'string';
const mC=c.constraint.includes('FK')?'FK':c.constraint.includes('UNIQUE')?'UK':'';
colLines.push(`    ${mT} ${c.col} ${mC}`.trimEnd());
});
if(!cols.length) colLines.push('    string name');
colLines.push('    timestamp created_at','    timestamp updated_at');
erLines.push(`  ${e.replace(/\s/g,'_')} {\n${colLines.join('\n')}\n  }`);
});
const erRels=[];
const erInf=inferER(a);
erInf.relationships.forEach(r=>{
const clean=r.replace(/\s*\(.*\)\s*$/,'');
const words=clean.split(/\s+/);
if(words.length>=3){
const from=words[0].replace(/\s/g,'_');
const to=words[words.length-1].replace(/\s/g,'_');
const mid=words.slice(1,-1).join(' ');
if(mid.includes('N')&&mid.includes('M')) erRels.push(`  ${from} }o--o{ ${to} : "many-to-many"`);
else if(mid.includes('0')) erRels.push(`  ${from} o|--o{ ${to} : "self-ref"`);
else erRels.push(`  ${from} ||--o{ ${to} : "has"`);
}
});
if(!erRels.length){
const hasUser=entities.some(e=>e.toLowerCase()==='user');
if(hasUser) entities.forEach(e=>{
if(e.toLowerCase()!=='user') erRels.push(`  User ||--o{ ${e.replace(/\s/g,'_')} : "has"`);
});
}
// FK map — merge inferER relationships + ENTITY_COLUMNS FK annotations
const fkMap={};
erInf.relationships.forEach(r=>{
const clean=r.replace(/\s*\(.*\)\s*$/,'');
const words=clean.split(/\s+/);
if(words.length>=3){
const parent=words[0],to=words[words.length-1],mid=words.slice(1,-1).join(' ');
if(!mid.includes('M')&&!mid.includes('0')){
if(!fkMap[to])fkMap[to]=[];
const fk=parent.toLowerCase()+'_id';
if(!fkMap[to].includes(fk))fkMap[to].push(fk);
}
}
});
entities.forEach(e=>{
getEntityColumns(e,G,entities).forEach(c=>{
if(c.constraint.includes('FK')){if(!fkMap[e])fkMap[e]=[];if(!fkMap[e].includes(c.col))fkMap[e].push(c.col);}
});
});
if(!Object.keys(fkMap).length) erRels.forEach(rel=>{
const m2=rel.match(/(\w+)\s+\|\|--o\{\s+(\w+)/);
if(m2){if(!fkMap[m2[2]])fkMap[m2[2]]=[];const fk=m2[1].toLowerCase()+'_id';if(!fkMap[m2[2]].includes(fk))fkMap[m2[2]].push(fk);}
});
S.files['docs/04_er_diagram.md']=`# ${pn} — ${G?'ER図':'ER Diagram'}\n> ${date}\n\n${G?'## エンティティ関連図':'## Entity Relationship Diagram'}\n\n\`\`\`mermaid\nerDiagram\n${erLines.join('\n')}\n${erRels.join('\n')}\n\`\`\`\n\n${G?'## エンティティ詳細':'## Entity Details'}\n${entities.map(e=>{
const cols=getEntityColumns(e,G,entities);
const colRows=cols.map(c=>`| ${c.col} | ${c.type} | ${c.constraint.includes('FK')?'FK':c.constraint||''} | ${c.desc} |`).join('\n');
const nameRow=cols.length?'':(`| name | VARCHAR(255) | NOT NULL | ${e} ${G?'名':'name'} |\n`);
return `\n### ${e}\n| ${G?'カラム':'Column'} | ${G?'型':'Type'} | ${G?'制約':'Constraint'} | ${G?'説明':'Desc'} |\n|--------|------|------|------|\n| id | UUID | PK | ${G?'一意識別子':'Unique ID'} |\n${colRows?colRows+'\n':''}${nameRow}| created_at | TIMESTAMP | DEFAULT NOW | ${G?'作成日時':'Created at'} |\n| updated_at | TIMESTAMP | DEFAULT NOW | ${G?'更新日時':'Updated at'} |`;
}).join('\n')}`;
// 5. API Design (BaaS-aware)
let apiEndpoints;
if(arch.isBaaS){
const sdkName=be.includes('Supabase')?'Supabase Client SDK':be.includes('Firebase')?'Firebase SDK':'BaaS SDK';
apiEndpoints=entities.map(e=>{
const tbl=pluralize(e);
const cols=getEntityColumns(e,G,entities);
// Build insert/update field examples from real columns
const insertFields=cols.filter(c=>!c.col.endsWith('_at')&&!c.constraint.includes('DEFAULT NOW')&&!c.constraint.includes('FK')).slice(0,4);
const insertObj=insertFields.length?insertFields.map(c=>c.col+': '+(c.type.includes('INT')||c.type.includes('DECIMAL')?'0':c.type.includes('BOOLEAN')?'false':`'...'`)).join(', '):'name: \'...\'';
const fkFields=cols.filter(c=>c.constraint.includes('FK'));
const fkInsert=fkFields.map(c=>{
const varName=c.col.replace(/_([a-z])/g,(_,l)=>l.toUpperCase()).replace(/Id$/,'Id');
return c.col+': '+varName;
}).join(', ');
const allInsert=[fkInsert,insertObj].filter(Boolean).join(', ');
if(be.includes('Supabase')){
return `\n### ${e} (${G?'テーブル':'table'}: ${tbl})\n\n#### ${G?'一覧取得':'List'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').select('*').range(0, 19).order('created_at', { ascending: false })\n\`\`\`\n\n#### ${G?'詳細取得':'Get by ID'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').select('*').eq('id', id).single()\n\`\`\`\n\n#### ${G?'作成':'Create'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').insert({ ${allInsert} }).select()\n\`\`\`\n\n#### ${G?'更新':'Update'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').update({ ${insertObj} }).eq('id', id).select()\n\`\`\`\n\n#### ${G?'削除':'Delete'}\n\`\`\`ts\nawait supabase.from('${tbl}').delete().eq('id', id)\n\`\`\``;
}
return `\n### ${e}\n- SDK: \`${sdkName}\`\n- ${G?'CRUD操作はSDK経由で実行':'CRUD via SDK calls'}`;
}).join('\n');
} else {
apiEndpoints=entities.map(e=>{
const lower=e.toLowerCase().replace(/\s/g,'_');
const cols=getEntityColumns(e,G,entities);
const bodyFields=cols.filter(c=>!c.col.endsWith('_at')&&!c.constraint.includes('DEFAULT NOW')).slice(0,5);
const bodyObj=bodyFields.length?bodyFields.map(c=>`"${c.col}": "${c.type.includes('INT')?'number':c.type.includes('BOOLEAN')?'boolean':'string'}"`).join(', '):`"name": "string"`;
const methods=getEntityMethods(e);
const parts=[`\n### /api/v1/${lower}`];
if(methods.includes('GET')) parts.push(`\n#### GET /api/v1/${lower}\n- ${G?'説明':'Desc'}: ${G?e+'一覧取得 (ページネーション対応)':'List '+e+' (paginated)'}\n- クエリ: \`?page=1&limit=20&sort=created_at&order=desc\`\n- レスポンス:\n\`\`\`json\n{ "data": [{ "id": "uuid", ${bodyObj} }], "meta": { "total": 100, "page": 1 } }\n\`\`\`\n- ${G?'ステータス':'Status'}: 200 / 401 / 500`);
if(methods.includes('GET/:id')) parts.push(`\n#### GET /api/v1/${lower}/:id\n- ${G?'説明':'Desc'}: ${G?e+'詳細取得':'Get '+e+' detail'}\n- ${G?'ステータス':'Status'}: 200 / 404`);
if(methods.includes('POST')) parts.push(`\n#### POST /api/v1/${lower}\n- ${G?'リクエスト':'Request'}: \`{ ${bodyObj} }\`\n- ${G?'ステータス':'Status'}: 201 / 400 / 422`);
if(methods.includes('PUT/:id')) parts.push(`\n#### PUT /api/v1/${lower}/:id\n- ${G?'リクエスト':'Request'}: \`{ ${bodyObj} }\`\n- ${G?'ステータス':'Status'}: 200 / 404 / 422`);
if(methods.includes('PATCH/:id')||methods.includes('PATCH')) parts.push(`\n#### PATCH /api/v1/${lower}${methods.includes('PATCH/:id')?'/:id':''}\n- ${G?'リクエスト':'Request'}: \`{ ${bodyObj} }\`\n- ${G?'ステータス':'Status'}: 200 / 404 / 422`);
if(methods.includes('DELETE/:id')) parts.push(`\n#### DELETE /api/v1/${lower}/:id\n- ${G?'ステータス':'Status'}: 204 / 404`);
return parts.join('');
}).join('\n');
}
// 6. Screen Design (intelligent flow + component details)
const sNodes=screens.map((s,i)=>`  S${i}["${s}"]`).join('\n');
// Build intelligent screen flow based on screen types
const sLinks=[];
const sIdx={};screens.forEach((s,i)=>sIdx[s]=i);
const findScreen=(pattern)=>screens.findIndex(s=>new RegExp(pattern,'i').test(s));
const landingIdx=findScreen('ランディング|landing|LP|トップ|home');
const loginIdx=findScreen('ログイン|login|サインイン');
const registerIdx=findScreen('新規登録|register|signup');
const dashIdx=findScreen('ダッシュボード|dashboard');
const settingsIdx=findScreen('設定|setting|プロフィール|profile');
const adminIdx=findScreen('管理|admin');
const paymentIdx=findScreen('決済|payment|billing|checkout|課金');
const detailIdx=findScreen('詳細|detail|コース|course|商品|product');
// Auth flow: landing → login → dashboard
if(landingIdx>=0&&dashIdx>=0) sLinks.push(`  S${landingIdx} --> S${dashIdx}`);
// Dashboard as hub
screens.forEach((s,i)=>{
if(i===landingIdx||i===dashIdx) return;
const isPublic=/ランディング|landing|LP|ログイン|login|register|登録|料金|pricing|about|概要|terms|利用規約|contact|お問い合わせ/i.test(s);
const isAdmin=/管理|admin/i.test(s);
if(!isPublic&&dashIdx>=0){
if(isAdmin){
sLinks.push(`  S${dashIdx} -->|${G?'管理者のみ':'admin only'}| S${i}`);
} else {
sLinks.push(`  S${dashIdx} --> S${i}`);
}
// Bidirectional for main sections
if(/設定|setting|プロフィール|profile|詳細|detail|コース|course/i.test(s)) sLinks.push(`  S${i} --> S${dashIdx}`);
}
});
// Purchase flow: detail → payment
if(detailIdx>=0&&paymentIdx>=0) sLinks.push(`  S${detailIdx} --> S${paymentIdx}`);
// Fallback: if no links generated, use simple chain
if(!sLinks.length){
screens.forEach((s,i)=>{if(i<screens.length-1) sLinks.push(`  S${i} --> S${i+1}`);});
}
// 7. Test Cases (feature-specific when available)
const testMatrix=features.map(f=>{
const fd=getFeatureDetail(f);
const header=`\n### ${f}\n| # | ${G?'ケース':'Case'} | ${G?'種別':'Type'} | ${G?'期待結果':'Expected'} | ${G?'優先度':'Priority'} |\n|---|--------|------|----------|--------|`;
if(fd){
const tests=G?fd.tests_ja:fd.tests_en;
return header+'\n'+tests.map((t,i)=>{
const isErr=t[0].includes('異常')||t[0].includes('Error');
const type=isErr?'Error':'Normal';
const pri=i<2?'P0':'P1';
return `| ${i+1} | ${t[0]} | ${type} | ${t[1]} | ${pri} |`;
}).join('\n');
}
return header+`\n| 1 | ${G?'正常系: 基本操作':'Normal: Basic op'} | Normal | 200/201 ${G?'成功':'OK'} | P0 |\n| 2 | ${G?'正常系: 境界値':'Normal: Boundary'} | Boundary | ${G?'正常処理':'OK'} | P1 |\n| 3 | ${G?'異常系: 必須項目欠落':'Error: Missing field'} | Error | 422 ${G?'バリデーションエラー':'Validation Error'} | P0 |\n| 4 | ${G?'異常系: 権限不足':'Error: No permission'} | Auth | 401/403 | P0 |\n| 5 | ${G?'異常系: 不正フォーマット':'Error: Bad format'} | Error | 400 Bad Request | P1 |\n| 6 | ${G?'異常系: 存在しないID':'Error: ID not found'} | Error | 404 Not Found | P1 |`;
}).join('\n');
// 9. Release Checklist (dynamic per deploy target)
const deployTarget=a.deploy||'Vercel';
const dChecks=G?{'Vercel':['Vercel環境変数設定','プレビューデプロイ動作確認','カスタムドメインDNS設定','Edge Functions設定'],'AWS':['IAMロール・ポリシー確認','RDSセキュリティグループ設定','CloudFront設定','Route53 DNS設定'],'Railway':['Railway環境変数設定','PostgresDB接続確認','カスタムドメイン設定','自動デプロイ有効化'],'Netlify':['Netlify環境変数設定','ビルドコマンド確認','カスタムドメインDNS設定','Netlify Functions設定'],'Fly.io':['Fly.io環境変数(fly secrets)','fly.toml設定確認','ヘルスチェック設定','カスタムドメインCERT設定'],'Cloudflare':['Cloudflare環境変数設定','Pages/Workers設定','カスタムドメインDNS設定','KV/D1接続確認']}:{'Vercel':['Vercel env vars','Preview deploy check','Custom domain DNS','Edge Functions config'],'AWS':['IAM roles/policies','RDS security groups','CloudFront config','Route53 DNS'],'Railway':['Railway env vars','Postgres connection','Custom domain','Auto-deploy enabled'],'Netlify':['Netlify env vars','Build command check','Custom domain DNS','Netlify Functions config'],'Fly.io':['Fly.io secrets','fly.toml config','Health check setup','Custom domain CERT'],'Cloudflare':['Cloudflare env vars','Pages/Workers config','Custom domain DNS','KV/D1 connection']};
const deployChecks=dChecks[deployTarget]||dChecks[Object.keys(dChecks).find(k=>deployTarget.includes(k))]||dChecks['Vercel'];
const dbName=a.database||'PostgreSQL';
const dbChecks=dbName.includes('Supa')?(G?['Supabase RLS有効化','API Key設定','接続プール設定']:['Supabase RLS enabled','API Key configured','Connection pool']):G?['マイグレーション実行確認','接続プール設定','バックアップ設定']:['Migration verified','Connection pool','Backup configured'];
// 10. Gantt (Mermaid)
const ganttTasks=features.map((f,i)=>{
const days=f.match(/Auth|認証/i)?5:f.match(/Admin|管理/i)?4:f.match(/Upload|ファイル/i)?3:3;
return `  ${f.replace(/[^a-zA-Z0-9ぁ-んァ-ヶー一-龠\s]/g,'')} :s${i}, ${i===0?'after ci':('after s'+(i-1))}, ${days}d`;
}).join('\n');
// 11. WBS (3-level + hours)
const wbsTasks=features.map((f,i)=>{
const h=f.match(/Auth|認証/i)?16:f.match(/Admin|管理/i)?12:f.match(/Upload|ファイル/i)?8:f.match(/CRUD|一覧/i)?6:8;
return `### 2.${i+1} ${f} (${h}h)\n- 2.${i+1}.1 ${G?'データモデル定義':'Data model'} (${Math.ceil(h*0.2)}h)\n- 2.${i+1}.2 ${G?'API実装':'API implementation'} (${Math.ceil(h*0.3)}h)\n- 2.${i+1}.3 ${G?'UI実装':'UI implementation'} (${Math.ceil(h*0.3)}h)\n- 2.${i+1}.4 ${G?'テスト':'Testing'} (${Math.ceil(h*0.2)}h)`;
}).join('\n\n');
const totalH=features.reduce((s,f)=>{const h=f.match(/Auth|認証/i)?16:f.match(/Admin|管理/i)?12:f.match(/Upload|ファイル/i)?8:f.match(/CRUD|一覧/i)?6:8;return s+h;},0);
// Prompt Playbook (C3: new)
S.files['docs/22_prompt_playbook.md']=`# ${pn} — ${G?'プロンプトプレイブック':'Prompt Playbook'}\n> ${date}\n\n${G?'## 使い方\n開発フェーズごとに、以下のプロンプトを順番にAI (Claude / Cursor) に投入してください。':'## Usage\nFeed these prompts to AI (Claude / Cursor) in order for each dev phase.'}\n\n${G?'## Phase 0: 戦略レビュー\n\n### 0-1. 業界ブループリント確認\n```\ndocs/48_industry_blueprint.md を読み、以下を確認してください:\n- 規制要件とコンプライアンス対応\n- 業界固有のアーキテクチャパターン\n- 主要失敗要因と予防策\n```\n\n### 0-2. ステークホルダー戦略\n```\ndocs/50_stakeholder_strategy.md を読み、以下を確認してください:\n- 開発フェーズ戦略（MVP→Growth→Scale）\n- チーム構成と役割分担\n- 技術的負債の管理方針\n```\n\n':'## Phase 0: Strategic Review\n\n### 0-1. Industry Blueprint Review\n```\nRead docs/48_industry_blueprint.md and confirm:\n- Regulatory requirements and compliance needs\n- Industry-specific architecture patterns\n- Key failure factors and prevention strategies\n```\n\n### 0-2. Stakeholder Strategy\n```\nRead docs/50_stakeholder_strategy.md and confirm:\n- Development phase strategy (MVP→Growth→Scale)\n- Team composition and roles\n- Technical debt management policy\n```\n\n'}## Phase 1: ${G?'プロジェクトセットアップ':'Project Setup'}\n\n### 1-1. ${G?'初期環境構築':'Initial Setup'}\n\`\`\`\n${G?'以下の技術スタックでプロジェクトの初期セットアップを行ってください。':'Set up the project with the following tech stack.'}\n- Frontend: ${fe}\n- Backend: ${be}\n
- DB: ${dbName}\n- Deploy: ${deployTarget}\n${G?'package.json, tsconfig.json, .env.example を生成してください。':'Generate package.json, tsconfig.json, .env.example.'}\n\`\`\`\n\n### 1-2. ${G?'データモデル定義':'Data Model'}\n\`\`\`\n${G?'以下のエンティティの'+orm+'スキーマを生成してください:':'Generate '+orm+' schema for these entities:'} ${entities.join(', ')}\n${entities.map(e=>{const cols=getEntityColumns(e,G,entities);if(!cols.length) return '';return e+': '+cols.map(c=>c.col+'('+c.type+')').join(', ');}).filter(Boolean).join('\n')}\n${G?'各エンティティにはid, created_at, updated_atを含め、リレーションも定義してください。':'Include id, created_at, updated_at for each entity with relations.'}\n
\`\`\`\n\n## Phase 2: ${G?'コア機能開発':'Core Development'}\n\n${features.map((f,i)=>{const fd=getFeatureDetail(f);const criteriaLines=fd?(G?fd.criteria_ja:fd.criteria_en).map(c=>'  - '+c.replace(/\{auth\}/g,a.auth||'OAuth')).join('\n'):'';return `### 2-${i+1}. ${f}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'フルスタック開発者 (Frontend + Backend)':'Full-stack developer (Frontend + Backend)'}\n\n${G?f+'機能を実装してください。':'Implement '+f+'.'}\n- ${arch.isBaaS?(G?'データアクセス: '+orm+'でCRUDを実装':'Data access: Implement CRUD with '+orm):(G?'APIエンドポイント: /api/v1/ にCRUDを作成':'API endpoint: Create CRUD at /api/v1/')}\n- ${G?'UIコンポーネント: '+fe+'で画面を実装':'UI component: Build screen with '+fe}\n- ${G?'バリデーション: zodスキーマで入力検証':'Validation: zod schema for input'}\n- ${G?'テスト: Vitestでユニットテスト作成':'Test: Write unit tests with Vitest'}${criteriaLines?'\n\n'+(G?'受入条件:':'Acceptance Criteria:')+'\n'+criteriaLines:''}\n\n${G?'docs/39_implementation_playbook.mdのドメインパターンを参照してください。':'Reference domain patterns in docs/39_implementation_playbook.md.'}\n\n**${G?'出力形式':'Output Format'}**: ${G?'ファイルパス付きコードブロック。テストを含めること。':'Code blocks with file paths. Include tests.'}\n\`\`\``}).join('\n\n')}\n\n
## Phase 3: ${G?'テスト・デプロイ':'Test & Deploy'}\n\n### 3-1. ${G?'E2Eテスト':'E2E Tests'}\n\`\`\`\n${G?'Playwrightで以下の画面のE2Eテストを作成してください:':'Create Playwright E2E tests for these screens:'} ${screens.join(', ')}\n${G?'正常系・異常系の両方をカバーしてください。':'Cover both happy and error paths.'}\n\`\`\`\n\n### 3-2. ${G?'デプロイ設定':'Deploy Config'}\n\`\`\`\n${G?deployTarget+'へのデプロイ設定を行ってください。':'Configure deployment to '+deployTarget+'.'}\n- CI/CD: GitHub Actions\n
- ${G?'環境変数: .env.exampleに基づいて設定':'Env vars: Based on .env.example'}\n- ${G?'プレビューデプロイの設定も含めてください。':'Include preview deploy config.'}\n\`\`\`\n\n### 3-3. ${G?'セキュリティ監査':'Security Audit'}\n\`\`\`\n**Role**: ${G?'セキュリティエンジニア':'Security Engineer'}\n\n${G?'以下のセキュリティドキュメントを参照し、プロジェクトのセキュリティ監査を実施してください:':'Reference these security documents and audit the project:'}\n- docs/43_security_intelligence.md (OWASP Top 10)\n- docs/44_threat_model.md (STRIDE)\n- docs/45_compliance_matrix.md\n- docs/46_ai_security.md (${G?'敵対的プロンプト使用':'Use adversarial prompts'})\n- docs/47_security_testing.md (${G?'テスト実行':'Execute tests'})\n\n${G?'重点チェック:':'Focus areas:'}\n1. ${G?'認可ロジック (RLS/ミドルウェア)':'Authorization logic (RLS/middleware)'}\n2. ${G?'入力バリデーション':'Input validation'}\n3. ${G?'シークレット管理':'Secrets management'}\n\`\`\`\n\n## Phase 4: ${G?'イテレーション':'Iteration'}\n\n### 4-1. ${G?'バグ修正':'Bug Fix'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'デバッガー兼フルスタック開発者':'Debugger & Full-stack developer'}\n\n${G?'以下のエラーを修正してください。':'Fix the following error.'}\n\n[${G?'エラー内容を貼り付け':'Paste error here'}]\n\n${G?'手順':'Steps'}:\n1. docs/25_error_logs.md ${G?'を参照し、既知の問題か確認':'to check if it is a known issue'}\n2. ${G?'根本原因を特定':'Identify root cause'}\n3. ${G?'修正とテストを実装':'Implement fix and tests'}\n4. docs/25_error_logs.md ${G?'にエラーを記録':'to log the error'}\n\n**${G?'出力形式':'Output Format'}**: ${G?'修正パッチ (diff形式) + テスト + ログエントリ':'Fix patch (diff) + tests + log entry'}\n\`\`\`\n\n### 4-2. ${G?'機能追加':'Feature Addition'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'フルスタック開発者':'Full-stack developer'}\n\n${G?'以下の機能を追加してください。':'Add the following feature.'}\n\n[${G?'機能説明を記載':'Describe feature here'}]\n\n${G?'手順':'Steps'}:\n1. docs/23_tasks.md ${G?'を参照し、タスクを追加':'to add task'}\n2. .spec/constitution.md ${G?'の原則に準拠':'principles'}\n3. ${G?'コード + テストを実装':'Implement code + tests'}\n4. docs/24_progress.md ${G?'を更新':'to update progress'}\n\n**${G?'出力形式':'Output Format'}**: ${G?'ファイルパス付きコードブロック + タスクエントリ + 進捗更新':'Code blocks with file paths + task entry + progress update'}\n\`\`\`\n\n### 4-3. ${G?'品質チェック':'Quality Check'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'QAエンジニア':'QA Engineer'}\n\n${G?'品質チェック:':'Quality check:'}\n- docs/32_qa_blueprint.md ${G?'の品質ゲートを実施':'quality gates'}\n- docs/28_qa_strategy.md ${G?'のドメイン別バグパターンを確認':'domain-specific bug patterns'}\n\`\`\`\n\n### 4-4. ${G?'パフォーマンス検証':'Performance Check'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'パフォーマンスエンジニア':'Performance Engineer'}\n\n${G?'パフォーマンス検証:':'Performance check:'}\n- docs/41_growth_intelligence.md ${G?'のCWV目標値と照合':'CWV targets'}\n- docs/19_performance.md ${G?'の最適化施策を適用':'optimization strategies'}\n\`\`\``;
// Task decomposition (D1: GitHub Issues style)
const taskList=[];
taskList.push({title:G?'環境構築':'Environment Setup',label:'setup',hours:3,desc:G?`${fe} + ${be} + ${dbName} のプロジェクト初期セットアップ`:`${fe} + ${be} + ${dbName} initial project setup`});
taskList.push({title:G?'DevContainer設定':'DevContainer Config',label:'infra',hours:2,desc:G?'開発環境のコンテナ化':'Containerize dev environment'});
features.forEach(f=>{
const h=f.match(/Auth|認証/i)?16:f.match(/Admin|管理/i)?12:f.match(/Upload|ファイル/i)?8:f.match(/CRUD|一覧/i)?6:8;
taskList.push({title:G?f+'の実装':f+' Implementation',label:'feature',hours:h,desc:G?`${f}のAPI・UI・テストを実装`:`Implement API, UI, and tests for ${f}`});
});
taskList.push({title:G?'E2Eテスト':'E2E Tests',label:'test',hours:6,desc:G?'Playwrightでの統合テスト':'Integration tests with Playwright'});
taskList.push({title:G?'パフォーマンス最適化':'Performance Optimization',label:'perf',hours:4,desc:G?'Lighthouse 90+目標':'Lighthouse 90+ target'});
taskList.push({title:G?'リリース準備':'Release Prep',label:'release',hours:3,desc:G?`${deployTarget}へのデプロイ・モニタリング設定`:`Deploy to ${deployTarget} & monitoring setup`});
S.files['docs/23_tasks.md']=`# ${pn} — ${G?'タスク一覧 (GitHub Issues形式)':'Task List (GitHub Issues)'}\n> ${date}\n\n${taskList.map((t,i)=>{
// Feature tasks: use domain-specific acceptance criteria from FEATURE_DETAILS
let acLines;
if(t.label==='feature'){
const featureName=t.title.replace(/(の実装| Implementation)/g,'');
const fd=getFeatureDetail(featureName);
if(fd){
const criteria=(G?fd.criteria_ja:fd.criteria_en).map(c=>c.replace(/\{auth\}/g,a.auth||'OAuth'));
acLines=criteria.map(c=>'  - [ ] '+c).join('\n');
}
}
if(!acLines){
acLines=`  - [ ] ${G?'実装完了':'Implementation done'}\n  - [ ] ${G?'テスト通過':'Tests passing'}\n  - [ ] ${G?'コードレビュー完了':'Code review done'}`;
}
return `## Issue #${i+1}: ${t.title}\n- **${G?'ラベル':'Label'}**: \`${t.label}\`\n- **${G?'見積り':'Estimate'}**: ${t.hours}h\n- **${G?'説明':'Description'}**: ${t.desc}\n- **Acceptance Criteria**:\n${acLines}`;
}).join('\n\n')}\n\n---\n
**${G?'合計タスク数':'Total Tasks'}**: ${taskList.length} | **${G?'総見積り':'Total Est.'}**: ${taskList.reduce((s,t)=>s+t.hours,0)}h`;
const cspExamples=fe.includes('Next')?`**Next.js** (next.config.js):
\`\`\`js
module.exports = {
async headers() {
return [{
source: '/(.*)',
headers: [{
key: 'Content-Security-Policy',
value: "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https:; connect-src 'self' https://*.supabase.co; object-src 'none'; base-uri 'self';"
}]
}];
}
};
\`\`\``:`**Express.js** (helmet):
\`\`\`js
const helmet = require('helmet');
app.use(helmet.contentSecurityPolicy({
directives: {
defaultSrc: ["'self'"],
scriptSrc: ["'self'"],
styleSrc: ["'self'", "'unsafe-inline'"],
imgSrc: ["'self'", "data:", "https:"],
connectSrc: ["'self'"],
objectSrc: ["'none'"],
baseUri: ["'self'"]
}
}));
\`\`\``;
const corsExamples=fe.includes('Next')?`**Next.js API Routes**:
\`\`\`js
export default function handler(req, res) {
res.setHeader('Access-Control-Allow-Origin', process.env.ALLOWED_ORIGINS || '*');
res.setHeader('Access-Control-Allow-Methods', 'GET,POST,PUT,PATCH,DELETE');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type,Authorization');
if (req.method === 'OPTIONS') return res.status(200).end();
// ... handler logic
}
\`\`\``:`**Express.js** (cors):
\`\`\`js
const cors = require('cors');
const corsOptions = {
origin: process.env.ALLOWED_ORIGINS?.split(',') || '*',
credentials: true,
optionsSuccessStatus: 200
};
app.use(cors(corsOptions));
\`\`\``;
const rateLimitExamples=fe.includes('Next')?`**Next.js** (upstash/ratelimit):
\`\`\`js
import { Ratelimit } from '@upstash/ratelimit';
import { Redis } from '@upstash/redis';
const ratelimit = new Ratelimit({
redis: Redis.fromEnv(),
limiter: Ratelimit.slidingWindow(10, '10 s')
});
export default async function handler(req, res) {
const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress;
const { success } = await ratelimit.limit(ip);
if (!success) return res.status(429).json({ error: 'Too many requests' });
// ... handler logic
}
\`\`\``:`**Express.js** (express-rate-limit):
\`\`\`js
const rateLimit = require('express-rate-limit');
const limiter = rateLimit({
windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS) || 60000,
max: parseInt(process.env.RATE_LIMIT_MAX) || 100,
message: 'Too many requests from this IP',
standardHeaders: true,
legacyHeaders: false
});
app.use('/api/', limiter);
\`\`\``;
const docTemplates=[
['05_api_design',G?(arch.isBaaS?'データアクセス設計書 (SDK)':'API設計書 (OpenAPI準拠)'):(arch.isBaaS?'Data Access Design (SDK)':'API Design (OpenAPI)'),`${G?'## 認証':'## Authentication'}\n- ${G?'方式':'Method'}: ${auth.tokenType}\n- ${arch.isBaaS?(G?'アクセス方式: '+orm+' SDK':'Access: '+orm+' SDK'):'ヘッダー: \\`Authorization: Bearer <token>\\`'}\n\n${arch.isBaaS?'':(G?'## 共通レスポンス':'## Common Responses')+'\\n| '+(G?'ステータス':'Status')+' | '+(G?'意味':'Meaning')+' |\\n|-----------|------|\\n| 200 | OK |\\n| 201 | Created |\\n| 400 | Bad Request |\\n| 401 | Unauthorized |\\n| 403 | Forbidden |\\n| 404 | Not Found |\\n| 422 | Validation Error |\\n| 500 | Internal Error |\\n\\n'}\n${G?(arch.isBaaS?'## データアクセスパターン':'## エンドポイント一覧'):(arch.isBaaS?'## Data Access Patterns':'## Endpoints')}\n${apiEndpoints}`],
['06_screen_design',G?'画面設計書 & 画面遷移図':'Screen Design & Flow',`${G?'## 画面遷移図':'## Screen Flow'}\n\n\`\`\`mermaid\nflowchart LR\n${sNodes}\n${sLinks.join('\n')}\n\`\`\`\n\n${G?'## 画面一覧':'## Screen List'}\n${screens.map((s,i)=>{const isPublic=s.match(/ログイン|Login|Register|登録|ランディング|Landing|LP|トップ|Top|ホーム|Home|About|概要|利用規約|Terms|料金|Pricing|お問い合わせ|Contact/i);const comps=getScreenComponents(s,G);const compList=comps?'\n- '+(G?'主要コンポーネント':'Key Components')+':\n'+comps.map(c=>'  - '+c).join('\n'):'\n- '+(G?'コンポーネント':'Components')+': Header, '+(isPublic?'':'Sidebar, ')+'Content, Footer';return `\n### ${i+1}. ${s}\n- URL: \`${(genRoutes(a).find(r=>r.name===s.replace(/\(P[0-2]\)/gi,'').trim())||{path:'/'+(s.toLowerCase().replace(/[^a-z0-9]/g,'-'))}).path}\`\n- ${G?'認証':'Auth'}: ${isPublic?(G?'不要':'Not required'):(G?'必要':'Required')}${compList}`;}).join('\n')}`],
['07_test_cases',G?'テストケース定義書':'Test Cases',`${G?'## テスト戦略':'## Test Strategy'}\n- ${G?'ユニット':'Unit'}: Vitest (80%+)\n- E2E: Playwright\n- ${G?'コンポーネント':'Component'}: Testing Library\n\n${G?'## テストケースマトリクス':'## Test Case Matrix'}\n${testMatrix}\n\n${G?'## 実行コマンド':'## Run Commands'}\n\`\`\`bash\nnpm run test\nnpm run test:e2e\nnpm run test:coverage\n\`\`\``],
['08_security',G?'セキュリティ設計書':'Security Design',`${G?'## セキュリティ対策':'## Security Measures'}\n- ${G?'認証':'Auth'}: ${auth.sot}\n- HTTPS${G?'必須':' required'}\n- CSP (Content Security Policy)\n- CORS (Cross-Origin Resource Sharing)\n- Rate Limiting\n- Input Validation${hasAdmin?'\n\n'+(G?'## RBAC（ロールベースアクセス制御）':'## RBAC (Role-Based Access Control)')+'\n\n| '+(G?'ロール':'Role')+' | '+(G?'権限':'Permissions')+' |\n|--------|----------|\n| user | '+(G?'自分のデータの読取・更新':'Read/update own data')+' |\n'+(hasInstructor?'| instructor | '+(G?'コンテンツ作成・編集・自分の受講者管理':'Create/edit content, manage own students')+' |\n':'')+'| admin | '+(G?'全データの読取・更新・削除、ユーザー管理、システム設定':'Full CRUD, user management, system settings')+' |\n\n'+(G?'### RBACポリシー実装':'### RBAC Policy Implementation')+'\n- profiles.role '+(G?'カラムでロール管理':'column for role management')+'\n- '+(arch.isBaaS&&be.includes('Supabase')?'RLS: auth.uid() = user_id AND role check via profiles':'Middleware: role check before protected routes')+'\n- '+(G?'管理画面ルート':'Admin routes')+': /admin/ → role=admin '+(G?'チェック必須':'check required'):''}${hasPay&&(a.payment||'').includes('Stripe')?'\n\n'+(G?'## 決済セキュリティ':'## Payment Security')+'\n- Stripe Webhook '+(G?'署名検証':'signature verification')+' (STRIPE_WEBHOOK_SECRET)\n- '+(G?'冪等キーによる重複処理防止':'Idempotency key for duplicate prevention')+'\n- PCI DSS '+(G?'準拠':'compliance')+' (Stripe Elements '+(G?'使用で対応':'handles this')+')\n- '+(G?'サーバーサイドのみで':'Server-side only for')+' stripe.customers / stripe.subscriptions '+(G?'操作':'operations'):''}\n\n${G?'## CSPヘッダー設定例':'## CSP Header Examples'}\n\n${cspExamples}\n\n${G?'## CORS設定例':'## CORS Configuration Examples'}\n\n${corsExamples}\n\n${G?'## レート制限実装例':'## Rate Limiting Implementation'}\n\n${rateLimitExamples}`],
['09_release_checklist',G?'リリースチェックリスト':'Release Checklist',`## ${G?'デプロイ先':'Deploy Target'}: ${deployTarget}\n\n### 1. ${G?'コード品質':'Code Quality'}\n${(G?['TypeScript 型エラー 0件','ESLint エラー 0件','全テストパス','カバレッジ 80%+']:['TypeScript: 0 type errors','ESLint: 0 errors','All tests pass','Coverage 80%+']).map(c=>'- [ ] '+c).join('\n')}\n\n### 2. ${G?'セキュリティ':'Security'}\n
${(G?['環境変数にシークレット未ハードコード','CORS設定','CSP設定','認証・認可テスト完了']:['No hardcoded secrets in env vars','CORS config','CSP config','Auth/authz tests done']).map(c=>'- [ ] '+c).join('\n')}\n\n### 3. ${G?'インフラ':'Infrastructure'} (${deployTarget})\n${deployChecks.map(c=>'- [ ] '+c).join('\n')}\n\n### 4. ${G?'データベース':'Database'} (${dbName})\n${dbChecks.map(c=>'- [ ] '+c).join('\n')}\n\n### 5. ${G?'パフォーマンス':'Performance'}\n
${(G?['Lighthouse 90+','LCP < 2.5s','画像最適化','バンドルサイズ確認']:['Lighthouse 90+','LCP < 2.5s','Image optimization','Bundle size check']).map(c=>'- [ ] '+c).join('\n')}\n\n### 6. ${G?'モニタリング':'Monitoring'}\n${(G?['Sentry設定','アクセスログ','アラート閾値']:['Sentry setup','Access logs','Alert thresholds']).map(c=>'- [ ] '+c).join('\n')}`],
['10_gantt',G?'ガントチャート':'Gantt Chart',`${G?'## プロジェクトスケジュール':'## Project Schedule'}\n\n\`\`\`mermaid\ngantt\n  title ${pn} ${G?'開発スケジュール':'Development Schedule'}\n  dateFormat YYYY-MM-DD\n  axisFormat %m/%d\n  section Sprint 0\n  ${G?'プロジェクトセットアップ':'Project Setup'} :env, ${ganttStart}, 2d\n  ${G?'DevContainer構築':'DevContainer Setup'} :dc, after env, 1d\n  ${G?'CI/CD設定':'CI/CD Setup'} :ci, after dc, 1d\n  section Sprint 1-2\n${ganttTasks}\n  section Sprint 3\n
${G?'E2Eテスト':'E2E Tests'} :test, after s${features.length-1}, 3d\n  ${G?'パフォーマンス最適化':'Perf Optimization'} :perf, after test, 2d\n  ${G?'リリース':'Release'} :rel, after perf, 1d\n\`\`\`\n\n${G?'## マイルストーン':'## Milestones'}\n| MS | ${G?'目標':'Goal'} | ${G?'成果物':'Deliverable'} |\n|----|------|--------|\n| Alpha | Sprint 1 ${G?'完了':'done'} | ${G?'コア機能動作':'Core features working'} |\n| Beta | Sprint 2 ${G?'完了':'done'} | ${G?'全機能実装':'All features implemented'} |\n
| RC | Sprint 3 ${G?'中盤':'mid'} | ${G?'テスト完了':'Tests complete'} |\n| GA | Sprint 3 ${G?'末':'end'} | ${G?'本番リリース':'Production release'} |`],
['11_wbs',G?'WBS (作業分解構造)':'WBS (Work Breakdown)',`${G?'## WBS — 総工数:':'## WBS — Total Hours:'} 約${totalH+26}h\n\n### 1. ${G?'プロジェクト管理':'Project Management'} (8h)\n- 1.1 ${G?'要件定義・SDD作成':'Requirements & SDD'} (3h)\n- 1.2 ${G?'技術選定・環境構築':'Tech selection & setup'} (3h)\n- 1.3 ${G?'進捗管理・レビュー':'Progress mgmt & review'} (2h)\n\n## 2. ${G?'機能開発':'Feature Development'} (${totalH}h)\n\n${wbsTasks}\n\n### 3. ${G?'テスト':'Testing'} (12h)\n- 3.1 ${G?'ユニットテスト':'Unit tests'} (4h)\n
- 3.2 ${G?'E2Eテスト':'E2E tests'} (4h)\n- 3.3 ${G?'バグ修正':'Bug fixes'} (4h)\n\n### 4. ${G?'デプロイ':'Deploy'} (6h)\n- 4.1 ${G?'ステージング構築':'Staging setup'} (2h)\n- 4.2 ${G?'本番デプロイ':'Production deploy'} (2h)\n- 4.3 ${G?'モニタリング設定':'Monitoring setup'} (2h)`],
['12_driven_dev',G?'駆動開発ガイド':'Dev Methods Guide',`${G?'## 採用手法':'## Methods Used'}\n${methods.map(m=>`\n### ${m}\n- ${G?'適用範囲: 全Sprint':'Scope: All sprints'}\n- ${G?'実践ルール: .spec/ に準拠':'Rule: Follow .spec/'}`).join('\n')}`],
['13_glossary',G?'用語集':'Glossary',`${G?'## 用語定義':'## Terms'}\n${entities.map(e=>`| ${e} | ${G?pn+'における'+e+'データ':e+' data in '+pn} |`).join('\n')}`],
['14_risk',G?'リスク管理表':'Risk Management',`${G?'## リスク一覧':'## Risk List'}\n| ${G?'リスク':'Risk'} | ${G?'影響度':'Impact'} | ${G?'対策':'Mitigation'} |\n|--------|--------|------|\n| ${G?'技術的負債':'Tech debt'} | ${G?'高':'High'} | ${G?'コードレビュー必須':'Mandatory code review'} |\n| ${G?'スケジュール遅延':'Schedule delay'} | ${G?'中':'Mid'} | ${G?'バッファ設定':'Buffer planning'} |\n| ${G?'セキュリティ':'Security'} | ${G?'高':'High'} | ${G?'定期監査':'Regular audit'} |`],
['15_meeting',G?'議事録テンプレート':'Meeting Notes Template',`${G?'## 議事録':'## Meeting Notes'}\n- ${G?'日時':'Date'}:\n- ${G?'参加者':'Attendees'}:\n- ${G?'アジェンダ':'Agenda'}:\n- ${G?'決定事項':'Decisions'}:\n- ${G?'次回アクション':'Next Actions'}:`],
['16_review',G?'コードレビューガイド':'Code Review Guide',`${G?'## レビュー基準':'## Review Criteria'}\n1. TypeScript strict ${G?'モード準拠':'mode'}\n2. ${G?'テスト付き':'With tests'}\n3. ${G?'.spec/ との整合性':'.spec/ alignment'}\n4. ${G?'パフォーマンス考慮':'Performance'}\n5. ${G?'セキュリティチェック':'Security check'}`],
['17_monitoring',G?'監視設計書':'Monitoring Design',`${G?'## 監視項目':'## Monitoring Items'}\n- ${G?'アプリケーションログ':'Application logs'}\n- ${G?'エラーレート':'Error rate'}\n- ${G?'レスポンスタイム':'Response time'}\n- CPU/${G?'メモリ使用率':'Memory usage'}\n\n${G?'## ツール':'## Tools'}\n- ${deployTarget.includes('Vercel')?'Vercel Analytics':deployTarget.includes('Netlify')?'Netlify Analytics':'PostHog / Plausible Analytics'}\n- Sentry (${G?'エラー追跡':'Error tracking'})${arch.isBaaS&&be.includes('Supabase')?'\n- Supabase Dashboard ('+( G?'DB監視・RLS監査':'DB monitoring & RLS audit')+')':''}`],
['18_data_migration',G?'データ移行計画書':'Data Migration Plan',`${G?'## 移行戦略':'## Migration Strategy'}\n- ${G?'段階的移行':'Phased migration'}\n- ${G?'ロールバック計画':'Rollback plan'}\n- ${G?'データ検証手順':'Data validation'}`],
['19_performance',G?'パフォーマンス設計書':'Performance Design',`${G?'## 目標値':'## Targets'}\n- LCP: < 2.5s\n- FID: < 100ms\n- CLS: < 0.1\n\n${G?'## 最適化施策':'## Optimizations'}\n- ${G?'画像最適化':'Image optimization'} (${fe.includes('Next')?'next/image':fe.includes('Vite')||fe.includes('SPA')?'vite-imagetools / sharp':'sharp / imagemin'})\n- Code Splitting${fe.includes('Vite')||fe.includes('SPA')?' (Vite dynamic import)':fe.includes('Next')?' (Next.js dynamic)':''}\n- ${deployTarget.includes('Vercel')||deployTarget.includes('Netlify')?'Edge Caching (CDN)':'CDN Caching'}`],
['20_a11y',G?'アクセシビリティ設計書':'Accessibility Design',`## WCAG 2.1 AA\n- ${G?'キーボードナビゲーション':'Keyboard navigation'}\n- ${G?'スクリーンリーダー対応':'Screen reader support'}\n- ${G?'カラーコントラスト比':'Color contrast ratio'} 4.5:1+\n- ${G?'フォーカス管理':'Focus management'}`],
['21_changelog',G?'変更履歴':'Changelog',`## v1.0.0 (${date})\n- ${G?'初期リリース':'Initial release'}\n- ${features.slice(0,3).join(', ')} 実装\n\n## ${G?'DevForge v9による自動生成':'Auto-generated by DevForge v9'}\n- ${G?'114+ファイル生成':'114+ files generated'}\n- ${G?'15の柱対応':'15 pillars support'}\n- ${G?'Mermaid図・プロンプトプレイブック・タスク分解対応':'Mermaid diagrams, Prompt Playbook, Task decomposition'}`],
['24_progress',G?'進捗管理表':'Progress Tracker',
`${G?'> AIエージェントはタスク完了後にこのファイルを更新してください。':
'> AI agents should update this file after completing each task.'}
## ${G?'凡例':'Legend'}
- [ ] ${G?'未着手':'Not started'} / [x] ${G?'完了':'Done'}
## Sprint 0: ${G?'環境構築':'Setup'}
- [ ] ${G?'リポジトリ初期化':'Repo init'}
- [ ] DevContainer ${G?'構築':'setup'}
- [ ] CI/CD
- [ ] ${G?'DBスキーマ':'DB schema'}
- [ ] ${G?'認証基盤':'Auth'} (${auth.sot})
## Sprint 1-2: ${G?'機能開発':'Features'}
${features.map(f=>'- [ ] '+f).join('\n')}
## Sprint 3: ${G?'テスト・リリース':'Test & Release'}
- [ ] ${G?'テスト 80%+':'Tests 80%+'}
- [ ] E2E
- [ ] ${G?'パフォーマンス最適化':'Perf optimization'}
- [ ] ${G?'本番デプロイ':'Production deploy'}
## ${G?'サマリー':'Summary'}
| ${G?'フェーズ':'Phase'} | ${G?'完了':'Done'} | ${G?'合計':'Total'} |
|---|---|---|
| Sprint 0 | 0 | 5 |
| Sprint 1-2 | 0 | ${features.length} |
| Sprint 3 | 0 | 4 |
## ${G?'更新履歴':'Log'}
| ${G?'日付':'Date'} | ${G?'内容':'Update'} | ${G?'更新者':'By'} |
|---|---|---|
| ${date} | ${G?'初期生成':'Initial'} | DevForge |`],
['25_error_logs',G?'エラーログ':'Error Logs',
`${G?'> 解決済みエラーをここに記録し、再発を防いでください。':
'> Log resolved errors here to prevent recurrence.'}
## ${G?'記録フォーマット':'Format'}
### [${G?'日付':'Date'}] ${G?'エラー概要':'Summary'}
- **${G?'症状':'Symptom'}**:
- **${G?'原因':'Cause'}**:
- **${G?'解決策':'Fix'}**:
- **${G?'防止策':'Prevention'}**:
- **${G?'ファイル':'Files'}**: \`path/to/file\`
---
## ${G?'記録例':'Example'}
### [${date}] ${arch.isBaaS?(G?'RLSポリシーエラー':'RLS Policy Error'):(G?'API認証エラー':'API Auth Error')}
- **${G?'症状':'Symptom'}**: ${arch.isBaaS?(G?'INSERT時に403':'403 on INSERT'):(G?'401 Unauthorized':'401 Unauthorized')}
- **${G?'原因':'Cause'}**: ${arch.isBaaS?(G?'auth.uid()チェック不足':'Missing auth.uid() check'):(G?'トークン検証ミドルウェア未適用':'Missing auth middleware')}
- **${G?'解決策':'Fix'}**: ${arch.isBaaS?'\\`WITH CHECK (auth.uid() = user_id)\\`':'\\`app.use(authMiddleware)\\`'}
- **${G?'防止策':'Prevention'}**: ${arch.isBaaS?(G?'新テーブルには必ずRLSテンプレート適用':'Always apply RLS template for new tables'):(G?'新ルートには必ずauthMiddleware適用':'Always apply authMiddleware to new routes')}
---
## ${G?'パターン別':'By Pattern'}
### ${G?'認証・認可':'Auth'}
_(${G?'追記してください':'Add entries here'})_
### ${G?'データベース':'Database'}
_(${G?'追記してください':'Add entries here'})_
### ${G?'デプロイ':'Deploy'}
_(${G?'追記してください':'Add entries here'})_`],
['28_qa_strategy',G?'QA戦略・バグ検出ガイド':'QA Strategy & Bug Detection Guide',(()=>{
const domain=detectDomain(a.purpose||'');
const qa=domain?getDomainQA(domain,G):null;
if(qa){
const priObj={};qa.priority.split('|').forEach(p=>{const[k,v]=p.split(':');priObj[k]=v;});
return `${G?'## 対象ドメイン':'## Target Domain'}\n**${domain}**\n\n${G?'💡 **詳細なQA戦略は `docs/32_qa_blueprint.md` と `docs/33_test_matrix.md` を参照**':'💡 **See `docs/32_qa_blueprint.md` and `docs/33_test_matrix.md` for detailed QA strategies**'}\n\n${G?'## QA重点領域':'## QA Focus Areas'}\n${qa.focus.map((f,i)=>`${i+1}. ${f}`).join('\n')}\n\n${G?'## よくあるバグパターン':'## Common Bug Patterns'}\n${qa.bugs.map((b,i)=>`- **${G?'パターン':'Pattern'} ${i+1}**: ${b}`).join('\n')}\n\n${G?'## 業界横断チェックリスト':'## Cross-Cutting Checklist'}\n${qa.crossCutting.length>0?qa.crossCutting.map((c,i)=>`${i+1}. ${c}`).join('\n'):(G?'該当なし':'None applicable')}\n\n${G?'## 優先度マトリクス':'## Priority Matrix'}\n| ${G?'カテゴリ':'Category'} | ${G?'優先度':'Priority'} |\n|----------|----------|\n| ${G?'セキュリティ':'Security'} | ${priObj.Security||'MED'} |\n| ${G?'パフォーマンス':'Performance'} | ${priObj.Performance||'MED'} |\n| ${G?'データ整合性':'Data Integrity'} | ${priObj.DataIntegrity||'MED'} |\n| UX | ${priObj.UX||'MED'} |\n| ${G?'コンプライアンス':'Compliance'} | ${priObj.Compliance||'LOW'} |\n\n${G?'## テスト実行順序':'## Test Execution Order'}\n${G?'優先度に基づいた推奨実行順序:':'Recommended execution order by priority:'}\n1. ${priObj.Security==='CRITICAL'||priObj.DataIntegrity==='CRITICAL'?(G?'セキュリティ・データ整合性テスト':'Security & Data Integrity tests'):priObj.UX==='CRITICAL'?(G?'UXテスト':'UX tests'):(G?'パフォーマンステスト':'Performance tests')}\n2. ${priObj.Performance==='HIGH'||priObj.Security==='HIGH'?(G?'パフォーマンス・セキュリティテスト':'Performance & Security tests'):(G?'機能テスト':'Functional tests')}\n3. ${G?'統合テスト':'Integration tests'}\n4. ${G?'回帰テスト':'Regression tests'}\n\n${G?'## 参考リソース':'## References'}\n- ${G?'詳細QAブループリント':'Detailed QA Blueprint'}: docs/32_qa_blueprint.md\n- ${G?'具体的テストマトリクス':'Concrete Test Matrix'}: docs/33_test_matrix.md\n- OWASP Top 10: https://owasp.org/www-project-top-ten/\n- ${domain==='education'?'FERPA Compliance':domain==='health'?'HIPAA Compliance':domain==='fintech'?'PCI DSS Compliance':domain==='hr'?'GDPR/CCPA Compliance':domain==='saas'?'SOC 2 Compliance':'Industry Best Practices'}`;
}
return `${G?'## 汎用QAチェックリスト':'## Generic QA Checklist'}\n\n${G?'ドメイン未検出のため、汎用的なQA項目を記載します。':'Domain not detected. Generic QA items listed below.'}\n\n### ${G?'機能テスト':'Functional Testing'}\n- [ ] ${G?'全機能の正常系動作確認':'Verify all features work (happy path)'}\n- [ ] ${G?'エラーハンドリング検証':'Error handling validation'}\n- [ ] ${G?'境界値テスト':'Boundary value testing'}\n\n### ${G?'セキュリティ':'Security'}\n- [ ] ${G?'認証・認可テスト':'Auth/authz testing'}\n- [ ] ${G?'入力バリデーション':'Input validation'}\n- [ ] XSS/CSRF ${G?'対策確認':'prevention check'}\n- [ ] ${G?'機密情報の漏洩チェック':'Sensitive data leakage check'}\n\n### ${G?'パフォーマンス':'Performance'}\n- [ ] ${G?'レスポンスタイム測定':'Response time measurement'}\n- [ ] ${G?'高負荷テスト':'Load testing'}\n- [ ] ${G?'メモリリーク検出':'Memory leak detection'}\n\n### ${G?'互換性':'Compatibility'}\n- [ ] ${G?'ブラウザ別動作確認':'Cross-browser testing'}\n- [ ] ${G?'モバイル対応確認':'Mobile responsiveness'}\n- [ ] ${G?'アクセシビリティ (WCAG)':'Accessibility (WCAG)'}\n\n### ${G?'データ整合性':'Data Integrity'}\n- [ ] ${G?'トランザクション完全性':'Transaction integrity'}\n- [ ] ${G?'データ同期確認':'Data sync validation'}\n- [ ] ${G?'バックアップ・リストア検証':'Backup/restore verification'}`;
})()],
['31_industry_playbook',G?'業種別実装プレイブック':'Industry Implementation Playbook',(()=>{
const domain=detectDomain(a.purpose)||'_default';
const pb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
const qa=domain!=='_default'?getDomainQA(domain,G):null;
const rf=REVERSE_FLOW_MAP[domain]||REVERSE_FLOW_MAP._default;
let s=`${G?'## 🎯 対象ドメイン':'## 🎯 Target Domain'}\n**${domain}**${domain==='_default'?(G?' (汎用)':' (generic)'):''}\n\n${G?'## 📐 実装レベル・リバースフロー':'## 📐 Implementation-Level Reverse Flow'}\n${G?'ゴールから逆算した具体的な実装パターン:':'Concrete implementation patterns reverse-engineered from goals:'}\n\n${(G?pb.impl_ja:pb.impl_en).map((p,i)=>`${i+1}. ${p}`).join('\n\n')}\n\n`;
if(qa){
const priObj={};qa.priority.split('|').forEach(p=>{const[k,v]=p.split(':');priObj[k]=v;});
s+=`${G?'## 🧪 QA優先度マトリクス':'## 🧪 QA Priority Matrix'}\n| ${G?'カテゴリ':'Category'} | ${G?'優先度':'Priority'} |\n|----------|----------|\n| ${G?'セキュリティ':'Security'} | ${priObj.Security||'MED'} |\n| ${G?'パフォーマンス':'Performance'} | ${priObj.Performance||'MED'} |\n| ${G?'データ整合性':'Data Integrity'} | ${priObj.DataIntegrity||'MED'} |\n| UX | ${priObj.UX||'MED'} |\n| ${G?'コンプライアンス':'Compliance'} | ${priObj.Compliance||'LOW'} |\n\n${G?'**重点領域**:':'**Focus Areas**:'}\n${qa.focus.map((f,i)=>`- ${f}`).join('\n')}\n\n`;
}
s+=`${G?'## 🐛 予測バグTOP3と予防策':'## 🐛 Top 3 Predicted Bugs & Prevention'}\n${G?'この業種で最も発生しやすいバグと対策:':'Most common bugs in this industry and countermeasures:'}\n\n${(G?pb.prevent_ja:pb.prevent_en).map((p,i)=>{const[bug,fix]=p.split('|');return `### ${i+1}. ${bug}\n${fix}`;}).join('\n\n')}\n\n${G?'## 📜 コンプライアンス・チェックリスト':'## 📜 Compliance Checklist'}\n${(G?pb.compliance_ja:pb.compliance_en).map((c,i)=>`- [ ] ${c}`).join('\n')}\n\n${G?'## 🧠 コンテキスト・エンジニアリング・プロトコル':'## 🧠 Context Engineering Protocol'}\n${G?'タスクごとに読むべきドキュメント:':'Documents to read per task type:'}\n\n| ${G?'タスク種別':'Task Type'} | ${G?'参照ドキュメント':'Reference Documents'} |\n|----------|----------|\n${(G?pb.ctx_ja:pb.ctx_en).map(c=>{const[task,docs]=c.split('→');return `| ${task} | ${docs} |`;}).join('\n')}\n\n${G?'## 🎨 カスタムスキル設計図':'## 🎨 Custom Skill Blueprint'}\n${G?'この業種に特化したAIスキル定義:':'Domain-specific AI skill definition:'}\n\n`;
const skillStr=G?pb.skill_ja:pb.skill_en;
if(skillStr&&typeof skillStr==='string'&&skillStr!==''){
const skill=skillStr.split('|');
s+=`**${G?'役割':'Role'}**: ${skill[0]}\n\n**${G?'目的':'Purpose'}**: ${skill[1]}\n\n**${G?'入力':'Input'}**: ${skill[2]}\n\n**${G?'判断基準':'Judgment Criteria'}**: ${skill[3]}\n\n**${G?'出力':'Output'}**: ${skill[4]}\n\n`;
}
s+=`${G?'## 🔄 コンテキスト・ローテーション戦略':'## 🔄 Context Rotation Strategy'}\n\n${G?'**4原則** (コンテキストウィンドウを溢れさせない方法):':'**4 Principles** (how to prevent context window overflow):'}\n\n1. **Write (${G?'記述':'Documentation'})**: ${G?'脳内の仕様を `docs/` に書き出す。AIの外部記憶として機能。':'Write specifications from your mind into `docs/`. Functions as AI external memory.'}\n2. **Select (${G?'選択':'Selection'})**: ${G?'必要なファイルだけ読み込ませる。上記の「タスク別参照ドキュメント」を活用。':'Load only necessary files. Use "Documents per Task Type" table above.'}\n3. **Compress (${G?'圧縮':'Compression'})**: ${G?'履歴が肥大化したら要約し、エッセンスだけ残す。長い会話は定期的に圧縮。':'When history bloats, summarize and keep essence only. Compress long conversations periodically.'}\n4. **Isolate (${G?'分離':'Isolation'})**: ${G?'調査・実験はサブエージェント (Task tool) で実行。結論だけメインコンテキストに持ち帰る。':'Run research/experiments in sub-agents (Task tool). Bring back only conclusions to main context.'}\n\n${G?'## 📊 KPI参考値':'## 📊 KPI Reference Values'}\n${G?'この業種の典型的なKPI目標値:':'Typical KPI targets for this domain:'}\n\n${(G?rf.kpi_ja:rf.kpi_en).map((k,i)=>`- ${k}`).join('\n')}\n\n${G?'## 💡 推奨事項':'## 💡 Recommendations'}\n${G?'- 実装前に `docs/architecture.md` と `docs/design_system.md` を必ず読み、既存パターンに従う':'- Read `docs/architecture.md` and `docs/design_system.md` before implementation, follow existing patterns'}\n${G?'- バグ発生時は `docs/error_logs.md` に記録し、再発防止策を明記':'- When bugs occur, record in `docs/error_logs.md` with prevention strategies'}\n${G?'- 進捗は `docs/progress.md` を随時更新し、プロジェクトの現在地を明確化':'- Update `docs/progress.md` frequently to clarify project status'}\n${G?'- コンプライアンス要件は設計段階から考慮し、後付け対応を避ける':'- Consider compliance requirements from design phase, avoid retrofitting'}`;
return s;
})()],
];
docTemplates.forEach(([file,title,content])=>{
S.files[`docs/${file}.md`]=`# ${pn} — ${title}\n> ${date}\n\n${content}`;
});
// ═══ B2: docs/35_sitemap.md (~8KB) ═══
let doc35='# '+pn+' — '+(G?'サイトマップ・情報設計':'Sitemap & Information Architecture')+'\n\n';
doc35+=G?'**重要**: このドキュメントはアプリケーション全体のURL構造とナビゲーションパターンを定義します。新規ページ追加時は必ずこのサイトマップを更新してください。\n\n':'**IMPORTANT**: This document defines the URL structure and navigation patterns for the entire application. MUST update this sitemap when adding new pages.\n\n';
// Generate routes (reuse existing genRoutes function)
const allRoutes=genRoutes(a);
// URL Tree (Mermaid graph)
doc35+=(G?'## URLツリー':'## URL Tree')+'\n\n';
doc35+=(G?'**ルーティング構造の可視化**':'**Routing structure visualization**')+'\n\n';
doc35+='```mermaid\ngraph TD\n';
doc35+='  Root["/"]\n';
// Build tree nodes
const addedPaths=new Set(['Root']);
allRoutes.forEach((route,i)=>{
const path=route.path;
const parts=path.split('/').filter(Boolean);
let currentPath='Root';
parts.forEach((part,idx)=>{
const nodeName=part.replace(/[:\[\]]/g,'').replace(/-/g,'_')||'index';
const fullPath=currentPath+'_'+nodeName;
if(!addedPaths.has(fullPath)){
const label=part.replace(/[\[\]:]/g,'');
const style=route.auth?' --> |🔒|':' --> ';
doc35+='  '+currentPath+style+fullPath+'['+label+']\n';
addedPaths.add(fullPath);
}
currentPath=fullPath;
});
});
doc35+='```\n\n';
// Route-Screen-Component Mapping Table
doc35+=(G?'## Route-Screen-Component マッピング':'## Route-Screen-Component Mapping')+'\n\n';
doc35+='| '+(G?'ルート':'Route')+' | '+(G?'画面名':'Screen')+' | '+(G?'主要コンポーネント':'Key Components')+' | '+(G?'認証':'Auth')+' |\n';
doc35+='|------|------|------|------|\n';
allRoutes.forEach(route=>{
const screenName=route.name||route.path.split('/').pop()||'Index';
const components=getScreenComponents(screenName,G);
const componentList=components?components.slice(0,3).join(', '):(G?'（未定義）':'(Undefined)');
const authIcon=route.auth?'🔒':'🌐';
doc35+='| `'+route.path+'` | '+screenName+' | '+componentList+' | '+authIcon+' |\n';
});
doc35+='\n';
doc35+=(G?'**凡例**: 🔒 認証必須 | 🌐 公開':'**Legend**: 🔒 Auth required | 🌐 Public')+'\n\n';
// Navigation Patterns
doc35+=(G?'## ナビゲーションパターン':'## Navigation Patterns')+'\n\n';
// Primary Navigation
doc35+='### 1. '+(G?'プライマリナビゲーション':'Primary Navigation')+'\n\n';
doc35+=(G?'**位置**: ヘッダー or サイドバー':'**Location**: Header or Sidebar')+'\n\n';
const primaryRoutes=allRoutes.filter(r=>
!r.path.includes('[')&&!r.path.includes(':')&&r.path.split('/').filter(Boolean).length<=2
);
doc35+=(G?'推奨リンク:':'Recommended links:')+'\n';
primaryRoutes.slice(0,8).forEach(r=>{
doc35+='- `'+r.path+'` — '+r.name+(r.auth?' 🔒':'')+'\n';
});
doc35+='\n';
// Secondary Navigation
doc35+='### 2. '+(G?'セカンダリナビゲーション':'Secondary Navigation')+'\n\n';
doc35+=(G?'**位置**: サブメニュー or タブ':'**Location**: Submenu or Tabs')+'\n\n';
const secondaryRoutes=allRoutes.filter(r=>
r.path.split('/').filter(Boolean).length>=3&&!r.path.includes('[')&&!r.path.includes(':')
);
if(secondaryRoutes.length>0){
doc35+=(G?'サブセクション:':'Sub-sections:')+'\n';
secondaryRoutes.slice(0,5).forEach(r=>{
doc35+='- `'+r.path+'` — '+r.name+(r.auth?' 🔒':'')+'\n';
});
doc35+='\n';
}else{
doc35+=G?'（該当なし）\n\n':'(None)\n\n';
}
// Breadcrumb Navigation
doc35+='### 3. '+(G?'パンくずナビゲーション':'Breadcrumb Navigation')+'\n\n';
doc35+=(G?'**推奨実装**: 3階層以上のページで表示':'**Recommended**: Display for pages with ≥3 levels')+'\n\n';
const deepRoutes=allRoutes.filter(r=>r.path.split('/').filter(Boolean).length>=3);
if(deepRoutes.length>0){
const exampleRoute=deepRoutes[0];
const parts=exampleRoute.path.split('/').filter(Boolean);
let breadcrumb='Home';
parts.forEach((part,i)=>{
if(i<parts.length-1){
breadcrumb+=' > '+part.replace(/[:\[\]]/g,'');
}
});
breadcrumb+=' > '+exampleRoute.name;
doc35+=(G?'例: ':'Example: ')+'`'+breadcrumb+'`\n\n';
}else{
doc35+=G?'（該当ルートなし）\n\n':'(No applicable routes)\n\n';
}
// SEO Metadata Map
doc35+=(G?'## SEOメタデータマップ':'## SEO Metadata Map')+'\n\n';
doc35+='| '+(G?'ルート':'Route')+' | Title | Description | OG Image |\n';
doc35+='|------|------|------|------|\n';
allRoutes.slice(0,10).forEach(route=>{
const routeName=route.name||'Page';
const title=pn+' | '+routeName;
const desc=(a.purpose||'').substring(0,80)+'...';
const ogImage='/og-image.png';
doc35+='| `'+route.path+'` | '+title+' | '+desc+' | '+ogImage+' |\n';
});
doc35+='\n';
// URL Best Practices
doc35+=(G?'## URLベストプラクティス':'## URL Best Practices')+'\n\n';
doc35+='1. **'+(G?'小文字+ハイフン':'Lowercase + hyphens')+'**: `/user-profile` '+(G?'ではなく':'not')+' `/userProfile`\n';
doc35+='2. **'+(G?'複数形の一貫性':'Plural consistency')+'**: `/users/:id` '+(G?'（コレクションは複数形）':'(collections are plural)')+'\n';
doc35+='3. **'+(G?'RESTful命名':'RESTful naming')+'**: `/api/posts/:id/comments` '+(G?'（ネストでリソース関係を表現）':'(nested to show resource relationship)')+'\n';
doc35+='4. **'+(G?'クエリパラメータ':'Query params')+'**: `/search?q=keyword&sort=date` '+(G?'（フィルタ・ソートはクエリで）':'(filters/sorting in query)')+'\n\n';
// Related Documents
doc35+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc35+='- **docs/05_api_design.md** — '+(G?'APIエンドポイント詳細':'API endpoints detail')+'\n';
doc35+='- **docs/06_screen_design.md** — '+(G?'画面設計書':'Screen design')+'\n';
doc35+='- **docs/26_design_system.md** — '+(G?'デザインシステム':'Design system')+'\n';
doc35+='- **.spec/technical-plan.md** — '+(G?'技術計画':'Technical plan')+'\n\n';
S.files['docs/35_sitemap.md']=doc35;
// CI/CD Workflow YAML
const buildCmd=fe.includes('Next')?'next build':fe.includes('Vite')||fe.includes('SPA')?'vite build':'npm run build';
const buildPrefix=buildCmd.startsWith('npm')?'':'npx ';
const nodeV='22';
S.files['.github/workflows/ci.yml']=[
'name: CI',
'on:',
'  push:',
'    branches: [main, develop]',
'  pull_request:',
'    branches: [main]',
'',
'jobs:',
'  ci:',
'    runs-on: ubuntu-latest',
'    steps:',
'      - uses: actions/checkout@v4',
'      - uses: actions/setup-node@v4',
'        with:',
'          node-version: '+nodeV,
'          cache: npm',
'      - run: npm ci',
'      - run: npm audit --audit-level=high',
'      - run: npm run lint',
'      - run: npm run test',
'      - run: '+buildPrefix+buildCmd,
'',
'  security:',
'    runs-on: ubuntu-latest',
'    steps:',
'      - uses: actions/checkout@v4',
'        with:',
'          fetch-depth: 0',
'      # Secret Scanning',
'      - uses: gitleaks/gitleaks-action@v2',
'        env:',
'          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}',
'      # Dependency Review',
'      - uses: actions/dependency-review-action@v4',
'        if: github.event_name == \'pull_request\'',
'      # SLSA Build Provenance',
'      - uses: actions/attest-build-provenance@v2',
'        with:',
'          subject-path: \'dist/**\'',
''
].join('\n');
}
// ── Smart Table Pluralization ──
function pluralize(name){
const lower=name.toLowerCase();
// Uncountable
if(/^(progress|media|data|feedback|equipment|information|news|analytics|metadata|settings)$/i.test(name)) return lower;
// Irregular
const irreg={person:'people',child:'children',quiz:'quizzes',status:'statuses',category:'categories',entry:'entries'};
if(irreg[lower]) return irreg[lower];
// Standard rules
if(lower.endsWith('s')||lower.endsWith('x')||lower.endsWith('ch')||lower.endsWith('sh')) return lower+'es';
if(lower.endsWith('y')&&!/[aeiou]y$/i.test(lower)) return lower.slice(0,-1)+'ies';
return lower+'s';
}
// ── Check if value is "none" in any language ──
function isNone(v){
return !v||v==='none'||v==='None'||v==='なし';
}
// ── Screen Component Dictionary ──
const SCREEN_COMPONENTS={
'ランディング|landing|LP|トップ|home':{
components_ja:['ヒーローセクション(CTA)','特徴/メリット一覧','料金プラン比較表','ユーザーレビュー/実績','FAQ アコーディオン','フッター(リンク集)'],
components_en:['Hero section with CTA','Features / benefits list','Pricing comparison table','Testimonials / social proof','FAQ accordion','Footer with links'],
},
'ダッシュボード|dashboard':{
components_ja:['統計カード(KPI数値)','アクティビティグラフ(recharts)','最近のアクティビティ一覧','クイックアクションボタン','サイドバーナビゲーション'],
components_en:['Stats cards (KPI metrics)','Activity chart (recharts)','Recent activity feed','Quick action buttons','Sidebar navigation'],
},
'設定|settings|プロフィール|profile':{
components_ja:['プロフィール編集フォーム','パスワード変更','通知設定トグル','テーマ切替(ダーク/ライト)','アカウント削除'],
components_en:['Profile edit form','Password change','Notification toggles','Theme switch (dark/light)','Account deletion'],
},
'管理|admin':{
components_ja:['ユーザー管理テーブル(検索/フィルタ/ページネーション)','コンテンツ承認キュー','売上/統計グラフ','監査ログビューア','システム設定'],
components_en:['User management table (search/filter/pagination)','Content approval queue','Revenue / stats charts','Audit log viewer','System settings'],
},
'一覧|list|検索|search|コース|course|商品|product':{
components_ja:['検索バー + フィルタサイドバー','カード/リスト切替','ページネーション/無限スクロール','ソート(新着/人気/価格)','空状態メッセージ'],
components_en:['Search bar + filter sidebar','Card / list toggle','Pagination / infinite scroll','Sort (newest/popular/price)','Empty state message'],
},
'詳細|detail':{
components_ja:['メインコンテンツ表示','メタ情報サイドバー','関連コンテンツ','レビュー/コメントセクション','シェアボタン','CTAボタン(購入/受講開始)'],
components_en:['Main content display','Meta info sidebar','Related content','Reviews / comments section','Share buttons','CTA button (buy/enroll)'],
},
'決済|payment|billing|checkout':{
components_ja:['プラン比較カード','Stripe Elements決済フォーム','注文サマリー','クーポン入力','決済完了/エラー表示'],
components_en:['Plan comparison cards','Stripe Elements payment form','Order summary','Coupon input','Payment success / error display'],
},
'ログイン|login|サインイン|signin':{
components_ja:['メール/パスワードフォーム','ソーシャルログインボタン','パスワードリセットリンク','新規登録リンク','バリデーションメッセージ'],
components_en:['Email / password form','Social login buttons','Password reset link','Register link','Validation messages'],
},
'新規登録|register|signup':{
components_ja:['ステップフォーム(基本情報→確認)','利用規約同意チェック','ソーシャル登録ボタン','パスワード強度メーター','ログインリンク'],
components_en:['Step form (info → confirm)','Terms agreement checkbox','Social signup buttons','Password strength meter','Login link'],
},
};
function getScreenComponents(screenName,G){
for(const[pattern,detail]of Object.entries(SCREEN_COMPONENTS)){
if(new RegExp(pattern,'i').test(screenName)){return G?detail.components_ja:detail.components_en;}
}
return null;
}
// ── B3: Auth Source of Truth Resolution ──
function resolveAuth(a){
const be=a.backend||'';const fe=a.frontend||'';const auth=a.auth||'';
let sot,tokenType,tokenVerify,provider;
if(be.includes('Supabase')){
const isSPA=fe.includes('Vite')||fe.includes('SPA')||(!fe.includes('Next')&&!fe.includes('Nuxt')&&!fe.includes('Remix'));
sot='Supabase Auth';tokenType='Supabase JWT (access_token)';
tokenVerify=isSPA?'Supabase client library (client-side: supabase.auth.getUser()) + RLS':'Supabase client library (server-side: supabase.auth.getUser())';
provider='supabase';
} else if(be.includes('Firebase')){
sot='Firebase Auth';tokenType='Firebase ID Token';
tokenVerify='Firebase Admin SDK (admin.auth().verifyIdToken())';
provider='firebase';
} else if(fe.includes('Next.js')&&(auth.includes('NextAuth')||auth.includes('Auth.js'))){
sot='Auth.js (NextAuth v5)';tokenType='Session Token (server-side session)';
tokenVerify='Auth.js getServerSession() / auth() middleware';
provider='authjs';
} else if(auth.includes('Supabase Auth')){
sot='Supabase Auth (standalone)';tokenType='Supabase JWT';
tokenVerify='Supabase client library';
provider='supabase';
} else {
// Fallback: use user's auth answer or JWT default
sot=auth||'JWT + OAuth 2.0';tokenType='Bearer Token (JWT)';
tokenVerify='jsonwebtoken verify() / jose jwtVerify()';
provider='jwt';
}
// Social providers from auth chip
const social=[];
if(auth.includes('Google'))social.push('Google OAuth');
if(auth.includes('GitHub'))social.push('GitHub OAuth');
if(auth.includes('Apple'))social.push('Apple Sign In');
if(auth.includes('メール')||auth.includes('Email'))social.push('Email/Password');
if(auth.includes('Magic')||auth.includes('マジック'))social.push('Magic Link');
return {sot,tokenType,tokenVerify,provider,social};
}
// ── B1: Architecture Pattern Resolution ──
function resolveArch(a){
const fe=a.frontend||'React + Next.js';const be=a.backend||'Node.js + Express';
const db=a.database||'PostgreSQL';const deploy=a.deploy||'Vercel';
const mob=a.mobile||'';
const isBaaS=/Supabase|Firebase|Convex/.test(be);
const isNextJS=fe.includes('Next.js');
const isServerBE=/Express|Fastify|NestJS|Hono|Django|FastAPI|Spring|Go/.test(be);
const isVercel=deploy.includes('Vercel');
let pattern,diagram,note='';
if(isBaaS){
pattern='baas';
const baasName=be.includes('Supabase')?'Supabase':be.includes('Firebase')?'Firebase':'Convex';
diagram=`[Client] → [${fe}] → [${baasName} (Auth + DB + Functions)]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [${baasName} (Auth + DB + Functions)]`;
note=`${baasName} handles auth, database, and serverless functions as a unified backend.`;
} else if(isVercel&&isNextJS&&isServerBE){
pattern='bff';
diagram=`[Client] → [Next.js (SSR + API Routes)] → [${db}]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [Next.js API Routes] → [${db}]`;
note=`Express logic is integrated into Next.js API Routes for Vercel deployment. No separate backend server needed.`;
} else if(isVercel&&isServerBE&&!isNextJS){
pattern='split';
diagram=`[Client] → [${fe} (Vercel)]\n       → [${be} (Railway/Render)] → [${db}]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [${be} (Railway/Render)] → [${db}]`;
note=`${be} requires a separate server host (Railway/Render/Fly.io). Vercel serves frontend only.`;
} else {
pattern='traditional';
diagram=`[Client] → [${fe}] → [${be}] → [${db}]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [${be}] → [${db}]`;
}
return {pattern,diagram,note,isBaaS,isNextJS};
}
// ── B7: Schedule Single Source ──
function buildSchedule(a){
const hasMobile=a.mobile&&!isNone(a.mobile)&&!a.mobile.includes('PWA');
const startDate=new Date().toISOString().split('T')[0];
const sprints=[
{name:'Sprint 0',weeks:'Week 1',focus_ja:'環境構築',focus_en:'Setup'},
{name:'Sprint 1',weeks:'Week 2-3',focus_ja:'コア機能',focus_en:'Core Features'},
{name:'Sprint 2',weeks:'Week 3-4',focus_ja:'UI/UX',focus_en:'UI/UX'},
{name:'Sprint 3',weeks:'Week 4-5',focus_ja:'テスト・デプロイ',focus_en:'Test & Deploy'},
];
if(hasMobile) sprints.push({name:'Sprint 4',weeks:'Week 5-6',focus_ja:'モバイル対応',focus_en:'Mobile'});
const totalWeeks=hasMobile?6:5;
return {startDate,totalWeeks,sprints,hasMobile};
}
// ── B8: Package.json Real Dependencies ──
function buildDeps(a){
const fe=a.frontend||'';const be=a.backend||'';const db=a.database||'';
const orm=a.orm||'';const deploy=a.deploy||'';const auth=resolveAuth(a);
const deps={};const devDeps={};const scripts={};
// Frontend
if(fe.includes('Next.js')){
deps['next']='^15';deps['react']='^19';deps['react-dom']='^19';
scripts.dev='next dev';scripts.build='next build';scripts.start='next start';scripts.lint='next lint';
} else if(fe.includes('Vite')||fe.includes('Vue')||fe.includes('Svelte')){
deps['vite']='^6';
scripts.dev='vite';scripts.build='vite build';scripts.preview='vite preview';
}
if(fe.includes('Vue')){deps['vue']='^3';}
if(fe.includes('Svelte')){deps['svelte']='^5';}
if(fe.includes('Angular')){scripts.dev='ng serve';scripts.build='ng build';}
// Backend
if(be.includes('Express')){deps['express']='^5';}
if(be.includes('Fastify')){deps['fastify']='^5';}
if(be.includes('Hono')){deps['hono']='^4';}
if(be.includes('Supabase')){deps['@supabase/supabase-js']='^2';deps['@supabase/ssr']='^0.5';}
if(be.includes('Firebase')){deps['firebase']='^11';devDeps['firebase-tools']='^13';}
if(be.includes('Convex')){deps['convex']='^1';}
// ORM / DB — skip for BaaS (user orm input irrelevant)
const isBaaS=/Supabase|Firebase|Convex/.test(be);
if(!isBaaS){
if(orm.includes('Prisma')){devDeps['prisma']='^6';deps['@prisma/client']='^6';
scripts['db:push']='prisma db push';scripts['db:studio']='prisma studio';scripts['db:generate']='prisma generate';}
if(orm.includes('Drizzle')){deps['drizzle-orm']='^0.38';devDeps['drizzle-kit']='^0.30';
scripts['db:push']='drizzle-kit push';scripts['db:studio']='drizzle-kit studio';}
}
// Auth
if(auth.provider==='authjs'){deps['next-auth']='^5';}
// Payment
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
if(hasPay&&(a.payment||'').includes('Stripe')){deps['stripe']='^17';}
// Common devDeps
devDeps['typescript']='^5.7';devDeps['@types/node']='^22';
devDeps['vitest']='^3';devDeps['@playwright/test']='^1.50';
devDeps['eslint']='^9';devDeps['prettier']='^3';
scripts.test='vitest';scripts['test:e2e']='playwright test';
scripts.lint=scripts.lint||'eslint .';
return {deps,devDeps,scripts};
}
// ── B5: Domain Entity Validation & ER Inference ──
const DOMAIN_ENTITIES={
education:{core:['User','Course','Lesson','Progress','Quiz','Enrollment'],warn:['Product','Order','Cart'],suggest:{Product:'Course',Order:'Enrollment',Cart:'Wishlist'}},
ec:{core:['User','Product','Category','Order','Cart','Payment','Review'],warn:['Course','Lesson','Progress'],suggest:{}},
marketplace:{core:['User','Listing','Order','Review','Message','Category'],warn:['Course','Lesson'],suggest:{}},
community:{core:['User','Post','Comment','Tag','Like','Follow'],warn:['Product','Order','Cart','Payment'],suggest:{Product:'Resource',Order:'Invitation'}},
content:{core:['User','Post','Category','Tag','Comment','Media'],warn:['Product','Order','Cart'],suggest:{Product:'Content',Order:'Subscription'}},
analytics:{core:['User','Organization','OrgMember','Dashboard','DataSource','Widget','Report','Chart'],warn:['Post','Comment','Product'],suggest:{}},
booking:{core:['User','Service','Booking','TimeSlot','Review','Payment'],warn:['Post','Cart','Lesson'],suggest:{Product:'Service',Order:'Booking'}},
saas:{core:['User','Organization','OrgMember','Workspace','Project','Task','Subscription','Invoice'],warn:[],suggest:{Product:'Plan',Order:'Subscription'}},
portfolio:{core:['User','Project','Skill','Experience','ContactMessage'],warn:['Product','Order','Cart','Payment'],suggest:{}},
tool:{core:['User','Organization','OrgMember','Workspace','Task','Setting','Log'],warn:['Product','Order','Cart'],suggest:{}},
iot:{core:['User','Device','Sensor','SensorData','Alert','Dashboard'],warn:['Product','Order','Cart'],suggest:{}},
realestate:{core:['User','Property','Category','Viewing','Contract','RealEstateAgent'],warn:['Product','Order','Cart'],suggest:{Product:'Property',Order:'Viewing'}},
legal:{core:['User','Contract','Template','Review','Client','Document'],warn:['Product','Order','Cart'],suggest:{}},
hr:{core:['User','Organization','OrgMember','JobPosting','Applicant','Interview','Evaluation','Department'],warn:['Product','Order','Cart'],suggest:{}},
fintech:{core:['User','Account','Transaction','Transfer','Card','Statement'],warn:['Post','Comment','Course'],suggest:{}},
health:{core:['User','Patient','Doctor','Appointment','MedicalRecord','Prescription'],warn:['Product','Order','Cart'],suggest:{Product:'Service',Order:'Appointment'}},
ai:{core:['User','Conversation','Message','Prompt','Agent','Tool','ApiUsage'],warn:['Product','Order','Cart'],suggest:{}},
automation:{core:['User','Organization','OrgMember','Workflow','Trigger','Action','Execution','Connection','Log'],warn:['Product','Order'],suggest:{}},
event:{core:['User','Event','Ticket','Attendee','Venue','Session','Survey'],warn:['Product','Order'],suggest:{Product:'Ticket',Order:'Booking'}},
gamify:{core:['User','Badge','Challenge','Reward','Leaderboard','PointLog','Achievement'],warn:['Product','Order','Cart'],suggest:{}},
collab:{core:['User','Organization','OrgMember','Document','Workspace','Comment','Version','Permission','Activity'],warn:['Product','Order','Cart'],suggest:{}},
devtool:{core:['User','ApiKey','Project','RequestLog','Webhook','Documentation'],warn:['Product','Order','Cart'],suggest:{}},
creator:{core:['User','Content','Subscription','Payment','Tier','Comment','Tip'],warn:['Order','Cart'],suggest:{}},
newsletter:{core:['User','Post','Subscriber','Campaign','Analytics','Plan'],warn:['Product','Order','Cart'],suggest:{Product:'Plan',Order:'Subscription'}},
manufacturing:{core:['User','Product','ProductionOrder','Inventory','WorkOrder','Machine','QualityCheck'],warn:['Post','Comment','Course'],suggest:{Product:'Component'}},
logistics:{core:['User','Shipment','Package','Warehouse','Route','Delivery','Vehicle'],warn:['Post','Comment','Course'],suggest:{}},
agriculture:{core:['User','Farm','Crop','Field','Sensor','Harvest','Equipment'],warn:['Product','Order','Cart'],suggest:{}},
energy:{core:['User','Device','Meter','Reading','Alert','Tariff','Report'],warn:['Post','Comment','Product'],suggest:{}},
media:{core:['User','Content','Program','Episode','Subscriber','Comment','Like'],warn:['Product','Order','Cart'],suggest:{Product:'Subscription',Order:'View'}},
government:{core:['User','Application','Document','Department','Approval','Citizen','Service'],warn:['Product','Order','Cart'],suggest:{}},
travel:{core:['User','Booking','Itinerary','Hotel','Flight','Review','Payment'],warn:['Post','Comment','Course'],suggest:{}},
insurance:{core:['User','Policy','Claim','Customer','Quote','Document','Payment'],warn:['Product','Order','Cart'],suggest:{}},
};
// ── Entity Column Dictionary ──
// Format: 'column_name:TYPE:CONSTRAINT:DESC_JA:DESC_EN'
// Common column patterns (for compression)
const _U='user_id:UUID:FK(User) NOT NULL:ユーザーID:User ID';
const _SA="status:VARCHAR(20):DEFAULT 'active':ステータス:Status";
const _SD="status:VARCHAR(20):DEFAULT 'draft':ステータス:Status";
const _SP="status:VARCHAR(20):DEFAULT 'pending':ステータス:Status";
const _T='title:VARCHAR(255):NOT NULL:タイトル:Title';
const _D='description:TEXT::説明:Description';
const _CN='config:JSONB::設定:Config';
const _M='metadata:JSONB::メタデータ:Metadata';
const _B='body:TEXT::本文:Body';
const _BN='body:TEXT:NOT NULL:本文:Body';
const _TS='created_at:TIMESTAMP:DEFAULT NOW:作成日時:Created at';
const _SO='sort_order:INT:DEFAULT 0:表示順:Display order';
const _IA='is_active:BOOLEAN:DEFAULT true:有効:Active';
const _PR='price:DECIMAL(10,2):NOT NULL:価格:Price';
const _CAT='category:VARCHAR(100)::カテゴリ:Category';
const _DUR='duration_min:INT::所要時間(分):Duration(min)';
const _N='notes:TEXT::メモ:Notes';
const _C='content:TEXT::コンテンツ:Content';
const _ADDR='address:TEXT::住所:Address';
const _SUBJ='subject:VARCHAR(255)::件名:Subject';
const _URL='url:TEXT::URL:URL';
const _REASON='reason:TEXT::理由:Reason';
const _MSG='message:TEXT::メッセージ:Message';
const _COMPANY='company:VARCHAR(255)::会社名:Company';
const ENTITY_COLUMNS={
User:['email:VARCHAR(255):UNIQUE NOT NULL:メールアドレス:Email','avatar_url:TEXT::アバターURL:Avatar URL','role:VARCHAR(20):DEFAULT \'user\':ユーザー権限:User role'],
Course:['description:TEXT::コース説明:Course description','price:DECIMAL(10,2):DEFAULT 0:価格:Price','status:VARCHAR(20):DEFAULT \'draft\':公開状態:Publish status','thumbnail_url:TEXT::サムネイル:Thumbnail','instructor_id:UUID:FK(User):講師ID:Instructor ID'],
Lesson:[_SO,'content_type:VARCHAR(20):DEFAULT \'text\':コンテンツ種別:Content type',_DUR,'video_url:TEXT::動画URL:Video URL','is_free:BOOLEAN:DEFAULT false:無料公開:Free access'],
Progress:[_U,'lesson_id:UUID:FK(Lesson) NOT NULL:レッスンID:Lesson ID','status:VARCHAR(20):DEFAULT \'not_started\':進捗状態:Progress status','completed_at:TIMESTAMP::完了日時:Completed at','score:INT::スコア:Score'],
Quiz:['lesson_id:UUID:FK(Lesson) NOT NULL:レッスンID:Lesson ID','question:TEXT:NOT NULL:問題文:Question text','options:JSONB::選択肢:Options','correct_answer:TEXT:NOT NULL:正解:Correct answer','order:INT:DEFAULT 0:表示順:Display order'],
Enrollment:[_U,'course_id:UUID:FK(Course) NOT NULL:コースID:Course ID','enrolled_at:TIMESTAMP:DEFAULT NOW:受講開始日:Enrolled at','expires_at:TIMESTAMP::有効期限:Expires at',_SA],
Certificate:[_U,'course_id:UUID:FK(Course) NOT NULL:コースID:Course ID','issued_at:TIMESTAMP:DEFAULT NOW:発行日:Issued at','certificate_url:TEXT::証明書URL:Certificate URL'],
Product:[_D,_PR,'stock:INT:DEFAULT 0:在庫数:Stock','sku:VARCHAR(100):UNIQUE:SKU:SKU','image_url:TEXT::商品画像:Product image','category_id:UUID:FK(Category):カテゴリID:Category ID',_SA],
Category:['slug:VARCHAR(100):UNIQUE:スラグ:Slug',_D,'parent_id:UUID:FK(Category):親カテゴリ:Parent category',_SO],
Order:[_U,'total:DECIMAL(10,2):NOT NULL:合計金額:Total',_SP,'stripe_session_id:TEXT::Stripe Session ID:Stripe Session ID','shipping_address:JSONB::配送先:Shipping address'],
Cart:[_U,'product_id:UUID:FK(Product) NOT NULL:商品ID:Product ID','quantity:INT:DEFAULT 1:数量:Quantity'],
Review:[_U,'rating:INT:NOT NULL:評価(1-5):Rating(1-5)',_B],
Post:[_U,_T,_B,_SD,'published_at:TIMESTAMP::公開日時:Published at','slug:VARCHAR(255):UNIQUE:スラグ:Slug'],
Comment:[_U,'post_id:UUID:FK(Post) NOT NULL:投稿ID:Post ID',_BN],
Tag:['slug:VARCHAR(100):UNIQUE NOT NULL:スラグ:Slug'],
Media:[_U,'url:TEXT:NOT NULL:ファイルURL:File URL','mime_type:VARCHAR(50)::MIMEタイプ:MIME type','size_bytes:BIGINT::ファイルサイズ:File size'],
Like:[_U,'post_id:UUID:FK(Post) NOT NULL:投稿ID:Post ID'],
Follow:['follower_id:UUID:FK(User) NOT NULL:フォロワーID:Follower ID','following_id:UUID:FK(User) NOT NULL:フォロー対象ID:Following ID'],
Message:['sender_id:UUID:FK(User) NOT NULL:送信者ID:Sender ID','receiver_id:UUID:FK(User) NOT NULL:受信者ID:Receiver ID',_BN,'read_at:TIMESTAMP::既読日時:Read at'],
Listing:[_U,_T,_D,_PR,_SA,'category_id:UUID:FK(Category):カテゴリID:Category ID'],
Service:['provider_id:UUID:FK(User) NOT NULL:提供者ID:Provider ID',_D,'price:DECIMAL(10,2)::料金:Price',_DUR],
Booking:[_U,'service_id:UUID:FK(Service) NOT NULL:サービスID:Service ID','starts_at:TIMESTAMP:NOT NULL:開始日時:Starts at','ends_at:TIMESTAMP:NOT NULL:終了日時:Ends at',_SP],
TimeSlot:['service_id:UUID:FK(Service) NOT NULL:サービスID:Service ID','day_of_week:INT:NOT NULL:曜日(0-6):Day of week','start_time:TIME:NOT NULL:開始時刻:Start time','end_time:TIME:NOT NULL:終了時刻:End time','is_available:BOOLEAN:DEFAULT true:利用可能:Available'],
Workspace:['owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID','slug:VARCHAR(100):UNIQUE:スラグ:Slug','plan:VARCHAR(20):DEFAULT \'free\':プラン:Plan'],
Project:['workspace_id:UUID:FK(Workspace):ワークスペースID:Workspace ID',_SA,_D],
Task:['project_id:UUID:FK(Project):プロジェクトID:Project ID','assignee_id:UUID:FK(User):担当者ID:Assignee ID','status:VARCHAR(20):DEFAULT \'todo\':タスク状態:Status','priority:INT:DEFAULT 0:優先度:Priority','due_date:DATE::期日:Due date'],
Subscription:[_U,'stripe_subscription_id:TEXT:UNIQUE:StripeサブスクID:Stripe Sub ID','stripe_customer_id:TEXT::Stripe顧客ID:Stripe Customer ID',_SA,'plan:VARCHAR(20):NOT NULL:プラン名:Plan name','current_period_end:TIMESTAMP::現在期間終了:Current period end'],
Invoice:[_U,'amount:DECIMAL(10,2):NOT NULL:金額:Amount',_SP,'stripe_invoice_id:TEXT::Stripe請求ID:Stripe Invoice ID','paid_at:TIMESTAMP::支払日:Paid at'],
Payment:[_U,'amount:DECIMAL(10,2):NOT NULL:金額:Amount','method:VARCHAR(20)::支払方法:Payment method',_SP,'stripe_payment_id:TEXT::Stripe決済ID:Stripe Payment ID'],
Dashboard:[_U,'layout:JSONB::レイアウト設定:Layout config'],
Widget:['dashboard_id:UUID:FK(Dashboard) NOT NULL:ダッシュボードID:Dashboard ID','type:VARCHAR(50):NOT NULL:ウィジェット種別:Widget type',_CN,'position:INT:DEFAULT 0:表示位置:Position'],
DataSource:['workspace_id:UUID:FK(Workspace):ワークスペースID:Workspace ID','type:VARCHAR(50):NOT NULL:データソース種別:Source type','connection_config:JSONB::接続設定:Connection config'],
Device:[_U,'device_name:VARCHAR(255):NOT NULL:デバイス名:Device name','device_type:VARCHAR(50)::デバイス種別:Device type',_SA],
Sensor:['device_id:UUID:FK(Device) NOT NULL:デバイスID:Device ID','sensor_type:VARCHAR(50):NOT NULL:センサー種別:Sensor type','unit:VARCHAR(20)::単位:Unit'],
Alert:[_U,'severity:VARCHAR(20):DEFAULT \'info\':重要度:Severity','message:TEXT:NOT NULL:メッセージ:Message','acknowledged_at:TIMESTAMP::確認日時:Acknowledged at'],
Notification:[_U,_T,_B,'read_at:TIMESTAMP::既読日時:Read at','type:VARCHAR(50):DEFAULT \'general\':通知種別:Type'],
AuditLog:[_U,'action:VARCHAR(100):NOT NULL:操作:Action','resource_type:VARCHAR(50)::対象リソース:Resource type','resource_id:UUID::対象ID:Resource ID',_M],
Skill:[_CAT,'level:INT:DEFAULT 0:レベル:Level'],
Experience:['user_id:UUID:FK(User) NOT NULL:ユーザーID:User ID','company:VARCHAR(255)::企業名:Company','title:VARCHAR(255)::役職:Title','start_date:DATE::開始日:Start date','end_date:DATE::終了日:End date','description:TEXT::説明:Description'],
ContactMessage:['email:VARCHAR(255):NOT NULL:メールアドレス:Email','subject:VARCHAR(255)::件名:Subject','body:TEXT:NOT NULL:本文:Body','status:VARCHAR(20):DEFAULT \'unread\':対応状態:Status'],
// ── Enterprise/Multi-tenant ──
Organization:['slug:VARCHAR(100):UNIQUE NOT NULL:スラグ:Slug','status:VARCHAR(20):DEFAULT \'active\':ステータス:Status','plan:VARCHAR(20):DEFAULT \'free\':プラン:Plan','logo_url:TEXT::ロゴURL:Logo URL'],
OrgMember:['org_id:UUID:FK(Organization) NOT NULL:組織ID:Organization ID',_U,'role:VARCHAR(20):DEFAULT \'member\':ロール:Role','joined_at:TIMESTAMP:DEFAULT now():参加日:Joined at'],
OrgInvite:['org_id:UUID:FK(Organization) NOT NULL:組織ID:Organization ID','email:VARCHAR(255):NOT NULL:メール:Email','role:VARCHAR(20):DEFAULT \'member\':ロール:Role','token:UUID:DEFAULT gen_random_uuid():トークン:Token','expires_at:TIMESTAMP:NOT NULL:期限:Expires at','redeemed_at:TIMESTAMP::利用日:Redeemed at'],
// ── SaaS/Workspace ──
Team:['workspace_id:UUID:FK(Workspace) NOT NULL:ワークスペースID:Workspace ID','role:VARCHAR(20):DEFAULT \'member\':チーム権限:Team role'],
Activity:[_U,'action:VARCHAR(100):NOT NULL:操作種別:Action type','resource_type:VARCHAR(50)::対象リソース:Resource type','resource_id:UUID::対象ID:Resource ID',_M],
// ── AI/Chat ──
Conversation:[_U,_T,'model:VARCHAR(50)::使用モデル:Model used','token_count:INT:DEFAULT 0:トークン数:Token count',_SA],
Prompt:[_U,_T,'content:TEXT:NOT NULL:プロンプト内容:Prompt content','category:VARCHAR(50)::カテゴリ:Category','is_public:BOOLEAN:DEFAULT false:公開設定:Public'],
ApiUsage:[_U,'endpoint:VARCHAR(255):NOT NULL:エンドポイント:Endpoint','tokens_used:INT:NOT NULL:使用トークン:Tokens used','cost:DECIMAL(10,4)::コスト:Cost','request_at:TIMESTAMP:DEFAULT NOW:リクエスト日時:Request at'],
Agent:[_U,'agent_name:VARCHAR(255):NOT NULL:エージェント名:Agent name','system_prompt:TEXT::システムプロンプト:System prompt','model:VARCHAR(50)::使用モデル:Model',_SA,_CN],
Tool:['agent_id:UUID:FK(Agent) NOT NULL:エージェントID:Agent ID','tool_name:VARCHAR(100):NOT NULL:ツール名:Tool name','tool_type:VARCHAR(50)::ツール種別:Tool type',_CN,'is_enabled:BOOLEAN:DEFAULT true:有効:Enabled'],
Template:[_U,_T,'content:TEXT:NOT NULL:テンプレート内容:Content','category:VARCHAR(50)::カテゴリ:Category','usage_count:INT:DEFAULT 0:使用回数:Usage count'],
Generation:[_U,'template_id:UUID:FK(Template):テンプレートID:Template ID','input:TEXT::入力:Input','output:TEXT::出力:Output','model:VARCHAR(50)::使用モデル:Model','tokens_used:INT::使用トークン:Tokens used','status:VARCHAR(20):DEFAULT \'completed\':ステータス:Status'],
Content:[_U,_T,_B,'content_type:VARCHAR(50)::コンテンツ種別:Content type',_SD,'published_at:TIMESTAMP::公開日時:Published at'],
CreditUsage:[_U,'credits_used:INT:NOT NULL:使用クレジット:Credits used','action:VARCHAR(100)::操作:Action','balance_after:INT::残高:Balance after'],
// ── Automation/Workflow ──
Workflow:[_U,_T,_D,_SD,'is_active:BOOLEAN:DEFAULT false:有効:Active',_CN],
Trigger:['workflow_id:UUID:FK(Workflow) NOT NULL:ワークフローID:Workflow ID','trigger_type:VARCHAR(50):NOT NULL:トリガー種別:Trigger type',_CN,'is_enabled:BOOLEAN:DEFAULT true:有効:Enabled'],
Action:['workflow_id:UUID:FK(Workflow) NOT NULL:ワークフローID:Workflow ID','action_type:VARCHAR(50):NOT NULL:アクション種別:Action type',_SO,_CN],
Execution:['workflow_id:UUID:FK(Workflow) NOT NULL:ワークフローID:Workflow ID','status:VARCHAR(20):DEFAULT \'running\':実行状態:Status','started_at:TIMESTAMP:DEFAULT NOW:開始日時:Started at','completed_at:TIMESTAMP::完了日時:Completed at','error:TEXT::エラー:Error','output:JSONB::出力:Output'],
Connection:[_U,'service:VARCHAR(100):NOT NULL:サービス名:Service','credentials:JSONB::認証情報:Credentials',_SA],
Log:[_U,'level:VARCHAR(20):DEFAULT \'info\':レベル:Level','message:TEXT:NOT NULL:メッセージ:Message',_M],
// ── Marketplace ──
Transaction:['buyer_id:UUID:FK(User) NOT NULL:購入者ID:Buyer ID','seller_id:UUID:FK(User) NOT NULL:販売者ID:Seller ID','amount:DECIMAL(10,2):NOT NULL:金額:Amount','fee:DECIMAL(10,2):DEFAULT 0:手数料:Fee',_SP,'stripe_transfer_id:TEXT::Stripe送金ID:Stripe transfer ID'],
// ── Chatbot ──
Bot:[_U,'bot_name:VARCHAR(255):NOT NULL:ボット名:Bot name','welcome_message:TEXT::ウェルカムメッセージ:Welcome message','model:VARCHAR(50)::使用モデル:Model',_SA],
Intent:['bot_id:UUID:FK(Bot) NOT NULL:ボットID:Bot ID','intent_name:VARCHAR(100):NOT NULL:インテント名:Intent name','examples:JSONB::例文:Examples','response_template:TEXT::応答テンプレート:Response template'],
KnowledgeBase:['bot_id:UUID:FK(Bot) NOT NULL:ボットID:Bot ID',_T,'content:TEXT:NOT NULL:内容:Content','embedding:JSONB::埋め込みベクトル:Embedding vector','source_url:TEXT::ソースURL:Source URL'],
Handoff:['conversation_id:UUID:FK(Conversation) NOT NULL:会話ID:Conversation ID','agent_id:UUID:FK(User):担当者ID:Agent ID','reason:TEXT::理由:Reason',_SP,'resolved_at:TIMESTAMP::解決日時:Resolved at'],
// ── Fintech ──
Account:[_U,'account_name:VARCHAR(255):NOT NULL:口座名:Account name','account_type:VARCHAR(50)::口座種別:Account type','balance:DECIMAL(12,2):DEFAULT 0:残高:Balance','currency:VARCHAR(3):DEFAULT \'JPY\':通貨:Currency','institution:VARCHAR(255)::金融機関:Institution'],
Budget:[_U,'category:VARCHAR(100):NOT NULL:カテゴリ:Category','amount:DECIMAL(10,2):NOT NULL:予算額:Budget amount','period:VARCHAR(20):DEFAULT \'monthly\':期間:Period','spent:DECIMAL(10,2):DEFAULT 0:使用額:Spent'],
Report:[_U,_T,'report_type:VARCHAR(50)::レポート種別:Report type',_CN,'generated_at:TIMESTAMP::生成日時:Generated at','data:JSONB::データ:Data'],
// ── DevTool ──
ApiKey:[_U,'key_prefix:VARCHAR(20):NOT NULL:キー接頭辞:Key prefix','key_hash:TEXT:NOT NULL:キーハッシュ:Key hash','label:VARCHAR(100)::ラベル:Label','permissions:JSONB::権限:Permissions','last_used_at:TIMESTAMP::最終使用日:Last used','expires_at:TIMESTAMP::有効期限:Expires at'],
RequestLog:['api_key_id:UUID:FK(ApiKey):APIキーID:API Key ID','method:VARCHAR(10):NOT NULL:HTTPメソッド:HTTP method','path:VARCHAR(500):NOT NULL:パス:Path','status_code:INT::ステータスコード:Status code','latency_ms:INT::レイテンシ(ms):Latency(ms)','ip_address:VARCHAR(45)::IPアドレス:IP address'],
Documentation:[_T,'slug:VARCHAR(255):UNIQUE:スラグ:Slug','content:TEXT:NOT NULL:内容:Content',_CAT,_SO,'version:VARCHAR(20)::バージョン:Version'],
// ── Creator ──
Tip:['sender_id:UUID:FK(User) NOT NULL:送信者ID:Sender ID','receiver_id:UUID:FK(User) NOT NULL:受信者ID:Receiver ID','amount:DECIMAL(10,2):NOT NULL:金額:Amount','message:TEXT::メッセージ:Message','status:VARCHAR(20):DEFAULT \'completed\':ステータス:Status'],
Tier:[_U,'tier_name:VARCHAR(100):NOT NULL:ティア名:Tier name',_PR,_D,'benefits:JSONB::特典:Benefits'],
// ── Newsletter ──
Subscriber:['email:VARCHAR(255):UNIQUE NOT NULL:メールアドレス:Email',_U,_SA,'subscribed_at:TIMESTAMP:DEFAULT NOW:購読開始日:Subscribed at','tags:JSONB::タグ:Tags'],
Campaign:[_U,_T,'subject:VARCHAR(255)::件名:Subject',_B,_SD,'scheduled_at:TIMESTAMP::配信予定:Scheduled at','sent_at:TIMESTAMP::配信日時:Sent at'],
Analytics:['campaign_id:UUID:FK(Campaign):キャンペーンID:Campaign ID','metric:VARCHAR(50):NOT NULL:指標:Metric','value:DECIMAL(12,2):NOT NULL:値:Value','recorded_at:TIMESTAMP:DEFAULT NOW:記録日時:Recorded at'],
Plan:['plan_name:VARCHAR(100):NOT NULL:プラン名:Plan name',_PR,'interval:VARCHAR(20):DEFAULT \'monthly\':課金間隔:Billing interval','features:JSONB::機能:Features','stripe_price_id:TEXT::Stripe価格ID:Stripe price ID',_IA],
// ── PWA ──
SyncQueue:[_U,'action:VARCHAR(50):NOT NULL:操作:Action','payload:JSONB:NOT NULL:データ:Payload',_SP,'retry_count:INT:DEFAULT 0:リトライ数:Retry count'],
Setting:[_U,'key:VARCHAR(100):NOT NULL:設定キー:Setting key','value:JSONB::設定値:Value'],
// ── Booking ──
Staff:[_U,'specialty:VARCHAR(100)::専門分野:Specialty','is_available:BOOLEAN:DEFAULT true:利用可能:Available','calendar_config:JSONB::カレンダー設定:Calendar config'],
Reminder:['booking_id:UUID:FK(Booking):予約ID:Booking ID','remind_at:TIMESTAMP:NOT NULL:リマインド日時:Remind at','method:VARCHAR(20):DEFAULT \'email\':通知方法:Method','sent:BOOLEAN:DEFAULT false:送信済:Sent'],
// ── Event ──
Event:[_U,_T,_D,'venue_id:UUID:FK(Venue):会場ID:Venue ID','starts_at:TIMESTAMP:NOT NULL:開始日時:Starts at','ends_at:TIMESTAMP:NOT NULL:終了日時:Ends at','capacity:INT::定員:Capacity',_SD,'is_online:BOOLEAN:DEFAULT false:オンライン:Online'],
Ticket:['event_id:UUID:FK(Event) NOT NULL:イベントID:Event ID','ticket_type:VARCHAR(50):NOT NULL:チケット種別:Ticket type','price:DECIMAL(10,2):DEFAULT 0:価格:Price','quantity:INT:NOT NULL:枚数:Quantity','sold:INT:DEFAULT 0:販売済:Sold'],
Attendee:['event_id:UUID:FK(Event) NOT NULL:イベントID:Event ID',_U,'ticket_id:UUID:FK(Ticket):チケットID:Ticket ID','status:VARCHAR(20):DEFAULT \'registered\':参加状態:Status','checked_in_at:TIMESTAMP::チェックイン日時:Checked in at'],
Venue:['venue_name:VARCHAR(255):NOT NULL:会場名:Venue name','address:TEXT::住所:Address','capacity:INT::収容人数:Capacity','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude'],
Session:['event_id:UUID:FK(Event) NOT NULL:イベントID:Event ID',_T,'speaker:VARCHAR(255)::登壇者:Speaker','starts_at:TIMESTAMP:NOT NULL:開始:Starts at','ends_at:TIMESTAMP:NOT NULL:終了:Ends at','room:VARCHAR(100)::部屋:Room'],
Survey:['event_id:UUID:FK(Event):イベントID:Event ID',_T,'questions:JSONB:NOT NULL:質問:Questions',_IA],
// ── Health ──
HealthLog:[_U,'log_type:VARCHAR(50):NOT NULL:記録種別:Log type','value:DECIMAL(10,2):NOT NULL:値:Value','unit:VARCHAR(20)::単位:Unit','logged_at:TIMESTAMP:DEFAULT NOW:記録日時:Logged at',_N],
Workout:[_U,'workout_type:VARCHAR(50):NOT NULL:運動種別:Workout type',_DUR,'calories:INT::消費カロリー:Calories','intensity:VARCHAR(20)::強度:Intensity',_N],
Meal:[_U,'meal_type:VARCHAR(20):NOT NULL:食事種別:Meal type','food_items:JSONB::食品:Food items','calories:INT::カロリー:Calories','photo_url:TEXT::写真URL:Photo URL','logged_at:TIMESTAMP:DEFAULT NOW:記録日時:Logged at'],
Goal:[_U,'goal_type:VARCHAR(50):NOT NULL:目標種別:Goal type','target_value:DECIMAL(10,2):NOT NULL:目標値:Target value','current_value:DECIMAL(10,2):DEFAULT 0:現在値:Current value','unit:VARCHAR(20)::単位:Unit','deadline:DATE::期限:Deadline',_SA],
// ── HR ──
JobPosting:['department_id:UUID:FK(Department):部署ID:Department ID',_T,_D,'employment_type:VARCHAR(50)::雇用形態:Employment type','salary_range:VARCHAR(100)::給与レンジ:Salary range','status:VARCHAR(20):DEFAULT \'open\':募集状態:Status','closes_at:DATE::締切日:Closes at'],
Applicant:['job_id:UUID:FK(JobPosting) NOT NULL:求人ID:Job ID',_U,'applicant_name:VARCHAR(255):NOT NULL:氏名:Name','email:VARCHAR(255):NOT NULL:メール:Email','resume_url:TEXT::履歴書URL:Resume URL','status:VARCHAR(20):DEFAULT \'applied\':選考状態:Status','applied_at:TIMESTAMP:DEFAULT NOW:応募日:Applied at'],
Interview:['applicant_id:UUID:FK(Applicant) NOT NULL:応募者ID:Applicant ID','interviewer_id:UUID:FK(User) NOT NULL:面接官ID:Interviewer ID','scheduled_at:TIMESTAMP:NOT NULL:予定日時:Scheduled at','duration_min:INT:DEFAULT 60:所要時間(分):Duration(min)','interview_type:VARCHAR(50)::面接種別:Type','status:VARCHAR(20):DEFAULT \'scheduled\':ステータス:Status',_N],
Evaluation:['applicant_id:UUID:FK(Applicant) NOT NULL:応募者ID:Applicant ID','evaluator_id:UUID:FK(User) NOT NULL:評価者ID:Evaluator ID','score:INT:NOT NULL:スコア:Score','criteria:JSONB::評価基準:Criteria','comments:TEXT::コメント:Comments'],
Department:['department_name:VARCHAR(255):NOT NULL:部署名:Department name','parent_id:UUID:FK(Department):親部署ID:Parent ID','head_id:UUID:FK(User):部長ID:Head ID'],
Onboarding:[_U,'checklist:JSONB::チェックリスト:Checklist','progress:INT:DEFAULT 0:進捗(%):Progress(%)','mentor_id:UUID:FK(User):メンターID:Mentor ID','start_date:DATE::開始日:Start date','status:VARCHAR(20):DEFAULT \'in_progress\':ステータス:Status'],
// ── Link in Bio ──
Page:[_U,'slug:VARCHAR(100):UNIQUE NOT NULL:スラグ:Slug',_T,'bio:TEXT::自己紹介:Bio','theme_id:UUID:FK(Theme):テーマID:Theme ID','is_published:BOOLEAN:DEFAULT true:公開:Published'],
Link:['page_id:UUID:FK(Page) NOT NULL:ページID:Page ID',_T,'url:TEXT:NOT NULL:URL:URL',_SO,_IA,'click_count:INT:DEFAULT 0:クリック数:Clicks'],
Theme:['theme_name:VARCHAR(100):NOT NULL:テーマ名:Theme name','css_config:JSONB::CSSスタイル:CSS config','preview_url:TEXT::プレビューURL:Preview URL','is_premium:BOOLEAN:DEFAULT false:プレミアム:Premium'],
ClickLog:['link_id:UUID:FK(Link) NOT NULL:リンクID:Link ID','referrer:TEXT::リファラー:Referrer','user_agent:TEXT::ユーザーエージェント:User agent','ip_hash:VARCHAR(64)::IPハッシュ:IP hash','country:VARCHAR(2)::国コード:Country code'],
Integration:[_U,'service:VARCHAR(100):NOT NULL:サービス名:Service','access_token:TEXT::アクセストークン:Access token',_CN,_SA],
// ── Gamification ──
Badge:['badge_name:VARCHAR(100):NOT NULL:バッジ名:Badge name',_D,'icon_url:TEXT::アイコンURL:Icon URL','criteria:JSONB::獲得条件:Criteria','points:INT:DEFAULT 0:ポイント:Points'],
Challenge:[_T,_D,'challenge_type:VARCHAR(50)::種別:Type','reward_points:INT:DEFAULT 0:報酬ポイント:Reward points','starts_at:TIMESTAMP::開始日:Starts at','ends_at:TIMESTAMP::終了日:Ends at',_SA],
Reward:['reward_name:VARCHAR(255):NOT NULL:報酬名:Reward name',_D,'cost_points:INT:NOT NULL:必要ポイント:Cost points','stock:INT:DEFAULT -1:在庫(-1=無制限):Stock','reward_type:VARCHAR(50)::報酬種別:Type'],
Leaderboard:[_U,'score:INT:DEFAULT 0:スコア:Score','rank:INT::順位:Rank','period:VARCHAR(20):DEFAULT \'all_time\':期間:Period'],
PointLog:[_U,'points:INT:NOT NULL:ポイント:Points','action:VARCHAR(100):NOT NULL:操作:Action','balance_after:INT::残高:Balance after'],
Achievement:[_U,'badge_id:UUID:FK(Badge) NOT NULL:バッジID:Badge ID','earned_at:TIMESTAMP:DEFAULT NOW:獲得日時:Earned at'],
// ── Collab ──
Document:['workspace_id:UUID:FK(Workspace):ワークスペースID:Workspace ID','owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID',_T,'content:TEXT::内容:Content','doc_type:VARCHAR(50):DEFAULT \'text\':ドキュメント種別:Document type','is_public:BOOLEAN:DEFAULT false:公開:Public'],
Version:['document_id:UUID:FK(Document) NOT NULL:ドキュメントID:Document ID','author_id:UUID:FK(User) NOT NULL:著者ID:Author ID','content:TEXT:NOT NULL:内容:Content','version_number:INT:NOT NULL:バージョン:Version number','change_summary:TEXT::変更概要:Change summary'],
Permission:['document_id:UUID:FK(Document) NOT NULL:ドキュメントID:Document ID',_U,'role:VARCHAR(20):DEFAULT \'viewer\':権限:Role','granted_at:TIMESTAMP:DEFAULT NOW:付与日時:Granted at'],
// ── IoT ──
SensorData:['sensor_id:UUID:FK(Sensor) NOT NULL:センサーID:Sensor ID','value:DECIMAL(15,5):NOT NULL:測定値:Value','recorded_at:TIMESTAMP:DEFAULT NOW:記録日時:Recorded at','quality:VARCHAR(20):DEFAULT \'good\':品質:Quality'],
Command:['device_id:UUID:FK(Device) NOT NULL:デバイスID:Device ID','command_type:VARCHAR(50):NOT NULL:コマンド種別:Command type','payload:JSONB::ペイロード:Payload',_SP,'executed_at:TIMESTAMP::実行日時:Executed at'],
DeviceGroup:['group_name:VARCHAR(255):NOT NULL:グループ名:Group name',_D,_U],
// ── Community ──
Group:['owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID','group_name:VARCHAR(255):NOT NULL:グループ名:Group name',_D,'is_private:BOOLEAN:DEFAULT false:非公開:Private','member_count:INT:DEFAULT 0:メンバー数:Member count'],
// Webhook (devtool)
Webhook:[_U,'url:TEXT:NOT NULL:Webhook URL:Webhook URL','events:JSONB:NOT NULL:イベント:Events','secret:TEXT::シークレット:Secret',_IA,'last_triggered_at:TIMESTAMP::最終実行:Last triggered'],
// ── Medical/Clinic ──
Patient:[_U,'patient_name:VARCHAR(255):NOT NULL:患者名:Patient name','date_of_birth:DATE::生年月日:Date of birth','gender:VARCHAR(20)::性別:Gender','blood_type:VARCHAR(10)::血液型:Blood type','allergies:TEXT::アレルギー:Allergies','emergency_contact:VARCHAR(255)::緊急連絡先:Emergency contact'],
Doctor:[_U,'doctor_name:VARCHAR(255):NOT NULL:医師名:Doctor name','specialty:VARCHAR(100)::専門分野:Specialty','license_number:VARCHAR(100)::医師免許番号:License number','is_available:BOOLEAN:DEFAULT true:対応可能:Available'],
MedicalRecord:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','doctor_id:UUID:FK(Doctor) NOT NULL:医師ID:Doctor ID','visit_date:TIMESTAMP:DEFAULT NOW:受診日:Visit date','diagnosis:TEXT::診断:Diagnosis','treatment:TEXT::治療:Treatment','symptoms:TEXT::症状:Symptoms',_N],
Prescription:['medical_record_id:UUID:FK(MedicalRecord) NOT NULL:診療記録ID:Medical record ID','medication_name:VARCHAR(255):NOT NULL:薬剤名:Medication name','dosage:VARCHAR(100):NOT NULL:用量:Dosage','frequency:VARCHAR(100)::頻度:Frequency','duration_days:INT::処方日数:Duration(days)',_N],
Appointment:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','doctor_id:UUID:FK(Doctor) NOT NULL:医師ID:Doctor ID','scheduled_at:TIMESTAMP:NOT NULL:予約日時:Scheduled at',_DUR,'reason:TEXT::受診理由:Reason',_SP,_N],
Pet:['owner_id:UUID:FK(User) NOT NULL:飼い主ID:Owner ID','pet_name:VARCHAR(255):NOT NULL:ペット名:Pet name','species:VARCHAR(50):NOT NULL:種別:Species','breed:VARCHAR(100)::品種:Breed','date_of_birth:DATE::生年月日:Date of birth','weight_kg:DECIMAL(5,2)::体重(kg):Weight(kg)','medical_notes:TEXT::医療メモ:Medical notes'],
Vaccination:['pet_id:UUID:FK(Pet) NOT NULL:ペットID:Pet ID','vaccine_name:VARCHAR(255):NOT NULL:ワクチン名:Vaccine name','administered_at:TIMESTAMP:NOT NULL:接種日:Administered at','next_due:DATE::次回予定:Next due','veterinarian_id:UUID:FK(Veterinarian):獣医ID:Veterinarian ID',_N],
Veterinarian:[_U,'vet_name:VARCHAR(255):NOT NULL:獣医名:Vet name','specialty:VARCHAR(100)::専門分野:Specialty','license_number:VARCHAR(100)::免許番号:License number','is_available:BOOLEAN:DEFAULT true:対応可能:Available'],
// ── Property Management ──
Property:['owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID','property_name:VARCHAR(255):NOT NULL:物件名:Property name','address:TEXT:NOT NULL:住所:Address','property_type:VARCHAR(50)::物件種別:Property type','units:INT:DEFAULT 1:ユニット数:Units',_SA],
Unit:['property_id:UUID:FK(Property) NOT NULL:物件ID:Property ID','unit_number:VARCHAR(50):NOT NULL:ユニット番号:Unit number','bedrooms:INT::寝室数:Bedrooms','bathrooms:INT::浴室数:Bathrooms','area_sqm:DECIMAL(8,2)::面積(m²):Area(sqm)','monthly_rent:DECIMAL(10,2)::月額家賃:Monthly rent','status:VARCHAR(20):DEFAULT \'available\':状態:Status'],
Tenant:[_U,'tenant_name:VARCHAR(255):NOT NULL:入居者名:Tenant name','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone',_N],
Lease:['unit_id:UUID:FK(Unit) NOT NULL:ユニットID:Unit ID','tenant_id:UUID:FK(Tenant) NOT NULL:入居者ID:Tenant ID','start_date:DATE:NOT NULL:開始日:Start date','end_date:DATE:NOT NULL:終了日:End date','monthly_rent:DECIMAL(10,2):NOT NULL:月額家賃:Monthly rent','deposit:DECIMAL(10,2)::敷金:Deposit','status:VARCHAR(20):DEFAULT \'active\':状態:Status'],
MaintenanceRequest:['unit_id:UUID:FK(Unit) NOT NULL:ユニットID:Unit ID','tenant_id:UUID:FK(Tenant) NOT NULL:入居者ID:Tenant ID',_T,_D,'category:VARCHAR(50)::カテゴリ:Category',_SP,'assigned_to:UUID:FK(User):担当者ID:Assigned to','completed_at:TIMESTAMP::完了日時:Completed at'],
Owner:[_U,'owner_name:VARCHAR(255):NOT NULL:オーナー名:Owner name','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','properties_count:INT:DEFAULT 0:所有物件数:Properties count'],
// ── Contract Management ──
Contract:['contract_name:VARCHAR(255):NOT NULL:契約名:Contract name','contract_type:VARCHAR(50)::契約種別:Contract type','start_date:DATE::開始日:Start date','end_date:DATE::終了日:End date','auto_renew:BOOLEAN:DEFAULT false:自動更新:Auto renew','status:VARCHAR(20):DEFAULT \'draft\':ステータス:Status','document_url:TEXT::契約書URL:Document URL','value:DECIMAL(12,2)::契約額:Contract value'],
Party:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','party_name:VARCHAR(255):NOT NULL:当事者名:Party name','party_type:VARCHAR(50):NOT NULL:当事者種別:Party type','contact_email:VARCHAR(255)::連絡先メール:Contact email','signatory:VARCHAR(255)::署名者:Signatory'],
Approval:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','approver_id:UUID:FK(User) NOT NULL:承認者ID:Approver ID','status:VARCHAR(20):DEFAULT \'pending\':ステータス:Status','approved_at:TIMESTAMP::承認日時:Approved at','comments:TEXT::コメント:Comments'],
Signature:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','signer_id:UUID:FK(User) NOT NULL:署名者ID:Signer ID','signed_at:TIMESTAMP:DEFAULT NOW:署名日時:Signed at','signature_hash:TEXT::署名ハッシュ:Signature hash','ip_address:VARCHAR(45)::IPアドレス:IP address'],
Clause:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','clause_number:VARCHAR(20)::条項番号:Clause number',_T,'content:TEXT:NOT NULL:内容:Content',_SO],
// ── Helpdesk ──
KnowledgeArticle:[_T,'slug:VARCHAR(255):UNIQUE:スラグ:Slug','content:TEXT:NOT NULL:内容:Content',_CAT,_SA,'view_count:INT:DEFAULT 0:閲覧数:View count','helpful_count:INT:DEFAULT 0:役立った数:Helpful count'],
Response:['ticket_id:UUID:FK(SupportTicket) NOT NULL:チケットID:Ticket ID','responder_id:UUID:FK(User) NOT NULL:回答者ID:Responder ID','content:TEXT:NOT NULL:内容:Content','is_public:BOOLEAN:DEFAULT true:公開:Public'],
SLA:['name:VARCHAR(100):NOT NULL:SLA名:SLA name','priority:VARCHAR(20):NOT NULL:優先度:Priority','response_time_hours:INT:NOT NULL:応答時間(時):Response time(hours)','resolution_time_hours:INT:NOT NULL:解決時間(時):Resolution time(hours)',_IA],
Priority:[_U,'priority_level:VARCHAR(20):NOT NULL:優先度:Priority level','color:VARCHAR(7)::色:Color',_SO],
// ── Tutoring ──
Tutor:[_U,'tutor_name:VARCHAR(255):NOT NULL:講師名:Tutor name','bio:TEXT::自己紹介:Bio','hourly_rate:DECIMAL(8,2)::時給:Hourly rate','is_verified:BOOLEAN:DEFAULT false:認証済:Verified','rating:DECIMAL(3,2)::評価:Rating'],
Student:[_U,'student_name:VARCHAR(255):NOT NULL:生徒名:Student name','grade_level:VARCHAR(50)::学年:Grade level','parent_email:VARCHAR(255)::保護者メール:Parent email',_N],
Subject:['subject_name:VARCHAR(100):NOT NULL:科目名:Subject name',_D,_CAT],
Availability:['tutor_id:UUID:FK(Tutor) NOT NULL:講師ID:Tutor ID','day_of_week:INT:NOT NULL:曜日(0-6):Day of week','start_time:TIME:NOT NULL:開始時刻:Start time','end_time:TIME:NOT NULL:終了時刻:End time','is_available:BOOLEAN:DEFAULT true:利用可能:Available'],
// ── Restaurant ──
Table:['table_number:VARCHAR(20):NOT NULL:テーブル番号:Table number','capacity:INT:NOT NULL:定員:Capacity','location:VARCHAR(50)::場所:Location',_SA],
Reservation:['table_id:UUID:FK(Table) NOT NULL:テーブルID:Table ID',_U,'guest_name:VARCHAR(255):NOT NULL:予約者名:Guest name','guest_count:INT:NOT NULL:人数:Guest count','reserved_at:TIMESTAMP:NOT NULL:予約日時:Reserved at',_SP,'special_requests:TEXT::特別リクエスト:Special requests'],
MenuItem:[_T,_D,'category:VARCHAR(50)::カテゴリ:Category',_PR,'image_url:TEXT::画像URL:Image URL','is_available:BOOLEAN:DEFAULT true:提供可能:Available','allergens:JSONB::アレルゲン:Allergens'],
Shift:['staff_id:UUID:FK(User) NOT NULL:スタッフID:Staff ID','shift_date:DATE:NOT NULL:勤務日:Shift date','start_time:TIME:NOT NULL:開始時刻:Start time','end_time:TIME:NOT NULL:終了時刻:End time','role:VARCHAR(50)::役割:Role',_SA],
// ── Construction Payment ──
Contractor:['contractor_name:VARCHAR(255):NOT NULL:業者名:Contractor name','contact_person:VARCHAR(255)::担当者:Contact person','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','license_number:VARCHAR(100)::免許番号:License number',_SA],
ProgressReport:['project_id:UUID:FK(Project) NOT NULL:プロジェクトID:Project ID','contractor_id:UUID:FK(Contractor) NOT NULL:業者ID:Contractor ID','report_date:DATE:NOT NULL:報告日:Report date','completion_percentage:INT:NOT NULL:完了率(%):Completion(%)','work_summary:TEXT::作業概要:Work summary','photo_urls:JSONB::写真URL:Photo URLs',_SP],
Estimate:['project_id:UUID:FK(Project) NOT NULL:プロジェクトID:Project ID','contractor_id:UUID:FK(Contractor) NOT NULL:業者ID:Contractor ID','estimate_number:VARCHAR(50)::見積番号:Estimate number','total_amount:DECIMAL(12,2):NOT NULL:総額:Total amount','line_items:JSONB::明細:Line items',_SP,'valid_until:DATE::有効期限:Valid until'],
// ── Knowledge Base (Advanced) ──
Article:[_U,_T,'slug:VARCHAR(255):UNIQUE:スラグ:Slug','content:TEXT:NOT NULL:内容:Content',_CAT,_SD,'view_count:INT:DEFAULT 0:閲覧数:View count','version:INT:DEFAULT 1:バージョン:Version'],
AccessControl:['article_id:UUID:FK(Article) NOT NULL:記事ID:Article ID',_U,'role:VARCHAR(20):DEFAULT \'viewer\':権限:Role','granted_at:TIMESTAMP:DEFAULT NOW:付与日時:Granted at'],
SearchLog:['query:VARCHAR(500):NOT NULL:検索クエリ:Search query',_U,'results_count:INT::結果数:Results count','clicked_article_id:UUID:FK(Article):クリック記事ID:Clicked article ID','searched_at:TIMESTAMP:DEFAULT NOW:検索日時:Searched at'],
// ── Field Service ──
WorkOrder:['customer_id:UUID:FK(User) NOT NULL:顧客ID:Customer ID','technician_id:UUID:FK(User):技術者ID:Technician ID',_T,_D,'location:TEXT:NOT NULL:場所:Location','scheduled_at:TIMESTAMP::予定日時:Scheduled at',_SP,'priority:VARCHAR(20):DEFAULT \'medium\':優先度:Priority','completed_at:TIMESTAMP::完了日時:Completed at'],
Technician:[_U,'technician_name:VARCHAR(255):NOT NULL:技術者名:Technician name','skills:JSONB::スキル:Skills','certification:TEXT::資格:Certification','is_available:BOOLEAN:DEFAULT true:対応可能:Available','current_location:TEXT::現在地:Current location'],
Location:['location_name:VARCHAR(255):NOT NULL:場所名:Location name','address:TEXT:NOT NULL:住所:Address','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude','contact_name:VARCHAR(255)::担当者名:Contact name','contact_phone:VARCHAR(50)::電話番号:Contact phone'],
Customer:[_U,'customer_name:VARCHAR(255):NOT NULL:顧客名:Customer name','company:VARCHAR(255)::会社名:Company','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','billing_address:TEXT::請求先住所:Billing address',_N],
// ── Missing entities (A1) ──
Examination:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','doctor_id:UUID:FK(Doctor) NOT NULL:医師ID:Doctor ID','exam_date:TIMESTAMP:DEFAULT NOW:検査日:Exam date','exam_type:VARCHAR(100)::検査種別:Exam type','findings:TEXT::所見:Findings','diagnosis_code:VARCHAR(50)::診断コード:Diagnosis code',_N,_SA],
Claim:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','invoice_id:UUID:FK(Invoice):請求書ID:Invoice ID','claim_number:VARCHAR(100):UNIQUE:請求番号:Claim number','claim_date:DATE:NOT NULL:請求日:Claim date','amount:DECIMAL(10,2):NOT NULL:金額:Amount','insurance_provider:VARCHAR(255)::保険者:Insurance provider',_SP,'paid_at:TIMESTAMP::支払日:Paid at'],
Milestone:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID',_T,_D,'due_date:DATE::期限:Due date','completion_percentage:INT:DEFAULT 0:完了率(%):Completion(%)','payment_amount:DECIMAL(12,2)::支払額:Payment amount',_SP,'completed_at:TIMESTAMP::完了日時:Completed at'],
Inventory:['item_name:VARCHAR(255):NOT NULL:品目名:Item name','sku:VARCHAR(100):UNIQUE:SKU:SKU','quantity:INT:DEFAULT 0:在庫数:Quantity','unit:VARCHAR(20)::単位:Unit','location:VARCHAR(255)::保管場所:Location','reorder_level:INT:DEFAULT 0:発注点:Reorder level',_SA],
// ── New preset entities (C1) ──
Contact:[_U,'contact_name:VARCHAR(255):NOT NULL:連絡先名:Contact name','company_id:UUID:FK(Company):企業ID:Company ID','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','position:VARCHAR(100)::役職:Position',_N,_SA],
Deal:[_U,'deal_name:VARCHAR(255):NOT NULL:案件名:Deal name','contact_id:UUID:FK(Contact):連絡先ID:Contact ID','company_id:UUID:FK(Company):企業ID:Company ID','amount:DECIMAL(12,2)::金額:Amount','stage:VARCHAR(50):DEFAULT \'lead\':ステージ:Stage','probability:INT:DEFAULT 0:確度(%):Probability(%)','expected_close_date:DATE::成約予定日:Expected close',_N],
Company:['company_name:VARCHAR(255):NOT NULL:企業名:Company name','industry:VARCHAR(100)::業種:Industry','website:TEXT::ウェブサイト:Website','employee_count:INT::従業員数:Employee count','annual_revenue:DECIMAL(15,2)::年間売上:Annual revenue',_N,_SA],
Pipeline:['pipeline_name:VARCHAR(255):NOT NULL:パイプライン名:Pipeline name','stages:JSONB:NOT NULL:ステージ:Stages',_SO,_IA],
Shipment:['tracking_number:VARCHAR(100):UNIQUE NOT NULL:追跡番号:Tracking number','origin:TEXT:NOT NULL:出発地:Origin','destination:TEXT:NOT NULL:目的地:Destination','route_id:UUID:FK(Route):ルートID:Route ID','driver_id:UUID:FK(Driver):ドライバーID:Driver ID',_SP,'shipped_at:TIMESTAMP::出荷日時:Shipped at','delivered_at:TIMESTAMP::配達日時:Delivered at','weight_kg:DECIMAL(8,2)::重量(kg):Weight(kg)'],
Route:['route_name:VARCHAR(255):NOT NULL:ルート名:Route name','waypoints:JSONB:NOT NULL:経由地:Waypoints','distance_km:DECIMAL(10,2)::距離(km):Distance(km)','estimated_duration_min:INT::所要時間(分):Duration(min)',_IA],
Warehouse:['warehouse_name:VARCHAR(255):NOT NULL:倉庫名:Warehouse name','address:TEXT:NOT NULL:住所:Address','capacity:INT::容量:Capacity','current_stock_count:INT:DEFAULT 0:現在庫数:Current stock',_SA],
Driver:[_U,'driver_name:VARCHAR(255):NOT NULL:ドライバー名:Driver name','license_number:VARCHAR(100)::免許番号:License number','vehicle_type:VARCHAR(50)::車両種別:Vehicle type','is_available:BOOLEAN:DEFAULT true:稼働可能:Available','current_location:TEXT::現在地:Current location'],
Form:[_U,_T,_D,_SA,'is_template:BOOLEAN:DEFAULT false:テンプレート:Template','response_count:INT:DEFAULT 0:回答数:Response count'],
Question:['form_id:UUID:FK(Form) NOT NULL:フォームID:Form ID','question_text:TEXT:NOT NULL:質問文:Question text','question_type:VARCHAR(50):NOT NULL:質問種別:Question type','options:JSONB::選択肢:Options','is_required:BOOLEAN:DEFAULT false:必須:Required',_SO],
Answer:['form_id:UUID:FK(Form) NOT NULL:フォームID:Form ID','question_id:UUID:FK(Question) NOT NULL:質問ID:Question ID',_U,'answer_value:TEXT::回答値:Answer value','submitted_at:TIMESTAMP:DEFAULT NOW:回答日時:Submitted at'],
Job:['job_title:VARCHAR(255):NOT NULL:職種:Job title','company:VARCHAR(255):NOT NULL:企業名:Company','location:VARCHAR(255)::勤務地:Location','salary_range:VARCHAR(100)::給与レンジ:Salary range','job_type:VARCHAR(50)::雇用形態:Job type',_D,'status:VARCHAR(20):DEFAULT \'open\':募集状態:Status','posted_at:TIMESTAMP:DEFAULT NOW:掲載日:Posted at'],
SavedJob:[_U,'job_id:UUID:FK(Job) NOT NULL:求人ID:Job ID','saved_at:TIMESTAMP:DEFAULT NOW:保存日時:Saved at',_N],
// Reverse Engineering & Goal Management
UserGoal:[_U,'goal_title:VARCHAR(255):NOT NULL:目標タイトル:Goal title','target_value:VARCHAR(100)::目標値:Target value','current_value:VARCHAR(100)::現在値:Current value','deadline:DATE::期限:Deadline','priority:VARCHAR(20):DEFAULT \'medium\':優先度:Priority',_SA,'achieved_at:TIMESTAMP::達成日時:Achieved at'],
ReversePlan:[_U,'plan_title:VARCHAR(255):NOT NULL:計画タイトル:Plan title','goal_id:UUID:FK(UserGoal):目標ID:Goal ID','strategy:TEXT::戦略:Strategy','total_steps:INT:DEFAULT 0:総ステップ数:Total steps','completed_steps:INT:DEFAULT 0:完了ステップ数:Completed steps',_SA],
PlanStep:['plan_id:UUID:FK(ReversePlan) NOT NULL:計画ID:Plan ID','step_order:INT:NOT NULL:ステップ順序:Step order','step_title:VARCHAR(255):NOT NULL:ステップタイトル:Step title',_D,'estimated_hours:DECIMAL(5,1)::推定時間:Estimated hours',_SA,'completed_at:TIMESTAMP::完了日時:Completed at'],
ProgressTracking:['plan_id:UUID:FK(ReversePlan) NOT NULL:計画ID:Plan ID','tracked_at:TIMESTAMP:DEFAULT NOW:記録日時:Tracked at','progress_pct:DECIMAL(5,2)::進捗率:Progress pct','velocity:DECIMAL(5,2)::ベロシティ:Velocity','blockers:TEXT::障害:Blockers',_N],
PlanAdjustment:['plan_id:UUID:FK(ReversePlan) NOT NULL:計画ID:Plan ID','adjusted_at:TIMESTAMP:DEFAULT NOW:調整日時:Adjusted at','reason:TEXT:NOT NULL:調整理由:Reason','old_value:TEXT::旧値:Old value','new_value:TEXT::新値:New value',_N],
// ── Missing domain entities (M1 fix) ──
Chart:[_U,'chart_type:VARCHAR(50):NOT NULL:チャート種別:Chart type','data_source:VARCHAR(100)::データソース:Data source',_CN,'query_config:JSONB::クエリ設定:Query config',_T],
Viewing:['property_id:UUID:FK(Property) NOT NULL:物件ID:Property ID',_U,'scheduled_at:TIMESTAMP:NOT NULL:見学予定日時:Scheduled at',_SP,'feedback:TEXT::感想:Feedback','attended:BOOLEAN:DEFAULT false:出席:Attended'],
Client:['client_name:VARCHAR(255):NOT NULL:依頼者名:Client name','company:VARCHAR(255)::企業名:Company','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone',_SA,_N],
Transfer:['from_account:UUID:FK(Account) NOT NULL:送金元口座:From account','to_account:UUID:FK(Account) NOT NULL:送金先口座:To account','amount:DECIMAL(12,2):NOT NULL:金額:Amount','currency:VARCHAR(3):DEFAULT \'JPY\':通貨:Currency','reference:VARCHAR(255)::参照番号:Reference',_SP],
Card:['account_id:UUID:FK(Account) NOT NULL:口座ID:Account ID','card_number:VARCHAR(20):NOT NULL:カード番号:Card number','card_type:VARCHAR(20)::カード種別:Card type','expiry_date:VARCHAR(7)::有効期限:Expiry date',_SA,'credit_limit:DECIMAL(10,2)::限度額:Credit limit'],
Statement:['account_id:UUID:FK(Account) NOT NULL:口座ID:Account ID','period_start:DATE:NOT NULL:期間開始:Period start','period_end:DATE:NOT NULL:期間終了:Period end','opening_balance:DECIMAL(12,2):NOT NULL:期首残高:Opening balance','closing_balance:DECIMAL(12,2):NOT NULL:期末残高:Closing balance','statement_url:TEXT::明細書URL:Statement URL'],
// ── B-1 fix: Missing entities ──
Schedule:[_U,'technician_id:UUID:FK(User) NOT NULL:技術者ID:Technician ID','work_order_id:UUID:FK(WorkOrder) NOT NULL:作業指示ID:Work Order ID','scheduled_date:DATE:NOT NULL:予定日:Scheduled Date','start_time:TIME::開始時刻:Start Time','end_time:TIME::終了時刻:End Time',_SA],
Feedback:[_U,'article_id:UUID:FK(Article) NOT NULL:記事ID:Article ID','rating:INTEGER:CHECK(rating BETWEEN 1 AND 5):評価:Rating','comment:TEXT::コメント:Comment',_SA],
// ── B-2 fix: Entity name collision resolution ──
SupportTicket:[_U,'subject:VARCHAR(255):NOT NULL:件名:Subject',_D,'priority_id:UUID:FK(Priority) NOT NULL:優先度ID:Priority ID','category_id:UUID:FK(Category):カテゴリID:Category ID','assigned_agent_id:UUID:FK(User):担当者ID:Assigned Agent ID',_SP,'sla_id:UUID:FK(SLA):SLA ID:SLA ID'],
SupportAgent:[_U,'agent_name:VARCHAR(255):NOT NULL:サポート担当者名:Support agent name','email:VARCHAR(255)::メール:Email','department:VARCHAR(100)::部署:Department','specialization:VARCHAR(100)::専門分野:Specialization','is_available:BOOLEAN:DEFAULT true:対応可能:Available',_SA],
RealEstateAgent:[_U,'agent_name:VARCHAR(255):NOT NULL:エージェント名:Agent name','license_number:VARCHAR(100)::免許番号:License number','company:VARCHAR(255)::所属会社:Company','phone:VARCHAR(50)::電話:Phone',_SA,'rating:DECIMAL(3,2)::評価:Rating'],
// ── Task B: New 8-domain entities (32-domain expansion) ──
// Manufacturing (3)
ProductionOrder:[_U,'product_id:UUID:FK(Product) NOT NULL:製品ID:Product ID','quantity:INTEGER:NOT NULL:数量:Quantity','scheduled_date:DATE:NOT NULL:予定日:Scheduled Date','completion_date:DATE::完了日:Completion Date',_SP],
Machine:[_U,'machine_name:VARCHAR(255):NOT NULL:機械名:Machine name','machine_type:VARCHAR(100)::種別:Type','location:VARCHAR(255)::設置場所:Location',_SA,'last_maintenance:DATE::最終保守日:Last maintenance'],
QualityCheck:[_U,'production_order_id:UUID:FK(ProductionOrder) NOT NULL:製造指示ID:Production Order ID','inspector_id:UUID:FK(User):検査者ID:Inspector ID','result:VARCHAR(50):NOT NULL:結果:Result','defects:INTEGER:DEFAULT 0:不良数:Defect count',_N],
// Logistics (3)
Package:[_U,'shipment_id:UUID:FK(Shipment) NOT NULL:出荷ID:Shipment ID','weight:DECIMAL(10,2)::重量kg:Weight kg','dimensions:VARCHAR(100)::寸法:Dimensions','tracking_number:VARCHAR(100)::追跡番号:Tracking number',_SA],
Delivery:[_U,'shipment_id:UUID:FK(Shipment) NOT NULL:出荷ID:Shipment ID','driver_id:UUID:FK(User):ドライバーID:Driver ID','delivered_at:TIMESTAMP::配達日時:Delivered at','recipient_name:VARCHAR(255)::受取人:Recipient',_SA],
Vehicle:[_U,'plate_number:VARCHAR(50):NOT NULL:ナンバー:Plate number','vehicle_type:VARCHAR(100)::車種:Vehicle type','capacity:DECIMAL(10,2)::積載量:Capacity',_SA],
// Agriculture (5)
Farm:[_U,'farm_name:VARCHAR(255):NOT NULL:農場名:Farm name','location:VARCHAR(255)::所在地:Location','area_hectares:DECIMAL(10,2)::面積ha:Area hectares','owner_id:UUID:FK(User):オーナーID:Owner ID'],
Crop:[_U,'crop_name:VARCHAR(255):NOT NULL:作物名:Crop name','variety:VARCHAR(255)::品種:Variety','planting_date:DATE::播種日:Planting date','expected_harvest:DATE::収穫予定:Expected harvest',_SA],
Field:[_U,'farm_id:UUID:FK(Farm) NOT NULL:農場ID:Farm ID','field_name:VARCHAR(255):NOT NULL:圃場名:Field name','area_hectares:DECIMAL(10,2)::面積ha:Area hectares','soil_type:VARCHAR(100)::土壌:Soil type','crop_id:UUID:FK(Crop):作物ID:Crop ID'],
Harvest:[_U,'field_id:UUID:FK(Field) NOT NULL:圃場ID:Field ID','crop_id:UUID:FK(Crop) NOT NULL:作物ID:Crop ID','harvest_date:DATE:NOT NULL:収穫日:Harvest date','quantity_kg:DECIMAL(10,2):NOT NULL:収穫量kg:Quantity kg','grade:VARCHAR(50)::等級:Grade'],
Equipment:[_U,'equipment_name:VARCHAR(255):NOT NULL:機材名:Equipment name','equipment_type:VARCHAR(100)::種別:Type',_SA,'last_maintenance:DATE::最終保守日:Last maintenance'],
// Energy (3)
Meter:[_U,'device_id:UUID:FK(Device):デバイスID:Device ID','meter_number:VARCHAR(100):NOT NULL:メーター番号:Meter number','meter_type:VARCHAR(50)::種別:Type','location:VARCHAR(255)::設置場所:Location',_SA],
Reading:[_U,'meter_id:UUID:FK(Meter) NOT NULL:メーターID:Meter ID','value:DECIMAL(12,4):NOT NULL:計測値:Value','unit:VARCHAR(20):DEFAULT \'kWh\':単位:Unit','recorded_at:TIMESTAMP:NOT NULL:記録日時:Recorded at','quality:VARCHAR(20)::品質:Quality'],
Tariff:[_U,'tariff_name:VARCHAR(255):NOT NULL:料金プラン名:Tariff name','rate:DECIMAL(10,4):NOT NULL:単価:Rate','unit:VARCHAR(20):DEFAULT \'kWh\':単位:Unit','valid_from:DATE:NOT NULL:開始日:Valid from','valid_to:DATE::終了日:Valid to'],
// Media (2)
Program:[_U,'program_name:VARCHAR(255):NOT NULL:番組名:Program name','genre:VARCHAR(100)::ジャンル:Genre',_D,_SA,'thumbnail_url:TEXT::サムネイル:Thumbnail URL'],
Episode:[_U,'program_id:UUID:FK(Program) NOT NULL:番組ID:Program ID','episode_number:INTEGER:NOT NULL:話数:Episode number',_T,'duration_min:INTEGER::時間(分):Duration min','video_url:TEXT::動画URL:Video URL','published_at:TIMESTAMP::公開日:Published at'],
// Government (2)
Application:[_U,'citizen_id:UUID:FK(User) NOT NULL:市民ID:Citizen ID','application_type:VARCHAR(100):NOT NULL:申請種別:Application type',_D,_SP,'submitted_at:TIMESTAMP::提出日:Submitted at','reviewed_by:UUID:FK(User):審査者ID:Reviewed by'],
Citizen:[_U,'citizen_name:VARCHAR(255):NOT NULL:氏名:Citizen name','address:TEXT::住所:Address','phone:VARCHAR(50)::電話:Phone','national_id:VARCHAR(100)::マイナンバー:National ID',_SA],
// Travel (3)
Itinerary:[_U,'user_id:UUID:FK(User) NOT NULL:ユーザーID:User ID','itinerary_name:VARCHAR(255):NOT NULL:旅程名:Itinerary name','start_date:DATE:NOT NULL:開始日:Start date','end_date:DATE:NOT NULL:終了日:End date',_SA],
Hotel:[_U,'hotel_name:VARCHAR(255):NOT NULL:ホテル名:Hotel name','location:VARCHAR(255)::所在地:Location','star_rating:INTEGER::星評価:Star rating','price_per_night:DECIMAL(10,2)::1泊料金:Price per night',_SA],
Flight:[_U,'airline:VARCHAR(255):NOT NULL:航空会社:Airline','flight_number:VARCHAR(20):NOT NULL:便名:Flight number','departure:VARCHAR(255):NOT NULL:出発地:Departure','arrival:VARCHAR(255):NOT NULL:到着地:Arrival','departure_time:TIMESTAMP:NOT NULL:出発時刻:Departure time','arrival_time:TIMESTAMP:NOT NULL:到着時刻:Arrival time','price:DECIMAL(10,2)::料金:Price'],
// Insurance (2)
Policy:[_U,'customer_id:UUID:FK(Customer) NOT NULL:顧客ID:Customer ID','policy_type:VARCHAR(100):NOT NULL:保険種別:Policy type','premium:DECIMAL(10,2):NOT NULL:保険料:Premium','coverage:DECIMAL(12,2)::補償額:Coverage','start_date:DATE:NOT NULL:開始日:Start date','end_date:DATE:NOT NULL:終了日:End date',_SA],
Quote:[_U,'customer_id:UUID:FK(Customer) NOT NULL:顧客ID:Customer ID','policy_type:VARCHAR(100):NOT NULL:保険種別:Policy type','premium:DECIMAL(10,2):NOT NULL:見積保険料:Estimated premium','coverage:DECIMAL(12,2)::補償額:Coverage',_SP,'valid_until:DATE::有効期限:Valid until'],
// ── Engineering field ──
InspectionRecord:[_U,'equipment_id:UUID:FK(Equipment) NOT NULL:設備ID:Equipment ID','inspection_date:TIMESTAMP:DEFAULT NOW:点検日時:Inspection date','inspector_id:UUID:FK(User) NOT NULL:点検者ID:Inspector ID','result:VARCHAR(20):DEFAULT \'pass\':結果:Result','findings:TEXT::所見:Findings','next_due:DATE::次回予定:Next due',_N],
AnomalyEvent:[_U,'equipment_id:UUID:FK(Equipment) NOT NULL:設備ID:Equipment ID','detected_at:TIMESTAMP:DEFAULT NOW:検知日時:Detected at','severity:VARCHAR(20):DEFAULT \'warning\':重要度:Severity','anomaly_type:VARCHAR(100)::異常種別:Anomaly type','value:DECIMAL(15,5)::測定値:Value','threshold:DECIMAL(15,5)::閾値:Threshold','resolved_at:TIMESTAMP::解決日時:Resolved at',_SP],
InspectionSchedule:[_U,'equipment_id:UUID:FK(Equipment) NOT NULL:設備ID:Equipment ID','frequency:VARCHAR(50):NOT NULL:頻度:Frequency','next_due:DATE:NOT NULL:次回予定日:Next due','assigned_to:UUID:FK(User):担当者ID:Assigned to',_IA],
SimulationModel:[_U,_T,_D,'model_type:VARCHAR(50)::モデル種別:Model type','parameters:JSONB::パラメータ:Parameters',_SA,'version:VARCHAR(20)::バージョン:Version'],
SimResult:[_U,'model_id:UUID:FK(SimulationModel) NOT NULL:モデルID:Model ID','run_at:TIMESTAMP:DEFAULT NOW:実行日時:Run at','output:JSONB::出力:Output','status:VARCHAR(20):DEFAULT \'completed\':ステータス:Status','error:TEXT::エラー:Error','duration_ms:INT::実行時間ms:Duration ms'],
SimInput:[_U,'model_id:UUID:FK(SimulationModel) NOT NULL:モデルID:Model ID',_T,'inputs:JSONB:NOT NULL:入力値:Inputs'],
CADFile:[_U,_T,'file_url:TEXT:NOT NULL:ファイルURL:File URL','format:VARCHAR(20)::フォーマット:Format','version:VARCHAR(20)::バージョン:Version','project_id:UUID:FK(Project):プロジェクトID:Project ID',_SA,'file_size_mb:DECIMAL(8,2)::ファイルサイズMB:File size MB'],
DesignReview:[_U,'cad_file_id:UUID:FK(CADFile) NOT NULL:CADファイルID:CAD file ID','reviewer_id:UUID:FK(User) NOT NULL:レビュアーID:Reviewer ID',_SP,'comments:TEXT::コメント:Comments','approved_at:TIMESTAMP::承認日時:Approved at'],
QualityProcess:[_U,_T,_D,'process_type:VARCHAR(50)::プロセス種別:Process type',_IA,'standard:VARCHAR(100)::規格:Standard'],
ProcessStep:['process_id:UUID:FK(QualityProcess) NOT NULL:プロセスID:Process ID',_T,_D,_SO,'acceptance_criteria:TEXT::合格基準:Acceptance criteria','duration_min:INT::所要時間(分):Duration min'],
Defect:[_U,'product_id:VARCHAR(100)::製品ID:Product ID','defect_type:VARCHAR(100):NOT NULL:不具合種別:Defect type','severity:VARCHAR(20):DEFAULT \'minor\':重要度:Severity','location:TEXT::発生箇所:Location','detected_at:TIMESTAMP:DEFAULT NOW:検出日時:Detected at',_SP,'corrective_action:TEXT::是正処置:Corrective action'],
// ── Science field ──
ExperimentData:[_U,_T,_D,'experiment_type:VARCHAR(50)::実験種別:Experiment type','data:JSONB::データ:Data','measurement_unit:VARCHAR(50)::単位:Measurement unit','recorded_at:TIMESTAMP:DEFAULT NOW:記録日時:Recorded at'],
ExperimentRun:[_U,_T,'experiment_type:VARCHAR(50)::実験種別:Experiment type','parameters:JSONB::パラメータ:Parameters','started_at:TIMESTAMP:NOT NULL:開始日時:Started at','ended_at:TIMESTAMP::終了日時:Ended at','status:VARCHAR(20):DEFAULT \'running\':ステータス:Status','result_summary:TEXT::結果概要:Result summary'],
DataPoint:['source_id:UUID::ソースID:Source ID','source_type:VARCHAR(50)::ソース種別:Source type','x_value:DECIMAL(20,8)::X値:X value','y_value:DECIMAL(20,8)::Y値:Y value','z_value:DECIMAL(20,8)::Z値:Z value','label:VARCHAR(100)::ラベル:Label','recorded_at:TIMESTAMP:DEFAULT NOW:記録日時:Recorded at'],
ResearchPaper:[_U,_T,'authors:JSONB:NOT NULL:著者:Authors','abstract:TEXT::アブストラクト:Abstract','doi:VARCHAR(100)::DOI:DOI','journal:VARCHAR(255)::掲載誌:Journal','published_year:INT::発行年:Published year','url:TEXT::URL:URL','keywords:JSONB::キーワード:Keywords'],
PaperSummary:[_U,'paper_id:UUID:FK(ResearchPaper) NOT NULL:論文ID:Paper ID','summary:TEXT:NOT NULL:要約:Summary','key_findings:JSONB::主要発見:Key findings','model_used:VARCHAR(50)::使用モデル:Model used','generated_at:TIMESTAMP:DEFAULT NOW:生成日時:Generated at'],
MathFormula:[_U,_T,'latex:TEXT:NOT NULL:LaTeX:LaTeX','category:VARCHAR(50)::カテゴリ:Category','description:TEXT::説明:Description','is_verified:BOOLEAN:DEFAULT false:検証済:Verified','usage_context:TEXT::使用文脈:Usage context'],
ObservationLog:[_U,_T,'location:VARCHAR(255)::観測地点:Location','observed_at:TIMESTAMP:NOT NULL:観測日時:Observed at','instrument:VARCHAR(100)::機器:Instrument','conditions:JSONB::観測条件:Conditions','raw_data:JSONB::生データ:Raw data'],
// ── Agriculture field ──
CropDiagnosis:[_U,'crop_id:UUID:FK(Crop) NOT NULL:作物ID:Crop ID','field_id:UUID:FK(Field) NOT NULL:圃場ID:Field ID','diagnosed_at:TIMESTAMP:DEFAULT NOW:診断日時:Diagnosed at','condition:VARCHAR(50):NOT NULL:状態:Condition','disease_id:VARCHAR(100)::病害ID:Disease ID','severity:VARCHAR(20):DEFAULT \'low\':重要度:Severity','recommendation:TEXT::推奨処置:Recommendation','image_url:TEXT::画像URL:Image URL'],
WeatherForecast:[_U,'location:VARCHAR(255):NOT NULL:地点:Location','forecast_date:DATE:NOT NULL:予報日:Forecast date','temperature_max:DECIMAL(5,1)::最高気温:Temp max','temperature_min:DECIMAL(5,1)::最低気温:Temp min','precipitation_mm:DECIMAL(6,1)::降水量mm:Precipitation','humidity_pct:INT::湿度(%):Humidity','wind_speed:DECIMAL(5,1)::風速:Wind speed','source:VARCHAR(100)::データソース:Data source'],
SoilAnalysis:[_U,'field_id:UUID:FK(Field) NOT NULL:圃場ID:Field ID','analyzed_at:TIMESTAMP:DEFAULT NOW:分析日時:Analyzed at','ph:DECIMAL(4,2)::pH:pH','nitrogen_ppm:DECIMAL(8,2)::窒素ppm:Nitrogen ppm','phosphorus_ppm:DECIMAL(8,2)::リン酸ppm:Phosphorus ppm','potassium_ppm:DECIMAL(8,2)::カリウムppm:Potassium ppm','organic_matter_pct:DECIMAL(5,2)::有機物(%):Organic matter','recommendation:TEXT::施肥推奨:Recommendation'],
IrrigationSchedule:['field_id:UUID:FK(Field) NOT NULL:圃場ID:Field ID',_U,'day_of_week:INT::曜日(0-6):Day of week','start_time:TIME::開始時刻:Start time','duration_min:INT::時間(分):Duration min','volume_liters:DECIMAL(10,2)::水量L:Volume liters',_IA,'trigger_soil_moisture:DECIMAL(5,2)::土壌水分閾値:Trigger moisture'],
// ── Medical field ──
SymptomCheck:[_U,'patient_id:UUID:FK(Patient):患者ID:Patient ID','symptoms:JSONB:NOT NULL:症状:Symptoms','severity:VARCHAR(20):DEFAULT \'moderate\':重症度:Severity','ai_assessment:TEXT::AI評価:AI assessment','recommended_action:TEXT::推奨対応:Recommended action','checked_at:TIMESTAMP:DEFAULT NOW:チェック日時:Checked at'],
DrugInteraction:[_U,'drug_a:VARCHAR(255):NOT NULL:薬剤A:Drug A','drug_b:VARCHAR(255):NOT NULL:薬剤B:Drug B','severity:VARCHAR(20):NOT NULL:重症度:Severity','mechanism:TEXT::相互作用機序:Mechanism','recommendation:TEXT::推奨事項:Recommendation','source:VARCHAR(255)::情報源:Source'],
MedicalDocument:[_U,'patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','doc_type:VARCHAR(50):NOT NULL:文書種別:Document type','content:TEXT::内容:Content','summary:TEXT::要約:Summary','file_url:TEXT::ファイルURL:File URL','created_at:TIMESTAMP:DEFAULT NOW:作成日時:Created at',_SA],
RehabSession:[_U,'patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','therapist_id:UUID:FK(User) NOT NULL:療法士ID:Therapist ID','session_date:DATE:NOT NULL:セッション日:Session date',_DUR,'exercises:JSONB::運動メニュー:Exercises','pain_level:INT::痛みレベル(0-10):Pain level','notes:TEXT::メモ:Notes'],
RehabGoal:[_U,'patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','goal_description:TEXT:NOT NULL:目標内容:Goal description','target_date:DATE::目標日:Target date','status:VARCHAR(20):DEFAULT \'in_progress\':状態:Status','progress_pct:INT:DEFAULT 0:進捗(%):Progress(%)','achieved_at:TIMESTAMP::達成日時:Achieved at'],
// ── Social Science field ──
LegalCase:[_U,'case_title:VARCHAR(255):NOT NULL:案件名:Case title','case_type:VARCHAR(100)::種別:Case type','client_id:UUID:FK(User):依頼者ID:Client ID','status:VARCHAR(20):DEFAULT \'open\':ステータス:Status','filed_at:TIMESTAMP::提出日:Filed at','jurisdiction:VARCHAR(100)::管轄:Jurisdiction',_N],
MarketResearch:[_U,_T,_D,'industry:VARCHAR(100)::業種:Industry','methodology:VARCHAR(100)::調査手法:Methodology','sample_size:INT::サンプル数:Sample size','started_at:TIMESTAMP::開始日:Started at','completed_at:TIMESTAMP::完了日:Completed at',_SA],
ResearchData:['research_id:UUID::調査ID:Research ID',_U,'data_type:VARCHAR(50):NOT NULL:データ種別:Data type','data:JSONB:NOT NULL:データ:Data','source:VARCHAR(255)::データソース:Data source','collected_at:TIMESTAMP:DEFAULT NOW:収集日時:Collected at'],
FinancialReport:[_U,_T,'report_type:VARCHAR(50):NOT NULL:レポート種別:Report type','period_start:DATE:NOT NULL:期間開始:Period start','period_end:DATE:NOT NULL:期間終了:Period end','data:JSONB::財務データ:Financial data','generated_at:TIMESTAMP:DEFAULT NOW:生成日時:Generated at',_SA],
SocialPost:['platform:VARCHAR(50):NOT NULL:プラットフォーム:Platform','post_id:VARCHAR(255):NOT NULL:投稿ID:Post ID','author:VARCHAR(255)::著者:Author','content:TEXT::投稿内容:Content','posted_at:TIMESTAMP::投稿日時:Posted at','likes:INT:DEFAULT 0:いいね数:Likes','shares:INT:DEFAULT 0:シェア数:Shares'],
SentimentAnalysis:['post_id:VARCHAR(255)::投稿ID:Post ID',_U,'sentiment:VARCHAR(20):NOT NULL:感情:Sentiment','score:DECIMAL(5,4)::スコア:Score','topics:JSONB::トピック:Topics','analyzed_at:TIMESTAMP:DEFAULT NOW:分析日時:Analyzed at'],
// ── Humanities field ──
LiteratureSource:[_U,_T,'author:VARCHAR(255)::著者:Author','period:VARCHAR(100)::時代:Period','source_type:VARCHAR(50)::資料種別:Source type','language:VARCHAR(50)::言語:Language','transcription:TEXT::翻刻テキスト:Transcription','digitized_url:TEXT::デジタル化URL:Digitized URL'],
TextAnalysis:[_U,'source_id:UUID:FK(LiteratureSource):文献ID:Source ID','analysis_type:VARCHAR(50):NOT NULL:分析種別:Analysis type','result:JSONB:NOT NULL:結果:Result','model_used:VARCHAR(50)::使用モデル:Model used','generated_at:TIMESTAMP:DEFAULT NOW:生成日時:Generated at'],
Translation:[_U,'source_text:TEXT:NOT NULL:原文:Source text','source_lang:VARCHAR(10):NOT NULL:原語:Source language','target_lang:VARCHAR(10):NOT NULL:対象言語:Target language','translated_text:TEXT:NOT NULL:訳文:Translated text','model_used:VARCHAR(50)::使用モデル:Model used','quality_score:DECIMAL(5,4)::品質スコア:Quality score'],
TranslationSegment:['translation_id:UUID:FK(Translation) NOT NULL:翻訳ID:Translation ID','segment_index:INT:NOT NULL:セグメント番号:Segment index','source_segment:TEXT:NOT NULL:原文セグメント:Source segment','target_segment:TEXT:NOT NULL:訳文セグメント:Target segment','is_reviewed:BOOLEAN:DEFAULT false:レビュー済:Reviewed'],
StyleReport:[_U,'content_id:UUID::コンテンツID:Content ID',_T,'metrics:JSONB:NOT NULL:指標:Metrics','suggestions:JSONB::改善提案:Suggestions','score:DECIMAL(5,2)::スコア:Score','generated_at:TIMESTAMP:DEFAULT NOW:生成日時:Generated at'],
Courseware:[_U,_T,_D,'subject:VARCHAR(100)::科目:Subject','target_level:VARCHAR(50)::対象レベル:Target level','content:TEXT::内容:Content','format:VARCHAR(50)::形式:Format',_SD,'language:VARCHAR(10):DEFAULT \'ja\':言語:Language'],
// ── Education field ──
LearningPlan:[_U,_T,_D,'subject:VARCHAR(100)::科目:Subject','target_date:DATE::目標日:Target date','daily_minutes:INT::1日学習時間(分):Daily minutes','status:VARCHAR(20):DEFAULT \'active\':ステータス:Status','ai_generated:BOOLEAN:DEFAULT false:AI生成:AI generated'],
LearningGoal:[_U,'plan_id:UUID:FK(LearningPlan) NOT NULL:プランID:Plan ID',_T,'target_skill:VARCHAR(255)::目標スキル:Target skill','measurable_criteria:TEXT::測定基準:Measurable criteria','deadline:DATE::期限:Deadline','achieved_at:TIMESTAMP::達成日時:Achieved at','progress_pct:INT:DEFAULT 0:進捗(%):Progress(%)'],
QuizResult:[_U,'quiz_id:UUID:FK(Quiz) NOT NULL:クイズID:Quiz ID','score:INT:NOT NULL:スコア:Score','max_score:INT:NOT NULL:満点:Max score','answers:JSONB::回答:Answers','taken_at:TIMESTAMP:DEFAULT NOW:受験日時:Taken at','time_taken_sec:INT::所要時間(秒):Time taken'],
StudySession:[_U,'subject:VARCHAR(100):NOT NULL:科目:Subject','started_at:TIMESTAMP:NOT NULL:開始日時:Started at','ended_at:TIMESTAMP::終了日時:Ended at','duration_min:INT::学習時間(分):Duration min','focus_score:INT::集中スコア:Focus score','notes:TEXT::メモ:Notes'],
// ── Art & Design field ──
ArtWork:[_U,_T,'artist_id:UUID:FK(User) NOT NULL:作家ID:Artist ID','medium:VARCHAR(100)::制作手法:Medium','year_created:INT::制作年:Year created','image_url:TEXT::画像URL:Image url','style_tags:JSONB::スタイルタグ:Style tags',_SA,'price:DECIMAL(10,2)::価格:Price'],
GeneratedImage:[_U,'prompt:TEXT:NOT NULL:プロンプト:Prompt','model:VARCHAR(50):NOT NULL:使用モデル:Model','image_url:TEXT:NOT NULL:画像URL:Image URL','style_preset_id:UUID:FK(StylePreset):スタイルID:Style preset ID','generation_params:JSONB::生成パラメータ:Generation params','generated_at:TIMESTAMP:DEFAULT NOW:生成日時:Generated at'],
StylePreset:[_U,_T,_D,'prompt_fragment:TEXT::プロンプト断片:Prompt fragment','negative_prompt:TEXT::ネガティブプロンプト:Negative prompt','preview_url:TEXT::プレビューURL:Preview URL','is_public:BOOLEAN:DEFAULT false:公開:Public','usage_count:INT:DEFAULT 0:使用回数:Usage count'],
MusicTrack:[_U,_T,'genre:VARCHAR(50)::ジャンル:Genre','duration_sec:INT::長さ(秒):Duration sec','bpm:INT::BPM:BPM','key_signature:VARCHAR(10)::調:Key','file_url:TEXT::ファイルURL:File URL','model_used:VARCHAR(50)::使用モデル:Model used','status:VARCHAR(20):DEFAULT \'draft\':ステータス:Status'],
Arrangement:[_U,'track_id:UUID:FK(MusicTrack) NOT NULL:トラックID:Track ID',_T,'description:TEXT::説明:Description','instruments:JSONB::楽器:Instruments','score_url:TEXT::楽譜URL:Score URL',_SA],
PortfolioItem:[_U,'artwork_id:UUID:FK(ArtWork):作品ID:Artwork ID',_T,'item_type:VARCHAR(50)::種別:Item type','media_url:TEXT:NOT NULL:メディアURL:Media URL','description:TEXT::説明:Description',_SO,'is_featured:BOOLEAN:DEFAULT false:フィーチャー:Featured'],
// ── Interdisciplinary field ──
KnowledgeItem:[_U,_T,'content:TEXT:NOT NULL:内容:Content',_CAT,'source_url:TEXT::出典URL:Source URL','tags:JSONB::タグ:Tags','embedding:JSONB::埋め込み:Embedding','is_verified:BOOLEAN:DEFAULT false:検証済:Verified'],
ResearchQuery:[_U,'query:TEXT:NOT NULL:検索クエリ:Query','domain:VARCHAR(50)::分野:Domain','results:JSONB::結果:Results','sources_count:INT:DEFAULT 0:ソース数:Sources count','answered_at:TIMESTAMP::回答日時:Answered at','status:VARCHAR(20):DEFAULT \'pending\':ステータス:Status'],
Community:[_U,'community_name:VARCHAR(255):NOT NULL:コミュニティ名:Community name','description:TEXT::説明:Description','is_private:BOOLEAN:DEFAULT false:非公開:Private','member_count:INT:DEFAULT 0:メンバー数:Member count',_SA],
// ── Environment/Energy field ──
CarbonEmission:[_U,'source_type:VARCHAR(50):NOT NULL:排出源種別:Source type','scope:INT:DEFAULT 1:スコープ(1-3):Scope','amount_kg_co2e:DECIMAL(12,4):NOT NULL:排出量kgCO2e:Amount kg CO2e','period_start:DATE:NOT NULL:期間開始:Period start','period_end:DATE:NOT NULL:期間終了:Period end','calculation_method:VARCHAR(100)::算定方法:Calculation method'],
EnergyAsset:[_U,'asset_name:VARCHAR(255):NOT NULL:資産名:Asset name','asset_type:VARCHAR(50):NOT NULL:種別:Asset type','capacity_kw:DECIMAL(10,2)::定格出力kW:Capacity kW','location:VARCHAR(255)::設置場所:Location',_SA,'installation_date:DATE::設置日:Installation date'],
EnvAssessment:[_U,_T,_D,'project_id:UUID:FK(Project):プロジェクトID:Project ID','assessment_type:VARCHAR(50)::評価種別:Assessment type','findings:JSONB::調査結果:Findings',_SP,'reviewed_at:TIMESTAMP::審査日:Reviewed at','reviewer_id:UUID:FK(User):審査者ID:Reviewer ID'],
ESGReport:[_U,_T,'fiscal_year:INT:NOT NULL:会計年度:Fiscal year','environmental_score:DECIMAL(5,2)::E(環境)スコア:E score','social_score:DECIMAL(5,2)::S(社会)スコア:S score','governance_score:DECIMAL(5,2)::G(ガバナンス)スコア:G score','data:JSONB::ESGデータ:ESG data','published_at:TIMESTAMP::公開日時:Published at',_SA],
RenewableSource:[_U,'source_name:VARCHAR(255):NOT NULL:電源名:Source name','source_type:VARCHAR(50):NOT NULL:再エネ種別:Source type','capacity_kw:DECIMAL(10,2):NOT NULL:出力kW:Capacity kW','location:VARCHAR(255)::設置場所:Location','installed_at:DATE::設置日:Installed at',_SA,'forecast_accuracy:DECIMAL(5,2)::予測精度(%):Forecast accuracy'],
// ── Architecture/Urban Planning field ──
BIMModel:[_U,_T,'project_id:UUID:FK(Project):プロジェクトID:Project ID','file_url:TEXT:NOT NULL:ファイルURL:File URL','format:VARCHAR(20)::フォーマット:Format','version:VARCHAR(20)::バージョン:Version','lod:INT::LOD(0-500):LOD','element_count:INT::要素数:Element count'],
BuildingElement:['bim_model_id:UUID:FK(BIMModel) NOT NULL:BIMモデルID:BIM model ID','element_type:VARCHAR(50):NOT NULL:要素種別:Element type','ifc_guid:VARCHAR(50):UNIQUE:IFC GUID:IFC GUID','properties:JSONB::プロパティ:Properties',_M],
ZoningCheck:[_U,'location:TEXT:NOT NULL:場所:Location','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude','zone_type:VARCHAR(100)::用途地域:Zone type','building_coverage:DECIMAL(5,2)::建蔽率(%):Building coverage','floor_area_ratio:DECIMAL(5,2)::容積率(%):Floor area ratio','applicable_regulations:JSONB::適用法規:Applicable regulations','checked_at:TIMESTAMP:DEFAULT NOW:確認日時:Checked at'],
UrbanModel:[_U,_T,_D,'area_name:VARCHAR(255)::地区名:Area name','geometry:JSONB::ジオメトリ:Geometry','simulation_type:VARCHAR(50)::シミュレーション種別:Simulation type','parameters:JSONB::パラメータ:Parameters',_SA],
PropertyValuation:[_U,'property_id:UUID:FK(Property) NOT NULL:物件ID:Property ID','valuation_date:DATE:NOT NULL:評価日:Valuation date','estimated_value:DECIMAL(14,2):NOT NULL:推定価値:Estimated value','method:VARCHAR(50)::評価方法:Method','comparable_data:JSONB::比較データ:Comparable data','confidence:VARCHAR(20)::信頼度:Confidence'],
// ── Sports/Athletics field ──
Athlete:[_U,'athlete_name:VARCHAR(255):NOT NULL:アスリート名:Athlete name','sport:VARCHAR(50):NOT NULL:競技:Sport','position:VARCHAR(100)::ポジション:Position','date_of_birth:DATE::生年月日:Date of birth','team_id:VARCHAR(100)::チームID:Team ID',_SA,'height_cm:INT::身長cm:Height cm','weight_kg:DECIMAL(5,1)::体重kg:Weight kg'],
PerformanceLog:[_U,'athlete_id:UUID:FK(Athlete) NOT NULL:アスリートID:Athlete ID','recorded_at:TIMESTAMP:DEFAULT NOW:記録日時:Recorded at','metrics:JSONB:NOT NULL:パフォーマンス指標:Metrics','event:VARCHAR(100)::競技種目:Event','conditions:JSONB::コンディション:Conditions',_N],
InjuryReport:[_U,'athlete_id:UUID:FK(Athlete) NOT NULL:アスリートID:Athlete ID','injury_type:VARCHAR(100):NOT NULL:怪我種別:Injury type','body_part:VARCHAR(100)::部位:Body part','severity:VARCHAR(20):DEFAULT \'minor\':重症度:Severity','occurred_at:TIMESTAMP:DEFAULT NOW:受傷日時:Occurred at','expected_recovery_days:INT::回復予定日数:Recovery days',_SP,'doctor_id:UUID:FK(User):担当医ID:Doctor ID'],
TrainingPlan:[_U,'athlete_id:UUID:FK(Athlete) NOT NULL:アスリートID:Athlete ID',_T,_D,'start_date:DATE:NOT NULL:開始日:Start date','end_date:DATE::終了日:End date','sessions:JSONB::セッション計画:Sessions',_SA,'coach_id:UUID:FK(User):コーチID:Coach ID'],
GameEvent:[_U,'event_name:VARCHAR(255):NOT NULL:大会名:Event name','sport:VARCHAR(50)::競技:Sport','venue_id:UUID:FK(Venue):会場ID:Venue ID','starts_at:TIMESTAMP:NOT NULL:開始日時:Starts at','ends_at:TIMESTAMP:NOT NULL:終了日時:Ends at','capacity:INT::定員:Capacity',_SA],
StadiumEvent:[_U,'event_name:VARCHAR(255):NOT NULL:イベント名:Event name','venue_id:UUID:FK(Venue) NOT NULL:会場ID:Venue ID','starts_at:TIMESTAMP:NOT NULL:開始日時:Starts at','ticket_price:DECIMAL(10,2)::チケット料金:Ticket price','total_tickets:INT::総チケット数:Total tickets','sold_tickets:INT:DEFAULT 0:販売済:Sold tickets',_SA],
Coach:[_U,'coach_name:VARCHAR(255):NOT NULL:コーチ名:Coach name','sport:VARCHAR(50)::担当競技:Sport','certification:TEXT::資格:Certification','is_available:BOOLEAN:DEFAULT true:対応可能:Available','rating:DECIMAL(3,2)::評価:Rating'],
// ── Welfare/Care field ──
CarePlan:[_U,'patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','care_type:VARCHAR(50):NOT NULL:ケア種別:Care type','goals:JSONB::目標:Goals','services:JSONB::サービス内容:Services','started_at:DATE:NOT NULL:開始日:Started at','reviewed_at:DATE::見直し日:Reviewed at',_SA,'care_manager_id:UUID:FK(User):ケアマネージャーID:Care manager ID'],
CareActivity:[_U,'care_plan_id:UUID:FK(CarePlan) NOT NULL:ケアプランID:Care plan ID','patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','activity_type:VARCHAR(50):NOT NULL:活動種別:Activity type','performed_at:TIMESTAMP:DEFAULT NOW:実施日時:Performed at',_DUR,'notes:TEXT::メモ:Notes','caregiver_id:UUID:FK(User):介護者ID:Caregiver ID'],
CognitionTest:[_U,'patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','test_type:VARCHAR(50):NOT NULL:検査種別:Test type','score:INT:NOT NULL:スコア:Score','max_score:INT:NOT NULL:満点:Max score','tested_at:TIMESTAMP:DEFAULT NOW:検査日時:Tested at','evaluator_id:UUID:FK(User):評価者ID:Evaluator ID',_N],
MonitoringAlert:[_U,'patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','alert_type:VARCHAR(50):NOT NULL:アラート種別:Alert type','severity:VARCHAR(20):DEFAULT \'warning\':重要度:Severity','message:TEXT:NOT NULL:メッセージ:Message','triggered_at:TIMESTAMP:DEFAULT NOW:発生日時:Triggered at','acknowledged_at:TIMESTAMP::確認日時:Acknowledged at','responder_id:UUID:FK(User):対応者ID:Responder ID'],
EmploymentMatch:[_U,'job_seeker_id:UUID:FK(User) NOT NULL:求職者ID:Job seeker ID','employer_id:UUID:FK(User) NOT NULL:雇用者ID:Employer ID','match_score:DECIMAL(5,2)::マッチスコア:Match score','status:VARCHAR(20):DEFAULT \'pending\':ステータス:Status','matched_at:TIMESTAMP:DEFAULT NOW:マッチ日時:Matched at','job_title:VARCHAR(255)::職種:Job title','support_type:VARCHAR(100)::支援種別:Support type'],
CareRecord:[_U,'patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','caregiver_id:UUID:FK(User) NOT NULL:介護者ID:Caregiver ID','record_date:TIMESTAMP:DEFAULT NOW:記録日時:Record date','record_type:VARCHAR(50):NOT NULL:記録種別:Record type','content:TEXT:NOT NULL:内容:Content','vital_signs:JSONB::バイタルサイン:Vital signs'],
// ── Tourism/Hospitality field ──
Attraction:['attraction_name:VARCHAR(255):NOT NULL:観光スポット名:Attraction name','location:TEXT::場所:Location','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude','category:VARCHAR(50)::カテゴリ:Category',_D,'image_url:TEXT::画像URL:Image URL','rating:DECIMAL(3,2)::評価:Rating',_SA],
TravelPlan:[_U,_T,'destination:VARCHAR(255):NOT NULL:目的地:Destination','start_date:DATE:NOT NULL:開始日:Start date','end_date:DATE:NOT NULL:終了日:End date','budget:DECIMAL(10,2)::予算:Budget','plan_data:JSONB::プラン詳細:Plan data','ai_generated:BOOLEAN:DEFAULT false:AI生成:AI generated'],
TourismStats:['region:VARCHAR(255):NOT NULL:地域:Region','period:DATE:NOT NULL:集計期間:Period','visitor_count:INT::訪問者数:Visitor count','revenue_jpy:DECIMAL(14,2)::観光消費額:Revenue','avg_stay_days:DECIMAL(5,2)::平均滞在日数:Avg stay days','top_attractions:JSONB::人気スポット:Top attractions','source:VARCHAR(100)::データソース:Data source'],
HotelOperation:[_U,'hotel_id:UUID:FK(Hotel) NOT NULL:ホテルID:Hotel ID','date:DATE:NOT NULL:日付:Date','occupancy_rate:DECIMAL(5,2)::稼働率(%):Occupancy rate','revenue:DECIMAL(12,2)::売上:Revenue','checkins:INT::チェックイン数:Checkins','checkouts:INT::チェックアウト数:Checkouts','staff_count:INT::スタッフ数:Staff count'],
ConciergeBotSession:[_U,'language:VARCHAR(10):DEFAULT \'ja\':言語:Language','messages:JSONB::メッセージ履歴:Messages','topic:VARCHAR(100)::トピック:Topic','satisfaction_score:INT::満足度:Satisfaction','started_at:TIMESTAMP:DEFAULT NOW:開始日時:Started at','ended_at:TIMESTAMP::終了日時:Ended at'],
// ── Biotech/LifeScience ──
Compound:[_U,'compound_name:VARCHAR(255):NOT NULL:化合物名:Compound name','smiles:TEXT::SMILES:SMILES','molecular_formula:VARCHAR(100)::分子式:Molecular formula','molecular_weight:DECIMAL(10,4)::分子量:Molecular weight','source:VARCHAR(100)::由来:Source',_SA,'properties:JSONB::物性:Properties'],
MolecularTarget:[_U,_T,'target_type:VARCHAR(50)::ターゲット種別:Target type','gene_name:VARCHAR(100)::遺伝子名:Gene name','protein_name:VARCHAR(255)::タンパク質名:Protein name','disease_area:VARCHAR(100)::疾患領域:Disease area',_D],
BindingResult:[_U,'compound_id:UUID:FK(Compound) NOT NULL:化合物ID:Compound ID','target_id:UUID:FK(MolecularTarget) NOT NULL:ターゲットID:Target ID','binding_affinity:DECIMAL(15,6)::結合親和性:Binding affinity','ic50:DECIMAL(15,6)::IC50:IC50','assay_type:VARCHAR(100)::アッセイ種別:Assay type','tested_at:TIMESTAMP:DEFAULT NOW:試験日:Tested at',_N],
GenomeSample:[_U,'sample_id:VARCHAR(100):UNIQUE NOT NULL:サンプルID:Sample ID','species:VARCHAR(100)::種:Species','tissue_type:VARCHAR(100)::組織種別:Tissue type','collection_date:DATE::採取日:Collection date','quality_score:DECIMAL(5,2)::品質スコア:Quality score','sequencing_platform:VARCHAR(100)::シーケンサー:Sequencing platform',_SA],
VariantCall:[_U,'sample_id:UUID:FK(GenomeSample) NOT NULL:サンプルID:Sample ID','chromosome:VARCHAR(20)::染色体:Chromosome','position:BIGINT::位置:Position','ref_allele:VARCHAR(255)::参照アリル:Ref allele','alt_allele:VARCHAR(255)::変異アリル:Alt allele','quality:DECIMAL(8,2)::品質スコア:Quality','impact:VARCHAR(20)::影響度:Impact'],
GeneticRisk:[_U,'sample_id:UUID:FK(GenomeSample) NOT NULL:サンプルID:Sample ID','disease:VARCHAR(255):NOT NULL:疾患:Disease','risk_score:DECIMAL(5,4):NOT NULL:リスクスコア:Risk score','percentile:INT::パーセンタイル:Percentile','variants_count:INT::関連変異数:Variants count','calculated_at:TIMESTAMP:DEFAULT NOW:算出日時:Calculated at'],
ClinicalTrial:[_U,_T,_D,'phase:VARCHAR(20):NOT NULL:フェーズ:Phase','compound_id:UUID:FK(Compound):化合物ID:Compound ID','indication:VARCHAR(255)::適応症:Indication','start_date:DATE::開始日:Start date','end_date:DATE::終了日:End date','status:VARCHAR(20):DEFAULT \'recruiting\':ステータス:Status','sponsor:VARCHAR(255)::スポンサー:Sponsor'],
TrialSubject:[_U,'trial_id:UUID:FK(ClinicalTrial) NOT NULL:試験ID:Trial ID','subject_code:VARCHAR(50):UNIQUE:被験者コード:Subject code','enrolled_at:TIMESTAMP:DEFAULT NOW:登録日時:Enrolled at','arm:VARCHAR(50)::群:Arm',_SA,'age:INT::年齢:Age','gender:VARCHAR(20)::性別:Gender'],
AdverseEvent:[_U,'trial_id:UUID:FK(ClinicalTrial) NOT NULL:試験ID:Trial ID','subject_id:UUID:FK(TrialSubject) NOT NULL:被験者ID:Subject ID','event_name:VARCHAR(255):NOT NULL:有害事象名:Event name','severity:VARCHAR(20):NOT NULL:重症度:Severity','onset_date:DATE:NOT NULL:発現日:Onset date','resolved_date:DATE::回復日:Resolved date','causality:VARCHAR(50)::因果関係:Causality'],
ProteinStructure:[_U,'protein_name:VARCHAR(255):NOT NULL:タンパク質名:Protein name','pdb_id:VARCHAR(10)::PDB ID:PDB ID','sequence:TEXT::アミノ酸配列:Sequence','structure_url:TEXT::構造ファイルURL:Structure file URL','resolution_angstrom:DECIMAL(5,2)::分解能Å:Resolution','method:VARCHAR(100)::決定方法:Method'],
OmicsDataset:[_U,_T,'omics_type:VARCHAR(50):NOT NULL:オミクス種別:Omics type','sample_count:INT::サンプル数:Sample count','feature_count:INT::フィーチャー数:Feature count','platform:VARCHAR(100)::プラットフォーム:Platform','data_url:TEXT::データURL:Data URL','processed:BOOLEAN:DEFAULT false:処理済:Processed'],
BioAnalysis:[_U,'dataset_id:UUID:FK(OmicsDataset):データセットID:Dataset ID',_T,'analysis_type:VARCHAR(50):NOT NULL:解析種別:Analysis type','parameters:JSONB::パラメータ:Parameters','results:JSONB::結果:Results','status:VARCHAR(20):DEFAULT \'pending\':ステータス:Status','completed_at:TIMESTAMP::完了日時:Completed at'],
// ── Mobility/Autonomous ──
DrivingSession:[_U,'vehicle_id:VARCHAR(100)::車両ID:Vehicle ID','started_at:TIMESTAMP:NOT NULL:開始日時:Started at','ended_at:TIMESTAMP::終了日時:Ended at','distance_km:DECIMAL(10,3)::走行距離km:Distance km','route:JSONB::経路:Route','mode:VARCHAR(20):DEFAULT \'manual\':走行モード:Mode','events:JSONB::イベント:Events'],
SimScenario:[_U,_T,_D,'scenario_type:VARCHAR(50)::シナリオ種別:Scenario type','parameters:JSONB::パラメータ:Parameters','difficulty:VARCHAR(20)::難易度:Difficulty',_IA],
SafetyEval:[_U,'session_id:UUID:FK(DrivingSession):セッションID:Session ID','scenario_id:UUID:FK(SimScenario):シナリオID:Scenario ID','metric:VARCHAR(100):NOT NULL:評価指標:Metric','score:DECIMAL(5,2):NOT NULL:スコア:Score','details:JSONB::詳細:Details','evaluated_at:TIMESTAMP:DEFAULT NOW:評価日時:Evaluated at'],
TrafficSignal:[_U,'intersection_id:VARCHAR(100):NOT NULL:交差点ID:Intersection ID','location:TEXT::場所:Location','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude','phase_plan:JSONB::信号現示計画:Phase plan',_SA,'last_sync:TIMESTAMP::最終同期:Last sync'],
TrafficSensor:[_U,'sensor_id:VARCHAR(100):NOT NULL:センサーID:Sensor ID','location:TEXT::設置場所:Location','sensor_type:VARCHAR(50)::種別:Sensor type',_SA,'vehicle_count:INT:DEFAULT 0:通過台数:Vehicle count'],
TrafficModel:[_U,_T,_D,'area:JSONB::対象エリア:Area','algorithm:VARCHAR(100)::アルゴリズム:Algorithm','parameters:JSONB::パラメータ:Parameters',_SA,'trained_at:TIMESTAMP::学習日時:Trained at'],
ChargeStation:[_U,'station_name:VARCHAR(255):NOT NULL:充電スタンド名:Station name','location:TEXT::場所:Location','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude','charger_count:INT:NOT NULL:充電器数:Charger count','max_kw:DECIMAL(8,2)::最大出力kW:Max kW',_SA,'operator_id:UUID:FK(User):運営者ID:Operator ID'],
ChargeSession:[_U,'station_id:UUID:FK(ChargeStation) NOT NULL:スタンドID:Station ID','ev_id:UUID:FK(EVBattery):EV ID:EV ID','started_at:TIMESTAMP:NOT NULL:開始日時:Started at','ended_at:TIMESTAMP::終了日時:Ended at','energy_kwh:DECIMAL(8,3)::充電量kWh:Energy kWh','cost:DECIMAL(10,2)::料金:Cost',_SA],
EVBattery:[_U,'vehicle_id:VARCHAR(100):NOT NULL:車両ID:Vehicle ID','capacity_kwh:DECIMAL(8,2):NOT NULL:容量kWh:Capacity kWh','current_soc_pct:DECIMAL(5,2)::現在SOC(%):Current SOC','health_pct:DECIMAL(5,2)::バッテリー健全性(%):Battery health','chemistry:VARCHAR(50)::電池化学:Chemistry','last_updated:TIMESTAMP:DEFAULT NOW:最終更新:Last updated'],
TripPlan:[_U,'origin:TEXT:NOT NULL:出発地:Origin','destination:TEXT:NOT NULL:目的地:Destination','departure_time:TIMESTAMP:NOT NULL:出発時刻:Departure time','modes:JSONB::交通手段:Modes','route_segments:JSONB::ルートセグメント:Route segments','total_duration_min:INT::総所要時間(分):Total duration','total_cost:DECIMAL(10,2)::総費用:Total cost'],
TransitOption:['trip_plan_id:UUID:FK(TripPlan) NOT NULL:TripプランID:Trip plan ID','mode:VARCHAR(50):NOT NULL:交通手段:Mode','line:VARCHAR(100)::路線:Line','departure:TEXT::出発:Departure','arrival:TEXT::到着:Arrival','duration_min:INT::所要時間(分):Duration min','cost:DECIMAL(10,2)::料金:Cost',_SO],
MobilityPass:[_U,'pass_type:VARCHAR(50):NOT NULL:パス種別:Pass type','valid_from:DATE:NOT NULL:有効開始:Valid from','valid_until:DATE:NOT NULL:有効終了:Valid until','modes_included:JSONB::対象交通手段:Modes included','balance:DECIMAL(10,2)::残高:Balance',_SA,'stripe_subscription_id:TEXT::StripeサブスクID:Stripe sub ID'],
// ── Cybersecurity ──
ThreatAlert:[_U,'alert_type:VARCHAR(50):NOT NULL:アラート種別:Alert type','severity:VARCHAR(20):DEFAULT \'medium\':重要度:Severity','source_ip:VARCHAR(45)::送信元IP:Source IP','destination_ip:VARCHAR(45)::宛先IP:Dest IP','description:TEXT::説明:Description','detected_at:TIMESTAMP:DEFAULT NOW:検知日時:Detected at','acknowledged_at:TIMESTAMP::確認日時:Acknowledged at',_SP],
SecurityIncident:[_U,_T,_D,'incident_type:VARCHAR(50):NOT NULL:インシデント種別:Incident type','severity:VARCHAR(20):DEFAULT \'medium\':重要度:Severity','reported_at:TIMESTAMP:DEFAULT NOW:報告日時:Reported at','resolved_at:TIMESTAMP::解決日時:Resolved at','affected_systems:JSONB::影響システム:Affected systems',_SP,'assigned_to:UUID:FK(User):担当者ID:Assigned to'],
IncidentResponse:[_U,'incident_id:UUID:FK(SecurityIncident) NOT NULL:インシデントID:Incident ID','action_type:VARCHAR(50):NOT NULL:対応種別:Action type','description:TEXT:NOT NULL:内容:Description','performed_at:TIMESTAMP:DEFAULT NOW:実施日時:Performed at','outcome:TEXT::結果:Outcome','responder_id:UUID:FK(User):対応者ID:Responder ID'],
VulnScan:[_U,'target:VARCHAR(500):NOT NULL:対象:Target','scan_type:VARCHAR(50):NOT NULL:スキャン種別:Scan type','started_at:TIMESTAMP:NOT NULL:開始日時:Started at','completed_at:TIMESTAMP::完了日時:Completed at','findings:JSONB::発見事項:Findings','critical_count:INT:DEFAULT 0:クリティカル数:Critical count','high_count:INT:DEFAULT 0:高リスク数:High count',_SA],
PenTestReport:[_U,_T,'scope:TEXT:NOT NULL:スコープ:Scope','methodology:TEXT::手法:Methodology','findings:JSONB:NOT NULL:発見事項:Findings','risk_rating:VARCHAR(20)::リスク評価:Risk rating','executive_summary:TEXT::エグゼクティブサマリー:Executive summary','tested_at:TIMESTAMP:NOT NULL:実施日:Tested at','report_url:TEXT::レポートURL:Report URL'],
RemediationTask:[_U,'vuln_scan_id:UUID:FK(VulnScan):スキャンID:Vuln scan ID','title:VARCHAR(255):NOT NULL:タイトル:Title','description:TEXT::説明:Description','severity:VARCHAR(20)::重要度:Severity','due_date:DATE::期限:Due date',_SP,'assigned_to:UUID:FK(User):担当者ID:Assigned to','completed_at:TIMESTAMP::完了日時:Completed at'],
PhishingCampaign:[_U,_T,_D,'campaign_type:VARCHAR(50):NOT NULL:キャンペーン種別:Campaign type','target_count:INT::対象者数:Target count','sent_count:INT:DEFAULT 0:送信数:Sent count','clicked_count:INT:DEFAULT 0:クリック数:Clicked count','reported_count:INT:DEFAULT 0:報告数:Reported count','launched_at:TIMESTAMP::実施日時:Launched at',_SA],
SecurityTraining:[_U,'trainee_id:UUID:FK(User) NOT NULL:受講者ID:Trainee ID','course_name:VARCHAR(255):NOT NULL:コース名:Course name','completed_at:TIMESTAMP::完了日時:Completed at','score:INT::スコア:Score','certificate_url:TEXT::証明書URL:Certificate URL',_SA],
SecurityPolicy:[_U,_T,'policy_type:VARCHAR(50)::ポリシー種別:Policy type','content:TEXT:NOT NULL:内容:Content','version:VARCHAR(20)::バージョン:Version','effective_date:DATE:NOT NULL:施行日:Effective date','review_date:DATE::見直し日:Review date',_SA,'owner_id:UUID:FK(User):オーナーID:Owner ID'],
ComplianceGap:[_U,'framework:VARCHAR(100):NOT NULL:フレームワーク:Framework','control_id:VARCHAR(100)::統制ID:Control ID','description:TEXT:NOT NULL:説明:Description','gap_type:VARCHAR(50)::ギャップ種別:Gap type','severity:VARCHAR(20):DEFAULT \'medium\':重要度:Severity',_SP,'remediation_plan:TEXT::是正計画:Remediation plan','due_date:DATE::期限:Due date'],
// ── Fintech Field ──
CreditApplication:[_U,'applicant_id:UUID:FK(User) NOT NULL:申請者ID:Applicant ID','product_type:VARCHAR(50):NOT NULL:商品種別:Product type','requested_amount:DECIMAL(12,2):NOT NULL:申請金額:Requested amount','purpose:VARCHAR(255)::目的:Purpose','applied_at:TIMESTAMP:DEFAULT NOW:申請日時:Applied at',_SP,'assigned_reviewer:UUID:FK(User):審査担当者ID:Assigned reviewer'],
CreditScore:[_U,'applicant_id:UUID:FK(User) NOT NULL:申請者ID:Applicant ID','score:INT:NOT NULL:スコア:Score','grade:VARCHAR(5)::グレード:Grade','factors:JSONB::要因:Factors','model_version:VARCHAR(20)::モデルバージョン:Model version','calculated_at:TIMESTAMP:DEFAULT NOW:算出日時:Calculated at','expires_at:TIMESTAMP::有効期限:Expires at'],
CreditDecision:[_U,'application_id:UUID:FK(CreditApplication) NOT NULL:申請ID:Application ID','decision:VARCHAR(20):NOT NULL:判定:Decision','approved_amount:DECIMAL(12,2)::承認金額:Approved amount','interest_rate:DECIMAL(5,4)::金利:Interest rate','reason:TEXT::理由:Reason','decided_at:TIMESTAMP:DEFAULT NOW:判定日時:Decided at','decided_by:UUID:FK(User):判定者ID:Decided by'],
FraudAlert:[_U,'transaction_id:VARCHAR(255)::取引ID:Transaction ID','alert_type:VARCHAR(50):NOT NULL:アラート種別:Alert type','risk_score:DECIMAL(5,4):NOT NULL:リスクスコア:Risk score','amount:DECIMAL(12,2)::金額:Amount','triggered_at:TIMESTAMP:DEFAULT NOW:検知日時:Triggered at',_SP,'reviewed_by:UUID:FK(User):審査者ID:Reviewed by','false_positive:BOOLEAN::誤検知:False positive'],
SARReport:[_U,'reference_number:VARCHAR(100):UNIQUE:参照番号:Reference number','subject_type:VARCHAR(50):NOT NULL:対象種別:Subject type','suspicious_activity:TEXT:NOT NULL:疑わしい活動:Suspicious activity','amount:DECIMAL(14,2)::金額:Amount','reported_at:TIMESTAMP:DEFAULT NOW:報告日時:Reported at',_SP,'submitted_to:VARCHAR(100)::提出先:Submitted to'],
CryptoPortfolio:[_U,'wallet_address:VARCHAR(255)::ウォレットアドレス:Wallet address','chain:VARCHAR(50):NOT NULL:チェーン:Chain','total_value_usd:DECIMAL(14,4)::総額USD:Total value USD','holdings:JSONB::保有資産:Holdings','last_updated:TIMESTAMP:DEFAULT NOW:最終更新:Last updated'],
DeFiPosition:[_U,'portfolio_id:UUID:FK(CryptoPortfolio) NOT NULL:ポートフォリオID:Portfolio ID','protocol:VARCHAR(100):NOT NULL:プロトコル:Protocol','position_type:VARCHAR(50)::ポジション種別:Position type','assets:JSONB::資産:Assets','apr:DECIMAL(8,4)::APR(%):APR','health_factor:DECIMAL(8,4)::健全性指標:Health factor','last_updated:TIMESTAMP:DEFAULT NOW:最終更新:Last updated'],
SmartContractAudit:[_U,'contract_address:VARCHAR(255)::コントラクトアドレス:Contract address','chain:VARCHAR(50)::チェーン:Chain',_T,'findings:JSONB::発見事項:Findings','severity_summary:JSONB::重要度サマリー:Severity summary','audited_at:TIMESTAMP:NOT NULL:監査日:Audited at','report_url:TEXT::レポートURL:Report URL',_SA],
FinancialPlan:[_U,_T,_D,'income:DECIMAL(12,2)::年収:Income','expenses:DECIMAL(12,2)::年間支出:Expenses','savings_goal:DECIMAL(12,2)::貯蓄目標:Savings goal','investment_goal:DECIMAL(12,2)::投資目標:Investment goal','plan_data:JSONB::プラン詳細:Plan data',_SA],
InvestmentAdvice:[_U,'plan_id:UUID:FK(FinancialPlan):プランID:Financial plan ID','asset_class:VARCHAR(100):NOT NULL:資産クラス:Asset class','allocation_pct:DECIMAL(5,2):NOT NULL:配分(%):Allocation','rationale:TEXT::根拠:Rationale','risk_level:VARCHAR(20)::リスク水準:Risk level','generated_at:TIMESTAMP:DEFAULT NOW:生成日時:Generated at'],
// ── Smart Factory/Manufacturing DX ──
DigitalTwinModel:[_U,_T,_D,'entity_type:VARCHAR(50):NOT NULL:エンティティ種別:Entity type','physical_id:VARCHAR(255)::物理ID:Physical ID','model_url:TEXT::モデルURL:Model URL','sync_interval_sec:INT:DEFAULT 60:同期間隔(秒):Sync interval','last_sync:TIMESTAMP::最終同期:Last sync',_SA],
FactoryLine:[_U,'line_name:VARCHAR(255):NOT NULL:ライン名:Line name','location:VARCHAR(255)::場所:Location','capacity_per_hour:INT::時間生産数:Capacity per hour',_SA,'twin_id:UUID:FK(DigitalTwinModel):デジタルツインID:Twin ID','supervisor_id:UUID:FK(User):監督者ID:Supervisor ID'],
RobotTask:[_U,'robot_id:VARCHAR(100):NOT NULL:ロボットID:Robot ID','task_type:VARCHAR(50):NOT NULL:タスク種別:Task type','payload:JSONB::タスク内容:Payload','priority:INT:DEFAULT 0:優先度:Priority',_SP,'started_at:TIMESTAMP::開始日時:Started at','completed_at:TIMESTAMP::完了日時:Completed at','error:TEXT::エラー:Error'],
RobotConfig:[_U,'robot_id:VARCHAR(100):NOT NULL:ロボットID:Robot ID',_T,'capabilities:JSONB::能力:Capabilities','parameters:JSONB::パラメータ:Parameters',_SA,'firmware_version:VARCHAR(50)::ファームウェア:Firmware','last_calibrated:TIMESTAMP::最終キャリブレーション:Last calibrated'],
CoordinationPlan:[_U,_T,_D,'robots:JSONB:NOT NULL:対象ロボット:Robots','schedule:JSONB::スケジュール:Schedule',_SA,'line_id:UUID:FK(FactoryLine):ラインID:Line ID','production_order_id:UUID:FK(ProductionOrder):製造指示ID:Production order'],
SupplyNode:['node_name:VARCHAR(255):NOT NULL:ノード名:Node name','node_type:VARCHAR(50):NOT NULL:ノード種別:Node type','location:TEXT::場所:Location','capacity:DECIMAL(12,2)::容量:Capacity','current_stock:DECIMAL(12,2)::現在庫:Current stock',_SA,'lead_time_days:INT::リードタイム(日):Lead time'],
DemandForecast:[_U,'product_id:VARCHAR(100):NOT NULL:製品ID:Product ID','forecast_period:DATE:NOT NULL:予測期間:Forecast period','forecast_qty:DECIMAL(12,2):NOT NULL:予測数量:Forecast qty','confidence:DECIMAL(5,2)::信頼区間(%):Confidence','model_used:VARCHAR(100)::使用モデル:Model used','generated_at:TIMESTAMP:DEFAULT NOW:生成日時:Generated at'],
ProcurementOrder:[_U,'supplier_id:UUID:FK(User) NOT NULL:仕入先ID:Supplier ID','items:JSONB:NOT NULL:発注品目:Items','total_amount:DECIMAL(12,2):NOT NULL:発注金額:Total amount','order_date:DATE:NOT NULL:発注日:Order date','expected_delivery:DATE::納期:Expected delivery',_SP,'approved_by:UUID:FK(User):承認者ID:Approved by'],
QualityInspection:[_U,'production_order_id:UUID:FK(ProductionOrder) NOT NULL:製造指示ID:Production order ID','line_id:UUID:FK(FactoryLine):ラインID:Line ID','sample_size:INT:NOT NULL:検査数:Sample size','defect_count:INT:DEFAULT 0:不良数:Defect count','pass:BOOLEAN:NOT NULL:合否:Pass','inspection_type:VARCHAR(50)::検査種別:Inspection type','inspected_at:TIMESTAMP:DEFAULT NOW:検査日時:Inspected at'],
DefectRecord:[_U,'production_order_id:UUID:FK(ProductionOrder) NOT NULL:製造指示ID:Production order ID','defect_type:VARCHAR(100):NOT NULL:不良種別:Defect type','severity:VARCHAR(20):DEFAULT \'minor\':重症度:Severity','location:TEXT::発生箇所:Location','root_cause:TEXT::根本原因:Root cause',_SP,'corrective_action:TEXT::是正処置:Corrective action','cost_impact:DECIMAL(10,2)::コスト影響:Cost impact'],
// ── Cross-Theme ──
AgentConfig:[_U,_T,_D,'agent_type:VARCHAR(50):NOT NULL:エージェント種別:Agent type','model:VARCHAR(50)::使用モデル:Model','system_prompt:TEXT::システムプロンプト:System prompt','tools_config:JSONB::ツール設定:Tools config','memory_type:VARCHAR(50)::メモリ種別:Memory type',_IA,'max_iterations:INT:DEFAULT 10:最大反復:Max iterations'],
AgentTask:[_U,'config_id:UUID:FK(AgentConfig) NOT NULL:設定ID:Config ID','task_description:TEXT:NOT NULL:タスク内容:Task description','input:JSONB::入力:Input','output:JSONB::出力:Output','status:VARCHAR(20):DEFAULT \'queued\':ステータス:Status','started_at:TIMESTAMP::開始日時:Started at','completed_at:TIMESTAMP::完了日時:Completed at','tokens_used:INT::使用トークン:Tokens used'],
AgentLog:['task_id:UUID:FK(AgentTask) NOT NULL:タスクID:Agent task ID','step_number:INT:NOT NULL:ステップ番号:Step number','action_type:VARCHAR(50):NOT NULL:アクション種別:Action type','thought:TEXT::思考:Thought','observation:TEXT::観察:Observation','logged_at:TIMESTAMP:DEFAULT NOW:ログ日時:Logged at'],
ToolDefinition:[_U,'tool_name:VARCHAR(100):NOT NULL:ツール名:Tool name','tool_type:VARCHAR(50):NOT NULL:ツール種別:Tool type',_D,'schema:JSONB:NOT NULL:スキーマ:Schema','endpoint:TEXT::エンドポイント:Endpoint',_IA,'api_key_id:UUID:FK(ApiKey):APIキーID:API key ID'],
DeviceProfile:[_U,'device_name:VARCHAR(255):NOT NULL:デバイス名:Device name','device_type:VARCHAR(50):NOT NULL:デバイス種別:Device type','os:VARCHAR(50)::OS:OS','memory_mb:INT::メモリMB:Memory MB','compute_tflops:DECIMAL(8,4)::計算能力TFLOPS:Compute TFLOPS',_SA,'registered_at:TIMESTAMP:DEFAULT NOW:登録日時:Registered at'],
ModelDeployment:[_U,'model_name:VARCHAR(255):NOT NULL:モデル名:Model name','model_version:VARCHAR(50):NOT NULL:バージョン:Model version','device_id:UUID:FK(DeviceProfile):デバイスID:Device ID','runtime:VARCHAR(50)::ランタイム:Runtime','quantization:VARCHAR(50)::量子化:Quantization','deployed_at:TIMESTAMP:DEFAULT NOW:デプロイ日時:Deployed at',_SA,'latency_ms:INT::レイテンシms:Latency ms'],
InferenceLog:[_U,'deployment_id:UUID:FK(ModelDeployment) NOT NULL:デプロイID:Deployment ID','input_tokens:INT::入力トークン:Input tokens','output_tokens:INT::出力トークン:Output tokens','latency_ms:INT::レイテンシms:Latency ms','power_mw:DECIMAL(8,2)::消費電力mW:Power mW','logged_at:TIMESTAMP:DEFAULT NOW:ログ日時:Logged at'],
EdgeConfig:[_U,'device_id:UUID:FK(DeviceProfile) NOT NULL:デバイスID:Device ID','config_name:VARCHAR(100):NOT NULL:設定名:Config name','sync_interval_sec:INT:DEFAULT 300:同期間隔(秒):Sync interval','offline_ttl_sec:INT:DEFAULT 86400:オフラインTTL(秒):Offline TTL','models:JSONB::モデルリスト:Models',_IA,'last_push:TIMESTAMP::最終プッシュ:Last push'],
};
// ═══ Entity REST method restrictions ═══
// Entities not listed get full CRUD: GET, GET/:id, POST, PUT/:id, DELETE/:id
const ENTITY_METHODS={
// Immutable records: create + read only (no update/delete)
Payment:['GET','GET/:id','POST'],
Transaction:['GET','GET/:id','POST'],
Invoice:['GET','GET/:id','POST'],
// Audit/log: read only
Log:['GET','GET/:id'],
RequestLog:['GET','GET/:id'],
Activity:['GET','GET/:id'],
Execution:['GET','GET/:id'],
Handoff:['GET','GET/:id'],
// User-owned singletons: no GET/:id (use auth context)
Cart:['GET','POST','PATCH/:id','DELETE/:id'],
Setting:['GET','PATCH'],
// User: PATCH preferred over PUT
User:['GET','GET/:id','POST','PATCH/:id'],
// Enrollment/subscription: create + read + cancel (soft delete)
Enrollment:['GET','GET/:id','POST','PATCH/:id'],
Subscription:['GET','GET/:id','POST','PATCH/:id'],
Attendee:['GET','GET/:id','POST','PATCH/:id','DELETE/:id'],
// Certificate: issue only
Certificate:['GET','GET/:id','POST'],
// Medical records: create + read only (no modification for compliance)
MedicalRecord:['GET','GET/:id','POST'],
Vaccination:['GET','GET/:id','POST'],
Prescription:['GET','GET/:id','POST'],
// SLA: read-only (managed by admin)
SLA:['GET','GET/:id'],
// Contracts & Leases: limited modification (status updates only via PATCH)
Lease:['GET','GET/:id','POST','PATCH/:id'],
Contract:['GET','GET/:id','POST','PATCH/:id'],
// Append-only/Read-only (A3)
AuditLog:['GET','GET/:id'],
PointLog:['GET','GET/:id'],
Achievement:['GET','GET/:id','POST'],
ClickLog:['GET','GET/:id','POST'],
SensorData:['GET','GET/:id','POST'],
};
function getEntityMethods(entityName){
return ENTITY_METHODS[entityName]||['GET','GET/:id','POST','PUT/:id','DELETE/:id'];
}
// Parse entity column definition string
function getEntityColumns(entityName,G,knownEntities){
const cols=ENTITY_COLUMNS[entityName];
if(!cols) return [];
return cols.map(c=>{
const [col,type,constraint,descJa,descEn]=c.split(':');
return {col,type:type||'TEXT',constraint:constraint||'',desc:G?(descJa||col):(descEn||col)};
}).filter(c=>{
// If knownEntities provided, filter out FK references to undefined entities
if(!knownEntities) return true;
const fkMatch=c.constraint.match(/FK\((\w+)\)/);
if(!fkMatch) return true;
return knownEntities.includes(fkMatch[1]);
});
}
function detectDomain(purpose){
const p=(purpose||'').toLowerCase();
const detect=[
// Specific patterns first (higher priority)
[/教育|学習|education|learning|lms|コース|course|tutoring|家庭教師/i,'education'],
[/\bEC\b|eコマース|e-commerce|ショップ|\bshop\b|\bcommerce\b/i,'ec'],
[/マーケットプレイス|marketplace/i,'marketplace'],
[/ゲーミ|gamification|gamify|バッジ|ポイント|リーダーボード/i,'gamify'],
[/saas|サブスク|subscription|helpdesk|ヘルプデスク|チケット管理/i,'saas'],
[/イベント|event.?management|カンファレンス|セミナー|チケット販売/i,'event'],
[/ニュースレター|newsletter|メール配信|メルマガ|購読/i,'newsletter'],
[/クリエイター|creator|ファン|コンテンツ販売|投げ銭/i,'creator'],
[/コミュニティ|community|フォーラム|forum/i,'community'],
// ── 8 new domains (before content to avoid collision) ──
[/製造|工場|生産管理|ファクトリー|manufacturing|factory|production.?management|smart.*factory/i,'manufacturing'],
[/物流|配送|倉庫|logistics|delivery|warehouse|tracking/i,'logistics'],
[/農業|スマート農業|agriculture|farming|crop.?management/i,'agriculture'],
[/エネルギー|電力|energy|power.?management|再生可能/i,'energy'],
[/メディア|放送|配信|ストリーミング|media|streaming|broadcasting/i,'media'],
[/自治体|行政|申請管理|government|municipal|civic|public.?service/i,'government'],
[/旅行|ツアー|travel|tour|宿泊予約|hotel.?booking/i,'travel'],
[/保険|insurance|保険テック|insurtech|契約管理|claim.?management/i,'insurance'],
// ── content pattern (media/メディア removed to prevent collision) ──
[/コンテンツ|content|ブログ|blog|knowledge.?base|ナレッジベース/i,'content'],
[/分析|analytics|可視化|ダッシュボード/i,'analytics'],
[/予約|booking|スケジュール|restaurant|レストラン|飲食店/i,'booking'],
[/AIエージェント|ai.?agent|chatbot|チャットボット|対話型|FAQ/i,'ai'],
[/自動化|automation|workflow|ワークフロー|RPA|ノーコード/i,'automation'],
[/共同編集|collaboration|collab|リアルタイム編集/i,'collab'],
[/開発者ツール|dev.?tool|API管理|APIキー/i,'devtool'],
[/IoT|デバイス|device|sensor|センサー|field.?service|フィールドサービス/i,'iot'],
[/不動産|物件|real.?estate|property.?mgmt|property.?management/i,'realestate'],
[/法務|契約|legal|contract.?mgmt|contract.?management|コンプライアンス/i,'legal'],
[/人事|HR|採用|recruit|hiring/i,'hr'],
[/金融|fintech|銀行|bank|決済管理|construction.?pay|工事代金/i,'fintech'],
[/医療|ヘルスケア|health|medical|clinic|病院|patient|患者|veterinary|動物病院|ペット/i,'health'],
[/ポートフォリオ|portfolio|link.?in.?bio|linkbio/i,'portfolio'],
[/pwa|progressive.?web|オフライン|offline/i,'tool'],
// Generic patterns last (lower priority)
[/業務|business|効率化|ツール|tool/i,'tool'],
];
for(const[rx,key]of detect){if(rx.test(p))return key;}
return null;
}
function inferER(a){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose);
const entities=(a.data_entities||'').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const warnings=[];
const suggestions=[];
if(domain&&DOMAIN_ENTITIES[domain]){
const d=DOMAIN_ENTITIES[domain];
entities.forEach(e=>{
if(d.warn.includes(e)){
const alt=d.suggest[e];
if(alt){
warnings.push(G?`⚠️ ${e} は${domain}ドメインでは ${alt} に置き換えることを推奨`:`⚠️ Consider replacing ${e} with ${alt} for ${domain} domain`);
suggestions.push({from:e,to:alt});
} else {
warnings.push(G?`ℹ️ ${e} は${domain}ドメインでは一般的ではありません`:`ℹ️ ${e} is uncommon in ${domain} domain`);
}
}
});
}
// ER relationships — returns simple pairs only (no chain format)
const rels=[];
const has=(n)=>entities.some(e=>e.toLowerCase()===n.toLowerCase());
// User → various
if(has('User')&&has('Post')) rels.push('User 1 ──N Post');
if(has('User')&&has('Comment')) rels.push('User 1 ──N Comment');
if(has('User')&&has('Order')) rels.push('User 1 ──N Order');
if(has('User')&&has('Booking')) rels.push('User 1 ──N Booking');
if(has('User')&&has('Review')) rels.push('User 1 ──N Review');
if(has('User')&&has('Progress')) rels.push('User 1 ──N Progress');
if(has('User')&&has('Enrollment')) rels.push('User 1 ──N Enrollment');
if(has('User')&&has('Message')) rels.push('User 1 ──N Message');
if(has('User')&&has('Notification')) rels.push('User 1 ──N Notification');
if(has('User')&&has('Subscription')) rels.push('User 1 ──N Subscription');
if(has('User')&&has('Listing')) rels.push('User 1 ──N Listing');
if(has('User')&&has('Workspace')) rels.push('User N ──M Workspace (via Member)');
// Content
if(has('Post')&&has('Comment')) rels.push('Post 1 ──N Comment');
if(has('Post')&&has('Tag')) rels.push('Post N ──M Tag');
if(has('Post')&&has('Like')) rels.push('Post 1 ──N Like');
if(has('Post')&&has('Media')) rels.push('Post 1 ──N Media');
// EC
if(has('Product')&&has('Category')) rels.push('Product N ──1 Category');
if(has('Product')&&has('Order')) rels.push('Order N ──M Product (via OrderItem)');
if(has('Product')&&has('Review')) rels.push('Product 1 ──N Review');
if(has('Product')&&has('Cart')) rels.push('Product 1 ──N Cart');
if(has('Order')&&has('Payment')) rels.push('Order 1 ──1 Payment');
// Education
if(has('Course')&&has('Lesson')) rels.push('Course 1 ──N Lesson');
if(has('Course')&&has('Enrollment')) rels.push('Course 1 ──N Enrollment');
if(has('Course')&&has('Review')) rels.push('Course 1 ──N Review');
if(has('Course')&&has('Quiz')) rels.push('Course 1 ──N Quiz');
if(has('Lesson')&&has('Quiz')) rels.push('Lesson 1 ──N Quiz');
if(has('Lesson')&&has('Progress')) rels.push('Lesson 1 ──N Progress');
// Booking
if(has('Service')&&has('Booking')) rels.push('Service 1 ──N Booking');
if(has('Service')&&has('TimeSlot')) rels.push('Service 1 ──N TimeSlot');
// SaaS/Project
if(has('Workspace')&&has('Project')) rels.push('Workspace 1 ──N Project');
if(has('Project')&&has('Task')) rels.push('Project 1 ──N Task');
if(has('Dashboard')&&has('Widget')) rels.push('Dashboard 1 ──N Widget');
// Listing
if(has('Listing')&&has('Category')) rels.push('Listing N ──1 Category');
// IoT
if(has('Device')&&has('Sensor')) rels.push('Device 1 ──N Sensor');
// Category self-ref
if(has('Category')) rels.push('Category 0 ──N Category');
// Medical/Clinic
if(has('Patient')&&has('MedicalRecord')) rels.push('Patient 1 ──N MedicalRecord');
if(has('Doctor')&&has('MedicalRecord')) rels.push('Doctor 1 ──N MedicalRecord');
if(has('MedicalRecord')&&has('Prescription')) rels.push('MedicalRecord 1 ──N Prescription');
if(has('Patient')&&has('Appointment')) rels.push('Patient 1 ──N Appointment');
if(has('Doctor')&&has('Appointment')) rels.push('Doctor 1 ──N Appointment');
if(has('Pet')&&has('Vaccination')) rels.push('Pet 1 ──N Vaccination');
// Property Management
if(has('Property')&&has('Unit')) rels.push('Property 1 ──N Unit');
if(has('Unit')&&has('Lease')) rels.push('Unit 1 ──N Lease');
if(has('Tenant')&&has('Lease')) rels.push('Tenant 1 ──N Lease');
if(has('Unit')&&has('MaintenanceRequest')) rels.push('Unit 1 ──N MaintenanceRequest');
// Contract Management
if(has('Contract')&&has('Party')) rels.push('Contract 1 ──N Party');
if(has('Contract')&&has('Approval')) rels.push('Contract 1 ──N Approval');
if(has('Contract')&&has('Signature')) rels.push('Contract 1 ──N Signature');
if(has('Contract')&&has('Milestone')) rels.push('Contract 1 ──N Milestone');
// Restaurant
if(has('Table')&&has('Reservation')) rels.push('Table 1 ──N Reservation');
if(has('Order')&&has('MenuItem')) rels.push('Order N ──M MenuItem (via OrderItem)');
if(has('Table')&&has('Order')) rels.push('Table 1 ──N Order');
// HR
if(has('JobPosting')&&has('Applicant')) rels.push('JobPosting 1 ──N Applicant');
if(has('Applicant')&&has('Interview')) rels.push('Applicant 1 ──N Interview');
if(has('Applicant')&&has('Evaluation')) rels.push('Applicant 1 ──N Evaluation');
if(has('Department')&&has('JobPosting')) rels.push('Department 1 ──N JobPosting');
// Construction
if(has('Project')&&has('Contractor')) rels.push('Project N ──M Contractor');
if(has('Project')&&has('ProgressReport')) rels.push('Project 1 ──N ProgressReport');
if(has('Project')&&has('Estimate')) rels.push('Project 1 ──N Estimate');
// Knowledge Base
if(has('Article')&&has('SearchLog')) rels.push('Article 1 ──N SearchLog');
if(has('Article')&&has('AccessControl')) rels.push('Article 1 ──N AccessControl');
// Field Service
if(has('WorkOrder')&&has('Technician')) rels.push('WorkOrder N ──1 Technician');
if(has('WorkOrder')&&has('Location')) rels.push('WorkOrder N ──1 Location');
if(has('Customer')&&has('WorkOrder')) rels.push('Customer 1 ──N WorkOrder');
if(has('WorkOrder')&&has('Inventory')) rels.push('WorkOrder N ──M Inventory (via WorkOrderItem)');
// Gaming
if(has('User')&&has('Badge')) rels.push('User N ──M Badge (via Achievement)');
if(has('User')&&has('Challenge')) rels.push('User N ──M Challenge');
if(has('User')&&has('PointLog')) rels.push('User 1 ──N PointLog');
if(has('Badge')&&has('Achievement')) rels.push('Badge 1 ──N Achievement');
// Medical (Examination & Claim)
if(has('Patient')&&has('Examination')) rels.push('Patient 1 ──N Examination');
if(has('Doctor')&&has('Examination')) rels.push('Doctor 1 ──N Examination');
if(has('Patient')&&has('Claim')) rels.push('Patient 1 ──N Claim');
if(has('Invoice')&&has('Claim')) rels.push('Invoice 1 ──1 Claim');
// Helpdesk
if(has('SupportAgent')&&has('SupportTicket')) rels.push('SupportAgent 1 ──N SupportTicket');
if(has('SupportAgent')&&has('Response')) rels.push('SupportAgent 1 ──N Response');
// ── Task B: New 8-domain relationships ──
// Manufacturing
if(has('Product')&&has('ProductionOrder')) rels.push('Product 1 ──N ProductionOrder');
if(has('Machine')&&has('ProductionOrder')) rels.push('Machine 1 ──N ProductionOrder');
if(has('ProductionOrder')&&has('QualityCheck')) rels.push('ProductionOrder 1 ──N QualityCheck');
// Logistics
if(has('Shipment')&&has('Package')) rels.push('Shipment 1 ──N Package');
if(has('Shipment')&&has('Delivery')) rels.push('Shipment 1 ──1 Delivery');
if(has('Vehicle')&&has('Shipment')) rels.push('Vehicle 1 ──N Shipment');
// Agriculture
if(has('Farm')&&has('Field')) rels.push('Farm 1 ──N Field');
if(has('Field')&&has('Harvest')) rels.push('Field 1 ──N Harvest');
if(has('Crop')&&has('Harvest')) rels.push('Crop 1 ──N Harvest');
if(has('Field')&&has('Crop')) rels.push('Field N ──1 Crop');
// Energy
if(has('Device')&&has('Meter')) rels.push('Device 1 ──N Meter');
if(has('Meter')&&has('Reading')) rels.push('Meter 1 ──N Reading');
// Media
if(has('Program')&&has('Episode')) rels.push('Program 1 ──N Episode');
// Government
if(has('User')&&has('Application')) rels.push('User 1 ──N Application');
if(has('Department')&&has('Service')) rels.push('Department 1 ──N Service');
// Travel
if(has('User')&&has('Itinerary')) rels.push('User 1 ──N Itinerary');
if(has('Itinerary')&&has('Booking')) rels.push('Itinerary 1 ──N Booking');
if(has('Hotel')&&has('Booking')) rels.push('Hotel 1 ──N Booking');
// Insurance
if(has('Customer')&&has('Policy')) rels.push('Customer 1 ──N Policy');
if(has('Customer')&&has('Quote')) rels.push('Customer 1 ──N Quote');
if(has('Policy')&&has('Claim')) rels.push('Policy 1 ──N Claim');
// Enterprise/Multi-tenant
if(has('Organization')&&has('OrgMember')) rels.push('Organization 1 ──N OrgMember');
if(has('Organization')&&has('OrgInvite')) rels.push('Organization 1 ──N OrgInvite');
if(has('User')&&has('OrgMember')) rels.push('User 1 ──N OrgMember');
if(has('Organization')&&has('Workspace')) rels.push('Organization 1 ──N Workspace');
return {domain,warnings,suggestions,relationships:rels};
}
// ── Feature Detail Dictionary ──
// Provides acceptance criteria and test cases per feature pattern
const FEATURE_DETAILS={
'ユーザー認証|認証|Auth|ログイン|Login|SignUp':{
criteria_ja:['メール+パスワードでの新規登録','ソーシャルログイン({auth})','パスワードリセットメール送信','セッション管理・自動トークンリフレッシュ','ログアウト後のトークン無効化','プロフィール表示・編集'],
criteria_en:['Email + password registration','Social login ({auth})','Password reset email','Session management / auto token refresh','Token invalidation on logout','Profile view & edit'],
tests_ja:[['正常系: メール+パスワードで登録','201, ユーザー作成・セッション開始'],['正常系: ソーシャルログイン','302, OAuth認証→コールバック→セッション'],['正常系: パスワードリセット','200, リセットメール送信'],['異常系: 重複メールで登録','409/422, メール重複エラー'],['異常系: 不正パスワード(8文字未満)','422, バリデーションエラー'],['異常系: 無効トークンでアクセス','401, Unauthorized']],
tests_en:[['Normal: Register with email+password','201, user created + session start'],['Normal: Social login','302, OAuth → callback → session'],['Normal: Password reset','200, reset email sent'],['Error: Duplicate email','409/422, email already exists'],['Error: Weak password(<8 chars)','422, validation error'],['Error: Invalid token','401, Unauthorized']],
},
'コース管理|コース|Course|講座':{
criteria_ja:['コース作成(タイトル/説明/サムネイル/価格)','コース一覧(検索/フィルタ/ページネーション)','コース詳細表示','下書き↔公開のステータス管理','講師のみ編集可能(RLS)','カテゴリ/タグによる分類'],
criteria_en:['Create course (title/desc/thumbnail/price)','List courses (search/filter/pagination)','Course detail view','Draft ↔ published status toggle','Instructor-only edit (RLS)','Category/tag classification'],
tests_ja:[['正常系: コース作成(全フィールド)','201, DBにコース保存'],['正常系: ステータス変更(draft→published)','200, 公開日時記録'],['正常系: 一覧検索+フィルタ','200, フィルタ結果返却'],['異常系: 未認証でコース作成','401'],['異常系: 他講師のコースを編集','403 (RLS拒否)'],['異常系: タイトル空で作成','422, バリデーション']],
tests_en:[['Normal: Create course (all fields)','201, course saved'],['Normal: Status change (draft→published)','200, publish date recorded'],['Normal: List with search+filter','200, filtered results'],['Error: Create without auth','401'],['Error: Edit other instructor\'s course','403 (RLS denied)'],['Error: Create with empty title','422, validation']],
},
'進捗管理|進捗|Progress|学習進捗':{
criteria_ja:['レッスン完了の記録','コース全体の進捗率算出','学習履歴の一覧表示','完了条件: レッスンページ閲覧完了','進捗ダッシュボード(統計/グラフ)'],
criteria_en:['Record lesson completion','Calculate overall course progress','Learning history list','Completion: lesson page viewed','Progress dashboard (stats/charts)'],
tests_ja:[['正常系: レッスン完了を記録','200, progress.status=completed'],['正常系: コース進捗率取得','200, {progress_pct: 60}'],['正常系: 全完了でコース修了','200, enrollment.status=completed'],['異常系: 未受講コースの進捗記録','403/404'],['異常系: 同レッスン二重完了','200, 冪等(既存更新)']],
tests_en:[['Normal: Mark lesson complete','200, progress.status=completed'],['Normal: Get course progress','200, {progress_pct: 60}'],['Normal: All done = course complete','200, enrollment.status=completed'],['Error: Progress on unenrolled course','403/404'],['Error: Double complete same lesson','200, idempotent']],
},
'サブスクリプション|課金|Billing|Stripe|決済|Payment|サブスク':{
criteria_ja:['プラン選択画面(Free/Pro/Enterprise)','Stripe Checkout セッション作成','Webhook処理(invoice.paid, customer.subscription.deleted)','課金状態表示(アクティブ/期限切れ/解約済)','プラン変更/解約フロー','無料トライアル期間設定'],
criteria_en:['Plan selection (Free/Pro/Enterprise)','Create Stripe Checkout session','Webhook (invoice.paid, subscription.deleted)','Billing status display (active/expired/canceled)','Plan change / cancel flow','Free trial period config'],
tests_ja:[['正常系: Checkout セッション作成','200, checkout URL返却'],['正常系: Webhook invoice.paid 受信','200, subscription.status=active'],['正常系: プラン変更(Pro→Enterprise)','200, 次期間から適用'],['正常系: サブスク解約','200, 期間末まで有効'],['異常系: 無効Webhook署名','400, 署名検証失敗'],['異常系: 未認証でCheckout作成','401']],
tests_en:[['Normal: Create checkout session','200, checkout URL returned'],['Normal: Webhook invoice.paid','200, subscription.status=active'],['Normal: Plan change (Pro→Enterprise)','200, applied next period'],['Normal: Cancel subscription','200, valid until period end'],['Error: Invalid webhook signature','400, sig verification failed'],['Error: Checkout without auth','401']],
},
'管理(ダッシュボード|画面)|Admin|管理者|ダッシュボード管理':{
criteria_ja:['管理者ログイン(role=adminチェック)','ユーザー一覧/検索/停止','コンテンツ管理(一覧/承認/削除)','売上/統計ダッシュボード','監査ログ閲覧'],
criteria_en:['Admin login (role=admin check)','User list/search/suspend','Content management (list/approve/delete)','Revenue/stats dashboard','Audit log viewer'],
tests_ja:[['正常系: 管理者でアクセス','200, 管理画面表示'],['正常系: ユーザー停止','200, user.status=suspended'],['正常系: コンテンツ承認','200, content.status=approved'],['異常系: 一般ユーザーで管理画面アクセス','403'],['異常系: 管理者が自分を停止','422/403']],
tests_en:[['Normal: Admin access','200, admin panel displayed'],['Normal: Suspend user','200, user.status=suspended'],['Normal: Approve content','200, content.status=approved'],['Error: Non-admin access','403'],['Error: Admin suspend self','422/403']],
},
'商品管理|商品|Product|商品一覧':{
criteria_ja:['商品登録(名前/説明/価格/画像/SKU)','商品一覧(検索/カテゴリフィルタ/ページネーション)','在庫管理(入荷/出荷)','商品詳細表示','カテゴリ管理(CRUD/階層構造)'],
criteria_en:['Register product (name/desc/price/image/SKU)','Product list (search/filter/pagination)','Inventory management','Product detail view','Category management (CRUD/hierarchy)'],
tests_ja:[['正常系: 商品登録','201, 商品DBに保存'],['正常系: 在庫更新','200, stock数更新'],['正常系: カテゴリフィルタ','200, フィルタ結果'],['異常系: 価格が負数','422'],['異常系: SKU重複','409/422'],['異常系: 在庫0で購入','422, 在庫不足']],
tests_en:[['Normal: Register product','201, saved to DB'],['Normal: Update stock','200, stock updated'],['Normal: Category filter','200, filtered results'],['Error: Negative price','422'],['Error: Duplicate SKU','409/422'],['Error: Buy with 0 stock','422, out of stock']],
},
'注文|Order|カート|Cart|購入':{
criteria_ja:['カートに商品追加/数量変更/削除','カートから注文作成','注文履歴一覧','注文ステータス管理(pending→paid→shipped→delivered)','注文キャンセル(条件付き)'],
criteria_en:['Add/update/remove cart items','Create order from cart','Order history list','Order status flow (pending→paid→shipped→delivered)','Conditional order cancel'],
tests_ja:[['正常系: カート追加→注文作成','201, order作成+cart空に'],['正常系: 注文ステータス更新','200, status遷移'],['正常系: 注文キャンセル(pending)','200, status=cancelled'],['異常系: 空カートで注文','422'],['異常系: shipped後キャンセル','422, キャンセル不可']],
tests_en:[['Normal: Cart add → create order','201, order created + cart cleared'],['Normal: Update order status','200, status transition'],['Normal: Cancel (pending)','200, status=cancelled'],['Error: Order from empty cart','422'],['Error: Cancel after shipped','422, not cancellable']],
},
'コメント|Comment|レビュー|Review':{
criteria_ja:['コメント/レビュー投稿(本文+評価)','一覧表示(ページネーション)','投稿者のみ編集/削除可能','不適切コンテンツの報告機能'],
criteria_en:['Post comment/review (body+rating)','List with pagination','Author-only edit/delete','Report inappropriate content'],
tests_ja:[['正常系: レビュー投稿(rating=5)','201, レビュー保存'],['正常系: 自分のレビュー削除','204'],['異常系: 未認証で投稿','401'],['異常系: 他人のレビュー削除','403'],['異常系: rating範囲外(0 or 6)','422']],
tests_en:[['Normal: Post review (rating=5)','201, review saved'],['Normal: Delete own review','204'],['Error: Post without auth','401'],['Error: Delete other\'s review','403'],['Error: Rating out of range','422']],
},
'投稿|Post|記事|Article|ブログ|Blog|コンテンツ投稿':{
criteria_ja:['記事作成(タイトル/本文/スラグ/サムネイル)','下書き↔公開のステータス管理','一覧表示(検索/タグフィルタ/ページネーション)','Markdown/リッチテキストエディタ','OGP/SEOメタデータ設定'],
criteria_en:['Create post (title/body/slug/thumbnail)','Draft ↔ published status','List (search/tag filter/pagination)','Markdown/rich text editor','OGP/SEO metadata'],
tests_ja:[['正常系: 記事作成(下書き)','201, status=draft'],['正常系: 公開','200, published_at記録'],['正常系: スラグ検索','200, 記事返却'],['異常系: スラグ重複','409/422'],['異常系: 未認証で作成','401']],
tests_en:[['Normal: Create draft post','201, status=draft'],['Normal: Publish','200, published_at set'],['Normal: Slug search','200, post returned'],['Error: Duplicate slug','409/422'],['Error: Create without auth','401']],
},
'予約|Booking|スケジュール|Appointment':{
criteria_ja:['空き枠表示(カレンダービュー)','予約作成(日時/サービス選択)','予約確認メール送信','予約キャンセル/変更','リマインダー通知'],
criteria_en:['Available slots (calendar view)','Create booking (date/service)','Booking confirmation email','Cancel/reschedule booking','Reminder notification'],
tests_ja:[['正常系: 空き枠から予約作成','201, booking作成'],['正常系: 予約キャンセル','200, status=cancelled'],['異常系: 過去日時で予約','422'],['異常系: 同時刻に二重予約','409, 枠なし'],['異常系: 未認証で予約','401']],
tests_en:[['Normal: Book from available slot','201, booking created'],['Normal: Cancel booking','200, status=cancelled'],['Error: Book past datetime','422'],['Error: Double book same slot','409, no availability'],['Error: Book without auth','401']],
},
'タスク管理|タスク|Task|Todo|プロジェクト管理':{
criteria_ja:['タスク作成(タイトル/担当者/期日/優先度)','カンバンボード表示(todo/in_progress/done)','ドラッグ&ドロップでステータス変更','フィルタ(担当者/優先度/期日)','期日リマインダー通知'],
criteria_en:['Create task (title/assignee/due/priority)','Kanban board (todo/in_progress/done)','D&D status change','Filter (assignee/priority/due)','Due date reminder'],
tests_ja:[['正常系: タスク作成','201, task保存'],['正常系: ステータス変更(todo→done)','200, status更新'],['正常系: 担当者フィルタ','200, フィルタ結果'],['異常系: 他ワークスペースのタスク編集','403'],['異常系: タイトル空で作成','422']],
tests_en:[['Normal: Create task','201, task saved'],['Normal: Status change (todo→done)','200, status updated'],['Normal: Filter by assignee','200, filtered'],['Error: Edit other workspace task','403'],['Error: Create with empty title','422']],
},
'ファイルアップロード|Upload|メディア|Media|画像':{
criteria_ja:['ファイルアップロード(ドラッグ&ドロップ対応)','アップロード制限(10MB/画像・PDF)','プレビュー表示','ストレージ管理(Supabase Storage/S3)'],
criteria_en:['File upload (drag & drop)','Upload limit (10MB/image/PDF)','Preview display','Storage (Supabase Storage/S3)'],
tests_ja:[['正常系: 画像アップロード','201, URL返却'],['正常系: プレビュー表示','200, 画像取得'],['異常系: 10MB超ファイル','413/422, サイズ制限'],['異常系: 非対応形式(.exe)','422, 形式エラー'],['異常系: 未認証アップロード','401']],
tests_en:[['Normal: Image upload','201, URL returned'],['Normal: Preview','200, image fetched'],['Error: >10MB file','413/422, size limit'],['Error: Unsupported format(.exe)','422'],['Error: Upload without auth','401']],
},
'検索|フィルタ|Search|Filter|絞り込み':{
criteria_ja:['全文検索(タイトル/本文)','複合フィルタ(カテゴリ/タグ/日付範囲)','ソート(新着/人気/価格)','ページネーション(無限スクロール対応)','検索履歴保存'],
criteria_en:['Full-text search (title/body)','Multi-filter (category/tag/date range)','Sort (newest/popular/price)','Pagination (infinite scroll)','Search history'],
tests_ja:[['正常系: キーワード検索','200, マッチ結果返却'],['正常系: フィルタ+ソート組合せ','200, 複合条件適用'],['正常系: ページネーション','200, offset/limit適用'],['異常系: 不正なソート値','422, バリデーション'],['異常系: 空クエリ','200, 全件返却']],
tests_en:[['Normal: Keyword search','200, matched results'],['Normal: Filter + sort combo','200, multi-condition applied'],['Normal: Pagination','200, offset/limit applied'],['Error: Invalid sort value','422, validation'],['Error: Empty query','200, all results']],
},
'通知|リマインダー|Notification|Reminder|アラート':{
criteria_ja:['プッシュ通知(ブラウザ/モバイル)','メール通知(Resend/SendGrid)','通知一覧表示','既読/未読管理','通知設定(ON/OFF切替)','リマインダー自動送信'],
criteria_en:['Push notifications (browser/mobile)','Email notifications (Resend/SendGrid)','Notification list','Read/unread management','Notification settings toggle','Auto reminder send'],
tests_ja:[['正常系: 通知作成+送信','201, 通知DB保存+送信'],['正常系: 既読更新','200, read_at記録'],['正常系: 通知設定OFF','200, 送信スキップ'],['異常系: 未認証で通知一覧','401'],['異常系: 他ユーザーの通知既読','403']],
tests_en:[['Normal: Create + send notification','201, saved + sent'],['Normal: Mark as read','200, read_at set'],['Normal: Notifications OFF','200, sending skipped'],['Error: List without auth','401'],['Error: Mark other\'s notification','403']],
},
'分析|レポート|Analytics|Report|統計|集計':{
criteria_ja:['KPI集計(日次/週次/月次)','グラフ表示(recharts/Chart.js)','CSV/PDFエクスポート','カスタムレポート作成','リアルタイム更新(WebSocket/SSE)'],
criteria_en:['KPI aggregation (daily/weekly/monthly)','Chart display (recharts/Chart.js)','CSV/PDF export','Custom report builder','Real-time updates (WebSocket/SSE)'],
tests_ja:[['正常系: 期間指定集計','200, 集計結果返却'],['正常系: CSVエクスポート','200, CSV生成'],['正常系: グラフデータ取得','200, データポイント配列'],['異常系: 未来日で集計','422, 日付バリデーション'],['異常系: 大量データでタイムアウト','503/504, クエリ最適化必要']],
tests_en:[['Normal: Aggregate by period','200, aggregated results'],['Normal: CSV export','200, CSV generated'],['Normal: Get chart data','200, data points array'],['Error: Aggregate future dates','422, date validation'],['Error: Large data timeout','503/504, query optimization needed']],
},
'チーム|権限|Team|Permission|RBAC|招待':{
criteria_ja:['チーム作成・メンバー招待','ロール管理(owner/admin/member/viewer)','招待メール送信','権限チェック(RLS/middleware)','チームメンバー一覧表示'],
criteria_en:['Create team & invite members','Role management (owner/admin/member/viewer)','Send invitation email','Permission check (RLS/middleware)','Team member list'],
tests_ja:[['正常系: メンバー招待','201, 招待メール送信'],['正常系: ロール変更(member→admin)','200, 権限更新'],['正常系: メンバー削除','204'],['異常系: viewer権限でメンバー招待','403, 権限不足'],['異常系: 重複招待','409, 既存メンバー']],
tests_en:[['Normal: Invite member','201, invitation sent'],['Normal: Change role (member→admin)','200, permission updated'],['Normal: Remove member','204'],['Error: Viewer invites member','403, insufficient permissions'],['Error: Duplicate invitation','409, already member']],
},
'チャット|メッセージ|Chat|Message|DM|リアルタイム':{
criteria_ja:['リアルタイムメッセージ送受信(WebSocket/Supabase Realtime)','メッセージ一覧(ページネーション)','未読件数表示','既読管理','ファイル添付','メッセージ削除(24時間以内)'],
criteria_en:['Real-time messaging (WebSocket/Supabase Realtime)','Message list (pagination)','Unread count','Read receipts','File attachment','Delete message (within 24h)'],
tests_ja:[['正常系: メッセージ送信','201, 送受信者に配信'],['正常系: 既読更新','200, read_at記録'],['正常系: 未読件数取得','200, {unread: 5}'],['異常系: 未認証で送信','401'],['異常系: 24時間後に削除','422, 削除不可']],
tests_en:[['Normal: Send message','201, delivered to sender/receiver'],['Normal: Mark as read','200, read_at set'],['Normal: Get unread count','200, {unread: 5}'],['Error: Send without auth','401'],['Error: Delete after 24h','422, cannot delete']],
},
'エクスポート|Export|PDF|CSV|ダウンロード':{
criteria_ja:['CSV一括エクスポート','PDF生成(請求書/契約書/レポート)','エクスポート履歴保存','バックグラウンド処理(大量データ)','ZIP圧縮(複数ファイル)'],
criteria_en:['Bulk CSV export','PDF generation (invoices/contracts/reports)','Export history','Background processing (large data)','ZIP compression (multi-file)'],
tests_ja:[['正常系: CSV一括エクスポート','200, CSV生成+ダウンロード'],['正常系: PDF請求書生成','200, PDF URL返却'],['正常系: 複数ファイルZIP','200, ZIP生成'],['異常系: 大量データでメモリ不足','500, バッチ処理推奨'],['異常系: 未認証でエクスポート','401']],
tests_en:[['Normal: Bulk CSV export','200, CSV generated + download'],['Normal: Generate PDF invoice','200, PDF URL returned'],['Normal: Multi-file ZIP','200, ZIP created'],['Error: Large data OOM','500, recommend batch'],['Error: Export without auth','401']],
},
'カレンダー|スケジュール|Calendar|Schedule|日程調整':{
criteria_ja:['カレンダー表示(日/週/月ビュー)','予定作成・編集・削除','ドラッグ&ドロップで日時変更','Googleカレンダー連携','定期予定設定(毎週/毎月)'],
criteria_en:['Calendar view (day/week/month)','Create/edit/delete events','D&D reschedule','Google Calendar sync','Recurring events (weekly/monthly)'],
tests_ja:[['正常系: 予定作成','201, カレンダーに表示'],['正常系: D&Dで日時変更','200, starts_at更新'],['正常系: 定期予定作成','201, 繰り返し設定保存'],['異常系: 過去日時で作成','422, 日付バリデーション'],['異常系: 重複予定作成','409, 枠なし']],
tests_en:[['Normal: Create event','201, shown on calendar'],['Normal: D&D reschedule','200, starts_at updated'],['Normal: Create recurring event','201, recurrence saved'],['Error: Create in past','422, date validation'],['Error: Double-book slot','409, conflict']],
},
'在庫管理|Inventory|在庫|Stock|入出庫':{
criteria_ja:['在庫数リアルタイム表示','入庫/出庫記録','在庫アラート(低在庫/過剰在庫)','ロット管理(賞味期限/シリアル番号)','棚卸し機能'],
criteria_en:['Real-time stock display','Inbound/outbound records','Stock alerts (low/excess)','Lot management (expiry/serial)','Inventory count'],
tests_ja:[['正常系: 入庫記録','201, 在庫数増加'],['正常系: 出庫記録','200, 在庫数減少'],['正常系: 低在庫アラート','200, stock<10で通知'],['異常系: 在庫0で出庫','422, 在庫不足'],['異常系: 負数で入庫','422, 数量バリデーション']],
tests_en:[['Normal: Inbound record','201, stock increased'],['Normal: Outbound record','200, stock decreased'],['Normal: Low stock alert','200, notify when stock<10'],['Error: Outbound with 0 stock','422, out of stock'],['Error: Negative inbound','422, quantity validation']],
},
'ソーシャル|フォロー|いいね|Social|Follow|Like|Share':{
criteria_ja:['ユーザーフォロー/アンフォロー','フォロワー/フォロー中一覧','いいね機能','シェア機能','フィードタイムライン(フォロー中のみ)','ブロック機能'],
criteria_en:['User follow/unfollow','Followers/following list','Like feature','Share feature','Feed timeline (following only)','Block feature'],
tests_ja:[['正常系: ユーザーフォロー','201, フォロー記録'],['正常系: いいね追加','201, Like記録'],['正常系: フィード取得','200, フォロー中の投稿のみ'],['異常系: 自分をフォロー','422, 自己フォロー不可'],['異常系: 重複いいね','409, 既存いいね']],
tests_en:[['Normal: Follow user','201, follow recorded'],['Normal: Add like','201, Like saved'],['Normal: Get feed','200, following posts only'],['Error: Self-follow','422, cannot follow self'],['Error: Duplicate like','409, already liked']],
},
'設定|環境設定|Settings|Preferences|Config':{
criteria_ja:['プロフィール編集','パスワード変更','メール通知設定','プライバシー設定','テーマ切替(ダーク/ライト)','言語設定','アカウント削除'],
criteria_en:['Profile edit','Password change','Email notification settings','Privacy settings','Theme toggle (dark/light)','Language settings','Account deletion'],
tests_ja:[['正常系: プロフィール更新','200, 変更反映'],['正常系: パスワード変更','200, パスワードハッシュ更新'],['正常系: 通知OFF','200, 設定保存'],['異常系: 弱いパスワード','422, バリデーション'],['異常系: アカウント削除(確認なし)','400, 確認必須']],
tests_en:[['Normal: Update profile','200, changes applied'],['Normal: Change password','200, hash updated'],['Normal: Notifications OFF','200, setting saved'],['Error: Weak password','422, validation'],['Error: Delete account (no confirm)','400, confirmation required']],
},
'MFA|2FA|二段階認証|多要素認証|TOTP':{
criteria_ja:['TOTPセットアップ(QRコード表示)','バックアップコード生成','ログイン時のOTP検証','信頼済みデバイス登録','MFA無効化(パスワード確認)'],
criteria_en:['TOTP setup (QR code)','Backup code generation','OTP verification on login','Trusted device registration','Disable MFA (password confirm)'],
tests_ja:[['正常系: TOTP有効化','200, QRコード+秘密鍵返却'],['正常系: OTP検証','200, ログイン成功'],['正常系: バックアップコード使用','200, コード無効化'],['異常系: 不正OTP','401, 認証失敗'],['異常系: 期限切れOTP','401, タイムアウト']],
tests_en:[['Normal: Enable TOTP','200, QR code + secret returned'],['Normal: Verify OTP','200, login success'],['Normal: Use backup code','200, code invalidated'],['Error: Invalid OTP','401, auth failed'],['Error: Expired OTP','401, timeout']],
},
'Webhook|連携|Integration|API連携':{
criteria_ja:['Webhook URL登録','イベント選択(作成/更新/削除)','署名検証(HMAC)','リトライ設定(最大3回)','Webhook履歴・ログ','テストペイロード送信'],
criteria_en:['Webhook URL registration','Event selection (create/update/delete)','Signature verification (HMAC)','Retry settings (max 3)','Webhook history & logs','Test payload send'],
tests_ja:[['正常系: Webhook登録','201, URL保存+シークレット生成'],['正常系: イベントトリガー','200, Webhook送信'],['正常系: 署名検証','200, HMACマッチ'],['異常系: 不正署名','401, 検証失敗'],['異常系: 3回リトライ失敗','500, Webhook無効化']],
tests_en:[['Normal: Register webhook','201, URL saved + secret generated'],['Normal: Event trigger','200, webhook sent'],['Normal: Verify signature','200, HMAC match'],['Error: Invalid signature','401, verification failed'],['Error: 3 retries failed','500, webhook disabled']],
},
'オンボーディング|チュートリアル|Onboarding|Tutorial|ガイド':{
criteria_ja:['初回ログイン時のステップ表示','チェックリスト進捗管理','ツールチップガイド','スキップ機能','完了時のバッジ/報酬'],
criteria_en:['Step display on first login','Checklist progress tracking','Tooltip guides','Skip feature','Badge/reward on completion'],
tests_ja:[['正常系: チェックリスト表示','200, 未完了ステップ返却'],['正常系: ステップ完了','200, 進捗更新'],['正常系: スキップ','200, オンボーディング終了'],['異常系: 完了済みステップを再度完了','200, 冪等'],['正常系: 全ステップ完了','200, バッジ付与']],
tests_en:[['Normal: Show checklist','200, incomplete steps returned'],['Normal: Complete step','200, progress updated'],['Normal: Skip','200, onboarding ended'],['Error: Re-complete finished step','200, idempotent'],['Normal: All steps done','200, badge granted']],
},
'APIキー|開発者|API Key|Developer|トークン管理':{
criteria_ja:['APIキー発行(プレフィックス表示)','権限スコープ設定(read/write)','有効期限設定','キー無効化/削除','使用状況ダッシュボード','レート制限設定'],
criteria_en:['API key issuance (prefix display)','Permission scope (read/write)','Expiration date setting','Key revocation/deletion','Usage dashboard','Rate limit config'],
tests_ja:[['正常系: APIキー発行','201, キー返却(1回のみ)'],['正常系: スコープ制限でアクセス','200, read権限OK'],['正常系: キー無効化','204, 以降401'],['異常系: 有効期限切れキー','401, Expired'],['異常系: レート制限超過','429, Too Many Requests']],
tests_en:[['Normal: Issue API key','201, key returned (once)'],['Normal: Scoped access','200, read permission OK'],['Normal: Revoke key','204, 401 after'],['Error: Expired key','401, Expired'],['Error: Rate limit exceeded','429, Too Many Requests']],
},
'監査ログ|履歴|Audit|Log|History|アクティビティ':{
criteria_ja:['全操作の記録(作成/更新/削除)','ユーザー・IPアドレス記録','タイムスタンプ','フィルタ・検索機能','エクスポート(CSV/JSON)','保持期間設定(90日)'],
criteria_en:['Record all operations (create/update/delete)','User & IP address logging','Timestamp','Filter & search','Export (CSV/JSON)','Retention period (90 days)'],
tests_ja:[['正常系: ログ記録','201, AuditLog保存'],['正常系: ログ検索','200, フィルタ結果返却'],['正常系: CSV エクスポート','200, CSV生成'],['異常系: 管理者以外がアクセス','403, 権限不足'],['正常系: 90日以前のログ削除','200, 自動削除']],
tests_en:[['Normal: Log record','201, AuditLog saved'],['Normal: Log search','200, filtered results'],['Normal: CSV export','200, CSV generated'],['Error: Non-admin access','403, insufficient permissions'],['Normal: Delete logs >90 days','200, auto-deleted']],
},
'地図|位置情報|Map|Location|Geo|GPS':{
criteria_ja:['地図表示(Google Maps/Mapbox)','位置情報取得(Geolocation API)','住所→座標変換(Geocoding)','近隣検索(半径N km以内)','ルート案内','マーカー/ピン表示'],
criteria_en:['Map display (Google Maps/Mapbox)','Location acquisition (Geolocation API)','Address→coordinate (Geocoding)','Nearby search (within N km)','Route guidance','Marker/pin display'],
tests_ja:[['正常系: 位置情報取得','200, 緯度経度返却'],['正常系: 住所→座標変換','200, ジオコーディング成功'],['正常系: 近隣検索','200, 半径5km以内の結果'],['異常系: 位置情報拒否','403, Geolocation denied'],['異常系: 不正な住所','422, ジオコーディング失敗']],
tests_en:[['Normal: Get location','200, lat/lng returned'],['Normal: Address→coordinate','200, geocoding success'],['Normal: Nearby search','200, results within 5km'],['Error: Location denied','403, Geolocation denied'],['Error: Invalid address','422, geocoding failed']],
},
'インポート|移行|Import|Migration|データ取込':{
criteria_ja:['CSVインポート','Excel(XLSX)インポート','データバリデーション','重複チェック','エラーレポート','バックグラウンド処理(大量データ)','ロールバック機能'],
criteria_en:['CSV import','Excel (XLSX) import','Data validation','Duplicate check','Error report','Background processing (large data)','Rollback feature'],
tests_ja:[['正常系: CSVインポート(100件)','201, 100件登録'],['正常系: バリデーションエラー','422, エラー行リスト返却'],['正常系: 重複スキップ','200, 重複行除外'],['異常系: 不正フォーマット','422, CSVパース失敗'],['正常系: 大量データ(10万件)','202, バックグラウンド処理']],
tests_en:[['Normal: Import CSV (100 rows)','201, 100 rows inserted'],['Normal: Validation error','422, error row list returned'],['Normal: Skip duplicates','200, duplicate rows excluded'],['Error: Invalid format','422, CSV parse failed'],['Normal: Large data (100k rows)','202, background processing']],
},
'テンプレート|ワークフロー|Template|Workflow|自動化':{
criteria_ja:['テンプレート作成・保存','変数/プレースホルダー','条件分岐','承認フロー','スケジュール実行','実行履歴・ログ'],
criteria_en:['Template creation & save','Variables/placeholders','Conditional branching','Approval flow','Scheduled execution','Execution history & logs'],
tests_ja:[['正常系: テンプレート作成','201, テンプレート保存'],['正常系: 変数展開','200, プレースホルダー置換'],['正常系: 条件分岐実行','200, 条件マッチで分岐'],['異常系: 不正な変数名','422, バリデーション'],['正常系: スケジュール実行','200, 毎日9時に自動実行']],
tests_en:[['Normal: Create template','201, template saved'],['Normal: Variable expansion','200, placeholders replaced'],['Normal: Conditional execution','200, branched on condition'],['Error: Invalid variable name','422, validation'],['Normal: Scheduled execution','200, auto-run daily at 9am']],
},
'リバースエンジニアリング|逆算|Reverse|Goal|目標分解':{
criteria_ja:['目標設定(KPI+期限)','逆算プラン生成','ステップ分割(工数見積)','進捗トラッキング','計画調整履歴','ベロシティ測定'],
criteria_en:['Goal setting (KPI + deadline)','Reverse plan generation','Step breakdown (effort estimation)','Progress tracking','Plan adjustment history','Velocity measurement'],
tests_ja:[['正常系: 目標作成','201, UserGoal保存'],['正常系: 逆算プラン生成','201, ReversePlan+PlanStep'],['正常系: 進捗記録','200, ProgressTracking追加'],['正常系: 計画調整','200, PlanAdjustment記録'],['正常系: ベロシティ算出','200, {velocity: 1.2}']],
tests_en:[['Normal: Create goal','201, UserGoal saved'],['Normal: Generate reverse plan','201, ReversePlan+PlanStep'],['Normal: Record progress','200, ProgressTracking added'],['Normal: Adjust plan','200, PlanAdjustment recorded'],['Normal: Calculate velocity','200, {velocity: 1.2}']],
},
'スキル自動化|Skill|Manus|タスク分解':{
criteria_ja:['スキル定義(Input/Process/Output)','スキルカタログ','パイプライン設計','エージェント連携','実行履歴'],
criteria_en:['Skill definition (Input/Process/Output)','Skill catalog','Pipeline design','Agent coordination','Execution history'],
tests_ja:[['正常系: スキル登録','201, スキル保存'],['正常系: パイプライン実行','200, 全ステップ完了'],['異常系: 無限ループ検出','500, タイムアウト'],['正常系: 並列実行','200, 3スキル同時実行']],
tests_en:[['Normal: Register skill','201, skill saved'],['Normal: Execute pipeline','200, all steps completed'],['Error: Infinite loop detection','500, timeout'],['Normal: Parallel execution','200, 3 skills concurrent']],
},
'品質インテリジェンス|QA|Quality|テスト戦略':{
criteria_ja:['業種別テストマトリクス','リスク優先度評価','典型バグパターン','ツール推奨','カバレッジ可視化'],
criteria_en:['Industry test matrix','Risk priority assessment','Common bug patterns','Tool recommendations','Coverage visualization'],
tests_ja:[['正常系: テストマトリクス生成','200, 15業種対応'],['正常系: リスク評価','200, Security:HIGH検出'],['正常系: バグパターンマッチ','200, 既知パターン3件']],
tests_en:[['Normal: Generate test matrix','200, 15 industries supported'],['Normal: Risk assessment','200, Security:HIGH detected'],['Normal: Bug pattern match','200, 3 known patterns']],
},
'チケット管理|Issue|Bug|タスク':{
criteria_ja:['チケット作成(タイトル/説明/優先度)','ステータス管理(Open/InProgress/Done)','担当者割当','コメント/履歴','ラベル/タグ','検索/フィルタ'],
criteria_en:['Create ticket (title/desc/priority)','Status management (Open/InProgress/Done)','Assignee assignment','Comments/history','Labels/tags','Search/filter'],
tests_ja:[['正常系: チケット作成','201, チケット保存'],['正常系: ステータス変更','200, Open→InProgress'],['正常系: コメント追加','201, コメント保存'],['異常系: 未認証でアクセス','401'],['正常系: フィルタ検索','200, priority=high結果']],
tests_en:[['Normal: Create ticket','201, ticket saved'],['Normal: Change status','200, Open→InProgress'],['Normal: Add comment','201, comment saved'],['Error: Unauthorized access','401'],['Normal: Filter search','200, priority=high results']],
},
'ゲーミフィケーション|Gamification|ポイント|バッジ':{
criteria_ja:['ポイント付与ルール','バッジ獲得条件','リーダーボード','レベルシステム','実績解除','進捗可視化'],
criteria_en:['Point reward rules','Badge unlock conditions','Leaderboard','Level system','Achievement unlock','Progress visualization'],
tests_ja:[['正常系: ポイント付与','200, +10pt記録'],['正常系: バッジ獲得','201, Achievement追加'],['正常系: リーダーボード','200, Top10返却'],['異常系: 二重付与','422, 冪等性エラー'],['正常系: レベルアップ','200, Lv2達成']],
tests_en:[['Normal: Award points','200, +10pt recorded'],['Normal: Unlock badge','201, Achievement added'],['Normal: Leaderboard','200, Top10 returned'],['Error: Double award','422, idempotency error'],['Normal: Level up','200, Lv2 reached']],
},
};
// Match feature name to FEATURE_DETAILS entry
function getFeatureDetail(featureName){
for(const[pattern,detail]of Object.entries(FEATURE_DETAILS)){
if(new RegExp(pattern,'i').test(featureName)) return detail;
}
return null;
}
// ── Domain-specific QA Strategy Map ──
const DOMAIN_QA_MAP={
education:{
focus_ja:['学習進捗のバックエンド同期','WCAG 2.1 AA準拠','未成年データ保護(FERPA)','コンテンツ配信安定性'],
focus_en:['Backend sync for progress','WCAG 2.1 AA compliance','Minor data protection (FERPA)','Content delivery stability'],
bugs_ja:['localStorage依存による進捗消失','クイズ正誤判定ミス','ブラウザ別音声再生不具合'],
bugs_en:['Progress lost on localStorage clear','Quiz scoring errors','Audio playback failures per browser'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:CRITICAL|Compliance:HIGH'
},
ec:{
focus_ja:['同時購入の在庫競合','決済フロー完全性','カート操作の冪等性','スパイクトラフィック耐性'],
focus_en:['Concurrent inventory conflicts','Payment flow integrity','Cart operation idempotency','Spike traffic resilience'],
bugs_ja:['同一商品を複数ユーザーが同時購入','カート追加ボタン連打で数量倍増','決済中断時の在庫戻し漏れ'],
bugs_en:['Same item bought by multiple users simultaneously','Rapid cart add button clicks double quantity','Inventory not returned on payment cancellation'],
priority:'Security:CRITICAL|Performance:HIGH|DataIntegrity:CRITICAL|UX:HIGH|Compliance:MED'
},
saas:{
focus_ja:['マルチテナント分離(RLS)','プラン別機能制限','サブスク更新・解約処理','API rate limiting'],
focus_en:['Multi-tenant isolation (RLS)','Plan-based feature restrictions','Subscription renewal/cancellation','API rate limiting'],
bugs_ja:['テナント間データ漏洩','プラン変更時の機能アクセス制御不備','サブスク解約後も課金継続'],
bugs_en:['Data leakage between tenants','Feature access control failure on plan change','Billing continues after cancellation'],
priority:'Security:CRITICAL|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'
},
community:{
focus_ja:['投稿フィルタリング(不適切コンテンツ)','通報・モデレーション','スパム対策','リアルタイム同期'],
focus_en:['Content filtering (inappropriate)','Reporting & moderation','Spam prevention','Real-time sync'],
bugs_ja:['XSS脆弱性(投稿にスクリプト注入)','通報機能の不正利用','スパムボットによる大量投稿'],
bugs_en:['XSS vulnerability (script injection in posts)','Report feature abuse','Mass posting by spam bots'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:MED|UX:HIGH|Compliance:MED'
},
booking:{
focus_ja:['同時予約競合','キャンセル・変更処理','タイムゾーン処理','外部カレンダー連携'],
focus_en:['Concurrent booking conflicts','Cancellation/modification handling','Timezone handling','External calendar integration'],
bugs_ja:['同一枠を複数ユーザーが予約','タイムゾーン計算ミスで時刻ずれ','キャンセル時の返金処理漏れ'],
bugs_en:['Same slot booked by multiple users','Timezone calculation errors cause time mismatches','Refund process omitted on cancellation'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:CRITICAL|UX:CRITICAL|Compliance:MED'
},
fintech:{
focus_ja:['トランザクション完全性(ACID)','二重処理防止','監査ログ完全性','PCI DSS準拠'],
focus_en:['Transaction integrity (ACID)','Double-processing prevention','Audit log completeness','PCI DSS compliance'],
bugs_ja:['送金ボタン連打で二重送金','残高計算の浮動小数点誤差','監査ログの欠損'],
bugs_en:['Double transfer on rapid send button clicks','Floating-point errors in balance calculations','Missing audit log entries'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:CRITICAL|UX:MED|Compliance:CRITICAL'
},
iot:{
focus_ja:['デバイス認証・認可','オフライン動作','ファームウェア更新','デバイス間同期'],
focus_en:['Device authentication & authorization','Offline operation','Firmware updates','Device-to-device sync'],
bugs_ja:['不正デバイスのAPI接続','オフライン時のデータ消失','ファームウェア更新失敗で文鎮化'],
bugs_en:['Unauthorized device API access','Data loss in offline mode','Bricked devices from failed firmware updates'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'
},
realestate:{
focus_ja:['物件検索パフォーマンス','地図連携精度','内見予約管理','物件状態同期'],
focus_en:['Property search performance','Map integration accuracy','Viewing appointment management','Property status sync'],
bugs_ja:['成約済み物件が検索表示','地図ピン位置のずれ','内見予約の重複'],
bugs_en:['Sold properties shown in search','Map pin location misalignment','Duplicate viewing appointments'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:CRITICAL|Compliance:MED'
},
content:{
focus_ja:['CDN配信最適化','画像・動画エンコード','オフライン閲覧','コンテンツ推薦精度'],
focus_en:['CDN delivery optimization','Image/video encoding','Offline viewing','Content recommendation accuracy'],
bugs_ja:['高負荷時の動画再生停止','画像遅延読み込み失敗','オフラインキャッシュ容量超過'],
bugs_en:['Video playback stops under high load','Image lazy loading failures','Offline cache quota exceeded'],
priority:'Security:LOW|Performance:CRITICAL|DataIntegrity:MED|UX:CRITICAL|Compliance:LOW'
},
hr:{
focus_ja:['個人情報保護(GDPR/CCPA)','採用プロセス公平性','評価データ整合性','権限管理'],
focus_en:['Personal data protection (GDPR/CCPA)','Hiring process fairness','Evaluation data integrity','Permission management'],
bugs_ja:['退職者のデータアクセス残存','評価スコア計算ミス','応募者情報の漏洩'],
bugs_en:['Former employee retains data access','Evaluation score calculation errors','Applicant info leakage'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:CRITICAL'
},
analytics:{
focus_ja:['集計パフォーマンス','データパイプライン信頼性','リアルタイム更新','可視化精度'],
focus_en:['Aggregation performance','Data pipeline reliability','Real-time updates','Visualization accuracy'],
bugs_ja:['大量データ集計でタイムアウト','ETL処理の部分失敗','グラフ表示の数値ずれ'],
bugs_en:['Timeout on large data aggregation','Partial ETL process failures','Graph display value discrepancies'],
priority:'Security:MED|Performance:CRITICAL|DataIntegrity:CRITICAL|UX:HIGH|Compliance:MED'
},
health:{
focus_ja:['患者データ保護(HIPAA)','処方・診断記録の正確性','医療機器連携','緊急時可用性'],
focus_en:['Patient data protection (HIPAA)','Prescription/diagnosis record accuracy','Medical device integration','Emergency availability'],
bugs_ja:['患者間データ混在','処方箋の記録ミス','医療機器データ取得失敗'],
bugs_en:['Patient data cross-contamination','Prescription record errors','Medical device data acquisition failures'],
priority:'Security:CRITICAL|Performance:HIGH|DataIntegrity:CRITICAL|UX:CRITICAL|Compliance:CRITICAL'
},
marketplace:{
focus_ja:['出品者・購入者間トラスト','エスクロー処理','レビュー信頼性','手数料計算'],
focus_en:['Seller-buyer trust','Escrow processing','Review authenticity','Fee calculation'],
bugs_ja:['評価の不正操作','エスクロー解放タイミングミス','手数料計算エラー'],
bugs_en:['Review manipulation','Escrow release timing errors','Fee calculation mistakes'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'
},
legal:{
focus_ja:['契約ドキュメント完全性','電子署名有効性','バージョン管理','監査証跡'],
focus_en:['Contract document integrity','Electronic signature validity','Version control','Audit trail'],
bugs_ja:['契約書の改ざん','署名検証失敗','バージョン履歴消失'],
bugs_en:['Contract document tampering','Signature verification failures','Version history loss'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:CRITICAL|UX:MED|Compliance:CRITICAL'
},
tool:{
focus_ja:['操作レスポンス速度','データエクスポート完全性','ショートカット動作','エラー復旧'],
focus_en:['Operation response speed','Data export completeness','Shortcut functionality','Error recovery'],
bugs_ja:['大量データ操作で固まる','エクスポート時の文字化け','ショートカットキー競合'],
bugs_en:['Freezes on large data operations','Character encoding issues in exports','Shortcut key conflicts'],
priority:'Security:LOW|Performance:HIGH|DataIntegrity:MED|UX:CRITICAL|Compliance:LOW'
},
portfolio:{
focus_ja:['SEO最適化','レスポンシブ対応','画像最適化(WebP)','表示速度(Core Web Vitals)'],
focus_en:['SEO optimization','Responsive design','Image optimization (WebP)','Display speed (Core Web Vitals)'],
bugs_ja:['モバイル表示崩れ','画像遅延読み込み失敗','SNS OGP未設定'],
bugs_en:['Mobile layout breaks','Image lazy loading failures','Missing SNS OGP tags'],
priority:'Security:LOW|Performance:HIGH|DataIntegrity:LOW|UX:CRITICAL|Compliance:LOW'
},
ai:{
focus_ja:['プロンプトインジェクション対策','トークン使用量管理','レスポンス速度','会話履歴保存'],
focus_en:['Prompt injection prevention','Token usage management','Response speed','Conversation history persistence'],
bugs_ja:['プロンプト漏洩','トークン超過課金','会話履歴消失','レート制限超過'],
bugs_en:['Prompt leakage','Token overcharge','Conversation loss','Rate limit exceeded'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'
},
automation:{
focus_ja:['ワークフロー実行信頼性','エラーハンドリング','リトライ設定','実行履歴保存'],
focus_en:['Workflow execution reliability','Error handling','Retry configuration','Execution history logging'],
bugs_ja:['無限ループ','エラー時の通知漏れ','リトライ回数制限なし','実行ログ欠損'],
bugs_en:['Infinite loops','Missing error notifications','Unlimited retries','Missing execution logs'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:LOW'
},
event:{
focus_ja:['チケット在庫管理','QRコード検証','キャンセルポリシー','タイムゾーン処理'],
focus_en:['Ticket inventory management','QR code verification','Cancellation policy','Timezone handling'],
bugs_ja:['定員超過販売','QRコード重複','返金処理漏れ','時刻ずれ'],
bugs_en:['Overselling capacity','Duplicate QR codes','Missing refunds','Time mismatches'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:CRITICAL|UX:HIGH|Compliance:MED'
},
gamify:{
focus_ja:['ポイント計算正確性','バッジ獲得条件','ランキング公平性','不正防止'],
focus_en:['Point calculation accuracy','Badge criteria enforcement','Ranking fairness','Fraud prevention'],
bugs_ja:['ポイント重複付与','バッジ不正獲得','ランキング操作','負数ポイント'],
bugs_en:['Duplicate point grants','Badge exploitation','Ranking manipulation','Negative points'],
priority:'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:LOW'
},
collab:{
focus_ja:['同時編集競合解決','バージョン管理','権限管理','リアルタイム同期'],
focus_en:['Concurrent edit conflict resolution','Version control','Permission management','Real-time sync'],
bugs_ja:['編集内容消失','バージョン履歴欠損','権限チェック漏れ','同期遅延'],
bugs_en:['Edit loss','Missing version history','Permission bypass','Sync delays'],
priority:'Security:HIGH|Performance:HIGH|DataIntegrity:CRITICAL|UX:CRITICAL|Compliance:MED'
},
devtool:{
focus_ja:['APIキー管理','レート制限','使用量追跡','Webhook信頼性'],
focus_en:['API key management','Rate limiting','Usage tracking','Webhook reliability'],
bugs_ja:['キー漏洩','レート制限バイパス','使用量カウント漏れ','Webhook失敗'],
bugs_en:['Key leakage','Rate limit bypass','Usage count miss','Webhook failures'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'
},
creator:{
focus_ja:['サブスク課金管理','コンテンツ配信','投げ銭処理','ファン管理'],
focus_en:['Subscription billing','Content delivery','Tip processing','Fan management'],
bugs_ja:['解約後も課金','コンテンツ漏洩','投げ銭未着金','ファン通知漏れ'],
bugs_en:['Billing after cancellation','Content leakage','Tip not received','Missing fan notifications'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:HIGH'
},
newsletter:{
focus_ja:['配信到達率','購読解除','スパムフィルタ回避','開封率追跡'],
focus_en:['Delivery rate','Unsubscribe handling','Spam filter avoidance','Open rate tracking'],
bugs_ja:['メール未到達','購読解除後も配信','スパム判定','開封トラッキング失敗'],
bugs_en:['Email not delivered','Sending after unsubscribe','Spam flagged','Open tracking failures'],
priority:'Security:MED|Performance:MED|DataIntegrity:MED|UX:HIGH|Compliance:HIGH'
},
manufacturing:{
focus_ja:['生産計画精度','在庫管理','品質管理','設備保全'],
focus_en:['Production planning accuracy','Inventory management','Quality control','Equipment maintenance'],
bugs_ja:['在庫数不一致','不良品見逃し','設備故障未検知'],
bugs_en:['Inventory count mismatch','Defect missed','Equipment failure undetected'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:CRITICAL|UX:MED|Compliance:HIGH'
},
logistics:{
focus_ja:['配送追跡精度','倉庫在庫同期','ルート最適化','配達時刻予測'],
focus_en:['Delivery tracking accuracy','Warehouse inventory sync','Route optimization','Delivery time prediction'],
bugs_ja:['追跡情報更新遅延','在庫引当ミス','配送遅延通知漏れ'],
bugs_en:['Tracking update delays','Inventory allocation errors','Delayed delivery notification miss'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:CRITICAL|Compliance:MED'
},
agriculture:{
focus_ja:['センサーデータ精度','灌漑自動制御','収穫予測','病害検知'],
focus_en:['Sensor data accuracy','Irrigation automation','Harvest prediction','Pest detection'],
bugs_ja:['センサー異常値','灌漑制御失敗','収穫量誤差','病害見逃し'],
bugs_en:['Sensor anomalies','Irrigation control failure','Harvest estimate errors','Pest detection miss'],
priority:'Security:LOW|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'
},
energy:{
focus_ja:['メーター計測精度','需給予測','アラート閾値','請求計算'],
focus_en:['Meter reading accuracy','Demand forecasting','Alert thresholds','Billing calculation'],
bugs_ja:['計測値異常','需給予測外れ','アラート未送信','請求額誤差'],
bugs_en:['Reading anomalies','Forecast errors','Alert not sent','Billing amount errors'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:CRITICAL|UX:MED|Compliance:CRITICAL'
},
media:{
focus_ja:['コンテンツ配信品質','DRM保護','視聴履歴追跡','レコメンド精度'],
focus_en:['Content delivery quality','DRM protection','Viewing history tracking','Recommendation accuracy'],
bugs_ja:['ストリーミング途切れ','DRM回避','視聴履歴漏れ','レコメンド不適切'],
bugs_en:['Streaming interruptions','DRM bypass','Missing view history','Inappropriate recommendations'],
priority:'Security:HIGH|Performance:CRITICAL|DataIntegrity:MED|UX:CRITICAL|Compliance:HIGH'
},
government:{
focus_ja:['個人情報保護','申請処理追跡','電子署名検証','アクセシビリティ'],
focus_en:['Personal data protection','Application tracking','Digital signature verification','Accessibility'],
bugs_ja:['個人情報漏洩','申請状態不整合','署名検証失敗','アクセシビリティ不備'],
bugs_en:['Personal data leakage','Application status inconsistency','Signature verification failure','Accessibility gaps'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:CRITICAL|UX:HIGH|Compliance:CRITICAL'
},
travel:{
focus_ja:['予約確定性','在庫同期','決済完全性','キャンセル処理'],
focus_en:['Booking confirmation','Inventory sync','Payment integrity','Cancellation handling'],
bugs_ja:['ダブルブッキング','在庫更新遅延','決済失敗未通知','キャンセル料誤算'],
bugs_en:['Double booking','Inventory update delays','Payment failure not notified','Cancellation fee errors'],
priority:'Security:HIGH|Performance:HIGH|DataIntegrity:CRITICAL|UX:CRITICAL|Compliance:MED'
},
insurance:{
focus_ja:['見積精度','契約管理','保険金請求処理','コンプライアンス'],
focus_en:['Quote accuracy','Policy management','Claim processing','Compliance'],
bugs_ja:['見積計算誤差','契約更新漏れ','請求処理遅延','監査証跡不足'],
bugs_en:['Quote calculation errors','Policy renewal miss','Claim processing delays','Insufficient audit trails'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:CRITICAL|UX:HIGH|Compliance:CRITICAL'
}
};
// ── Cross-cutting QA Patterns ──
const QA_CROSS_CUTTING={
concurrency:{ja:'同時アクセス競合テスト',en:'Concurrent access race condition test',domains:['fintech','ec','booking','community','saas']},
idempotency:{ja:'二重処理防止(冪等性)',en:'Double-processing prevention (idempotency)',domains:['fintech','ec','booking']},
spike:{ja:'スパイクトラフィック耐性(通常の100倍)',en:'Spike traffic resilience (100x normal)',domains:['ec','content','community','booking']},
offline:{ja:'オフライン/劣化ネットワーク動作',en:'Offline/degraded network operation',domains:['iot','content','community']},
tenant:{ja:'マルチテナント分離(RLS)',en:'Multi-tenant isolation (RLS)',domains:['saas','analytics']},
api_resilience:{ja:'外部API耐障害性(タイムアウト/リトライ/フォールバック)',en:'External API resilience (timeout/retry/fallback)',domains:['booking','saas','ec','analytics']},
a11y:{ja:'アクセシビリティ(WCAG)',en:'Accessibility (WCAG)',domains:['education','content','hr']},
audit:{ja:'監査ログ完全性',en:'Audit log completeness',domains:['fintech','saas','hr','legal']},
rate_limiting:{ja:'レート制限(APIキー/IP単位)',en:'Rate limiting (per API key/IP)',domains:['saas','devtool','fintech','ai']},
data_export:{ja:'データエクスポート(CSV/JSON/Excel)',en:'Data export (CSV/JSON/Excel)',domains:['saas','analytics','hr']},
notification:{ja:'通知配信(Email/Push/SMS)',en:'Notification delivery (Email/Push/SMS)',domains:['saas','community','event','newsletter']},
realtime:{ja:'リアルタイム更新(WebSocket/SSE)',en:'Realtime updates (WebSocket/SSE)',domains:['collab','community','analytics','iot']}
};
// ── Industry Test Matrix (15 Industries) ──
const _tm=(cf_ja,cf_en,tf_ja,tf_en,tb_ja,tb_en,t_ja,t_en,p)=>({critical_functions_ja:cf_ja,critical_functions_en:cf_en,test_focus_ja:tf_ja,test_focus_en:tf_en,typical_bugs_ja:tb_ja,typical_bugs_en:tb_en,tools_ja:t_ja,tools_en:t_en,priority:p});
const INDUSTRY_TEST_MATRIX={
fintech:_tm(['決済処理','残高更新','取引履歴','KYC検証'],['Payment processing','Balance updates','Transaction history','KYC verification'],['金額計算精度','同時取引競合','不正検知','監査ログ完全性'],['Amount calculation accuracy','Concurrent transaction conflicts','Fraud detection','Audit log completeness'],['浮動小数点誤差','二重決済','トランザクション分離不足','ログ欠損'],['Floating point errors','Double payments','Transaction isolation failures','Missing logs'],['Jest(単体)','Playwright(E2E)','k6(負荷)','SonarQube(静的解析)'],['Jest (unit)','Playwright (E2E)','k6 (load)','SonarQube (static)'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'),
health:_tm(['患者情報管理','診療記録','処方箋','予約管理'],['Patient information','Medical records','Prescriptions','Appointment scheduling'],['PHI保護(HIPAA)','データ暗号化','アクセス制御','監査証跡'],['PHI protection (HIPAA)','Data encryption','Access control','Audit trail'],['暗号化漏れ','権限チェック不足','ログ改ざん','データ漏洩'],['Encryption gaps','Insufficient permission checks','Log tampering','Data leaks'],['Jest','Cypress','OWASP ZAP(セキュリティ)','Trivy(脆弱性)'],['Jest','Cypress','OWASP ZAP (security)','Trivy (vulnerabilities)'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'),
ec:_tm(['商品検索','カート操作','決済','在庫管理'],['Product search','Cart operations','Checkout','Inventory management'],['在庫同期','決済フロー','クーポン適用','配送計算'],['Inventory sync','Payment flow','Coupon application','Shipping calculation'],['在庫不整合','カート競合','クーポン二重適用','決済タイムアウト'],['Inventory mismatch','Cart conflicts','Double coupon usage','Payment timeout'],['Vitest','Playwright','Lighthouse(UX)','k6'],['Vitest','Playwright','Lighthouse (UX)','k6'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'),
saas:_tm(['認証','ユーザー管理','課金','プラン変更'],['Authentication','User management','Billing','Plan changes'],['マルチテナント分離','API制限','Webhook配信','データ移行'],['Multi-tenant isolation','API rate limits','Webhook delivery','Data migration'],['テナント間漏洩','レート制限抜け','Webhook失敗','移行データ欠損'],['Cross-tenant leakage','Rate limit bypass','Webhook failures','Migration data loss'],['Jest','Playwright','Postman(API)','Grafana k6'],['Jest','Playwright','Postman (API)','Grafana k6'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
social:_tm(['投稿','コメント','いいね','通知'],['Posts','Comments','Likes','Notifications'],['リアルタイム更新','スパム検知','モデレーション','通知配信'],['Realtime updates','Spam detection','Moderation','Notification delivery'],['通知遅延','スパム漏れ','モデレーション誤判定','N+1クエリ'],['Notification delays','Spam leakage','False moderation','N+1 queries'],['Vitest','Playwright','WebSocket Tester','Apache JMeter'],['Vitest','Playwright','WebSocket Tester','Apache JMeter'],'Security:MED|Performance:HIGH|DataIntegrity:MED|UX:HIGH|Compliance:MED'),
education:_tm(['学習進捗','クイズ','成績管理','証明書発行'],['Learning progress','Quizzes','Grade management','Certificate issuance'],['進捗同期','クイズ採点','WCAG準拠','FERPA遵守'],['Progress sync','Quiz grading','WCAG compliance','FERPA compliance'],['進捗消失','採点ミス','アクセシビリティ欠陥','未成年データ保護不足'],['Progress loss','Grading errors','Accessibility defects','Minor data protection gaps'],['Jest','Cypress','axe DevTools(a11y)','Lighthouse'],['Jest','Cypress','axe DevTools (a11y)','Lighthouse'],'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:HIGH'),
gaming:_tm(['ポイント付与','ランキング','実績解除','リーダーボード'],['Point rewards','Rankings','Achievement unlock','Leaderboard'],['ポイント整合性','ランキング更新','不正検知','同時アクセス'],['Point consistency','Ranking updates','Cheat detection','Concurrent access'],['ポイント二重付与','ランキング不整合','不正ポイント獲得','競合状態'],['Double point awards','Ranking inconsistency','Cheating','Race conditions'],['Vitest','Playwright','Redis (cache)','k6'],['Vitest','Playwright','Redis (cache)','k6'],'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:HIGH|Compliance:LOW'),
iot:_tm(['センサーデータ収集','デバイス制御','アラート','ダッシュボード'],['Sensor data collection','Device control','Alerts','Dashboard'],['データ精度','通信安定性','バッテリー効率','オフライン動作'],['Data accuracy','Communication stability','Battery efficiency','Offline operation'],['センサー誤差','通信断','バッテリー消耗','データ欠損'],['Sensor errors','Communication failures','Battery drain','Data loss'],['Pytest','Selenium','MQTT Explorer','Postman'],['Pytest','Selenium','MQTT Explorer','Postman'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
travel:_tm(['予約','空室検索','決済','キャンセル'],['Booking','Availability search','Payment','Cancellation'],['在庫同期','ダブルブッキング防止','キャンセルポリシー','多言語対応'],['Inventory sync','Double booking prevention','Cancellation policy','Multi-language support'],['ダブルブッキング','在庫不整合','キャンセル料計算ミス','決済失敗'],['Double bookings','Inventory mismatch','Cancellation fee errors','Payment failures'],['Jest','Playwright','k6','i18next (i18n)'],['Jest','Playwright','k6','i18next (i18n)'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'),
logistics:_tm(['配送追跡','在庫管理','ルート最適化','倉庫管理'],['Shipment tracking','Inventory management','Route optimization','Warehouse management'],['追跡精度','在庫同期','配送時間予測','GPS精度'],['Tracking accuracy','Inventory sync','Delivery time prediction','GPS accuracy'],['追跡更新遅延','在庫不整合','ルート計算ミス','GPS誤差'],['Tracking update delays','Inventory mismatch','Route calculation errors','GPS inaccuracy'],['Vitest','Playwright','Google Maps API','k6'],['Vitest','Playwright','Google Maps API','k6'],'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
realestate:_tm(['物件検索','内見予約','契約管理','入居者管理'],['Property search','Viewing appointments','Contract management','Tenant management'],['検索精度','契約ステータス','家賃計算','期限管理'],['Search accuracy','Contract status','Rent calculation','Deadline management'],['検索漏れ','契約状態不整合','家賃計算ミス','期限通知漏れ'],['Missing search results','Contract state inconsistency','Rent calculation errors','Missing deadline notifications'],['Jest','Playwright','Mapbox (map)','Cron (schedule)'],['Jest','Playwright','Mapbox (map)','Cron (schedule)'],'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
media:_tm(['記事投稿','コメント','購読管理','アクセス分析'],['Article publishing','Comments','Subscription management','Analytics'],['SEO最適化','画像最適化','コメントモデレーション','アクセス解析'],['SEO optimization','Image optimization','Comment moderation','Access analytics'],['SEOメタ欠損','画像読込遅延','スパムコメント','アクセス集計ミス'],['Missing SEO meta','Slow image loading','Spam comments','Analytics errors'],['Vitest','Playwright','Lighthouse','Google Analytics'],['Vitest','Playwright','Lighthouse','Google Analytics'],'Security:MED|Performance:HIGH|DataIntegrity:MED|UX:HIGH|Compliance:MED'),
hr:_tm(['応募管理','面接スケジュール','評価記録','オファー発行'],['Application management','Interview scheduling','Evaluation records','Offer issuance'],['応募者データ保護','評価公平性','GDPR遵守','通知配信'],['Applicant data protection','Evaluation fairness','GDPR compliance','Notification delivery'],['データ漏洩','評価バイアス','GDPR違反','通知遅延'],['Data leaks','Evaluation bias','GDPR violations','Notification delays'],['Jest','Cypress','OWASP ZAP','Mailgun (email)'],['Jest','Cypress','OWASP ZAP','Mailgun (email)'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'),
marketing:_tm(['キャンペーン管理','A/Bテスト','コンバージョン計測','セグメント配信'],['Campaign management','A/B testing','Conversion tracking','Segment delivery'],['コンバージョン精度','セグメント正確性','配信タイミング','ROI計算'],['Conversion accuracy','Segment accuracy','Delivery timing','ROI calculation'],['コンバージョン重複計測','セグメント漏れ','配信遅延','ROI計算ミス'],['Duplicate conversion tracking','Segment gaps','Delivery delays','ROI calculation errors'],['Vitest','Playwright','Google Tag Manager','Mixpanel'],['Vitest','Playwright','Google Tag Manager','Mixpanel'],'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
government:_tm(['申請受付','審査','承認','証明書発行'],['Application intake','Review','Approval','Certificate issuance'],['アクセシビリティ','セキュリティ','監査証跡','長期保管'],['Accessibility','Security','Audit trail','Long-term storage'],['a11y欠陥','権限エラー','監査ログ欠損','データ消失'],['a11y defects','Permission errors','Missing audit logs','Data loss'],['Jest','Cypress','axe DevTools','OWASP ZAP'],['Jest','Cypress','axe DevTools','OWASP ZAP'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:HIGH'),
};
// ── Domain Intelligence Playbook (Implementation/Compliance/Prevention/Context/Skills) ──
const _CF='FERPA';const _CP='PCI DSS';const _CH='HIPAA';const _CG='GDPR';
// Compression constants for prevent patterns
const _PVJ='|対策:';const _PVE='|Fix: ';
const _dpb=(i_ja,i_en,c_ja,c_en,p_ja,p_en,ctx_ja,ctx_en,sk_ja,sk_en)=>({impl_ja:i_ja,impl_en:i_en,compliance_ja:c_ja,compliance_en:c_en,prevent_ja:p_ja,prevent_en:p_en,ctx_ja:ctx_ja,ctx_en:ctx_en,skill_ja:sk_ja,skill_en:sk_en});
const DOMAIN_PLAYBOOK={
education:_dpb(
['学習目標→知識体系→カリキュラム→評価基準(例:TOEIC 650→900=300h)','成績データ→パターン分析→弱点特定→個別最適化(正答率<60%優先)','理解度テスト→習熟判定→次単元解放(≥80%進む、<60%再履修)'],
['Goal→Knowledge map→Curriculum→Assessment (e.g. TOEIC 650→900=300hrs)','Grade data→Pattern analysis→Weakness ID→Personalization (prioritize <60%)','Test→Mastery→Unlock next (≥80% proceed, <60% retry)'],
[_CF+':学生データ暗号化、保護者同意、保持5年','WCAG 2.1 AA、スクリーンリーダー対応',_CG+':Right to be forgotten'],
[_CF+': student data encrypt, parental consent, 5yr retention','WCAG 2.1 AA, screen reader',_CG+': Right to be forgotten'],
['進捗消失|localStorage超過'+_PVJ+'IndexedDB移行','カンニング検出漏れ|タブ監視のみ'+_PVJ+'Proctorio+視線追跡','学習時間水増し|非アクティブカウント'+_PVJ+'操作監視、5分で停止'],
['Progress loss|localStorage quota'+_PVE+'IndexedDB','Cheating miss|Tab-only monitor'+_PVE+'Proctorio+eye track','Time inflation|Counts inactive'+_PVE+'Activity monitor, 5min pause'],
['新機能→requirements.md, design_system.md, error_logs.md','バグ→error_logs.md, test_cases/, architecture.md','分析→architecture.md(model), api_spec.md'],
['Feature→requirements.md, design_system.md, error_logs.md','Bug→error_logs.md, test_cases/, architecture.md','Analysis→architecture.md(model), api_spec.md'],
'学習効果測定|カリキュラム最適化|入力:学習履歴JSON、目標|判断:<60%復習、60-79%補助、≥80%解放|出力:優先リスト、推定時間',
'Learning Effectiveness|Optimize curriculum|Input: history JSON, target|Judgment: <60% review, 60-79% supplemental, ≥80% unlock|Output: priority list, estimate'
),
ec:_dpb(
['購買→カート→決済完了→リピート(初回割30%→LTV 3.2x、カゴ落ち60%→回収18%)','在庫→需要予測→発注→欠品防止(90日平均+季節係数)','客単価→レコメンド→クロスセル→向上(3点提示でCTR 12%)'],
['Intent→Cart→Checkout→Repeat (30% discount→3.2x LTV, 60% abandon→18% recovery)','Inventory→Forecast→Reorder→Prevention (90d avg+seasonal)','Spending→Recommend→Cross-sell→Increase (3 items→12% CTR)'],
[_CP+':トークン化、Stripe Radar、年次認証','特商法:運営者、返品、配送料','薬機法/景表法:誇大禁止'],
[_CP+': tokenization, Stripe Radar, annual cert','Commercial Act: operator, return, shipping','Pharma/Ad Law: no exaggeration'],
['二重決済|冪等性未実装'+_PVJ+'Stripe key、ボタン無効化','在庫切れ購入|race condition'+_PVJ+'SELECT FOR UPDATE、3フェーズ','カゴ落ち60%|決済離脱'+_PVJ+'住所補完、Apple Pay、ゲスト許可'],
['Double charge|No idempotency'+_PVE+'Stripe key, disable button','Stockout purchase|Race condition'+_PVE+'SELECT FOR UPDATE, 3-phase','60% abandon|Checkout friction'+_PVE+'Address autocomplete, Apple Pay, guest'],
['決済→architecture.md(Stripe), security.md, error_logs.md','在庫→architecture.md(inventory), api_spec.md(stock)','レコメンド→stakeholders.md(ML), api_spec.md'],
['Payment→architecture.md(Stripe), security.md, error_logs.md','Inventory→architecture.md(inventory), api_spec.md(stock)','Recommend→stakeholders.md(ML), api_spec.md'],
'カゴ落ち防止|決済完了率向上|入力:Analytics、Stripe、アンケート|判断:離脱>50%要改善、入力>3分補完、エラー>5%手段追加|出力:改善リスト、A/Bテスト、期待効果',
'Cart Abandon Prevention|Improve completion|Input: Analytics, Stripe, survey|Judgment: abandon>50% improve, fill>3min autocomplete, error>5% add methods|Output: improvement list, A/B test, impact'
),
saas:_dpb(
['MRR目標→顧客数→CAC→予算(MRR $50k、チャーン5%→+30顧客/月)','解約率→施策→改善→削減(オンボード<50%→ツアー+22%)','使用率→指標→アップセル→ARPU(週ログイン<2回リスク)'],
['MRR target→Customers→CAC→Budget (MRR $50k, 5% churn→+30/mo)','Churn→Tactics→Improve→Reduce (onboard<50%→tour+22%)','Usage→Metrics→Upsell→ARPU (weekly<2 risk)'],
['SOC 2 Type II:暗号化、検知、監査',_CG+':DPA、開示、ポータビリティ','利用規約:SLA 99.9%、削除30日'],
['SOC 2 Type II: encrypt, detect, audit',_CG+': DPA, disclose, portability','ToS: SLA 99.9%, delete 30d'],
['テナント分離漏れ|RLS未設定'+_PVJ+'RLS必須、tenant_id必須','Rate limit突破|backoff未実装'+_PVJ+'2^n待機、Circuit Breaker','オンボード離脱50%|設定複雑'+_PVJ+'ツアー、プリセット、Aha!短縮'],
['Tenant isolation|Missing RLS'+_PVE+'Enforce RLS, tenant_id required','Rate limit|No backoff'+_PVE+'2^n wait, Circuit Breaker','50% onboard drop|Complex setup'+_PVE+'Tour, presets, shorten Aha!'],
['分離→architecture.md(RLS), security.md, test_cases/','解約→stakeholders.md(CS), progress.md, api_spec.md','機能→requirements.md, design_system.md'],
['Isolation→architecture.md(RLS), security.md, test_cases/','Churn→stakeholders.md(CS), progress.md, api_spec.md','Feature→requirements.md, design_system.md'],
'チャーン予測|解約リスク検知|入力:行動ログ、契約情報|判断:ログイン<2かつ問合せ≥3高リスク、使用率<30%中リスク|出力:スコア、予測日、アクション',
'Churn Prediction|Detect risk|Input: behavior logs, contract|Judgment: logins<2 AND tickets≥3 high risk, usage<30% medium|Output: score, date, actions'
),
fintech:_dpb(
['投資目標→リターン→リスク→配分(60歳5,000万円→年利6.8%)','信用→与信→金利→管理(FICO 650-699→50万円、15%)','取引→異常検知→判定→ブロック(深夜高額→ML 92%→凍結)'],
['Goal→Return→Risk→Allocation (60yo ¥50M→6.8% return)','Credit→Limit→Rate→Manage (FICO 650-699→¥500k, 15%)','Transaction→Detect→Judge→Block (3AM high→ML 92%→freeze)'],
['金融庁:第二種、資金移動業',_CP+':600万件超、四半期スキャン','収益移転防止:eKYC、届出、7年保存'],
['FSA: Type II, Funds Transfer',_CP+': >6M/yr, quarterly scan','AML/KYC: eKYC, report, 7yr retention'],
['二重送金|残高チェック不足'+_PVJ+'SELECT FOR UPDATE、冪等性','不正検出漏れ|ルールのみ'+_PVJ+'LightGBM、行動学習','金利ズレ|浮動小数点誤差'+_PVJ+'Decimal、整数演算'],
['Double transfer|Insufficient check'+_PVE+'SELECT FOR UPDATE, idempotency','Fraud miss|Rule-only'+_PVE+'LightGBM, behavior learning','Interest error|Float rounding'+_PVE+'Decimal, integer math'],
['送金→architecture.md(transaction), security.md(PCI DSS)','検知→architecture.md(ML), api_spec.md(fraud)','計算→architecture.md(interest), test_cases/, error_logs.md'],
['Transfer→architecture.md(transaction), security.md(PCI DSS)','Fraud→architecture.md(ML), api_spec.md(fraud)','Interest→architecture.md(interest), test_cases/, error_logs.md'],
'与信審査|融資判定|入力:スコア、年収、勤続、借入、延滞|判断:≥720承認30%8%、650-719承認20%15%、<650人間審査|出力:可否、限度額、金利、返済計画',
'Credit Underwriting|Loan decision|Input: score, income, tenure, debt, delinquency|Judgment: ≥720 approve 30% 8%, 650-719 approve 20% 15%, <650 manual|Output: decision, limit, rate, repayment'
),
health:_dpb(
['目標→リスク→改善プラン→予防(糖尿病35%→17.5%に体重-8kg)','症状→候補→検査→医療機関(頭痛+熱38.5℃+咳→インフルA 78%)','服薬→遵守率→効果→最適化(飲み忘れ30%→リマインダー85%)'],
['Goal→Risk→Plan→Prevention (diabetes 35%→17.5% via -8kg)','Symptom→Candidates→Tests→Facility (headache+fever 38.5℃+cough→Flu A 78%)','Medication→Adherence→Effect→Optimize (30% miss→reminder 85%)'],
[_CH+':PHI暗号化、監査、BAA','医療機器:診断=クラスII、記録=非該当、届出','個情保護:匿名加工、オプトアウト'],
[_CH+': PHI encrypt, audit, BAA','Medical device: diagnostic=Class II, records=non-device','Privacy: anonymize, opt-out'],
['診断ミス|データ不足'+_PVJ+'必須入力増、禁忌チェック','通知されない|許可OFF'+_PVJ+'ガイダンス、PWA、SMS','連携エラー|スコープ不足'+_PVJ+'権限明示、再認証、リトライ'],
['Diagnostic error|Insufficient data'+_PVE+'Increase inputs, contraindication check','No notification|Permission OFF'+_PVE+'Guidance, PWA, SMS','Integration error|Scope insufficient'+_PVE+'Specify permissions, re-auth, retry'],
['診断→architecture.md(ML), security.md(HIPAA), test_cases/','服薬→architecture.md(notification), api_spec.md, error_logs.md','連携→architecture.md(HealthKit), sequence_diagrams/'],
['Diagnostic→architecture.md(ML), security.md(HIPAA), test_cases/','Medication→architecture.md(notification), api_spec.md, error_logs.md','Integration→architecture.md(HealthKit), sequence_diagrams/'],
'健康リスク予測|発症リスク予測|入力:健診データ、生活習慣、家族歴|判断:10年>30%高リスク、BMI≥25かつ血糖≥110糖尿病予備群|出力:スコア、目標、削減率、根拠',
'Health Risk Prediction|Predict onset|Input: checkup data, lifestyle, family history|Judgment: 10yr>30% high risk, BMI≥25 AND sugar≥110 prediabetes|Output: scores, goals, reduction, evidence'
),
booking:_dpb(
['可能枠→予測→動的価格→稼働率(19-20時満席→18時割20%)','空室→判定→制限→収益(週末2泊以上、直前50%オフ)','キャンセル率→前払い→防止→保護(15%→カード登録で3%)'],
['Slots→Forecast→Dynamic price→Occupancy (7-8PM full→6PM 20% off)','Vacancy→Detect→Restriction→Revenue (weekend 2-night min, last-min 50% off)','Cancel rate→Prepay→Prevent→Protect (15%→card reg 3%)'],
['旅行業法:第三種登録、管理、掲示','景表法:二重価格規制、おとり禁止','キャンセル:返金明示、手数料上限'],
['Travel Act: Type III reg, mgmt, display','Gift Act: dual price reg, bait prohibit','Cancel: refund disclose, fee cap'],
['ダブルブッキング|競合状態'+_PVJ+'Lock、3段階、5分同期+バッファ','待ち通知されない|接続切断'+_PVJ+'SSE fallback、SMS/Email、30秒以内','価格急変クレーム|更新頻度高'+_PVJ+'30分固定、理由表示'],
['Double booking|Race condition'+_PVE+'Lock, 3-phase, 5min sync+buffer','Waitlist no notify|Connection loss'+_PVE+'SSE fallback, SMS/Email, within 30sec','Price change complaint|Too frequent'+_PVE+'30min hold, show reason'],
['予約→architecture.md(inventory), sequence_diagrams/(flow), security.md','価格→architecture.md(pricing), api_spec.md, stakeholders.md','キャンセル→architecture.md(policy), api_spec.md, error_logs.md'],
['Booking→architecture.md(inventory), sequence_diagrams/(flow), security.md','Pricing→architecture.md(pricing), api_spec.md, stakeholders.md','Cancel→architecture.md(policy), api_spec.md, error_logs.md'],
'在庫最適化|稼働率収益最大化|入力:履歴、季節変動、イベント|判断:<60%割引、>90%値上げ、繁忙期制限、直前大幅割|出力:価格帯、制御ルール、期待値',
'Inventory Optimization|Maximize occupancy revenue|Input: history, seasonal, events|Judgment: <60% discount, >90% increase, peak restrict, last-min deep discount|Output: price range, rules, expected'
),
_default:_dpb(
['目標→KPI→機能→優先度(売上月100万円→CVR 2%→決済最優先)','ペイン→解決策→MVP→検証(情報過多→AIレコメンド→3パターン→A/B)','データ→ロジック→API→UI(User-Post-Comment→CRUD+検索→REST→画面)'],
['Goal→KPI→Features→Priority (sales ¥1M/mo→CVR 2%→payment first)','Pain→Solution→MVP→Validation (overload→AI recommend→3 patterns→A/B)','Data→Logic→API→UI (User-Post-Comment→CRUD+search→REST→screens)'],
[_CG+':処理合法性、権利(アクセス・削除)、Cookie同意','OWASP Top 10、SQLi/XSS防止、パスワードハッシュ(bcrypt)','規約:必須記載、保持期限、第三者提供'],
[_CG+': lawful processing, rights (access, delete), cookie consent','OWASP Top 10, SQLi/XSS prevent, password hash (bcrypt)','ToS: mandatory items, retention, third-party'],
['認証バイパス|JWT検証不足'+_PVJ+'全ルートで検証、7日期限、リフレッシュ','N+1クエリ|個別取得'+_PVJ+'JOIN、eager loading、監視>10アラート','遅延|全件取得、INDEX未設定'+_PVJ+'ページネーション(limit 20)、INDEX、APM'],
['Auth bypass|Insufficient JWT validation'+_PVE+'Enforce all routes, 7d expiry, refresh','N+1 query|Individual fetch'+_PVE+'JOIN, eager loading, monitor>10 alert','Delay|Fetch all, no INDEX'+_PVE+'Pagination (limit 20), INDEX, APM'],
['機能→requirements.md, architecture.md, design_system.md','バグ→error_logs.md, test_cases/, architecture.md','性能→architecture.md(optimize), sequence_diagrams/'],
['Feature→requirements.md, architecture.md, design_system.md','Bug→error_logs.md, test_cases/, architecture.md','Performance→architecture.md(optimize), sequence_diagrams/'],
'要件整理|曖昧→構造化|入力:議事録、ストーリー、目標|判断:Must/Should/Won'+"'"+'t、Mustは数値目標、依存明示|出力:要件定義書、ER図、遷移図、選定理由',
'Requirements Refinement|Ambiguous→Structured|Input: minutes, stories, goals|Judgment: Must/Should/Won'+"'"+'t, Must has numeric targets, dependencies explicit|Output: requirements doc, ER, transitions, rationale'
),
marketplace:_dpb(
['出品→審査→マッチング→取引(手数料10%、エスクロー48h保護)','評価→信頼→プレミアム販売者(評価4.8+、100件→優先表示)','トラブル→仲裁→解決(通常7日、エスクロー解放延長)'],
['Listing→Review→Match→Transaction (10% fee, 48h escrow protection)','Rating→Trust→Premium seller (4.8+, 100 items→priority)','Dispute→Arbitrate→Resolve (7d standard, escrow hold extended)'],
['特商法:販売者開示、エスクロー、解決支援','景表法:おとり広告禁止、二重価格規制',_CG+':販売者・購入者情報保護'],
[_CP+', Commercial Act: seller disclosure, escrow, dispute','Gift Act: prohibit bait ads, dual price reg',_CG+': seller/buyer info protection'],
['マッチング精度低|データ不足|ルール→100件でML','不正評価|サクラ|検知:短期間集中、IPクラスタ','手数料計算ミス|複雑割引'+_PVJ+'事前見積、決済前確認'],
['Matching accuracy low|Insufficient data|Rules→ML after 100','Fake reviews|Shilling|Detect: burst period, IP cluster','Fee calc error|Complex discount'+_PVE+'Pre-estimate, confirm before payment'],
['出品→requirements.md, api_spec.md(listing), test_cases/','評価→architecture.md(trust), api_spec.md, error_logs.md','仲裁→architecture.md(dispute), sequence_diagrams/, stakeholders.md'],
['Listing→requirements.md, api_spec.md(listing), test_cases/','Rating→architecture.md(trust), api_spec.md, error_logs.md','Arbitration→architecture.md(dispute), sequence_diagrams/, stakeholders.md'],
'マッチング最適化|需給最適化|入力:履歴、評価、在庫、需要|判断:評価≥4.5優先、過去取引>10優遇、需要>供給値上げ推奨|出力:ランキング、価格提案、需給バランス',
'Matching Optimization|Supply-demand optimization|Input: history, ratings, inventory, demand|Judgment: rating≥4.5 priority, past trades>10 favor, demand>supply suggest increase|Output: ranking, price suggestions, balance'
),
community:_dpb(
['投稿→モデレーション→配信→エンゲージメント(自動検知+人間審査)','ユーザー→フォロー→フィード生成→ランキング(友達→興味→トレンド)','通報→審査→対応→再発防止(24h以内対応、3回で自動BAN)'],
['Post→Moderate→Distribute→Engage (auto-detect+human review)','User→Follow→Feed generation→Ranking (friends→interests→trending)','Report→Review→Action→Prevention (respond within 24h, 3 strikes auto-ban)'],
['投稿ガイド:誹謗中傷禁止、モデレーション、通報',_CG+':ユーザー生成コンテンツ責任、削除権','利用規約:著作権侵害即削除、荒らし対策'],
[_CG+', Posting: prohibit defamation, moderation, report',_CG+': UGC liability, right to delete','ToS: copyright infringement immediate delete, anti-trolling'],
['スパム|reCAPTCHA未導入'+_PVJ+'v3、5件/分制限','XSS脆弱性|サニタイズ不足'+_PVJ+'DOMPurify、CSP','フィルターバブル|類似のみ'+_PVJ+'多様性注入20%'],
['Spam|No reCAPTCHA'+_PVE+'v3, 5/min limit','XSS vulnerability|Insufficient sanitize'+_PVE+'DOMPurify, CSP','Filter bubble|Similarity only'+_PVE+'Inject diversity 20%'],
['投稿→requirements.md, api_spec.md(post), security.md(XSS)','モデレーション→architecture.md(ML), stakeholders.md, error_logs.md','エンゲージメント→architecture.md(feed), api_spec.md, test_cases/'],
['Posting→requirements.md, api_spec.md(post), security.md(XSS)','Moderation→architecture.md(ML), stakeholders.md, error_logs.md','Engagement→architecture.md(feed), api_spec.md, test_cases/'],
'コンテンツモデレーション|不適切投稿検知|入力:投稿テキスト、画像、通報履歴|判断:NGワード→即削除、グレー→人間審査、通報≥3緊急、過去違反者厳格|出力:判定、理由、対応、学習データ',
'Content Moderation|Detect inappropriate posts|Input: post text, images, report history|Judgment: banned words→immediate delete, gray→human review, reports≥3 urgent, past violators strict|Output: decision, reason, action, training data'
),
content:_dpb(
['制作→公開→配信→分析(CDN、画像最適化、SEO)','SEO→キーワード→ランク→流入(タイトル60字、メタ160字、構造化データ)','著作権→ライセンス→保護→収益化(CC BY-SA、DMCA対応)'],
['Create→Publish→Distribute→Analyze (CDN, image optimization, SEO)','SEO→Keywords→Rank→Traffic (title 60 chars, meta 160, structured data)','Copyright→License→Protect→Monetize (CC BY-SA, DMCA response)'],
['著作権:DMCA対応、コンテンツID、ライセンス(CC BY-SA)','肖像権:モデルリリース、ぼかし処理',_CG+':Cookie同意、アクセス解析匿名化'],
[_CG+', Copyright: DMCA, content ID, license (CC BY-SA)','Portrait rights: model release, blur processing',_CG+': cookie consent, analytics anonymization'],
['再生エラー|非対応コーデック|HLS、複数解像度','画像遅延|最適化不足|WebP、srcset、CDN','SEO順位低|構造化データ不足|JSON-LD、sitemap、robots.txt'],
['Playback error|Unsupported codec|HLS, multiple resolutions','Image lag|Insufficient optimization|WebP, srcset, CDN','Low SEO rank|Missing structured data|JSON-LD, sitemap, robots.txt'],
['配信→architecture.md(CDN), api_spec.md, design_system.md','SEO→requirements.md, api_spec.md(sitemap), test_cases/','著作権→architecture.md(DMCA), stakeholders.md, error_logs.md'],
['Distribution→architecture.md(CDN), api_spec.md, design_system.md','SEO→requirements.md, api_spec.md(sitemap), test_cases/','Copyright→architecture.md(DMCA), stakeholders.md, error_logs.md'],
'SEO最適化|検索順位向上|入力:ページ、キーワード、競合|判断:タイトル≤60字、h1-h6階層、内部リンク≥3、表示速度≤2.5s|出力:最適化案、期待順位、修正箇所',
'SEO Optimization|Improve search rank|Input: pages, keywords, competitors|Judgment: title≤60 chars, h1-h6 hierarchy, internal links≥3, load time≤2.5s|Output: optimization plan, expected rank, fixes'
),
analytics:_dpb(
['データ収集→集計→可視化→洞察(イベント追跡、セッション分析)','異常検知→アラート→調査→対応(閾値監視、パターン学習)','レポート→ダッシュボード→共有→意思決定(KPI、トレンド、予測)'],
['Collect→Aggregate→Visualize→Insight (event tracking, session analysis)','Anomaly detect→Alert→Investigate→Respond (threshold monitor, pattern learning)','Report→Dashboard→Share→Decide (KPI, trends, forecasts)'],
[_CG+':匿名化、集計のみ、個人特定不可','アクセス解析:Cookie同意、オプトアウト','データ保持:分析用1年、ログ3ヶ月'],
[_CG+': anonymize, aggregated only, no personal ID','Analytics: cookie consent, opt-out','Data retention: analytics 1yr, logs 3mo'],
['表示遅延|リアルタイム集計重い|事前集計、Redis、materialized view','精度低|サンプリング不足|最低1000件、季節調整','ダッシュボード遅延|N+1クエリ|集計テーブル、キャッシュ5分'],
['Display delay|Heavy real-time aggregation|Pre-aggregate, Redis, materialized view','Low accuracy|Insufficient sampling|Minimum 1000 records, seasonal adjustment','Dashboard lag|N+1 queries|Aggregation tables, cache 5min'],
['収集→architecture.md(pipeline), api_spec.md, sequence_diagrams/','集計→architecture.md(aggregation), test_cases/, error_logs.md','可視化→design_system.md, api_spec.md(dashboard), requirements.md'],
['Collection→architecture.md(pipeline), api_spec.md, sequence_diagrams/','Aggregation→architecture.md(aggregation), test_cases/, error_logs.md','Visualization→design_system.md, api_spec.md(dashboard), requirements.md'],
'異常検知|パターン異常検出|入力:時系列データ、閾値、履歴|判断:3σ超→アラート、前日比>50%注意、週次トレンド乖離|出力:異常スコア、原因候補、推奨対応',
'Anomaly Detection|Pattern anomaly detection|Input: time-series, thresholds, history|Judgment: >3σ→alert, day-over-day>50% caution, weekly trend deviation|Output: anomaly score, cause candidates, recommended actions'
),
iot:_dpb(
['デバイス登録→認証→データ収集→制御(MQTT、CoAP、証明書認証)','センサーデータ→処理→アラート→対応(閾値監視、異常検知)','ファームウェア更新→配信→適用→確認(OTA、ロールバック)'],
['Device registration→Auth→Data collection→Control (MQTT, CoAP, cert auth)','Sensor data→Process→Alert→Respond (threshold monitor, anomaly detection)','Firmware update→Distribute→Apply→Verify (OTA, rollback)'],
['電波法:技適、周波数遵守','製造物責任法:欠陥損害賠償',_CG+':デバイスデータ収集同意、匿名化'],
[_CG+', Radio Act: tech conformity, frequency','Product Liability: defect liability',_CG+': device data collection consent, anonymization'],
['切断|不安定ネットワーク|オフライン動作、ローカルキュー、指数バックオフ','ファームウェア失敗|文鎮化|A/Bパーティション、ロールバック、チェックサム','バッテリー消耗|ポーリング頻度高|間引き、差分送信、スリープモード'],
['Disconnect|Unstable network|Offline operation, local queue, exponential backoff','Firmware failure|Bricked device|A/B partition, rollback, checksum','Battery drain|High polling frequency|Throttling, delta transmission, sleep mode'],
['デバイス→architecture.md(MQTT), security.md(auth), api_spec.md','データ→architecture.md(pipeline), sequence_diagrams/, test_cases/','更新→architecture.md(OTA), error_logs.md, stakeholders.md'],
['Device→architecture.md(MQTT), security.md(auth), api_spec.md','Data→architecture.md(pipeline), sequence_diagrams/, test_cases/','Update→architecture.md(OTA), error_logs.md, stakeholders.md'],
'デバイス管理|接続状態監視制御|入力:デバイスID、センサー値、接続履歴|判断:切断>5分アラート、異常値→再送要求、バッテリー<10%省電力|出力:ステータス、コマンド、予測寿命',
'Device Management|Monitor connection & control|Input: device ID, sensor values, connection history|Judgment: disconnect>5min alert, anomalous values→resend request, battery<10% power save|Output: status, commands, predicted lifespan'
),
realestate:_dpb(
['物件登録→審査→公開→検索(画像、間取り、地図連携)','内見予約→確認→実施→フィードバック(カレンダー、リマインダー)','契約→重要事項説明→署名→完了(電子契約、クーリングオフ8日)'],
['Property registration→Review→Publish→Search (images, floor plan, map integration)','Viewing→Confirm→Conduct→Feedback (calendar, reminders)','Contract→Important matters→Sign→Complete (e-contract, 8d cooling-off)'],
['宅建業法:重要事項説明、契約書交付、クーリングオフ','表示規約:徒歩80m/分、築年数、面積正確',_CG+':個人情報保護、物件情報管理'],
[_CG+', Real Estate Act: important matters, contract, cooling-off','Display Standards: walking 80m/min, age, area accurate',_CG+': personal info protection, property info mgmt'],
['情報不整合|外部連携遅延|1時間同期、差分検知、成約済み非表示','地図ずれ|ジオコーディング精度|Google Maps API、緯度経度検証','内見重複|空き枠管理不足|Lock、3段階確認、バッファ30分'],
['Info inconsistency|External sync delay|Hourly sync, detect diff, hide sold','Map misalignment|Geocoding accuracy|Google Maps API, lat/long validation','Viewing conflict|Insufficient slot mgmt|Lock, 3-phase confirm, 30min buffer'],
['物件→architecture.md(search), api_spec.md(property), design_system.md','内見→architecture.md(booking), sequence_diagrams/, test_cases/','契約→architecture.md(e-contract), security.md, stakeholders.md'],
['Property→architecture.md(search), api_spec.md(property), design_system.md','Viewing→architecture.md(booking), sequence_diagrams/, test_cases/','Contract→architecture.md(e-contract), security.md, stakeholders.md'],
'物件管理|検索最適化推奨|入力:物件DB、検索履歴、成約データ|判断:検索上位≤10件、成約率<3%価格見直し、問合せ≥5未成約要改善|出力:ランキング、価格提案、改善点',
'Property Management|Search optimization & recommendations|Input: property DB, search history, contract data|Judgment: top search results≤10, contract rate<3% revise price, inquiries≥5 without contract→improve|Output: ranking, price suggestions, improvements'
),
legal:_dpb(
['契約作成→レビュー→承認→署名(テンプレート、バージョン管理)','案件管理→期日→アラート→対応(タスク、カレンダー、通知)','ドキュメント管理→検索→共有→監査証跡(暗号化、アクセス制御)'],
['Contract creation→Review→Approve→Sign (templates, versioning)','Case management→Deadline→Alert→Respond (tasks, calendar, notifications)','Document mgmt→Search→Share→Audit trail (encryption, access control)'],
['弁護士法:非弁禁止、法律相談は有資格者','個情保護:守秘義務、報告義務','電子署名法:電子署名の有効性、タイムスタンプ'],
[_CG+', Attorney Act: prohibit unauthorized, licensed only','Privacy: confidentiality, reporting obligation','E-Signature Act: e-signature validity, timestamp'],
['契約生成ミス|変数置換漏れ|必須チェックリスト、プレビュー必須、レビューフロー','バージョン混在|履歴管理不足|Git-like管理、diff表示、ロック','期日漏れ|通知設定不足|3段階リマインダー(7日前、3日前、当日)'],
['Contract error|Missing variable substitution|Mandatory checklist, preview required, review flow','Version confusion|Insufficient history|Git-like management, diff display, locking','Deadline miss|Insufficient notifications|3-tier reminders (7d, 3d, same-day)'],
['契約→architecture.md(template), api_spec.md, sequence_diagrams/','レビュー→architecture.md(approval), stakeholders.md, test_cases/','監査→architecture.md(audit), security.md, error_logs.md'],
['Contract→architecture.md(template), api_spec.md, sequence_diagrams/','Review→architecture.md(approval), stakeholders.md, test_cases/','Audit→architecture.md(audit), security.md, error_logs.md'],
'契約レビュー|リスク条項検出|入力:契約書テキスト、テンプレート、チェックリスト|判断:必須条項欠落→警告、リスク用語検出(無制限責任、排他的)、期限≤7日注意|出力:検出リスト、重要度、修正案',
'Contract Review|Detect risk clauses|Input: contract text, templates, checklist|Judgment: missing mandatory clauses→warn, detect risk terms (unlimited liability, exclusive), deadline≤7d caution|Output: detected list, severity, revision suggestions'
),
hr:_dpb(
['求人作成→公開→応募→選考(ATS、スクリーニング、面接)','評価→フィードバック→育成→昇進(1on1、目標管理、360度評価)','勤怠→集計→給与→支払(打刻、残業、有休管理)'],
['Job posting→Publish→Apply→Screen (ATS, screening, interviews)','Evaluation→Feedback→Develop→Promote (1-on-1, goal mgmt, 360 review)','Attendance→Aggregate→Payroll→Pay (clock-in, overtime, leave mgmt)'],
['労働基準法:勤怠記録3年、残業45h上限','個情保護:不適切質問禁止、候補者情報管理','雇用機会均等法:差別禁止、公平な選考'],
[_CG+', Labor Standards: attendance 3yr, overtime 45h max','Privacy: prohibit inappropriate questions, candidate info mgmt','Equal Opportunity: prohibit discrimination, fair screening'],
['勤怠ミス|TZ未考慮、深夜日跨ぎ|UTC統一、深夜割増22-5時、月次突合','評価バイアス|主観のみ|360度評価、定量指標、校正会議','応募者漏れ|手動管理|ATS、自動ステータス更新、リマインダー'],
['Attendance error|TZ not considered, midnight crossing|Unify UTC, late-night premium 10PM-5AM, monthly reconcile','Evaluation bias|Subjective only|360 review, quantitative metrics, calibration meeting','Applicant miss|Manual mgmt|ATS, auto-status update, reminders'],
['勤怠→architecture.md(attendance), api_spec.md, test_cases/','評価→architecture.md(evaluation), stakeholders.md, requirements.md','採用→architecture.md(ATS), sequence_diagrams/, error_logs.md'],
['Attendance→architecture.md(attendance), api_spec.md, test_cases/','Evaluation→architecture.md(evaluation), stakeholders.md, requirements.md','Hiring→architecture.md(ATS), sequence_diagrams/, error_logs.md'],
'採用フロー|選考最適化|入力:応募者データ、履歴書、面接記録|判断:必須スキル不足→不合格、経験≥3年優遇、カルチャーフィット評価|出力:合否判定、スコア、次ステップ',
'Hiring Flow|Optimize screening|Input: applicant data, resumes, interview records|Judgment: missing required skills→reject, experience≥3yrs favor, culture fit assessment|Output: pass/fail, score, next steps'
),
portfolio:_dpb(
['制作→公開→SEO→集客(レスポンシブ、画像最適化、Core Web Vitals)','プロジェクト→カテゴリ→フィルタ→表示(ポートフォリオサイト)','問合せ→フォーム→通知→対応(スパム対策、自動返信)'],
['Create→Publish→SEO→Attract (responsive, image optimization, Core Web Vitals)','Project→Category→Filter→Display (portfolio site)','Contact→Form→Notify→Respond (spam protection, auto-reply)'],
[_CG+':Cookie同意、アクセス解析','著作権:作品ライセンス明示、転載禁止','肖像権:モデルリリース、ぼかし'],
[_CG+': cookie consent, analytics','Copyright: specify work license, prohibit repost','Portrait rights: model release, blur'],
['画像未最適化|元サイズ配信|WebP、srcset、lazy loading','モバイル崩れ|レスポンシブ不足|Tailwind、ブレークポイント検証','SEO低順位|メタ不足|OGP、構造化データ、sitemap'],
['Image unoptimized|Serve original size|WebP, srcset, lazy loading','Mobile layout breaks|Insufficient responsive|Tailwind, breakpoint validation','Low SEO rank|Missing meta|OGP, structured data, sitemap'],
['制作→design_system.md, requirements.md, api_spec.md','SEO→architecture.md(SEO), test_cases/, stakeholders.md','問合せ→architecture.md(contact), security.md, error_logs.md'],
['Creation→design_system.md, requirements.md, api_spec.md','SEO→architecture.md(SEO), test_cases/, stakeholders.md','Contact→architecture.md(contact), security.md, error_logs.md'],
'SEO最適化|表示速度改善|入力:ページHTML、画像、CSS|判断:LCP≤2.5s、FID≤100ms、CLS≤0.1、画像WebP化、CSS圧縮|出力:スコア、改善リスト、期待順位',
'SEO Optimization|Improve page speed|Input: page HTML, images, CSS|Judgment: LCP≤2.5s, FID≤100ms, CLS≤0.1, image→WebP, CSS minify|Output: score, improvement list, expected rank'
),
tool:_dpb(
['タスク→自動化→効率化→測定(ショートカット、マクロ、スクリプト)','データ→エクスポート→変換→活用(CSV、JSON、API連携)','設定→カスタマイズ→共有→同期(テーマ、プリセット、クラウド)'],
['Task→Automate→Streamline→Measure (shortcuts, macros, scripts)','Data→Export→Transform→Utilize (CSV, JSON, API integration)','Settings→Customize→Share→Sync (themes, presets, cloud)'],
[_CG+':データ処理同意、エクスポート権','利用規約:使用制限、データ保持期間','セキュリティ:API認証、暗号化通信'],
[_CG+': data processing consent, export rights','ToS: usage limits, data retention','Security: API auth, encrypted communication'],
['互換性|最新API(Safari未対応)|Polyfill、Can I Use、クロスブラウザテスト','エクスポート失敗|文字コード|UTF-8 BOM、CSV区切り文字検証','ショートカット競合|他ツール衝突|設定可能化、デフォルト変更、ガイド'],
['Compatibility|Latest API (Safari unsupported)|Polyfill, Can I Use, cross-browser test','Export failure|Character encoding|UTF-8 BOM, CSV delimiter validation','Shortcut conflict|Collision with other tools|Make configurable, change defaults, guide'],
['自動化→architecture.md(automation), api_spec.md, test_cases/','エクスポート→architecture.md(export), error_logs.md, stakeholders.md','設定→design_system.md, requirements.md, api_spec.md'],
['Automation→architecture.md(automation), api_spec.md, test_cases/','Export→architecture.md(export), error_logs.md, stakeholders.md','Settings→design_system.md, requirements.md, api_spec.md'],
'ワークフロー自動化|反復作業削減|入力:タスクログ、操作履歴、頻度|判断:週≥3回→自動化候補、手順≥5ステップ優先、エラー率>10%要改善|出力:自動化案、期待削減時間、実装難易度',
'Workflow Automation|Reduce repetitive tasks|Input: task logs, operation history, frequency|Judgment: weekly≥3 times→automation candidate, steps≥5 prioritize, error rate>10% improve|Output: automation plan, expected time savings, implementation difficulty'
),
ai:_dpb(['プロンプト→生成→評価→改善','会話履歴→コンテキスト→応答品質','トークン→コスト→最適化'],['Prompt→Generate→Evaluate→Improve','History→Context→Quality','Token→Cost→Optimize'],[_CG+':データ処理同意','OpenAI ToS準拠','プロンプト暗号化'],[_CG+': data consent','OpenAI ToS compliance','Prompt encryption'],['プロンプト漏洩|ログ保存'+_PVJ+'暗号化、アクセス制御','トークン超過|無制限生成'+_PVJ+'制限設定、アラート'],[' Prompt leak|Log storage'+_PVE+'encrypt, access control','Token overuse|Unlimited'+_PVE+'limits, alerts'],['生成→architecture.md(AI), api_spec.md','履歴→stakeholders.md, security.md'],['Generate→architecture.md(AI), api_spec.md','History→stakeholders.md, security.md'],'プロンプト最適化|コスト削減|入力:履歴、トークン数|判断:>1000トークン→要約、重複→キャッシュ|出力:最適化案','Prompt Optimization|Cost reduction|Input: history, tokens|Judgment: >1000 tokens→summarize, duplicate→cache|Output: optimization plan'),
automation:_dpb(['トリガー→実行→完了→通知','エラー→リトライ→成功→記録','ワークフロー→最適化→測定'],['Trigger→Execute→Complete→Notify','Error→Retry→Success→Log','Workflow→Optimize→Measure'],[_CG+':自動化同意','実行ログ保存','エラー通知'],[_CG+': automation consent','Execution logs','Error notification'],['無限ループ|終了条件なし'+_PVJ+'最大実行回数、タイムアウト','リトライ過多|無制限'+_PVJ+'指数バックオフ、上限設定'],['Infinite loop|No exit'+_PVE+'max runs, timeout','Retry overuse|Unlimited'+_PVE+'exponential backoff, limit'],['実行→architecture.md(workflow), api_spec.md','エラー→error_logs.md, stakeholders.md'],['Execute→architecture.md(workflow), api_spec.md','Error→error_logs.md, stakeholders.md'],'ワークフロー効率化|実行時間短縮|入力:実行ログ、ステップ時間|判断:>60s→並列化候補、失敗率>10%→要改善|出力:最適化案、期待時間削減','Workflow Efficiency|Reduce execution time|Input: logs, step duration|Judgment: >60s→parallel candidate, fail>10%→improve|Output: optimization, expected savings'),
event:_dpb(['企画→告知→販売→開催','チケット→購入→検証→入場','キャンセル→返金→再販売'],['Plan→Announce→Sell→Hold','Ticket→Purchase→Verify→Entry','Cancel→Refund→Resell'],['個人情報保護法:氏名、メール暗号化','特商法:返金規定明記','会場規約:安全管理'],[' Privacy Act: name, email encrypt','Commercial Act: refund policy','Venue: safety management'],['定員超過|競合販売'+_PVJ+'SELECT FOR UPDATE、在庫ロック','QR重複|生成ミス'+_PVJ+'UUID、検証チェック'],['Oversell|Race condition'+_PVE+'SELECT FOR UPDATE, lock','QR duplicate|Generation error'+_PVE+'UUID, validation'],['販売→architecture.md(ticket), security.md','検証→architecture.md(QR), api_spec.md'],['Sales→architecture.md(ticket), security.md','Verify→architecture.md(QR), api_spec.md'],'チケット販売最適化|売上最大化|入力:販売履歴、残席、需要|判断:残席<20%→値上げ候補、売行き悪い→割引検討|出力:価格戦略、期待売上','Ticket Sales Optimization|Maximize revenue|Input: sales history, remaining, demand|Judgment: remaining<20%→price up candidate, slow sales→discount|Output: pricing strategy, expected revenue'),
gamify:_dpb(['参加→達成→獲得→継続','ポイント→バッジ→ランキング→報酬','行動→測定→分析→最適化'],['Join→Achieve→Earn→Continue','Points→Badges→Ranking→Rewards','Behavior→Measure→Analyze→Optimize'],[_CG+':ポイント管理透明性','利用規約:ポイント有効期限','不正防止:行動監視'],[_CG+': point management transparency','ToS: point expiration','Fraud: behavior monitoring'],['ポイント重複付与|冪等性なし'+_PVJ+'トランザクション、重複チェック','ランキング操作|不正行動'+_PVJ+'異常検知、手動確認'],['Duplicate points|No idempotency'+_PVE+'transaction, duplicate check','Ranking manipulation|Fraud'+_PVE+'anomaly detection, manual review'],['達成→architecture.md(gamify), api_spec.md','不正→error_logs.md, security.md'],['Achievement→architecture.md(gamify), api_spec.md','Fraud→error_logs.md, security.md'],'エンゲージメント向上|継続率改善|入力:行動ログ、達成率|判断:完了<30%→難易度調整、離脱>50%→報酬見直し|出力:改善案、期待継続率','Engagement Improvement|Retention increase|Input: behavior logs, completion|Judgment: complete<30%→adjust difficulty, churn>50%→review rewards|Output: improvement plan, expected retention'),
collab:_dpb(['作成→編集→同期→保存','競合→解決→マージ→履歴','権限→承認→共有→通知'],['Create→Edit→Sync→Save','Conflict→Resolve→Merge→History','Permission→Approve→Share→Notify'],[_CG+':データ処理同意','利用規約:編集権限、削除30日','セキュリティ:暗号化通信、アクセスログ'],[_CG+': data processing consent','ToS: edit permission, delete 30d','Security: encrypted communication, access log'],['編集消失|競合解決失敗'+_PVJ+'OT/CRDT、定期保存','権限漏れ|チェック不足'+_PVJ+'RLS、middleware検証'],['Edit loss|Conflict resolution failure'+_PVE+'OT/CRDT, periodic save','Permission bypass|Insufficient check'+_PVE+'RLS, middleware validation'],['同期→architecture.md(realtime), api_spec.md','権限→security.md, test_cases/'],['Sync→architecture.md(realtime), api_spec.md','Permission→security.md, test_cases/'],'競合解決最適化|編集消失防止|入力:編集履歴、競合頻度|判断:競合>5/h→通知強化、消失>1%→保存頻度増|出力:最適化案','Conflict Resolution Optimization|Prevent edit loss|Input: edit history, conflict rate|Judgment: conflicts>5/h→enhance notification, loss>1%→increase save frequency|Output: optimization plan'),
devtool:_dpb(['登録→発行→使用→追跡','リクエスト→検証→実行→記録','エラー→通知→対応→改善'],['Register→Issue→Use→Track','Request→Verify→Execute→Log','Error→Notify→Respond→Improve'],[_CG+':データ処理同意','利用規約:レート制限、使用制限','セキュリティ:APIキー暗号化、IP制限'],[_CG+': data processing consent','ToS: rate limits, usage limits','Security: API key encryption, IP restriction'],['キー漏洩|平文保存'+_PVJ+'暗号化、ハッシュ化、定期ローテーション','レート突破|制限なし'+_PVJ+'Redis、sliding window'],['Key leakage|Plain text'+_PVE+'encrypt, hash, regular rotation','Rate bypass|No limits'+_PVE+'Redis, sliding window'],['認証→security.md, api_spec.md','使用→architecture.md(tracking), stakeholders.md'],['Auth→security.md, api_spec.md','Usage→architecture.md(tracking), stakeholders.md'],'API使用最適化|コスト削減|入力:リクエストログ、エラー率|判断:エラー>5%→要改善、重複>30%→キャッシュ候補|出力:最適化案、期待削減率','API Usage Optimization|Cost reduction|Input: request logs, error rate|Judgment: error>5%→improve, duplicate>30%→cache candidate|Output: optimization plan, expected reduction'),
creator:_dpb(['作成→公開→収益化→分析','サブスク→課金→継続→解約','ファン→交流→支援→成長'],['Create→Publish→Monetize→Analyze','Subscribe→Charge→Continue→Cancel','Fan→Engage→Support→Grow'],[_CG+':データ処理同意','資金決済法:前払式、第三者型','利用規約:手数料、返金規定'],[_CG+': data processing consent','Payment Services Act: prepaid, third-party','ToS: fees, refund policy'],['解約後課金|サブスク解約漏れ'+_PVJ+'Webhook検証、定期確認','投げ銭未着|決済失敗'+_PVJ+'リトライ、通知'],['Charge after cancel|Subscription cancel miss'+_PVE+'webhook verification, periodic check','Tip not received|Payment failure'+_PVE+'retry, notification'],['課金→architecture.md(subscription), security.md','支援→architecture.md(tip), api_spec.md'],['Billing→architecture.md(subscription), security.md','Support→architecture.md(tip), api_spec.md'],'収益最適化|ファン増加|入力:収益データ、ファン行動|判断:離脱>30%→ティア見直し、成長<10%→施策追加|出力:改善案、期待収益','Revenue Optimization|Fan growth|Input: revenue data, fan behavior|Judgment: churn>30%→review tiers, growth<10%→add tactics|Output: improvement plan, expected revenue'),
newsletter:_dpb(['作成→配信→開封→分析','購読→確認→受信→解除','セグメント→ターゲット→パーソナライズ'],['Create→Send→Open→Analyze','Subscribe→Confirm→Receive→Unsubscribe','Segment→Target→Personalize'],[_CG+':配信同意、オプトイン','特定電子メール法:配信者明記、解除リンク','個人情報保護法:購読者情報暗号化'],[_CG+': sending consent, opt-in','Anti-Spam Act: sender info, unsubscribe link','Privacy Act: subscriber info encryption'],['解除後配信|リスト更新漏れ'+_PVJ+'即時反映、定期同期','スパム判定|SPF/DKIM未設定'+_PVJ+'認証設定、レピュテーション管理'],['Send after unsubscribe|List update miss'+_PVE+'immediate reflect, periodic sync','Spam flagged|No SPF/DKIM'+_PVE+'auth setup, reputation management'],['配信→architecture.md(email), api_spec.md','分析→stakeholders.md, architecture.md(analytics)'],['Send→architecture.md(email), api_spec.md','Analytics→stakeholders.md, architecture.md(analytics)'],'配信最適化|開封率向上|入力:配信履歴、開封率、クリック率|判断:開封<20%→件名改善、クリック<5%→CTA最適化|出力:改善案、期待開封率','Delivery Optimization|Improve open rate|Input: send history, open rate, click rate|Judgment: open<20%→improve subject, click<5%→optimize CTA|Output: improvement plan, expected open rate'),
manufacturing:_dpb(['需要予測→生産計画→製造→出荷','材料→加工→検査→在庫','設備→保守→稼働→記録'],['Forecast→Plan→Manufacture→Ship','Material→Process→Inspect→Stock','Equipment→Maintain→Operate→Log'],[_CG+':製造データ保護','製造物責任法:品質記録5年保持','ISO 9001:品質マネジメント'],[_CG+': manufacturing data protection','Product Liability Act: quality records 5yr','ISO 9001: quality management'],['在庫差異|カウント誤差'+_PVJ+'バーコード、定期棚卸','不良品流出|検査漏れ'+_PVJ+'全数検査、統計的手法'],['Inventory mismatch|Count errors'+_PVE+'barcode, periodic inventory','Defect escape|Inspection miss'+_PVE+'100% inspection, statistical methods'],['生産→architecture.md(production), api_spec.md','品質→test_cases/, error_logs.md'],['Production→architecture.md(production), api_spec.md','Quality→test_cases/, error_logs.md'],'生産効率化|稼働率向上|入力:生産ログ、稼働時間|判断:稼働率<70%→改善候補、不良率>5%→工程見直し|出力:改善案、期待効率','Production Efficiency|Improve utilization|Input: production logs, uptime|Judgment: utilization<70%→improve, defect>5%→review process|Output: improvement plan, expected efficiency'),
logistics:_dpb(['受注→引当→出荷→配送','倉庫→ピッキング→梱包→発送','ルート→配送→追跡→完了'],['Order→Allocate→Ship→Deliver','Warehouse→Pick→Pack→Send','Route→Deliver→Track→Complete'],[_CG+':配送先情報暗号化','運送約款:配送条件明記','個人情報保護法:不在票記録7日削除'],[_CG+': delivery address encryption','Shipping terms: conditions','Privacy Act: absence slip 7d deletion'],['ダブル引当|在庫競合'+_PVJ+'SELECT FOR UPDATE、ロック','配送遅延|ルート非最適'+_PVJ+'AI最適化、リアルタイム調整'],['Double allocation|Inventory race'+_PVE+'SELECT FOR UPDATE, lock','Delivery delay|Non-optimal route'+_PVE+'AI optimization, real-time adjustment'],['配送→architecture.md(delivery), api_spec.md','追跡→stakeholders.md, architecture.md(tracking)'],['Delivery→architecture.md(delivery), api_spec.md','Tracking→stakeholders.md, architecture.md(tracking)'],'配送最適化|コスト削減|入力:配送履歴、燃料費、時間|判断:迂回>15%→ルート見直し、不在>30%→通知強化|出力:最適化案、期待削減','Delivery Optimization|Cost reduction|Input: delivery history, fuel, time|Judgment: detour>15%→review route, absence>30%→enhance notification|Output: optimization plan, expected reduction'),
agriculture:_dpb(['計画→播種→育成→収穫','センサー→監視→制御→記録','作物→収穫→選別→出荷'],['Plan→Sow→Grow→Harvest','Sensor→Monitor→Control→Log','Crop→Harvest→Sort→Ship'],[_CG+':農地データ保護','GAP:適正農業規範','食品衛生法:トレーサビリティ'],[_CG+': farm data protection','GAP: good agricultural practice','Food Sanitation Act: traceability'],['病害見逃し|検知遅延'+_PVJ+'画像AI、早期アラート','灌漑失敗|センサー故障'+_PVJ+'冗長化、定期校正'],['Pest miss|Detection delay'+_PVE+'image AI, early alert','Irrigation failure|Sensor fault'+_PVE+'redundancy, periodic calibration'],['収穫→architecture.md(harvest), api_spec.md','センサー→architecture.md(IoT), error_logs.md'],['Harvest→architecture.md(harvest), api_spec.md','Sensor→architecture.md(IoT), error_logs.md'],'収穫量予測|計画最適化|入力:気象データ、生育記録|判断:予測誤差>20%→モデル再訓練、病害リスク>30%→予防散布|出力:予測量、対策案','Harvest Prediction|Optimize planning|Input: weather data, growth records|Judgment: forecast error>20%→retrain model, pest risk>30%→preventive spray|Output: predicted yield, countermeasures'),
energy:_dpb(['計測→集計→分析→請求','需要予測→供給調整→配電→記録','アラート→通知→対応→改善'],['Measure→Aggregate→Analyze→Bill','Forecast→Adjust→Distribute→Log','Alert→Notify→Respond→Improve'],['電気事業法:計量精度±2%','個人情報保護法:使用量データ暗号化',_CG+':データ処理同意'],[' Electricity Act: metering ±2%','Privacy Act: usage data encryption',_CG+': data processing consent'],['計測誤差|検針ミス'+_PVJ+'スマートメーター、定期校正','需給予測外れ|気象変動'+_PVJ+'AI予測、リアルタイム調整'],['Metering error|Reading miss'+_PVE+'smart meter, periodic calibration','Forecast miss|Weather change'+_PVE+'AI forecast, real-time adjustment'],['計測→architecture.md(metering), api_spec.md','需給→stakeholders.md, architecture.md(forecast)'],['Metering→architecture.md(metering), api_spec.md','Supply→stakeholders.md, architecture.md(forecast)'],'需給最適化|コスト削減|入力:計測データ、気象予測|判断:ピーク需要>90%容量→調整、予測誤差>10%→改善|出力:最適化案、期待削減','Supply-Demand Optimization|Cost reduction|Input: metering data, weather forecast|Judgment: peak demand>90% capacity→adjust, forecast error>10%→improve|Output: optimization plan, expected reduction'),
media:_dpb(['企画→制作→配信→視聴','コンテンツ→エンコード→CDN→再生','視聴者→エンゲージ→サブスク→継続'],['Plan→Produce→Distribute→View','Content→Encode→CDN→Play','Viewer→Engage→Subscribe→Retain'],['著作権法:コンテンツ保護、DRM',_CG+':視聴履歴暗号化','放送法:適正配信、記録保持'],[' Copyright Act: content protection, DRM',_CG+': viewing history encryption','Broadcasting Act: proper distribution, record retention'],['DRM回避|保護不足'+_PVJ+'Widevine L1、定期更新','ストリーム途切れ|CDN障害'+_PVJ+'Multi-CDN、フェイルオーバー'],['DRM bypass|Insufficient protection'+_PVE+'Widevine L1, regular updates','Stream interruption|CDN failure'+_PVE+'Multi-CDN, failover'],['配信→architecture.md(streaming), security.md','視聴→stakeholders.md, architecture.md(analytics)'],['Distribution→architecture.md(streaming), security.md','Viewing→stakeholders.md, architecture.md(analytics)'],'視聴最適化|継続率向上|入力:視聴履歴、離脱率|判断:離脱>60%→コンテンツ改善、バッファ>5%→CDN最適化|出力:改善案、期待継続率','Viewing Optimization|Improve retention|Input: viewing history, churn rate|Judgment: churn>60%→improve content, buffering>5%→optimize CDN|Output: improvement plan, expected retention'),
government:_dpb(['申請→受付→審査→承認','市民→本人確認→申請→交付','データ→集計→分析→公開'],['Apply→Receive→Review→Approve','Citizen→Verify→Apply→Issue','Data→Aggregate→Analyze→Publish'],['個人情報保護法:厳格保護、監査','行政手続法:透明性、標準処理期間','公文書管理法:記録保持、開示'],[' Privacy Act: strict protection, audit','Administrative Procedure Act: transparency, standard processing time','Public Records Act: record retention, disclosure'],['個人情報漏洩|アクセス制御不足'+_PVJ+'RLS、監査ログ、定期監査','処理遅延|手動処理'+_PVJ+'ワークフロー自動化、進捗可視化'],['Personal data leakage|Insufficient access control'+_PVE+'RLS, audit log, periodic audit','Processing delay|Manual processing'+_PVE+'workflow automation, progress visibility'],['申請→architecture.md(application), security.md','承認→stakeholders.md, test_cases/'],['Application→architecture.md(application), security.md','Approval→stakeholders.md, test_cases/'],'処理効率化|待ち時間短縮|入力:処理履歴、待機時間|判断:待機>30日→優先処理、差戻し>30%→要件明確化|出力:改善案、期待処理時間','Processing Efficiency|Reduce waiting time|Input: processing history, wait time|Judgment: wait>30d→prioritize, rejection>30%→clarify requirements|Output: improvement plan, expected processing time'),
travel:_dpb(['検索→比較→予約→決済','旅程→ホテル→航空券→完了','レビュー→評価→次回→リピート'],['Search→Compare→Book→Pay','Itinerary→Hotel→Flight→Complete','Review→Rate→Next→Repeat'],['旅行業法:取引条件説明、記録保持',_CG+':予約情報暗号化','個人情報保護法:パスポート情報厳格保護'],[' Travel Business Act: terms explanation, record retention',_CG+': booking info encryption','Privacy Act: strict passport info protection'],['ダブルブッキング|在庫競合'+_PVJ+'SELECT FOR UPDATE、リアルタイム同期','キャンセル料誤算|計算ロジックミス'+_PVJ+'テストケース充実、手数料テーブル'],['Double booking|Inventory race'+_PVE+'SELECT FOR UPDATE, real-time sync','Cancellation fee error|Calculation logic miss'+_PVE+'rich test cases, fee table'],['予約→architecture.md(booking), security.md','決済→architecture.md(payment), api_spec.md'],['Booking→architecture.md(booking), security.md','Payment→architecture.md(payment), api_spec.md'],'予約最適化|稼働率向上|入力:予約履歴、空室率|判断:空室>40%→価格調整、キャンセル>20%→ペナルティ見直し|出力:最適化案、期待稼働率','Booking Optimization|Improve occupancy|Input: booking history, vacancy rate|Judgment: vacancy>40%→adjust pricing, cancel>20%→review penalty|Output: optimization plan, expected occupancy'),
insurance:_dpb(['見積→契約→請求→支払','査定→審査→承認→振込','更新→通知→継続→解約'],['Quote→Contract→Claim→Pay','Assessment→Review→Approve→Transfer','Renew→Notify→Continue→Cancel'],[_CG+':契約情報暗号化','保険業法:適正審査、記録保持','金融商品取引法:説明義務、書面交付'],[_CG+': contract info encryption','Insurance Act: proper review, record retention','Financial Instruments Act: disclosure obligation, document issuance'],['見積誤差|計算ミス'+_PVJ+'テストケース充実、監査','請求処理遅延|手動審査'+_PVJ+'AI審査、自動承認閾値'],['Quote error|Calculation miss'+_PVE+'rich test cases, audit','Claim delay|Manual review'+_PVE+'AI review, auto-approve threshold'],['見積→architecture.md(quote), api_spec.md','請求→stakeholders.md, architecture.md(claim)'],['Quote→architecture.md(quote), api_spec.md','Claim→stakeholders.md, architecture.md(claim)'],'請求最適化|処理時間短縮|入力:請求履歴、審査時間|判断:審査>14日→優先、不正疑い>5%→AI審査強化|出力:改善案、期待処理時間','Claim Optimization|Reduce processing time|Input: claim history, review time|Judgment: review>14d→prioritize, fraud suspect>5%→enhance AI review|Output: improvement plan, expected processing time')
};
// Growth Intelligence data
const _dg=(fj,fe,cvr,eq,lj,le,pj,pe)=>({fj,fe,cvr,eq,lj,le,pj,pe});
const DOMAIN_GROWTH={
ec:_dg(
['訪問','商品閲覧','カート追加','決済完了','リピート'],
['Visit','Browse','Add to Cart','Checkout','Repeat'],
[100,40,12,3,1.2],
'Revenue = Traffic × Browse_CVR × Cart_CVR × Checkout_CVR × AOV × Repeat',
['SEO/広告流入増','レコメンド精度','カート放棄防止','決済UX簡素化','ポイント/会員制度'],
['SEO/ad traffic','Recommendation accuracy','Cart abandon prevention','Checkout UX','Loyalty program'],
['単品:¥3,000-5,000','おすすめ:¥5,000-8,000','プレミアム:¥10,000+'],
['Basic:$30-50','Recommended:$50-80','Premium:$100+']
),
saas:_dg(
['LP訪問','サインアップ','Aha体験','有料転換','拡張/紹介'],
['LP Visit','Signup','Aha Moment','Paid Convert','Expand/Refer'],
[100,30,18,5.4,2.7],
'MRR = Signups × Activation × Paid_CVR × ARPU - Churn',
['LP CVR改善','オンボーディング最適化','フリーミアム導線','チャーン防止','紹介プログラム'],
['Optimize LP CVR','Improve onboarding','Free-to-paid path','Churn prevention','Referral program'],
['Free:¥0','Pro:¥980/月','Enterprise:¥9,800/月'],
['Free:$0','Pro:$10/mo','Enterprise:$100/mo']
),
education:_dg(
['認知','無料体験','受講開始','修了','上位コース'],
['Awareness','Free Trial','Enroll','Complete','Upsell'],
[100,25,10,6,2.4],
'Revenue = Students × Trial_CVR × Enroll_CVR × Price + Upsell',
['コンテンツSEO','体験レッスン品質','松竹梅価格','修了率(ゲーミフィケーション)','上位コース提案'],
['Content SEO','Trial quality','3-tier pricing','Completion rate (gamify)','Upsell suggestion'],
['入門:¥3,000','標準:¥9,800','プレミアム:¥29,800'],
['Intro:$30','Standard:$100','Premium:$300']
),
fintech:_dg(
['登録','KYC完了','初回取引','アクティブ利用','プレミアム転換'],
['Register','KYC Complete','First Txn','Active Use','Premium'],
[100,60,30,20,5],
'Revenue = Users × KYC_Rate × Active × Txn_Vol × Fee + Premium_MRR',
['広告/PR','KYC UX簡素化','初回ボーナス','定期利用促進','プレミアム訴求'],
['Ads/PR','Simplify KYC','First-time bonus','Regular use incentive','Premium pitch'],
['無料:基本取引','Pro:¥980/月','法人:¥29,800/月'],
['Free:basic','Pro:$10/mo','Business:$300/mo']
),
booking:_dg(
['検索','空き確認','予約','来店/利用','リピート'],
['Search','Availability','Book','Visit','Rebook'],
[100,60,20,17,7],
'Revenue = Searches × Book_CVR × Show_Rate × Price × Commission',
['SEO/口コミ','リアルタイム在庫','予約UX','リマインダー','リピート割引'],
['SEO/reviews','Real-time inventory','Booking UX','Reminders','Repeat discounts'],
['通常:¥3,000-5,000/回','人気:¥8,000/回','プレミアム:¥15,000/回'],
['Standard:$30-50','Popular:$80','Premium:$150']
),
community:_dg(
['訪問','登録','初投稿','アクティブ化','有料/寄付'],
['Visit','Register','First Post','Active','Paid/Donate'],
[100,20,8,3,0.6],
'Revenue = MAU × Active_Rate × Paid_CVR × ARPU + Ad_Revenue',
['口コミ/招待','ウェルカムガイド','投稿促進(バッジ)','文化醸成','プレミアム機能'],
['Word of mouth','Welcome guide','Post incentive (badges)','Culture building','Premium features'],
['無料:基本','Pro:¥500/月','サポーター:¥3,000/月'],
['Free:basic','Pro:$5/mo','Supporter:$30/mo']
),
marketplace:_dg(
['訪問','検索/閲覧','問合せ/入札','成約','リピート/評価'],
['Visit','Search','Inquiry/Bid','Deal','Repeat/Rate'],
[100,50,15,6,2.4],
'GMV = Listings × Bid_Rate × Close_Rate × Avg_Deal',
['出品者獲得','検索精度','マッチング最適化','エスクロー信頼性','評価制度'],
['Acquire sellers','Search accuracy','Matching optimization','Escrow trust','Rating system'],
['出品無料→成約手数料8%','プレミアム掲載:¥2,000/月','Featured:¥5,000/回'],
['Free list→8% commission','Premium:$20/mo','Featured:$50/time']
),
content:_dg(
['訪問','記事閲覧','購読登録','エンゲージ','課金'],
['Visit','Browse','Subscribe','Engage','Pay'],
[100,35,8,4,1.2],
'Revenue = PV × Subscribe_CVR × Engage_Rate × Paid_CVR × ARPU + Ad',
['SEO/SNS拡散','コンテンツ品質','メルマガ育成','コメント/共有促進','有料コンテンツ訴求'],
['SEO/SNS spread','Content quality','Newsletter nurture','Comment/share incentive','Paid content pitch'],
['無料:基本閲覧','購読:¥500/月','プレミアム:¥1,500/月'],
['Free:basic','Subscribe:$5/mo','Premium:$15/mo']
),
analytics:_dg(
['トライアル','データ接続','ダッシュボード利用','レポート共有','エンタープライズ'],
['Trial','Data Connect','Dashboard Use','Report Share','Enterprise'],
[100,60,35,15,4],
'ARR = Trials × Connect_CVR × Active × Share × Enterprise_Rate × ACV',
['無料枠拡大','データソース連携強化','テンプレート充実','チーム機能','カスタマイズ支援'],
['Expand free tier','Enhance data source connectors','Rich templates','Team features','Customization support'],
['Free:3ダッシュボード','Pro:¥9,800/月','Enterprise:¥98,000/月'],
['Free:3 dashboards','Pro:$100/mo','Enterprise:$1,000/mo']
),
iot:_dg(
['デバイス登録','データストリーム','アラート運用','分析利用','スケール'],
['Device Register','Data Stream','Alert Ops','Analytics','Scale'],
[100,70,50,30,8],
'Revenue = Devices × Stream_Rate × Alert_Engage × Analytics_Use × Scale_Rate × ARPU',
['デバイス配布促進','接続安定性','閾値調整UX','BIツール連携','大規模プラン'],
['Device distribution','Connection stability','Threshold tuning UX','BI integration','Enterprise plan'],
['無料:5デバイス','Standard:¥2,000/月(50台)','Enterprise:¥50,000/月(1000台+)'],
['Free:5 devices','Standard:$20/mo(50)','Enterprise:$500/mo(1000+)']
),
realestate:_dg(
['物件検索','詳細閲覧','問合せ','内見予約','契約'],
['Search','Detail View','Inquiry','Viewing','Contract'],
[100,25,8,3,1.2],
'Revenue = Listings × View_CVR × Inquiry_CVR × Viewing_CVR × Contract × Commission',
['SEO/ポータル連携','写真/VR品質','チャット対応','スケジュール調整','電子契約導入'],
['SEO/portal integration','Photo/VR quality','Chat support','Schedule coordination','E-contract'],
['掲載無料→成約手数料3%','プレミアム:¥5,000/月','VR撮影:¥30,000/回'],
['Free list→3% commission','Premium:$50/mo','VR photo:$300/time']
),
legal:_dg(
['問合せ','相談予約','案件契約','進行管理','継続/更新'],
['Inquiry','Consult','Contract','Case Mgmt','Renew'],
[100,40,20,18,8],
'Revenue = Inquiries × Consult_CVR × Contract_CVR × Avg_Fee + Retainer',
['SEO/専門性訴求','初回相談無料','料金透明性','進捗可視化','顧問契約提案'],
['SEO/expertise','Free first consult','Transparent pricing','Progress visibility','Retainer proposal'],
['相談:¥10,000/回','案件:¥300,000-500,000','顧問:¥100,000/月'],
['Consult:$100','Case:$3,000-5,000','Retainer:$1,000/mo']
),
hr:_dg(
['求人掲載','応募受付','書類選考','面接実施','採用決定'],
['Job Post','Application','Screening','Interview','Hire'],
[100,30,15,8,3],
'Hires = Postings × Apply_Rate × Screen_Pass × Interview_CVR × Offer_Accept',
['求人SEO','ATS連携','自動スクリーニング','面接スケジューラ','オファー管理'],
['Job SEO','ATS integration','Auto screening','Interview scheduler','Offer management'],
['無料:3求人/月','Standard:¥50,000/月','Enterprise:¥200,000/月'],
['Free:3 posts/mo','Standard:$500/mo','Enterprise:$2,000/mo']
),
health:_dg(
['登録','初回記録','習慣化(7日)','アクティブ継続','プレミアム'],
['Register','First Log','Habit(7d)','Active','Premium'],
[100,55,30,18,5],
'Revenue = Users × First_Log × Habit × Active × Premium_CVR × ARPU',
['広告/医療機関提携','入力簡素化','リマインダー/報酬','データ可視化','AI分析/コーチング'],
['Ads/clinic partnership','Simplify input','Reminder/reward','Data visualization','AI analysis/coaching'],
['Free:基本記録','Pro:¥980/月','家族:¥2,480/月'],
['Free:basic log','Pro:$10/mo','Family:$25/mo']
),
portfolio:_dg(
['サイト訪問','作品閲覧','問合せフォーム','ミーティング','契約'],
['Visit','Work View','Inquiry','Meeting','Contract'],
[100,50,8,4,1.6],
'Revenue = Visitors × View_Engage × Inquiry_CVR × Meeting × Contract_CVR × Project_Fee',
['SEO/SNS発信','作品質/量','CTA最適化','オンライン面談','見積自動化'],
['SEO/SNS','Portfolio quality/quantity','Optimize CTA','Online meeting','Auto quote'],
['無料:基本サイト','Pro:¥980/月(独自ドメイン)','ビジネス:¥2,980/月(分析)'],
['Free:basic','Pro:$10/mo(custom domain)','Business:$30/mo(analytics)']
),
tool:_dg(
['発見','インストール/登録','初回利用','日常利用','有料化'],
['Discovery','Install/Register','First Use','Daily Use','Monetize'],
[100,40,25,12,3],
'Revenue = Installs × First_Use × Daily_Use × Paid_CVR × ARPU',
['App Store最適化','オンボーディング','リマインダー','習慣形成','プレミアム訴求'],
['App Store optimization','Onboarding','Reminders','Habit formation','Premium pitch'],
['Free:基本機能','Pro:¥500/月','ライフタイム:¥4,980'],
['Free:basic','Pro:$5/mo','Lifetime:$50']
),
ai:_dg(
['サインアップ','初回プロンプト','アクティブ利用','習慣化','Pro升級'],
['Signup','First Prompt','Active Use','Habit','Pro Upgrade'],
[100,70,45,25,8],
'Revenue = Signups × First_Prompt × Active × Habit × Pro_CVR × ARPU',
['無料枠拡大','プロンプトテンプレート','品質向上','使い放題訴求','API提供'],
['Expand free tier','Prompt templates','Quality improvement','Unlimited pitch','API access'],
['Free:20回/月','Pro:¥2,000/月(無制限)','Enterprise:¥20,000/月(API)'],
['Free:20/mo','Pro:$20/mo(unlimited)','Enterprise:$200/mo(API)']
),
automation:_dg(
['トライアル','初ワークフロー作成','自動化運用','複数フロー拡大','エンタープライズ'],
['Trial','First Workflow','Automation Ops','Multi-Flow','Enterprise'],
[100,50,30,15,5],
'ARR = Trials × First_Flow × Ops × Multi × Enterprise_CVR × ACV',
['テンプレート充実','ノーコードUI','インテグレーション拡大','エラーハンドリング','SLA保証'],
['Rich templates','No-code UI','Expand integrations','Error handling','SLA guarantee'],
['Free:3フロー','Pro:¥5,000/月(無制限)','Enterprise:¥50,000/月(専用サポート)'],
['Free:3 flows','Pro:$50/mo(unlimited)','Enterprise:$500/mo(dedicated support)']
),
event:_dg(
['イベント発見','詳細閲覧','チケット購入','イベント参加','リピート参加'],
['Discover','View Details','Buy Ticket','Attend','Repeat'],
[100,40,12,10,4],
'Revenue = Events × View × Purchase × Attend × Repeat × Ticket_Price × Commission',
['SEO/SNS拡散','イベント詳細充実','決済UX簡素化','リマインダー','フォローアップ'],
['SEO/SNS spread','Rich event details','Simple checkout','Reminders','Follow-up'],
['掲載無料→チケット手数料10%','有料掲載:¥5,000/月','スポンサー枠:¥50,000'],
['Free list→10% ticket fee','Paid list:$50/mo','Sponsor:$500']
),
gamify:_dg(
['ユーザー登録','初アチーブメント','デイリーアクティブ','ランキング参加','課金'],
['Register','First Achievement','Daily Active','Ranking','Pay'],
[100,70,40,20,5],
'Revenue = Users × First_Achieve × DAU × Ranking × Pay_CVR × ARPPU',
['チュートリアル充実','早期報酬','デイリーミッション','競争要素','限定アイテム'],
['Rich tutorial','Early reward','Daily mission','Competition','Limited items'],
['無料:基本プレイ','月額:¥980','アイテム:¥120-¥10,000'],
['Free:basic','Monthly:$10','Items:$1-$100']
),
collab:_dg(
['招待/登録','初回編集','日常コラボ','チーム拡大','エンタープライズ'],
['Invite/Register','First Edit','Daily Collab','Team Expand','Enterprise'],
[100,60,40,20,6],
'ARR = Invites × First_Edit × Daily × Team_Expand × Enterprise_CVR × ACV',
['招待インセンティブ','リアルタイム同期品質','通知最適化','ロール/権限管理','SSO/監査ログ'],
['Invite incentive','Real-time sync quality','Optimize notifications','Role/permission','SSO/audit log'],
['Free:3人','Team:¥1,500/月(10人)','Enterprise:¥15,000/月(無制限)'],
['Free:3users','Team:$15/mo(10)','Enterprise:$150/mo(unlimited)']
),
devtool:_dg(
['発見','APIキー発行','初回コール','統合完了','有料化'],
['Discovery','API Key','First Call','Integration','Monetize'],
[100,50,35,20,6],
'Revenue = Signups × Key_Issue × First_Call × Integration × Paid_CVR × ARPU',
['ドキュメント充実','Playground提供','SDK/ライブラリ','Rate limit最適化','エンタープライズサポート'],
['Rich docs','Playground','SDK/library','Optimize rate limit','Enterprise support'],
['Free:1,000リクエスト/月','Pro:¥5,000/月(10万)','Enterprise:¥50,000/月(無制限)'],
['Free:1,000/mo','Pro:$50/mo(100k)','Enterprise:$500/mo(unlimited)']
),
creator:_dg(
['フォロー','無料コンテンツ閲覧','購読登録','投げ銭/購入','スーパーファン'],
['Follow','Free Content','Subscribe','Tip/Buy','Super Fan'],
[100,60,15,6,1.5],
'Revenue = Followers × Free_View × Subscribe_CVR × Tip_Rate × Super_Fan × ARPPU',
['SNS連携','無料コンテンツ品質','購読特典充実','投げ銭導線','限定コンテンツ'],
['SNS integration','Free content quality','Rich subscriber perks','Tip flow','Exclusive content'],
['無料:基本閲覧','購読:¥500-2,000/月','投げ銭:¥100-10,000'],
['Free:basic','Subscribe:$5-20/mo','Tip:$1-100']
),
newsletter:_dg(
['ランディング','購読登録','メール開封','リンククリック','有料転換/紹介'],
['Landing','Subscribe','Email Open','Click','Paid/Refer'],
[100,25,15,6,1.5],
'Revenue = Visits × Subscribe × Open × Click × Paid_CVR × ARPU',
['LP最適化','ダブルオプトイン','件名A/Bテスト','CTAクリア化','有料版訴求'],
['Optimize LP','Double opt-in','Subject A/B test','Clear CTA','Paid pitch'],
['無料:月4通','Pro:¥980/月(週刊)','スポンサー枠:¥50,000'],
['Free:4/mo','Pro:$10/mo(weekly)','Sponsor slot:$500']
),
manufacturing:_dg(
['需要予測','生産開始','品質検査','出荷完了','リピート発注'],
['Forecast','Start Production','Quality Check','Ship','Reorder'],
[100,85,75,70,35],
'Revenue = Orders × Production × Quality_Pass × Ship × Reorder × Unit_Price',
['需要予測AI','生産効率化','全数検査','納期厳守','品質実績'],
['Forecast AI','Production efficiency','100% inspection','On-time delivery','Quality track record'],
['標準:¥500/個','量産:¥300/個','カスタム:¥1,000/個'],
['Standard:$5/unit','Mass:$3/unit','Custom:$10/unit']
),
logistics:_dg(
['発注','引当','出荷','配送','完了'],
['Order','Allocate','Ship','Deliver','Complete'],
[100,90,85,80,75],
'Revenue = Orders × Allocation × Ship × Delivery × Complete × Delivery_Fee',
['リアルタイム在庫','AI配送最適化','追跡通知','不在対策','再配達削減'],
['Real-time inventory','AI route optimization','Tracking alerts','Absence handling','Redelivery reduction'],
['通常:¥500/個','速達:¥800/個','当日:¥1,500/個'],
['Standard:$5','Express:$8','Same-day:$15']
),
agriculture:_dg(
['播種','育成','モニタリング','収穫','出荷'],
['Sow','Grow','Monitor','Harvest','Ship'],
[100,90,85,75,60],
'Revenue = Plots × Grow × Monitor × Harvest × Ship × Price_per_kg',
['適期播種','IoTモニタリング','病害早期検知','収穫タイミング最適化','品質選別'],
['Optimal sowing','IoT monitoring','Early pest detection','Harvest timing optimization','Quality sorting'],
['A級:¥300/kg','B級:¥150/kg','加工用:¥50/kg'],
['Grade-A:$3/kg','Grade-B:$1.5/kg','Processing:$0.5/kg']
),
energy:_dg(
['契約','メーター設置','定期計測','請求','継続'],
['Contract','Meter Install','Measure','Bill','Renew'],
[100,95,90,88,80],
'Revenue = Contracts × Install × Measure × Bill × Renew × Unit_Price',
['プラン提案','スマートメーター','AI需給予測','自動請求','省エネ提案'],
['Plan proposals','Smart meters','AI forecast','Auto-billing','Energy-saving tips'],
['基本:¥20/kWh','ピーク:¥30/kWh','夜間:¥10/kWh'],
['Basic:$0.20/kWh','Peak:$0.30/kWh','Night:$0.10/kWh']
),
media:_dg(
['発見','視聴開始','習慣視聴','サブスク登録','継続'],
['Discover','Start Watching','Habit','Subscribe','Retain'],
[100,60,35,10,7],
'Revenue = Visitors × Start × Habit × Subscribe × Retain × ARPU + Ad_Revenue',
['SEO/SNS拡散','レコメンド精度','オリジナルコンテンツ','プレミアム訴求','継続特典'],
['SEO/SNS spread','Recommendation accuracy','Original content','Premium pitch','Retention perks'],
['無料:広告付き','ベーシック:¥980/月','プレミアム:¥1,980/月'],
['Free:with ads','Basic:$10/mo','Premium:$20/mo']
),
government:_dg(
['認知','アカウント登録','初回申請','定期利用','推奨'],
['Awareness','Register','First Application','Regular Use','Recommend'],
[100,45,30,15,8],
'Usage = Citizens × Register × First_App × Regular × Satisfaction',
['広報強化','オンライン化促進','UI簡素化','窓口サポート','利便性向上'],
['PR enhancement','Online promotion','UI simplification','Counter support','Convenience improvement'],
['基本:無料','証明書発行:¥300','速達:¥500'],
['Basic:free','Certificate:$3','Express:$5']
),
travel:_dg(
['検索','比較','予約','旅行完了','リピート'],
['Search','Compare','Book','Travel','Repeat'],
[100,50,15,12,4],
'Revenue = Searches × Compare × Book × Travel × Repeat × Avg_Booking × Commission',
['比較機能充実','価格保証','レビュー表示','サポート24h','リピート特典'],
['Rich comparison','Price guarantee','Review display','24h support','Repeat perks'],
['手数料:8%','プレミアム会員:¥5,000/年','保険:¥2,000/旅行'],
['Commission:8%','Premium membership:$50/yr','Insurance:$20/trip']
),
insurance:_dg(
['見積取得','比較検討','契約','請求利用','継続'],
['Get Quote','Compare','Contract','Claim','Renew'],
[100,60,25,15,12],
'Revenue = Quotes × Compare × Contract × Premium × Renew',
['見積簡素化','プラン比較ツール','オンライン契約','請求サポート','継続割引'],
['Simplified quotes','Plan comparison tool','Online contract','Claims support','Renewal discount'],
['基本:¥3,000/月','充実:¥5,000/月','プレミアム:¥10,000/月'],
['Basic:$30/mo','Enhanced:$50/mo','Premium:$100/mo']
),
_default:_dg(
['認知','登録','利用開始','習慣化','課金/推薦'],
['Awareness','Register','First Use','Habit','Pay/Refer'],
[100,25,12,5,2],
'Revenue = Users × Activation × Retention × ARPU',
['認知拡大(SEO/SNS)','登録フロー簡素化','Aha体験短縮','通知/メール','価格最適化'],
['Awareness (SEO/SNS)','Simplify registration','Shorten Aha moment','Push/email','Optimize pricing'],
['Free:基本','Standard:¥980/月','Premium:¥4,980/月'],
['Free:basic','Standard:$10/mo','Premium:$50/mo']
)
};
// ── Domain Ops Intelligence (SLO, Feature Flags, Jobs, Backup, Hardening) ──
const _dop=(slo,fj,fe,jj,je,bj,be,hj,he)=>({slo,flags_ja:fj,flags_en:fe,jobs_ja:jj,jobs_en:je,backup_ja:bj,backup_en:be,hardening_ja:hj,hardening_en:he});
const DOMAIN_OPS={
fintech:_dop('99.99%',
['取引停止キルスイッチ','送金上限フラグ','メンテナンスモード'],
['Transaction kill switch','Transfer limit flag','Maintenance mode'],
['日次残高照合バッチ','不正検知スコアリング','利息計算ジョブ'],
['Daily balance reconciliation','Fraud detection scoring','Interest calculation job'],
['WAL+S3 (RPO:1min,RTO:15min)','PITR必須、トランザクションログ保持7年'],
['WAL+S3 (RPO:1min,RTO:15min)','PITR required, txn logs 7yr retention'],
['冪等性キー必須','監査ログHMAC署名','SELECT FOR UPDATE必須','金額はDecimal型'],
['Idempotency key required','Audit log HMAC signature','SELECT FOR UPDATE mandatory','Amount as Decimal type']),
health:_dop('99.99%',
['診断機能停止スイッチ','処方箋発行制限','緊急メンテナンス'],
['Diagnostic feature kill switch','Prescription issuance limit','Emergency maintenance'],
['健康データ匿名化バッチ','リマインダー通知ジョブ','バイタルデータ集計'],
['Health data anonymization batch','Reminder notification job','Vital data aggregation'],
['暗号化バックアップ (RPO:5min,RTO:30min)','HIPAA準拠ストレージ、90日保持'],
['Encrypted backup (RPO:5min,RTO:30min)','HIPAA-compliant storage, 90d retention'],
['PHI暗号化必須(AES-256)','アクセスログ全件記録','禁忌チェック必須','BAA契約必須'],
['PHI encryption required (AES-256)','All access logged','Contraindication check mandatory','BAA contract required']),
education:_dop('99.9%',
['学習コンテンツ配信停止','試験モード切替','新規登録制限'],
['Content delivery pause','Exam mode toggle','Registration limit'],
['進捗データ日次集計','証明書発行ジョブ','学習リマインダー'],
['Daily progress aggregation','Certificate issuance job','Learning reminders'],
['差分バックアップ日次 (RPO:1day,RTO:4h)','成績データ5年保持(FERPA)'],
['Daily differential backup (RPO:1day,RTO:4h)','Grade data 5yr retention (FERPA)'],
['進捗データIndexedDB保存','カンニング検知ログ','保護者同意記録','タイムアウト自動保存'],
['Progress to IndexedDB','Cheating detection logs','Parental consent records','Auto-save on timeout']),
ec:_dop('99.95%',
['決済機能停止','在庫同期停止','カート機能制限'],
['Payment feature disable','Inventory sync pause','Cart feature limit'],
['在庫同期ジョブ(5分毎)','カゴ落ちメール送信','売上集計バッチ'],
['Inventory sync job (every 5min)','Abandoned cart email','Sales aggregation batch'],
['時系列バックアップ毎時 (RPO:1h,RTO:2h)','トランザクションログ3年保持'],
['Hourly time-series backup (RPO:1h,RTO:2h)','Transaction logs 3yr retention'],
['在庫SELECT FOR UPDATE','決済冪等性キー','価格整数演算','二重決済防止ボタン無効化'],
['Inventory SELECT FOR UPDATE','Payment idempotency key','Price integer math','Double charge prevention button disable']),
saas:_dop('99.9%',
['新規サインアップ制限','特定機能無効化','テナント分離強制モード'],
['Signup limit','Feature disable toggle','Tenant isolation enforce mode'],
['使用量集計ジョブ(1時間毎)','解約予測スコアリング','通知配信キュー'],
['Usage aggregation job (hourly)','Churn prediction scoring','Notification delivery queue'],
['増分バックアップ日次 (RPO:1day,RTO:4h)','テナントデータ隔離、30日削除猶予'],
['Daily incremental backup (RPO:1day,RTO:4h)','Tenant data isolation, 30d delete grace'],
['RLS必須(tenant_id)','Rate limit (100req/min)','オンボーディングツアー必須','API認証全エンドポイント'],
['RLS mandatory (tenant_id)','Rate limit (100req/min)','Onboarding tour required','API auth on all endpoints']),
booking:_dop('99.9%',
['予約受付停止','空き枠更新停止','価格変更制限'],
['Booking intake pause','Availability update pause','Price change limit'],
['空き枠同期ジョブ(5分毎)','リマインダー送信(予約24h前)','キャンセル待ち通知'],
['Availability sync job (every 5min)','Reminder send (24h before)','Waitlist notification'],
['スナップショット毎時 (RPO:1h,RTO:2h)','予約履歴1年保持'],
['Hourly snapshot (RPO:1h,RTO:2h)','Booking history 1yr retention'],
['ダブルブッキング防止Lock','5分バッファ設定','SSE fallback実装','30分価格固定'],
['Double booking prevention lock','5min buffer','SSE fallback impl','30min price hold']),
community:_dop('99.5%',
['投稿機能制限','モデレーション強化モード','通報処理優先'],
['Post feature limit','Moderation strict mode','Report processing priority'],
['スパム検知バッチ(10分毎)','通報審査キュー','エンゲージメント集計'],
['Spam detection batch (every 10min)','Report review queue','Engagement aggregation'],
['日次バックアップ (RPO:1day,RTO:6h)','投稿データ圧縮保存'],
['Daily backup (RPO:1day,RTO:6h)','Post data compressed storage'],
['XSS防止(DOMPurify+CSP)','Rate limit 5post/min','reCAPTCHA v3','フィルターバブル20%多様性注入'],
['XSS prevention (DOMPurify+CSP)','Rate limit 5post/min','reCAPTCHA v3','Filter bubble 20% diversity inject']),
marketplace:_dop('99.5%',
['出品機能停止','取引エスクロー強制','評価投稿制限'],
['Listing feature pause','Escrow enforce','Review post limit'],
['マッチング最適化ジョブ','評価信頼性スコアリング','エスクロー解放バッチ'],
['Matching optimization job','Review trust scoring','Escrow release batch'],
['日次バックアップ (RPO:1day,RTO:4h)','取引履歴5年保持'],
['Daily backup (RPO:1day,RTO:4h)','Transaction history 5yr retention'],
['エスクロー48h保護','偽装評価検知(IPクラスタ)','手数料事前見積','販売者開示必須'],
['Escrow 48h protection','Fake review detection (IP cluster)','Fee pre-estimate','Seller disclosure required']),
content:_dop('99.5%',
['記事公開停止','CDN配信制限','画像アップロード制限'],
['Article publish pause','CDN delivery limit','Image upload limit'],
['画像最適化バッチ','SEOサイトマップ生成','アクセス集計ジョブ'],
['Image optimization batch','SEO sitemap generation','Access aggregation job'],
['週次バックアップ (RPO:1week,RTO:12h)','記事3年保持'],
['Weekly backup (RPO:1week,RTO:12h)','Articles 3yr retention'],
['WebP自動変換','srcset生成','Lighthouse監視','構造化データJSON-LD'],
['Auto WebP conversion','srcset generation','Lighthouse monitoring','Structured data JSON-LD']),
analytics:_dop('99.5%',
['ダッシュボード更新停止','リアルタイム集計制限','アラート送信制限'],
['Dashboard update pause','Realtime aggregation limit','Alert send limit'],
['事前集計バッチ(15分毎)','異常検知ジョブ','レポート生成キュー'],
['Pre-aggregation batch (every 15min)','Anomaly detection job','Report generation queue'],
['週次バックアップ (RPO:1week,RTO:8h)','ログ3ヶ月、集計1年保持'],
['Weekly backup (RPO:1week,RTO:8h)','Logs 3mo, aggregated 1yr retention'],
['Materialized view使用','Redis 5分キャッシュ','最低1000件サンプリング','3σ異常検知'],
['Use materialized views','Redis 5min cache','Minimum 1000 sample','3σ anomaly detection']),
iot:_dop('99.5%',
['デバイス登録停止','データ収集制限','ファームウェア配信停止'],
['Device registration pause','Data collection limit','Firmware distribution pause'],
['センサーデータ集計(1分毎)','異常値アラートジョブ','バッテリー状態監視'],
['Sensor data aggregation (every 1min)','Anomaly alert job','Battery status monitoring'],
['時系列DB (RPO:5min,RTO:30min)','センサーデータ3ヶ月保持'],
['Time-series DB (RPO:5min,RTO:30min)','Sensor data 3mo retention'],
['オフライン動作対応','指数バックオフ再送','A/Bパーティション','チェックサム検証'],
['Offline operation support','Exponential backoff retry','A/B partition','Checksum verification']),
realestate:_dop('99.5%',
['物件登録停止','内見予約制限','契約署名停止'],
['Property registration pause','Viewing limit','Contract signing pause'],
['物件情報同期(1時間毎)','内見リマインダー送信','契約期限通知'],
['Property sync (hourly)','Viewing reminder send','Contract deadline notification'],
['日次バックアップ (RPO:1day,RTO:6h)','契約データ7年保持'],
['Daily backup (RPO:1day,RTO:6h)','Contract data 7yr retention'],
['Google Maps API緯度経度検証','内見重複防止Lock','クーリングオフ8日記録','重要事項説明ログ'],
['Google Maps API lat/long validation','Viewing conflict lock','8d cooling-off record','Important matters log']),
legal:_dop('99.9%',
['契約生成停止','承認フロー強制','期限アラート制限'],
['Contract generation pause','Approval flow enforce','Deadline alert limit'],
['期限リマインダー(3段階)','バージョン履歴保存','監査ログ集計'],
['Deadline reminder (3-tier)','Version history save','Audit log aggregation'],
['暗号化バックアップ日次 (RPO:1day,RTO:4h)','契約10年保持'],
['Encrypted daily backup (RPO:1day,RTO:4h)','Contracts 10yr retention'],
['契約テンプレート変数チェックリスト','diff表示必須','ロック機能','電子署名タイムスタンプ'],
['Contract template variable checklist','Diff display required','Lock feature','E-signature timestamp']),
hr:_dop('99.5%',
['応募受付停止','評価記録制限','給与計算停止'],
['Application intake pause','Evaluation record limit','Payroll calculation pause'],
['勤怠集計バッチ(日次)','給与計算ジョブ(月次)','応募者リマインダー'],
['Attendance aggregation batch (daily)','Payroll calculation job (monthly)','Applicant reminder'],
['日次バックアップ (RPO:1day,RTO:6h)','勤怠3年、応募者1年保持'],
['Daily backup (RPO:1day,RTO:6h)','Attendance 3yr, applicants 1yr retention'],
['TZ統一(UTC)','深夜割増22-5時','360度評価','不適切質問禁止チェック'],
['Unify TZ (UTC)','Late-night premium 10PM-5AM','360 review','Inappropriate question check']),
portfolio:_dop('99%',
['問合せフォーム停止','画像アップロード制限','プロジェクト公開制限'],
['Contact form pause','Image upload limit','Project publish limit'],
['画像最適化バッチ','アクセス解析集計','SEOスコア計測'],
['Image optimization batch','Access analytics aggregation','SEO score measurement'],
['週次バックアップ (RPO:1week,RTO:24h)','作品データ3年保持'],
['Weekly backup (RPO:1week,RTO:24h)','Work data 3yr retention'],
['WebP+srcset','Lazy loading','OGP生成','Core Web Vitals監視(LCP≤2.5s)'],
['WebP+srcset','Lazy loading','OGP generation','Core Web Vitals monitoring (LCP≤2.5s)']),
tool:_dop('99%',
['エクスポート制限','自動化実行停止','API連携制限'],
['Export limit','Automation execution pause','API integration limit'],
['エクスポートキュー','自動化スケジューラー','設定同期バッチ'],
['Export queue','Automation scheduler','Settings sync batch'],
['週次バックアップ (RPO:1week,RTO:12h)','設定データ1年保持'],
['Weekly backup (RPO:1week,RTO:12h)','Settings data 1yr retention'],
['UTF-8 BOM対応','CSV区切り文字検証','ショートカット競合回避','Polyfill使用'],
['UTF-8 BOM support','CSV delimiter validation','Shortcut conflict avoidance','Use polyfills']),
ai:_dop('99%',
['プロンプト送信制限','生成停止','トークン上限強制'],
['Prompt send limit','Generation pause','Token limit enforce'],
['トークン集計ジョブ','コスト最適化分析','キャッシュ整理'],
['Token aggregation job','Cost optimization analysis','Cache cleanup'],
['週次バックアップ (RPO:1week,RTO:12h)','プロンプト履歴暗号化保存90日'],
['Weekly backup (RPO:1week,RTO:12h)','Prompt history encrypted 90d retention'],
['プロンプト暗号化','トークン>1000要約','重複キャッシュ','アクセス制御'],
['Prompt encryption','Token>1000 summarize','Duplicate cache','Access control']),
automation:_dop('99%',
['ワークフロー実行停止','トリガー無効化','通知送信制限'],
['Workflow execution pause','Trigger disable','Notification send limit'],
['ワークフロー実行ログ','リトライキュー','実行時間最適化分析'],
['Workflow execution logs','Retry queue','Execution time optimization analysis'],
['週次バックアップ (RPO:1week,RTO:12h)','実行履歴3ヶ月保持'],
['Weekly backup (RPO:1week,RTO:12h)','Execution history 3mo retention'],
['最大実行回数制限','指数バックオフ','タイムアウト設定','無限ループ防止'],
['Max execution limit','Exponential backoff','Timeout config','Infinite loop prevention']),
event:_dop('99.5%',
['チケット販売停止','QR検証制限','キャンセル処理停止'],
['Ticket sales pause','QR verification limit','Cancel processing pause'],
['在庫同期ジョブ(5分毎)','リマインダー送信(開催1日前)','入場QR生成'],
['Inventory sync job (every 5min)','Reminder send (1d before)','Entry QR generation'],
['時系列バックアップ (RPO:1h,RTO:2h)','チケット履歴5年保持'],
['Time-series backup (RPO:1h,RTO:2h)','Ticket history 5yr retention'],
['定員超過防止Lock','UUID QR生成','QR検証チェック','返金規定明記'],
['Oversell prevention lock','UUID QR generation','QR verification check','Refund policy explicit']),
gamify:_dop('99%',
['ポイント付与停止','ランキング更新制限','バッジ獲得停止'],
['Point grant pause','Leaderboard update limit','Badge unlock pause'],
['ポイント集計ジョブ','ランキング更新バッチ','不正行動検知'],
['Point aggregation job','Leaderboard update batch','Fraud behavior detection'],
['日次バックアップ (RPO:1day,RTO:6h)','ポイント履歴1年保持'],
['Daily backup (RPO:1day,RTO:6h)','Point history 1yr retention'],
['ポイントトランザクション','重複付与防止','異常行動検知','ランキング精度100%'],
['Point transaction','Duplicate grant prevention','Anomaly behavior detection','Leaderboard accuracy 100%']),
collab:_dop('99.5%',
['編集機能制限','リアルタイム同期停止','共有制限'],
['Edit feature limit','Realtime sync pause','Share limit'],
['競合解決ジョブ','定期保存(30秒毎)','バージョン履歴保存'],
['Conflict resolution job','Periodic save (every 30s)','Version history save'],
['日次バックアップ (RPO:1day,RTO:4h)','編集履歴30日保持'],
['Daily backup (RPO:1day,RTO:4h)','Edit history 30d retention'],
['OT/CRDT実装','定期保存30秒','RLS権限検証','アクセスログ記録'],
['OT/CRDT implementation','Periodic save 30s','RLS permission verification','Access log recording']),
devtool:_dop('99.5%',
['APIキー発行停止','レート制限強化','リクエスト制限'],
['API key issuance pause','Rate limit strict','Request limit'],
['使用量集計ジョブ','エラー率監視','キーローテーション'],
['Usage aggregation job','Error rate monitoring','Key rotation'],
['日次バックアップ (RPO:1day,RTO:6h)','リクエストログ90日保持'],
['Daily backup (RPO:1day,RTO:6h)','Request logs 90d retention'],
['APIキー暗号化','定期ローテーション','IP制限','Redis sliding window'],
['API key encryption','Regular rotation','IP restriction','Redis sliding window']),
creator:_dop('99.5%',
['課金処理停止','投げ銭制限','サブスク新規停止'],
['Billing process pause','Tip limit','Subscription signup pause'],
['課金処理ジョブ','Webhook検証','解約処理バッチ'],
['Billing process job','Webhook verification','Cancellation batch'],
['日次バックアップ (RPO:1day,RTO:4h)','課金履歴7年保持'],
['Daily backup (RPO:1day,RTO:4h)','Billing history 7yr retention'],
['Webhook検証必須','解約後課金防止','定期確認','決済リトライ'],
['Webhook verification required','Prevent charge after cancel','Periodic check','Payment retry']),
newsletter:_dop('99%',
['配信停止','購読登録制限','解除処理制限'],
['Delivery pause','Subscription limit','Unsubscribe processing limit'],
['配信キュー','開封率集計','クリック率分析'],
['Delivery queue','Open rate aggregation','Click rate analysis'],
['週次バックアップ (RPO:1week,RTO:12h)','購読者データ3年保持'],
['Weekly backup (RPO:1week,RTO:12h)','Subscriber data 3yr retention'],
['SPF/DKIM設定','解除即時反映','定期同期','レピュテーション管理'],
['SPF/DKIM setup','Immediate unsubscribe reflect','Periodic sync','Reputation management']),
manufacturing:_dop('99.9%',
['生産ライン停止','品質検査強化モード','出荷制限'],
['Production line stop','Enhanced quality inspection mode','Shipping limit'],
['生産計画最適化バッチ','在庫差異調整ジョブ','設備保全スケジューラ'],
['Production plan optimization batch','Inventory variance adjustment job','Equipment maintenance scheduler'],
['日次バックアップ+WAL (RPO:1h,RTO:4h)','生産データ5年保持(製造物責任法)'],
['Daily backup+WAL (RPO:1h,RTO:4h)','Production data 5yr retention (Product Liability Act)'],
['全数検査記録','トレーサビリティ確保','冪等性キー(在庫操作)','ロット番号必須'],
['100% inspection record','Ensure traceability','Idempotency key (inventory ops)','Lot number required']),
logistics:_dop('99.9%',
['配送受付停止','緊急配送優先モード','ルート変更制限'],
['Delivery acceptance stop','Emergency delivery priority mode','Route change limit'],
['配送ルート最適化バッチ','追跡情報同期ジョブ','配送完了通知キュー'],
['Delivery route optimization batch','Tracking info sync job','Delivery completion notification queue'],
['日次バックアップ (RPO:4h,RTO:8h)','配送履歴3年保持'],
['Daily backup (RPO:4h,RTO:8h)','Delivery history 3yr retention'],
['GPS精度検証','在庫ロック必須','配送状態追跡','温度ログ(冷蔵品)'],
['GPS accuracy verification','Inventory lock required','Delivery status tracking','Temperature log (refrigerated)']),
agriculture:_dop('99%',
['灌漑システム停止','収穫作業制限','センサー校正モード'],
['Irrigation system stop','Harvest operation limit','Sensor calibration mode'],
['気象データ同期','収穫予測バッチ','病害検知ジョブ'],
['Weather data sync','Harvest prediction batch','Pest detection job'],
['週次バックアップ (RPO:1day,RTO:24h)','生育データ3年保持'],
['Weekly backup (RPO:1day,RTO:24h)','Growth data 3yr retention'],
['センサー冗長化','異常値アラート','定期校正','トレーサビリティ記録'],
['Sensor redundancy','Anomaly alert','Periodic calibration','Traceability record']),
energy:_dop('99.99%',
['計測停止(緊急時)','料金計算制限','需給調整モード'],
['Metering stop (emergency)','Billing calculation limit','Supply-demand adjustment mode'],
['メーター読取バッチ','需給予測ジョブ','請求計算バッチ'],
['Meter reading batch','Supply-demand forecast job','Billing calculation batch'],
['リアルタイムレプリケーション (RPO:1min,RTO:15min)','計測データ10年保持(電気事業法)'],
['Real-time replication (RPO:1min,RTO:15min)','Metering data 10yr retention (Electricity Act)'],
['計測精度±2%以内','冪等性キー必須','監査ログ全件','スマートメーター暗号化'],
['Metering accuracy ±2%','Idempotency key required','All audit logs','Smart meter encryption']),
media:_dop('99.95%',
['ストリーミング配信停止','コンテンツアップロード制限','DRM強化モード'],
['Streaming distribution stop','Content upload limit','Enhanced DRM mode'],
['エンコーディングキュー','視聴履歴集計','レコメンド更新バッチ'],
['Encoding queue','Viewing history aggregation','Recommendation update batch'],
['日次バックアップ+CDN (RPO:12h,RTO:4h)','視聴履歴3年保持'],
['Daily backup+CDN (RPO:12h,RTO:4h)','Viewing history 3yr retention'],
['DRM保護必須','Multi-CDN構成','バッファリング<3%','著作権透かし埋込'],
['DRM protection required','Multi-CDN config','Buffering<3%','Copyright watermark embedding']),
government:_dop('99.95%',
['申請受付停止','緊急メンテナンス','審査プロセス制限'],
['Application acceptance stop','Emergency maintenance','Review process limit'],
['申請データ集計','承認通知キュー','統計データ生成'],
['Application data aggregation','Approval notification queue','Statistical data generation'],
['日次バックアップ+監査ログ (RPO:1h,RTO:2h)','申請データ永久保持(公文書管理法)'],
['Daily backup+audit log (RPO:1h,RTO:2h)','Application data permanent retention (Public Records Act)'],
['個人情報暗号化必須','全操作監査ログ','RLS厳格適用','WCAG 2.1 AA準拠'],
['Personal info encryption required','All operations audit logged','Strict RLS application','WCAG 2.1 AA compliance']),
travel:_dop('99.9%',
['予約受付停止','キャンセル処理制限','決済機能停止'],
['Booking acceptance stop','Cancellation processing limit','Payment feature stop'],
['在庫同期バッチ','予約確認通知','キャンセル料計算ジョブ'],
['Inventory sync batch','Booking confirmation notification','Cancellation fee calculation job'],
['日次バックアップ (RPO:4h,RTO:8h)','予約履歴5年保持(旅行業法)'],
['Daily backup (RPO:4h,RTO:8h)','Booking history 5yr retention (Travel Business Act)'],
['冪等性キー必須','在庫ロック','ダブルブッキング検証','キャンセルポリシー明記'],
['Idempotency key required','Inventory lock','Double booking verification','Clear cancellation policy']),
insurance:_dop('99.99%',
['見積発行停止','請求受付制限','支払処理制限'],
['Quote issuance stop','Claim acceptance limit','Payment processing limit'],
['保険料計算バッチ','請求審査ジョブ','契約更新通知'],
['Premium calculation batch','Claim review job','Contract renewal notification'],
['リアルタイムレプリケーション (RPO:1min,RTO:15min)','契約データ永久保持(保険業法)'],
['Real-time replication (RPO:1min,RTO:15min)','Contract data permanent retention (Insurance Act)'],
['全取引監査ログ','見積計算検証','請求データ暗号化','不正検知AI'],
['All transaction audit logs','Quote calculation verification','Claim data encryption','Fraud detection AI']),
_default:_dop('99%',
['メンテナンスモード','機能制限','新規登録停止'],
['Maintenance mode','Feature limit','Signup pause'],
['日次集計バッチ','通知送信キュー','データクリーンアップ'],
['Daily aggregation batch','Notification send queue','Data cleanup'],
['日次バックアップ (RPO:1day,RTO:12h)','ユーザーデータ1年保持'],
['Daily backup (RPO:1day,RTO:12h)','User data 1yr retention'],
['JWT検証全ルート','Rate limit適用','ページネーション(limit 20)','INDEX設定'],
['JWT validation all routes','Apply rate limit','Pagination (limit 20)','INDEX setup'])
};
// Get domain-specific QA strategy
function getDomainQA(domain,G){
const qa=DOMAIN_QA_MAP[domain];
if(!qa)return null;
const cross=Object.values(QA_CROSS_CUTTING).filter(c=>c.domains.includes(domain));
return {focus:G?qa.focus_ja:qa.focus_en,bugs:G?qa.bugs_ja:qa.bugs_en,priority:qa.priority,crossCutting:cross.map(c=>G?c.ja:c.en)};
}
/// ── B9: URL/Routing Table Generation ──
function genRoutes(a){
const G=S.genLang==='ja';
const routes=[
{path:'/',name:G?'ランディング':'Landing',auth:false},
{path:'/login',name:G?'ログイン':'Login',auth:false},
{path:'/register',name:G?'新規登録':'Register',auth:false},
];
// Screen name → URL mapping (Japanese & English)
const MAP=[
[/ランディング|landing|LP|トップ|top|ホーム|home/i,'/',false],
[/ログイン|login|サインイン|signin/i,'/login',false],
[/新規登録|register|signup|サインアップ/i,'/register',false],
[/ダッシュボード|dashboard/i,'/dashboard',true],
[/設定|setting/i,'/settings',true],
[/プロフィール|profile|マイページ/i,'/profile',true],
[/管理|admin/i,'/admin',true],
[/検索|search/i,'/search',false],
[/通知|notification/i,'/notifications',true],
[/メッセージ|message|チャット|chat/i,'/messages',true],
[/一覧|list|リスト/i,'/list',true],
[/詳細|detail/i,'/[id]',true],
[/作成|create|新規作成/i,'/create',true],
[/編集|edit/i,'/[id]/edit',true],
[/課金|billing|サブスク|subscription|料金|pricing/i,'/pricing',false],
[/お問い合わせ|contact/i,'/contact',false],
[/利用規約|terms/i,'/terms',false],
[/about|概要/i,'/about',false],
];
const screens=(a.screens||'').split(', ').filter(Boolean);
screens.forEach(s=>{
const raw=s.replace(/\(P[0-2]\)/gi,'').trim();
const matched=MAP.find(([rx])=>rx.test(raw));
if(matched){routes.push({path:matched[1],name:raw,auth:matched[2]});}
else{
const slug=raw.replace(/[ぁ-んァ-ヶ一-龥々〇〻\u3400-\u9FFF\uF900-\uFAFF]/g,'')
.toLowerCase().replace(/[^a-z0-9]/g,'-').replace(/-+/g,'-').replace(/^-|-$/g,'');
routes.push({path:'/'+(slug||'page'),name:raw,auth:true});
}
});
const seen=new Set();
return routes.filter(r=>{if(seen.has(r.path))return false;seen.add(r.path);return true;});
}
// ── C: Post-Generation Audit ──
function postGenerationAudit(files,a){
const findings=[];
const G=S.genLang==='ja';
const constitution=files['.spec/constitution.md']||'';
const spec=files['.spec/specification.md']||'';
const techPlan=files['.spec/technical-plan.md']||'';
const tasks=files['.spec/tasks.md']||'';
const verify=files['.spec/verification.md']||'';
// C1: Auth SoT consistency
const auth=resolveAuth(a);
const authInConst=constitution.includes(auth.sot);
const authInSpec=spec.includes(auth.sot);
const authInTP=techPlan.includes(auth.sot);
if(!authInConst||!authInSpec||!authInTP){
findings.push({level:'error',msg:G?'認証SoTが全文書で一致していません':'Auth SoT inconsistent across documents'});
}
// C2: Architecture pattern consistency
const arch=resolveArch(a);
if(arch.pattern==='baas'&&techPlan.includes('API Gateway')){
findings.push({level:'error',msg:G?'BaaS構成なのにAPI Gatewayが記載されています':'API Gateway present in BaaS architecture'});
}
// C2b: API design docs mentioning API Gateway in BaaS project
if(arch.pattern==='baas'){
const apiDocContent=Object.keys(files).filter(k=>k.startsWith('docs/')&&/api/i.test(k)).map(k=>files[k]||'').join('\n');
if(apiDocContent.includes('API Gateway')){
findings.push({level:'warn',msg:G?'BaaS構成のAPIドキュメントにAPI Gatewayが記載されています':'API Gateway referenced in API docs for BaaS architecture'});
}
}
if(arch.pattern==='bff'&&techPlan.includes('api/')){
// Only warn if separate api/ directory exists (should use app/api/)
if(techPlan.includes('├── api/')){
findings.push({level:'warn',msg:G?'BFF構成では api/ ディレクトリは不要です（app/api/ を使用）':'BFF pattern should not have separate api/ directory (use app/api/)'});
}
}
// C3: Scope vs features conflict (answers-level check)
const scopeOut=(a.scope_out||'').toLowerCase();
const mobileAns=(a.mobile||'').toLowerCase();
if((scopeOut.includes('ネイティブ')||scopeOut.includes('native'))&&(mobileAns.includes('expo')||mobileAns.includes('react native')||mobileAns.includes('flutter'))){
findings.push({level:'warn',msg:G?'scope_outにネイティブアプリがありますがmobile設定と矛盾しています':'scope_out excludes native but mobile answer uses a native framework'});
}
// C3b: Check generated spec files too
if(scopeOut.includes('ネイティブ')&&spec.includes('Expo')&&!constitution.includes('Expo Web UI')){
findings.push({level:'error',msg:G?'スコープ外「ネイティブ」と仕様のExpo記述が矛盾':'Scope excludes native but spec includes Expo'});
}
// C4: Entity domain warnings
const er=inferER(a);
er.warnings.forEach(w=>findings.push({level:'warn',msg:w}));
// C5: Schedule date present
if(tasks&&!tasks.includes(new Date().toISOString().split('T')[0].slice(0,7))){
findings.push({level:'info',msg:G?'タスクの開始日が今月と異なります':'Task start date differs from current month'});
}
// C6: DevContainer matches backend
const compose=files['.devcontainer/docker-compose.yml']||'';
const be=a.backend||'';
if(be.includes('Supabase')&&compose.includes('postgres:16')){
findings.push({level:'error',msg:G?'Supabase構成なのにDevContainerが素PostgreSQLです':'Supabase stack but DevContainer uses raw PostgreSQL'});
}
if(be.includes('Firebase')&&compose.includes('postgres:16')){
findings.push({level:'error',msg:G?'Firebase構成なのにDevContainerにPostgreSQLがあります':'Firebase stack but DevContainer includes PostgreSQL'});
}
// C7: Package.json dependencies match stack
const pkg=files['package.json']?JSON.parse(files['package.json']):{};
const deps=pkg.dependencies||{};
if(be.includes('Supabase')&&!deps['@supabase/supabase-js']){
findings.push({level:'warn',msg:G?'Supabase使用なのにpackage.jsonに@supabase/supabase-jsがありません':'Supabase stack but @supabase/supabase-js missing from package.json'});
}
if(be.includes('Express')&&!deps['express']){
findings.push({level:'warn',msg:G?'Express使用なのにpackage.jsonにexpressがありません':'Express stack but express missing from package.json'});
}
// C8: .env prefix matches frontend
const envFile=files['.env.example']||'';
const feRaw=a.frontend||'';
if(feRaw.includes('Vite')&&envFile.includes('NEXT_PUBLIC_')){
findings.push({level:'error',msg:G?'Vite SPAなのに.envにNEXT_PUBLIC_があります':'Vite SPA but .env uses NEXT_PUBLIC_ prefix'});
}
if(feRaw.includes('Next')&&envFile.includes('VITE_')){
findings.push({level:'warn',msg:G?'Next.jsなのに.envにVITE_があります':'Next.js but .env uses VITE_ prefix'});
}
// C9: Monitoring matches deploy target (check all monitoring docs)
const deploy=a.deploy||'';
const allMonContent=Object.keys(files).filter(k=>k.startsWith('docs/')&&/monitor/i.test(k)).map(k=>files[k]||'').join('\n');
const monCheck=(allMonContent||files['docs/17_monitoring.md']||'');
if(!deploy.includes('Vercel')&&monCheck.includes('Vercel Analytics')){
findings.push({level:'warn',msg:G?'デプロイ先がVercelではないのにVercel Analyticsが記載されています':'Non-Vercel deploy but Vercel Analytics in monitoring doc'});
}
// C10: BaaS should not have Prisma deps
if(arch.isBaaS&&((pkg.devDependencies||{})['prisma']||deps['@prisma/client'])){
findings.push({level:'warn',msg:G?'BaaS構成なのにPrisma依存があります':'BaaS stack but Prisma dependencies present'});
}
return findings;
}
function genCommonFiles(a,pn){
const G=S.genLang==='ja';
S.files['README.md']=`# ${pn}
> Generated by [DevForge v9](https://github.com/) — ${G?'AI駆動開発統合プラットフォーム':'AI-driven Development Platform'}
## ${G?'概要':'Overview'}
${a.purpose||'N/A'}
## ${G?'技術スタック':'Tech Stack'}
- Frontend: ${a.frontend||'React + Next.js'}
- Backend: ${a.backend||'Node.js'}
- Database: ${a.database||'PostgreSQL'}
- Deploy: ${a.deploy||'Vercel'}
${!isNone(a.mobile)?`- Mobile: ${a.mobile}\n`:''}
## ${G?'セットアップ':'Setup'}
\`\`\`bash
git clone https://github.com/YOUR_USERNAME/${pn.toLowerCase().replace(/[^a-z0-9]/g,'-')}.git
cd ${pn.toLowerCase().replace(/[^a-z0-9]/g,'-')}
npm install
cp .env.example .env.local
npm run dev
\`\`\`
## ${G?'プロジェクト構造':'Project Structure'}
- \`.spec/\` — ${G?'SDD仕様書（柱①）':'SDD specs (Pillar 1)'}
- \`.devcontainer/\` — ${G?'開発環境（柱②）':'Dev environment (Pillar 2)'}
- \`.mcp/\` — ${G?'MCP設定（柱③）':'MCP config (Pillar 3)'}
- \`CLAUDE.md\` etc. — ${G?'AIルール（柱④）':'AI rules (Pillar 4)'}
- \`roadmap/\` — ${G?'学習ロードマップ（柱⑦）':'Learning roadmap (Pillar 7)'}
- \`docs/\` — ${G?'開発ドキュメント（21ファイル）':'Dev documents (21 files)'}
## ${G?'駆動開発手法':'Dev Methods'}
${(a.dev_methods||'TDD').split(', ').join(' / ')}
## ${G?'ライセンス':'License'}
MIT
---
${G?'© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん':'© 2026 Engineering no Tane Committee | by にしあん'}
`;
const isNextFE=(a.frontend||'').includes('Next');
const gitIgnoreLines=['node_modules/',isNextFE?'.next/':'dist/','build/','.env','.env.local','*.log','.DS_Store','coverage/','.turbo/'];
if((a.backend||'').includes('Supabase')) gitIgnoreLines.push('.supabase/');
S.files['.gitignore']=gitIgnoreLines.join('\n')+'\n';
const pkgDeps=buildDeps(a);
S.files['package.json']=JSON.stringify({
name:pn.toLowerCase().replace(/[^a-z0-9]/g,'-'),
version:'0.1.0',
private:true,
scripts:pkgDeps.scripts,
dependencies:pkgDeps.deps,devDependencies:pkgDeps.devDeps
},null,2);
S.files['LICENSE']=`MIT License\n\nCopyright (c) ${new Date().getFullYear()} ${pn}\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the "Software"), to deal\nin the Software without restriction, including without limitation the rights\n
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n
\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.`;
}
// ═══ Pillar 11: Implementation Intelligence Data Structures ═══
// ── App Type Detection ──
function detectAppType(a){
const fe=a.frontend||'';
const be=a.backend||'';
const mob=a.mobile||'none';
// Realtime apps
if((a.mvp_features||'').match(/(リアルタイム|realtime|チャット|chat|通知|notification|ライブ|live)/i)) return 'realtime';
// Mobile-first
if(mob!=='none'&&mob!=='なし') return 'mobile';
// API-only (no frontend)
if(isNone(fe)||fe==='API only') return 'api_only';
// PWA
if(fe.includes('PWA')||(a.mvp_features||'').includes('PWA')) return 'pwa';
// SSR frameworks
if(fe.includes('Next')||fe.includes('Nuxt')||fe.includes('Remix')||fe.includes('SvelteKit')) return 'ssr';
// SPA default
return 'spa';
}
// ── Domain-Specific Implementation Pattern Helper ──
function _dip(impl_ja,impl_en,pseudo,guard_ja,guard_en){
return {impl_ja:impl_ja,impl_en:impl_en,pseudo:pseudo,guard_ja:guard_ja,guard_en:guard_en};
}
// ── Domain Implementation Patterns (32 domains) ──
const DOMAIN_IMPL_PATTERN={
education:_dip(
['進捗トラッキングはイベントソーシングで実装','コース完了判定はサーバーサイドで検証','レッスン順序制御はFKと順序カラムで管理'],
['Implement progress tracking with event sourcing','Validate course completion server-side','Control lesson order with FK and sequence column'],
'function trackProgress(userId,lessonId,courseId){\n  const event={type:"LESSON_COMPLETED",userId,lessonId,timestamp:Date.now()};\n  emit(event);\n  const progress=getLessonProgress(userId,courseId);\n  if(progress.completed===progress.total) emit({type:"COURSE_COMPLETED",userId,courseId});\n}',
['未完了レッスンへのスキップを防止','進捗率の逆戻り禁止','修了証明書の改ざん防止'],
['Prevent skipping to incomplete lessons','Disallow progress regression','Prevent certificate tampering']
),
ec:_dip(
['在庫ロックは楽観的ロック(version列)で実装','決済は冪等性キー必須','カート→注文確定は2フェーズコミット'],
['Implement inventory locking with optimistic lock (version column)','Payment must use idempotency key','Cart to order confirmation uses 2-phase commit'],
'function reserveInventory(productId,qty){\n  const row=db.query("SELECT stock,version FROM products WHERE id=? FOR UPDATE",[productId]);\n  if(row.stock<qty) throw new Error("Out of stock");\n  db.execute("UPDATE products SET stock=stock-?, version=version+1 WHERE id=? AND version=?",[qty,productId,row.version]);\n}',
['在庫数マイナス防止','同時購入による在庫過剰引当て','決済と在庫確保の不整合'],
['Prevent negative stock','Prevent over-allocation from concurrent purchases','Prevent payment-inventory inconsistency']
),
fintech:_dip(
['残高更新はトランザクション必須','二重送金防止は送金テーブルにユニーク制約','監査ログはイミュータブルテーブル'],
['Balance updates require transactions','Prevent double transfers with unique constraint on transfer table','Audit logs use immutable table'],
'function transfer(fromId,toId,amount,idempotencyKey){\n  db.transaction(()=>{\n    db.execute("INSERT INTO transfers (from_user,to_user,amount,idempotency_key) VALUES (?,?,?,?)",[fromId,toId,amount,idempotencyKey]);\n    db.execute("UPDATE accounts SET balance=balance-? WHERE user_id=?",[amount,fromId]);\n    db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[amount,toId]);\n    db.execute("INSERT INTO audit_logs (action,user_id,details) VALUES (?,?,?)",["TRANSFER",fromId,JSON.stringify({toId,amount})]);\n  });\n}',
['残高マイナス防止','送金の二重実行','監査ログの削除・改ざん'],
['Prevent negative balance','Prevent double execution of transfers','Prevent deletion/tampering of audit logs']
),
health:_dip(
['患者データは暗号化カラムで保存','アクセスログは全操作記録','同意管理は専用テーブルで管理'],
['Store patient data in encrypted columns','Record all operations in access logs','Manage consent with dedicated table'],
'function accessPatientRecord(doctorId,patientId,purpose){\n  if(!hasConsent(patientId,purpose)) throw new Error("No consent");\n  const record=db.query("SELECT decrypt(medical_data) FROM patients WHERE id=?",[patientId]);\n  db.execute("INSERT INTO access_logs (doctor_id,patient_id,purpose,timestamp) VALUES (?,?,?,?)",[doctorId,patientId,purpose,Date.now()]);\n  return record;\n}',
['同意なしアクセス防止','暗号化キー漏洩','アクセスログ削除'],
['Prevent access without consent','Prevent encryption key leakage','Prevent access log deletion']
),
marketplace:_dip(
['取引エスクローはステートマシンで管理','評価の相互投稿は取引完了後のみ許可','手数料計算はサーバーサイド'],
['Manage escrow transactions with state machine','Allow mutual reviews only after transaction completion','Calculate fees server-side'],
'function completeTransaction(txId){\n  const tx=db.query("SELECT * FROM transactions WHERE id=? FOR UPDATE",[txId]);\n  if(tx.status!=="escrow") throw new Error("Invalid state");\n  const fee=tx.amount*0.05;\n  db.transaction(()=>{\n    db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[tx.amount-fee,tx.seller_id]);\n    db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[fee,"platform"]);\n    db.execute("UPDATE transactions SET status=\'completed\' WHERE id=?",[txId]);\n  });\n}',
['エスクロー状態の不正遷移','手数料計算の改ざん','評価の不正投稿'],
['Prevent invalid escrow state transition','Prevent fee calculation tampering','Prevent fraudulent reviews']
),
community:_dip(
['投稿のモデレーションはキューで非同期処理','スパム検出はレート制限+コンテンツフィルタ','ユーザーブロックは双方向テーブル'],
['Process post moderation asynchronously with queue','Detect spam with rate limiting + content filter','Manage user blocks with bidirectional table'],
'function createPost(userId,content){\n  if(isRateLimited(userId)) throw new Error("Rate limit exceeded");\n  const postId=db.insert("INSERT INTO posts (user_id,content,status) VALUES (?,?,\'pending\')",[userId,content]);\n  queue.push({task:"MODERATE_POST",postId:postId});\n  return postId;\n}',
['スパム投稿の大量作成','モデレーション回避','ブロックユーザーの相互作用'],
['Prevent mass spam posting','Prevent moderation bypass','Prevent blocked user interaction']
),
content:_dip(
['コンテンツ公開はスケジューラで予約投稿','バージョン管理はdraft/publishedテーブル分離','メディアアップロードは署名付きURL'],
['Schedule content publishing with scheduler','Manage versions with separate draft/published tables','Use signed URLs for media uploads'],
'function schedulePublish(contentId,publishAt){\n  db.execute("UPDATE contents SET status=\'scheduled\',publish_at=? WHERE id=?",[publishAt,contentId]);\n  scheduler.add({task:"PUBLISH_CONTENT",contentId:contentId,runAt:publishAt});\n}',
['未公開コンテンツの漏洩','公開日時の改ざん','メディアファイルの不正アクセス'],
['Prevent unpublished content leakage','Prevent publish date tampering','Prevent unauthorized media access']
),
analytics:_dip(
['イベント収集はバッチ挿入で高速化','集計はマテリアライズドビュー','リアルタイム更新はWebSocket'],
['Speed up event collection with batch insert','Use materialized views for aggregation','Use WebSocket for realtime updates'],
'function trackEvent(userId,eventType,properties){\n  eventBuffer.push({userId,eventType,properties,timestamp:Date.now()});\n  if(eventBuffer.length>=100){\n    db.batchInsert("INSERT INTO events (user_id,event_type,properties,timestamp) VALUES ?",eventBuffer);\n    eventBuffer=[];\n  }\n}',
['イベント欠損','集計の遅延','ダッシュボードの過負荷'],
['Prevent event loss','Prevent aggregation delays','Prevent dashboard overload']
),
booking:_dip(
['予約の排他制御は行ロック+タイムアウト','キャンセルポリシーはステータス遷移で管理','リマインダーはスケジューラで自動送信'],
['Control booking exclusivity with row lock + timeout','Manage cancellation policy with status transition','Auto-send reminders with scheduler'],
'function createBooking(userId,slotId,startTime){\n  db.transaction(()=>{\n    const slot=db.query("SELECT * FROM slots WHERE id=? FOR UPDATE",[slotId]);\n    if(slot.status!=="available") throw new Error("Slot unavailable");\n    db.execute("INSERT INTO bookings (user_id,slot_id,start_time,status) VALUES (?,?,?,\'confirmed\')",[userId,slotId,startTime]);\n    db.execute("UPDATE slots SET status=\'booked\' WHERE id=?",[slotId]);\n    scheduler.add({task:"SEND_REMINDER",bookingId:bookingId,runAt:startTime-3600000});\n  });\n}',
['ダブルブッキング','キャンセル不可期間の無視','リマインダー送信漏れ'],
['Prevent double booking','Prevent ignoring non-cancellable period','Prevent missed reminder sending']
),
saas:_dip(
['プラン制限はミドルウェアでチェック','使用量メーターはカウンターテーブル','サブスク更新はWebhookで同期'],
['Check plan limits in middleware','Track usage with counter table','Sync subscription updates with webhook'],
'function checkLimit(userId,feature){\n  const plan=db.query("SELECT plan FROM users WHERE id=?",[userId]);\n  const usage=db.query("SELECT count FROM usage WHERE user_id=? AND feature=?",[userId,feature]);\n  const limit=PLAN_LIMITS[plan.plan][feature];\n  if(usage.count>=limit) throw new Error("Limit exceeded");\n}',
['プラン制限の回避','使用量カウントの不整合','サブスク状態のズレ'],
['Prevent plan limit bypass','Prevent usage count inconsistency','Prevent subscription state drift']
),
portfolio:_dip(
['作品公開はステータスフラグ','タグ検索はインデックス必須','アクセス解析はログテーブル'],
['Control work visibility with status flag','Tag search requires index','Track analytics with log table'],
'function publishWork(userId,workId){\n  db.execute("UPDATE works SET status=\'published\',published_at=? WHERE id=? AND user_id=?",[Date.now(),workId,userId]);\n  db.execute("INSERT INTO activity_logs (user_id,action,target_id) VALUES (?,\'PUBLISH\',?)",[userId,workId]);\n}',
['非公開作品の漏洩','タグスパム','統計の不正操作'],
['Prevent private work leakage','Prevent tag spam','Prevent stat manipulation']
),
tool:_dip(
['API呼び出しはレート制限必須','結果キャッシュはTTL付きRedis','エラーはリトライ+フォールバック'],
['Apply rate limiting to API calls','Cache results with TTL in Redis','Implement retry + fallback for errors'],
'function callAPI(userId,endpoint,params){\n  const cacheKey=`api:${endpoint}:${JSON.stringify(params)}`;\n  const cached=redis.get(cacheKey);\n  if(cached) return cached;\n  const result=fetch(endpoint,params);\n  redis.set(cacheKey,result,{EX:300});\n  return result;\n}',
['APIレート超過','キャッシュ汚染','エラー時のユーザー影響'],
['Prevent API rate excess','Prevent cache pollution','Prevent user impact on errors']
),
iot:_dip(
['デバイスデータはタイムシリーズDB','異常検知はしきい値+アラート','ファームウェア更新はバージョン管理'],
['Store device data in time-series DB','Detect anomalies with threshold + alert','Manage firmware updates with versioning'],
'function recordSensorData(deviceId,sensorType,value){\n  influxDB.write({measurement:sensorType,tags:{deviceId},fields:{value},timestamp:Date.now()});\n  if(value>THRESHOLD[sensorType]){\n    alert.send({type:"ANOMALY",deviceId,sensorType,value});\n  }\n}',
['データ欠損','異常検知の遅延','不正ファームウェア配信'],
['Prevent data loss','Prevent anomaly detection delay','Prevent malicious firmware distribution']
),
realestate:_dip(
['物件ステータスは排他制御','内見予約は重複チェック','契約書は電子署名'],
['Control property status with exclusive lock','Check duplicates for viewing appointments','Use e-signature for contracts'],
'function reserveViewing(userId,propertyId,datetime){\n  db.transaction(()=>{\n    const existing=db.query("SELECT * FROM viewings WHERE property_id=? AND datetime=?",[propertyId,datetime]);\n    if(existing) throw new Error("Slot taken");\n    db.execute("INSERT INTO viewings (user_id,property_id,datetime,status) VALUES (?,?,?,\'confirmed\')",[userId,propertyId,datetime]);\n  });\n}',
['物件ステータスの不整合','内見ダブルブッキング','契約書の改ざん'],
['Prevent property status inconsistency','Prevent viewing double booking','Prevent contract tampering']
),
legal:_dip(
['契約文書はバージョン管理','アクセス権限は役割ベース','変更履歴はイミュータブル'],
['Manage contracts with versioning','Control access with role-based permissions','Track change history immutably'],
'function updateContract(userId,contractId,newContent){\n  const current=db.query("SELECT version FROM contracts WHERE id=?",[contractId]);\n  db.transaction(()=>{\n    db.execute("INSERT INTO contract_versions (contract_id,version,content,updated_by) VALUES (?,?,?,?)",[contractId,current.version+1,newContent,userId]);\n    db.execute("UPDATE contracts SET version=version+1 WHERE id=?",[contractId]);\n  });\n}',
['契約内容の不正変更','アクセス権限の逸脱','変更履歴の削除'],
['Prevent unauthorized contract changes','Prevent access permission violation','Prevent change history deletion']
),
hr:_dip(
['応募者データは暗号化','選考ステータスはワークフロー','オファー承諾は電子署名'],
['Encrypt applicant data','Manage selection status with workflow','Use e-signature for offer acceptance'],
'function updateApplicantStatus(applicantId,newStatus){\n  const current=db.query("SELECT status FROM applicants WHERE id=?",[applicantId]);\n  if(!isValidTransition(current.status,newStatus)) throw new Error("Invalid transition");\n  db.execute("UPDATE applicants SET status=?,updated_at=? WHERE id=?",[newStatus,Date.now(),applicantId]);\n  db.execute("INSERT INTO status_history (applicant_id,from_status,to_status) VALUES (?,?,?)",[applicantId,current.status,newStatus]);\n}',
['個人情報漏洩','選考ステータスの不正遷移','オファー条件の改ざん'],
['Prevent personal info leakage','Prevent invalid status transition','Prevent offer condition tampering']
),
ai:_dip(
['プロンプトはテンプレート管理','API呼び出しはキュー+リトライ','生成結果はバージョン保存'],
['Manage prompts with templates','Use queue + retry for API calls','Save generation results with versioning'],
'function generateContent(userId,promptId,params){\n  const template=db.query("SELECT template FROM prompts WHERE id=?",[promptId]);\n  const prompt=renderTemplate(template,params);\n  const job={userId,prompt,status:"pending"};\n  queue.push(job);\n  return job.id;\n}',
['プロンプトインジェクション','APIコスト暴走','生成結果の紛失'],
['Prevent prompt injection','Prevent API cost runaway','Prevent loss of generation results']
),
automation:_dip(
['ワークフローはDAGで定義','実行履歴は全ステップ記録','失敗時は自動リトライ'],
['Define workflows with DAG','Record all steps in execution history','Auto-retry on failure'],
'function executeWorkflow(workflowId,input){\n  const steps=db.query("SELECT * FROM workflow_steps WHERE workflow_id=? ORDER BY sequence",[workflowId]);\n  let context=input;\n  for(const step of steps){\n    try{\n      context=executeStep(step,context);\n      db.execute("INSERT INTO execution_logs (workflow_id,step_id,status,output) VALUES (?,?,\'success\',?)",[workflowId,step.id,context]);\n    }catch(e){\n      db.execute("INSERT INTO execution_logs (workflow_id,step_id,status,error) VALUES (?,?,\'failed\',?)",[workflowId,step.id,e.message]);\n      if(step.retry) retry(step,context);\n    }\n  }\n}',
['循環依存の発生','ステップ実行順序の誤り','失敗時のデータ不整合'],
['Prevent circular dependencies','Prevent step execution order errors','Prevent data inconsistency on failure']
),
event:_dip(
['参加登録は定員チェック','チケット発行はユニークコード','入場管理はQRスキャン'],
['Check capacity for registration','Issue tickets with unique code','Manage entry with QR scan'],
'function registerEvent(userId,eventId){\n  db.transaction(()=>{\n    const event=db.query("SELECT capacity,(SELECT COUNT(*) FROM registrations WHERE event_id=?) as current FROM events WHERE id=? FOR UPDATE",[eventId,eventId]);\n    if(event.current>=event.capacity) throw new Error("Event full");\n    const ticketCode=generateUniqueCode();\n    db.execute("INSERT INTO registrations (user_id,event_id,ticket_code,status) VALUES (?,?,?,\'confirmed\')",[userId,eventId,ticketCode]);\n  });\n}',
['定員超過登録','チケットコード重複','不正入場'],
['Prevent over-capacity registration','Prevent ticket code duplication','Prevent unauthorized entry']
),
gamify:_dip(
['ポイント付与はトランザクション','ランキングは集計テーブル','実績解除はサーバー検証'],
['Award points with transaction','Use aggregation table for ranking','Verify achievement unlock server-side'],
'function awardPoints(userId,points,reason){\n  db.transaction(()=>{\n    db.execute("UPDATE users SET points=points+? WHERE id=?",[points,userId]);\n    db.execute("INSERT INTO point_logs (user_id,points,reason,timestamp) VALUES (?,?,?,?)",[userId,points,reason,Date.now()]);\n    checkAchievements(userId);\n  });\n}',
['ポイント不正取得','ランキング操作','実績の不正解除'],
['Prevent point fraud','Prevent ranking manipulation','Prevent achievement unlock fraud']
),
collab:_dip(
['リアルタイム編集はOT/CRDT','競合解決は最終書込み優先','バージョン履歴は差分保存'],
['Implement realtime editing with OT/CRDT','Resolve conflicts with last-write-wins','Save version history as diffs'],
'function applyEdit(docId,userId,operation){\n  const doc=getDocument(docId);\n  const transformed=transformOperation(operation,doc.pendingOps);\n  applyOperation(doc,transformed);\n  broadcast({docId,userId,operation:transformed});\n  saveVersion(docId,transformed);\n}',
['編集競合によるデータ破損','バージョン履歴の肥大化','同時編集の遅延'],
['Prevent data corruption from edit conflicts','Prevent version history bloat','Prevent concurrent edit latency']
),
devtool:_dip(
['コマンド実行はサンドボックス','ログ出力はストリーミング','ビルド成果物はキャッシュ'],
['Execute commands in sandbox','Stream log output','Cache build artifacts'],
'function executeCommand(cmd,env){\n  const sandbox=createSandbox(env);\n  const process=sandbox.exec(cmd);\n  process.stdout.on("data",(chunk)=>{\n    stream.write(chunk);\n  });\n  process.on("exit",(code)=>{\n    if(code===0) cacheArtifacts(sandbox.output);\n  });\n}',
['任意コード実行','ログの機密情報漏洩','キャッシュ汚染'],
['Prevent arbitrary code execution','Prevent sensitive info leakage in logs','Prevent cache pollution']
),
creator:_dip(
['コンテンツ収益化はサブスク+投げ銭','収益分配は自動計算','著作権は電子透かし'],
['Monetize content with subscription + tips','Auto-calculate revenue sharing','Protect copyright with watermark'],
'function tipCreator(userId,creatorId,amount){\n  db.transaction(()=>{\n    db.execute("UPDATE accounts SET balance=balance-? WHERE user_id=?",[amount,userId]);\n    const platformFee=amount*0.1;\n    db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[amount-platformFee,creatorId]);\n    db.execute("INSERT INTO transactions (from_user,to_user,amount,type) VALUES (?,?,?,\'tip\')",[userId,creatorId,amount]);\n  });\n}',
['収益計算の誤り','手数料の不正操作','コンテンツの無断転載'],
['Prevent revenue calculation errors','Prevent fee manipulation','Prevent unauthorized content reuse']
),
newsletter:_dip(
['配信リストは購読ステータス管理','メール送信はキュー+レート制限','開封率はピクセルトラッキング'],
['Manage distribution list with subscription status','Send emails with queue + rate limiting','Track open rate with pixel tracking'],
'function sendNewsletter(newsletterId,subscriberIds){\n  subscriberIds.forEach(id=>{\n    const trackingPixel=generateTrackingPixel(newsletterId,id);\n    const email=renderEmail(newsletterId,{trackingPixel});\n    queue.push({task:"SEND_EMAIL",to:id,content:email});\n  });\n}',
['購読解除の無視','配信レート超過','開封率の不正操作'],
['Prevent ignoring unsubscription','Prevent sending rate excess','Prevent open rate manipulation']
),
_default:_dip(
['データ整合性はトランザクション','エラーハンドリングは必須','ログ記録は全操作'],
['Ensure data integrity with transactions','Error handling is mandatory','Log all operations'],
'function performOperation(data){\n  try{\n    db.transaction(()=>{\n      validateInput(data);\n      const result=processData(data);\n      logOperation(result);\n      return result;\n    });\n  }catch(e){\n    logError(e);\n    throw e;\n  }\n}',
['データ不整合','エラーの握りつぶし','操作履歴の欠落'],
['Prevent data inconsistency','Prevent error suppression','Prevent operation history loss']
)
};
// ── App Type Implementation Patterns ──
const APP_TYPE_MAP={
spa:{
patterns_ja:['状態管理はRedux/Zustand','ルーティングはReact Router','認証はトークンベース','API呼び出しはaxios/fetch'],
patterns_en:['State management with Redux/Zustand','Routing with React Router','Token-based auth','API calls with axios/fetch'],
antipatterns_ja:['SEOが必要なのにSPA','初回ロードが遅い','認証トークンをlocalStorageに平文保存'],
antipatterns_en:['Using SPA when SEO is required','Slow initial load','Storing auth tokens in localStorage plaintext']
},
ssr:{
patterns_ja:['データフェッチはgetServerSideProps','SEOメタタグは動的生成','認証はサーバーセッション','静的ページはISR'],
patterns_en:['Data fetching with getServerSideProps','Dynamically generate SEO meta tags','Server-side session auth','Static pages with ISR'],
antipatterns_ja:['全ページSSR(不要なページまで)','サーバー負荷考慮なし','クライアント状態とサーバー状態の不一致'],
antipatterns_en:['SSR all pages (even unnecessary ones)','No server load consideration','Client-server state mismatch']
},
pwa:{
patterns_ja:['Service Workerでオフライン対応','マニフェストファイル必須','プッシュ通知はVAPID','キャッシュ戦略はCache First'],
patterns_en:['Offline support with Service Worker','Manifest file required','Push notifications with VAPID','Cache strategy: Cache First'],
antipatterns_ja:['キャッシュクリア手段なし','オフライン時のUX考慮不足','バックグラウンド同期なし'],
antipatterns_en:['No cache clearing mechanism','Poor offline UX consideration','No background sync']
},
mobile:{
patterns_ja:['ネイティブ機能はExpo Modules','状態管理はRedux Toolkit','ナビゲーションはReact Navigation','プッシュ通知はExpo Notifications'],
patterns_en:['Native features with Expo Modules','State management with Redux Toolkit','Navigation with React Navigation','Push notifications with Expo Notifications'],
antipatterns_ja:['Webビューだけでネイティブ未活用','Android/iOS差分の考慮なし','バッテリー消費の最適化なし'],
antipatterns_en:['Only WebView without native features','No Android/iOS difference consideration','No battery consumption optimization']
},
api_only:{
patterns_ja:['RESTはOpenAPI仕様書','GraphQLはスキーマファースト','認証はJWT+リフレッシュトークン','レート制限は必須'],
patterns_en:['REST with OpenAPI spec','GraphQL with schema-first','Auth with JWT + refresh token','Rate limiting required'],
antipatterns_ja:['エラーレスポンス統一なし','バージョニング戦略なし','ドキュメント未整備'],
antipatterns_en:['No unified error response','No versioning strategy','Poor documentation']
},
realtime:{
patterns_ja:['WebSocketはSocket.io','状態同期はFirebase/Supabase Realtime','再接続ロジック必須','メッセージキューはRedis Pub/Sub'],
patterns_en:['WebSocket with Socket.io','State sync with Firebase/Supabase Realtime','Reconnection logic required','Message queue with Redis Pub/Sub'],
antipatterns_ja:['再接続時の状態復元なし','メッセージ順序保証なし','スケーラビリティ考慮不足'],
antipatterns_en:['No state restoration on reconnect','No message order guarantee','Poor scalability consideration']
}
};
// ── Cross-Cutting Implementation Concerns ──
const CROSS_CUTTING_IMPL={
auth:{
ja:['パスワードはbcryptでハッシュ化(rounds=12)','セッショントークンはhttpOnly cookie','CSRF対策はトークン検証','MFAは2段階認証アプリ'],
en:['Hash passwords with bcrypt (rounds=12)','Session token in httpOnly cookie','CSRF protection with token verification','MFA with authenticator app']
},
error:{
ja:['エラーは集約ハンドラで統一処理','スタックトレースは本番環境で非表示','エラーログはSentry/Cloudwatch','ユーザーには安全なメッセージ表示'],
en:['Unified error handling with aggregated handler','Hide stack traces in production','Error logs with Sentry/Cloudwatch','Show safe messages to users']
},
cache:{
ja:['頻繁アクセスデータはRedisキャッシュ','キャッシュキーは名前空間付き','TTLは用途別に設定','キャッシュ削除はイベント駆動'],
en:['Cache frequently accessed data in Redis','Cache keys with namespace','Set TTL per use case','Cache invalidation event-driven']
},
i18n:{
ja:['翻訳ファイルはJSONで管理','言語切替はクッキー保存','日時フォーマットはIntl API','RTL言語対応はCSS論理プロパティ'],
en:['Manage translations with JSON files','Store language switch in cookie','Date format with Intl API','RTL support with CSS logical properties']
},
audit:{
ja:['重要操作は全て監査ログ記録','ログはイミュータブルテーブル','誰が・いつ・何を・なぜを記録','保存期間はコンプライアンス準拠'],
en:['Record all critical operations in audit log','Logs in immutable table','Record who/when/what/why','Retention period compliant with regulations']
},
upload:{
ja:['ファイルサイズ制限必須','MIMEタイプ検証(拡張子に頼らない)','アップロードは署名付きURL','マルウェアスキャンはClamAV'],
en:['File size limit required','MIME type validation (not relying on extension)','Upload with signed URL','Malware scan with ClamAV']
},
rate:{
ja:['APIはユーザー/IP別にレート制限','制限超過時は429ステータス','Retry-Afterヘッダー必須','管理者APIは別枠'],
en:['Rate limit API per user/IP','Return 429 on limit exceeded','Retry-After header required','Admin API separate limit']
},
validation:{
ja:['入力検証はクライアント+サーバー両方','サーバーサイド検証を信頼の境界','SQLインジェクション対策はORM/prepared statement','XSS対策はエスケープ+CSP'],
en:['Input validation on both client and server','Server-side validation as trust boundary','SQL injection prevention with ORM/prepared statement','XSS prevention with escaping + CSP']
}
};
function openEditor(path){
const content=S.files[path];
if(!content)return;
const _ja=S.lang==='ja';
const isEdited=S.editedFiles&&S.editedFiles[path];
const prevBody=$('prevBody');
prevBody.innerHTML=`
<div class="editor-toolbar">
<div class="title">📝 ${esc(path)}</div>
<div class="actions">
<button class="btn btn-s" onclick="saveEdited('${escAttr(path)}')">💾 ${_ja?'保存':'Save'}</button>
<button class="btn btn-s" onclick="revertFile('${escAttr(path)}')"${isEdited?'':'disabled'}>↩️ ${_ja?'元に戻す':'Revert'}</button>
<button class="btn btn-s" onclick="previewFile('${escAttr(path)}')">👁 ${_ja?'プレビュー':'Preview'}</button>
</div>
</div>
<textarea id="editorArea" spellcheck="false" class="editor-area" aria-label="${_ja?'ファイルエディタ':'File Editor'}">${esc(content)}</textarea>`;
// Auto-resize
const ta=$('editorArea');
if(ta){
ta.addEventListener('keydown',e=>{
if(e.key==='Tab'){e.preventDefault();const s=ta.selectionStart,end=ta.selectionEnd;ta.value=ta.value.substring(0,s)+'  '+ta.value.substring(end);ta.selectionStart=ta.selectionEnd=s+2;}
if(e.ctrlKey&&e.key==='s'){e.preventDefault();saveEdited(path);}
});
}
}
function saveEdited(path){
const _ja=S.lang==='ja';
const ta=$('editorArea');
if(!ta)return;
const newContent=ta.value;
if(newContent===S.files[path])return toast(_ja?'変更なし':'No changes');
// Store original if first edit
if(!S.editedFiles[path])S.editedFiles[path]=S.files[path];
S.files[path]=newContent;
save();
toast(_ja?'✅ 保存しました':'✅ Saved');
showFileTree();
}
function revertFile(path){
const _ja=S.lang==='ja';
if(!S.editedFiles||!S.editedFiles[path])return;
S.files[path]=S.editedFiles[path];
delete S.editedFiles[path];
save();
toast(_ja?'↩️ 元に戻しました':'↩️ Reverted');
openEditor(path);
}
function lineDiff(oldText,newText){
const oldL=oldText.split('\n'),newL=newText.split('\n');
const result=[];
// Simple LCS-based diff
const m=oldL.length,n=newL.length;
const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));
for(let i=1;i<=m;i++)for(let j=1;j<=n;j++){
dp[i][j]=oldL[i-1]===newL[j-1]?dp[i-1][j-1]+1:Math.max(dp[i-1][j],dp[i][j-1]);
}
// Backtrack
let i=m,j=n;
const ops=[];
while(i>0||j>0){
if(i>0&&j>0&&oldL[i-1]===newL[j-1]){ops.unshift({type:'same',line:oldL[i-1]});i--;j--;}
else if(j>0&&(i===0||dp[i][j-1]>=dp[i-1][j])){ops.unshift({type:'add',line:newL[j-1]});j--;}
else{ops.unshift({type:'del',line:oldL[i-1]});i--;}
}
return ops;
}
function showDiff(path){
const _ja=S.lang==='ja';
const oldContent=S.prevFiles[path]||S.editedFiles[path];
const newContent=S.files[path];
if(!oldContent||!newContent||oldContent===newContent){
toast(_ja?'差分なし':'No differences');return;
}
const diff=lineDiff(oldContent,newContent);
const adds=diff.filter(d=>d.type==='add').length;
const dels=diff.filter(d=>d.type==='del').length;
const same=diff.filter(d=>d.type==='same').length;
let h=`<div class="diff-header">
<div class="diff-title">🔀 ${esc(path)}</div>
<div class="diff-stats">
<span class="add">+${adds}</span>
<span class="del">-${dels}</span>
<span>~${same}</span>
<button class="btn btn-s" onclick="previewFile('${escAttr(path)}')">✕ ${_ja?'閉じる':'Close'}</button>
</div>
</div>`;
h+='<div class="diff-body">';
let lineNum=0;
diff.forEach(d=>{
if(d.type==='same'){lineNum++;h+=`<div class="diff-same"><span class="diff-ln">${lineNum}</span>${esc(d.line)}</div>`;}
else if(d.type==='add'){lineNum++;h+=`<div class="diff-add"><span class="diff-ln">+${lineNum}</span>${esc(d.line)}</div>`;}
else{h+=`<div class="diff-del"><span class="diff-ln">-</span>${esc(d.line)}</div>`;}
});
h+='</div>';
$('prevBody').innerHTML=h;
}
function showDiffView(){
const _ja=S.lang==='ja';
const prev=S.prevFiles||{};
if(!Object.keys(prev).length){
toast(_ja?'前回生成がありません（再生成後に差分が表示されます）':'No previous generation to compare (regenerate first)');
return;
}
const curr=S.files||{};
const allPaths=new Set([...Object.keys(prev),...Object.keys(curr)]);
const changed=[],added=[],removed=[];
allPaths.forEach(p=>{
if(!prev[p])added.push(p);
else if(!curr[p])removed.push(p);
else if(prev[p]!==curr[p])changed.push(p);
});
if(!changed.length&&!added.length&&!removed.length){
toast(_ja?'差分なし':'No differences');return;
}
let h='<div class="diff-header"><div class="diff-title">📊 '+(_ja?'差分サマリー':'Diff Summary')+'</div><div class="diff-stats"><span class="add">+'+added.length+'</span><span class="del">-'+removed.length+'</span><span>~'+changed.length+'</span></div></div>';
h+='<div class="diff-body" style="padding:12px">';
if(changed.length){
h+='<p><strong>✏️ '+(_ja?'変更':'Changed')+' ('+changed.length+')</strong></p>';
changed.forEach(p=>{h+='<div class="ft-file" style="cursor:pointer;padding:4px 8px" onclick="showDiff(\''+escAttr(p)+'\')">'+esc(p)+'</div>';});
}
if(added.length){
h+='<p><strong>➕ '+(_ja?'追加':'Added')+' ('+added.length+')</strong></p>';
added.forEach(p=>{h+='<div style="color:var(--success);padding:4px 8px">'+esc(p)+'</div>';});
}
if(removed.length){
h+='<p><strong>➖ '+(_ja?'削除':'Removed')+' ('+removed.length+')</strong></p>';
removed.forEach(p=>{h+='<div style="color:var(--danger);padding:4px 8px">'+esc(p)+'</div>';});
}
h+='</div>';
$('prevBody').innerHTML=h;
}
function snapshotFiles(){
S.prevFiles=JSON.parse(JSON.stringify(S.files));
}
async function _renderMermaidSVG(html){
if(!html.includes('language-mermaid'))return html;
await _ensureMermaid();
if(!_mermaidReady)return html;
try{mermaid.initialize({startOnLoad:false,theme:'default',securityLevel:'strict'});}catch(e){}
const re=/<pre><code class="language-mermaid">([\s\S]*?)<\/code><\/pre>/g;
let result=html;let idx=0;const matches=[];let m;
while((m=re.exec(html))!==null)matches.push({full:m[0],code:m[1]});
for(const match of matches){
const code=match.code.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"');
try{
const {svg}=await mermaid.render('_pmm'+(idx++),code);
result=result.replace(match.full,'<div style="text-align:center;margin:16px 0;page-break-inside:avoid;">'+svg+'</div>');
}catch(e){}
}
try{_initMermaidTheme();}catch(e){}
return result;
}
async function exportZIP(){
const _ja=S.lang==='ja';
if(window._noZip||typeof JSZip==='undefined'){toast(_ja?'⚠️ オフライン環境ではZIPエクスポートを利用できません':'⚠️ ZIP export unavailable offline');return;}
const zip=new JSZip();
const root=fileSlug(S.projectName);
Object.entries(S.files).forEach(([path,content])=>{
zip.file(root+'/'+path,content);
});
const blob=await zip.generateAsync({type:'blob'});
const url=URL.createObjectURL(blob);
const link=document.createElement('a');link.href=url;link.download=root+'.zip';link.click();
URL.revokeObjectURL(url);
addMsg('bot',_ja?`📦 ${root}.zip (${Object.keys(S.files).length}ファイル) をダウンロードしました！`:`📦 Downloaded ${root}.zip (${Object.keys(S.files).length} files)!`);
S._zipDone=true;
_lsSet('devforge-last-export',new Date().toISOString());
}
async function exportPDF(){
const _ja=S.lang==='ja';
const G=S.genLang==='ja'||(!S.genLang&&_ja);
let content='';
for(const [path,text] of Object.entries(S.files)){
if(path.endsWith('.md')){
content+=`<h1 style="page-break-before:always;border-bottom:2px solid #3b82f6;padding-bottom:8px;margin-top:40px;">${escHtml(path)}</h1>`;
const mdHtml=safeMD(text);
content+=await _renderMermaidSVG(mdHtml);
}
}
const pdfCss='body{font-family:-apple-system,sans-serif;padding:40px;max-width:800px;margin:0 auto;color:#1e222d;}'
+'pre{background:#f5f5f5;padding:16px;border-radius:8px;overflow-x:auto;}'
+'h1{margin-top:40px;}h1:first-child{page-break-before:avoid;}'
+'table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background:#f0f0f0;}'
+'div[style*="page-break-inside:avoid"] svg{max-width:100%;height:auto;}'
+'@media print{body{padding:20px;}h1{page-break-before:always;}h1:first-child{page-break-before:avoid;}div[style*="page-break-inside:avoid"]{page-break-inside:avoid;}svg{max-width:100%;}}';
const _CSP_META='<meta http-equiv="Content-Security-Policy" content="default-src \'none\'; style-src \'unsafe-inline\'; img-src data: blob:;">';
const html=`<!DOCTYPE html><html><head>${_CSP_META}<title>${escHtml(S.projectName)} - DevForge v9</title><style>${pdfCss}
</style></head><body><div style="text-align:center;margin-bottom:40px;"><h1 style="page-break-before:avoid;border:none;font-size:24px;">${escHtml(S.projectName)}</h1><p style="color:#666;">Generated by DevForge v9 — ${new Date().toLocaleDateString(G?'ja-JP':'en-US')}</p><p style="color:#999;font-size:12px;">${G?'© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん':'© 2026 Engineering no Tane Committee | by にしあん'}</p></div>${content}</body></html>`;
const win=window.open('','_blank');
if(win){
win.document.write(html);
win.document.close();
addMsg('bot',_ja?'📄 PDFプレビューを新しいタブで開きました。Ctrl+P で印刷/PDF保存できます。':'📄 PDF preview opened in new tab. Use Ctrl+P to print/save as PDF.');
} else {
// Fallback: download as HTML file
const blob=new Blob([html],{type:'text/html'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download=fileSlug(S.projectName)+'-docs.html';a.click();URL.revokeObjectURL(a.href);
addMsg('bot',_ja?'📄 ポップアップがブロックされたため、HTMLファイルとしてダウンロードしました。ブラウザで開いてCtrl+Pで印刷できます。':'📄 Popup blocked. Downloaded as HTML. Open in browser and use Ctrl+P to print.');
}
}
function copyAllFiles(){
const _ja=S.lang==='ja';
const sep='\n\n'+'='.repeat(60)+'\n';
const all=Object.entries(S.files).map(([path,content])=>`${sep}📄 ${path}${sep}${content}`).join('\n');
const header=`# ${S.projectName} — ${_ja?'全ファイル結合':'All Files Combined'}\n# Generated by DevForge v9\n# Files: ${Object.keys(S.files).length}\n# Date: ${new Date().toISOString().split('T')[0]}`;
const fullText=header+'\n'+all;
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(fullText).then(()=>{
toast(_ja?`📋 全${Object.keys(S.files).length}ファイルをコピーしました`:`📋 Copied all ${Object.keys(S.files).length} files`);
addMsg('bot',_ja?`📋 全${Object.keys(S.files).length}ファイルをクリップボードにコピーしました。AIへの一括投入にご利用ください。`:`📋 Copied all ${Object.keys(S.files).length} files to clipboard.`);
}).catch(()=>{_fallbackCopy(fullText);toast(_ja?'📋 コピーしました':'📋 Copied');});
} else {_fallbackCopy(fullText);toast(_ja?'📋 コピーしました':'📋 Copied');}
}
async function exportSelectedZip(paths){
const _ja=S.lang==='ja';
if(window._noZip||typeof JSZip==='undefined'){toast(_ja?'⚠️ ZIPエクスポートを利用できません':'⚠️ ZIP export unavailable');return;}
if(!paths||!paths.length){toast(_ja?'⚠️ 対象ファイルが見つかりません':'⚠️ No matching files found');return;}
const zip=new JSZip();
const root=fileSlug(S.projectName);
paths.forEach(function(p){if(S.files[p])zip.file(root+'/'+p,S.files[p]);});
const blob=await zip.generateAsync({type:'blob'});
const url=URL.createObjectURL(blob);
const link=document.createElement('a');link.href=url;link.download=root+'-selected.zip';link.click();
URL.revokeObjectURL(url);
toast(_ja?'📦 '+paths.length+'ファイルをエクスポートしました':'📦 Exported '+paths.length+' files');
}
function exportPillarGroup(prefixCsv){
const prefs=prefixCsv.split(',');
const paths=Object.keys(S.files).filter(function(f){return prefs.some(function(pr){return f.startsWith(pr)||f.includes(pr);});});
exportSelectedZip(paths);
}
function copyForAI(){
const _ja=S.lang==='ja';
const files=Object.entries(S.files);
const tokens=Math.round(files.reduce((s,[,c])=>s+c.length,0)/4);
let md=`# ${S.projectName}\n\n`;
md+=`> ${_ja?'DevForge v9 で生成':'Generated by DevForge v9'} | ${files.length} ${_ja?'ファイル':'files'} | ~${tokens.toLocaleString()} tokens\n\n`;
md+='## Table of Contents\n\n';
files.forEach(([p],i)=>{md+=`${i+1}. \`${p}\`\n`;});
md+='\n---\n\n';
files.forEach(([path,content])=>{
md+=`## ${path}\n\n\`\`\`${path.split('.').pop()}\n${content}\n\`\`\`\n\n`;
});
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(md).then(()=>{
toast(_ja?`🤖 AI向けMarkdown (${files.length}ファイル) をコピー`:`🤖 Copied AI Markdown (${files.length} files)`);
}).catch(()=>{_fallbackCopy(md);toast(_ja?'📋 コピーしました':'📋 Copied');});
} else {_fallbackCopy(md);toast(_ja?'📋 コピーしました':'📋 Copied');}
}
/* ── Pillar ⑤ Parallel Explorer (Enhanced with Recommendation) ── */
function showExplorer(){
pushView({pillar:4,type:'explorer',file:null});
const body=$('prevBody');const _ja=S.lang==='ja';
const stacks={
'Next.js + Supabase':{fe:'React + Next.js',be:'Supabase',db:'PostgreSQL',deploy:'Vercel',cost:'$0–$25',speed:5,scale:3,learn:4,eco:5,best:_ja?'MVP・SaaS':'MVP / SaaS',tags:['saas','mvp','stripe','auth']},
'Next.js + Express + PG':{fe:'React + Next.js',be:'Express',db:'PostgreSQL',deploy:'Vercel+Railway',cost:'$0–$20',speed:4,scale:4,learn:3,eco:5,best:_ja?'フルスタック学習':'Full-stack learning',tags:['fullstack','api','stripe']},
'Next.js + NestJS + PG':{fe:'React + Next.js',be:'NestJS',db:'PostgreSQL',deploy:'AWS',cost:'$10–$50',speed:3,scale:5,learn:2,eco:4,best:_ja?'エンタープライズ':'Enterprise',tags:['enterprise','rbac','team','ddd']},
'Nuxt + Supabase':{fe:'Vue 3 + Nuxt',be:'Supabase',db:'PostgreSQL',deploy:'Vercel',cost:'$0–$25',speed:5,scale:3,learn:5,eco:3,best:_ja?'Vue好き':'Vue fans',tags:['vue','mvp','saas']},
'SvelteKit + Supabase':{fe:'SvelteKit',be:'Supabase',db:'PostgreSQL',deploy:'Vercel',cost:'$0–$25',speed:5,scale:3,learn:4,eco:2,best:_ja?'軽量・高速':'Lightweight & fast',tags:['perf','mvp','lightweight']},
'Next.js + FastAPI + Mongo':{fe:'React + Next.js',be:'FastAPI',db:'MongoDB',deploy:'Vercel+Railway',cost:'$0–$30',speed:4,scale:4,learn:3,eco:4,best:_ja?'AI/ML統合':'AI/ML integration',tags:['ai','ml','python','data']},
'Expo + Supabase':{fe:'Expo (RN)',be:'Supabase',db:'PostgreSQL',deploy:'EAS Build',cost:'$0–$30',speed:4,scale:3,learn:3,eco:3,best:_ja?'モバイルアプリ':'Mobile app',tags:['mobile','expo','native']},
};
const names=Object.keys(stacks);const a=S.answers;
const bar=v=>'⚡'.repeat(v)+'<span class="exp-dim">'+'⚡'.repeat(5-v)+'</span>';
const metrics=_ja
?[['開発速度','speed'],['スケーラビリティ','scale'],['学習容易性','learn'],['エコシステム','eco']]
:[['Dev Speed','speed'],['Scalability','scale'],['Learnability','learn'],['Ecosystem','eco']];
function scoreStack(name,stack){
let score=0;const reasons=[];
const skill=S.skill||'intermediate';
const feAns=(a.frontend||'').toLowerCase();
const beAns=(a.backend||'').toLowerCase();
const mob=(a.mobile||'').toLowerCase();
const pay=(a.payment||'').toLowerCase();
const aiAuto=(a.ai_auto||'').toLowerCase();
// 1. Skill match (0-25)
if(skill==='beginner'&&stack.learn>=4){score+=25;reasons.push(_ja?'初心者に学びやすい':'Beginner-friendly');}
else if(skill==='beginner'&&stack.learn>=3){score+=15;}
else if(skill==='intermediate'&&stack.learn>=3&&stack.eco>=4){score+=20;reasons.push(_ja?'中級者に最適なバランス':'Good balance for intermediates');}
else if(skill==='pro'&&stack.scale>=4){score+=20;reasons.push(_ja?'プロ向けスケーラビリティ':'Pro-grade scalability');}
// 2. Frontend match (0-20)
if(feAns.includes('react')&&stack.fe.includes('React')){score+=20;reasons.push(_ja?'フロントエンド一致':'Frontend match');}
else if(feAns.includes('vue')&&stack.fe.includes('Vue')){score+=20;reasons.push(_ja?'Vue選択に一致':'Vue selection match');}
else if(feAns.includes('svelte')&&stack.fe.includes('Svelte')){score+=20;reasons.push(_ja?'Svelte選択に一致':'Svelte selection match');}
// 3. Backend match (0-15)
if(beAns.includes('supabase')&&stack.be==='Supabase'){score+=15;reasons.push(_ja?'Supabase選択に一致':'Supabase match');}
else if(beAns.includes('express')&&stack.be==='Express'){score+=15;reasons.push(_ja?'Express選択に一致':'Express match');}
else if(beAns.includes('nest')&&stack.be==='NestJS'){score+=15;reasons.push(_ja?'NestJS選択に一致':'NestJS match');}
else if(beAns.includes('fastapi')&&stack.be==='FastAPI'){score+=15;reasons.push(_ja?'FastAPI選択に一致':'FastAPI match');}
// 4. Mobile (0-15)
if(mob&&mob!=='none'&&stack.tags.includes('mobile')){score+=15;reasons.push(_ja?'モバイル対応':'Mobile support');}
// 5. Payment (0-10)
if(pay&&pay!=='none'&&stack.tags.includes('stripe')){score+=10;reasons.push(_ja?'決済連携可能':'Payment integration');}
// 6. AI/Autonomous (0-10)
if(aiAuto&&aiAuto!=='none'&&stack.tags.includes('ai')){score+=10;reasons.push(_ja?'AI/ML統合に最適':'AI/ML integration fit');}
// 7. Speed bonus (always counted, 0-5)
score+=stack.speed;
return {name,score,reasons,stack};
}
/* ── Rank all stacks ── */
const ranked=names.map(n=>scoreStack(n,stacks[n])).sort((a,b)=>b.score-a.score);
const medals=['🥇','🥈','🥉'];
const hasAnswers=Object.keys(a).length>2;
let h=`<div class="exp-header"><h3>⚡ ${_ja?'並列実装探索 — スタック比較':'Parallel Explorer — Stack Comparison'}</h3>
<p>${_ja?'現在の選択':'Current'}: <strong class="exp-current">${esc(a.frontend||'React + Next.js')} + ${esc(a.backend||'Express')}</strong> — ${_ja?'2つのスタックを比較':'Compare 2 stacks'}</p></div>`;
/* ── Recommendation Ranking (NEW) ── */
if(hasAnswers){
h+=`<div class="exp-ranking"><h4>📊 ${_ja?'あなたへのおすすめ（回答に基づくスコア）':'Recommended for You (Score based on your answers)'}</h4>`;
ranked.forEach((r,i)=>{
const medal=i<3?medals[i]:'';
const isTop=i===0;
const w=Math.max(8,Math.round(r.score/ranked[0].score*100));
h+=`<div class="exp-rank-row${isTop?' exp-rank-top':''}" onclick="autoSelectStack('${r.name}')">
<div class="exp-rank-left">
<span class="exp-rank-medal">${medal||`#${i+1}`}</span>
<span class="exp-rank-name">${r.name}</span>
</div>
<div class="exp-rank-right">
<div class="exp-rank-bar"><div class="exp-rank-bar-fill" style="width:${w}%"></div></div>
<span class="exp-rank-score">${r.score}${_ja?'点':'pt'}</span>
</div>
</div>`;
if(r.reasons.length>0&&i<3){
h+=`<div class="exp-rank-reasons">${r.reasons.map(r=>`<span class="exp-rank-tag">${r}</span>`).join('')}</div>`;
}
});
h+=`</div>`;
}
/* ── Comparison selectors ── */
h+=`<div class="exp-select"><h4>${_ja?'🔀 比較':'🔀 Compare'}</h4><select id="expA" onchange="renderExpCompare()">${names.map((n,i)=>`<option value="${i}" ${n===ranked[0].name?'selected':''}>${n}</option>`).join('')}</select>`;
h+=`<select id="expB" onchange="renderExpCompare()">${names.map((n,i)=>`<option value="${i}" ${n===(ranked[1]||ranked[0]).name?'selected':''}>${n}</option>`).join('')}</select></div>`;
h+='<div id="expCompare"></div>';
body.innerHTML=h;
const rowLabels=_ja
?{fe:'フロント',be:'バック',db:'DB',deploy:'デプロイ',cost:'月額目安'}
:{fe:'Frontend',be:'Backend',db:'DB',deploy:'Deploy',cost:'Est. Cost'};
const renderComp=()=>{
const iA=parseInt($('expA').value);const iB=parseInt($('expB').value);
const sA=stacks[names[iA]];const sB=stacks[names[iB]];
let c='<div class="exp-compare">';
[['A',names[iA],sA],['B',names[iB],sB]].forEach(([label,name,s])=>{
c+=`<div class="exp-col"><h3>${label}: ${name}</h3>`;
['fe','be','db','deploy','cost'].forEach(k=>{
c+=`<div class="exp-row"><span class="label">${rowLabels[k]}</span><span class="val">${s[k]}</span></div>`;
});
c+='<div class="exp-metrics-sep">';
metrics.forEach(([label,key])=>{c+=`<div class="exp-row"><span class="label">${label}</span><span class="val">${bar(s[key])}</span></div>`;});
c+=`</div><div class="exp-verdict"><h4>${_ja?'最適用途':'Best For'}</h4><p>${s.best}</p></div></div>`;
});
c+='</div>';
const scoreA=metrics.reduce((s,m)=>s+sA[m[1]],0);const scoreB=metrics.reduce((s,m)=>s+sB[m[1]],0);
c+=`<div class="road-summary">
<strong>${_ja?'総合スコア':'Total Score'}:</strong> ${names[iA]} = ${scoreA}/20 vs ${names[iB]} = ${scoreB}/20
${scoreA>scoreB?`<br><span class="exp-win">→ ${names[iA]} ${_ja?'が総合的に優位':'wins overall'}</span>`:scoreB>scoreA?`<br><span class="exp-win">→ ${names[iB]} ${_ja?'が総合的に優位':'wins overall'}</span>`:`<br><span class="exp-tie">→ ${_ja?'ほぼ同等、用途で選択':'Nearly equal — choose by use case'}</span>`}
</div>`;
$('expCompare').innerHTML=c;
};
window.renderExpCompare=renderComp;
renderComp();
}
/* ── Auto-select stack from ranking click ── */
function autoSelectStack(name){
const sel=$('expA');if(!sel)return;
for(let i=0;i<sel.options.length;i++){
if(sel.options[i].text===name){sel.value=i;break;}
}
renderExpCompare();
$('expCompare').scrollIntoView({behavior:'smooth',block:'nearest'});
}
/* ── Pillar ⑧ AI Prompt Launcher ── */
function showAILauncher(){
pushView({pillar:7,type:'launcher',file:null});
const body=$('prevBody');const _ja=S.lang==='ja';
const files=S.files;const fKeys=Object.keys(files);
const hasFiles=fKeys.length>0;
/* ── Token estimation per folder ── */
const folders={};
fKeys.forEach(k=>{
const dir=k.includes('/')?k.split('/')[0]:'root';
if(!folders[dir])folders[dir]={files:[],chars:0,tokens:0};
folders[dir].files.push(k);
const c=files[k].length;
folders[dir].chars+=c;
folders[dir].tokens+=Math.round(c/4);
});
const totalTokens=Object.values(folders).reduce((s,f)=>s+f.tokens,0);
/* ── Prompt templates ── */
const PT=_ja?{
review:{icon:'🔍',label:'仕様レビュー',desc:'矛盾・不足・改善点を指摘',
sys:'あなたは経験豊富なテックリード兼SDDアーキテクトです。',
prompt:'以下の仕様書群を4ステップでレビューしてください:\n1. constitution.mdの使命とKPIを確認\n2. specification.mdの要件網羅性をチェック\n3. technical-plan.mdのアーキテクチャ妥当性を評価\n4. 全体の整合性と不足事項を指摘\n\n各指摘には優先度(P0=致命的/P1=重要/P2=推奨)を付与してください。',
fmt:'Markdown表:\n| # | ファイル | 指摘 | 優先度 | 推奨アクション |\n|---|---------|------|--------|----------------|\n| 1 | .spec/xxx.md | ... | P0 | ... |'},
implement:{icon:'🚀',label:'MVP実装',desc:'仕様書からMVP開発開始',
sys:'あなたはフルスタック開発者です。SDD仕様書に忠実に実装します。',
prompt:'docs/23_tasks.mdから最優先タスク(P0またはIssue #1)を1つ選んで実装してください。\n\n実装手順:\n1. 型定義を作成 (TypeScript interface/type)\n2. データアクセス層を実装 (ORM/SDK)\n3. ビジネスロジックを実装\n4. UIコンポーネントを実装\n5. Vitestユニットテストを作成\n\nconstitution.mdの設計原則に従い、technical-plan.mdのアーキテクチャに沿ってください。\n\ndocs/39_implementation_playbook.mdのドメイン別実装パターンを参照し、業種固有のベストプラクティスに従ってください。\ndocs/40_ai_dev_runbook.mdのWSCI（Write→Self-Critique→Improve）ワークフローで品質検証を実施してください。\ndocs/31_industry_playbook.mdのドメイン固有チェックリストも確認してください。',
fmt:'ファイルパス付きコードブロック:\n```typescript:path/to/file.ts\n// code\n```\n必ずテストを含めてください。'},
test:{icon:'🧪',label:'テスト生成',desc:'テストケース自動作成',
sys:'あなたはQAエンジニアです。仕様書からテストケースを網羅的に作成します。',
prompt:'docs/07_test_cases.mdを参照し、以下の順序でテストケースを生成してください:\n1. 正常系(Happy Path): 基本的なCRUD操作\n2. 異常系(Error Cases): バリデーションエラー、権限エラー\n3. 境界値(Boundary): 空文字列、最大長、NULL\n4. docs/33_test_matrix.mdのテスト優先度マトリクスで実行順序を決定\n5. docs/36_test_strategy.mdの戦略に沿って非機能テストも追加\n\n各テストケースには期待結果を明記してください。',
fmt:'Vitestテストファイル:\n```typescript:tests/xxx.test.ts\nimport { describe, it, expect } from \'vitest\';\n// tests\n```'},
refactor:{icon:'♻️',label:'リファクタ提案',desc:'構造改善と技術的負債の解消',
sys:'あなたはコードレビュアーです。アーキテクチャの改善提案を行います。',
prompt:'以下の仕様書の技術設計を分析し、リファクタリング提案をしてください。各指摘に工数見積り(S=1-2h/M=3-8h/L=1-2日)を付与してください。\n\nチェック項目:\n- SOLID原則の違反\n- 責務の分離不足(Fat Controller等)\n- スケーラビリティの問題\n- パフォーマンスボトルネック\n- 技術的負債',
fmt:'Markdown表:\n| 問題 | 違反している原則 | 改善案 | 工数 | 優先度 |\n|------|------------------|--------|------|--------|\n| ... | SRP | ... | M | P1 |'},
security:{icon:'🔒',label:'セキュリティ監査',desc:'脆弱性とベストプラクティス',
sys:'あなたはセキュリティエンジニアです。OWASP Top 10 2025を基準に監査します。',
prompt:'以下のセキュリティドキュメントを事前に確認してください:\n'+
'- docs/43_security_intelligence.md (スタック適応型チェックリスト)\n'+
'- docs/44_threat_model.md (STRIDE脅威分析)\n'+
'- docs/45_compliance_matrix.md (コンプライアンス要件)\n'+
'- docs/46_ai_security.md (AI/LLMセキュリティ)\n'+
'- docs/47_security_testing.md (テストテンプレート)\n\n'+
'仕様書のセキュリティ面をOWASP Top 10 2025の各項目別にチェックしてください:\n'+
'1. A01 – アクセス制御の不備\n2. A02 – セキュリティ設定ミス\n'+
'3. A03 – ソフトウェアサプライチェーン\n4. A04 – SSRF（入力検証・URL制限）\n'+
'5. A05 – 安全でない設計\n6. A06 – 脆弱で古いコンポーネント\n'+
'7. A07 – 識別と認証の失敗\n8. A08 – ソフトウェアとデータの整合性の不備\n'+
'9. A09 – セキュリティログと監視の不備\n10. A10 – インフラ保護（DNS Rebinding・Egress制限）\n\n'+
'docs/08_security.mdの設計と実装の乖離もチェックしてください。\n'+
'docs/53_ops_runbook.mdのA09項目（セキュリティログ・監視）との整合性も確認してください。\n'+
'各項目の状態を✅(OK)/⚠️(注意)/❌(脆弱)で評価してください。',
fmt:'Markdown表:\n| OWASP# | 項目 | 状態 | 詳細 | 推奨対策 |\n|--------|------|------|------|----------|\n| A01 | Access Control | ⚠️ | ... | ... |'},
docs:{icon:'📝',label:'ドキュメント補完',desc:'不足文書の特定と生成',
sys:'あなたはテクニカルライターです。開発ドキュメントの品質を高めます。',
prompt:'以下の仕様書群を分析し、2パート構成で出力してください:\n\n**Part 1: ギャップ分析**\n既存ドキュメントと理想状態の差分を表形式で列挙\n\n**Part 2: 最重要ドキュメント生成**\nギャップ分析で最も優先度が高いドキュメント1つを全文生成してください。\n\n候補:\n- API仕様の詳細化(OpenAPI YAML)\n- シーケンス図(Mermaid)\n- デプロイ手順書(Step-by-step)\n- エラーハンドリング設計',
fmt:'Part 1: Markdown表\nPart 2: 完全なドキュメント(Markdown)'},
debug:{icon:'🔧',label:'デバッグ支援',desc:'エラー原因分析と修正提案',
sys:'あなたは経験豊富なデバッグスペシャリストです。エラーログとスタックトレースから根本原因を特定します。',
prompt:'以下の手順でデバッグ分析を実行:\n1. docs/25_error_logs.mdの既存パターンと照合（再発or新規を判定）\n2. エラー/スタックトレースの根本原因を特定（5 Whys分析）\n3. docs/37_bug_prevention.mdのチェックリストから該当バグカテゴリを特定\n4. 修正コードと再発防止策を提案\n5. docs/25_error_logs.mdに追記するエントリをドラフト\n6. 重大度が高い場合、docs/34_incident_response.mdのインシデント対応フローに従う',
fmt:'## 診断結果\n| 項目 | 内容 |\n|------|------|\n| エラー種別 | ... |\n| 根本原因 | ... |\n| 影響範囲 | ... |\n\n## 修正コード\n```typescript:path/to/file.ts\n// fix\n```\n\n## error_logsエントリ\n- 症状/原因/解決策/防止策'},
arch:{icon:'📐',label:'アーキテクチャ整合性',desc:'設計と実装の乖離を検出',
sys:'あなたはソフトウェアアーキテクトです。仕様書のアーキテクチャと実装の整合性を検証します。',
prompt:'アーキテクチャ整合性チェック:\n1. docs/03_architecture.mdのレイヤー構造・パターン定義を確認\n2. .spec/technical-plan.mdの技術方針との一致を検証\n3. コードが定義済みレイヤー境界を違反していないか検査\n4. docs/27_sequence_diagrams.mdのシーケンスフローとの整合性を確認\n5. docs/26_design_system.mdのコンポーネント規約との整合性を確認\n6. 違反箇所に修正案とリファクタリング手順を提示',
fmt:'Markdown表:\n| # | 違反箇所 | 定義元 | 違反内容 | 深刻度 | 修正案 |\n|---|---------|--------|---------|--------|--------|\n\n## アーキテクチャ適合スコア: X/10'},
perf:{icon:'⚡',label:'パフォーマンス最適化',desc:'ボトルネック特定と改善提案',
sys:'あなたはパフォーマンスエンジニアです。非機能要件に基づきボトルネックを特定します。',
prompt:'パフォーマンス分析:\n1. .spec/constitution.mdの非機能要件（NFR）からパフォーマンス目標値を抽出\n2. docs/41_growth_intelligence.mdのパフォーマンスバジェットとCore Web Vitals目標値を確認\n3. N+1クエリ、不要な再レンダリング、バンドルサイズ問題を検出\n4. 各問題に改善前/改善後の推定値を付与\n5. 優先度順の改善ロードマップを作成\n6. docs/19_performance.mdのパフォーマンス設計パターンと照合\n7. docs/17_monitoring.mdの監視メトリクス（レイテンシ・スループット）との整合性を確認',
fmt:'## ボトルネック一覧\n| # | 箇所 | 種別 | 現状推定 | 目標値 | 改善策 | 効果 |\n|---|------|------|---------|--------|--------|------|\n\n## 改善コード例\n```typescript:path/to/file.ts\n// optimized\n```'},
api:{icon:'🔌',label:'API統合コード生成',desc:'外部API連携コードの自動生成',
sys:'あなたはインテグレーションエンジニアです。型安全なAPI統合コードを生成します。',
prompt:'API統合コード生成:\n1. docs/05_api_design.mdのエンドポイント定義と認証方式を確認\n2. docs/04_er_diagram.mdのエンティティスキーマからリクエスト/レスポンス型を定義\n3. エラーハンドリング（リトライ・タイムアウト・レート制限）を含む統合コードを生成\n4. docs/08_security.mdのセキュリティ要件に準拠した実装にする\n5. 統合テストのスケルトンを作成',
fmt:'```typescript:lib/api/client.ts\n// API client with types\n```\n```typescript:lib/api/types.ts\n// Request/Response types\n```\n```typescript:tests/api/integration.test.ts\n// Integration tests\n```'},
a11y:{icon:'♿',label:'アクセシビリティ監査',desc:'WCAG 2.1準拠チェックと修正',
sys:'あなたはアクセシビリティ専門家です。WCAG 2.1 AA基準でUIを監査します。',
prompt:'アクセシビリティ監査:\n1. docs/26_design_system.mdのデザイントークン（色コントラスト・フォントサイズ）を確認\n2. docs/06_screen_design.mdの画面一覧から主要画面のUI要素を特定\n3. WCAG 2.1 AA 4原則（知覚可能・操作可能・理解可能・堅牢）で評価\n4. 各違反に具体的なHTML/ARIA修正コードを提示\n5. docs/57_user_experience_strategy.mdのアクセシビリティ戦略・デジタルウェルビーイングセクションを参照し、UX包括性の観点で追加評価\n6. axe-coreによる自動テストコードを生成',
fmt:'## WCAG 2.1 AA 監査結果\n| # | 基準 | 画面 | 要素 | 状態 | 修正コード |\n|---|------|------|------|------|------------|\n\n## 自動テスト\n```typescript:tests/a11y.test.ts\n// axe-core tests\n```'},
migrate:{icon:'🔄',label:'マイグレーション支援',desc:'技術スタック移行計画の策定',
sys:'あなたはマイグレーションアーキテクトです。データ整合性を保ちながら段階的移行を計画します。',
prompt:'マイグレーション計画策定:\n1. .spec/technical-plan.mdから現行スタック構成を確認\n2. docs/04_er_diagram.mdからデータスキーマとリレーションを把握\n3. 移行先に合わせたスキーマ変換スクリプトとデータ検証クエリを生成\n4. ブルーグリーンまたはカナリアデプロイによるリスク最小化計画を作成\n5. ロールバック手順を各フェーズに明記',
fmt:'## マイグレーション計画\n| フェーズ | 作業内容 | 期間 | ロールバック | リスク |\n|---------|---------|------|------------|--------|\n\n## スキーマ変換\n```sql\n-- migration script\n```\n\n## データ検証\n```sql\n-- validation queries\n```'},
metrics:{icon:'📊',label:'コードメトリクス分析',desc:'複雑度・保守性の定量評価',
sys:'あなたはソフトウェアメトリクスアナリストです。コード品質を定量的に評価します。',
prompt:'コードメトリクス分析:\n1. 循環的複雑度（Cyclomatic Complexity）を関数単位で計測\n2. 認知的複雑度（Cognitive Complexity）で理解しにくい箇所を特定\n3. 結合度と凝集度を分析（依存関係の多いモジュールを検出）\n4. 重複コード率とDRY違反箇所を特定\n5. 改善ROI（効果/工数）の高い順に改善計画を提示',
fmt:'## メトリクスサマリー\n| メトリクス | 値 | 基準 | 判定 |\n|-----------|-----|------|------|\n| 平均循環的複雑度 | X | <10 | ✅/⚠️/❌ |\n\n## ホットスポット\n| ファイル | 関数 | 複雑度 | 改善案 | 工数 |\n|---------|------|--------|--------|------|'},
i18n:{icon:'🌍',label:'国際化実装',desc:'i18n対応コードの生成',
sys:'あなたは国際化エンジニアです。既存コードに最小限の変更でi18n対応を追加します。',
prompt:'国際化実装:\n1. コードからハードコードされた文字列を全て抽出\n2. 翻訳キーの命名規則を定義（scope.component.element形式）\n3. 翻訳ファイル（JSON）を日本語・英語で生成\n4. コードを翻訳関数（t()）呼び出しに置換\n5. 日付・数値・通貨のロケール対応フォーマッターを追加',
fmt:'## 抽出された文字列\n| キー | 日本語 | English |\n|------|--------|----------|\n\n```json:locales/ja.json\n{}\n```\n```json:locales/en.json\n{}\n```\n\n## 変換後コード\n```typescript:path/to/file.ts\n// i18n-ready code\n```'},
growth:{icon:'📈',label:'グロース戦略',desc:'成長ファネル・KPI・価格戦略の最適化',
sys:'あなたはグロースエンジニアです。データドリブンな成長戦略を設計します。',
prompt:'グロース分析:\n1. docs/41_growth_intelligence.mdの成長ファネルとCVRベンチマークを確認\n2. 現在のスタック構成のシナジースコアを評価\n3. ドメイン別グロース方程式に基づきボトルネックを特定\n4. 5つの成長レバーを優先度順に提案\n5. 松竹梅の3段階価格戦略を設計（行動経済学: 妥協効果・アンカリング）\n6. docs/48_industry_blueprint.mdの業界成長パターン（TAM/SAM/SOM戦略）と照合\n7. docs/50_stakeholder_strategy.mdのターゲット戦略との整合性を検証\n8. docs/56_market_positioning.mdの市場ポジショニング・競合分析をグロースファネルに統合し、差別化優位を特定',
fmt:'## ファネル分析\n| ステージ | 現状CVR | 目標CVR | 改善施策 |\n\n## 成長レバー\n| # | レバー | 期待効果 | 工数 | 優先度 |\n\n## 価格戦略\n| プラン | 価格 | 機能 | ターゲット |'},
reverse:{icon:'🎯',label:'ゴール逆算設計',desc:'目標からの逆算計画とギャップ分析',
sys:'あなたはプロジェクトストラテジストです。ゴールから逆算して計画を策定します。',
prompt:'ゴール逆算分析:\n1. docs/29_reverse_engineering.mdのゴール定義とリバースフローを確認\n2. docs/30_goal_decomposition.mdのゴールツリーとサブゴールを分析\n3. 現状と目標のギャップを定量的に評価\n4. 優先度マトリクスでマイルストーンを再編成\n5. 依存関係チェーンを検証し、クリティカルパスを特定',
fmt:'## ギャップ分析\n| 目標 | 現状 | ギャップ | 対策 | 期限 |\n\n## クリティカルパス\n```mermaid\ngantt\n```\n\n## マイルストーン\n| MS | 完了基準 | 依存 | リスク |'},
incident:{icon:'🚨',label:'インシデント対応',desc:'障害対応ランブック・ポストモーテム作成',
sys:'あなたはSREエンジニアです。インシデント対応と再発防止を専門とします。',
prompt:'インシデント対応:\n1. docs/34_incident_response.mdのインシデント対応フローを確認\n2. docs/25_error_logs.mdから関連する過去のエラーパターンを特定\n3. 影響範囲（ユーザー数・機能・データ）を評価\n4. 緊急対応手順（ロールバック・フェイルオーバー）を策定\n5. ポストモーテム（タイムライン・根本原因・改善アクション）をドラフト\n6. docs/53_ops_runbook.mdのSLO/SLI基準と照合し、SLO違反の有無を判定\n7. docs/55_ops_plane_design.mdのサーキットブレーカー設定を確認し、自動遮断の妥当性を評価',
fmt:'## 影響評価\n| 項目 | 内容 |\n| 影響範囲 | ... |\n| 深刻度 | SEV1/2/3 |\n\n## 対応手順\n1. 検知 → 2. トリアージ → 3. 対応 → 4. 復旧 → 5. 振り返り\n\n## ポストモーテム\n| タイムライン | アクション | 担当 |'},
onboard:{icon:'🎓',label:'オンボーディング',desc:'新メンバー・AIエージェント向け引き継ぎ資料',
sys:'あなたはテクニカルオンボーディングスペシャリストです。新しい開発者が最速で戦力化する資料を作成します。',
prompt:'オンボーディング資料作成:\n1. CLAUDE.mdとAI_BRIEF.mdからプロジェクト概要を要約\n2. .spec/constitution.mdの設計原則とdocs/03_architecture.mdのアーキテクチャを図解\n3. docs/42_skill_guide.mdのスキルレベル別ワークフローを整理\n4. 最初の1週間のタスクリストを.spec/tasks.mdから抽出\n5. よくある落とし穴をdocs/37_bug_prevention.mdから抽出しFAQ化\n6. .claude/rules/の5ファイル構造（spec.md, frontend.md, backend.md, test.md, ops.md）を説明\n7. docs/55_ops_plane_design.mdのDev×Ops責任マトリクスで役割分担を明記',
fmt:'## プロジェクト概要（5分で理解）\n\n## アーキテクチャ図\n```mermaid\n```\n\n## 最初の1週間\n| 日 | タスク | 参照ファイル |\n\n## FAQ\n| 質問 | 回答 |'},
cicd:{icon:'⚙️',label:'CI/CD設計',desc:'デプロイパイプラインと品質ゲートの設計',
sys:'あなたはDevOpsエンジニアです。CI/CDパイプラインと品質ゲートを設計します。',
prompt:'CI/CD Intelligence レビュー:\n1. docs/77_cicd_pipeline_design.mdの9ステージパイプライン設計を確認し、プロジェクト固有の改善点を指摘\n2. docs/78_deployment_strategy.mdの推奨デプロイ戦略（blue-green/canary等）の妥当性を評価\n3. docs/79_quality_gate_matrix.mdの品質ゲート閾値（カバレッジ・パフォーマンス予算）をレビュー\n4. docs/80_release_engineering.mdのブランチモデル・セマンティックバージョニング・Renovate設定を確認\n5. docs/53_ops_runbook.mdのSLO品質ゲート（エラー率・レイテンシ閾値）との整合性を確認\n6. docs/54_ops_checklist.mdの運用準備チェックリストをリリースゲートに統合\n7. 不足している品質ゲートや最適化余地を特定し、優先度付きで提示',
fmt:'## パイプライン設計\n```mermaid\nflowchart LR\n```\n\n## 品質ゲートレビュー\n| ステージ | チェック項目 | 閾値 | 現状 | 改善案 |\n\n## GitHub Actions\n```yaml\n# .github/workflows/ci-cd.yml\n```'},
ops:{icon:'🛡️',label:'Ops準備レビュー',desc:'SLO検証・Feature Flag・サーキットブレーカー設定監査',
sys:'あなたはSRE/Platform Engineerです。運用準備の妥当性を検証します。',
prompt:'Ops準備レビュー:\n1. docs/53_ops_runbook.mdのSLO/SLI定義がドメイン要件に適合しているか検証\n2. Feature Flagの網羅性チェック（課金・通知・外部API等の重要機能に対するキルスイッチ）\n3. docs/55_ops_plane_design.mdのサーキットブレーカー閾値（エラー率・タイムアウト）の妥当性を評価\n4. docs/54_ops_checklist.mdの12 Ops Capabilities（Observability, Jobs, Backup等）の実装状況を検証\n5. RPO/RTOが業界基準（Fintech: RPO<5分/RTO<15分等）に適合しているか照合\n6. docs/17_monitoring.mdの監視体制とObservability整合性をチェック\n7. Ops Readiness スコア（12項目）を算出し、不足項目を抽出',
fmt:'## Ops Readiness スコア\n| Capability | 状態 | 妥当性 | 改善アクション |\n|------------|------|--------|----------------|\n| SLO定義 | ✅/⚠️/❌ | 99.9%(要件: 99.99%) | ... |\n\n## SLO妥当性評価\n| SLI | 現在設定 | ドメイン推奨 | 判定 |\n\n## 改善ロードマップ\n| 優先度 | 項目 | 期限 | 担当 |'},
strategy:{icon:'🏢',label:'戦略インテリジェンス',desc:'業界ブループリント・テックレーダー・ステークホルダー戦略',
sys:'あなたはProduct Strategist/Business Analystです。事業戦略の整合性を検証します。',
prompt:'戦略インテリジェンス分析:\n1. docs/48_industry_blueprint.mdの業界ブループリントとの適合度を検証（TAM/SAM/SOM戦略、規制遵守）\n2. docs/49_tech_radar.mdのテックレーダー評価（Adopt/Trial/Assess/Hold）と技術選定の整合性をチェック\n3. docs/50_stakeholder_strategy.mdのステークホルダー戦略（ターゲット・KPI・成長指標）との乖離を検出\n4. docs/51_operational_excellence.mdの運用成熟度ギャップ分析（現状Lv1→目標Lv3等）\n5. docs/52_advanced_scenarios.mdのロードマップから短期アクション（3ヶ月以内）を抽出\n6. docs/41_growth_intelligence.mdの成長方程式とビジネスモデルの整合性を評価\n7. docs/56_market_positioning.mdのMOAT分析・GTM戦略・ユニットエコノミクスを戦略スコアカードに統合\n8. docs/58_ecosystem_strategy.mdのエコシステム戦略・API-as-Product・DX評価を戦略に統合\n9. 戦略スコアカード（5軸評価）を作成し、優先改善領域を提示',
fmt:'## 戦略スコアカード\n| 軸 | スコア(1-5) | 評価 | ギャップ |\n|-----|------------|------|----------|\n| 業界適合 | X/5 | ... | ... |\n| 技術選定 | X/5 | ... | ... |\n\n## テックレーダー評価\n| 技術 | 現状採用判断 | Radar推奨 | 乖離理由 |\n\n## 短期アクションプラン（3ヶ月）\n| # | アクション | KPI | 担当 | 期限 |'},
risk:{icon:'⚖️',label:'リスク・コンプライアンス',desc:'4軸リスク再評価・STRIDE残存リスク・コンプライアンス充足',
sys:'あなたはRisk Analyst/Compliance Officerです。リスクとコンプライアンスを統合評価します。',
prompt:'リスク・コンプライアンス分析:\n1. docs/14_risks.mdの4軸リスク（技術・組織・法務・運用）を再評価し、現在の緩和策の有効性を検証\n2. docs/45_compliance_matrix.mdのコンプライアンス充足度（GDPR, PCI-DSS等）をチェック\n3. docs/44_threat_model.mdのSTRIDE脅威分析から残存リスクTOP5を抽出\n4. docs/53_ops_runbook.mdのSLO運用リスク（SLO未達ペナルティ・エスカレーション体制）を評価\n5. リスクヒートマップ（発生確率×影響度）を作成し、P0リスクを特定\n6. コンプライアンス自動監査（Terraform Sentinel/OPA等）の導入状況を確認\n7. docs/59_regulatory_foresight.mdの規制対応（EU AI Act・ESGメトリクス・2026-2030展望）をリスク再評価に統合\n8. リスク緩和策TOP5を優先度順に提示（技術的対策・プロセス改善・保険等）',
fmt:'## リスクヒートマップ\n| リスク | 確率 | 影響度 | スコア | 緩和策 | 状態 |\n|--------|------|--------|--------|--------|------|\n| ... | H/M/L | H/M/L | X | ... | ✅/⚠️/❌ |\n\n## コンプライアンス充足度\n| 規制 | 要求項目数 | 充足数 | 充足率 | 未対応項目 |\n\n## 残存リスクTOP5\n| # | リスク | STRIDE分類 | 現状緩和策 | 推奨追加対策 | 工数 |'},
qa:{icon:'🐛',label:_ja?'QA・バグ検出':'QA & Bug Detection',desc:_ja?'ドメイン別バグパターンとQA戦略を基にテスト計画を生成':'Generate test plan based on domain-specific bug patterns and QA strategy',
sys:_ja?'あなたはQAエンジニアです。docs/28_qa_strategy.mdのドメイン別バグパターンを参照し、具体的なテストシナリオを設計してください。':'You are a QA engineer. Reference docs/28_qa_strategy.md domain-specific bug patterns to design concrete test scenarios.',
prompt:_ja?'以下の手順で実行:\n1. docs/28_qa_strategy.mdの重点領域を確認\n2. 各重点領域に対し具体的テストケースを3つ以上作成\n3. docs/32_qa_blueprint.mdの品質ゲートチェックリストと照合\n4. docs/33_test_matrix.mdのマトリクスに基づきカバレッジを検証\n5. よくあるバグパターンに対する回帰テストを設計\n6. 業界横断チェックリストの該当項目を検証\n7. 優先度マトリクスに基づきテスト実行順序を決定':'Follow these steps:\n1. Review focus areas from docs/28_qa_strategy.md\n2. Create 3+ concrete test cases per focus area\n3. Cross-reference with docs/32_qa_blueprint.md quality gate checklist\n4. Verify coverage against docs/33_test_matrix.md matrix\n5. Design regression tests for common bug patterns\n6. Verify applicable cross-cutting checklist items\n7. Determine test execution order based on priority matrix',
fmt:_ja?'Markdown表形式: テストID|カテゴリ|シナリオ|期待結果|優先度(CRITICAL/HIGH/MED/LOW)':'Markdown table: TestID|Category|Scenario|Expected Result|Priority(CRITICAL/HIGH/MED/LOW)'},
methodology:{icon:'🧬',label:_ja?'ドメイン最適手法':'Optimal Methodology',desc:_ja?'docs/60参照し最適設計アプローチを深堀り':'Deep-dive optimal design approach from docs/60',
sys:_ja?'あなたは経験豊富な設計アーキテクトです。docs/60_methodology_intelligence.mdの選定手法を基に、具体的な実装戦略を提案してください。':'You are an experienced design architect. Propose concrete implementation strategy based on selected methodology from docs/60_methodology_intelligence.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/60_methodology_intelligence.mdの第一選択・第二選択手法を確認\n2. 各手法のキーワードに基づく具体的な実装パターンを3つ以上提案\n3. 12設計アプローチの適合度評価を参照し、優先度マトリクスを作成\n4. 組み合わせシナジーを技術的に実現する方法を提案\n5. フェーズ別実装計画（Phase 1: 基盤→Phase 2: 拡張→Phase 3: 最適化）の詳細化':'Follow these steps:\n1. Review primary/secondary approaches from docs/60_methodology_intelligence.md\n2. Propose 3+ concrete implementation patterns based on each approach keywords\n3. Create priority matrix referencing 12 design approaches fit evaluation\n4. Propose technical methods to realize combination synergies\n5. Detail phased implementation plan (Phase 1: Foundation→Phase 2: Expansion→Phase 3: Optimization)',
fmt:_ja?'Markdown表形式: フェーズ|手法|実装パターン|期待効果|工数(S/M/L)':'Markdown table: Phase|Approach|Implementation Pattern|Expected Effect|Effort(S/M/L)'},
brainstorm:{icon:'🎭',label:_ja?'9人の専門家ブレスト':'9-Expert Brainstorm',desc:_ja?'創造工学の9視点で固定観念を突破':'Break fixed ideas with 9 creative perspectives',
sys:_ja?'あなたは9人の専門家が同居する創造的思考システムです。各専門家の個性を維持しながら、プロジェクトに関する多角的なアイデアを生成します。\n\n専門家チーム:\n①🎨クリエイティブ(美・物語・体験重視)\n②⚙️技術専門家(実現可能性・最適化重視)\n③📊ビジネス(収益・市場・競争優位重視)\n④📚学術研究者(エビデンス・理論・先行研究重視)\n⑤🔬科学者(仮説検証・データ・測定重視)\n⑥👤ユーザー代表(使いやすさ・感情・日常動線重視)\n⑦💥ディスラプター(既成概念破壊・逆張り重視)\n⑧😄ユーモリスト(楽しさ・驚き・記憶に残る体験重視)\n⑨🧭冒険家(大胆さ・リスクテイク・未踏領域重視)':'You are a creative thinking system where 9 experts coexist. Generate multi-perspective ideas while maintaining each expert\'s personality.\n\nExpert Team:\n①🎨Creative (aesthetics, storytelling, experience)\n②⚙️Technical (feasibility, optimization)\n③📊Business (revenue, market, competitive advantage)\n④📚Academic (evidence, theory, prior research)\n⑤🔬Scientist (hypothesis testing, data, measurement)\n⑥👤User Rep (usability, emotions, daily workflows)\n⑦💥Disruptor (challenging norms, contrarian thinking)\n⑧😄Humorist (fun, surprise, memorable experiences)\n⑨🧭Adventurer (boldness, risk-taking, unexplored territory)',
prompt:_ja?'以下のプロジェクトについて、9人の専門家が順番にアイデアを1つずつ提案してください。\n\n【フォーマット】各専門家ごとに:\n- アイデア名（10文字以内）\n- 提案内容（3文）\n\n全員の提案後、3軸評価マトリクスを作成:\n| アイデア | 魅力度(1-5) | 実現可能性(1-5) | 妥当性(1-5) | 総合 |\n\n最後に「クロスポリネーション」として、異なる専門家のアイデアを組み合わせた「最強のハイブリッド案」を1つ提案。':'For the following project, each of the 9 experts proposes one idea in sequence.\n\n【Format】For each expert:\n- Idea name (10 words max)\n- Proposal (3 sentences)\n\nAfter all proposals, create a 3-axis evaluation matrix:\n| Idea | Appeal(1-5) | Feasibility(1-5) | Validity(1-5) | Total |\n\nFinally propose one "Cross-Pollination" hybrid idea combining concepts from different experts.',
fmt:_ja?'## 9専門家アイデア\n| 専門家 | アイデア名 | 提案内容 |\n\n## 3軸評価マトリクス\n| アイデア | 魅力度 | 実現可能性 | 妥当性 | 総合 |\n\n## クロスポリネーション案\n**組み合わせ**: 専門家X×専門家Y\n**ハイブリッドアイデア**: ...':'## 9-Expert Ideas\n| Expert | Idea Name | Proposal |\n\n## 3-Axis Evaluation Matrix\n| Idea | Appeal | Feasibility | Validity | Total |\n\n## Cross-Pollination Proposal\n**Combination**: Expert X × Expert Y\n**Hybrid Idea**: ...'},
ux_journey:{icon:'🎯',label:_ja?'UXジャーニー設計':'UX Journey Design',desc:_ja?'Lv.0-5段階的開示でアプリのUXを設計':'Design app UX with Lv.0-5 progressive disclosure',
sys:_ja?'あなたはUXデザイン専門家です。段階的開示・認知負荷管理・ペインポイントストーリーテリングの3つの視点でユーザージャーニーを設計します。':'You are a UX design expert. Design user journeys from 3 perspectives: progressive disclosure, cognitive load management, and pain point storytelling.',
prompt:_ja?'以下のプロジェクトのターゲットアプリについて、Lv.0（完全初心者）からLv.5（エキスパート）までの6段階ユーザージャーニーを設計してください:\n\n各Lvで:\n①ペルソナ（年齢・職業・ITリテラシー）\n②つまずきポイント（具体的な操作ミス・混乱箇所）\n③必要なUXパターン（オンボーディング/ツールチップ/段階的開示等）\n④離脱リスク（何があると諦めるか）\n⑤改善アクション（具体的UI変更案）\n\n次に「3つの悪夢」を特定:\n- 悪夢①: ユーザーが最も恐れる失敗体験\n- 悪夢②: 二番目に怖い体験\n- 悪夢③: 三番目に怖い体験\n\n各悪夢に対し、それを防ぐUI設計を提案してください。':'Design a 6-level user journey (Lv.0=complete beginner to Lv.5=expert) for this project:\n\nFor each Lv:\n①Persona (age, occupation, IT literacy)\n②Stumbling points (specific mistakes, confusion areas)\n③Required UX patterns (onboarding/tooltip/progressive disclosure etc.)\n④Churn risk (what makes users give up)\n⑤Improvement action (specific UI change)\n\nThen identify "3 Nightmares":\n- Nightmare①: The failure experience users fear most\n- Nightmare②: Second most feared\n- Nightmare③: Third most feared\n\nPropose UI designs that prevent each nightmare.',
fmt:_ja?'## Lv別ジャーニーマップ\n| Lv | ペルソナ | つまずき | UXパターン | 離脱リスク | 改善アクション |\n\n## 3つの悪夢分析\n| 悪夢 | 体験 | 防ぐUI設計 |\n\n## Mermaid Journey図\n```mermaid\njourney\n  title ユーザージャーニー\n```':'## Lv-by-Lv Journey Map\n| Lv | Persona | Stumbling | UX Pattern | Churn Risk | Improvement |\n\n## 3 Nightmares Analysis\n| Nightmare | Experience | Preventive UI Design |\n\n## Mermaid Journey Diagram\n```mermaid\njourney\n  title User Journey\n```'},
ai_model_guide:{icon:'🤖',label:_ja?'AIモデル使い分け':'AI Model Selection',desc:_ja?'開発フェーズ別に最適AIモデルを選定':'Select optimal AI model per dev phase',
sys:_ja?'あなたはAIモデル活用の専門家です。各AIモデルの「個性」（Gemini=正確性・広い知識、Claude=倫理・洗練、ChatGPT=創造性・自由度、Copilot=バランス・コード補完）を深く理解し、タスク適性を分析します。':'You are an AI model utilization expert. You deeply understand each AI model\'s "personality" (Gemini=accuracy & broad knowledge, Claude=ethics & refinement, ChatGPT=creativity & freedom, Copilot=balance & code completion) and analyze task suitability.',
prompt:_ja?'以下のプロジェクトの各開発フェーズで最適なAIモデルを提案してください:\n\nフェーズ: ①設計・アーキテクチャ ②実装・コーディング ③テスト・QA ④コードレビュー ⑤デプロイ・Ops\n\n各フェーズで:\n1. 推奨モデル（第一/第二候補）\n2. 選定理由（そのモデルの個性がなぜこのフェーズに合うか）\n3. ナチュラルプロンプト例（「ハンマー型」—使う道具の特性を活かした指示）\n4. 避けるべきアンチパターン（そのモデルが苦手なこと）\n\n最後に「AIモデル切替タイミング」ガイドを作成。':'Propose the optimal AI model for each development phase of this project:\n\nPhases: ①Design/Architecture ②Implementation/Coding ③Testing/QA ④Code Review ⑤Deploy/Ops\n\nFor each phase:\n1. Recommended model (primary/secondary)\n2. Selection reason (why this model\'s personality fits this phase)\n3. Natural prompt example ("hammer type" — instructions that leverage the tool\'s strengths)\n4. Anti-patterns to avoid (what this model struggles with)\n\nFinally create an "AI Model Switching Timing" guide.',
fmt:_ja?'## フェーズ別AIモデル推奨\n| フェーズ | 推奨AI | 理由 | ナチュラルプロンプト例 | アンチパターン |\n\n## AIモデル個性マップ\n| モデル | 強み | 弱み | 最適ユースケース |\n\n## 切替タイミングガイド\n- 設計→実装: ...\n- 実装→レビュー: ...':'## AI Model Recommendations by Phase\n| Phase | Recommended AI | Reason | Natural Prompt Example | Anti-patterns |\n\n## AI Model Personality Map\n| Model | Strengths | Weaknesses | Best Use Case |\n\n## Switching Timing Guide\n- Design→Impl: ...\n- Impl→Review: ...'},
industry:{icon:'🏭',label:_ja?'業界特化分析':'Industry Deep Dive',desc:_ja?'docs/62で規制・落とし穴を検証':'Verify regulations & pitfalls from docs/62',
sys:_ja?'あなたは業界コンプライアンス専門家です。docs/62_industry_deep_dive.mdの業界特有の落とし穴とアーキテクチャパターンを基に、リスク分析を実施してください。':'You are an industry compliance expert. Conduct risk analysis based on industry-specific pitfalls and architecture patterns from docs/62_industry_deep_dive.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/62_industry_deep_dive.mdの主要規制リストを確認し、現在の技術スタックでの準拠状況を評価\n2. 業界特有の落とし穴一覧から、このプロジェクトで該当する項目をピックアップ\n3. 各落とし穴に対する対策の実装状況を検証（✅実装済/⚠️部分的/❌未実装）\n4. docs/45_compliance_matrix.mdのコンプライアンスマトリクスと照合し、ギャップを特定\n5. 推奨アーキテクチャパターン（認証レイヤー、暗号化ストレージ、監査ログ）の実装計画を策定':'Follow these steps:\n1. Review key regulations from docs/62_industry_deep_dive.md and assess compliance status with current tech stack\n2. Pick applicable items from industry-specific pitfalls list\n3. Verify implementation status of countermeasures for each pitfall (✅Implemented/⚠️Partial/❌Not implemented)\n4. Cross-reference with docs/45_compliance_matrix.md compliance matrix to identify gaps\n5. Develop implementation plan for recommended architecture patterns (auth layer, encrypted storage, audit log)',
fmt:_ja?'## 規制準拠状況\n| 規制 | 要求事項 | 実装状況 | ギャップ | 対策優先度 |\n\n## 落とし穴チェック\n| # | 落とし穴 | 該当性 | 対策状況 | 実装計画 |\n\n## アーキテクチャ改善提案\n```mermaid\ngraph LR\n```':'## Regulatory Compliance\n| Regulation | Requirements | Status | Gap | Priority |\n\n## Pitfall Check\n| # | Pitfall | Applicability | Status | Plan |\n\n## Architecture Improvement\n```mermaid\ngraph LR\n```'},
nextgen:{icon:'🔮',label:_ja?'次世代UX探索':'Next-Gen UX',desc:_ja?'docs/63でAgentic/Spatial/Calm設計':'Agentic/Spatial/Calm design from docs/63',
sys:_ja?'あなたは次世代UX設計のスペシャリストです。docs/63_next_gen_ux_strategy.mdのPolymorphic Engineコンセプトを基に、革新的なUX提案を行ってください。':'You are a next-gen UX design specialist. Propose innovative UX based on Polymorphic Engine concept from docs/63_next_gen_ux_strategy.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/63_next_gen_ux_strategy.mdのThe Context Loop（Sensing→Thinking→Morphing→Acting）フレームワークを確認\n2. 4つの次世代UXキーワード（Agentic Workflow、Generative UI、Spatial Computing、Calm Technology）のプロジェクト適用プロンプトを選択\n3. 選択したキーワードを主要機能（例: ダッシュボード、検索、予約）に適用した具体的なUI設計案を3つ以上提案\n4. ドメイン特化適用例を参照し、業種固有のベストプラクティスを反映\n5. 各提案の実装難易度（S/M/L）、期待UX改善効果、技術的実現可能性を評価':'Follow these steps:\n1. Review The Context Loop (Sensing→Thinking→Morphing→Acting) framework from docs/63_next_gen_ux_strategy.md\n2. Select project application prompts for 4 next-gen UX keywords (Agentic Workflow, Generative UI, Spatial Computing, Calm Technology)\n3. Propose 3+ concrete UI design proposals applying selected keywords to main features (e.g., dashboard, search, booking)\n4. Reference domain-specific application examples and reflect industry-specific best practices\n5. Evaluate implementation difficulty (S/M/L), expected UX improvement effect, and technical feasibility for each proposal',
fmt:_ja?'## UX提案\n| # | キーワード | 適用機能 | 具体的設計 | 難易度 | 効果 | 実現可能性 |\n\n## Polymorphic Engineフロー\n```mermaid\ngraph LR\n  Sensing --> Thinking --> Morphing --> Acting\n```\n\n## 実装ロードマップ\n| Phase | 機能 | キーワード | 期待効果 | 工数 |':'## UX Proposals\n| # | Keyword | Feature | Design | Difficulty | Effect | Feasibility |\n\n## Polymorphic Engine Flow\n```mermaid\ngraph LR\n  Sensing --> Thinking --> Morphing --> Acting\n```\n\n## Implementation Roadmap\n| Phase | Feature | Keyword | Effect | Effort |'},
cognitive:{icon:'🧠',label:_ja?'認知負荷分析':'Cognitive Load Analysis',desc:_ja?'docs/60で認知負荷とフロー状態を設計':'Cognitive load & flow state design from docs/60',
sys:_ja?'あなたは認知科学とUXの専門家です。docs/60_methodology_intelligence.mdの認知負荷最小化・フロー状態設計の観点から、UI/UX改善を提案してください。':'You are a cognitive science and UX expert. Propose UI/UX improvements from cognitive load minimization and flow state design perspectives in docs/60_methodology_intelligence.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/60_methodology_intelligence.mdの12設計アプローチ適合度評価から、「認知負荷最小化」「フロー状態設計」の適合度を確認\n2. 主要画面（ダッシュボード、一覧、詳細、フォーム）ごとに認知負荷を分析（情報量、選択肢数、階層深度）\n3. フロー状態を阻害する要素（中断、待機時間、複雑な操作）を特定\n4. 認知負荷削減策（プログレッシブ開示、デフォルト値、スマート検索）を提案\n5. フロー状態維持策（キーボードショートカット、オートセーブ、コンテキスト保持）を提案\n6. docs/26_design_system.mdのデザインシステムとの整合性を検証':'Follow these steps:\n1. Check fit for "Cognitive Load Min." and "Flow State Design" from 12 design approaches evaluation in docs/60_methodology_intelligence.md\n2. Analyze cognitive load for each main screen (dashboard, list, detail, form): info volume, choice count, hierarchy depth\n3. Identify flow state inhibitors (interruptions, wait time, complex operations)\n4. Propose cognitive load reduction measures (progressive disclosure, default values, smart search)\n5. Propose flow state maintenance measures (keyboard shortcuts, auto-save, context preservation)\n6. Verify consistency with design system in docs/26_design_system.md',
fmt:_ja?'## 認知負荷分析\n| 画面 | 情報量 | 選択肢数 | 階層深度 | 認知負荷スコア(1-10) | 改善案 |\n\n## フロー状態阻害要因\n| # | 要因 | 影響度 | 削減策 | 期待効果 |\n\n## 改善ロードマップ\n| 優先度 | 施策 | 対象画面 | 工数 | 効果 |':'## Cognitive Load Analysis\n| Screen | Info Volume | Choices | Depth | Load Score(1-10) | Improvement |\n\n## Flow State Inhibitors\n| # | Inhibitor | Impact | Reduction | Effect |\n\n## Improvement Roadmap\n| Priority | Measure | Target Screen | Effort | Effect |'},
genome:{icon:'🧩',label:_ja?'プロンプトゲノム分析':'Prompt Genome Analysis',desc:_ja?'docs/65でCRITERIA 8軸プロンプト品質を最適化':'Optimize prompt quality with CRITERIA 8-axis from docs/65',
sys:_ja?'あなたはプロンプトエンジニアリングの専門家です。docs/65_prompt_genome.mdのCRITERIA 8軸フレームワーク（Context/Role/Instructions/Thought Process/Execution Rules/Reflection/Iteration/Adaptation）を基に、プロンプト品質の分析と改善提案を行います。':'You are a prompt engineering expert. Analyze prompt quality and provide improvement proposals based on the CRITERIA 8-axis framework (Context/Role/Instructions/Thought Process/Execution Rules/Reflection/Iteration/Adaptation) from docs/65_prompt_genome.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/65_prompt_genome.mdのプロンプトDNAプロファイル（ドメイン・アプローチ・成熟度レベル）を確認\n2. 現在使用しているプロンプトをCRITERIA 8軸で評価（各軸1-5点、加重スコアを算出）\n3. スコアが低い軸（3点以下）の改善案を具体的に提案\n4. フェーズ別プロンプトライブラリから最適なテンプレートを選択\n5. 成熟度レベル（Level 1/2/3）に適した適応バリアントを提案\n6. docs/67_prompt_composition_guide.mdの4層アーキテクチャ（Meta/Structure/Content/Adaptation）を適用した複合プロンプトを設計':'Follow these steps:\n1. Review Prompt DNA profile (domain, approach, maturity level) from docs/65_prompt_genome.md\n2. Evaluate current prompts on CRITERIA 8 axes (1-5 points each, calculate weighted score)\n3. Propose specific improvements for low-scoring axes (3 points or below)\n4. Select optimal templates from phase-by-phase prompt library\n5. Propose maturity-level-appropriate variants (Level 1/2/3)\n6. Design composite prompts applying 4-layer architecture (Meta/Structure/Content/Adaptation) from docs/67_prompt_composition_guide.md',
fmt:_ja?'## CRITERIA評価\n| 軸 | 重み | 現スコア | 目標 | 改善案 |\n|-----|------|---------|------|--------|\n| Context | 15% | ? | 5 | ... |\n\n**加重総スコア**: ? / 5\n\n## 改善後プロンプト\n```\n[CRITERIA準拠の改善プロンプト]\n```\n\n## 4層設計\n| Layer | 内容 |\n|-------|------|\n| Meta | ... |\n| Structure | ... |\n| Content | ... |\n| Adaptation | ... |':'## CRITERIA Evaluation\n| Axis | Weight | Current | Target | Improvement |\n|------|--------|---------|--------|-------------|\n| Context | 15% | ? | 5 | ... |\n\n**Weighted Total Score**: ? / 5\n\n## Improved Prompt\n```\n[CRITERIA-compliant improved prompt]\n```\n\n## 4-Layer Design\n| Layer | Content |\n|-------|--------|\n| Meta | ... |\n| Structure | ... |\n| Content | ... |\n| Adaptation | ... |'},
react_debug:{icon:'🔄',label:_ja?'ReActデバッグ':'ReAct Debug Loop',desc:_ja?'Reason→Act→Observe→Verifyの自律デバッグサイクル':'Autonomous debug cycle with Reason→Act→Observe→Verify',
sys:_ja?'あなたはReActプロトコルの専門家です。docs/70_react_workflow.mdのReAct 4ステージ（Reason→Act→Observe→Verify）と自己デバッグループを用いて、問題を自律的に診断・修正します。':'You are a ReAct protocol expert. Diagnose and fix problems autonomously using the 4-stage ReAct cycle (Reason→Act→Observe→Verify) and self-debug loop from docs/70_react_workflow.md.',
prompt:_ja?'以下のReActサイクルで問題を解決してください:\n\n**Reason (思考)**: 現在のエラー・バグ・問題を分析。根本原因の仮説を3つ列挙。\n\n**Act (実行)**: 最も可能性が高い仮説を検証するアクションを実行。docs/70_react_workflow.mdのフェーズ別ツール選定を参照。\n\n**Observe (観察)**: アクション結果を客観的に記録。期待と実際の差異を特定。\n\n**Verify (検証)**: 問題が解決されたか成功基準（型安全・テスト通過・lint通過）で確認。\n\n失敗の場合は自己デバッグループ（最大3反復）を実施。3回失敗したら人間へエスカレーション。':'Resolve the problem using the following ReAct cycle:\n\n**Reason**: Analyze current error/bug/problem. List 3 root cause hypotheses.\n\n**Act**: Execute action to test most likely hypothesis. Reference phase-specific tool selection from docs/70_react_workflow.md.\n\n**Observe**: Objectively record action results. Identify gaps between expected and actual.\n\n**Verify**: Confirm problem resolved against success criteria (type safety, tests pass, lint pass).\n\nIf failed, run self-debug loop (max 3 iterations). Escalate to human after 3 failures.',
fmt:_ja?'## Reason\n**根本原因仮説:**\n1. ...\n2. ...\n3. ...\n\n## Act\n**実行:** `{tool} {args}`\n\n## Observe\n**結果:** ...\n**期待との差異:** ...\n\n## Verify\n**成功基準達成:** [ ] 型安全 [ ] テスト通過 [ ] lint通過\n**次のアクション:** ...\n\n---\n_iter 1/3 — 解決 / 未解決 → 次反復_':'## Reason\n**Root Cause Hypotheses:**\n1. ...\n2. ...\n3. ...\n\n## Act\n**Execute:** `{tool} {args}`\n\n## Observe\n**Result:** ...\n**Gap from expected:** ...\n\n## Verify\n**Success criteria met:** [ ] Type safe [ ] Tests pass [ ] Lint pass\n**Next action:** ...\n\n---\n_iter 1/3 — Resolved / Unresolved → next iteration_'},
prompt_ops:{icon:'🔧',label:_ja?'プロンプトOpsレビュー':'Prompt Ops Review',desc:_ja?'プロンプト品質をCRITERIA基準で評価・改善提案':'Evaluate prompt quality against CRITERIA and suggest improvements',
sys:_ja?'あなたはLLMOpsとプロンプトCI/CDの専門家です。docs/69_prompt_ops_pipeline.md（ライフサイクル管理）、docs/71_llmops_dashboard.md（メトリクス）、docs/72_prompt_registry.md（テンプレートカタログ）を参照し、プロンプトの運用品質を総合評価します。':'You are an LLMOps and Prompt CI/CD expert. Comprehensively evaluate prompt operational quality by referencing docs/69_prompt_ops_pipeline.md (lifecycle management), docs/71_llmops_dashboard.md (metrics), and docs/72_prompt_registry.md (template catalog).',
prompt:_ja?'以下の手順でプロンプトの運用品質を評価・改善してください:\n\n1. **ライフサイクルチェック** (docs/69): 対象プロンプトが5ステージ（起草→レビュー→テスト→デプロイ→監視）のどこにあるかを特定。現ステージのチェックリストを評価。\n\n2. **LLMOpsメトリクス評価** (docs/71): 現在のAI成熟度レベルに対応するスタックのメトリクス（成功率・コスト・レイテンシ）を確認し、閾値との差異を計算。\n\n3. **CRITERIA連携スコアリング** (docs/65 + docs/71): CRITERIA 8軸の現スコアをLLMOpsメトリクスにマッピング。スコアが低い軸（3以下）の改善案を提示。\n\n4. **Registryへの登録提案** (docs/72): Template-ID命名規則に従い、バージョン番号・CRITERIA目標スコアをドラフト。\n\n5. **A/Bテスト計画**: 改善後バージョンとの比較計画を作成（メトリクス定義・有意差基準）。':'Evaluate and improve prompt operational quality following these steps:\n\n1. **Lifecycle check** (docs/69): Identify which of 5 stages (Draft→Review→Test→Deploy→Monitor) the target prompt is in. Evaluate current stage checklist.\n\n2. **LLMOps metrics evaluation** (docs/71): Review stack metrics for current AI maturity level (success rate, cost, latency) and calculate gap from thresholds.\n\n3. **CRITERIA-integrated scoring** (docs/65 + docs/71): Map CRITERIA 8-axis current scores to LLMOps metrics. Present improvements for low-scoring axes (3 or below).\n\n4. **Registry registration proposal** (docs/72): Draft Template-ID following naming convention with version number and CRITERIA target scores.\n\n5. **A/B test plan**: Create comparison plan for improved version (metric definitions, significance thresholds).',
fmt:_ja?'## ライフサイクル状況\n現ステージ: {Draft/Review/Test/Deploy/Monitor}\n未達チェック: [ ] ...\n\n## LLMOpsメトリクス\n| メトリクス | 現在値 | 閾値 | 評価 |\n|-----------|--------|------|------|\n\n## CRITERIA改善提案\n| 軸 | 現スコア | 目標 | 改善案 |\n\n## Template-ID案\n`{DOMAIN}-{PHASE}-{USECASE}-v{X}.{Y}.{Z}`\n\n## A/Bテスト計画\n- 検証メトリクス: ...\n- 有意差基準: CRITERIA改善率 ≥10%':'## Lifecycle Status\nCurrent stage: {Draft/Review/Test/Deploy/Monitor}\nFailing checks: [ ] ...\n\n## LLMOps Metrics\n| Metric | Current | Threshold | Status |\n|--------|---------|-----------|--------|\n\n## CRITERIA Improvement Proposals\n| Axis | Current | Target | Improvement |\n\n## Template-ID Proposal\n`{DOMAIN}-{PHASE}-{USECASE}-v{X}.{Y}.{Z}`\n\n## A/B Test Plan\n- Validation metric: ...\n- Significance threshold: CRITERIA improvement ≥10%'},
maturity:{icon:'📊',label:_ja?'AI成熟度レビュー':'AI Maturity Review',desc:_ja?'docs/66でチームAI成熟度を評価し次のレベルへ':'Assess team AI maturity and level up from docs/66',
sys:_ja?'あなたは組織のAI採用・成熟度向上のコンサルタントです。docs/66_ai_maturity_assessment.mdの5次元評価マトリクスを基に、現在のAI成熟度を診断し、次のレベルへの移行計画を策定します。':'You are a consultant for organizational AI adoption and maturity improvement. Diagnose current AI maturity and develop a transition plan to the next level based on the 5-dimension evaluation matrix from docs/66_ai_maturity_assessment.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/66_ai_maturity_assessment.mdの現在の成熟度レベル（Level 1/2/3）と特徴を確認\n2. 5次元評価マトリクス（プロンプト設計力・AI協調力・品質保証・チームプラクティス・効果測定）で現在のチーム状況を自己評価（各次元1-3点）\n3. 各次元のギャップ分析（現状 vs 目標レベル）を実施\n4. 段階的採用ロードマップ（フェーズ1→2→3）の現在地を特定\n5. 次レベルへの最優先アクション3つを提案（工数・効果・リスクを評価）\n6. docs/68_prompt_kpi_dashboard.mdのKPI指標と照合し、測定可能な成功基準を設定':'Follow these steps:\n1. Review current maturity level (Level 1/2/3) and characteristics from docs/66_ai_maturity_assessment.md\n2. Self-assess current team status on 5-dimension evaluation matrix (prompt design, AI collaboration, QA, team practices, measurement): 1-3 points each\n3. Conduct gap analysis for each dimension (current vs target level)\n4. Identify current position in phased adoption roadmap (Phase 1→2→3)\n5. Propose top 3 priority actions for next level (evaluate effort, effect, and risk)\n6. Set measurable success criteria by cross-referencing KPI metrics in docs/68_prompt_kpi_dashboard.md',
fmt:_ja?'## 現状診断\n| 次元 | 現状 | 目標 | ギャップ | 優先度 |\n|------|------|------|---------|--------|\n| プロンプト設計力 | Level ? | Level ? | ... | P? |\n\n**総合成熟度**: Level ? → Level ?\n\n## 次レベルへの3大アクション\n1. **アクション1**: ... (工数: M, 効果: 高)\n2. **アクション2**: ...\n3. **アクション3**: ...\n\n## 成功KPI\n| KPI | 現状値 | 目標値 | 計測方法 |':'## Current Assessment\n| Dimension | Current | Target | Gap | Priority |\n|-----------|---------|--------|-----|----------|\n| Prompt Design | Level ? | Level ? | ... | P? |\n\n**Overall Maturity**: Level ? → Level ?\n\n## Top 3 Actions for Next Level\n1. **Action 1**: ... (Effort: M, Effect: High)\n2. **Action 2**: ...\n3. **Action 3**: ...\n\n## Success KPIs\n| KPI | Current | Target | Measurement |'},
enterprise_arch:{icon:'🏢',label:_ja?'エンタープライズアーキ':'Enterprise Arch Review',desc:_ja?'docs/73でマルチテナント・RLS・組織モデルを検証':'Verify multi-tenant, RLS, org model from docs/73',
sys:_ja?'あなたはエンタープライズSaaSアーキテクトです。マルチテナント設計、RLSポリシー、組織データモデルのレビューを専門とします。docs/73_enterprise_architecture.mdを参照し、セキュリティ・スケーラビリティ・権限設計を総合評価します。':'You are an enterprise SaaS architect specializing in multi-tenant design, RLS policies, and org data models. Review the architecture comprehensively using docs/73_enterprise_architecture.md.',
prompt:_ja?'以下の手順でエンタープライズアーキテクチャをレビューしてください:\n\n1. **テナント分離評価** (docs/73 §テナント分離戦略): 採用パターン（RLS/Schema/DB）の適切性を判断。テナント数・規制要件・コストの観点からトレードオフを評価。\n\n2. **組織データモデル検証**: Organization/OrgMember/OrgInviteのER関係が正しいか確認。FK整合性・インデックス・RLSポリシーの漏れを指摘。\n\n3. **権限マトリクス監査** (docs/73 §権限マトリクス): Owner/Admin/Member/Viewerの4階層が適切に分離されているか。最小権限原則の適用を確認。\n\n4. **RLSポリシーレビュー** (docs/43_security_intelligence.md §RLS): 全テーブルでorg_idフィルタが適用されているか。クロステナントアクセスの可能性を洗い出し。\n\n5. **スケーリング判断**: 現在のテナント数予測から最適なアーキテクチャパターンを推奨。':'Review the enterprise architecture following these steps:\n\n1. **Tenant isolation assessment** (docs/73 §Tenant Isolation): Judge appropriateness of selected pattern (RLS/Schema/DB). Evaluate trade-offs from tenant count, regulatory, and cost perspectives.\n\n2. **Org data model validation**: Verify ER relationships for Organization/OrgMember/OrgInvite. Identify FK integrity issues, missing indexes, and RLS policy gaps.\n\n3. **Permission matrix audit** (docs/73 §Permission Matrix): Verify 4-tier Owner/Admin/Member/Viewer separation. Confirm least-privilege principle application.\n\n4. **RLS policy review** (docs/43 §RLS): Check org_id filter applied to all tables. Surface any cross-tenant access risks.\n\n5. **Scaling recommendation**: Recommend optimal architecture pattern based on projected tenant count.',
fmt:_ja?'## テナント分離評価\n| 評価項目 | 現状 | 推奨 | 優先度 |\n|---------|------|------|--------|\n| 分離パターン | RLS/Schema/DB | ... | P? |\n\n## 組織ERモデル問題点\n| テーブル | 問題 | 修正案 |\n\n## 権限マトリクス違反\n| リソース | 現状 | 正しい設定 |\n\n## RLSポリシー漏れ\n| テーブル | 問題 | 修正SQL |':'## Tenant Isolation Assessment\n| Item | Current | Recommended | Priority |\n|------|---------|-------------|----------|\n| Pattern | RLS/Schema/DB | ... | P? |\n\n## Org ER Model Issues\n| Table | Issue | Fix |\n\n## Permission Matrix Violations\n| Resource | Current | Correct |\n\n## RLS Policy Gaps\n| Table | Issue | Fix SQL |'},
ux_audit:{icon:'🔬',label:_ja?'UX習熟度監査':'UX Proficiency Audit',desc:_ja?'7段階ペルソナで自アプリのUX乖離を発見':'Discover UX gaps with 7-level personas',
sys:_ja?'あなたは7段階のユーザー習熟度（Lv.0完全初心者〜Lv.6伝道者）のそれぞれのペルソナを順番に演じるUX監査AIです。':'You are a UX audit AI that plays each persona of 7 user proficiency levels (Lv.0 Absolute Beginner to Lv.6 Evangelist) in order.',
prompt:_ja?'以下のプロジェクト仕様に基づき、各レベルごとに:\n① このアプリの第一印象/使い心地を評価（そのLvの視点で）\n② つまずきポイントを3つ特定\n③ 離脱リスクを判定（高/中/低）\n④ 改善アクションを優先度順に3つ提案\n\n全7レベル完了後、「構造的乖離マップ」を作成:\n- どのレベル間に最大のUXギャップがあるか\n- 最も離脱リスクが高いレベルはどこか\n- 投資対効果が最も高い改善施策TOP5\n\n対象プロジェクト情報は以下のドキュメントを参照してください。':'Based on the following project spec, for each level:\n① Evaluate this app\'s first impression/usability (from that Lv\'s perspective)\n② Identify 3 stumbling points\n③ Determine dropout risk (High/Medium/Low)\n④ Propose 3 improvement actions in priority order\n\nAfter all 7 levels, create a "Structural Gap Map":\n- Between which levels is the largest UX gap?\n- Which level has the highest dropout risk?\n- TOP5 improvement measures with best ROI\n\nRefer to the following project documents for context.',
fmt:_ja?'## Lv別UX監査\n| Lv | ペルソナ | 第一印象 | つまずき | 離脱リスク | 改善アクション |\n\n## 構造的乖離マップ\n| ギャップ区間 | 深刻度 | 改善施策 | 投資対効果 |\n\n## TOP5改善施策\n| # | 施策 | 対象Lv | 効果 | 工数 | 優先度 |':'## Lv UX Audit\n| Lv | Persona | First Impression | Stumbling Points | Dropout Risk | Improvement Actions |\n\n## Structural Gap Map\n| Gap Segment | Severity | Improvement | ROI |\n\n## TOP5 Improvements\n| # | Measure | Target Lv | Effect | Effort | Priority |'},
workflow_audit:{icon:'📋',label:_ja?'ワークフロー監査':'Workflow Process Audit',desc:_ja?'docs/74で承認・チケット・注文フローのステートマシンを検証':'Audit approval/ticket/order state machines from docs/74',
sys:_ja?'あなたはビジネスプロセス設計とワークフローエンジンの専門家です。docs/74_workflow_engine.mdのステートマシン定義・承認チェーン・SLAトラッキングをレビューし、実装の完全性と正確性を評価します。':'You are a business process design and workflow engine expert. Review state machine definitions, approval chains, and SLA tracking in docs/74_workflow_engine.md to evaluate implementation completeness and accuracy.',
prompt:_ja?'以下の手順でワークフロープロセスを監査してください:\n\n1. **ステートマシン完全性チェック** (docs/74): 全ワークフロー（承認/チケット/注文等）の状態遷移が網羅されているか確認。デッドロック・孤立状態・欠損遷移を特定。\n\n2. **承認チェーン適切性評価**: 選択された承認パターン（単一/順次/並列/委任/閾値）がビジネス要件に合っているか判断。\n\n3. **SLAトラッキング実装確認**: 各ワークフローのSLA期限設定・エスカレーション通知・自動リマインダーが実装されているか確認。\n\n4. **通知トリガー完全性**: 状態変化ごとの通知先・チャネル・タイミングが定義されているか確認。未定義のトリガーを指摘。\n\n5. **ドメイン固有最適化**: detectDomain()の結果に基づき、ドメイン特有のワークフロー要件が反映されているか評価。':'Audit workflow processes following these steps:\n\n1. **State machine completeness** (docs/74): Verify all workflow state transitions are covered (approval/ticket/order etc). Identify deadlocks, orphan states, and missing transitions.\n\n2. **Approval chain appropriateness**: Determine if selected pattern (single/sequential/parallel/delegation/threshold) matches business requirements.\n\n3. **SLA tracking implementation**: Verify SLA deadline settings, escalation notifications, and auto-reminders are implemented for each workflow.\n\n4. **Notification trigger completeness**: Confirm notification recipients, channels, and timing are defined for each state change. Flag undefined triggers.\n\n5. **Domain-specific optimization**: Evaluate if domain-specific workflow requirements are reflected based on detectDomain() result.',
fmt:_ja?'## ステートマシン問題\n| ワークフロー | 問題種別 | 詳細 | 修正提案 |\n|------------|---------|------|--------|\n\n## SLAギャップ\n| ワークフロー | 設定SLA | 推奨SLA | 差異 |\n\n## 未定義通知トリガー\n| 状態変化 | 本来の通知先 | 実装状況 |\n\n## 優先修正アクション\n1. P0: ...\n2. P1: ...\n3. P2: ...':'## State Machine Issues\n| Workflow | Issue Type | Detail | Fix |\n|---------|-----------|--------|-----|\n\n## SLA Gaps\n| Workflow | Set SLA | Recommended | Gap |\n\n## Missing Notification Triggers\n| State Change | Expected Recipients | Status |\n\n## Priority Fix Actions\n1. P0: ...\n2. P1: ...\n3. P2: ...'},
}:{
review:{icon:'🔍',label:'Spec Review',desc:'Find contradictions, gaps & improvements',
sys:'You are an experienced tech lead and SDD architect.',
prompt:'Review the following specs in 4 steps:\n1. Verify mission and KPIs in constitution.md\n2. Check requirement coverage in specification.md\n3. Evaluate architecture validity in technical-plan.md\n4. Identify overall consistency and gaps\n\nAssign priority to each finding (P0=critical/P1=important/P2=recommended).',
fmt:'Markdown table:\n| # | File | Finding | Priority | Recommended Action |\n|---|------|---------|----------|--------------------|\n| 1 | .spec/xxx.md | ... | P0 | ... |'},
implement:{icon:'🚀',label:'MVP Build',desc:'Start implementation from specs',
sys:'You are a full-stack developer. You implement faithfully according to SDD specs.',
prompt:'Select the highest priority task (P0 or Issue #1) from docs/23_tasks.md and implement it.\n\nImplementation steps:\n1. Create type definitions (TypeScript interface/type)\n2. Implement data access layer (ORM/SDK)\n3. Implement business logic\n4. Implement UI components\n5. Create Vitest unit tests\n\nFollow design principles in constitution.md and architecture in technical-plan.md.\n\nReference docs/39_implementation_playbook.md for domain-specific implementation patterns and industry best practices.\nApply docs/40_ai_dev_runbook.md WSCI (Write→Self-Critique→Improve) workflow for quality validation.\nCheck docs/31_industry_playbook.md domain-specific checklists.',
fmt:'Code blocks with file paths:\n```typescript:path/to/file.ts\n// code\n```\nMust include tests.'},
test:{icon:'🧪',label:'Test Generation',desc:'Auto-generate test cases',
sys:'You are a QA engineer. You create comprehensive test cases from specifications.',
prompt:'Reference docs/07_test_cases.md and generate test cases in this order:\n1. Happy Path: Basic CRUD operations\n2. Error Cases: Validation errors, permission errors\n3. Boundary: Empty strings, max length, NULL\n4. Use docs/33_test_matrix.md priority matrix to determine execution order\n5. Add non-functional tests following docs/36_test_strategy.md strategy\n\nSpecify expected results for each test case.',
fmt:'Vitest test file:\n```typescript:tests/xxx.test.ts\nimport { describe, it, expect } from \'vitest\';\n// tests\n```'},
refactor:{icon:'♻️',label:'Refactor Proposal',desc:'Architecture improvements & tech debt',
sys:'You are a code reviewer focused on architecture improvements.',
prompt:'Analyze the technical design in these specs and propose refactoring. Assign effort estimates (S=1-2h/M=3-8h/L=1-2d) to each finding.\n\nCheck items:\n- SOLID principle violations\n- Separation of concerns issues (Fat Controllers, etc.)\n- Scalability problems\n- Performance bottlenecks\n- Technical debt',
fmt:'Markdown table:\n| Issue | Violated Principle | Improvement | Effort | Priority |\n|-------|-------------------|-------------|--------|----------|\n| ... | SRP | ... | M | P1 |'},
security:{icon:'🔒',label:'Security Audit',desc:'Vulnerabilities & best practices',
sys:'You are a security engineer. You audit against OWASP Top 10 2025.',
prompt:'Reference these security documents first:\n'+
'- docs/43_security_intelligence.md (Stack-adaptive checklist)\n'+
'- docs/44_threat_model.md (STRIDE threat analysis)\n'+
'- docs/45_compliance_matrix.md (Compliance requirements)\n'+
'- docs/46_ai_security.md (AI/LLM security)\n'+
'- docs/47_security_testing.md (Test templates)\n\n'+
'Check security aspects against OWASP Top 10 2025:\n'+
'1. A01 – Broken Access Control\n2. A02 – Security Misconfiguration\n'+
'3. A03 – Software Supply Chain\n4. A04 – SSRF (Input Validation & URL Restrictions)\n'+
'5. A05 – Insecure Design\n6. A06 – Vulnerable and Outdated Components\n'+
'7. A07 – Identification and Authentication Failures\n8. A08 – Software and Data Integrity Failures\n'+
'9. A09 – Security Logging and Monitoring Failures\n10. A10 – Infrastructure Protection (DNS Rebinding & Egress)\n\n'+
'Also check for drift between docs/08_security.md design and implementation.\n'+
'Verify alignment between docs/53_ops_runbook.md A09 item (security logging/monitoring) and current setup.\n'+
'Evaluate each item as ✅(OK)/⚠️(Warning)/❌(Vulnerable).',
fmt:'Markdown table:\n| OWASP# | Item | Status | Details | Recommended Fix |\n|--------|------|--------|---------|------------------|\n| A01 | Access Control | ⚠️ | ... | ... |'},
docs:{icon:'📝',label:'Doc Completion',desc:'Identify missing docs & generate them',
sys:'You are a technical writer focused on development documentation quality.',
prompt:'Analyze these specs and output in 2 parts:\n\n**Part 1: Gap Analysis**\nList gaps between existing docs and ideal state in table format\n\n**Part 2: Generate Critical Document**\nGenerate ONE highest-priority document from gap analysis in full.\n\nCandidates:\n- API spec details (OpenAPI YAML)\n- Sequence diagrams (Mermaid)\n- Deployment guide (step-by-step)\n- Error handling design',
fmt:'Part 1: Markdown table\nPart 2: Complete document (Markdown)'},
debug:{icon:'🔧',label:'Debug Assistant',desc:'Root cause analysis & fix suggestions',
sys:'You are an experienced debugging specialist. You identify root causes from error logs and stack traces.',
prompt:'Debug analysis:\n1. Cross-reference docs/25_error_logs.md patterns (recurrence vs new issue)\n2. Identify root cause of the error/stack trace (5 Whys analysis)\n3. Match against bug categories in docs/37_bug_prevention.md checklist\n4. Propose fix code and prevention measures\n5. Draft an entry for docs/25_error_logs.md',
fmt:'## Diagnosis\n| Item | Detail |\n|------|--------|\n| Error Type | ... |\n| Root Cause | ... |\n| Impact Scope | ... |\n\n## Fix Code\n```typescript:path/to/file.ts\n// fix\n```\n\n## error_logs.md Entry\n- Symptom/Cause/Fix/Prevention'},
arch:{icon:'📐',label:'Architecture Compliance',desc:'Detect spec-implementation drift',
sys:'You are a software architect. You verify alignment between specs and implementation.',
prompt:'Architecture compliance check:\n1. Review layer structure and patterns in docs/03_architecture.md\n2. Verify alignment with .spec/technical-plan.md technical decisions\n3. Inspect code for layer boundary violations\n4. Check consistency with docs/27_sequence_diagrams.md sequence flows\n5. Check consistency with docs/26_design_system.md component conventions\n6. Propose fixes and refactoring steps for each violation',
fmt:'Markdown table:\n| # | Location | Source | Violation | Severity | Fix |\n|---|----------|--------|-----------|----------|-----|\n\n## Architecture Compliance Score: X/10'},
perf:{icon:'⚡',label:'Performance Optimization',desc:'Identify bottlenecks & suggest fixes',
sys:'You are a performance engineer. You identify bottlenecks against NFR targets and propose improvements.',
prompt:'Performance analysis:\n1. Extract performance targets from NFR section in .spec/constitution.md\n2. Review docs/41_growth_intelligence.md performance budgets and Core Web Vitals targets (LCP<2.5s, FID<100ms, CLS<0.1)\n3. Detect N+1 queries, unnecessary re-renders, bundle size issues\n4. Provide before/after estimates for each issue\n5. Create a prioritized improvement roadmap\n6. Cross-reference docs/19_performance.md performance design patterns\n7. Verify alignment with docs/17_monitoring.md metrics (latency/throughput)',
fmt:'## Bottleneck List\n| # | Location | Type | Current Est. | Target | Fix | Impact |\n|---|----------|------|-------------|--------|-----|--------|\n\n## Optimized Code\n```typescript:path/to/file.ts\n// optimized\n```'},
api:{icon:'🔌',label:'API Integration Generator',desc:'Generate type-safe API integration code',
sys:'You are an integration engineer. You generate type-safe API integration code.',
prompt:'Generate API integration code:\n1. Review endpoints and auth in docs/05_api_design.md\n2. Define request/response types from docs/04_er_diagram.md entity schemas\n3. Generate integration code with error handling (retry, timeout, rate limiting)\n4. Ensure compliance with docs/08_security.md security requirements\n5. Create integration test skeletons',
fmt:'```typescript:lib/api/client.ts\n// API client with types\n```\n```typescript:lib/api/types.ts\n// Request/Response types\n```\n```typescript:tests/api/integration.test.ts\n// Integration tests\n```'},
a11y:{icon:'♿',label:'Accessibility Audit',desc:'WCAG 2.1 compliance check & fixes',
sys:'You are an accessibility expert. You audit UI components against WCAG 2.1 AA.',
prompt:'Accessibility audit:\n1. Review design tokens (color contrast, font sizes) in docs/26_design_system.md\n2. Identify key UI elements from docs/06_screen_design.md screen list\n3. Evaluate against WCAG 2.1 AA 4 principles (Perceivable, Operable, Understandable, Robust)\n4. Provide specific HTML/ARIA fix code for each violation\n5. Reference docs/57_user_experience_strategy.md accessibility strategy and digital wellbeing sections for inclusive UX additional assessment\n6. Generate axe-core automated tests',
fmt:'## WCAG 2.1 AA Audit Results\n| # | Criterion | Screen | Element | Status | Fix Code |\n|---|-----------|--------|---------|--------|----------|\n\n## Automated Tests\n```typescript:tests/a11y.test.ts\n// axe-core tests\n```'},
migrate:{icon:'🔄',label:'Migration Assistant',desc:'Tech stack migration planning',
sys:'You are a migration architect. You plan phased migrations while guaranteeing data integrity.',
prompt:'Create migration plan:\n1. Review current stack from .spec/technical-plan.md\n2. Understand data schemas and relationships from docs/04_er_diagram.md\n3. Generate schema conversion scripts and data validation queries\n4. Create risk-minimized deployment plan (blue-green or canary)\n5. Document rollback steps for each phase',
fmt:'## Migration Plan\n| Phase | Tasks | Duration | Rollback | Risk |\n|-------|-------|----------|----------|------|\n\n## Schema Conversion\n```sql\n-- migration script\n```\n\n## Data Validation\n```sql\n-- validation queries\n```'},
metrics:{icon:'📊',label:'Code Metrics Analysis',desc:'Quantitative quality evaluation',
sys:'You are a software metrics analyst. You quantitatively evaluate code quality.',
prompt:'Code metrics analysis:\n1. Measure Cyclomatic Complexity per function\n2. Evaluate Cognitive Complexity and identify hard-to-understand sections\n3. Analyze coupling and cohesion (detect high-dependency modules)\n4. Identify code duplication and DRY violations\n5. Present improvement plan ordered by ROI (impact/effort)',
fmt:'## Metrics Summary\n| Metric | Value | Threshold | Status |\n|--------|-------|-----------|--------|\n| Avg Cyclomatic Complexity | X | <10 | ✅/⚠️/❌ |\n\n## Hotspots (Priority Order)\n| File | Function | Complexity | Improvement | Effort |\n|------|----------|------------|-------------|--------|'},
i18n:{icon:'🌍',label:'i18n Generator',desc:'Add internationalization to existing code',
sys:'You are an internationalization engineer. You add i18n support with minimal changes.',
prompt:'Implement internationalization:\n1. Extract all hardcoded strings from the code\n2. Define translation key naming convention (scope.component.element)\n3. Generate translation files (JSON) for Japanese and English\n4. Replace strings with translation function (t()) calls\n5. Add locale-aware formatters for dates, numbers, currencies',
fmt:'## Extracted Strings\n| Key | Japanese | English |\n|-----|----------|----------|\n\n```json:locales/ja.json\n{}\n```\n```json:locales/en.json\n{}\n```\n\n## Converted Code\n```typescript:path/to/file.ts\n// i18n-ready code\n```'},
growth:{icon:'📈',label:'Growth Strategy',desc:'Optimize growth funnels, KPIs & pricing',
sys:'You are a growth engineer. You design data-driven growth strategies.',
prompt:'Growth analysis:\n1. Review growth funnel and CVR benchmarks in docs/41_growth_intelligence.md\n2. Evaluate stack synergy score for current configuration\n3. Identify bottlenecks using domain-specific growth equation\n4. Propose 5 growth levers in priority order\n5. Design 3-tier pricing strategy (behavioral economics: compromise effect, anchoring)\n6. Cross-reference docs/48_industry_blueprint.md industry growth patterns (TAM/SAM/SOM strategy)\n7. Validate alignment with docs/50_stakeholder_strategy.md target strategy\n8. Integrate docs/56_market_positioning.md market positioning and competitive analysis into growth funnel to identify differentiation advantages',
fmt:'## Funnel Analysis\n| Stage | Current CVR | Target CVR | Improvement |\n\n## Growth Levers\n| # | Lever | Expected Impact | Effort | Priority |\n\n## Pricing Strategy\n| Plan | Price | Features | Target |'},
reverse:{icon:'🎯',label:'Goal Reverse Design',desc:'Reverse-plan from goals with gap analysis',
sys:'You are a project strategist. You reverse-engineer plans from goals.',
prompt:'Goal reverse analysis:\n1. Review goal definition and reverse flow in docs/29_reverse_engineering.md\n2. Analyze goal tree and sub-goals in docs/30_goal_decomposition.md\n3. Quantitatively evaluate gap between current state and targets\n4. Reorganize milestones using priority matrix\n5. Verify dependency chain and identify critical path',
fmt:'## Gap Analysis\n| Goal | Current | Gap | Action | Deadline |\n\n## Critical Path\n```mermaid\ngantt\n```\n\n## Milestones\n| MS | Criteria | Dependencies | Risk |'},
incident:{icon:'🚨',label:'Incident Response',desc:'Create runbooks & post-mortems',
sys:'You are an SRE engineer specializing in incident response and prevention.',
prompt:'Incident response:\n1. Review incident response flow in docs/34_incident_response.md\n2. Identify related past error patterns from docs/25_error_logs.md\n3. Assess impact scope (users, features, data)\n4. Create emergency procedures (rollback, failover)\n5. Draft post-mortem (timeline, root cause, improvement actions)\n6. Cross-reference docs/53_ops_runbook.md SLO/SLI baseline to determine SLO violations\n7. Review docs/55_ops_plane_design.md circuit breaker settings to assess auto-cutoff validity',
fmt:'## Impact Assessment\n| Item | Detail |\n| Scope | ... |\n| Severity | SEV1/2/3 |\n\n## Response Steps\n1. Detect → 2. Triage → 3. Respond → 4. Recover → 5. Review\n\n## Post-Mortem\n| Timeline | Action | Owner |'},
onboard:{icon:'🎓',label:'Onboarding',desc:'Handoff docs for new members & AI agents',
sys:'You are a technical onboarding specialist. You create materials for fastest developer ramp-up.',
prompt:'Create onboarding materials:\n1. Summarize project from CLAUDE.md and AI_BRIEF.md\n2. Diagram design principles from .spec/constitution.md and architecture from docs/03_architecture.md\n3. Organize skill-level workflows from docs/42_skill_guide.md\n4. Extract first-week task list from .spec/tasks.md\n5. Create FAQ from common pitfalls in docs/37_bug_prevention.md\n6. Explain .claude/rules/ 5-file structure (spec.md, frontend.md, backend.md, test.md, ops.md)\n7. Clarify Dev×Ops responsibility matrix from docs/55_ops_plane_design.md',
fmt:'## Project Overview (5-min read)\n\n## Architecture Diagram\n```mermaid\n```\n\n## First Week\n| Day | Task | Reference File |\n\n## FAQ\n| Question | Answer |'},
cicd:{icon:'⚙️',label:'CI/CD Intelligence Review',desc:'Review CI/CD pipeline, deploy strategy & quality gates',
sys:'You are a DevOps engineer. You review CI/CD pipelines and quality gates.',
prompt:'CI/CD Intelligence Review:\n1. Review docs/77_cicd_pipeline_design.md 9-stage pipeline and identify project-specific improvements\n2. Evaluate docs/78_deployment_strategy.md recommended deploy strategy (blue-green/canary etc.) validity\n3. Review docs/79_quality_gate_matrix.md quality gate thresholds (coverage, performance budget)\n4. Verify docs/80_release_engineering.md branch model, semantic versioning, and Renovate config\n5. Check alignment with docs/53_ops_runbook.md SLO quality gates (error rate/latency thresholds)\n6. Integrate docs/54_ops_checklist.md ops readiness checklist into release gates\n7. Identify missing quality gates or optimization opportunities with prioritized recommendations',
fmt:'## Pipeline Design\n```mermaid\nflowchart LR\n```\n\n## Quality Gate Review\n| Stage | Check | Threshold | Current | Improvement |\n\n## GitHub Actions\n```yaml\n# .github/workflows/ci-cd.yml\n```'},
ops:{icon:'🛡️',label:'Ops Readiness Review',desc:'Validate SLO, Feature Flags, Circuit Breaker settings',
sys:'You are an SRE/Platform Engineer. You validate operational readiness.',
prompt:'Ops Readiness Review:\n1. Verify docs/53_ops_runbook.md SLO/SLI definitions match domain requirements\n2. Check Feature Flag coverage (kill switches for payments, notifications, external APIs, etc.)\n3. Assess docs/55_ops_plane_design.md circuit breaker thresholds (error rate/timeout) validity\n4. Validate docs/54_ops_checklist.md 12 Ops Capabilities implementation (Observability, Jobs, Backup, etc.)\n5. Verify RPO/RTO meets industry standards (e.g., Fintech: RPO<5min/RTO<15min)\n6. Check docs/17_monitoring.md monitoring alignment with Observability requirements\n7. Calculate Ops Readiness Score (12 items) and identify gaps',
fmt:'## Ops Readiness Score\n| Capability | Status | Validity | Improvement Action |\n|------------|--------|----------|--------------------|\n| SLO Definition | ✅/⚠️/❌ | 99.9% (req: 99.99%) | ... |\n\n## SLO Validity Assessment\n| SLI | Current Setting | Domain Recommended | Verdict |\n\n## Improvement Roadmap\n| Priority | Item | Deadline | Owner |'},
strategy:{icon:'🏢',label:'Strategic Intelligence',desc:'Industry blueprint, tech radar, stakeholder strategy',
sys:'You are a Product Strategist/Business Analyst. You validate business strategy alignment.',
prompt:'Strategic Intelligence Analysis:\n1. Verify docs/48_industry_blueprint.md industry blueprint alignment (TAM/SAM/SOM, regulatory compliance)\n2. Check docs/49_tech_radar.md tech radar ratings (Adopt/Trial/Assess/Hold) vs current tech choices\n3. Detect gaps in docs/50_stakeholder_strategy.md stakeholder strategy (targets, KPIs, growth metrics)\n4. Analyze docs/51_operational_excellence.md operational maturity gap (current Lv1→target Lv3)\n5. Extract short-term actions (within 3 months) from docs/52_advanced_scenarios.md\n6. Evaluate business model alignment with docs/41_growth_intelligence.md growth equation\n7. Integrate docs/56_market_positioning.md MOAT analysis, GTM strategy, and unit economics into strategic scorecard\n8. Integrate docs/58_ecosystem_strategy.md ecosystem strategy, API-as-Product, and DX assessment into strategy\n9. Create strategic scorecard (5-axis assessment) and prioritize improvement areas',
fmt:'## Strategic Scorecard\n| Axis | Score(1-5) | Assessment | Gap |\n|------|------------|------------|-----|\n| Industry Fit | X/5 | ... | ... |\n| Tech Choice | X/5 | ... | ... |\n\n## Tech Radar Assessment\n| Technology | Current Adoption | Radar Recommendation | Gap Reason |\n\n## Short-Term Action Plan (3 months)\n| # | Action | KPI | Owner | Deadline |'},
risk:{icon:'⚖️',label:'Risk & Compliance',desc:'4-axis risk re-assessment, STRIDE residual risks, compliance',
sys:'You are a Risk Analyst/Compliance Officer. You perform integrated risk and compliance assessment.',
prompt:'Risk & Compliance Analysis:\n1. Re-assess docs/14_risks.md 4-axis risks (technical, organizational, legal, operational) and validate mitigation effectiveness\n2. Check docs/45_compliance_matrix.md compliance coverage (GDPR, PCI-DSS, etc.)\n3. Extract TOP5 residual risks from docs/44_threat_model.md STRIDE threat analysis\n4. Evaluate docs/53_ops_runbook.md SLO operational risks (SLO breach penalties, escalation)\n5. Create risk heatmap (probability × impact) and identify P0 risks\n6. Verify compliance automation (Terraform Sentinel/OPA) implementation status\n7. Integrate docs/59_regulatory_foresight.md regulatory foresight (EU AI Act, ESG metrics, 2026-2030 horizon) into risk re-assessment\n8. Present TOP5 risk mitigation measures in priority order (technical controls, process improvements, insurance, etc.)',
fmt:'## Risk Heatmap\n| Risk | Probability | Impact | Score | Mitigation | Status |\n|------|-------------|--------|-------|------------|--------|\n| ... | H/M/L | H/M/L | X | ... | ✅/⚠️/❌ |\n\n## Compliance Coverage\n| Regulation | Required Items | Met Items | Coverage % | Unmet Items |\n\n## TOP5 Residual Risks\n| # | Risk | STRIDE Category | Current Mitigation | Recommended Additional Controls | Effort |'},
qa:{icon:'🐛',label:_ja?'QA・バグ検出':'QA & Bug Detection',desc:_ja?'ドメイン別バグパターンとQA戦略を基にテスト計画を生成':'Generate test plan based on domain-specific bug patterns and QA strategy',
sys:_ja?'あなたはQAエンジニアです。docs/28_qa_strategy.mdのドメイン別バグパターンを参照し、具体的なテストシナリオを設計してください。':'You are a QA engineer. Reference docs/28_qa_strategy.md domain-specific bug patterns to design concrete test scenarios.',
prompt:_ja?'以下の手順で実行:\n1. docs/28_qa_strategy.mdの重点領域を確認\n2. 各重点領域に対し具体的テストケースを3つ以上作成\n3. docs/32_qa_blueprint.mdの品質ゲートチェックリストと照合\n4. docs/33_test_matrix.mdのマトリクスに基づきカバレッジを検証\n5. よくあるバグパターンに対する回帰テストを設計\n6. 業界横断チェックリストの該当項目を検証\n7. 優先度マトリクスに基づきテスト実行順序を決定':'Follow these steps:\n1. Review focus areas from docs/28_qa_strategy.md\n2. Create 3+ concrete test cases per focus area\n3. Cross-reference with docs/32_qa_blueprint.md quality gate checklist\n4. Verify coverage against docs/33_test_matrix.md matrix\n5. Design regression tests for common bug patterns\n6. Verify applicable cross-cutting checklist items\n7. Determine test execution order based on priority matrix',
fmt:_ja?'Markdown表形式: テストID|カテゴリ|シナリオ|期待結果|優先度(CRITICAL/HIGH/MED/LOW)':'Markdown table: TestID|Category|Scenario|Expected Result|Priority(CRITICAL/HIGH/MED/LOW)'},
methodology:{icon:'🧬',label:_ja?'ドメイン最適手法':'Optimal Methodology',desc:_ja?'docs/60参照し最適設計アプローチを深堀り':'Deep-dive optimal design approach from docs/60',
sys:_ja?'あなたは経験豊富な設計アーキテクトです。docs/60_methodology_intelligence.mdの選定手法を基に、具体的な実装戦略を提案してください。':'You are an experienced design architect. Propose concrete implementation strategy based on selected methodology from docs/60_methodology_intelligence.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/60_methodology_intelligence.mdの第一選択・第二選択手法を確認\n2. 各手法のキーワードに基づく具体的な実装パターンを3つ以上提案\n3. 12設計アプローチの適合度評価を参照し、優先度マトリクスを作成\n4. 組み合わせシナジーを技術的に実現する方法を提案\n5. フェーズ別実装計画（Phase 1: 基盤→Phase 2: 拡張→Phase 3: 最適化）の詳細化':'Follow these steps:\n1. Review primary/secondary approaches from docs/60_methodology_intelligence.md\n2. Propose 3+ concrete implementation patterns based on each approach keywords\n3. Create priority matrix referencing 12 design approaches fit evaluation\n4. Propose technical methods to realize combination synergies\n5. Detail phased implementation plan (Phase 1: Foundation→Phase 2: Expansion→Phase 3: Optimization)',
fmt:_ja?'Markdown表形式: フェーズ|手法|実装パターン|期待効果|工数(S/M/L)':'Markdown table: Phase|Approach|Implementation Pattern|Expected Effect|Effort(S/M/L)'},
brainstorm:{icon:'🎭',label:_ja?'9人の専門家ブレスト':'9-Expert Brainstorm',desc:_ja?'創造工学の9視点で固定観念を突破':'Break fixed ideas with 9 creative perspectives',
sys:_ja?'あなたは9人の専門家が同居する創造的思考システムです。各専門家の個性を維持しながら、プロジェクトに関する多角的なアイデアを生成します。\n\n専門家チーム:\n①🎨クリエイティブ(美・物語・体験重視)\n②⚙️技術専門家(実現可能性・最適化重視)\n③📊ビジネス(収益・市場・競争優位重視)\n④📚学術研究者(エビデンス・理論・先行研究重視)\n⑤🔬科学者(仮説検証・データ・測定重視)\n⑥👤ユーザー代表(使いやすさ・感情・日常動線重視)\n⑦💥ディスラプター(既成概念破壊・逆張り重視)\n⑧😄ユーモリスト(楽しさ・驚き・記憶に残る体験重視)\n⑨🧭冒険家(大胆さ・リスクテイク・未踏領域重視)':'You are a creative thinking system where 9 experts coexist. Generate multi-perspective ideas while maintaining each expert\'s personality.\n\nExpert Team:\n①🎨Creative (aesthetics, storytelling, experience)\n②⚙️Technical (feasibility, optimization)\n③📊Business (revenue, market, competitive advantage)\n④📚Academic (evidence, theory, prior research)\n⑤🔬Scientist (hypothesis testing, data, measurement)\n⑥👤User Rep (usability, emotions, daily workflows)\n⑦💥Disruptor (challenging norms, contrarian thinking)\n⑧😄Humorist (fun, surprise, memorable experiences)\n⑨🧭Adventurer (boldness, risk-taking, unexplored territory)',
prompt:_ja?'以下のプロジェクトについて、9人の専門家が順番にアイデアを1つずつ提案してください。\n\n【フォーマット】各専門家ごとに:\n- アイデア名（10文字以内）\n- 提案内容（3文）\n\n全員の提案後、3軸評価マトリクスを作成:\n| アイデア | 魅力度(1-5) | 実現可能性(1-5) | 妥当性(1-5) | 総合 |\n\n最後に「クロスポリネーション」として、異なる専門家のアイデアを組み合わせた「最強のハイブリッド案」を1つ提案。':'For the following project, each of the 9 experts proposes one idea in sequence.\n\n【Format】For each expert:\n- Idea name (10 words max)\n- Proposal (3 sentences)\n\nAfter all proposals, create a 3-axis evaluation matrix:\n| Idea | Appeal(1-5) | Feasibility(1-5) | Validity(1-5) | Total |\n\nFinally propose one "Cross-Pollination" hybrid idea combining concepts from different experts.',
fmt:_ja?'## 9専門家アイデア\n| 専門家 | アイデア名 | 提案内容 |\n\n## 3軸評価マトリクス\n| アイデア | 魅力度 | 実現可能性 | 妥当性 | 総合 |\n\n## クロスポリネーション案\n**組み合わせ**: 専門家X×専門家Y\n**ハイブリッドアイデア**: ...':'## 9-Expert Ideas\n| Expert | Idea Name | Proposal |\n\n## 3-Axis Evaluation Matrix\n| Idea | Appeal | Feasibility | Validity | Total |\n\n## Cross-Pollination Proposal\n**Combination**: Expert X × Expert Y\n**Hybrid Idea**: ...'},
ux_journey:{icon:'🎯',label:_ja?'UXジャーニー設計':'UX Journey Design',desc:_ja?'Lv.0-5段階的開示でアプリのUXを設計':'Design app UX with Lv.0-5 progressive disclosure',
sys:_ja?'あなたはUXデザイン専門家です。段階的開示・認知負荷管理・ペインポイントストーリーテリングの3つの視点でユーザージャーニーを設計します。':'You are a UX design expert. Design user journeys from 3 perspectives: progressive disclosure, cognitive load management, and pain point storytelling.',
prompt:_ja?'以下のプロジェクトのターゲットアプリについて、Lv.0（完全初心者）からLv.5（エキスパート）までの6段階ユーザージャーニーを設計してください:\n\n各Lvで:\n①ペルソナ（年齢・職業・ITリテラシー）\n②つまずきポイント（具体的な操作ミス・混乱箇所）\n③必要なUXパターン（オンボーディング/ツールチップ/段階的開示等）\n④離脱リスク（何があると諦めるか）\n⑤改善アクション（具体的UI変更案）\n\n次に「3つの悪夢」を特定:\n- 悪夢①: ユーザーが最も恐れる失敗体験\n- 悪夢②: 二番目に怖い体験\n- 悪夢③: 三番目に怖い体験\n\n各悪夢に対し、それを防ぐUI設計を提案してください。':'Design a 6-level user journey (Lv.0=complete beginner to Lv.5=expert) for this project:\n\nFor each Lv:\n①Persona (age, occupation, IT literacy)\n②Stumbling points (specific mistakes, confusion areas)\n③Required UX patterns (onboarding/tooltip/progressive disclosure etc.)\n④Churn risk (what makes users give up)\n⑤Improvement action (specific UI change)\n\nThen identify "3 Nightmares":\n- Nightmare①: The failure experience users fear most\n- Nightmare②: Second most feared\n- Nightmare③: Third most feared\n\nPropose UI designs that prevent each nightmare.',
fmt:_ja?'## Lv別ジャーニーマップ\n| Lv | ペルソナ | つまずき | UXパターン | 離脱リスク | 改善アクション |\n\n## 3つの悪夢分析\n| 悪夢 | 体験 | 防ぐUI設計 |\n\n## Mermaid Journey図\n```mermaid\njourney\n  title ユーザージャーニー\n```':'## Lv-by-Lv Journey Map\n| Lv | Persona | Stumbling | UX Pattern | Churn Risk | Improvement |\n\n## 3 Nightmares Analysis\n| Nightmare | Experience | Preventive UI Design |\n\n## Mermaid Journey Diagram\n```mermaid\njourney\n  title User Journey\n```'},
ai_model_guide:{icon:'🤖',label:_ja?'AIモデル使い分け':'AI Model Selection',desc:_ja?'開発フェーズ別に最適AIモデルを選定':'Select optimal AI model per dev phase',
sys:_ja?'あなたはAIモデル活用の専門家です。各AIモデルの「個性」（Gemini=正確性・広い知識、Claude=倫理・洗練、ChatGPT=創造性・自由度、Copilot=バランス・コード補完）を深く理解し、タスク適性を分析します。':'You are an AI model utilization expert. You deeply understand each AI model\'s "personality" (Gemini=accuracy & broad knowledge, Claude=ethics & refinement, ChatGPT=creativity & freedom, Copilot=balance & code completion) and analyze task suitability.',
prompt:_ja?'以下のプロジェクトの各開発フェーズで最適なAIモデルを提案してください:\n\nフェーズ: ①設計・アーキテクチャ ②実装・コーディング ③テスト・QA ④コードレビュー ⑤デプロイ・Ops\n\n各フェーズで:\n1. 推奨モデル（第一/第二候補）\n2. 選定理由（そのモデルの個性がなぜこのフェーズに合うか）\n3. ナチュラルプロンプト例（「ハンマー型」—使う道具の特性を活かした指示）\n4. 避けるべきアンチパターン（そのモデルが苦手なこと）\n\n最後に「AIモデル切替タイミング」ガイドを作成。':'Propose the optimal AI model for each development phase of this project:\n\nPhases: ①Design/Architecture ②Implementation/Coding ③Testing/QA ④Code Review ⑤Deploy/Ops\n\nFor each phase:\n1. Recommended model (primary/secondary)\n2. Selection reason (why this model\'s personality fits this phase)\n3. Natural prompt example ("hammer type" — instructions that leverage the tool\'s strengths)\n4. Anti-patterns to avoid (what this model struggles with)\n\nFinally create an "AI Model Switching Timing" guide.',
fmt:_ja?'## フェーズ別AIモデル推奨\n| フェーズ | 推奨AI | 理由 | ナチュラルプロンプト例 | アンチパターン |\n\n## AIモデル個性マップ\n| モデル | 強み | 弱み | 最適ユースケース |\n\n## 切替タイミングガイド\n- 設計→実装: ...\n- 実装→レビュー: ...':'## AI Model Recommendations by Phase\n| Phase | Recommended AI | Reason | Natural Prompt Example | Anti-patterns |\n\n## AI Model Personality Map\n| Model | Strengths | Weaknesses | Best Use Case |\n\n## Switching Timing Guide\n- Design→Impl: ...\n- Impl→Review: ...'},
industry:{icon:'🏭',label:_ja?'業界特化分析':'Industry Deep Dive',desc:_ja?'docs/62で規制・落とし穴を検証':'Verify regulations & pitfalls from docs/62',
sys:_ja?'あなたは業界コンプライアンス専門家です。docs/62_industry_deep_dive.mdの業界特有の落とし穴とアーキテクチャパターンを基に、リスク分析を実施してください。':'You are an industry compliance expert. Conduct risk analysis based on industry-specific pitfalls and architecture patterns from docs/62_industry_deep_dive.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/62_industry_deep_dive.mdの主要規制リストを確認し、現在の技術スタックでの準拠状況を評価\n2. 業界特有の落とし穴一覧から、このプロジェクトで該当する項目をピックアップ\n3. 各落とし穴に対する対策の実装状況を検証（✅実装済/⚠️部分的/❌未実装）\n4. docs/45_compliance_matrix.mdのコンプライアンスマトリクスと照合し、ギャップを特定\n5. 推奨アーキテクチャパターン（認証レイヤー、暗号化ストレージ、監査ログ）の実装計画を策定':'Follow these steps:\n1. Review key regulations from docs/62_industry_deep_dive.md and assess compliance status with current tech stack\n2. Pick applicable items from industry-specific pitfalls list\n3. Verify implementation status of countermeasures for each pitfall (✅Implemented/⚠️Partial/❌Not implemented)\n4. Cross-reference with docs/45_compliance_matrix.md compliance matrix to identify gaps\n5. Develop implementation plan for recommended architecture patterns (auth layer, encrypted storage, audit log)',
fmt:_ja?'## 規制準拠状況\n| 規制 | 要求事項 | 実装状況 | ギャップ | 対策優先度 |\n\n## 落とし穴チェック\n| # | 落とし穴 | 該当性 | 対策状況 | 実装計画 |\n\n## アーキテクチャ改善提案\n```mermaid\ngraph LR\n```':'## Regulatory Compliance\n| Regulation | Requirements | Status | Gap | Priority |\n\n## Pitfall Check\n| # | Pitfall | Applicability | Status | Plan |\n\n## Architecture Improvement\n```mermaid\ngraph LR\n```'},
nextgen:{icon:'🔮',label:_ja?'次世代UX探索':'Next-Gen UX',desc:_ja?'docs/63でAgentic/Spatial/Calm設計':'Agentic/Spatial/Calm design from docs/63',
sys:_ja?'あなたは次世代UX設計のスペシャリストです。docs/63_next_gen_ux_strategy.mdのPolymorphic Engineコンセプトを基に、革新的なUX提案を行ってください。':'You are a next-gen UX design specialist. Propose innovative UX based on Polymorphic Engine concept from docs/63_next_gen_ux_strategy.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/63_next_gen_ux_strategy.mdのThe Context Loop（Sensing→Thinking→Morphing→Acting）フレームワークを確認\n2. 4つの次世代UXキーワード（Agentic Workflow、Generative UI、Spatial Computing、Calm Technology）のプロジェクト適用プロンプトを選択\n3. 選択したキーワードを主要機能（例: ダッシュボード、検索、予約）に適用した具体的なUI設計案を3つ以上提案\n4. ドメイン特化適用例を参照し、業種固有のベストプラクティスを反映\n5. 各提案の実装難易度（S/M/L）、期待UX改善効果、技術的実現可能性を評価':'Follow these steps:\n1. Review The Context Loop (Sensing→Thinking→Morphing→Acting) framework from docs/63_next_gen_ux_strategy.md\n2. Select project application prompts for 4 next-gen UX keywords (Agentic Workflow, Generative UI, Spatial Computing, Calm Technology)\n3. Propose 3+ concrete UI design proposals applying selected keywords to main features (e.g., dashboard, search, booking)\n4. Reference domain-specific application examples and reflect industry-specific best practices\n5. Evaluate implementation difficulty (S/M/L), expected UX improvement effect, and technical feasibility for each proposal',
fmt:_ja?'## UX提案\n| # | キーワード | 適用機能 | 具体的設計 | 難易度 | 効果 | 実現可能性 |\n\n## Polymorphic Engineフロー\n```mermaid\ngraph LR\n  Sensing --> Thinking --> Morphing --> Acting\n```\n\n## 実装ロードマップ\n| Phase | 機能 | キーワード | 期待効果 | 工数 |':'## UX Proposals\n| # | Keyword | Feature | Design | Difficulty | Effect | Feasibility |\n\n## Polymorphic Engine Flow\n```mermaid\ngraph LR\n  Sensing --> Thinking --> Morphing --> Acting\n```\n\n## Implementation Roadmap\n| Phase | Feature | Keyword | Effect | Effort |'},
cognitive:{icon:'🧠',label:_ja?'認知負荷分析':'Cognitive Load Analysis',desc:_ja?'docs/60で認知負荷とフロー状態を設計':'Cognitive load & flow state design from docs/60',
sys:_ja?'あなたは認知科学とUXの専門家です。docs/60_methodology_intelligence.mdの認知負荷最小化・フロー状態設計の観点から、UI/UX改善を提案してください。':'You are a cognitive science and UX expert. Propose UI/UX improvements from cognitive load minimization and flow state design perspectives in docs/60_methodology_intelligence.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/60_methodology_intelligence.mdの12設計アプローチ適合度評価から、「認知負荷最小化」「フロー状態設計」の適合度を確認\n2. 主要画面（ダッシュボード、一覧、詳細、フォーム）ごとに認知負荷を分析（情報量、選択肢数、階層深度）\n3. フロー状態を阻害する要素（中断、待機時間、複雑な操作）を特定\n4. 認知負荷削減策（プログレッシブ開示、デフォルト値、スマート検索）を提案\n5. フロー状態維持策（キーボードショートカット、オートセーブ、コンテキスト保持）を提案\n6. docs/26_design_system.mdのデザインシステムとの整合性を検証':'Follow these steps:\n1. Check fit for "Cognitive Load Min." and "Flow State Design" from 12 design approaches evaluation in docs/60_methodology_intelligence.md\n2. Analyze cognitive load for each main screen (dashboard, list, detail, form): info volume, choice count, hierarchy depth\n3. Identify flow state inhibitors (interruptions, wait time, complex operations)\n4. Propose cognitive load reduction measures (progressive disclosure, default values, smart search)\n5. Propose flow state maintenance measures (keyboard shortcuts, auto-save, context preservation)\n6. Verify consistency with design system in docs/26_design_system.md',
fmt:_ja?'## 認知負荷分析\n| 画面 | 情報量 | 選択肢数 | 階層深度 | 認知負荷スコア(1-10) | 改善案 |\n\n## フロー状態阻害要因\n| # | 要因 | 影響度 | 削減策 | 期待効果 |\n\n## 改善ロードマップ\n| 優先度 | 施策 | 対象画面 | 工数 | 効果 |':'## Cognitive Load Analysis\n| Screen | Info Volume | Choices | Depth | Load Score(1-10) | Improvement |\n\n## Flow State Inhibitors\n| # | Inhibitor | Impact | Reduction | Effect |\n\n## Improvement Roadmap\n| Priority | Measure | Target Screen | Effort | Effect |'},
genome:{icon:'🧩',label:_ja?'プロンプトゲノム分析':'Prompt Genome Analysis',desc:_ja?'docs/65でCRITERIA 8軸プロンプト品質を最適化':'Optimize prompt quality with CRITERIA 8-axis from docs/65',
sys:_ja?'あなたはプロンプトエンジニアリングの専門家です。docs/65_prompt_genome.mdのCRITERIA 8軸フレームワーク（Context/Role/Instructions/Thought Process/Execution Rules/Reflection/Iteration/Adaptation）を基に、プロンプト品質の分析と改善提案を行います。':'You are a prompt engineering expert. Analyze prompt quality and provide improvement proposals based on the CRITERIA 8-axis framework (Context/Role/Instructions/Thought Process/Execution Rules/Reflection/Iteration/Adaptation) from docs/65_prompt_genome.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/65_prompt_genome.mdのプロンプトDNAプロファイル（ドメイン・アプローチ・成熟度レベル）を確認\n2. 現在使用しているプロンプトをCRITERIA 8軸で評価（各軸1-5点、加重スコアを算出）\n3. スコアが低い軸（3点以下）の改善案を具体的に提案\n4. フェーズ別プロンプトライブラリから最適なテンプレートを選択\n5. 成熟度レベル（Level 1/2/3）に適した適応バリアントを提案\n6. docs/67_prompt_composition_guide.mdの4層アーキテクチャ（Meta/Structure/Content/Adaptation）を適用した複合プロンプトを設計':'Follow these steps:\n1. Review Prompt DNA profile (domain, approach, maturity level) from docs/65_prompt_genome.md\n2. Evaluate current prompts on CRITERIA 8 axes (1-5 points each, calculate weighted score)\n3. Propose specific improvements for low-scoring axes (3 points or below)\n4. Select optimal templates from phase-by-phase prompt library\n5. Propose maturity-level-appropriate variants (Level 1/2/3)\n6. Design composite prompts applying 4-layer architecture (Meta/Structure/Content/Adaptation) from docs/67_prompt_composition_guide.md',
fmt:_ja?'## CRITERIA評価\n| 軸 | 重み | 現スコア | 目標 | 改善案 |\n|-----|------|---------|------|--------|\n| Context | 15% | ? | 5 | ... |\n\n**加重総スコア**: ? / 5\n\n## 改善後プロンプト\n```\n[CRITERIA準拠の改善プロンプト]\n```\n\n## 4層設計\n| Layer | 内容 |\n|-------|------|\n| Meta | ... |\n| Structure | ... |\n| Content | ... |\n| Adaptation | ... |':'## CRITERIA Evaluation\n| Axis | Weight | Current | Target | Improvement |\n|------|--------|---------|--------|-------------|\n| Context | 15% | ? | 5 | ... |\n\n**Weighted Total Score**: ? / 5\n\n## Improved Prompt\n```\n[CRITERIA-compliant improved prompt]\n```\n\n## 4-Layer Design\n| Layer | Content |\n|-------|--------|\n| Meta | ... |\n| Structure | ... |\n| Content | ... |\n| Adaptation | ... |'},
react_debug:{icon:'🔄',label:_ja?'ReActデバッグ':'ReAct Debug Loop',desc:_ja?'Reason→Act→Observe→Verifyの自律デバッグサイクル':'Autonomous debug cycle with Reason→Act→Observe→Verify',
sys:_ja?'あなたはReActプロトコルの専門家です。docs/70_react_workflow.mdのReAct 4ステージ（Reason→Act→Observe→Verify）と自己デバッグループを用いて、問題を自律的に診断・修正します。':'You are a ReAct protocol expert. Diagnose and fix problems autonomously using the 4-stage ReAct cycle (Reason→Act→Observe→Verify) and self-debug loop from docs/70_react_workflow.md.',
prompt:_ja?'以下のReActサイクルで問題を解決してください:\n\n**Reason (思考)**: 現在のエラー・バグ・問題を分析。根本原因の仮説を3つ列挙。\n\n**Act (実行)**: 最も可能性が高い仮説を検証するアクションを実行。docs/70_react_workflow.mdのフェーズ別ツール選定を参照。\n\n**Observe (観察)**: アクション結果を客観的に記録。期待と実際の差異を特定。\n\n**Verify (検証)**: 問題が解決されたか成功基準（型安全・テスト通過・lint通過）で確認。\n\n失敗の場合は自己デバッグループ（最大3反復）を実施。3回失敗したら人間へエスカレーション。':'Resolve the problem using the following ReAct cycle:\n\n**Reason**: Analyze current error/bug/problem. List 3 root cause hypotheses.\n\n**Act**: Execute action to test most likely hypothesis. Reference phase-specific tool selection from docs/70_react_workflow.md.\n\n**Observe**: Objectively record action results. Identify gaps between expected and actual.\n\n**Verify**: Confirm problem resolved against success criteria (type safety, tests pass, lint pass).\n\nIf failed, run self-debug loop (max 3 iterations). Escalate to human after 3 failures.',
fmt:_ja?'## Reason\n**根本原因仮説:**\n1. ...\n2. ...\n3. ...\n\n## Act\n**実行:** `{tool} {args}`\n\n## Observe\n**結果:** ...\n**期待との差異:** ...\n\n## Verify\n**成功基準達成:** [ ] 型安全 [ ] テスト通過 [ ] lint通過\n**次のアクション:** ...\n\n---\n_iter 1/3 — 解決 / 未解決 → 次反復_':'## Reason\n**Root Cause Hypotheses:**\n1. ...\n2. ...\n3. ...\n\n## Act\n**Execute:** `{tool} {args}`\n\n## Observe\n**Result:** ...\n**Gap from expected:** ...\n\n## Verify\n**Success criteria met:** [ ] Type safe [ ] Tests pass [ ] Lint pass\n**Next action:** ...\n\n---\n_iter 1/3 — Resolved / Unresolved → next iteration_'},
prompt_ops:{icon:'🔧',label:_ja?'プロンプトOpsレビュー':'Prompt Ops Review',desc:_ja?'プロンプト品質をCRITERIA基準で評価・改善提案':'Evaluate prompt quality against CRITERIA and suggest improvements',
sys:_ja?'あなたはLLMOpsとプロンプトCI/CDの専門家です。docs/69_prompt_ops_pipeline.md（ライフサイクル管理）、docs/71_llmops_dashboard.md（メトリクス）、docs/72_prompt_registry.md（テンプレートカタログ）を参照し、プロンプトの運用品質を総合評価します。':'You are an LLMOps and Prompt CI/CD expert. Comprehensively evaluate prompt operational quality by referencing docs/69_prompt_ops_pipeline.md (lifecycle management), docs/71_llmops_dashboard.md (metrics), and docs/72_prompt_registry.md (template catalog).',
prompt:_ja?'以下の手順でプロンプトの運用品質を評価・改善してください:\n\n1. **ライフサイクルチェック** (docs/69): 対象プロンプトが5ステージ（起草→レビュー→テスト→デプロイ→監視）のどこにあるかを特定。現ステージのチェックリストを評価。\n\n2. **LLMOpsメトリクス評価** (docs/71): 現在のAI成熟度レベルに対応するスタックのメトリクス（成功率・コスト・レイテンシ）を確認し、閾値との差異を計算。\n\n3. **CRITERIA連携スコアリング** (docs/65 + docs/71): CRITERIA 8軸の現スコアをLLMOpsメトリクスにマッピング。スコアが低い軸（3以下）の改善案を提示。\n\n4. **Registryへの登録提案** (docs/72): Template-ID命名規則に従い、バージョン番号・CRITERIA目標スコアをドラフト。\n\n5. **A/Bテスト計画**: 改善後バージョンとの比較計画を作成（メトリクス定義・有意差基準）。':'Evaluate and improve prompt operational quality following these steps:\n\n1. **Lifecycle check** (docs/69): Identify which of 5 stages (Draft→Review→Test→Deploy→Monitor) the target prompt is in. Evaluate current stage checklist.\n\n2. **LLMOps metrics evaluation** (docs/71): Review stack metrics for current AI maturity level (success rate, cost, latency) and calculate gap from thresholds.\n\n3. **CRITERIA-integrated scoring** (docs/65 + docs/71): Map CRITERIA 8-axis current scores to LLMOps metrics. Present improvements for low-scoring axes (3 or below).\n\n4. **Registry registration proposal** (docs/72): Draft Template-ID following naming convention with version number and CRITERIA target scores.\n\n5. **A/B test plan**: Create comparison plan for improved version (metric definitions, significance thresholds).',
fmt:_ja?'## ライフサイクル状況\n現ステージ: {Draft/Review/Test/Deploy/Monitor}\n未達チェック: [ ] ...\n\n## LLMOpsメトリクス\n| メトリクス | 現在値 | 閾値 | 評価 |\n|-----------|--------|------|------|\n\n## CRITERIA改善提案\n| 軸 | 現スコア | 目標 | 改善案 |\n\n## Template-ID案\n`{DOMAIN}-{PHASE}-{USECASE}-v{X}.{Y}.{Z}`\n\n## A/Bテスト計画\n- 検証メトリクス: ...\n- 有意差基準: CRITERIA改善率 ≥10%':'## Lifecycle Status\nCurrent stage: {Draft/Review/Test/Deploy/Monitor}\nFailing checks: [ ] ...\n\n## LLMOps Metrics\n| Metric | Current | Threshold | Status |\n|--------|---------|-----------|--------|\n\n## CRITERIA Improvement Proposals\n| Axis | Current | Target | Improvement |\n\n## Template-ID Proposal\n`{DOMAIN}-{PHASE}-{USECASE}-v{X}.{Y}.{Z}`\n\n## A/B Test Plan\n- Validation metric: ...\n- Significance threshold: CRITERIA improvement ≥10%'},
maturity:{icon:'📊',label:_ja?'AI成熟度レビュー':'AI Maturity Review',desc:_ja?'docs/66でチームAI成熟度を評価し次のレベルへ':'Assess team AI maturity and level up from docs/66',
sys:_ja?'あなたは組織のAI採用・成熟度向上のコンサルタントです。docs/66_ai_maturity_assessment.mdの5次元評価マトリクスを基に、現在のAI成熟度を診断し、次のレベルへの移行計画を策定します。':'You are a consultant for organizational AI adoption and maturity improvement. Diagnose current AI maturity and develop a transition plan to the next level based on the 5-dimension evaluation matrix from docs/66_ai_maturity_assessment.md.',
prompt:_ja?'以下の手順で実行:\n1. docs/66_ai_maturity_assessment.mdの現在の成熟度レベル（Level 1/2/3）と特徴を確認\n2. 5次元評価マトリクス（プロンプト設計力・AI協調力・品質保証・チームプラクティス・効果測定）で現在のチーム状況を自己評価（各次元1-3点）\n3. 各次元のギャップ分析（現状 vs 目標レベル）を実施\n4. 段階的採用ロードマップ（フェーズ1→2→3）の現在地を特定\n5. 次レベルへの最優先アクション3つを提案（工数・効果・リスクを評価）\n6. docs/68_prompt_kpi_dashboard.mdのKPI指標と照合し、測定可能な成功基準を設定':'Follow these steps:\n1. Review current maturity level (Level 1/2/3) and characteristics from docs/66_ai_maturity_assessment.md\n2. Self-assess current team status on 5-dimension evaluation matrix (prompt design, AI collaboration, QA, team practices, measurement): 1-3 points each\n3. Conduct gap analysis for each dimension (current vs target level)\n4. Identify current position in phased adoption roadmap (Phase 1→2→3)\n5. Propose top 3 priority actions for next level (evaluate effort, effect, and risk)\n6. Set measurable success criteria by cross-referencing KPI metrics in docs/68_prompt_kpi_dashboard.md',
fmt:_ja?'## 現状診断\n| 次元 | 現状 | 目標 | ギャップ | 優先度 |\n|------|------|------|---------|--------|\n| プロンプト設計力 | Level ? | Level ? | ... | P? |\n\n**総合成熟度**: Level ? → Level ?\n\n## 次レベルへの3大アクション\n1. **アクション1**: ... (工数: M, 効果: 高)\n2. **アクション2**: ...\n3. **アクション3**: ...\n\n## 成功KPI\n| KPI | 現状値 | 目標値 | 計測方法 |':'## Current Assessment\n| Dimension | Current | Target | Gap | Priority |\n|-----------|---------|--------|-----|----------|\n| Prompt Design | Level ? | Level ? | ... | P? |\n\n**Overall Maturity**: Level ? → Level ?\n\n## Top 3 Actions for Next Level\n1. **Action 1**: ... (Effort: M, Effect: High)\n2. **Action 2**: ...\n3. **Action 3**: ...\n\n## Success KPIs\n| KPI | Current | Target | Measurement |'},
ux_audit:{icon:'🔬',label:_ja?'UX習熟度監査':'UX Proficiency Audit',desc:_ja?'7段階ペルソナで自アプリのUX乖離を発見':'Discover UX gaps with 7-level personas',
sys:_ja?'あなたは7段階のユーザー習熟度（Lv.0完全初心者〜Lv.6伝道者）のそれぞれのペルソナを順番に演じるUX監査AIです。':'You are a UX audit AI that plays each persona of 7 user proficiency levels (Lv.0 Absolute Beginner to Lv.6 Evangelist) in order.',
prompt:_ja?'以下のプロジェクト仕様に基づき、各レベルごとに:\n① このアプリの第一印象/使い心地を評価（そのLvの視点で）\n② つまずきポイントを3つ特定\n③ 離脱リスクを判定（高/中/低）\n④ 改善アクションを優先度順に3つ提案\n\n全7レベル完了後、「構造的乖離マップ」を作成:\n- どのレベル間に最大のUXギャップがあるか\n- 最も離脱リスクが高いレベルはどこか\n- 投資対効果が最も高い改善施策TOP5\n\n対象プロジェクト情報は以下のドキュメントを参照してください。':'Based on the following project spec, for each level:\n① Evaluate this app\'s first impression/usability (from that Lv\'s perspective)\n② Identify 3 stumbling points\n③ Determine dropout risk (High/Medium/Low)\n④ Propose 3 improvement actions in priority order\n\nAfter all 7 levels, create a "Structural Gap Map":\n- Between which levels is the largest UX gap?\n- Which level has the highest dropout risk?\n- TOP5 improvement measures with best ROI\n\nRefer to the following project documents for context.',
fmt:_ja?'## Lv別UX監査\n| Lv | ペルソナ | 第一印象 | つまずき | 離脱リスク | 改善アクション |\n\n## 構造的乖離マップ\n| ギャップ区間 | 深刻度 | 改善施策 | 投資対効果 |\n\n## TOP5改善施策\n| # | 施策 | 対象Lv | 効果 | 工数 | 優先度 |':'## Lv UX Audit\n| Lv | Persona | First Impression | Stumbling Points | Dropout Risk | Improvement Actions |\n\n## Structural Gap Map\n| Gap Segment | Severity | Improvement | ROI |\n\n## TOP5 Improvements\n| # | Measure | Target Lv | Effect | Effort | Priority |'},
};
/* ── Header ── */
let h=`<div class="exp-header"><h3>🤖 ${_ja?'AI プロンプトランチャー':'AI Prompt Launcher'} <button class="btn btn-xs" onclick="showManual('launcher-guide')">📖 ${_ja?'使い方':'Manual'}</button></h3>
<p>${_ja
?'生成した仕様書をAIツールに一括投入。テンプレートを選んでコピー'
:'Feed generated specs to AI tools. Pick a template and copy'}</p></div>`;
/* ── Token overview ── */
if(hasFiles){
h+=`<div class="launch-stats">
<div class="launch-stat"><span class="launch-num">${fKeys.length}</span><span class="launch-lbl">${_ja?'ファイル':'Files'}</span></div>
<div class="launch-stat"><span class="launch-num">${totalTokens.toLocaleString()}</span><span class="launch-lbl">${_ja?'推定トークン':'Est. Tokens'}</span></div>
<div class="launch-stat"><span class="launch-num">${Object.keys(folders).length}</span><span class="launch-lbl">${_ja?'フォルダ':'Folders'}</span></div>
</div>`;
/* ── Folder breakdown ── */
h+=`<div class="launch-folders"><h4>${_ja?'📂 フォルダ別トークン':'📂 Tokens by Folder'}</h4>`;
const sortedDirs=Object.entries(folders).sort((a,b)=>b[1].tokens-a[1].tokens);
sortedDirs.forEach(([dir,info])=>{
const pct=Math.round(info.tokens/totalTokens*100);
h+=`<div class="launch-folder-row">
<label><input type="checkbox" checked data-dir="${dir}" onchange="updateLaunchPreview()"> <strong>${dir}/</strong></label>
<span>${info.files.length} ${_ja?'ファイル':'files'} · ${info.tokens.toLocaleString()} tok (${pct}%)</span>
<div class="launch-bar"><div class="launch-bar-fill" style="width:${pct}%"></div></div>
</div>`;
});
h+=`</div>`;
/* ── Model fit indicator ── */
const models=[
{name:'Claude Opus 4.6',ctx:1000000,icon:'🟣'},
{name:'Claude Sonnet 4.5',ctx:200000,icon:'🔵'},
{name:'GPT-5.2',ctx:400000,icon:'🟢'},
{name:'Gemini 2.5 Pro',ctx:1000000,icon:'🟡'},
{name:'Claude Haiku 4.5',ctx:200000,icon:'🟣'},
{name:'Gemini 3 Flash',ctx:200000,icon:'🟡'},
];
h+=`<div class="launch-models"><h4>${_ja?'🤖 モデル適合':'🤖 Model Fit'}</h4>`;
models.forEach(m=>{
const pct=Math.min(100,Math.round(totalTokens/m.ctx*100));
const ok=pct<80;
h+=`<div class="launch-model-row">${m.icon} ${m.name} <span class="launch-model-pct ${ok?'launch-ok':'launch-warn'}">${pct}% ${ok?(_ja?'余裕':'OK'):(pct<100?(_ja?'注意':'tight'):(_ja?'超過':'over'))}</span></div>`;
});
h+=`</div>`;
} else {
h+=`<div class="empty-preview-sm">${_ja?'⚠️ まず質問に回答してファイルを生成してください':'⚠️ Answer questions first to generate files'}</div>`;
}
/* ── Prompt templates (ordered by dev lifecycle) ── */
const AI_REC={review:'Gemini',arch:'Gemini',reverse:'Claude',implement:'Copilot',api:'Copilot',i18n:'Copilot',test:'Copilot',qa:'Copilot',security:'Gemini',a11y:'Gemini',perf:'Gemini',metrics:'Gemini',refactor:'Claude',debug:'Copilot',incident:'Copilot',ops:'Gemini',docs:'Claude',migrate:'Claude',cicd:'Copilot',growth:'ChatGPT',strategy:'Claude',methodology:'Claude',brainstorm:'ChatGPT',ux_journey:'Claude',ai_model_guide:'Gemini',industry:'Gemini',nextgen:'ChatGPT',cognitive:'Claude',genome:'Claude',maturity:'Claude',react_debug:'Copilot',prompt_ops:'Claude',enterprise_arch:'Gemini',workflow_audit:'Claude',risk:'Claude',onboard:'Claude',ux_audit:'Claude'};
const templateOrder=['review','arch','reverse','implement','api','i18n','test','qa','security','a11y','perf','metrics','refactor','debug','incident','ops','docs','migrate','cicd','growth','strategy','methodology','brainstorm','ux_journey','ux_audit','ai_model_guide','industry','nextgen','cognitive','genome','maturity','react_debug','prompt_ops','enterprise_arch','workflow_audit','risk','onboard'];
// Category definition for templates
const LAUNCH_CATS_JA=[{key:'all',label:'すべて'},{key:'review',label:'🔍 レビュー・監査'},{key:'implement',label:'🚀 実装・開発'},{key:'strategy',label:'🏢 戦略・UX'},{key:'ai_prompt',label:'🤖 AI・プロンプト'},{key:'ops',label:'⚙️ Ops・運用'}];
const LAUNCH_CATS_EN=[{key:'all',label:'All'},{key:'review',label:'🔍 Review & Audit'},{key:'implement',label:'🚀 Implement & Dev'},{key:'strategy',label:'🏢 Strategy & UX'},{key:'ai_prompt',label:'🤖 AI & Prompt'},{key:'ops',label:'⚙️ Ops & DevOps'}];
const LAUNCH_CAT_MAP={review:'review',arch:'review',security:'review',a11y:'review',perf:'review',metrics:'review',risk:'review',reverse:'review',implement:'implement',api:'implement',i18n:'implement',test:'implement',qa:'implement',refactor:'implement',debug:'implement',docs:'implement',migrate:'implement',cicd:'ops',growth:'strategy',strategy:'strategy',methodology:'strategy',brainstorm:'strategy',ux_journey:'strategy',ux_audit:'strategy',ai_model_guide:'ai_prompt',industry:'strategy',nextgen:'strategy',cognitive:'strategy',genome:'ai_prompt',maturity:'ai_prompt',react_debug:'ai_prompt',prompt_ops:'ai_prompt',enterprise_arch:'review',workflow_audit:'review',incident:'ops',ops:'ops',onboard:'ops'};
// Skill-based recommendations
const LAUNCH_SKILL_REC={beginner:['implement','test','debug','brainstorm','ux_journey','docs'],intermediate:['review','implement','security','strategy','methodology','cicd','ux_audit'],advanced:['enterprise_arch','genome','react_debug','ops','arch','risk','ux_audit'],pro:['arch','ops','enterprise_arch','genome','react_debug','risk','ux_audit']};
// F1: whitelist for Lv0-1 — 8 essential templates only
const _LAUNCH_BEGINNER=new Set(['implement','test','debug','docs','brainstorm','ux_journey','review','onboard']);
const recKeys=S.skillLv<=1?LAUNCH_SKILL_REC.beginner:S.skillLv>=5?LAUNCH_SKILL_REC.pro:S.skillLv>=4?LAUNCH_SKILL_REC.advanced:LAUNCH_SKILL_REC.intermediate;
const lcats=_ja?LAUNCH_CATS_JA:LAUNCH_CATS_EN;
// Cat filter state (closure)
let _lcf='all';
h+=`<div class="launch-templates">`;
// Category filter bar (rendered as static HTML; interactivity via onclick)
h+=`<div class="launch-cat-bar" id="launchCatBar">`;
lcats.forEach(cat=>{
h+=`<button class="launch-cat-btn${cat.key==='all'?' active':''}" onclick="filterLaunchCat('${cat.key}')" data-lcat="${cat.key}">${cat.label}</button>`;
});
h+=`</div>`;
// Recommended section (skill-based top 4)
const recFiltered=recKeys.filter(k=>PT[k]).slice(0,4);
if(recFiltered.length){
h+=`<div class="launch-rec-row" id="launchRecRow"><span class="launch-rec-lbl">⭐ ${_ja?'あなたへのおすすめ':'Recommended for you'}</span>`;
recFiltered.forEach(key=>{
const t=PT[key];if(!t)return;
h+=`<button class="launch-rec-chip" onclick="selectLaunchTemplate('${key}')" title="${t.desc}">${t.icon} ${t.label}</button>`;
});
h+=`</div>`;
}
h+=`<h4>${_ja?'📋 プロンプトテンプレート':'📋 Prompt Templates'}</h4>`;
h+=`<div id="launchTplList">`;
templateOrder.forEach(key=>{
const t=PT[key];
if(!t)return;
const cat=LAUNCH_CAT_MAP[key]||'implement';
const _lHide=S.skillLv<=1&&!_LAUNCH_BEGINNER.has(key);
h+=`<div class="launch-tpl${_lHide?' launch-tpl-hidden':''}" onclick="selectLaunchTemplate('${key}')" data-lcat="${cat}"${_lHide?' style="display:none"':''}>
<div class="launch-tpl-icon">${t.icon}</div>
<div class="launch-tpl-info"><strong>${t.label}</strong><span>${t.desc}</span></div>
${AI_REC[key]?'<span class="launch-airec" title="'+(_ja?'推奨AI':'Recommended AI')+'">'+AI_REC[key]+'</span>':''}
</div>`;
});
h+=`</div>`;
if(S.skillLv<=1){h+='<button class="btn btn-xs btn-g launch-showall" onclick="document.querySelectorAll(\'.launch-tpl-hidden\').forEach(function(e){e.style.display=\'\'});this.remove()">'+(_ja?'🔽 全37テンプレートを表示':'🔽 Show all 37 templates')+'</button>';}
h+=`</div>`;
/* ── Output area ── */
h+=`<div class="launch-output" id="launchOutput">
<div class="launch-output-head">
<h4 id="launchOutputTitle"></h4>
<div class="prev-toolbar-r">
<button class="btn btn-xs btn-p" onclick="copyLaunchPrompt()">📋 ${_ja?'コピー':'Copy'}</button>
<button class="btn btn-xs btn-g" onclick="$('launchOutput').style.display='none'">✕</button>
</div>
</div>
<div class="launch-output-meta" id="launchOutputMeta"></div>
<pre class="launch-output-pre" id="launchOutputPre"></pre>
</div>`;
body.innerHTML=h;
/* ── State: store prompt templates for later use ── */
window._launchPT=PT;
window._launchFolders=folders;
window._launchFiles=files;
}
/* ── Select prompt template ── */
function selectLaunchTemplate(key){
const _ja=S.lang==='ja';
const PT=window._launchPT;
const t=PT[key];if(!t)return;
const selectedFiles=getSelectedLaunchFiles();
const content=selectedFiles.map(([k,v])=>`--- ${k} ---\n${v}`).join('\n\n');
const selTokens=Math.round(content.length/4);
const a=S.answers;const pn=S.projectName||'Project';
const ctx='Project: '+pn+'\nStack: '+(a.frontend||'N/A')+' + '+(a.backend||'N/A')+' + '+(a.database||'N/A')+'\nAuth: '+(a.auth||'N/A')+'\nEntities: '+(a.data_entities||'N/A');
const full='# System\n'+t.sys+'\n\n# Context\n'+ctx+'\n\n# Task\n'+t.prompt+'\n\n# Output Format\n'+t.fmt+'\n\n---\n\n'+content;
const out=$('launchOutput');out.style.display='block';
$('launchOutputTitle').textContent=`${t.icon} ${t.label}`;
$('launchOutputMeta').textContent=`${selectedFiles.length} ${_ja?'ファイル':'files'} · ~${selTokens.toLocaleString()} tokens`;
$('launchOutputPre').textContent=full.slice(0,2000)+(full.length>2000?`\n\n... (${_ja?'残り':'remaining'} ${(full.length-2000).toLocaleString()} chars)`:'');
window._launchFullPrompt=full;
out.scrollIntoView({behavior:'smooth',block:'nearest'});
}
/* ── Get selected files from checkboxes ── */
function getSelectedLaunchFiles(){
const checks=document.querySelectorAll('.launch-folder-row input[type=checkbox]');
const selectedDirs=new Set();
checks.forEach(c=>{if(c.checked)selectedDirs.add(c.dataset.dir);});
const files=window._launchFiles||S.files;
return Object.entries(files).filter(([k])=>{
const dir=k.includes('/')?k.split('/')[0]:'root';
return selectedDirs.has(dir);
});
}
/* ── Update preview when checkbox changes ── */
function updateLaunchPreview(){
const sel=getSelectedLaunchFiles();
const tokens=sel.reduce((s,e)=>s+Math.round(e[1].length/4),0);
// Update stats if output is showing
const meta=$('launchOutputMeta');
if(meta&&$('launchOutput').style.display!=='none'){
const _ja=S.lang==='ja';
meta.textContent=`${sel.length} ${_ja?'ファイル':'files'} · ~${tokens.toLocaleString()} tokens`;
}
}
/* ── Filter launcher templates by category ── */
function filterLaunchCat(catKey){
// Update active button
document.querySelectorAll('.launch-cat-btn').forEach(b=>{
b.classList.toggle('active',b.dataset.lcat===catKey);
});
// Show/hide template items
document.querySelectorAll('#launchTplList .launch-tpl').forEach(el=>{
const ec=el.dataset.lcat||'implement';
el.style.display=(catKey==='all'||ec===catKey)?'':'none';
});
// Show/hide recommended row based on "all" selection
const recRow=$('launchRecRow');
if(recRow)recRow.style.display=catKey==='all'?'':'none';
}
/* ── Copy to clipboard ── */
function copyLaunchPrompt(){
const _ja=S.lang==='ja';
const text=window._launchFullPrompt;
if(!text)return;
navigator.clipboard.writeText(text).then(()=>{
toast(_ja?'📋 プロンプトをコピーしました':'📋 Prompt copied to clipboard');
}).catch(()=>{
// Fallback
const ta=document.createElement('textarea');ta.value=text;
document.body.appendChild(ta);ta.select();document.execCommand('copy');ta.remove();
toast(_ja?'📋 コピー完了':'📋 Copied');
});
}
/* ── Pillar ⑥ Context Dashboard (Enhanced) ── */
function showDashboard(){
pushView({pillar:5,type:'dashboard',file:null});
const body=$('prevBody');
const _ja=S.lang==='ja';
const a=S.answers;
const fileCount=Object.keys(S.files).length||0;
const totalChars=Object.values(S.files).reduce((s,f)=>s+f.length,0);
const tokens=Math.round(totalChars/4);
const answered=Object.keys(a).length;
const _adv=S.skillLv>=3;
let h=`<div class="dash-head"><h3>📊 Context Dashboard</h3><p>${_ja?'プロジェクトのコンテキスト情報を一覧':'Project context overview'}</p></div>`;
// Backup reminder banner
const lastExp=_lsGet('devforge-last-export');
const daysSince=lastExp?Math.floor((Date.now()-new Date(lastExp).getTime())/86400000):-1;
if(daysSince<0){
h+=`<div class="dash-backup dash-backup-red"><span>⚠️ ${_ja?'まだエクスポートしていません — データはブラウザのみに保存されています':'No exports yet — data only exists in this browser'}</span><button class="btn btn-xs btn-p" onclick="exportProject();_lsSet('devforge-last-export',new Date().toISOString());">📤 ${_ja?'今すぐ保存':'Export Now'}</button></div>`;
} else if(daysSince>=3){
h+=`<div class="dash-backup dash-backup-yellow"><span>💾 ${_ja?'最終エクスポート: '+daysSince+'日前':'Last export: '+daysSince+' days ago'}</span><button class="btn btn-xs btn-s" onclick="exportProject();_lsSet('devforge-last-export',new Date().toISOString());">📤 ${_ja?'バックアップ':'Backup'}</button></div>`;
}

// Usage guide card
if(!_lsGet('devforge-guide-dismiss')){
h+=`<div class="dash-backup dash-guide"><span>🚀 ${_ja?'生成ファイルの活用ガイドを確認しましょう':'Check the generated files usage guide'}</span><button class="btn btn-xs btn-p" onclick="showPostGenGuide(true)">${_ja?'ガイドを見る':'View Guide'}</button><button class="btn btn-xs btn-s" onclick="showManual('workflow')">${_ja?'📘 手順':'📘 Workflow'}</button><button class="btn btn-xs btn-g" onclick="this.closest('.dash-backup').remove();_lsSet('devforge-guide-dismiss','1')">✕</button></div>`;
}

// Summary stats
h+=`<div class="ctx-summary">
<div class="ctx-stat"><div class="num">${fileCount}</div><div class="lbl">${_ja?'生成ファイル':'Files'}</div></div>
<div class="ctx-stat"><div class="num">${Math.round(tokens).toLocaleString()}</div><div class="lbl">${_ja?'推定トークン':'Est. Tokens'}</div></div>
<div class="ctx-stat"><div class="num">${answered}</div><div class="lbl">${_ja?'回答済み質問':'Answered'}</div></div>
<div class="ctx-stat"><div class="num">${TECH_DB.length}</div><div class="lbl">${_ja?'技術DB':'Tech DB'}</div></div>
</div>`;
// Lv3+ Power Shortcuts
if(_adv){
const _scs=_ja?[
['Ctrl+B','サイドバー 開/閉'],
['Ctrl+K','コマンドパレット（ファイル検索・アクション実行）'],
['Ctrl+Shift+C','全ファイルをAI向けMarkdownでコピー'],
]:[
['Ctrl+B','Toggle sidebar'],
['Ctrl+K','Command palette (search files & run actions)'],
['Ctrl+Shift+C','Copy all files as AI-ready Markdown'],
];
h+='<details class="dash-advanced" open><summary class="dash-adv-toggle">⌨️ '+(_ja?'パワーショートカット (Lv.3+)':'Power Shortcuts (Lv.3+)')+'</summary>';
h+='<div class="dash-shortcuts">';
_scs.forEach(function(sc){h+='<div class="dash-sc-row"><kbd class="dash-sc-key">'+sc[0]+'</kbd><span class="dash-sc-desc">'+sc[1]+'</span></div>';});
h+='</div></details>';
}
// Model fit analysis (advanced — collapsed for beginners)
h+=(_adv?'<details class="dash-advanced" open>':'<details class="dash-advanced">')+'<summary class="dash-adv-toggle">'+(_ja?'🔬 AI モデル & スタック分析':'🔬 AI Model & Stack Analysis')+'</summary>';
const models=[
{name:'Claude Opus 4.6',ctx:1000000,color:'var(--accent)'},
{name:'Claude Sonnet 4.5',ctx:200000,color:'var(--accent-2)'},
{name:'GPT-5.2',ctx:400000,color:'var(--success)'},
{name:'Gemini 2.5 Pro',ctx:1000000,color:'var(--warn)'},
{name:'Claude Haiku 4.5',ctx:200000,color:'var(--accent)'},
{name:'Gemini 3 Flash',ctx:200000,color:'var(--warn)'},
];
h+='<h4 class="dash-h4">🤖 '+(_ja?'モデル適合度':'Model Fit')+'</h4><div class="model-grid">';
models.forEach(m=>{
const pct=Math.min(100,Math.round(tokens/m.ctx*100));
const fit=pct<80?'high':pct<95?'mid':'low';
const fitClass=fit==='high'?'fit-high':fit==='mid'?'fit-mid':'fit-low';
h+=`<div class="model-card"><h4>${m.name}</h4><div class="fit ${fitClass}">${fit==='high'?(_ja?'\u2705 適合':'\u2705 Fit'):fit==='mid'?(_ja?'\u26A0\uFE0F 注意':'\u26A0\uFE0F Caution'):(_ja?'\u274C 超過':'\u274C Over')}</div>
<div class="dash-model-ctx">${_ja?'コンテキスト':'Context'}: ${(m.ctx/1000).toFixed(0)}K tokens</div>
<div class="ctx-bar"><div class="ctx-bar-fill" style="width:${pct}%;background:${m.color}"></div></div>
<div class="dash-model-pct">${pct}% ${_ja?'使用':'used'}</div></div>`;
});
h+='</div>';
// File size breakdown by pillar
if(fileCount>0){
h+='<h4 class="dash-h4-mt">📂 '+(_ja?'ファイルサイズ分布':'File Size Distribution')+'</h4>';
const cats=_ja?{'SDD (.spec/)':0,'DevContainer':0,'MCP':0,'AIルール':0,'Roadmap':0,'Docs':0,'Common':0}:{'SDD (.spec/)':0,'DevContainer':0,'MCP':0,'AI Rules':0,'Roadmap':0,'Docs':0,'Common':0};
Object.entries(S.files).forEach(([p,c])=>{
const len=c.length;
if(p.startsWith('.spec/'))cats['SDD (.spec/)']+=len;
else if(p.startsWith('.devcontainer/'))cats['DevContainer']+=len;
else if(p.includes('mcp'))cats['MCP']+=len;
else if(p.startsWith('roadmap/'))cats['Roadmap']+=len;
else if(p.startsWith('docs/'))cats['Docs']+=len;
else if(['.cursor/rules','.windsurfrules','.clinerules','CLAUDE.md','AGENTS.md'].some(x=>p.includes(x)))cats[_ja?'AIルール':'AI Rules']+=len;
else cats['Common']+=len;
});
const maxLen=Math.max(...Object.values(cats),1);
Object.entries(cats).forEach(([name,len])=>{
const pct=Math.round(len/maxLen*100);
h+=`<div class="dash-fbar-row">
<span class="dash-fbar-name">${name}</span>
<div class="dash-fbar"><div class="dash-fbar-fill" style="width:${pct}%"></div></div>
<span class="dash-fbar-size">${(len/1024).toFixed(1)}KB</span>
</div>`;
});
}
// Tech DB category breakdown — grouped bar chart
h+='<h4 class="dash-h4-mt">📊 '+(_ja?'技術マスターテーブル統計':'Tech DB Statistics')+'</h4>';
const catLabels=_ja?{lang:'言語',front:'FE',mobile:'モバイル',back:'BE',baas:'BaaS',payment:'決済/CMS',devops:'DevOps',ai:'AIツール',ai_auto:'AI自律',method:'手法',test:'テスト',api:'API',build:'ビルド',data:'データ',security:'セキュリティ'}:{lang:'Lang',front:'FE',mobile:'Mobile',back:'BE',baas:'BaaS',payment:'Payment/CMS',devops:'DevOps',ai:'AI Tools',ai_auto:'AI Auto',method:'Methods',test:'Testing',api:'API',build:'Build',data:'Data',security:'Security'};
const catCounts=TECH_DB.reduce((acc,t)=>{acc[t.cat]=(acc[t.cat]||0)+1;return acc;},{});
const dbMax=Math.max(...Object.values(catCounts));
const domGrps=_ja?[
{n:'🖥 コア開発',c:['lang','front','back','mobile'],cl:'dg-core'},
{n:'🤖 AI & 自動化',c:['ai','ai_auto'],cl:'dg-ai'},
{n:'☁️ インフラ & サービス',c:['baas','devops','payment'],cl:'dg-infra'},
{n:'🛡 品質 & 設計',c:['method','test','api','build','data','security'],cl:'dg-qa'}
]:[
{n:'🖥 Core Dev',c:['lang','front','back','mobile'],cl:'dg-core'},
{n:'🤖 AI & Automation',c:['ai','ai_auto'],cl:'dg-ai'},
{n:'☁️ Infra & Services',c:['baas','devops','payment'],cl:'dg-infra'},
{n:'🛡 Quality & Design',c:['method','test','api','build','data','security'],cl:'dg-qa'}
];
domGrps.forEach(g=>{
const items=g.c.filter(c=>catCounts[c]).map(c=>({l:catLabels[c]||c,v:catCounts[c]})).sort((a,b)=>b.v-a.v);
const sub=items.reduce((s,i)=>s+i.v,0);
h+=`<div class="dg ${g.cl}"><div class="dg-hd"><span class="dg-nm">${g.n}</span><span class="dg-sub">${sub}</span></div>`;
items.forEach(i=>{
const pct=Math.round(i.v/dbMax*100);
h+=`<div class="dg-bar"><span class="dg-lbl">${i.l}</span><div class="dg-track"><div class="dg-fill" style="width:${pct}%"></div></div><span class="dg-cnt">${i.v}</span></div>`;
});
h+='</div>';
});
h+=`<div class="dg-total"><span>📊 ${_ja?'技術マスターテーブル':'Tech Master Table'}</span><strong>${TECH_DB.length}</strong></div>`;
// Project info
h+=`<h4 class="dash-h4-mt">📋 ${_ja?'プロジェクト情報':'Project Info'}</h4><div class="dash-info">`;
const info=_ja?[['プロジェクト名',S.projectName],['フロント',a.frontend],['バック',a.backend],['DB',a.database],['デプロイ',a.deploy],['モバイル',a.mobile],['AI自律',a.ai_auto],['決済/CMS',a.payment],['駆動開発',a.dev_methods],['スキル',a.skill_level]]:[['Project',S.projectName],['Frontend',a.frontend],['Backend',a.backend],['DB',a.database],['Deploy',a.deploy],['Mobile',a.mobile],['AI Auto',a.ai_auto],['Payment/CMS',a.payment],['Dev Methods',a.dev_methods],['Skill',a.skill_level]];
info.forEach(([k,v])=>{if(v&&v!==(_ja?'（未指定）':'(Unset)')&&v!=='(Unset)')h+=`<div class="exp-row"><span class="label">${k}</span><span class="val">${esc(v)}</span></div>`;});
h+='</div>';
// Stack Synergy Score
const syn=calcSynergy(a);
const synColor=syn.overall>=75?'var(--success)':syn.overall>=50?'var(--warn)':'var(--danger)';
const synLabel=syn.overall>=75?(_ja?'High Synergy':'High Synergy'):syn.overall>=50?(_ja?'Medium Synergy':'Medium Synergy'):(_ja?'Low Synergy':'Low Synergy');
h+=`<h4 class="dash-h4-mt">⚡ ${_ja?'スタック相乗効果スコア':'Stack Synergy Score'}</h4>`;
h+=`<div class="synergy-card">`;
h+=`<div class="synergy-header"><div class="synergy-label">${synLabel}</div><div class="synergy-score" style="background:${synColor}20;color:${synColor};">${syn.overall}</div></div>`;
h+=`<div class="synergy-bar"><div class="synergy-bar-fill" style="width:${syn.overall}%;background:${synColor};"></div></div>`;
h+=`<div class="synergy-dims">`;
const dims=[
{l:_ja?'FE↔BE親和度':'FE↔BE Affinity',v:syn.d1},
{l:_ja?'エコ統一度':'Ecosystem Unity',v:syn.d2},
{l:_ja?'ドメイン適合':'Domain Fit',v:syn.d3},
{l:_ja?'デプロイ整合':'Deploy Alignment',v:syn.d4},
{l:_ja?'複雑度バランス':'Complexity Balance',v:syn.d5}
];
dims.forEach(d=>{
const c=d.v>=75?'var(--success)':d.v>=50?'var(--warn)':'var(--danger)';
h+=`<div class="synergy-dim"><span class="synergy-dim-lbl">${d.l}</span><div class="synergy-dim-bar"><div class="synergy-dim-fill" style="width:${d.v}%;background:${c};"></div></div><span class="synergy-dim-val">${d.v}</span></div>`;
});
h+=`</div>`;
if(syn.domain)h+=`<div class="synergy-domain">${_ja?'検出ドメイン':'Detected Domain'}: <strong>${syn.domain}</strong></div>`;
h+=`</div>`;
h+='</details>';
// Stack compatibility report
const compat=checkCompat(a);
const errs=compat.filter(c=>c.level==='error');
const warns=compat.filter(c=>c.level==='warn');
const infos=compat.filter(c=>c.level==='info');
const ok=8-(errs.length>0?1:0)-(warns.length>0?1:0);
h+=`<h4 class="dash-h4-mt">🔍 ${_ja?'スタック相性 & 整合性チェック':'Stack Compatibility & Consistency'}</h4>`;
if(compat.length===0){
h+=`<div class="compat-ok">✅ ${_ja?`スタック相性・意味的整合ともに問題なし（${COMPAT_RULES.length}ルール検証済）`:`No issues found (${COMPAT_RULES.length} rules verified)`}</div>`;
} else {
h+=`<div class="compat-summary"><span class="compat-s-ok">✅ ${_ja?'問題なし':'OK'}: ${COMPAT_RULES.length-compat.length}</span>`;
const fixWarns=compat.filter(c=>c.fix&&c.level==='warn');
if(warns.length)h+=`<span class="compat-s-warn">⚠️ ${_ja?'注意':'Warn'}: ${warns.length}</span>`;
if(fixWarns.length>1)h+=`<button class="btn btn-xs btn-s compat-fixlv" onclick="fixAllCompat('warn')">🔧 ${fixWarns.length}</button>`;
const fixErrs=compat.filter(c=>c.fix&&c.level==='error');
if(errs.length)h+=`<span class="compat-s-err">❌ ${_ja?'要修正':'Fix'}: ${errs.length}</span>`;
if(fixErrs.length>1)h+=`<button class="btn btn-xs btn-s compat-fixlv" onclick="fixAllCompat('error')">🔧 ${fixErrs.length}</button>`;
const fixInfos=compat.filter(c=>c.fix&&c.level==='info');
if(infos.length)h+=`<span class="compat-s-info">ℹ️ ${_ja?'参考':'Info'}: ${infos.length}</span>`;
if(fixInfos.length>1)h+=`<button class="btn btn-xs btn-s compat-fixlv" onclick="fixAllCompat('info')">🔧 ${fixInfos.length}</button>`;
const fixable=compat.filter(c=>c.fix);
if(fixable.length>1)h+=`<button class="btn btn-xs btn-p compat-fixall" onclick="fixAllCompat()">🔧 ${_ja?'一括修正 ('+fixable.length+'件)':'Fix All ('+fixable.length+')'}</button>`;
h+='</div>';
compat.forEach(c=>{
const icon=c.level==='error'?'❌':c.level==='warn'?'⚠️':'ℹ️';
const cls=c.level==='error'?'compat-error':c.level==='warn'?'compat-warn':'compat-info';
const pair=c.pair.map(p=>{const n={frontend:'FE',backend:'BE',database:'DB',deploy:'Deploy',mobile:'Mobile',orm:'ORM',ai_auto:'AI',skill_level:'Skill',payment:'Pay',dev_methods:'DevMethod',auth:'Auth',scope_out:'Scope',data_entities:'Entity',purpose:'Purpose',mvp_features:'MVP'};return n[p]||p;}).join(' ↔ ');
h+=`<div class="${cls}"><span class="compat-pair">${pair}</span><span class="compat-msg">${esc(c.msg)}</span>`;
if(c.fix)h+=`<button class="btn btn-xs btn-s compat-fix" onclick="S.answers['${escAttr(c.fix.f)}']='${escAttr(c.fix.s)}';save();showDashboard();">→ ${esc(c.fix.s)}</button>`;
h+='</div>';
});
}
h+='<h4 class="dash-h4-mt">'+(_ja?'📐 プロジェクト複雑度':'📐 Project Complexity')+'</h4>';
h+=getComplexityHTML();
// Project health score
h+=getHealthHTML(_ja,fileCount,answered);
// File Dependency Tree + File Size (advanced — collapsed for beginners)
h+=(_adv?'<details class="dash-advanced" open>':'<details class="dash-advanced">')+'<summary class="dash-adv-toggle">'+(_ja?'🔗 ファイル依存関係 & 構造':'🔗 File Dependencies & Structure')+'</summary>';
if(fileCount>0){
h+=`<h4 class="dash-h4-mt">🔗 ${_ja?'ファイル依存関係':'File Dependencies'}</h4>`;
const groups=[
{id:'spec',icon:'📋',title:_ja?'仕様理解フロー':'Spec Flow',files:[
{p:'.spec/constitution.md',l:_ja?'原則(最初に読む)':'Principles (read first)',d:0},
{p:'.spec/specification.md',l:_ja?'要件定義':'Requirements',d:1},
{p:'.spec/technical-plan.md',l:_ja?'技術計画':'Technical Plan',d:1},
{p:'.spec/tasks.md',l:_ja?'タスク分解':'Tasks',d:2},
{p:'.spec/verification.md',l:_ja?'完了基準':'Acceptance',d:2}
]},
{id:'ai',icon:'🤖',title:_ja?'AI開発フロー':'AI Dev Flow',files:[
{p:'CLAUDE.md',l:_ja?'AI設定(自動読込)':'AI config (auto-loaded)',d:0},
{p:'AI_BRIEF.md',l:_ja?'要約(最初の投入)':'Brief (first input)',d:1},
{p:'AGENTS.md',l:_ja?'Agent役割定義':'Agent roles',d:1},
{p:'.cursor/rules',l:_ja?'Cursorルール':'Cursor rules',d:1},
{p:'skills/project.md',l:_ja?'スキル定義':'Skills',d:2}
]},
{id:'qa',icon:'🧪',title:_ja?'品質・テストフロー':'QA & Test Flow',files:[
{p:'docs/28_qa_strategy.md',l:_ja?'QA戦略':'QA Strategy',d:0},
{p:'docs/32_qa_blueprint.md',l:_ja?'QA設計図':'QA Blueprint',d:1},
{p:'docs/33_test_matrix.md',l:_ja?'テストマトリクス':'Test Matrix',d:1},
{p:'docs/36_test_strategy.md',l:_ja?'テスト戦略':'Test Strategy',d:1},
{p:'docs/37_bug_prevention.md',l:_ja?'バグ防止':'Bug Prevention',d:2}
]},
{id:'rev',icon:'🔄',title:_ja?'ゴール逆算フロー':'Reverse Flow',files:[
{p:'docs/29_reverse_engineering.md',l:_ja?'ゴール定義':'Goal Definition',d:0},
{p:'docs/30_goal_decomposition.md',l:_ja?'ゴール分解':'Goal Breakdown',d:1},
{p:'docs/39_implementation_playbook.md',l:_ja?'実装パターン':'Impl Patterns',d:2},
{p:'docs/40_ai_dev_runbook.md',l:_ja?'AI運用手順':'AI Runbook',d:2}
]}
];
groups.forEach(g=>{
const count=g.files.filter(f=>S.files[f.p]).length;
h+=`<div class="fdep-group"><div class="fdep-header" onclick="toggleFdep('${g.id}')"><span class="fdep-icon">▶</span><span class="fdep-title">${g.icon} ${g.title}</span><span class="fdep-count">${count}/${g.files.length}</span></div>`;
h+=`<div class="fdep-body" id="fdep-${g.id}">`;
g.files.forEach(f=>{
const exists=!!S.files[f.p];
const ind='fdep-ind-'+f.d;
h+=`<div class="fdep-item ${ind} ${exists?'fdep-exists':'fdep-missing'}">`;
if(exists)h+=`<a href="#" onclick="event.preventDefault();previewFile('${f.p}')">● ${f.l}</a>`;
else h+=`<span>○ ${f.l}</span>`;
h+=`</div>`;
});
h+=`</div></div>`;
});
}
// File size distribution by Pillar
if(Object.keys(S.files).length>0){
const pillarMap={'.spec/':'P1 SDD','.devcontainer/':'P2 DevContainer','mcp-config':'P3 MCP','.cursor/':'P4 AI Rules','.clinerules':'P4','.windsurfrules':'P4','.gemini/':'P4','.github/':'P4','CLAUDE.md':'P4','AGENTS.md':'P4','codex-instructions':'P4','.kiro/':'P4','skills/':'P4','roadmap/':'P7 Roadmap','docs/43_security':'P12 Security','docs/44_threat':'P12 Security','docs/45_compliance':'P12 Security','docs/46_ai_security':'P12 Security','docs/47_security_testing':'P12 Security','docs/48_industry':'P13 Strategy','docs/49_tech_radar':'P13 Strategy','docs/50_stakeholder':'P13 Strategy','docs/51_operational':'P13 Strategy','docs/52_advanced':'P13 Strategy','docs/53_ops':'P14 Ops','docs/54_ops':'P14 Ops','docs/55_ops':'P14 Ops','docs/56_market':'P15 Future','docs/57_user':'P15 Future','docs/58_ecosystem':'P15 Future','docs/59_regulatory':'P15 Future','docs/60_':'P16 Dev IQ','docs/61_':'P16 Dev IQ','docs/62_':'P16 Dev IQ','docs/63_':'P16 Dev IQ','docs/64_':'P16 Dev IQ','docs/65_':'P17 Genome','docs/66_':'P17 Genome','docs/67_':'P17 Genome','docs/68_':'P17 Genome','docs/69_':'P18 Prompt Ops','docs/70_':'P18 Prompt Ops','docs/71_':'P18 Prompt Ops','docs/72_':'P18 Prompt Ops','docs/73_':'P19 Enterprise','docs/74_':'P19 Enterprise','docs/75_':'P19 Enterprise','docs/76_':'P19 Enterprise','docs/77_':'P20 CI/CD','docs/78_':'P20 CI/CD','docs/79_':'P20 CI/CD','docs/80_':'P20 CI/CD','docs/81_':'P20 CI/CD','docs/':'Docs','README.md':'Common','.gitignore':'Common','LICENSE':'Common','package.json':'Common','.ai/':'Common','.mcp/':'P3 MCP'};
const pillarSizes={};
Object.entries(S.files).forEach(([p,c])=>{
let pil='Other';
for(const[k,v]of Object.entries(pillarMap)){if(p.startsWith(k)||p.includes(k)){pil=v;break;}}
pillarSizes[pil]=(pillarSizes[pil]||0)+c.length;
});
const sorted=Object.entries(pillarSizes).sort((a,b)=>b[1]-a[1]);
const max=sorted[0]?sorted[0][1]:1;
const pillarColors={'P1 SDD':'var(--accent)','P2 DevContainer':'var(--accent-2)','P3 MCP':'var(--success)','P4 AI Rules':'var(--warn)','P5 Quality':'var(--danger)','P7 Roadmap':'var(--danger)','P9 Design System':'var(--accent)','P10 Reverse Eng':'var(--success)','P11 Impl Intelligence':'var(--accent-2)','P12 Security':'var(--danger)','P13 Strategy':'var(--warn)','P14 Ops':'var(--success)','P15 Future':'var(--accent)','P16 Dev IQ':'var(--accent-2)','P17 Genome':'var(--success)','P18 Prompt Ops':'var(--warn)','P19 Enterprise':'var(--danger)','P20 CI/CD':'var(--accent)','Docs':'var(--layer-5)','Common':'var(--text-3)'};
h+='<h4 class="dash-h4-mt">'+(_ja?'📦 ファイルサイズ分布':'📦 File Size Distribution')+'</h4>';
h+='<div class="fsize-chart">';
sorted.forEach(([pil,sz])=>{
const pct=Math.round(sz/max*100);
const kb=(sz/1024).toFixed(1);
const col=pillarColors[pil]||'var(--text-3)';
h+=`<div class="fsize-row"><span class="fsize-lbl">${pil}</span><div class="fsize-bar-wrap"><div class="fsize-bar" style="width:${pct}%;background:${col}"></div></div><span class="fsize-val">${kb}KB</span></div>`;
});
h+='</div>';
}
h+='</details>';
// Tech DB button
h+=`<div class="dash-center"><button class="btn btn-s" onclick="renderTechDB()">📊 ${_ja?'技術マスターテーブル':'Tech Master Table'} (${TECH_DB.length} ${_ja?'エントリ':'entries'})</button></div>`;
// Lv4+ Pillar selective export
if(S.skillLv>=4&&fileCount>0){
const _pg=_ja?[
{l:'① SDD 仕様書',p:'.spec/'},
{l:'② DevContainer',p:'.devcontainer/'},
{l:'③ MCP設定',p:'mcp-config'},
{l:'④ AIルール',p:'CLAUDE.md,.cursor/,.clinerules,.windsurfrules,AGENTS.md,AI_BRIEF.md,.gemini/,.kiro/,codex-instructions'},
{l:'⑦ ロードマップ',p:'roadmap/'},
{l:'⑫ セキュリティ',p:'docs/43_,docs/44_,docs/45_,docs/46_,docs/47_'},
{l:'docs/ 全文書',p:'docs/'},
]:[
{l:'① SDD Specs',p:'.spec/'},
{l:'② DevContainer',p:'.devcontainer/'},
{l:'③ MCP Config',p:'mcp-config'},
{l:'④ AI Rules',p:'CLAUDE.md,.cursor/,.clinerules,.windsurfrules,AGENTS.md,AI_BRIEF.md,.gemini/,.kiro/,codex-instructions'},
{l:'⑦ Roadmap',p:'roadmap/'},
{l:'⑫ Security',p:'docs/43_,docs/44_,docs/45_,docs/46_,docs/47_'},
{l:'All docs/',p:'docs/'},
];
h+='<h4 class="dash-h4-mt">📦 '+(_ja?'ピラー別エクスポート (Lv.4+)':'Pillar Export (Lv.4+)')+'</h4>';
h+='<div class="dash-pex-grid">';
_pg.forEach(function(g){
var _prefs=g.p.split(',');
var _cnt=Object.keys(S.files).filter(function(f){return _prefs.some(function(pr){return f.startsWith(pr)||f.includes(pr);});}).length;
if(_cnt===0)return;
h+='<button class="btn btn-s dash-pex-btn" onclick="exportPillarGroup(\''+escAttr(g.p)+'\')">'+esc(g.l)+' <span class="dash-pex-cnt">'+_cnt+'</span></button>';
});
h+='</div>';
}
body.innerHTML=h;
}
function getHealthHTML(_ja,fileCount,answered){
const qs=getQ();
let totalQ=0;
for(let p=1;p<=3;p++){
if(qs[p])qs[p].questions.forEach(q=>{
if(!isQActive(q))return;
totalQ++;
});
}
const answerPct=totalQ?Math.round(answered/totalQ*100):0;
// Pillar coverage
const pillarChecks=[
{key:'.spec/',label:_ja?'①SDD':'①SDD'},
{key:'.devcontainer/',label:_ja?'②DevContainer':'②DevContainer'},
{key:'mcp',label:_ja?'③MCP':'③MCP'},
{key:'CLAUDE.md',label:_ja?'④AIルール':'④AI Rules'},
{key:'docs/32_',label:_ja?'⑤品質インテリジェンス':'⑤Quality Intelligence'},
{key:'roadmap/',label:_ja?'⑦ロードマップ':'⑦Roadmap'},
{key:'docs/26_',label:_ja?'⑨デザインシステム':'⑨Design System'},
{key:'docs/29_',label:_ja?'⑩リバースEng':'⑩Reverse Eng'},
{key:'docs/39_',label:_ja?'⑪実装ガイド':'⑪Impl Guide'},
{key:'docs/43_',label:_ja?'⑫セキュリティ':'⑫Security'},
{key:'docs/48_',label:_ja?'⑬戦略インテリジェンス':'⑬Strategic Intelligence'},
{key:'docs/53_',label:_ja?'⑭運用インテリジェンス':'⑭Ops Intelligence'},
{key:'docs/56_',label:_ja?'⑮未来戦略':'⑮Future Strategy'},
{key:'docs/60_',label:_ja?'⑯開発IQ':'⑯Dev IQ'},
{key:'docs/65_',label:_ja?'⑰プロンプトゲノム':'⑰Prompt Genome'},
{key:'docs/69_',label:_ja?'⑱Prompt Ops':'⑱Prompt Ops'},
{key:'docs/73_',label:_ja?'⑲Enterprise':'⑲Enterprise'},
{key:'docs/77_',label:_ja?'⑳CI/CD':'⑳CI/CD'},
];
const fileKeys=Object.keys(S.files);
let pillarOK=0;
const pillarResults=pillarChecks.map(pc=>{
const ok=fileKeys.some(f=>f.includes(pc.key));
if(ok)pillarOK++;
return {label:pc.label,ok};
});
const pillarPct=pillarChecks.length?Math.round(pillarOK/pillarChecks.length*100):0;
// Required files
const requiredFiles=['constitution.md','tasks.md','CLAUDE.md'];
let reqOK=0;
const reqResults=requiredFiles.map(rf=>{
const ok=fileKeys.some(f=>f.endsWith(rf));
if(ok)reqOK++;
return {name:rf,ok};
});
const reqPct=requiredFiles.length?Math.round(reqOK/requiredFiles.length*100):0;
// Overall score
const score=Math.round(answerPct*0.3+pillarPct*0.4+reqPct*0.3);
const color=score>=80?'var(--success)':score>=50?'var(--warn)':'var(--danger)';
const label=score>=80?(_ja?'✅ 良好':'✅ Healthy'):score>=50?(_ja?'⚠️ 部分的':'⚠️ Partial'):(_ja?'🔴 不完全':'🔴 Incomplete');
let h=`<h4 class="dash-h4-mt">🏥 ${_ja?'プロジェクト健全性':'Project Health'}</h4>`;
h+=`<div class="complexity-card"><div class="complexity-header"><div><div class="dash-total complexity-label">${label}</div></div><div class="complexity-score" style="background:${color}20;color:${color};">${score}</div></div>`;
h+=`<div class="complexity-bar"><div class="complexity-fill" style="width:${score}%;background:${color};"></div></div>`;
h+=`<div class="complexity-grid">`;
h+=`<div class="complexity-item"><span>${_ja?'回答完了率':'Answers'}</span><span>${answerPct}%</span></div>`;
h+=`<div class="complexity-item"><span>${_ja?'Pillarカバー':'Pillar Coverage'}</span><span>${pillarOK}/${pillarChecks.length}</span></div>`;
h+=`<div class="complexity-item"><span>${_ja?'必須ファイル':'Required Files'}</span><span>${reqOK}/${requiredFiles.length}</span></div>`;
h+=`<div class="complexity-item"><span>${_ja?'生成ファイル数':'Total Files'}</span><span>${fileCount}</span></div>`;
h+=`</div>`;
// Detail items
if(score<100){
h+=`<div class="dash-total dash-total-mt">`;
pillarResults.filter(r=>!r.ok).forEach(r=>{h+=`<span>❌ ${r.label} </span>`;});
reqResults.filter(r=>!r.ok).forEach(r=>{h+=`<span>❌ ${r.name} </span>`;});
if(answerPct<100)h+=`<span>⚠️ ${totalQ-answered} ${_ja?'件未回答':'unanswered'}</span>`;
h+=`</div>`;
}
h+=`</div>`;
return h;
}
/* ── Tech Master Table ── */
function renderTechDB(){
pushView({pillar:5,type:'techdb',file:null});
const body=$('prevBody');
const _ja=S.lang==='ja';const cats=_ja?{lang:'言語',front:'フロント',mobile:'モバイル',back:'バックエンド',baas:'BaaS',payment:'決済/CMS/EC',devops:'DevOps',ai:'AIツール',ai_auto:'AI自律',method:'手法',test:'テスト',api:'API',build:'ビルド',data:'データ',security:'セキュリティ'}:{lang:'Language',front:'Frontend',mobile:'Mobile',back:'Backend',baas:'BaaS',payment:'Payment/CMS/EC',devops:'DevOps',ai:'AI Tools',ai_auto:'AI Autonomous',method:'Methods',test:'Testing',api:'API',build:'Build',data:'Data',security:'Security'};
let h=`<div class="dash-head"><h3>📊 ${_ja?'技術マスターテーブル':'Tech Master Table'}</h3><p>${TECH_DB.length}${_ja?'エントリ — フィルタで絞り込み':'entries — use filters to narrow down'}</p></div>`;
h+=`<div class="tech-filter">
<select id="tfCat" aria-label="${_ja?'カテゴリフィルタ':'Category filter'}" onchange="filterTechDB()"><option value="">${_ja?'全カテゴリ':'All Categories'}</option>${Object.entries(cats).map(([k,v])=>`<option value="${k}">${v}</option>`).join('')}</select>
<select id="tfReq" aria-label="${_ja?'必須度フィルタ':'Required level filter'}" onchange="filterTechDB()"><option value="">${_ja?'全必須度':'All Levels'}</option><option value="required">${_ja?'必須':'Required'}</option><option value="recommended">${_ja?'推奨':'Recommended'}</option><option value="optional">${_ja?'選択':'Optional'}</option></select>
<input id="tfSearch" aria-label="${_ja?'技術名検索':'Search tech name'}" placeholder="${_ja?'検索...':'Search...'}" oninput="filterTechDB()">
<span id="tfCount" class="dash-tfcount">${TECH_DB.length}${_ja?'件':' items'}</span>
</div>`;
h+=`<div class="dash-tbl-wrap"><table class="tech-table"><thead><tr><th>${_ja?'技術名':'Tech'}</th><th>${_ja?'カテゴリ':'Category'}</th><th>${_ja?'種別':'Type'}</th><th>${_ja?'必須度':'Required'}</th><th>${_ja?'レベル':'Level'}</th></tr></thead><tbody id="techTbody">`;
TECH_DB.forEach(t=>{
const reqClass='req-'+t.req.replace(/\d$/,'');
h+=`<tr data-cat="${t.cat}" data-req="${t.req}" data-name="${t.name.toLowerCase()}"><td><strong>${t.name}</strong>${t.price?' <span class="dash-price">'+priceLabel(t.price)+'</span>':''}</td><td>${cats[t.cat]||t.cat}</td><td>${t.sub}</td><td><span class="req-badge ${reqClass}">${reqLabel(t.req)}</span></td><td>${t.level}</td></tr>`;
});
h+='</tbody></table></div>';
h+=`<div class="dash-back"><button class="btn btn-s" onclick="showDashboard()">← ${_ja?'ダッシュボード':'Dashboard'}</button></div>`;
body.innerHTML=h;
}
function filterTechDB(){
const _ja=S.lang==='ja';
const cat=$('tfCat').value;const req=$('tfReq').value;const search=$('tfSearch').value.toLowerCase();
const rows=document.querySelectorAll('#techTbody tr');let count=0;
rows.forEach(r=>{
const show=(!cat||r.dataset.cat===cat)&&(!req||r.dataset.req.includes(req))&&(!search||r.dataset.name.includes(search));
r.style.display=show?'':'none';if(show)count++;
});
$('tfCount').textContent=count+(_ja?'件':' items');
}
function fixAllCompat(level){
const _ja=S.lang==='ja';
const compat=checkCompat(S.answers);
const fixable=compat.filter(c=>c.fix&&(!level||c.level===level));
if(fixable.length===0)return;
fixable.forEach(c=>{S.answers[c.fix.f]=c.fix.s;});
save();
toast(_ja?'🔧 '+fixable.length+'件の問題を修正しました':'🔧 Fixed '+fixable.length+' issue(s)');
showDashboard();
}
function toggleFdep(id){
const body=$('fdep-'+id);
if(!body)return;
const header=body.previousElementSibling;
const icon=header.querySelector('.fdep-icon');
const isOpen=body.classList.contains('fdep-open');
body.classList.toggle('fdep-open');
if(icon)icon.textContent=isOpen?'▶':'▼';
}
/* ── Interactive Roadmap UI (Enhanced) ── */
function showRoadmapUI(){
pushView({pillar:6,type:'roadmap',file:null});
const _ja=S.lang==='ja';
const body=$('prevBody');
if(!S.files['roadmap/LEARNING_PATH.md']){
body.innerHTML='<p class="dash-empty">'+(_ja?'ファイル生成後に利用可能です':'Available after file generation')+'</p>';return;
}
const a=S.answers;
const level=a.skill_level||'Intermediate';
const isB=level.includes('Beginner');const isP=level.includes('Professional');
const timeMul=isB?2.0:isP?0.5:1.0;
const mob=a.mobile||(_ja?'なし':'None');const ai=a.ai_auto||(_ja?'なし':'None');const pay=a.payment||(_ja?'なし':'None');const noMob=mob==='なし'||mob==='None';const noAI=ai==='なし'||ai==='None';const noPay=pay==='なし'||pay==='None';
const fe=a.frontend||'React + Next.js';const be=a.backend||'Node.js + Express';const dep=a.deploy||'Vercel';
/* ── Resource lookups ── */
function res(key){return RESOURCES[key]||null;}
function feRes(){if(fe.includes('Vue'))return res('vue');if(fe.includes('Svelte'))return res('svelte');if(fe.includes('Astro'))return res('astro');if(fe.includes('Vite'))return res('react');return res('nextjs');}
function beRes(){if(be.includes('Fastify'))return res('fastify');if(be.includes('NestJS'))return res('nestjs');if(be.includes('FastAPI'))return res('fastapi');if(be.includes('Django'))return res('django');if(be.includes('Spring'))return res('spring');if(be.includes('Go'))return res('go');if(be.includes('Hono'))return res('hono');if(be.includes('Firebase'))return res('firebase');if(be.includes('Supabase'))return res('supabase');return res('express');}
function depRes(){if(dep.includes('Cloudflare'))return res('cloudflare');if(dep.includes('Railway'))return res('railway');return res('vercel');}
function authRes(){const au=a.auth||'';if(au.includes('Clerk'))return res('clerk');if(au.includes('Supabase'))return res('supabase');return res('nextauth');}
function methRes(m){if(m.includes('BDD'))return res('bdd');if(m.includes('DDD'))return res('ddd');return res('tdd');}
/* ── Build layers with hrs + res ── */
const layers=[
{name:_ja?'Layer 1: Web基盤':'Layer 1: Web Fundamentals',color:'var(--layer-1)',items:[
{text:_ja?'HTML5 / CSS3基礎':'HTML5 / CSS3 Basics',wk:isB?'Week 1-4':'Week 1',hrs:isB?40:8,res:res('html')},
{text:'Tailwind CSS',wk:isB?'Week 3-8':'Week 1-2',hrs:isB?20:6,res:res('tailwind')},
{text:'JavaScript ES6+ / TypeScript',wk:isB?'Week 5-12':'Week 1-2',hrs:isB?60:8,res:res('js')},
]},
{name:_ja?'Layer 2: フロントエンド':'Layer 2: Frontend',color:'var(--layer-2)',items:[
{text:fe+(_ja?' セットアップ':' Setup'),hrs:8,res:feRes()},
{text:_ja?'shadcn/ui + コンポーネント設計':'shadcn/ui + Component Design',hrs:12,res:res('shadcn')},
{text:_ja?'状態管理 (Zustand/Redux)':'State Management (Zustand/Redux)',hrs:10,res:res('zustand')},
{text:'React Query / SWR',hrs:6,res:res('rquery')},
{text:_ja?'テスト (Vitest + Playwright)':'Testing (Vitest + Playwright)',hrs:12,res:res('vitest')},
]},
{name:_ja?'Layer 3: バックエンド':'Layer 3: Backend',color:'var(--layer-3)',items:[
{text:be+(_ja?' セットアップ':' Setup'),hrs:8,res:beRes()},
{text:_ja?'データベース設計 + ORM':'Database Design + ORM',hrs:16,res:res('prisma')},
{text:_ja?'REST API / tRPC 実装':'REST API / tRPC Implementation',hrs:16,res:beRes()},
{text:(_ja?'認証・認可':'Auth & Authorization')+' ('+(a.auth||'NextAuth')+')',hrs:12,res:authRes()},
]},
];
if(!noMob) layers.push({name:_ja?'Layer 3.5: モバイル':'Layer 3.5: Mobile',color:'var(--layer-3h)',items:[
{text:mob+(_ja?' 環境構築':' Setup'),hrs:10,res:mob.includes('Flutter')?res('flutter'):mob.includes('bare')?res('rn'):res('expo')},
{text:_ja?'ナビゲーション・画面設計':'Navigation & Screen Design',hrs:12,res:mob.includes('Flutter')?res('flutter'):res('expo')},
{text:_ja?'ネイティブ機能':'Native Features',hrs:10,res:mob.includes('Flutter')?res('flutter'):res('expo')},
{text:_ja?'EASビルド・ストア提出':'EAS Build & Store Submit',hrs:8,res:res('expo')},
]});
layers.push({name:'Layer 4: DevOps',color:'var(--layer-4)',items:[
{text:'Docker + DevContainer',hrs:8,res:res('docker')},
{text:'GitHub Actions CI/CD',hrs:8,res:res('ghactions')},
{text:dep+(_ja?' デプロイ':' Deploy'),hrs:4,res:depRes()},
]});
layers.push({name:_ja?'Layer 5: AI駆動開発':'Layer 5: AI-Driven Dev',color:'var(--layer-5)',items:[
{text:_ja?'AI IDEセットアップ ('+((a.ai_tools||'Cursor').split(', ').slice(0,3).join(' / '))+')':'AI IDE Setup ('+((a.ai_tools||'Cursor').split(', ').slice(0,3).join(' / '))+')',hrs:4,res:res((a.ai_tools||'').includes('Antigravity')?'antigravity':'cursor')},
{text:_ja?'MCP設定・活用':'MCP Configuration',hrs:6,res:res('mcp')},
{text:_ja?'AI Agent Rules最適化':'AI Agent Rules Optimization',hrs:4,res:res('claudecode')},
...(!noAI?[{text:ai+(_ja?' 実践':' Practice'),hrs:8,res:res('cursor')}]:[]),
]});
if(!noPay) layers.push({name:_ja?'Layer 6: 収益化':'Layer 6: Monetization',color:'var(--layer-6)',items:[
{text:pay+(_ja?' 実装':' Implementation'),hrs:12,res:res('stripe')},
{text:_ja?'課金フロー構築':'Billing Flow',hrs:10,res:res('stripe')},
]});
layers.push({name:_ja?'Layer 7: 駆動開発手法':'Layer 7: Dev Methodologies',color:'var(--layer-7)',items:(a.dev_methods||'TDD').split(', ').map(m=>({text:m+(_ja?' 実践':' Practice'),hrs:8,res:methRes(m)}))});
/* Apply time multiplier */
layers.forEach(l=>l.items.forEach(it=>{if(!it.wk)it.hrs=Math.round((it.hrs||8)*timeMul);}));
/* ── Load saved progress ── */
const roadState=_jp(_lsGet('devforge-road-'+S.projectName),{});
const collapseState=_jp(_lsGet('devforge-road-col-'+S.projectName),{});
layers.forEach((l,li)=>l.items.forEach((item,ii)=>{item.done=!!roadState[li+'_'+ii];}));
const totalItems=layers.reduce((s,l)=>s+l.items.length,0);
const doneItems=layers.reduce((s,l)=>s+l.items.filter(i=>i.done).length,0);
const pct=totalItems?Math.round(doneItems/totalItems*100):0;
const totalHrs=layers.reduce((s,l)=>s+l.items.reduce((a,i)=>a+(i.hrs||0),0),0);
const doneHrs=layers.reduce((s,l)=>s+l.items.filter(i=>i.done).reduce((a,i)=>a+(i.hrs||0),0),0);
const remainHrs=totalHrs-doneHrs;
/* ── Milestones ── */
const milestones=[
{at:25,icon:'🌱',ja:'学習開始！基盤を構築中',en:'Journey started! Building foundations'},
{at:50,icon:'🔥',ja:'半分達成！勢いに乗っています',en:'Halfway there! Great momentum'},
{at:75,icon:'⚡',ja:'あと少し！ゴールが見えてきました',en:'Almost there! The finish line is in sight'},
{at:100,icon:'🏆',ja:'全完了！おめでとうございます！',en:'All complete! Congratulations!'},
];
const activeMilestone=milestones.filter(m=>pct>=m.at).pop();
/* ── Render ── */
let h=`<div class="dash-head"><h3>${_ja?'🗺️ インタラクティブロードマップ':'🗺️ Interactive Roadmap'}</h3><p>${_ja?'チェックして進捗管理':'Track progress by checking items'} — ${level}</p></div>`;
/* Progress + Time */
h+=`<div class="road-progress"><h4>${_ja?'📈 全体進捗':'📈 Overall Progress'}</h4>
<div class="road-progress-bar"><div class="road-progress-fill" style="width:${pct}%"></div></div>
<div class="road-pct">${pct}% <span class="road-pct-sub">(${doneItems}/${totalItems})</span></div>
<div class="road-time">⏱️ ${_ja?'残り推定':'Est. remaining'}: <strong>${remainHrs}h</strong> / ${totalHrs}h ${_ja?'(×'+timeMul+' '+level+')':''}</div>
${activeMilestone?`<div class="road-milestone">${activeMilestone.icon} ${_ja?activeMilestone.ja:activeMilestone.en}</div>`:''}
</div>`;
/* Layers */
layers.forEach((l,li)=>{
const layerDone=l.items.filter(i=>i.done).length;
const layerPct=l.items.length?Math.round(layerDone/l.items.length*100):0;
const layerHrsLeft=l.items.filter(i=>!i.done).reduce((a,i)=>a+(i.hrs||0),0);
/* C. Dependency: previous layer must be >=80% */
const prevPct=li>0?(()=>{const pl=layers[li-1];const pd=pl.items.filter(i=>i.done).length;return pl.items.length?Math.round(pd/pl.items.length*100):100;})():100;
const locked=prevPct<80;
/* A. Collapse */
const collapsed=!!collapseState[li]||(layerPct===100&&!collapseState['_open_'+li]);
h+=`<div class="road-layer${locked?' road-locked':''}" data-li="${li}">`;
h+=`<h3 style="background:${l.color}20;color:${l.color};" class="road-layer-head" onclick="toggleRoadCollapse(${li})">`;
h+=`<span class="road-collapse-icon">${collapsed?'▶':'▼'}</span> `;
h+=locked?'🔒 ':'';
h+=`${l.name} <span class="road-layer-pct">${layerPct}%</span>`;
if(layerPct===100)h+=' 🏆';
h+=`<span class="road-layer-hrs">${layerHrsLeft>0?(layerHrsLeft+'h'):(_ja?'完了':'Done')}</span>`;
h+=`</h3>`;
if(locked){
h+=`<div class="road-lock-msg">${_ja?'🔒 前レイヤーを80%以上完了すると解放されます':'🔒 Complete previous layer to 80%+ to unlock'} (${prevPct}%)</div>`;
}
h+=`<div class="road-items${collapsed?' road-collapsed':''}" id="roadItems${li}">`;
l.items.forEach((item,ii)=>{
const id=li+'_'+ii;
const disabled=locked?' disabled':'';
h+=`<div class="road-task ${item.done?'checked':''}${locked?' road-task-locked':''}" ${locked?'':'onclick="toggleRoadItem2(\''+id+'\',this)"'}>`;
h+=`<input type="checkbox" ${item.done?'checked':''}${disabled} ${locked?'':'onclick="event.stopPropagation();toggleRoadItem2(\''+id+'\',this.parentElement)"'}>`;
h+=`<span>${esc(item.text)}</span>`;
if(item.hrs)h+=`<span class="road-hrs-badge">${item.hrs}h</span>`;
if(item.wk)h+=`<span class="road-week-badge">${item.wk}</span>`;
if(item.res)h+=`<a class="road-res-btn" href="${item.res.u}" target="_blank" rel="noopener" onclick="event.stopPropagation()" title="${item.res.n}">📖</a>`;
h+=`</div>`;
});
h+=`</div></div>`;
});
h+=`<div class="road-actions">
<button class="btn btn-s" onclick="resetRoadmap2()">${_ja?'🔄 リセット':'🔄 Reset'}</button>
<button class="btn btn-s" onclick="expandAllRoadLayers()">${_ja?'📂 全展開':'📂 Expand All'}</button>
<button class="btn btn-s" onclick="exportRoadmapMD()">${_ja?'📋 Markdownコピー':'📋 Copy Markdown'}</button>
</div>`;
body.innerHTML=h;
/* Store layers for export */
window._roadLayers=layers;
}
function toggleRoadItem2(id,el){
el.classList.toggle('checked');
const cb=el.querySelector('input[type="checkbox"]');
if(cb)cb.checked=el.classList.contains('checked');
const roadState=_jp(_lsGet('devforge-road-'+S.projectName),{});
roadState[id]=el.classList.contains('checked');
_lsSet('devforge-road-'+S.projectName,JSON.stringify(roadState));
/* Update progress bar */
const tasks=document.querySelectorAll('.road-task:not(.road-task-locked)');
const done=document.querySelectorAll('.road-task.checked:not(.road-task-locked)');
const pct=tasks.length?Math.round(done.length/tasks.length*100):0;
const bar=document.querySelector('.road-progress-fill');if(bar)bar.style.width=pct+'%';
const pctEl=document.querySelector('.road-pct');if(pctEl)pctEl.innerHTML=`${pct}% <span class="road-pct-sub">(${done.length}/${tasks.length})</span>`;
/* Check layer completion & milestone */
const li=id.split('_')[0];
const layer=document.querySelector('.road-layer[data-li="'+li+'"]');
if(layer){
const lt=layer.querySelectorAll('.road-task');const ld=layer.querySelectorAll('.road-task.checked');
const lp=lt.length?Math.round(ld.length/lt.length*100):0;
const hdr=layer.querySelector('.road-layer-pct');if(hdr)hdr.textContent=lp+'%';
/* Badge animation on layer 100% */
if(lp===100&&!layer.querySelector('.road-badge-anim')){
const badge=document.createElement('span');badge.className='road-badge-anim';badge.textContent='🏆';
const h3=layer.querySelector('h3');if(h3)h3.appendChild(badge);
}
}
/* Check milestone */
const _ja=S.lang==='ja';
const ms=[{at:25,icon:'🌱',t:_ja?'25% 達成！':'25% reached!'},{at:50,icon:'🔥',t:_ja?'50% 達成！':'50% reached!'},{at:75,icon:'⚡',t:_ja?'75% 達成！':'75% reached!'},{at:100,icon:'🏆',t:_ja?'全完了！🎉':'All complete! 🎉'}];
const prev=parseInt(roadState._lastPct||'0');
ms.forEach(m=>{if(pct>=m.at&&prev<m.at)toast(m.icon+' '+m.t);});
roadState._lastPct=pct;
_lsSet('devforge-road-'+S.projectName,JSON.stringify(roadState));
/* Re-check dependency locks (full re-render for simplicity) */
clearTimeout(window._roadDebounce);
window._roadDebounce=setTimeout(()=>showRoadmapUI(),300);
}
function toggleRoadCollapse(li){
const colState=_jp(_lsGet('devforge-road-col-'+S.projectName),{});
const items=$('roadItems'+li);
if(!items)return;
const isCollapsed=items.classList.contains('road-collapsed');
items.classList.toggle('road-collapsed');
const icon=items.parentElement.querySelector('.road-collapse-icon');
if(icon)icon.textContent=isCollapsed?'▼':'▶';
if(isCollapsed){colState['_open_'+li]=true;delete colState[li];}
else{colState[li]=true;delete colState['_open_'+li];}
_lsSet('devforge-road-col-'+S.projectName,JSON.stringify(colState));
}
function expandAllRoadLayers(){
_lsRm('devforge-road-col-'+S.projectName);
showRoadmapUI();
}
function exportRoadmapMD(){
const _ja=S.lang==='ja';
const layers=window._roadLayers;if(!layers)return;
let md='# '+(_ja?'ロードマップ':'Roadmap')+' — '+S.projectName+'\n\n';
layers.forEach(l=>{
const done=l.items.filter(i=>i.done).length;
md+='## '+l.name+' ('+done+'/'+l.items.length+')\n';
l.items.forEach(it=>{
md+='- ['+(it.done?'x':' ')+'] '+it.text+(it.hrs?' ('+it.hrs+'h)':'')+(it.wk?' — '+it.wk:'')+'\n';
});
md+='\n';
});
navigator.clipboard.writeText(md).then(()=>toast(_ja?'✅ Markdownをコピーしました':'✅ Markdown copied')).catch(()=>toast(_ja?'❌ コピー失敗':'❌ Copy failed'));
}
function resetRoadmap2(){
_lsRm('devforge-road-'+S.projectName);
_lsRm('devforge-road-col-'+S.projectName);
showRoadmapUI();
}
/* ── Template Save/Load ── */
function saveTemplate(){
const _ja=S.lang==='ja';
const templates=_jp(_lsGet('devforge-templates'),[]);
const tpl={name:S.projectName,answers:{...S.answers},preset:S.preset,date:new Date().toISOString()};
templates.push(tpl);
_lsSet('devforge-templates',JSON.stringify(templates));
addMsg('bot',_ja?`💾 テンプレート「${S.projectName}」を保存しました。次回起動時に読み込めます。`:`💾 Template "${S.projectName}" saved. Load it next time.`);
}
/* ── URL State Sharing ── */
function shareURL(){
const _ja=S.lang==='ja';
const data={projectName:S.projectName,answers:S.answers,preset:S.preset,skillLv:S.skillLv,lang:S.lang};
const encoded=btoa(unescape(encodeURIComponent(JSON.stringify(data))));
const url=location.origin+location.pathname+'#df='+encoded;
navigator.clipboard.writeText(url).then(()=>{
var msg=_ja?'🔗 URLをクリップボードにコピーしました。このURLを共有すると同じ設定で開けます。':'🔗 URL copied to clipboard. Share it to open with the same settings.';
if(S.skillLv>=6)msg+=_ja?' あなたの知見が次の開発者を助けます！SNSやブログでの共有もおすすめです。':' Your insights help the next developer! Consider sharing on social media or blogs.';
addMsg('bot',msg);
}).catch(()=>{
addMsg('bot',`🔗 ${_ja?'共有URL':'Share URL'}:\n${url}`);
});
}
// ── Context-Aware Guide Data ──
const DOMAIN_FIRST_STEPS={
fintech:{ja:['security.md確認 (PCI DSS/KYC)','認証+MFA設定','決済フロー実装'],en:['Review security.md (PCI DSS/KYC)','Setup Auth+MFA','Implement payment flow']},
health:{ja:['security.md→HIPAA対応','Auth+RBAC設定','ERスキーマ検証'],en:['Review security.md→HIPAA','Auth+RBAC setup','Verify ER schema']},
education:{ja:['specification.mdで学習フロー確認','CLAUDE.md→AI投入','reverse_engineering.mdで逆算'],en:['Review specification.md learning flow','Feed CLAUDE.md→AI','Use reverse_engineering.md']},
ec:{ja:['security.md+決済フロー','ER.mdでProduct/Order確認','test_cases.mdで決済テスト'],en:['Review security.md+payment','Check ER.md Product/Order','Test payment via test_cases.md']},
saas:{ja:['security.md→テナント分離','specification.md→課金設計','CLAUDE.md→AI開発'],en:['Review security.md→multi-tenancy','Spec.md→billing design','CLAUDE.md→AI dev']},
_default:{ja:['CLAUDE.md→AI投入','specification.md要件確認','tasks.mdタスク計画'],en:['Feed CLAUDE.md→AI','Review specification.md','Plan with tasks.md']}
};
const AI_TOOL_RECIPES={
Cursor:{ja:['Step 1: .cursor/rules配置','Step 2: Ctrl+Shift+I Agent起動','Step 3: tasks.mdから指示'],en:['Step 1: Place .cursor/rules','Step 2: Ctrl+Shift+I Agent','Step 3: Instruct from tasks.md']},
'Claude Code':{ja:['Step 1: CLAUDE.md自動読込','Step 2: /init初期化','Step 3: AI_BRIEF.md→仕様順投入'],en:['Step 1: CLAUDE.md auto-loaded','Step 2: /init','Step 3: Feed AI_BRIEF.md→specs']},
Copilot:{ja:['Step 1: copilot-instructions.md配置','Step 2: Tab補完+Chat','Step 3: #fileでコンテキスト指定'],en:['Step 1: Place copilot-instructions.md','Step 2: Tab+Chat','Step 3: Use #file context']},
Windsurf:{ja:['Step 1: .windsurfrules自動読込','Step 2: Cascadeモード起動','Step 3: MCP設定で拡張'],en:['Step 1: .windsurfrules auto-loaded','Step 2: Launch Cascade','Step 3: Extend with MCP']},
Cline:{ja:['Step 1: フォルダを開いて.clinerules確認','Step 2: tasks.mdの最優先タスクを選択','Step 3: 「このタスクを実装して」で実行'],en:['Step 1: Open folder, check .clinerules','Step 2: Select top task from tasks.md','Step 3: Run with "implement this task"']},
Gemini:{ja:['Step 1: CLAUDE.mdの内容をプロンプトに貼り付け','Step 2: tasks.mdの最優先タスクを指定','Step 3: コード生成を実行'],en:['Step 1: Paste CLAUDE.md content into prompt','Step 2: Specify top task from tasks.md','Step 3: Execute code generation']},
_default:{ja:['Step 1: CLAUDE.md貼り付け','Step 2: Ctrl+Shift+C全コピー','Step 3: tasks.md順に指示'],en:['Step 1: Paste CLAUDE.md','Step 2: Ctrl+Shift+C copy all','Step 3: Instruct via tasks.md']}
};
function getADRs(a,_ja){
const adrs=[];
if(inc(a.backend,'Supabase'))adrs.push({icon:'🔐',t:_ja?'Auth: Supabase Auth (RLS)':'Auth: Supabase Auth (RLS)',d:_ja?'PostgreSQL行レベルセキュリティ':'PostgreSQL row-level security'});
if(inc(a.backend,'Firebase'))adrs.push({icon:'🔐',t:_ja?'Auth: Firebase Auth':'Auth: Firebase Auth',d:_ja?'Firestoreルールで制御':'Controlled via Firestore rules'});
if(inc(a.frontend,'Next'))adrs.push({icon:'🖥',t:_ja?'Rendering: SSR/ISR':'Rendering: SSR/ISR',d:_ja?'SEO→SSR, 動的→ISR, 管理→CSR':'SEO→SSR, dynamic→ISR, admin→CSR'});
if(inc(a.frontend,'Vite')||inc(a.frontend,'SPA'))adrs.push({icon:'🖥',t:_ja?'Rendering: SPA (CSR)':'Rendering: SPA (CSR)',d:_ja?'クライアントサイドレンダリング':'Client-side rendering'});
if(inc(a.deploy,'Railway'))adrs.push({icon:'☁',t:_ja?'Deploy: 分離型':'Deploy: Decoupled',d:_ja?'FE/BE独立スケーリング':'Independent FE/BE scaling'});
if(inc(a.database,'PostgreSQL'))adrs.push({icon:'🗃',t:_ja?'DB: PostgreSQL':'DB: PostgreSQL',d:_ja?'ACID準拠、JSON対応':'ACID compliant, JSON support'});
if(inc(a.payment,'Stripe'))adrs.push({icon:'💳',t:_ja?'Payment: Stripe':'Payment: Stripe',d:_ja?'Checkout→Webhook→非同期確定':'Checkout→Webhook→async confirm'});
return adrs;
}
function showManual(sec){
const o=$('helpOverlay');o.classList.add('show');
pushModal(o,()=>{o.classList.remove('show');releaseFocus(o);});
const _ja=S.lang==='ja';
const MANUAL=[
{id:'overview',title:_ja?'概要':'Overview',body:_ja?'<h2>DevForge v9.5 とは</h2><p>質問に答えるだけで、プロジェクトに必要な135+ファイルを自動生成するAI駆動開発プラットフォームです。'+_TECH_COUNT+'テクノロジー対応。</p>'+
'<h3>20の柱</h3><table><tr><th>柱</th><th>内容</th><th>ファイル数</th></tr><tr><td>①SDD統合</td><td>Spec Kit互換の仕様書</td><td>5</td></tr><tr><td>②DevContainer</td><td>Docker開発環境</td><td>4</td></tr><tr><td>③MCP設定</td><td>Model Context Protocol</td><td>3</td></tr><tr><td>④AIルール</td><td>10+ツール設定+スキル</td><td>10+</td></tr>'+
'<tr><td>⑤並列探索</td><td>スタック比較+おすすめランキング</td><td>UI</td></tr><tr><td>⑥Dashboard</td><td>コンテキスト可視化+技術DB</td><td>UI</td></tr><tr><td>⑦ロードマップ</td><td>学習パス（インタラクティブ）</td><td>9+UI</td></tr><tr><td>⑧AIランチャー</td><td>プロンプトテンプレート+トークン推定</td><td>UI</td></tr><tr><td>⑨デザインシステム</td><td>デザイントークン+シーケンス図</td><td>2</td></tr><tr><td>⑩リバースEng</td><td>ゴール逆算型プランニング</td><td>2</td></tr><tr><td>⑪実装ガイド</td><td>業種別実装パターン+AI運用手順</td><td>3</td></tr><tr><td>⑫セキュリティ</td><td>OWASP・STRIDE・コンプライアンス</td><td>5</td></tr><tr><td>⑬戦略インテリジェンス</td><td>業種別設計図・技術レーダー・ステークホルダー戦略・先端シナリオ</td><td>5</td></tr><tr><td>⑭運用インテリジェンス</td><td>Ops Plane設計・12 Ops Capabilities・SLO/SLI</td><td>3</td></tr><tr><td>⑮未来戦略</td><td>市場ポジショニング・UX戦略・エコシステム・規制対応</td><td>4</td></tr><tr><td>⑯開発IQ</td><td>最適手法選定・AIプロンプトプレイブック・業界特化・次世代UX</td><td>4</td></tr><tr><td>⑰プロンプトゲノム</td><td>CRITERIA 8軸スコア・AI成熟度・シナジーマトリクス・KPIダッシュボード</td><td>4</td></tr><tr><td>⑱Prompt Ops</td><td>ReAct自律ワークフロー・LLMOpsダッシュボード・Prompt CI/CD・[META]レジストリ</td><td>4</td></tr><tr><td>⑲エンタープライズSaaS</td><td>マルチテナント設計・組織モデル・ワークフローエンジン・エンタープライズUIコンポーネント</td><td>4</td></tr><tr><td>⑳CI/CDインテリジェンス</td><td>パイプライン設計・デプロイ戦略・品質ゲートマトリクス・リリースエンジニアリング</td><td>4</td></tr></table>'+
'<p>+ docs（81仕様書）+ 共通ファイル（4）= <strong>135+ファイル</strong></p>':'<h2>What is DevForge v9.5?</h2><p>An AI-driven dev platform that auto-generates 135+ project files just by answering questions. Supports '+_TECH_COUNT+' technologies.</p>'+
'<h3>20 Pillars</h3><table><tr><th>Pillar</th><th>Content</th><th>Files</th></tr><tr><td>①SDD</td><td>Spec Kit compatible specs</td><td>5</td></tr><tr><td>②DevContainer</td><td>Docker dev environment</td><td>4</td></tr><tr><td>③MCP</td><td>Model Context Protocol</td><td>3</td></tr><tr><td>④AI Rules</td><td>10+ tool configs + skills</td><td>10+</td></tr>'+
'<tr><td>⑤Explorer</td><td>Stack comparison + recommendation</td><td>UI</td></tr><tr><td>⑥Dashboard</td><td>Context visualization + Tech DB</td><td>UI</td></tr><tr><td>⑦Roadmap</td><td>Learning path (interactive)</td><td>9+UI</td></tr><tr><td>⑧AI Launcher</td><td>Prompt templates + token estimation</td><td>UI</td></tr><tr><td>⑨Design System</td><td>Design tokens + Sequence diagrams</td><td>2</td></tr><tr><td>⑩Reverse Eng</td><td>Goal-driven reverse planning</td><td>2</td></tr><tr><td>⑪Impl Guide</td><td>Domain-specific impl patterns + AI runbook</td><td>3</td></tr><tr><td>⑫Security</td><td>OWASP, STRIDE, Compliance</td><td>5</td></tr><tr><td>⑬Strategic Intelligence</td><td>Industry blueprint, Tech radar, Stakeholder strategy, Advanced scenarios</td><td>5</td></tr><tr><td>⑭Ops Intelligence</td><td>Ops Plane design, 12 Ops Capabilities, SLO/SLI</td><td>3</td></tr><tr><td>⑮Future Strategy</td><td>Market positioning, UX strategy, Ecosystem, Regulatory</td><td>4</td></tr><tr><td>⑯Dev IQ</td><td>Optimal methodology, AI brainstorm playbook, Industry deep dive, Next-gen UX</td><td>4</td></tr><tr><td>⑰Prompt Genome</td><td>CRITERIA 8-axis scoring, AI maturity, Synergy matrix, KPI dashboard</td><td>4</td></tr><tr><td>⑱Prompt Ops</td><td>ReAct workflow, LLMOps dashboard, Prompt CI/CD, [META] registry</td><td>4</td></tr><tr><td>⑲Enterprise SaaS</td><td>Multi-tenant design, Org model, Workflow engine, Enterprise UI components</td><td>4</td></tr><tr><td>⑳CI/CD Intelligence</td><td>Pipeline design, Deploy strategy, Quality gate matrix, Release engineering</td><td>4</td></tr></table>'+
'<p>+ docs (81 specs) + common (4) = <strong>135+ files</strong></p>'},
{id:'start',title:_ja?'はじめ方':'Getting Started',body:_ja?
'<h2>はじめ方</h2><p>1. スキルレベルを選択（Beginner/Intermediate/Pro）<br>2. プロジェクト名を入力<br>3. テンプレート選択（任意・48種類）<br>4. Phase 1-3の質問に回答（スキップ＆後で回答可）<br>5. 生成ボタンで135+ファイル作成<br>6. ZIPダウンロードまたはPDF印刷</p>'+
'<h3>UX機能</h3>'+
'<p>• 🌱⚡🔥 スキルレベルで質問の選択肢が動的変化<br>• 🎯 48プリセットテンプレート<br>• ✎ 回答の編集（✎ボタン）<br>• ⏭️ スキップ＆後で回答<br>• 📊 複雑度分析（0-100スコア）<br>• 📁 プロジェクト管理（Ctrl+M）<br>• 🎙️ 音声入力<br>• ? 質問ごとのヘルプアイコン<br>• 🔀 ドラッグ&ドロップ優先度ソート</p>'+
'<h3>V8 新機能</h3>'+
'<p>• 📱 モバイル開発パス (Expo/React Native)<br>• 🤖 AI自律開発ガイド (Vibe Coding/マルチAgent)<br>• 💳 決済・CMS・EC統合ガイド<br>• ⚡ 並列スタック比較 (7パターン)<br>• 📊 技術マスターテーブル / Tech Master Table ('+_TECH_COUNT+' entries)<br>• 🗺️ インタラクティブロードマップ (進捗管理)</p>'+
'<h3>V8.3 新機能</h3>'+
'<p>• 📊 Mermaid図ライブレンダリング (ER図・画面遷移・ガント)<br>• 📝 OpenAPI準拠API仕様書<br>• ✅ テストケースマトリクス (機能×正常/異常)<br>• 📋 リリースチェックリスト (デプロイ先別動的生成)<br>• 🔨 WBS 3階層+工数見積り<br>• 🎯 プロンプトプレイブック (フェーズ別AI投入プロンプト集)<br>• 📎 GitHub Issues風タスク分解<br>• 📋 全ファイル結合コピー (AI一括投入用)</p>'+
'<h3>V9 新機能</h3>'+
'<p>• 🧪 品質インテリジェンスエンジン (業種別QA戦略・テストマトリクス・インシデント対応)<br>• 🎨 デザインシステム自動生成 (デザイントークン・シーケンス図)<br>• 🔄 リバースエンジニアリング (ゴール逆算型プランニング・32ドメイン対応)<br>• 🏗️ 実装インテリジェンス (業種別実装パターン・AI運用手順書・擬似コード)<br>• 🧠 AI開発OS (コンテキスト圧縮・ファイル選択マトリクス・サブエージェント分離)<br>• 🌐 32ドメイン対応 (AI, IoT, 不動産, 法務, 人事, 金融, 製造, 物流, 農業, エネルギー, メディア, 行政, 旅行, 保険 等を追加)<br>• 📦 135+ファイル生成 (docs 81種, AIルール12+, スキル8+)<br>• 🎯 48プリセット (製造, 農業, エネルギー, メディア, 行政, 旅行, 保険 追加)<br>• 🏗️ 未来戦略インテリジェンス (市場ポジショニング・UX戦略・エコシステム・規制フォーサイト)<br>• 📄 CLAUDE.md 3-layer分割 (薄いルート + パス別ルール + 設定)<br>• 🧬 開発IQインテリジェンス ⑯ (32ドメイン×12手法のポリモーフィック開発戦略)<br>• 🧩 プロンプトゲノムエンジン ⑰ (CRITERIA 8軸品質スコア付きプロンプトDNA自動生成)<br>• 🔧 Prompt Engineering OS ⑱ (ReAct自律ワークフロー・LLMOpsダッシュボード・Prompt CI/CD・[META]レジストリ)<br>• 🏢 エンタープライズSaaS Blueprint ⑲ (マルチテナント設計・組織モデル・ワークフローエンジン・エンタープライズUIコンポーネント)</p>'+
'<p class="workflow-ref">📘 <strong>生成後の手順は <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">生成後ワークフローガイド</a> を参照</strong></p>'
:
'<h2>Getting Started</h2><p>1. Select your skill level (Beginner/Intermediate/Pro)<br>2. Enter project name<br>3. Choose a template (optional, 48 types)<br>4. Answer Phase 1-3 questions (skip & answer later OK)<br>5. Click Generate for 135+ files<br>6. Download ZIP or print PDF</p>'+
'<h3>UX Features</h3>'+
'<p>• 🌱⚡🔥 Dynamic options by skill level<br>• 🎯 48 preset templates<br>• ✎ Edit answers (✎ button)<br>• ⏭️ Skip & answer later<br>• 📊 Complexity analysis (0-100 score)<br>• 📁 Project manager (Ctrl+M)<br>• 🎙️ Voice input<br>• ? Help icon per question<br>• 🔀 Drag & drop priority sort</p>'+
'<h3>V8 Features</h3>'+
'<p>• 📱 Mobile dev path (Expo/React Native)<br>• 🤖 AI autonomous guide (Vibe Coding/Multi-Agent)<br>• 💳 Payment/CMS/EC integration<br>• ⚡ Parallel stack comparison (7 patterns)<br>• 📊 Tech Master Table ('+_TECH_COUNT+' entries)<br>• 🗺️ Interactive roadmap (progress tracking)</p>'+
'<h3>V8.3 Features</h3>'+
'<p>• 📊 Mermaid diagram live rendering (ER/screen flow/Gantt)<br>• 📝 OpenAPI-compliant API specs<br>• ✅ Test case matrix (feature × normal/abnormal)<br>• 📋 Release checklist (per deploy target)<br>• 🔨 WBS 3-level + effort estimation<br>• 🎯 Prompt playbook (phase-specific AI prompts)<br>• 📎 GitHub Issues-style task breakdown<br>• 📋 Copy all files combined (for bulk AI input)</p>'+
'<h3>V9 Features</h3>'+
'<p>• 🧪 Quality Intelligence Engine (industry-specific QA strategies, test matrix, incident response)<br>• 🎨 Design System generation (design tokens, sequence diagrams)<br>• 🔄 Reverse Engineering (goal-driven reverse planning, 32 domains)<br>• 🏗️ Implementation Intelligence (domain-specific impl patterns, AI runbook, pseudo-code)<br>• 🧠 AI Development OS (context compression, file selection matrix, sub-agent isolation)<br>• 🌐 32 domain support (AI, IoT, Real Estate, Legal, HR, FinTech, Manufacturing, Logistics, Agriculture, Energy, Media, Government, Travel, Insurance added)<br>• 📦 135+ file generation (81 docs, 12+ AI rules, 8+ skills)<br>• 🎯 48 presets (Factory, Agriculture, Energy, Media, Gov Portal, Travel, Insurance added)<br>• 🏗️ Future Strategy Intelligence (market positioning, UX strategy, ecosystem, regulatory foresight)<br>• 📄 CLAUDE.md 3-layer split (thin root + path-specific rules + settings)<br>• 🧬 Dev IQ Intelligence ⑯ (polymorphic development strategy for 32 domains × 12 approaches)<br>• 🧩 Prompt Genome Engine ⑰ (project-specific Prompt DNA with CRITERIA 8-axis quality scoring)<br>• 🔧 Prompt Engineering OS ⑱ (ReAct autonomous workflow, LLMOps dashboard, Prompt CI/CD, [META] registry)<br>• 🏢 Enterprise SaaS Blueprint ⑲ (multi-tenant design, org model, workflow engine, enterprise UI components)</p>'+
'<p class="workflow-ref">📘 <strong>For post-generation workflow, see <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">Post-Gen Workflow Guide</a></strong></p>'
},
{id:'pillars',title:_ja?'20の柱':'20 Pillars',body:_ja?
'<h2>20の柱の詳細</h2><h3>① SDD統合 (5ファイル)</h3>'+
'<p>constitution.md / specification.md / technical-plan.md / tasks.md / verification.md</p>'+
'<h3>② DevContainer (4ファイル)</h3>'+
'<p>devcontainer.json / Dockerfile / docker-compose.yml / post-create.sh — VSCode/Cursorで開くだけ。</p>'+
'<h3>③ MCP設定 (3ファイル)</h3>'+
'<p>project-context.md / tools-manifest.json / mcp-config.json</p>'+
'<h3>④ AIルール (12+ファイル)</h3>'+
'<p>Cursor / Antigravity / Claude Code (CLAUDE.md, AGENTS.md) / Copilot / Windsurf / Cline / Kiro / Codex / Skills (project/catalog/pipelines) / Hooks</p>'+
'<h3>⑤ 並列実装探索 (UI)</h3>'+
'<p>7パターンのスタックを2つ選んで比較。開発速度・スケーラビリティ・学習容易性・エコシステムで評価。</p>'+
'<h3>⑥ Context Dashboard (UI)</h3>'+
'<p>トークン数・モデル適合度・ファイルサイズ分布・技術マスターテーブル('+_TECH_COUNT+')を一覧表示。</p>'+
'<h3>⑦ ロードマップ (9ファイル+UI)</h3>'+
'<p>LEARNING_PATH / TECH_STACK_GUIDE / MOBILE_GUIDE / TOOLS_SETUP / RESOURCES / MILESTONES / AI_WORKFLOW / AI_AUTONOMOUS / SAAS_COMMERCE_GUIDE — インタラクティブUIで進捗管理可能。</p>'+
'<h3>⑧ AIプロンプトランチャー (UI)</h3>'+
'<p>生成した仕様書をAIツールに一括投入。36のプロンプトテンプレート（レビュー・実装・テスト・リファクタ・セキュリティ・ドキュメント・QA・デバッグ・アーキテクチャ・パフォーマンス・API統合・アクセシビリティ・マイグレーション・メトリクス・i18n・グロース・リバースエンジニアリング・インシデント対応・Ops準備・戦略インテリジェンス・リスクコンプライアンス・オンボーディング・CI/CD設計・最適手法選定・9人の専門家ブレスト・UXジャーニー設計・AIモデル使い分け・業界特化分析・次世代UX・認知負荷分析・プロンプトゲノム分析・AI成熟度レビュー・ReActデバッグ・プロンプトOpsレビュー・エンタープライズアーキテクチャ・ワークフロー監査）。フォルダ別トークン推定・モデル適合度表示。<strong>詳細は「📋 プロンプトマニュアル」参照</strong>。</p>'+
'<h3>⑨ デザインシステム (2ファイル)</h3>'+
'<p>design_system.md (デザイントークン・色・タイポ・コンポーネントカタログ) / sequence_diagrams.md (認証・CRUD・決済フローのMermaidシーケンス図) — フレームワーク別実装ガイド。</p>'+
'<h3>⑩ リバースエンジニアリング (2ファイル)</h3>'+
'<p>reverse_engineering.md (ゴール定義→逆算フロー・マイルストーンGantt・リスク分析) / goal_decomposition.md (ゴールツリー・サブゴール分解・ギャップ分析・優先度マトリクス・依存関係チェーン) — 32ドメイン対応の逆算型プランニング。</p>'+
'<h3>⑪ 実装インテリジェンス (4ファイル)</h3>'+
'<p>implementation_playbook.md (業種別実装パターン・擬似コード・スタック固有ガイダンス・横断的関心事チェックリスト) / ai_dev_runbook.md (AI運用ワークフロー・コンテキスト管理・エラー復旧プロトコル) / skill_guide.md (スキルレベル別使用ガイド・注意事項・チェックリスト) / impl-patterns.md (Manus Skills形式の実装スキルカタログ、ai_auto≠noneの場合) — 32ドメイン対応の実装ガイド。</p>'+
'<h3>⑫ セキュリティインテリジェンス (5ファイル)</h3>'+
'<p>security_intelligence.md (OWASP Top 10 2025監査・セキュリティヘッダー・責任分界・シークレット管理・認証セキュリティ) / threat_model.md (STRIDEエンティティ別脅威分析・攻撃対象領域・対策マトリクス) / compliance_matrix.md (PCI DSS・HIPAA・GDPR・ISMAP・SOC 2・FERPAドメイン別チェックリスト) / ai_security.md (AI生成コードレビュー・パッケージ幻覚検知・敵対的AIプロンプト・Agent Security) / security_testing.md (RLSテスト・Zodスキーマ・IDORテスト・OWASP ZAP設定・ペネトレーションテストチェックリスト) — スタック適応型セキュリティ自動生成エンジン。</p>'+
'<h3>⑬ 戦略インテリジェンス (5ファイル)</h3>'+
'<p>industry_blueprint.md (業種別規制・推奨アーキテクチャ・失敗要因・ビジネスモデル比較) / tech_radar.md (2026-2030技術トレンドレーダー・Adopt/Trial/Assess/Hold分類・スタック進化ロードマップ) / stakeholder_strategy.md (ステークホルダー別開発戦略・技術的負債管理・チーム構成・予算配分ガイド) / operational_excellence.md (技術的負債管理フレームワーク・DR/BCP・Green IT・Conway\'s Law対応チーム設計) — 32ドメイン対応の業種別戦略インテリジェンス。世界唯一の戦略ドキュメント自動生成エンジン。</p>'+
'<h3>⑭ 運用インテリジェンス (3ファイル)</h3>'+
'<p>ops_runbook.md (Ops Plane設計・Feature Flags・SLO/SLI・Observability・Jobs・Backup・Rate Limiting) / ops_checklist.md (12 Ops Capabilities Matrix・Day-1運用準備) / ops_plane_design.md (Ops Plane Architecture・12 Ops Capabilities実装パターン・Circuit Breaker・証拠ベース運用・Dev×Ops AI責任分離・Admin Consoleセキュリティ) — ドメイン適応型Ops Plane設計自動生成エンジン。世界唯一の運用設計書自動生成。</p>'+
'<h3>⑮ 未来戦略インテリジェンス (4ファイル)</h3>'+
'<p>market_positioning.md (市場ポジショニング・競合分析・MOAT・GTM戦略・ユニットエコノミクス) / user_experience_strategy.md (UX戦略・ペルソナ・ユーザージャーニー・アクセシビリティ・デジタルウェルビーイング) / ecosystem_strategy.md (エコシステム戦略・API-as-Product・DX・FinOps・コミュニティ) / regulatory_foresight.md (規制対応・2026-2030展望・EU AI Act・ESGメトリクス) — 32ドメイン対応の未来戦略自動生成。</p>'+
'<h3>⑯ 開発IQインテリジェンス (4ファイル)</h3>'+
'<p>dev_methodology.md (32ドメイン対応の開発方法論・TDD/DDD/BDD/FDD・ポリモーフィック開発戦略) / phase_prompts.md (6フェーズ×設計アプローチ別AIプロンプト・実装ガイダンス) / industry_dev_strategy.md (15業種別開発戦略・推奨スタック・KPI・失敗パターン回避) / next_gen_ux.md (次世代UX手法・Voice-First・Spatial Computing・Haptic Feedback・Predictive UI) — 32ドメイン×12設計アプローチのポリモーフィック開発インテリジェンス。</p>'+
'<h3>⑰ プロンプトゲノムエンジン (4ファイル)</h3>'+
'<p>65_prompt_genome.md (プロジェクト固有プロンプトDNA・CRITERIA 8軸品質スコア付き全フェーズプロンプト) / 66_ai_maturity_assessment.md (チームAI成熟度5次元評価・Assisted→Augmented→Autonomous段階的ロードマップ) / 67_prompt_composition_guide.md (12設計アプローチ×12シナジーマトリクス・4層テンプレートアーキテクチャ・複合プロンプトパターン) / 68_prompt_kpi_dashboard.md (アプローチ別成功KPI・測定計画・AI効果測定ダッシュボード) — 世界初のプロジェクト固有プロンプトDNA自動生成エンジン。CRITERIA品質スコア付き。</p>'+
'<h3>⑱ Prompt Engineering OS (4ファイル)</h3>'+
'<p>69_prompt_ops_pipeline.md (Prompt CI/CDパイプライン・5ステージライフサイクル・バージョン管理・A/Bテスト・ロールバック) / 70_react_workflow.md (ReAct自律ワークフロー・6フェーズ×Reason→Act→Observe→Verify・自己デバッグループ・障害回復) / 71_llmops_dashboard.md (LLMOps評価ダッシュボード・CRITERIA統合メトリクス・コスト最適化・可観測性) / 72_prompt_registry.md ([META]構造化プロンプトレジストリ・Template-ID命名・バージョン履歴・ドメイン別カタログ) — 世界初Prompt DevOpsプラットフォーム自動生成。⑰のPrompt DNAを運用化。</p>'+
'<h3>⑲ エンタープライズSaaS Blueprint (4ファイル)</h3>'+
'<p>73_enterprise_architecture.md (マルチテナントアーキテクチャ・組織ERモデル・RLSポリシー・権限マトリクス・招待フロー) / 74_workflow_engine.md (承認・チケット・注文・契約・オンボーディングのステートマシン・SLAトラッキング) / 75_admin_dashboard_spec.md (管理ダッシュボードワイヤーフレーム・KPIカード・週次トレンド・ユーザーワークロード分析) / 76_enterprise_components.md (8+エンタープライズUIコンポーネント仕様・Props・バリアント・A11y・フレームワーク対応) — SaaS/Analytics/HR/Collab/Toolドメインで自動生成。世界唯一のエンタープライズSaaSアーキテクチャ自動生成エンジン。</p>'+
'<h3>⑳ CI/CDインテリジェンス (4ファイル)</h3>'+
'<p>77_cicd_pipeline_design.md (9ステージパイプライン設計・Mermaid graph TD・デプロイ先別GitHub Actions YAML・キャッシュ戦略・マトリクステスト) / 78_deployment_strategy.md (dev/staging/prod環境戦略・blue-green/canary/rolling/recreate戦略選択・ロールバック自動化・シークレット管理) / 79_quality_gate_matrix.md (ステージ×ゲートマトリクス・カバレッジ閾値・パフォーマンス予算・ドメイン固有ゲート・Mermaidフロー) / 80_release_engineering.md (Trunk-Based/GitFlow/GitHub Flow選択・Mermaid gitGraph・セマンティックバージョニング・Renovate設定・SBOM生成) — 全ドメイン生成。デプロイ先9種（Vercel/Firebase/CF/Railway/Fly/Render/AWS/Docker/Netlify）に最適化されたCI/CDパイプライン自動設計エンジン。</p>'
:
'<h2>20 Pillars in Detail</h2><h3>① SDD Integration (5 files)</h3>'+
'<p>constitution.md / specification.md / technical-plan.md / tasks.md / verification.md</p>'+
'<h3>② DevContainer (4 files)</h3>'+
'<p>devcontainer.json / Dockerfile / docker-compose.yml / post-create.sh — Just open in VS Code/Cursor.</p>'+
'<h3>③ MCP Config (3 files)</h3>'+
'<p>project-context.md / tools-manifest.json / mcp-config.json</p>'+
'<h3>④ AI Rules (12+ files)</h3>'+
'<p>Cursor / Antigravity / Claude Code (CLAUDE.md, AGENTS.md) / Copilot / Windsurf / Cline / Kiro / Codex / Skills (project/catalog/pipelines) / Hooks</p>'+
'<h3>⑤ Parallel Explorer (UI)</h3>'+
'<p>Compare 2 of 7 stack patterns. Scored by dev speed, scalability, learning curve, and ecosystem.</p>'+
'<h3>⑥ Context Dashboard (UI)</h3>'+
'<p>Token counts, model fit, file size distribution, and Tech Master Table ('+_TECH_COUNT+') at a glance.</p>'+
'<h3>⑦ Roadmap (9 files + UI)</h3>'+
'<p>LEARNING_PATH / TECH_STACK_GUIDE / MOBILE_GUIDE / TOOLS_SETUP / RESOURCES / MILESTONES / AI_WORKFLOW / AI_AUTONOMOUS / SAAS_COMMERCE_GUIDE — Interactive UI for progress tracking.</p>'+
'<h3>⑧ AI Prompt Launcher (UI)</h3>'+
'<p>Bulk-feed generated specs to AI tools. 36 prompt templates (Review, Implement, Test, Refactor, Security, Docs, QA, Debug, Architecture, Performance, API, Accessibility, Migration, Metrics, i18n, Growth, Reverse Engineering, Incident Response, Ops Readiness, Strategic Intelligence, Risk & Compliance, Onboarding, CI/CD Design, Optimal Methodology, 9-Expert Brainstorm, UX Journey Design, AI Model Selection, Industry Deep Dive, Next-Gen UX, Cognitive Load, Prompt Genome Analysis, AI Maturity Review, ReAct Debug Loop, Prompt Ops Review, Enterprise Architecture Review, Workflow Process Audit). Per-folder token estimation and model fit display. <strong>See "📋 Prompt Manual" for details</strong>.</p>'+
'<h3>⑨ Design System (2 files)</h3>'+
'<p>design_system.md (design tokens, colors, typography, component catalog) / sequence_diagrams.md (auth, CRUD, payment Mermaid sequence diagrams) — Framework-specific guides.</p>'+
'<h3>⑩ Reverse Engineering (2 files)</h3>'+
'<p>reverse_engineering.md (goal definition → reverse flow, milestone Gantt, risk analysis) / goal_decomposition.md (goal tree, sub-goal breakdown, gap analysis, priority matrix, dependency chain) — 32 domain-specific reverse planning.</p>'+
'<h3>⑪ Implementation Intelligence (4 files)</h3>'+
'<p>implementation_playbook.md (domain-specific impl patterns, pseudo-code, stack guidance, cross-cutting concerns checklist) / ai_dev_runbook.md (AI operation workflow, context management, error recovery protocol) / skill_guide.md (skill-level usage guide, cautions, checklists) / impl-patterns.md (implementation skills in Manus Skills format, if ai_auto≠none) — 32 domain-specific implementation guide.</p>'+
'<h3>⑫ Security Intelligence (5 files)</h3>'+
'<p>security_intelligence.md (OWASP Top 10 2025 audit, security headers, shared responsibility model, secrets management, auth security) / threat_model.md (STRIDE entity threat analysis, attack surface, mitigation matrix) / compliance_matrix.md (PCI DSS, HIPAA, GDPR, ISMAP, SOC 2, FERPA domain-specific checklists) / ai_security.md (AI-generated code review, package hallucination detection, adversarial AI prompts, agent security) / security_testing.md (RLS tests, Zod schemas, IDOR tests, OWASP ZAP config, penetration testing checklist) — Stack-adaptive security auto-generation engine.</p>'+
'<h3>⑬ Strategic Intelligence (5 files)</h3>'+
'<p>industry_blueprint.md (industry regulations, recommended architecture, failure factors, business model comparison) / tech_radar.md (2026-2030 tech trend radar, Adopt/Trial/Assess/Hold classification, stack evolution roadmap) / stakeholder_strategy.md (stakeholder-specific dev strategy, tech debt management, team composition, budget allocation guide) / operational_excellence.md (tech debt management framework, DR/BCP, Green IT, Conway\'s Law team design) — 32 domain-specific industry strategic intelligence. World\'s only strategic document auto-generation engine.</p>'+
'<h3>⑭ Ops Intelligence (3 files)</h3>'+
'<p>ops_runbook.md (Ops Plane design, Feature Flags, SLO/SLI, Observability, Jobs, Backup, Rate Limiting) / ops_checklist.md (12 Ops Capabilities Matrix, Day-1 ops readiness) / ops_plane_design.md (Ops Plane Architecture, 12 Ops Capabilities implementation patterns, Circuit Breaker, Evidence-Based Operations, Dev×Ops AI responsibility separation, Admin Console security) — Domain-adaptive Ops Plane design auto-generation engine. World\'s only ops design document auto-generation.</p>'+
'<h3>⑮ Future Strategy Intelligence (4 files)</h3>'+
'<p>market_positioning.md (market positioning, competitive analysis, MOAT, GTM strategy, unit economics) / user_experience_strategy.md (UX strategy, personas, user journeys, accessibility, digital wellbeing) / ecosystem_strategy.md (ecosystem strategy, API-as-Product, DX, FinOps, community) / regulatory_foresight.md (regulatory foresight, 2026-2030 horizon, EU AI Act, ESG metrics) — 32 domain-specific future strategy auto-generation.</p>'+
'<h3>⑯ Dev IQ Intelligence (4 files)</h3>'+
'<p>dev_methodology.md (32 domain development methodologies, TDD/DDD/BDD/FDD, polymorphic development strategy) / phase_prompts.md (6-phase × design approach AI prompts, implementation guidance) / industry_dev_strategy.md (15 industry development strategies, recommended stacks, KPIs, failure pattern avoidance) / next_gen_ux.md (next-gen UX methods, Voice-First, Spatial Computing, Haptic Feedback, Predictive UI) — Polymorphic development intelligence for 32 domains × 12 design approaches.</p>'+
'<h3>⑰ Prompt Genome Engine (4 files)</h3>'+
'<p>65_prompt_genome.md (project-specific Prompt DNA, full-phase prompts with CRITERIA 8-axis quality scores) / 66_ai_maturity_assessment.md (team AI maturity 5-dimension assessment, Assisted→Augmented→Autonomous progressive roadmap) / 67_prompt_composition_guide.md (12 design approaches × 12 synergy matrix, 4-layer template architecture, composite prompt patterns) / 68_prompt_kpi_dashboard.md (per-approach success KPIs, measurement plan, AI effectiveness dashboard) — World\'s first project-specific Prompt DNA auto-generation engine with CRITERIA quality scoring.</p>'+
'<h3>⑱ Prompt Engineering OS (4 files)</h3>'+
'<p>69_prompt_ops_pipeline.md (Prompt CI/CD pipeline, 5-stage lifecycle, version control, A/B test framework, rollback procedure) / 70_react_workflow.md (ReAct autonomous workflow, 6 phases × Reason→Act→Observe→Verify, self-debug loop, failure recovery patterns) / 71_llmops_dashboard.md (LLMOps evaluation dashboard, CRITERIA-integrated metrics, cost optimization, observability) / 72_prompt_registry.md ([META] structured prompt registry, Template-ID naming, version history, domain-specific catalog) — World\'s first Prompt DevOps platform auto-generation. Operationalizes Prompt DNA from ⑰.</p>'+
'<h3>⑲ Enterprise SaaS Blueprint (4 files)</h3>'+
'<p>73_enterprise_architecture.md (multi-tenant architecture, org ER model, RLS policies, permission matrix, invite flow) / 74_workflow_engine.md (approval, ticket, order, contract, onboarding state machines, SLA tracking) / 75_admin_dashboard_spec.md (admin dashboard wireframe, KPI cards, weekly trends, user workload analytics) / 76_enterprise_components.md (8+ enterprise UI component specs, Props, Variants, A11y, framework mapping) — Auto-generated for SaaS/Analytics/HR/Collab/Tool domains. World\'s only enterprise SaaS architecture auto-generation engine.</p>'+
'<h3>⑳ CI/CD Intelligence (4 files)</h3>'+
'<p>77_cicd_pipeline_design.md (9-stage pipeline design, Mermaid graph TD, deploy-target GitHub Actions YAML, cache strategy, matrix tests) / 78_deployment_strategy.md (dev/staging/prod env strategy, blue-green/canary/rolling/recreate strategy selection, rollback automation, secrets management) / 79_quality_gate_matrix.md (stage × gate matrix, coverage thresholds, performance budget, domain-specific gates, Mermaid flow) / 80_release_engineering.md (Trunk-Based/GitFlow/GitHub Flow selection, Mermaid gitGraph, semantic versioning, Renovate config, SBOM generation) — Generated for all domains. CI/CD pipeline auto-design engine optimized for 9 deploy targets (Vercel/Firebase/CF/Railway/Fly/Render/AWS/Docker/Netlify).</p>'
},
{id:'export',title:_ja?'エクスポート':'Export',body:_ja?
'<h2>エクスポート方法</h2><p><strong>ZIP</strong>: 全135+ファイルをフォルダ構造付きでZIP圧縮ダウンロード。<br><strong>PDF</strong>: Markdownファイルを整形してブラウザのPDF印刷で出力。<br><strong>URL共有</strong>: プロジェクト設定をBase64エンコードしてURL共有。<br><strong>全ファイルコピー</strong>: 全ドキュメントを1テキストに結合してクリップボードにコピー（Ctrl+Shift+C）。AIへの一括投入に最適。</p><h3>テンプレート保存</h3><p>プロジェクト設定をlocalStorageに保存し、次回起動時に読み込み可能。</p>'+
'<p class="workflow-ref">📘 <strong>エクスポート後の開発手順は <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">生成後ワークフローガイド</a> を参照</strong></p>'
:
'<h2>Export Methods</h2><p><strong>ZIP</strong>: Download all 135+ files as a ZIP with folder structure.<br><strong>PDF</strong>: Format Markdown files and print via browser PDF.<br><strong>URL Sharing</strong>: Base64-encode project settings and share via URL.<br><strong>Copy All Files</strong>: Combine all documents into one text and copy to clipboard (Ctrl+Shift+C). Ideal for bulk AI input.</p><h3>Template Save</h3><p>Save project settings to localStorage and load them on next launch.</p>'+
'<p class="workflow-ref">📘 <strong>For development workflow after export, see <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">Post-Gen Workflow Guide</a></strong></p>'
},
{id:'guide',title:_ja?'🚀 活用ガイド':'🚀 Usage Guide',body:function(){
const baseBody=_ja?
'<h2>🚀 生成ファイル活用ガイド</h2>'+
'<p>DevForge v9 は世界で唯一の<strong>仕様駆動AIプロジェクトジェネレーター</strong>です。他のツールが「コード」を生成するのに対し、DevForge は「開発の知性」── 設計・環境・ルール・学習計画を135+ファイルで生成します。</p>'+
'<h3>🌱 Beginner — まず動かす</h3>'+
'<h4>⭐ 具体的な使用方法（手順詳細）</h4>'+
'<p><strong>Step 1: ロードマップに従う</strong><br>ダッシュボード（柱⑦）のロードマップUIがそのまま学習計画。Layer 1から順にチェック。📖ボタンで公式ドキュメントに直接ジャンプ。各技術の学習順序が最適化されています。</p>'+
'<p><strong>Step 2: 3つだけ覚える</strong><br>• <code>README.md</code> — GitHubにそのまま公開OK<br>• <code>.devcontainer/</code> — VS Code/Cursorで開くだけで環境完成<br>• <code>CLAUDE.md</code> — AIに「これ読んで」で全仕様を理解させる</p>'+
'<p><strong>Step 3: AIに丸ごと渡す</strong><br>「全ファイルコピー」(Ctrl+Shift+C) → AIツールに貼り付け → 仕様を把握した状態で開発スタート。</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>生成</span><span class="hg-a">→</span><span class="hg-n hg-c">Ctrl+Shift+C<br>コピー</span><span class="hg-a">→</span><span class="hg-n hg-p">AI貼付<br>Cursor等</span><span class="hg-a">→</span><span class="hg-n hg-g">開発<br>スタート</span></div>'+
'<h4>⭐ 注意事項（リスク回避）</h4>'+
'<p>• <strong>必ずZIP+JSONバックアップ</strong> — localStorageは消失リスクあり。作業後は必ず📦ZIPダウンロード + 📤JSONエクスポートの2段構え<br>'+
'• <strong>生成ファイルは設計書</strong> — 135+ファイルは実行コードではなく設計ドキュメント。AIツールに投入して実コードを生成<br>'+
'• <strong>スキルレベルは途中で変更しない</strong> — 回答との不整合が起きる。最初に正しく設定<br>'+
'• <strong>モデル適合度80%超時はフォルダ選択で絞る</strong> — ダッシュボードでモデル適合度確認。80%超時はランチャーのフォルダ選択で.spec/のみ等に絞る</p>'+
'<h4>⭐ よくある失敗例</h4>'+
'<table><tr><th>失敗</th><th>原因</th><th>対策</th></tr>'+
'<tr><td>ファイルを直接実行</td><td>設計書をコードと誤認</td><td>AIに投入して実コード生成</td></tr>'+
'<tr><td>全ファイル一度にAIに投入</td><td>トークン超過</td><td>.spec/のみで開始</td></tr>'+
'<tr><td>バックアップしない</td><td>localStorage依存</td><td>ZIP+JSON必須</td></tr>'+
'<tr><td>tasks.mdを使わない</td><td>非構造的な指示</td><td>Issue番号順に進める</td></tr></table>'+
'<h3>🔥 Intermediate — 効率を極める</h3>'+
'<h4>⭐⭐ 効率的な活用方法</h4>'+
'<p><strong>SDD仕様駆動開発:</strong> <code>.spec/</code> がプロジェクトのSSoT（信頼できる唯一の情報源）。constitution.md(憲法) → specification.md(要件) → tasks.md(タスク) → verification.md(完了基準)。AIへの指示は「tasks.mdの○○を実装して」の一文で完結。</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">constitution<br>原則</span><span class="hg-a">→</span><span class="hg-n hg-c">specification<br>要件</span><span class="hg-a">→</span><span class="hg-n hg-p">tasks<br>タスク</span><span class="hg-a">→</span><span class="hg-n hg-g">verification<br>完了基準</span></div>'+
'<p><strong>マルチAIツール統一:</strong> 柱④で生成される10+ファイルがCursor/.cursor/rules、Claude Code/CLAUDE.md、Copilot/.github/copilot-instructions.md、Windsurf/.windsurfrules、Cline/.clinerules、Gemini/.gemini/settings.json等を同時カバー。どのツールに乗り換えても同じルール。</p>'+
'<p><strong>MCP拡張:</strong> mcp-config.jsonをプロジェクトルートに配置 → context7(最新ドキュメント)、filesystem(構造把握)、playwright(E2Eテスト)等をAIが即利用。</p>'+
'<h4>⭐⭐ カスタマイズのポイント</h4>'+
'<p>• <strong>.claude/rules/の5ファイル</strong> — spec.md(仕様開発用)・frontend.md(FE開発用)・backend.md(BE開発用)・test.md(テスト開発用)・ops.md(運用開発用)をプロジェクト固有ルールに編集。パス別自動ロード。<br>'+
'• <strong>docs/43-47 セキュリティインテリジェンス</strong> — OWASP監査・STRIDE脅威モデル・コンプライアンスマトリクス・AI Security・セキュリティテスト設定をカスタマイズ<br>'+
'• <strong>docs/48-52 戦略インテリジェンス</strong> — 業種別設計図・技術レーダー・ステークホルダー戦略・オペレーショナルエクセレンスで業種別最適化<br>'+
'• <strong>ランチャーのテンプレートチェーン</strong> — 📋レビュー→🔨実装→🧪テスト→♻️リファクタの順次実行で効率化</p>'+
'<h4>⭐⭐ 品質向上のチェックリスト</h4>'+
'<p>✅ verification.mdで各機能の受入基準確認<br>✅ docs/32 QA Blueprintの品質ゲート通過<br>✅ モデル適合度80%以内で運用<br>✅ docs/33 Test Matrixでカバレッジ検証<br>✅ ランチャー🔒セキュリティテンプレートで監査実施<br>✅ docs/53-55 Ops関連ドキュメントで運用準備確認</p>'+
'<h3>⚡ Professional — 自動化を支配する</h3>'+
'<h4>⭐⭐⭐ 高度な統合・自動化</h4>'+
'<p><strong>Agent Teams並列開発:</strong> AGENTS.mdでエージェント役割を定義 → Claude Code Subagents / Antigravity Manager View で並列実行。tasks.mdがタスクキューとして機能。</p>'+
'<p><strong>CI/CDゲート化:</strong> .ai/hooks.yml → GitHub Actions変換。docs/09_release_checklist.mdをデプロイゲートに。verification.mdを品質基準に。</p>'+
'<p><strong>37テンプレートパイプライン:</strong> 柱⑧の全テンプレート順次実行 → 📋レビュー→🔨実装→🧪テスト→♻️リファクタ→🔒セキュリティ→📝ドキュメント→🛡️Ops準備→🏢エンタープライズアーキテクチャ。仕様書が全工程の入力。<strong>（📖 詳細はプロンプトマニュアル参照）</strong></p>'+
'<h4>⭐⭐⭐ パフォーマンス最適化</h4>'+
'<p>• <strong>CLAUDE.md 3-layer split</strong> — ルートCLAUDE.md（薄い ~1.5Kトークン） + .claude/rules/（パス別5ファイル） + .claude/settings.json でトークン消費を最小化<br>'+
'• <strong>フォルダ選択最適化</strong> — デバッグ時: docs/25+37のみ、仕様確認時: .spec/のみ等、状況に応じて選択<br>'+
'• <strong>コンテキスト・ローテーション戦略</strong> — docs/40 WSCIワークフロー活用。AI開発OS全体でコンテキスト管理</p>'+
'<h4>⭐⭐⭐ エッジケース対応</h4>'+
'<p>• <strong>docs/44 STRIDE脅威モデル</strong> — 攻撃面の網羅確認。エンティティ別脅威分析・攻撃対象領域・対策マトリクス<br>'+
'• <strong>docs/46 AI Security</strong> — 敵対的プロンプト・パッケージ幻覚・AI生成コードレビュー・Agent Securityで対策<br>'+
'• <strong>docs/54 Ops Checklist</strong> — 12 Ops Capabilities（Feature Flags・SLO/SLI・Observability・Jobs・Backup等）の完全実装<br>'+
'• <strong>docs/55 Circuit Breaker・Evidence-Based Ops</strong> — Ops Plane Architecture・Admin Consoleセキュリティ設計</p>'+
'<h3>⚔️ 他ツールとの比較</h3>'+
'<table><tr><th>機能</th><th>DevForge v9</th><th>create-next-app</th><th>AI直接依頼</th></tr>'+
'<tr><td>SDD仕様書5点</td><td>✅ 自動</td><td>✗</td><td>△ 手動</td></tr>'+
'<tr><td>10ツールAIルール</td><td>✅ 自動</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>互換性チェック</td><td>✅ 自動</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>ロードマップ</td><td>✅ 自動</td><td>✗</td><td>△ 手動</td></tr>'+
'<tr><td>DevContainer</td><td>✅ 自動</td><td>✗</td><td>△ 手動</td></tr>'+
'<tr><td>MCP+Agent設定</td><td>✅ 自動</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>'+_TECH_COUNT+' Tech DB</td><td>✅ 内蔵</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>オフライン動作</td><td>✅</td><td>✅</td><td>✗</td></tr></table>'+
'<h3>📋 ファイル活用マップ</h3>'+
'<table><tr><th>ファイル</th><th>🌱初心者</th><th>🔥中級者</th><th>⚡上級者</th></tr>'+
'<tr><td><code>CLAUDE.md</code></td><td>そのまま</td><td>カスタマイズ</td><td>Agent共有設定</td></tr>'+
'<tr><td><code>.spec/</code></td><td>読むだけ</td><td>AIに1つずつ</td><td>タスクキュー化</td></tr>'+
'<tr><td><code>.devcontainer/</code></td><td>そのまま</td><td>カスタマイズ</td><td>チーム標準化</td></tr>'+
'<tr><td><code>.claude/rules/</code> (5ファイル)</td><td>触らない</td><td>カスタマイズ</td><td>パス別最適化</td></tr>'+
'<tr><td><code>roadmap/</code></td><td>学習ガイド</td><td>進捗管理</td><td>オンボーディング</td></tr>'+
'<tr><td><code>docs/</code> 80ファイル</td><td>後で参照</td><td>レビュー素材</td><td>CI/CDゲート</td></tr>'+
'<tr><td><code>docs/29-30</code> リバースEng</td><td>読むだけ</td><td>逆算計画</td><td>マイルストーン管理</td></tr>'+
'<tr><td><code>docs/43-47</code> セキュリティ</td><td>不要</td><td>セキュリティ監査</td><td>セキュリティゲート</td></tr>'+
'<tr><td><code>docs/48-52</code> 戦略</td><td>不要</td><td>業種確認</td><td>戦略統合</td></tr>'+
'<tr><td><code>docs/53-55</code> Ops</td><td>不要</td><td>SLO参照</td><td>運用自動化</td></tr>'+
'<tr><td><code>docs/56-59</code> 未来戦略</td><td>不要</td><td>市場確認</td><td>戦略統合</td></tr>'+
'<tr><td>柱④ AIルール</td><td>触らない</td><td>ルール追加</td><td>全ツール統一</td></tr>'+
'<tr><td>柱⑧ ランチャー</td><td>使わない</td><td>部分利用</td><td>全工程自動化</td></tr>'+
'<tr><td><code>.mcp/ + config</code></td><td>後で</td><td>そのまま</td><td>カスタムMCP</td></tr>'+
'<tr><td><code>skills/</code></td><td>不要</td><td>参照</td><td>エージェントパイプライン</td></tr>'+
'<tr><td><code>AGENTS.md</code></td><td>不要</td><td>参照</td><td>並列Agent</td></tr>'+
'<tr><td><code>.ai/hooks.yml</code></td><td>不要</td><td>参照</td><td>CI/CD統合</td></tr></table>'+
'<p class="guide-action-p"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 レベル別ガイドを表示</button> <button class="btn btn-s btn-sm" onclick="showManual(\'workflow\')">📘 生成後ワークフロー</button></p>'+
'<p class="guide-action-p"><button class="btn btn-s btn-sm" onclick="window.open(\'devforge-v9-usage-guide.html\',\'_blank\',\'noopener\')">📖 活用ガイド（別ページ）</button> <button class="btn btn-s btn-sm" onclick="window.open(\'tech-selection-guide.html\',\'_blank\',\'noopener\')">📊 技術選定ガイド</button></p>':
'<h2>🚀 Generated Files Usage Guide</h2>'+
'<p>DevForge v9 is the world\'s only <strong>spec-driven AI project generator</strong>. While other tools generate code, DevForge generates "development intelligence" — design, environment, rules, and learning plans through 135+ files.</p>'+
'<h3>🌱 Beginner — Get Started</h3>'+
'<h4>⭐ Specific Usage Methods (Detailed Steps)</h4>'+
'<p><strong>Step 1: Follow the Roadmap</strong><br>The Dashboard (Pillar ⑦) roadmap UI is your learning plan. Check off from Layer 1. Hit 📖 to jump to official docs. Learning order is optimized for each tech stack.</p>'+
'<p><strong>Step 2: Remember Just 3 Files</strong><br>• <code>README.md</code> — Publish directly to GitHub<br>• <code>.devcontainer/</code> — Open in VS Code/Cursor and dev env is ready<br>• <code>CLAUDE.md</code> — Tell AI "read this" and it understands your entire project</p>'+
'<p><strong>Step 3: Feed Everything to AI</strong><br>"Copy All Files" (Ctrl+Shift+C) → Paste into AI tool → Start coding with full project context.</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>Generate</span><span class="hg-a">→</span><span class="hg-n hg-c">Ctrl+Shift+C<br>Copy</span><span class="hg-a">→</span><span class="hg-n hg-p">Paste to<br>AI Tool</span><span class="hg-a">→</span><span class="hg-n hg-g">Start<br>Coding</span></div>'+
'<h4>⭐ Cautions (Risk Avoidance)</h4>'+
'<p>• <strong>Always Backup ZIP+JSON</strong> — localStorage has loss risk. After work: 📦ZIP Download + 📤JSON Export (2-layer backup)<br>'+
'• <strong>Files are Design Docs</strong> — 135+ files are not executable code but design documents. Feed them to AI tools to generate real code<br>'+
'• <strong>Don\'t Change Skill Level Mid-Project</strong> — Causes inconsistency with answers. Set correctly at the start<br>'+
'• <strong>Use Folder Selection When Model Fit >80%</strong> — Check model fit in Dashboard. If >80%, narrow down to .spec/ only via launcher folder selection</p>'+
'<h4>⭐ Common Pitfalls</h4>'+
'<table><tr><th>Pitfall</th><th>Cause</th><th>Solution</th></tr>'+
'<tr><td>Try to run files directly</td><td>Mistook design docs as code</td><td>Feed to AI to generate real code</td></tr>'+
'<tr><td>Feed all files to AI at once</td><td>Token overflow</td><td>Start with .spec/ only</td></tr>'+
'<tr><td>No backup</td><td>Rely only on localStorage</td><td>ZIP+JSON mandatory</td></tr>'+
'<tr><td>Don\'t use tasks.md</td><td>Unstructured AI instructions</td><td>Follow Issue numbers in order</td></tr></table>'+
'<h3>🔥 Intermediate — Maximize Efficiency</h3>'+
'<h4>⭐⭐ Efficient Usage Methods</h4>'+
'<p><strong>SDD Workflow:</strong> <code>.spec/</code> is your SSoT (Single Source of Truth). constitution.md(principles) → specification.md(requirements) → tasks.md(tasks) → verification.md(acceptance criteria). Tell AI: "implement X from tasks.md following specification.md".</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">constitution<br>principles</span><span class="hg-a">→</span><span class="hg-n hg-c">specification<br>requirements</span><span class="hg-a">→</span><span class="hg-n hg-p">tasks<br>tasks</span><span class="hg-a">→</span><span class="hg-n hg-g">verification<br>acceptance</span></div>'+
'<p><strong>Multi-AI Tool Unity:</strong> Pillar ④ generates 10+ files covering Cursor/.cursor/rules, Claude Code/CLAUDE.md, Copilot/.github/copilot-instructions.md, Windsurf/.windsurfrules, Cline/.clinerules, Gemini/.gemini/settings.json etc. Same rules regardless of which tool you switch to.</p>'+
'<p><strong>MCP Extension:</strong> Place mcp-config.json in project root → AI instantly uses context7 (latest docs), filesystem (structure understanding), playwright (E2E test) MCPs.</p>'+
'<h4>⭐⭐ Customization Points</h4>'+
'<p>• <strong>.claude/rules/ 5 files</strong> — Edit spec.md (for spec dev), frontend.md (for FE dev), backend.md (for BE dev), test.md (for test dev), ops.md (for ops dev) for project-specific rules. Auto-loaded by path.<br>'+
'• <strong>docs/43-47 Security Intelligence</strong> — Customize OWASP audit, STRIDE threat model, compliance matrix, AI Security, security testing config<br>'+
'• <strong>docs/48-52 Strategic Intelligence</strong> — Use industry blueprint, tech radar, stakeholder strategy, operational excellence for domain-specific optimization<br>'+
'• <strong>Launcher Template Chains</strong> — Sequential execution: 📋Review→🔨Implement→🧪Test→♻️Refactor for efficiency</p>'+
'<h4>⭐⭐ Quality Improvement Checklist</h4>'+
'<p>✅ Check acceptance criteria in verification.md for each feature<br>✅ Pass quality gates in docs/32 QA Blueprint<br>✅ Keep model fit ≤80%<br>✅ Verify coverage with docs/33 Test Matrix<br>✅ Run audit with launcher 🔒Security template<br>✅ Confirm ops readiness with docs/53-55 Ops docs</p>'+
'<h3>⚡ Professional — Master Automation</h3>'+
'<h4>⭐⭐⭐ Advanced Integration & Automation</h4>'+
'<p><strong>Agent Teams Parallel Dev:</strong> AGENTS.md defines agent roles → Run with Claude Code Subagents / Antigravity Manager View in parallel. tasks.md serves as task queue.</p>'+
'<p><strong>CI/CD Gates:</strong> .ai/hooks.yml → GitHub Actions conversion. docs/09_release_checklist.md as deploy gate. verification.md as quality baseline.</p>'+
'<p><strong>34-Template Pipeline:</strong> Pillar ⑧ full template sequential execution → 📋Review→🔨Implement→🧪Test→♻️Refactor→🔒Security→📝Docs→🛡️Ops Readiness→🏢Enterprise Arch. Specs feed all stages. <strong>(📖 See Prompt Manual for details)</strong></p>'+
'<h4>⭐⭐⭐ Performance Optimization</h4>'+
'<p>• <strong>CLAUDE.md 3-layer split</strong> — Root CLAUDE.md (thin ~1.5K tokens) + .claude/rules/ (path-specific 5 files) + .claude/settings.json minimizes token consumption<br>'+
'• <strong>Folder Selection Optimization</strong> — Debugging: docs/25+37 only, Spec check: .spec/ only etc. Select by context<br>'+
'• <strong>Context Rotation Strategy</strong> — Use docs/40 WSCI workflow. Manage context across AI Dev OS</p>'+
'<h4>⭐⭐⭐ Edge Case Handling</h4>'+
'<p>• <strong>docs/44 STRIDE Threat Model</strong> — Comprehensive attack surface check. Entity-specific threat analysis, attack surface, mitigation matrix<br>'+
'• <strong>docs/46 AI Security</strong> — Adversarial prompts, package hallucination, AI code review, Agent Security countermeasures<br>'+
'• <strong>docs/54 Ops Checklist</strong> — Complete implementation of 12 Ops Capabilities (Feature Flags, SLO/SLI, Observability, Jobs, Backup etc.)<br>'+
'• <strong>docs/55 Circuit Breaker・Evidence-Based Ops</strong> — Ops Plane Architecture, Admin Console security design</p>'+
'<h3>⚔️ Comparison with Other Tools</h3>'+
'<table><tr><th>Feature</th><th>DevForge v9</th><th>create-next-app</th><th>AI Direct</th></tr>'+
'<tr><td>SDD 5 Spec Docs</td><td>✅ Auto</td><td>✗</td><td>△ Manual</td></tr>'+
'<tr><td>10-Tool AI Rules</td><td>✅ Auto</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>Compat Check</td><td>✅ Auto</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>Roadmap</td><td>✅ Auto</td><td>✗</td><td>△ Manual</td></tr>'+
'<tr><td>DevContainer</td><td>✅ Auto</td><td>✗</td><td>△ Manual</td></tr>'+
'<tr><td>MCP+Agent Setup</td><td>✅ Auto</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>'+_TECH_COUNT+' Tech DB</td><td>✅ Built-in</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>Offline</td><td>✅</td><td>✅</td><td>✗</td></tr></table>'+
'<h3>📋 File Usage Map</h3>'+
'<table><tr><th>File</th><th>🌱Beginner</th><th>🔥Intermediate</th><th>⚡Pro</th></tr>'+
'<tr><td><code>CLAUDE.md</code></td><td>As-is</td><td>Customize</td><td>Agent config</td></tr>'+
'<tr><td><code>.spec/</code></td><td>Read only</td><td>Feed AI one by one</td><td>Task queue</td></tr>'+
'<tr><td><code>.devcontainer/</code></td><td>As-is</td><td>Customize</td><td>Team standard</td></tr>'+
'<tr><td><code>.claude/rules/</code> (5 files)</td><td>Don\'t touch</td><td>Customize</td><td>Path-specific tuning</td></tr>'+
'<tr><td><code>roadmap/</code></td><td>Learning</td><td>Progress</td><td>Onboarding</td></tr>'+
'<tr><td><code>docs/</code> 76 files</td><td>Later</td><td>Review material</td><td>CI/CD gates</td></tr>'+
'<tr><td><code>docs/29-30</code> Reverse Eng</td><td>Read only</td><td>Reverse planning</td><td>Milestone mgmt</td></tr>'+
'<tr><td><code>docs/43-47</code> Security</td><td>Skip</td><td>Security audit</td><td>Security gates</td></tr>'+
'<tr><td><code>docs/48-52</code> Strategy</td><td>Skip</td><td>Industry check</td><td>Full strategy</td></tr>'+
'<tr><td><code>docs/53-55</code> Ops</td><td>Skip</td><td>SLO reference</td><td>Ops automation</td></tr>'+
'<tr><td><code>docs/56-59</code> Future Strategy</td><td>Skip</td><td>Market check</td><td>Full integration</td></tr>'+
'<tr><td>Pillar ④ AI Rules</td><td>Don\'t touch</td><td>Add rules</td><td>Unified ops</td></tr>'+
'<tr><td>Pillar ⑧ Launcher</td><td>Skip</td><td>Partial use</td><td>Full pipeline</td></tr>'+
'<tr><td><code>.mcp/ + config</code></td><td>Later</td><td>As-is</td><td>Custom MCP</td></tr>'+
'<tr><td><code>skills/</code></td><td>Skip</td><td>Reference</td><td>Agent pipeline</td></tr>'+
'<tr><td><code>AGENTS.md</code></td><td>Skip</td><td>Reference</td><td>Multi-Agent</td></tr>'+
'<tr><td><code>.ai/hooks.yml</code></td><td>Skip</td><td>Reference</td><td>CI/CD Integration</td></tr></table>'+
'<p class="guide-action-p"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 Show Level Guide</button> <button class="btn btn-s btn-sm" onclick="showManual(\'workflow\')">📘 Post-Gen Workflow</button></p>'+
'<p class="guide-action-p"><button class="btn btn-s btn-sm" onclick="window.open(\'devforge-v9-usage-guide.html\',\'_blank\',\'noopener\')">📖 Usage Guide (Full Page)</button> <button class="btn btn-s btn-sm" onclick="window.open(\'tech-selection-guide.html\',\'_blank\',\'noopener\')">📊 Tech Selection Guide</button></p>';
let h=baseBody;
// Add domain-specific first steps
const a=S.answers||{};
const dom=detectDomain(a.purpose||'')||'_default';
const steps=DOMAIN_FIRST_STEPS[dom]||DOMAIN_FIRST_STEPS._default;
h+=_ja?'<h3>🎯 ドメイン別 初手ステップ</h3>':'<h3>🎯 Domain-Specific First Steps</h3>';
h+='<div class="guide-domain-steps">';
((_ja?steps.ja:steps.en)||[]).forEach((s,i)=>{h+=`<div class="guide-step-mini"><span class="guide-step-num-mini">${i+1}</span><span>${s}</span></div>`;});
h+='</div>';
// Add AI tool recipe
const tools=(a.ai_tools||'').split(',').map(t=>t.trim()).filter(t=>t);
const tool=tools.find(t=>AI_TOOL_RECIPES[t])||'_default';
const recipe=AI_TOOL_RECIPES[tool]||AI_TOOL_RECIPES._default;
h+=_ja?'<h3>🤖 AIツール別ワークフロー</h3>':'<h3>🤖 AI Tool Workflow</h3>';
h+=`<div class="guide-ai-recipe"><h4>${tool==='_default'?(_ja?'汎用ワークフロー':'Generic Workflow'):tool}</h4>`;
((_ja?recipe.ja:recipe.en)||[]).forEach(s=>{h+=`<div class="guide-recipe-step">${s}</div>`;});
h+='</div>';
// Add ADRs
const adrs=getADRs(a,_ja);
if(adrs.length>0){
h+=_ja?'<h3>📐 Architecture Decision Records (ADR)</h3>':'<h3>📐 Architecture Decision Records (ADR)</h3>';
h+=_ja?'<p class="guide-adr-intro">ユーザーの選択から自動抽出された設計判断:</p>':'<p class="guide-adr-intro">Auto-extracted design decisions from your choices:</p>';
h+='<div class="guide-adrs">';
adrs.forEach(adr=>{h+=`<div class="guide-adr"><span class="guide-adr-icon">${adr.icon}</span><div><strong>${adr.t}</strong><p>${adr.d}</p></div></div>`;});
h+='</div>';
}
return h;
}},
{id:'workflow',title:_ja?'📘 生成後ワークフロー':'📘 Post-Gen Workflow',body:_ja?
'<h2>📘 生成後ワークフロー完全ガイド</h2>'+
'<p class="guide-workflow-intro">DevForge v9で135+ファイルを生成した後、<strong>実際に動くアプリを作るまでの一気通貫の手順</strong>を5フェーズで解説します。</p>'+
'<h3>① 基礎概念 — DevForgeの生成物を理解する</h3>'+
'<div class="workflow-concept"><p><strong>重要:</strong> DevForgeが生成するのは<strong class="workflow-highlight">設計ドキュメント</strong>であり、実行可能なアプリケーションコードではありません。</p>'+
'<p><strong>SDD（仕様駆動開発）の思想:</strong> <code>.spec/</code>がSSoT（信頼できる唯一の情報源）として機能します。</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>生成</span><span class="hg-a">→</span><span class="hg-n hg-c">AIツールに<br>投入</span><span class="hg-a">→</span><span class="hg-n hg-p">実コード<br>生成</span><span class="hg-a">→</span><span class="hg-n hg-g">動くアプリ<br>完成</span></div></div>'+
'<h4>135+ファイルの全体像</h4>'+
'<table class="workflow-files"><tr><th>カテゴリ</th><th>内容</th><th>ファイル数</th></tr>'+
'<tr><td>.spec/</td><td>仕様駆動開発の5点セット</td><td>5</td></tr>'+
'<tr><td>.devcontainer/</td><td>Docker開発環境</td><td>4</td></tr>'+
'<tr><td>.mcp/</td><td>Model Context Protocol設定</td><td>3</td></tr>'+
'<tr><td>AIルール</td><td>10+ツール対応（Cursor, Claude Code等）</td><td>12+</td></tr>'+
'<tr><td>.claude/</td><td>パス別AIルール+設定</td><td>6</td></tr>'+
'<tr><td>docs/</td><td>76種類の仕様書・設計書</td><td>76</td></tr>'+
'<tr><td>roadmap/</td><td>学習パス</td><td>9</td></tr>'+
'<tr><td>共通</td><td>README, LICENSE等</td><td>4</td></tr>'+
'<tr><td>未来戦略</td><td>市場・UX・エコシステム・規制</td><td>4</td></tr></table>'+
'<h3>①-B レベル別ワークフロー — あなたの道を選ぶ</h3>'+
'<div class="workflow-level-guide">'+
'<h4>🌱 Beginner Track</h4>'+
'<h5>推奨ワークフロー（6ステップ）</h5>'+
'<ol class="workflow-level-steps">'+
'<li>.spec/constitution.md を読む（プロジェクトの使命）</li>'+
'<li>.spec/tasks.md → Sprint 1 のタスクを1つ選ぶ</li>'+
'<li>CLAUDE.md 全文をAIツールにコピペ（Ctrl+Shift+C）</li>'+
'<li>「tasks.mdのタスクXを、specification.mdに従って実装して」と指示</li>'+
'<li>docs/07_test_cases.md を参照しながらテスト</li>'+
'<li>ZIP+JSONで必ずバックアップ</li></ol>'+
'<p><strong>NFR目標:</strong> 応答1000ms / ベストエフォート可用性 / 50同時接続</p>'+
'<h5>注意事項</h5>'+
'<ul class="workflow-level-cautions">'+
'<li>生成ファイルを直接実行しない（設計書であり実行コードではない）</li>'+
'<li>全135+ファイルを一度にAIに投入しない（.spec/から開始）</li>'+
'<li>AIに「何を作ればいいですか？」と聞かない（tasks.mdに全て書いてある）</li>'+
'<li>バックアップを忘れない（localStorage消失リスク）</li></ul>'+
'<h5>よくある失敗</h5>'+
'<table class="workflow-level-pitfalls"><tr><th>失敗</th><th>原因</th><th>対策</th></tr>'+
'<tr><td>AIの回答が矛盾</td><td>コンテキスト未共有</td><td>CLAUDE.md毎回ロード</td></tr>'+
'<tr><td>何を聞くかわからない</td><td>仕様書未読</td><td>constitution→tasks順</td></tr>'+
'<tr><td>MVP未完成</td><td>全機能同時着手</td><td>Sprint 1だけに集中</td></tr></table>'+
'<h4>🔥 Intermediate Track</h4>'+
'<h5>推奨ワークフロー</h5>'+
'<ol class="workflow-level-steps">'+
'<li>AI_BRIEF.md でコンテキスト圧縮（~1200トークン）</li>'+
'<li>SDD順序: constitution → specification → tasks → verification</li>'+
'<li>ランチャーで🔍レビュー → 🚀MVP → 🧪テスト → ♻️リファクタのチェーン実行</li>'+
'<li>.claude/rules/ の5ファイルをプロジェクト固有にカスタマイズ</li>'+
'<li>docs/43-47 セキュリティ + docs/53-55 Ops で品質保証</li>'+
'<li>docs/56-59 未来戦略で市場ポジショニング確認</li></ol>'+
'<p><strong>NFR目標:</strong> 応答500ms / 99%可用性 / 200同時接続</p>'+
'<h5>カスタマイズ優先度</h5>'+
'<ol class="workflow-level-priority">'+
'<li>.spec/constitution.md → ビジネス価値精査</li>'+
'<li>.claude/rules/*.md → プロジェクト固有ルール</li>'+
'<li>docs/08_security.md → 業界コンプライアンス</li>'+
'<li>docs/56_market_positioning.md → GTM戦略</li></ol>'+
'<h5>品質チェックリスト</h5>'+
'<p class="workflow-level-checklist">'+
'✅ verification.md 受入基準<br>'+
'✅ docs/32 QA Blueprint 品質ゲート<br>'+
'✅ ランチャー🔒セキュリティ監査<br>'+
'✅ docs/53-55 Ops準備<br>'+
'✅ docs/57 UX戦略 アクセシビリティ確認</p>'+
'<h4>⚡ Professional Track</h4>'+
'<h5>推奨ワークフロー</h5>'+
'<ol class="workflow-level-steps">'+
'<li>AGENTS.md でエージェント役割定義 → 並列開発</li>'+
'<li>37テンプレート全パイプライン: レビュー→実装→テスト→リファクタ→セキュリティ→Docs→Ops→エンタープライズ</li>'+
'<li>CLAUDE.md 3-layer (root ~1.5K + .claude/rules/ + settings.json)</li>'+
'<li>mcp-config.json + skills/pipelines.md で自動化</li>'+
'<li>docs/55 Circuit Breaker + Evidence-Based Ops</li>'+
'<li>docs/58 エコシステム戦略 + docs/59 規制フォーサイトで長期設計</li></ol>'+
'<p><strong>NFR目標:</strong> 応答200ms(p95) / 99.9%可用性 / 1000+同時接続</p>'+
'<h5>エッジケース対応</h5>'+
'<ul class="workflow-level-edge">'+
'<li>docs/44 STRIDE脅威モデル → 攻撃面網羅</li>'+
'<li>docs/46 AI Security → 敵対的プロンプト対策</li>'+
'<li>docs/54 12 Ops Capabilities → 完全実装</li>'+
'<li>docs/59 規制対応 → EU AI Act / ESG</li></ul>'+
'<h5>自動化チェック</h5>'+
'<p class="workflow-level-checklist">'+
'✅ .ai/hooks.yml → CI/CDゲート化<br>'+
'✅ 全37テンプレートパイプライン完走<br>'+
'✅ SLO 99.9%設計完了<br>'+
'✅ Feature Flags全キルスイッチ設定</p>'+
'</div>'+
'<h3>② 準備 — 生成直後にやること</h3>'+
'<ol class="workflow-steps">'+
'<li><strong>監査結果の確認</strong><br>生成後のチャットパネルに表示される<code>❌ エラー</code> / <code>⚠️ 警告</code>をチェック。互換性問題や設定ミスがないか確認します。</li>'+
'<li><strong>バックアップ（重要！）</strong><br><code>📦 ZIPダウンロード</code> + <code>📤 JSONエクスポート</code>の2段構え。<span class="workflow-warn">localStorageのみなのでデータ消失リスクあり</span>。</li>'+
'<li><strong>開発環境構築</strong><br>'+
'<strong>Option A（推奨）:</strong> ZIP解凍 → VS Code/Cursorで開く → DevContainerが自動構築<br>'+
'<strong>Option B:</strong> 既存プロジェクトにファイルをコピー</li>'+
'<li><strong>AIツール設定</strong><br>以下の表を参考に設定:</li></ol>'+
'<table class="workflow-ai-tools"><tr><th>AIツール</th><th>自動読込ファイル</th><th>追加設定</th></tr>'+
'<tr><td>Cursor</td><td>.cursor/rules</td><td>なし</td></tr>'+
'<tr><td>Claude Code</td><td>CLAUDE.md</td><td>なし</td></tr>'+
'<tr><td>Windsurf</td><td>.windsurfrules</td><td>なし</td></tr>'+
'<tr><td>Cline</td><td>.clinerules</td><td>なし</td></tr>'+
'<tr><td>Copilot</td><td>copilot-instructions.md</td><td>.github/に配置</td></tr>'+
'<tr><td>その他</td><td>AI_BRIEF.md</td><td>手動貼付</td></tr></table>'+
'<p class="workflow-note">💡 MCP設定: <code>mcp-config.json</code>をプロジェクトルートに配置</p>'+
'<li><strong>Gitリポジトリ初期化</strong><br>'+
'<code>git init</code> → <code>.gitignore</code> 確認（Node.js用テンプレート推奨）→ 初回コミット<br>'+
'<span class="workflow-note">💡 ブランチ戦略: <code>main</code> + <code>develop</code> + feature branches推奨</span></li>'+
'<li><strong>環境変数の設定</strong><br>'+
'<code>.env.example</code> → <code>.env</code> にコピーして実際の値を設定。<span class="workflow-warn">⚠️ .envをgitにコミットしない</span></li></ol>'+
'<h3>③ 手順 — 5フェーズ開発ワークフロー</h3>'+
'<div class="workflow-phases">'+
'<div class="workflow-phase"><h4>Phase A: プロジェクト理解（Day 1）</h4>'+
'<ul><li><strong>ファイル読み順:</strong> <code>constitution.md</code> → <code>specification.md</code> → <code>technical-plan.md</code></li>'+
'<li><strong>Dashboardチェック:</strong> シナジースコア / モデル適合 / ヘルススコアを確認</li>'+
'<li><strong>設計確認:</strong> ER図（docs/04）+ API設計（docs/05）を把握</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase B: 環境構築（Day 1-2）</h4>'+
'<ul><li><strong>DevContainerパス:</strong> フォルダを開く → "Reopen in Container"</li>'+
'<li><strong>手動パス:</strong> package.json scripts + .env.exampleを参考に構築</li>'+
'<li><strong>データベースセットアップ:</strong> docs/04_er_diagram.md のER図に基づきスキーマ定義 → Supabase: Dashboard or <code>supabase migration new</code> / Prisma: <code>npx prisma migrate dev</code> / Drizzle: <code>npx drizzle-kit push</code></li>'+
'<li><strong>.env設定:</strong> DB接続文字列・APIキー・JWTシークレット等を <code>.env</code> に設定（.env.example参照）</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase C: AIと一緒に開発（Day 2+）</h4>'+
'<p><strong>アプローチ1: シンプル</strong></p>'+
'<div class="hg-flow"><span class="hg-n hg-c">Ctrl+Shift+C<br>全コピー</span><span class="hg-a">→</span><span class="hg-n hg-p">AIに貼付</span><span class="hg-a">→</span><span class="hg-n hg-g">"Issue #1を<br>実装して"</span></div>'+
'<p><strong>アプローチ2: 構造化</strong></p>'+
'<ul><li>ランチャーの🔍レビュー → 🚀MVP実装テンプレートを活用</li>'+
'<li><code>tasks.md</code>のIssue番号順に進める</li>'+
'<li>タスクループ: <code>タスク読む → 実装 → テスト → 完了マーク</code></li>'+
'<li><code>verification.md</code>で受入基準チェック</li></ul>'+
'<h5>推奨テンプレート順序</h5>'+
'<ol class="workflow-template-order"><li>🔍 仕様レビュー</li><li>🚀 MVP実装</li><li>🧪 テスト生成</li><li>🔒 セキュリティ監査</li><li>📝 ドキュメント更新</li></ol>'+
'<h5>AIが期待通りの出力をしない場合</h5>'+
'<ul><li><strong>コンテキスト不足:</strong> CLAUDE.mdを再ロード → .spec/から明示的に参照させる</li>'+
'<li><strong>ハルシネーション:</strong> docs/46_ai_security.md「パッケージ幻覚検知」チェックリスト活用</li>'+
'<li><strong>コンテキスト超過:</strong> ランチャーのフォルダ選択で.spec/のみに絞る → docs/40のWSCI戦略に従う</li>'+
'<li><strong>仕様と矛盾:</strong> verification.md の受入基準をプロンプトに含める</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase D: 品質保証</h4>'+
'<ul><li>ランチャーテンプレート: 🧪テスト → 🔒セキュリティ → ♿a11y</li>'+
'<li>参照先: docs/07, docs/28, docs/33</li>'+
'<li>エラーログ: docs/25_error_logs.mdに記録</li>'+
'<li><strong>セキュリティチェーン:</strong> docs/43（OWASP）→ docs/44（STRIDE）→ docs/45（コンプライアンス）→ docs/47（テスト設定）</li>'+
'<li><strong>UX戦略:</strong> docs/57 のアクセシビリティ基準・ペルソナ適合確認</li>'+
'<li><strong>規制確認:</strong> docs/59 の業種別規制チェック（fintech/health/education等）</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase E: リリース</h4>'+
'<ul><li>docs/24_progress.mdで進捗更新</li>'+
'<li>docs/09_release_checklist.mdに従う</li>'+
'<li>CI/CD: .github/workflows/ci.ymlが事前設定済み</li>'+
'<li><strong>モニタリング設定:</strong> docs/53 のSLO目標に基づきモニタリング → docs/54 の12 Ops Capabilitiesでアラート閾値設定</li>'+
'<li><strong>インシデント準備:</strong> docs/34_incident_response.md のランブック確認・初回訓練実施</li></ul>'+
'<h5>デプロイ先別ノート</h5>'+
'<ul><li><strong>Vercel:</strong> vercel.json + Edge Functions + ISR → Preview Deployments有効化</li>'+
'<li><strong>Railway:</strong> Dockerfile or Nixpack自動検出 → 環境変数はDashboard設定</li>'+
'<li><strong>AWS:</strong> Amplify/ECS/Lambda選択 → IAM + VPC + CloudWatch連携</li>'+
'<li><strong>Cloudflare:</strong> Pages + Workers → D1/R2連携 + Wrangler CLI</li></ul>'+
'<div class="hg-flow"><span class="hg-n hg-b">Build</span><span class="hg-a">→</span><span class="hg-n hg-c">Test</span><span class="hg-a">→</span><span class="hg-n hg-p">Fix</span><span class="hg-a">→</span><span class="hg-n hg-g">Release</span><span class="hg-a">→</span><span class="hg-n">Monitor</span></div></div></div>'+
'<h3>④ 応用 — 上級テクニック</h3>'+
'<ul class="workflow-advanced"><li><strong>テンプレートチェーン:</strong> ランチャーで複数テンプレートを順次実行（→ 📋プロンプトマニュアル参照）</li>'+
'<li><strong>マルチエージェント開発:</strong> AGENTS.md + Claude Code Subagents</li>'+
'<li><strong>再生成:</strong> スコープ変更後、再生成ボタン（回答は保持）</li>'+
'<li><strong>チームオンボーディング:</strong> ロードマップ（柱⑦）で新メンバー育成</li>'+
'<li><strong>グロース戦略:</strong> docs/41_growth_intelligence.md活用</li>'+
'<li><strong>ゴール再検証:</strong> docs/29-30でピボット時の方向性確認</li>'+
'<li><strong>未来戦略参照:</strong> docs/56-59で市場ポジショニング・UX戦略・エコシステム・規制対応</li></ul>'+
'<h3>④-B リリース後の運用とイテレーション</h3>'+
'<div class="workflow-iteration">'+
'<h4>Sprint 2+ イテレーションワークフロー</h4>'+
'<ul><li>フィードバック収集 (docs/57 ペルソナ・ジャーニー参照)</li>'+
'<li>タスク優先度見直し (docs/30 優先度マトリクス + docs/56 MOAT)</li>'+
'<li>リファクタ判断 (ランチャー📊メトリクス→♻️リファクタ)</li>'+
'<li>ループ: フィードバック→タスク追加→実装→QA→リリース→モニタリング</li></ul>'+
'<h4>運用モニタリングとSLO追跡</h4>'+
'<ul><li>docs/53 SLO/SLI実測値照合</li>'+
'<li>docs/55 Circuit Breakerパターン</li>'+
'<li>SLO未達時: docs/34 ポストモーテム</li></ul>'+
'<h4>Feature Flags管理</h4>'+
'<ul><li>docs/53 Feature Flags設計</li>'+
'<li>カナリア→段階的→フルリリース</li></ul>'+
'<h4>市場ポジショニング再評価</h4>'+
'<ul><li>docs/56 MOAT・GTM四半期レビュー</li>'+
'<li>docs/58 API戦略・エコシステム</li>'+
'<li>docs/59 規制変更チェック (EU AI Act/ESG)</li></ul></div>'+
'<h3>⑤ よくある失敗と回避策</h3>'+
'<table class="workflow-pitfalls"><tr><th>失敗</th><th>原因</th><th>対策</th></tr>'+
'<tr><td>ファイルを直接実行しようとする</td><td>DevForgeの出力を誤解</td><td>設計ドキュメントをAIに投入してコード生成</td></tr>'+
'<tr><td>バックアップしない</td><td>localStorageに依存</td><td>毎回ZIP+JSONエクスポート</td></tr>'+
'<tr><td>互換性警告を無視</td><td>ダッシュボード未確認</td><td>⚠️警告に対処してから開発開始</td></tr>'+
'<tr><td>全ファイルを一度にAIに投入</td><td>コンテキストウィンドウ超過</td><td>ランチャーのフォルダ選択でトークン管理</td></tr>'+
'<tr><td>tasks.mdを使わない</td><td>非構造的なAI指示</td><td>Issue番号順に実装</td></tr>'+
'<tr><td>verification.mdをスキップ</td><td>受入基準なし</td><td>機能ごとにverification.mdで確認</td></tr>'+
'<tr><td>途中でスキルレベル変更</td><td>質問選択肢の不整合</td><td>最初に正しく設定</td></tr>'+
'<tr><td>MCP未設定</td><td>AIツール連携が不完全</td><td>mcp-config.jsonを配置</td></tr>'+
'<tr><td>Git/環境変数を忘れる</td><td>初期設定の省略</td><td>②準備のgit init+.env設定を必ず実施</td></tr>'+
'<tr><td>リリース後の運用を想定しない</td><td>MVP偏重</td><td>④-Bの運用・イテレーション計画を確認</td></tr></table>'+
'<h3>⑥ まとめ — クイックリファレンス</h3>'+
'<div class="workflow-summary"><h4>12項目チェックリスト</h4>'+
'<ol class="workflow-checklist"><li>✅ 監査結果確認（❌ / ⚠️ なし）</li><li>✅ ZIP + JSONバックアップ済み</li>'+
'<li>✅ DevContainer起動 or 手動環境構築完了</li><li>✅ AIツールにルールファイル認識済み</li>'+
'<li>✅ constitution.md → specification.md 読了</li><li>✅ tasks.mdを開いてタスク把握</li>'+
'<li>✅ Issue #1から順次実装開始</li><li>✅ verification.mdで受入基準確認</li>'+
'<li>✅ テスト・セキュリティ監査実施</li><li>✅ リリースチェックリストで最終確認</li>'+
'<li>✅ 環境変数(.env)設定済み・git除外確認</li><li>✅ モニタリング・SLO設定完了</li></ol>'+
'<h4>全体フロー図</h4>'+
'<div class="hg-flow"><span class="hg-n hg-b">生成</span><span class="hg-a">→</span><span class="hg-n hg-c">バックアップ</span><span class="hg-a">→</span><span class="hg-n hg-p">環境構築</span><span class="hg-a">→</span><span class="hg-n">仕様理解</span><span class="hg-a">→</span><span class="hg-n">AI開発</span><span class="hg-a">→</span><span class="hg-n">QA</span><span class="hg-a">→</span><span class="hg-n hg-g">リリース</span><span class="hg-a">→</span><span class="hg-n">イテレーション</span></div>'+
'<p class="workflow-footer"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 レベル別ガイドを表示</button></p></div>'
:
'<h2>📘 Complete Post-Generation Workflow Guide</h2>'+
'<p class="guide-workflow-intro">After generating 135+ files with DevForge v9, follow this <strong>end-to-end workflow</strong> in 5 phases to build a working app.</p>'+
'<h3>① Fundamentals — Understanding DevForge Output</h3>'+
'<div class="workflow-concept"><p><strong>Important:</strong> DevForge generates <strong class="workflow-highlight">design documents</strong>, not runnable application code.</p>'+
'<p><strong>SDD (Spec-Driven Development) Philosophy:</strong> <code>.spec/</code> serves as your SSoT (Single Source of Truth).</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>Generate</span><span class="hg-a">→</span><span class="hg-n hg-c">Feed to<br>AI Tool</span><span class="hg-a">→</span><span class="hg-n hg-p">Generate<br>Real Code</span><span class="hg-a">→</span><span class="hg-n hg-g">Working<br>App</span></div></div>'+
'<h4>135+ Files Overview</h4>'+
'<table class="workflow-files"><tr><th>Category</th><th>Content</th><th>Files</th></tr>'+
'<tr><td>.spec/</td><td>SDD 5-point set</td><td>5</td></tr>'+
'<tr><td>.devcontainer/</td><td>Docker dev environment</td><td>4</td></tr>'+
'<tr><td>.mcp/</td><td>Model Context Protocol config</td><td>3</td></tr>'+
'<tr><td>AI Rules</td><td>10+ tool support (Cursor, Claude Code, etc.)</td><td>12+</td></tr>'+
'<tr><td>.claude/</td><td>Path-specific AI rules + config</td><td>6</td></tr>'+
'<tr><td>docs/</td><td>76 spec/design documents</td><td>76</td></tr>'+
'<tr><td>roadmap/</td><td>Learning paths</td><td>9</td></tr>'+
'<tr><td>Common</td><td>README, LICENSE, etc.</td><td>4</td></tr>'+
'<tr><td>Future Strategy</td><td>Market, UX, Ecosystem, Regulatory</td><td>4</td></tr></table>'+
'<h3>①-B Level-Specific Workflow — Choose Your Path</h3>'+
'<div class="workflow-level-guide">'+
'<h4>🌱 Beginner Track</h4>'+
'<h5>Recommended Workflow (6 Steps)</h5>'+
'<ol class="workflow-level-steps">'+
'<li>Read .spec/constitution.md (project mission)</li>'+
'<li>.spec/tasks.md → Pick one task from Sprint 1</li>'+
'<li>Copy CLAUDE.md full text to AI tool (Ctrl+Shift+C)</li>'+
'<li>Instruct: "Implement task X from tasks.md following specification.md"</li>'+
'<li>Test while referencing docs/07_test_cases.md</li>'+
'<li>Always backup with ZIP+JSON</li></ol>'+
'<p><strong>NFR Targets:</strong> 1000ms response / Best-effort availability / 50 concurrent connections</p>'+
'<h5>Cautions</h5>'+
'<ul class="workflow-level-cautions">'+
'<li>Don\'t run generated files directly (they are design docs, not executable code)</li>'+
'<li>Don\'t feed all 135+ files to AI at once (start with .spec/)</li>'+
'<li>Don\'t ask AI "What should I build?" (tasks.md has everything)</li>'+
'<li>Don\'t forget backups (localStorage loss risk)</li></ul>'+
'<h5>Common Pitfalls</h5>'+
'<table class="workflow-level-pitfalls"><tr><th>Pitfall</th><th>Cause</th><th>Solution</th></tr>'+
'<tr><td>AI contradicts itself</td><td>Missing context</td><td>Load CLAUDE.md every time</td></tr>'+
'<tr><td>Don\'t know what to ask</td><td>Specs not read</td><td>constitution→tasks order</td></tr>'+
'<tr><td>MVP incomplete</td><td>All features at once</td><td>Focus on Sprint 1 only</td></tr></table>'+
'<h4>🔥 Intermediate Track</h4>'+
'<h5>Recommended Workflow</h5>'+
'<ol class="workflow-level-steps">'+
'<li>AI_BRIEF.md for context compression (~1200 tokens)</li>'+
'<li>SDD order: constitution → specification → tasks → verification</li>'+
'<li>Launcher chain: 🔍Review → 🚀MVP → 🧪Test → ♻️Refactor</li>'+
'<li>Customize .claude/rules/ 5 files for project-specific rules</li>'+
'<li>docs/43-47 Security + docs/53-55 Ops for quality assurance</li>'+
'<li>docs/56-59 Future Strategy for market positioning</li></ol>'+
'<p><strong>NFR Targets:</strong> 500ms response / 99% availability / 200 concurrent connections</p>'+
'<h5>Customization Priority</h5>'+
'<ol class="workflow-level-priority">'+
'<li>.spec/constitution.md → Business value scrutiny</li>'+
'<li>.claude/rules/*.md → Project-specific rules</li>'+
'<li>docs/08_security.md → Industry compliance</li>'+
'<li>docs/56_market_positioning.md → GTM strategy</li></ol>'+
'<h5>Quality Checklist</h5>'+
'<p class="workflow-level-checklist">'+
'✅ verification.md acceptance criteria<br>'+
'✅ docs/32 QA Blueprint quality gates<br>'+
'✅ Launcher 🔒Security audit<br>'+
'✅ docs/53-55 Ops readiness<br>'+
'✅ docs/57 UX Strategy accessibility check</p>'+
'<h4>⚡ Professional Track</h4>'+
'<h5>Recommended Workflow</h5>'+
'<ol class="workflow-level-steps">'+
'<li>AGENTS.md define agent roles → Parallel development</li>'+
'<li>Full 34-template pipeline: Review→Implement→Test→Refactor→Security→Docs→Ops</li>'+
'<li>CLAUDE.md 3-layer (root ~1.5K + .claude/rules/ + settings.json)</li>'+
'<li>mcp-config.json + skills/pipelines.md for automation</li>'+
'<li>docs/55 Circuit Breaker + Evidence-Based Ops</li>'+
'<li>docs/58 Ecosystem Strategy + docs/59 Regulatory Foresight for long-term design</li></ol>'+
'<p><strong>NFR Targets:</strong> 200ms response(p95) / 99.9% availability / 1000+ concurrent connections</p>'+
'<h5>Edge Case Handling</h5>'+
'<ul class="workflow-level-edge">'+
'<li>docs/44 STRIDE Threat Model → Comprehensive attack surface</li>'+
'<li>docs/46 AI Security → Adversarial prompt countermeasures</li>'+
'<li>docs/54 12 Ops Capabilities → Complete implementation</li>'+
'<li>docs/59 Regulatory → EU AI Act / ESG</li></ul>'+
'<h5>Automation Checks</h5>'+
'<p class="workflow-level-checklist">'+
'✅ .ai/hooks.yml → CI/CD gate integration<br>'+
'✅ All 37 template pipeline complete<br>'+
'✅ SLO 99.9% design complete<br>'+
'✅ Feature Flags all kill switches configured</p>'+
'</div>'+
'<h3>② Preparation — What to Do Right After Generation</h3>'+
'<ol class="workflow-steps">'+
'<li><strong>Check Audit Results</strong><br>Review <code>❌ Errors</code> / <code>⚠️ Warnings</code> in the chat panel after generation. Fix compatibility issues or config errors.</li>'+
'<li><strong>Backup (Critical!)</strong><br><code>📦 Download ZIP</code> + <code>📤 Export JSON</code> in tandem. <span class="workflow-warn">Data only exists in localStorage = loss risk</span>.</li>'+
'<li><strong>Set Up Dev Environment</strong><br>'+
'<strong>Option A (Recommended):</strong> Extract ZIP → Open in VS Code/Cursor → DevContainer auto-builds<br>'+
'<strong>Option B:</strong> Copy files to existing project</li>'+
'<li><strong>Configure AI Tools</strong><br>Refer to the table below:</li></ol>'+
'<table class="workflow-ai-tools"><tr><th>AI Tool</th><th>Auto-Loaded File</th><th>Additional Setup</th></tr>'+
'<tr><td>Cursor</td><td>.cursor/rules</td><td>None</td></tr>'+
'<tr><td>Claude Code</td><td>CLAUDE.md</td><td>None</td></tr>'+
'<tr><td>Windsurf</td><td>.windsurfrules</td><td>None</td></tr>'+
'<tr><td>Cline</td><td>.clinerules</td><td>None</td></tr>'+
'<tr><td>Copilot</td><td>copilot-instructions.md</td><td>Place in .github/</td></tr>'+
'<tr><td>Others</td><td>AI_BRIEF.md</td><td>Paste manually</td></tr></table>'+
'<p class="workflow-note">💡 MCP Setup: Place <code>mcp-config.json</code> in project root</p>'+
'<li><strong>Initialize Git Repository</strong><br>'+
'<code>git init</code> → Verify <code>.gitignore</code> (Node.js template recommended) → Initial commit<br>'+
'<span class="workflow-note">💡 Branch strategy: <code>main</code> + <code>develop</code> + feature branches recommended</span></li>'+
'<li><strong>Configure Environment Variables</strong><br>'+
'Copy <code>.env.example</code> → <code>.env</code> and set actual values. <span class="workflow-warn">⚠️ Do NOT commit .env to git</span></li></ol>'+
'<h3>③ Workflow — 5-Phase Development Process</h3>'+
'<div class="workflow-phases">'+
'<div class="workflow-phase"><h4>Phase A: Project Understanding (Day 1)</h4>'+
'<ul><li><strong>Reading Order:</strong> <code>constitution.md</code> → <code>specification.md</code> → <code>technical-plan.md</code></li>'+
'<li><strong>Dashboard Check:</strong> Synergy Score / Model Fit / Health Score</li>'+
'<li><strong>Design Review:</strong> ER diagram (docs/04) + API design (docs/05)</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase B: Environment Setup (Day 1-2)</h4>'+
'<ul><li><strong>DevContainer Path:</strong> Open folder → "Reopen in Container"</li>'+
'<li><strong>Manual Path:</strong> Follow package.json scripts + .env.example</li>'+
'<li><strong>Database Setup:</strong> Define schema based on ER diagram in docs/04_er_diagram.md → Supabase: Dashboard or <code>supabase migration new</code> / Prisma: <code>npx prisma migrate dev</code> / Drizzle: <code>npx drizzle-kit push</code></li>'+
'<li><strong>.env Configuration:</strong> Set DB connection string, API keys, JWT secret, etc. in <code>.env</code> (refer to .env.example)</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase C: AI-Assisted Development (Day 2+)</h4>'+
'<p><strong>Approach 1: Simple</strong></p>'+
'<div class="hg-flow"><span class="hg-n hg-c">Ctrl+Shift+C<br>Copy All</span><span class="hg-a">→</span><span class="hg-n hg-p">Paste to<br>AI</span><span class="hg-a">→</span><span class="hg-n hg-g">"Implement<br>Issue #1"</span></div>'+
'<p><strong>Approach 2: Structured</strong></p>'+
'<ul><li>Use Launcher\'s 🔍 Review → 🚀 MVP Build templates</li>'+
'<li>Work through <code>tasks.md</code> in Issue# order</li>'+
'<li>Task Loop: <code>Read Task → Implement → Test → Mark Complete</code></li>'+
'<li>Check acceptance criteria in <code>verification.md</code></li></ul>'+
'<h5>Recommended Template Order</h5>'+
'<ol class="workflow-template-order"><li>🔍 Spec Review</li><li>🚀 MVP Build</li><li>🧪 Test Generation</li><li>🔒 Security Audit</li><li>📝 Doc Update</li></ol>'+
'<h5>When AI Output Doesn\'t Meet Expectations</h5>'+
'<ul><li><strong>Insufficient Context:</strong> Reload CLAUDE.md → Explicitly reference from .spec/</li>'+
'<li><strong>Hallucination:</strong> Use "Package Hallucination Detection" checklist in docs/46_ai_security.md</li>'+
'<li><strong>Context Overflow:</strong> Narrow folder selection to .spec/ only in Launcher → Follow WSCI strategy in docs/40</li>'+
'<li><strong>Contradicts Spec:</strong> Include acceptance criteria from verification.md in prompt</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase D: Quality Assurance</h4>'+
'<ul><li>Launcher templates: 🧪 Test → 🔒 Security → ♿ a11y</li>'+
'<li>Reference: docs/07, docs/28, docs/33</li>'+
'<li>Error Log: Record in docs/25_error_logs.md</li>'+
'<li><strong>Security Chain:</strong> docs/43 (OWASP) → docs/44 (STRIDE) → docs/45 (Compliance) → docs/47 (Test Config)</li>'+
'<li><strong>UX Strategy:</strong> Verify accessibility standards and persona fit in docs/57</li>'+
'<li><strong>Regulatory Check:</strong> Domain-specific compliance in docs/59 (fintech/health/education, etc.)</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase E: Release</h4>'+
'<ul><li>Update progress in docs/24_progress.md</li>'+
'<li>Follow docs/09_release_checklist.md</li>'+
'<li>CI/CD: Pre-configured in .github/workflows/ci.yml</li>'+
'<li><strong>Monitoring Setup:</strong> Configure monitoring based on SLO targets in docs/53 → Set alert thresholds per 12 Ops Capabilities in docs/54</li>'+
'<li><strong>Incident Preparedness:</strong> Review runbook in docs/34_incident_response.md and conduct initial drill</li></ul>'+
'<h5>Deployment Platform Notes</h5>'+
'<ul><li><strong>Vercel:</strong> vercel.json + Edge Functions + ISR → Enable Preview Deployments</li>'+
'<li><strong>Railway:</strong> Dockerfile or Nixpack auto-detection → Set env vars via Dashboard</li>'+
'<li><strong>AWS:</strong> Choose Amplify/ECS/Lambda → Integrate IAM + VPC + CloudWatch</li>'+
'<li><strong>Cloudflare:</strong> Pages + Workers → D1/R2 integration + Wrangler CLI</li></ul>'+
'<div class="hg-flow"><span class="hg-n hg-b">Build</span><span class="hg-a">→</span><span class="hg-n hg-c">Test</span><span class="hg-a">→</span><span class="hg-n hg-p">Fix</span><span class="hg-a">→</span><span class="hg-n hg-g">Release</span><span class="hg-a">→</span><span class="hg-n">Monitor</span></div></div></div>'+
'<h3>④ Advanced — Expert Techniques</h3>'+
'<ul class="workflow-advanced"><li><strong>Template Chaining:</strong> Execute multiple templates sequentially in Launcher (→ See 📋 Prompt Manual)</li>'+
'<li><strong>Multi-Agent Development:</strong> AGENTS.md + Claude Code Subagents</li>'+
'<li><strong>Regeneration:</strong> After scope changes, regenerate (answers preserved)</li>'+
'<li><strong>Team Onboarding:</strong> Use Roadmap (Pillar ⑦) for new members</li>'+
'<li><strong>Growth Strategy:</strong> Leverage docs/41_growth_intelligence.md</li>'+
'<li><strong>Goal Re-validation:</strong> Use docs/29-30 for pivot direction</li>'+
'<li><strong>Future Strategy Reference:</strong> docs/56-59 for market positioning, UX strategy, ecosystem, regulatory</li></ul>'+
'<h3>④-B Post-Release Operations & Iteration</h3>'+
'<div class="workflow-iteration">'+
'<h4>Sprint 2+ Iteration Workflow</h4>'+
'<ul><li>Feedback collection (refer to docs/57 personas & journeys)</li>'+
'<li>Reprioritize tasks (docs/30 priority matrix + docs/56 MOAT)</li>'+
'<li>Refactoring decisions (Launcher 📊Metrics→♻️Refactor)</li>'+
'<li>Loop: Feedback→Add tasks→Implement→QA→Release→Monitor</li></ul>'+
'<h4>Operational Monitoring & SLO Tracking</h4>'+
'<ul><li>Verify SLO/SLI actual values against docs/53</li>'+
'<li>Apply Circuit Breaker patterns from docs/55</li>'+
'<li>On SLO miss: docs/34 postmortem</li></ul>'+
'<h4>Feature Flags Management</h4>'+
'<ul><li>Feature Flags design from docs/53</li>'+
'<li>Canary→Gradual→Full release</li></ul>'+
'<h4>Market Positioning Re-evaluation</h4>'+
'<ul><li>Quarterly MOAT & GTM review from docs/56</li>'+
'<li>API strategy & ecosystem from docs/58</li>'+
'<li>Regulatory change check (EU AI Act/ESG) from docs/59</li></ul></div>'+
'<h3>⑤ Common Pitfalls & Solutions</h3>'+
'<table class="workflow-pitfalls"><tr><th>Pitfall</th><th>Cause</th><th>Solution</th></tr>'+
'<tr><td>Trying to run files directly</td><td>Misunderstanding DevForge output</td><td>Feed design docs to AI to generate code</td></tr>'+
'<tr><td>Not backing up</td><td>Relying only on localStorage</td><td>ZIP + JSON export every time</td></tr>'+
'<tr><td>Ignoring compatibility warnings</td><td>Skipping Dashboard check</td><td>Address ⚠️ warnings before dev</td></tr>'+
'<tr><td>Feeding all files to AI at once</td><td>Context window overflow</td><td>Use Launcher folder selection for token mgmt</td></tr>'+
'<tr><td>Not using tasks.md</td><td>Unstructured AI instructions</td><td>Implement in Issue# order</td></tr>'+
'<tr><td>Skipping verification.md</td><td>No acceptance criteria</td><td>Check verification.md per feature</td></tr>'+
'<tr><td>Changing skill level mid-project</td><td>Question option inconsistency</td><td>Set correctly at start</td></tr>'+
'<tr><td>MCP not configured</td><td>Incomplete AI tool integration</td><td>Place mcp-config.json</td></tr>'+
'<tr><td>Forgetting Git/env vars</td><td>Skipping initial setup</td><td>Always complete git init+.env config in ② Preparation</td></tr>'+
'<tr><td>Not planning post-release ops</td><td>MVP-only focus</td><td>Review ops & iteration plan in ④-B</td></tr></table>'+
'<h3>⑥ Summary — Quick Reference</h3>'+
'<div class="workflow-summary"><h4>12-Item Checklist</h4>'+
'<ol class="workflow-checklist"><li>✅ Audit results reviewed (no ❌ / ⚠️)</li><li>✅ ZIP + JSON backup done</li>'+
'<li>✅ DevContainer running or manual env setup complete</li><li>✅ AI tool recognizes rule files</li>'+
'<li>✅ Read constitution.md → specification.md</li><li>✅ Opened tasks.md and identified tasks</li>'+
'<li>✅ Started implementing from Issue #1</li><li>✅ Checked acceptance criteria in verification.md</li>'+
'<li>✅ Ran tests & security audit</li><li>✅ Final check with release checklist</li>'+
'<li>✅ .env configured & excluded from git</li><li>✅ Monitoring & SLO setup complete</li></ol>'+
'<h4>Overall Flow Diagram</h4>'+
'<div class="hg-flow"><span class="hg-n hg-b">Generate</span><span class="hg-a">→</span><span class="hg-n hg-c">Backup</span><span class="hg-a">→</span><span class="hg-n hg-p">Setup Env</span><span class="hg-a">→</span><span class="hg-n">Understand<br>Specs</span><span class="hg-a">→</span><span class="hg-n">AI Dev</span><span class="hg-a">→</span><span class="hg-n">QA</span><span class="hg-a">→</span><span class="hg-n hg-g">Release</span><span class="hg-a">→</span><span class="hg-n">Iterate</span></div>'+
'<p class="workflow-footer"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 Show Level Guide</button></p></div>'
},
{id:'launcher-guide',title:_ja?'📋 プロンプトマニュアル':'📋 Prompt Manual',body:_ja?
'<h2>🤖 AIプロンプトランチャー 使い方マニュアル</h2>'+
'<h3>🔧 仕組み (How It Works)</h3>'+
'<div class="hg-flow"><span class="hg-n hg-b">📂<br>フォルダ選択</span><span class="hg-a">→</span><span class="hg-n hg-c">📋<br>テンプレート選択</span><span class="hg-a">→</span><span class="hg-n hg-p">⚙️<br>プロンプト自動合成</span><span class="hg-a">→</span><span class="hg-n hg-g">📋<br>コピー→AI投入</span></div>'+
'<p><strong>5パート自動合成:</strong></p>'+
'<table><tr><th>パート</th><th>内容</th></tr>'+
'<tr><td>① System</td><td>AIの役割定義（テックリード、QAエンジニア、セキュリティ専門家 等）</td></tr>'+
'<tr><td>② Context</td><td>プロジェクト情報（スタック構成、認証方式、エンティティ）</td></tr>'+
'<tr><td>③ Task</td><td>具体的な指示（レビュー手順、実装ステップ、テスト戦略）</td></tr>'+
'<tr><td>④ Format</td><td>出力形式（Markdown表、コードブロック、Mermaid図）</td></tr>'+
'<tr><td>⑤ Files</td><td>選択したフォルダの全ファイル内容</td></tr></table>'+
'<h3>📊 開発ライフサイクルフロー</h3>'+
'<table><tr><th>フェーズ</th><th>テンプレート</th></tr>'+
'<tr><td><strong>設計</strong></td><td>🔍仕様レビュー / 📐アーキテクチャ / 🎯ゴール逆算</td></tr>'+
'<tr><td><strong>開発</strong></td><td>🚀MVP実装 / 🔌API統合 / 🌍i18n</td></tr>'+
'<tr><td><strong>QA</strong></td><td>🧪テスト / 🐛QA / 🔒セキュリティ / ♿a11y / ⚡パフォーマンス / 📊メトリクス</td></tr>'+
'<tr><td><strong>運用</strong></td><td>♻️リファクタ / 🔧デバッグ / 🚨インシデント / 🛡️Ops準備 / 📝ドキュメント / 🔄マイグレーション / ⚙️CI/CD</td></tr>'+
'<tr><td><strong>ビジネス</strong></td><td>📈グロース / 🏢戦略</td></tr>'+
'<tr><td><strong>ガバナンス</strong></td><td>⚖️リスク・コンプライアンス</td></tr>'+
'<tr><td><strong>チーム</strong></td><td>🎓オンボーディング</td></tr>'+
'<tr><td><strong>AI知性</strong></td><td>🧬最適手法 / 💡ブレスト / 🏭業界 / 🔮UX / 🧠認知負荷</td></tr>'+
'<tr><td><strong>プロンプトEng</strong></td><td>🧩ゲノム / 📊成熟度 / 🔄ReAct / 🔧Prompt Ops</td></tr>'+
'<tr><td><strong>エンタープライズ</strong></td><td>🏢エンタープライズアーキテクチャ / 📋ワークフロー監査</td></tr></table>'+
'<h3>🌱🔥⚡ スキルレベル別ベストプラクティス</h3>'+
'<p><strong>🌱 Beginner — まず動かす</strong></p>'+
'<ul><li>🔍仕様レビュー + 🚀MVP実装 の2つから始める</li>'+
'<li><code>.spec/</code> フォルダだけを選択してトークン節約</li>'+
'<li>生成されたプロンプトをそのままコピペでOK</li></ul>'+
'<p><strong>🔥 Intermediate — チェーン活用</strong></p>'+
'<ul><li>レビュー → 実装 → テスト → リファクタ の順にチェーン実行</li>'+
'<li><code>.spec/</code> + <code>docs/</code> を含めて包括的なコンテキストを提供</li>'+
'<li>モデル適合度を確認し、80%以内に収める</li></ul>'+
'<p><strong>⚡ Professional — パイプライン化</strong></p>'+
'<ul><li>全37テンプレートをパイプラインとして順次実行</li>'+
'<li>フォルダ選択を最適化（デバッグ時は<code>docs/25</code>+<code>docs/37</code>のみ等）</li>'+
'<li><code>docs/39_implementation_playbook.md</code> と <code>docs/40_ai_dev_runbook.md</code> も活用</li></ul>'+
'<h3>📋 全37テンプレート早見表</h3>'+
'<table><tr><th>Icon</th><th>名前</th><th>フェーズ</th><th>主要参照ドキュメント</th></tr>'+
'<tr><td>🔍</td><td>仕様レビュー</td><td>設計</td><td>.spec/*</td></tr>'+
'<tr><td>📐</td><td>アーキテクチャ</td><td>設計</td><td>docs/03, docs/27, docs/26</td></tr>'+
'<tr><td>🎯</td><td>ゴール逆算</td><td>設計</td><td>docs/29, docs/30</td></tr>'+
'<tr><td>🚀</td><td>MVP実装</td><td>開発</td><td>docs/23, docs/39, docs/40, docs/31</td></tr>'+
'<tr><td>🔌</td><td>API統合</td><td>開発</td><td>docs/05, docs/04, docs/08</td></tr>'+
'<tr><td>🌍</td><td>i18n</td><td>開発</td><td>(コード分析)</td></tr>'+
'<tr><td>🧪</td><td>テスト生成</td><td>QA</td><td>docs/07, docs/33, docs/36</td></tr>'+
'<tr><td>🐛</td><td>QA・バグ検出</td><td>QA</td><td>docs/28, docs/32, docs/33</td></tr>'+
'<tr><td>🔒</td><td>セキュリティ</td><td>QA</td><td>docs/08, docs/43-47, docs/53</td></tr>'+
'<tr><td>♿</td><td>a11y監査</td><td>QA</td><td>docs/26, docs/06</td></tr>'+
'<tr><td>⚡</td><td>パフォーマンス</td><td>QA</td><td>docs/19, docs/17, docs/41</td></tr>'+
'<tr><td>📊</td><td>メトリクス</td><td>QA</td><td>(コード分析)</td></tr>'+
'<tr><td>♻️</td><td>リファクタ</td><td>運用</td><td>.spec/*</td></tr>'+
'<tr><td>🔧</td><td>デバッグ</td><td>運用</td><td>docs/25, docs/37, docs/34</td></tr>'+
'<tr><td>🚨</td><td>インシデント</td><td>運用</td><td>docs/34, docs/25, docs/53, docs/55</td></tr>'+
'<tr><td>🛡️</td><td>Ops準備</td><td>運用</td><td>docs/53, docs/54, docs/55, docs/17</td></tr>'+
'<tr><td>📝</td><td>ドキュメント</td><td>運用</td><td>(全体)</td></tr>'+
'<tr><td>🔄</td><td>マイグレーション</td><td>運用</td><td>docs/04</td></tr>'+
'<tr><td>⚙️</td><td>CI/CD</td><td>運用</td><td>docs/09, docs/36, docs/53, docs/54</td></tr>'+
'<tr><td>📈</td><td>グロース</td><td>ビジネス</td><td>docs/41, docs/48, docs/50</td></tr>'+
'<tr><td>🏢</td><td>戦略</td><td>ビジネス</td><td>docs/48-52, docs/41</td></tr>'+
'<tr><td>⚖️</td><td>リスク・コンプライアンス</td><td>ガバナンス</td><td>docs/14, docs/44, docs/45, docs/53</td></tr>'+
'<tr><td>🧬</td><td>最適手法選定</td><td>AI知性</td><td>docs/60</td></tr>'+
'<tr><td>🎭</td><td>9人の専門家ブレスト</td><td>AI知性</td><td>docs/61, docs/03</td></tr>'+
'<tr><td>🎯</td><td>UXジャーニー設計</td><td>AI知性</td><td>docs/06, docs/57</td></tr>'+
'<tr><td>🔬</td><td>UX習熟度監査</td><td>AI知性</td><td>docs/81, docs/06</td></tr>'+
'<tr><td>🤖</td><td>AIモデル使い分け</td><td>AI知性</td><td>docs/60, docs/61</td></tr>'+
'<tr><td>🏭</td><td>業界特化分析</td><td>AI知性</td><td>docs/62, docs/45</td></tr>'+
'<tr><td>🔮</td><td>次世代UX</td><td>AI知性</td><td>docs/63</td></tr>'+
'<tr><td>🧠</td><td>認知負荷分析</td><td>AI知性</td><td>docs/60, docs/26</td></tr>'+
'<tr><td>🧩</td><td>ゲノム分析</td><td>プロンプトEng</td><td>docs/65, docs/67</td></tr>'+
'<tr><td>📊</td><td>AI成熟度</td><td>プロンプトEng</td><td>docs/66, docs/68</td></tr>'+
'<tr><td>🔄</td><td>ReActデバッグ</td><td>プロンプトEng</td><td>docs/70</td></tr>'+
'<tr><td>🔧</td><td>Prompt Ops</td><td>プロンプトEng</td><td>docs/69, docs/71, docs/72, docs/65</td></tr>'+
'<tr><td>🏢</td><td>エンタープライズアーキテクチャ</td><td>エンタープライズ</td><td>docs/73, docs/74</td></tr>'+
'<tr><td>📋</td><td>ワークフロー監査</td><td>エンタープライズ</td><td>docs/74, docs/75, docs/76</td></tr>'+
'<tr><td>🎓</td><td>オンボーディング</td><td>チーム</td><td>docs/42, docs/37, .claude/rules/, docs/55</td></tr></table>'+
'<h3>💡 Tips</h3>'+
'<p><strong>フォルダ選択のコツ:</strong> 不要なフォルダのチェックを外してトークン節約。例: デバッグ時は<code>docs/</code>の大半は不要。</p>'+
'<p><strong>モデル適合度の見方:</strong> 80%以下が理想。超過する場合はフォルダを絞る。</p>'+
'<p><strong>テンプレートのチェーン例:</strong></p>'+
'<ul><li>新機能追加: 🔍レビュー → 🚀実装 → 🧪テスト → 📝ドキュメント</li>'+
'<li>バグ修正: 🔧デバッグ → ♻️リファクタ → 🧪テスト → 🚨インシデント対応</li>'+
'<li>パフォーマンス改善: ⚡パフォーマンス → 📊メトリクス → ♻️リファクタ → 🧪テスト</li>'+
'<li>本番リリース準備: 🔒セキュリティ → 🛡️Ops準備 → ⚙️CI/CD → 🎓オンボーディング</li>'+
'<li>事業戦略レビュー: 🏢戦略 → 📈グロース → ⚖️リスク → 🎯ゴール逆算</li>'+
'<li>AI成熟度向上: 🧩ゲノム分析 → 📊AI成熟度 → 🔧Prompt Ops → 🧬最適手法</li>'+
'<li>自律デバッグ: 🔄ReActデバッグ → 🔧デバッグ → 🧪テスト → ♻️リファクタ</li></ul>':
'<h2>🤖 AI Prompt Launcher User Manual</h2>'+
'<h3>🔧 How It Works</h3>'+
'<div class="hg-flow"><span class="hg-n hg-b">📂<br>Select Folders</span><span class="hg-a">→</span><span class="hg-n hg-c">📋<br>Pick Template</span><span class="hg-a">→</span><span class="hg-n hg-p">⚙️<br>Auto-compose</span><span class="hg-a">→</span><span class="hg-n hg-g">📋<br>Copy→Feed AI</span></div>'+
'<p><strong>5-Part Auto-Composition:</strong></p>'+
'<table><tr><th>Part</th><th>Content</th></tr>'+
'<tr><td>① System</td><td>AI role definition (Tech Lead, QA Engineer, Security Expert, etc.)</td></tr>'+
'<tr><td>② Context</td><td>Project info (stack, auth, entities)</td></tr>'+
'<tr><td>③ Task</td><td>Specific instructions (review steps, implementation flow, test strategy)</td></tr>'+
'<tr><td>④ Format</td><td>Output format (Markdown table, code blocks, Mermaid diagrams)</td></tr>'+
'<tr><td>⑤ Files</td><td>All file contents from selected folders</td></tr></table>'+
'<h3>📊 Development Lifecycle Flow</h3>'+
'<table><tr><th>Phase</th><th>Templates</th></tr>'+
'<tr><td><strong>Design</strong></td><td>🔍Spec Review / 📐Architecture / 🎯Goal Reverse</td></tr>'+
'<tr><td><strong>Development</strong></td><td>🚀MVP Build / 🔌API Integration / 🌍i18n</td></tr>'+
'<tr><td><strong>QA</strong></td><td>🧪Test Gen / 🐛QA / 🔒Security / ♿a11y / ⚡Performance / 📊Metrics</td></tr>'+
'<tr><td><strong>Operations</strong></td><td>♻️Refactor / 🔧Debug / 🚨Incident / 🛡️Ops Readiness / 📝Docs / 🔄Migration / ⚙️CI/CD</td></tr>'+
'<tr><td><strong>Business</strong></td><td>📈Growth / 🏢Strategy</td></tr>'+
'<tr><td><strong>Governance</strong></td><td>⚖️Risk & Compliance</td></tr>'+
'<tr><td><strong>Team</strong></td><td>🎓Onboarding</td></tr>'+
'<tr><td><strong>AI Intelligence</strong></td><td>🧬Methodology / 💡Brainstorm / 🏭Industry / 🔮Next-Gen UX / 🧠Cognitive</td></tr>'+
'<tr><td><strong>Prompt Eng</strong></td><td>🧩Genome / 📊Maturity / 🔄ReAct Debug / 🔧Prompt Ops</td></tr>'+
'<tr><td><strong>Enterprise</strong></td><td>🏢Enterprise Architecture / 📋Workflow Process Audit</td></tr></table>'+
'<h3>🌱🔥⚡ Best Practices by Skill Level</h3>'+
'<p><strong>🌱 Beginner — Get Started</strong></p>'+
'<ul><li>Start with 🔍Spec Review + 🚀MVP Build</li>'+
'<li>Select only <code>.spec/</code> folder to save tokens</li>'+
'<li>Copy-paste generated prompts as-is</li></ul>'+
'<p><strong>🔥 Intermediate — Chain Execution</strong></p>'+
'<ul><li>Execute in sequence: Review → Implement → Test → Refactor</li>'+
'<li>Include <code>.spec/</code> + <code>docs/</code> for comprehensive context</li>'+
'<li>Keep model fit under 80%</li></ul>'+
'<p><strong>⚡ Professional — Full Pipeline</strong></p>'+
'<ul><li>Execute all 37 templates as a pipeline</li>'+
'<li>Optimize folder selection (e.g., for debugging: only <code>docs/25</code>+<code>docs/37</code>)</li>'+
'<li>Leverage <code>docs/39_implementation_playbook.md</code> and <code>docs/40_ai_dev_runbook.md</code></li></ul>'+
'<h3>📋 All 37 Templates Quick Reference</h3>'+
'<table><tr><th>Icon</th><th>Name</th><th>Phase</th><th>Key Docs</th></tr>'+
'<tr><td>🔍</td><td>Spec Review</td><td>Design</td><td>.spec/*</td></tr>'+
'<tr><td>📐</td><td>Architecture</td><td>Design</td><td>docs/03, docs/27, docs/26</td></tr>'+
'<tr><td>🎯</td><td>Goal Reverse</td><td>Design</td><td>docs/29, docs/30</td></tr>'+
'<tr><td>🚀</td><td>MVP Build</td><td>Dev</td><td>docs/23, docs/39, docs/40, docs/31</td></tr>'+
'<tr><td>🔌</td><td>API Integration</td><td>Dev</td><td>docs/05, docs/04, docs/08</td></tr>'+
'<tr><td>🌍</td><td>i18n</td><td>Dev</td><td>(code analysis)</td></tr>'+
'<tr><td>🧪</td><td>Test Generation</td><td>QA</td><td>docs/07, docs/33, docs/36</td></tr>'+
'<tr><td>🐛</td><td>QA & Bug Detection</td><td>QA</td><td>docs/28, docs/32, docs/33</td></tr>'+
'<tr><td>🔒</td><td>Security</td><td>QA</td><td>docs/08, docs/43-47, docs/53</td></tr>'+
'<tr><td>♿</td><td>a11y Audit</td><td>QA</td><td>docs/26, docs/06</td></tr>'+
'<tr><td>⚡</td><td>Performance</td><td>QA</td><td>docs/19, docs/17, docs/41</td></tr>'+
'<tr><td>📊</td><td>Metrics</td><td>QA</td><td>(code analysis)</td></tr>'+
'<tr><td>♻️</td><td>Refactor</td><td>Ops</td><td>.spec/*</td></tr>'+
'<tr><td>🔧</td><td>Debug</td><td>Ops</td><td>docs/25, docs/37, docs/34</td></tr>'+
'<tr><td>🚨</td><td>Incident</td><td>Ops</td><td>docs/34, docs/25, docs/53, docs/55</td></tr>'+
'<tr><td>🛡️</td><td>Ops Readiness</td><td>Ops</td><td>docs/53, docs/54, docs/55, docs/17</td></tr>'+
'<tr><td>📝</td><td>Documentation</td><td>Ops</td><td>(all)</td></tr>'+
'<tr><td>🔄</td><td>Migration</td><td>Ops</td><td>docs/04</td></tr>'+
'<tr><td>⚙️</td><td>CI/CD</td><td>Ops</td><td>docs/09, docs/36, docs/53, docs/54</td></tr>'+
'<tr><td>📈</td><td>Growth</td><td>Business</td><td>docs/41, docs/48, docs/50</td></tr>'+
'<tr><td>🏢</td><td>Strategy</td><td>Business</td><td>docs/48-52, docs/41</td></tr>'+
'<tr><td>⚖️</td><td>Risk & Compliance</td><td>Governance</td><td>docs/14, docs/44, docs/45, docs/53</td></tr>'+
'<tr><td>🧬</td><td>Optimal Methodology</td><td>AI Intelligence</td><td>docs/60</td></tr>'+
'<tr><td>🎭</td><td>9-Expert Brainstorm</td><td>AI Intelligence</td><td>docs/61, docs/03</td></tr>'+
'<tr><td>🎯</td><td>UX Journey Design</td><td>AI Intelligence</td><td>docs/06, docs/57</td></tr>'+
'<tr><td>🔬</td><td>UX Proficiency Audit</td><td>AI Intelligence</td><td>docs/81, docs/06</td></tr>'+
'<tr><td>🤖</td><td>AI Model Selection</td><td>AI Intelligence</td><td>docs/60, docs/61</td></tr>'+
'<tr><td>🏭</td><td>Industry Deep Dive</td><td>AI Intelligence</td><td>docs/62, docs/45</td></tr>'+
'<tr><td>🔮</td><td>Next-Gen UX</td><td>AI Intelligence</td><td>docs/63</td></tr>'+
'<tr><td>🧠</td><td>Cognitive Load</td><td>AI Intelligence</td><td>docs/60, docs/26</td></tr>'+
'<tr><td>🧩</td><td>Prompt Genome</td><td>Prompt Eng</td><td>docs/65, docs/67</td></tr>'+
'<tr><td>📊</td><td>AI Maturity</td><td>Prompt Eng</td><td>docs/66, docs/68</td></tr>'+
'<tr><td>🔄</td><td>ReAct Debug</td><td>Prompt Eng</td><td>docs/70</td></tr>'+
'<tr><td>🔧</td><td>Prompt Ops</td><td>Prompt Eng</td><td>docs/69, docs/71, docs/72, docs/65</td></tr>'+
'<tr><td>🏢</td><td>Enterprise Architecture</td><td>Enterprise</td><td>docs/73, docs/74</td></tr>'+
'<tr><td>📋</td><td>Workflow Process Audit</td><td>Enterprise</td><td>docs/74, docs/75, docs/76</td></tr>'+
'<tr><td>🎓</td><td>Onboarding</td><td>Team</td><td>docs/42, docs/37, .claude/rules/, docs/55</td></tr></table>'+
'<h3>💡 Tips</h3>'+
'<p><strong>Folder Selection:</strong> Uncheck unnecessary folders to save tokens. Example: for debugging, most of <code>docs/</code> is unnecessary.</p>'+
'<p><strong>Model Fit Indicator:</strong> 80% or below is ideal. If exceeded, reduce folder selection.</p>'+
'<p><strong>Template Chaining Examples:</strong></p>'+
'<ul><li>New feature: 🔍Review → 🚀Implement → 🧪Test → 📝Docs</li>'+
'<li>Bug fix: 🔧Debug → ♻️Refactor → 🧪Test → 🚨Incident</li>'+
'<li>Performance: ⚡Performance → 📊Metrics → ♻️Refactor → 🧪Test</li>'+
'<li>Production release prep: 🔒Security → 🛡️Ops Readiness → ⚙️CI/CD → 🎓Onboarding</li>'+
'<li>Business strategy review: 🏢Strategy → 📈Growth → ⚖️Risk → 🎯Goal Reverse</li>'+
'<li>AI maturity upgrade: 🧩Genome → 📊Maturity → 🔧Prompt Ops → 🧬Methodology</li>'+
'<li>Autonomous debugging: 🔄ReAct Debug → 🔧Debug → 🧪Test → ♻️Refactor</li></ul>'
},
{id:'techdb',title:_ja?'技術DB':'Tech DB',body:_ja?
'<h2>技術マスターテーブル</h2><p>'+_TECH_COUNT+'テクノロジーを15カテゴリに分類。Context Dashboardから閲覧可能。</p><h3>カテゴリ一覧</h3><p>言語 / フロントエンド / モバイル / バックエンド / BaaS / 決済・CMS・EC / DevOps / AIツール / AI自律 / 手法 / テスト / API / ビルド / データ / セキュリティ</p><h3>フィルタ機能</h3><p>カテゴリ / 必須度 / キーワード検索で絞り込み可能。</p>'
:
'<h2>Tech Master Table</h2><p>'+_TECH_COUNT+' technologies classified into 15 categories. Browse from Context Dashboard.</p><h3>Categories</h3><p>Languages / Frontend / Mobile / Backend / BaaS / Payment・CMS・EC / DevOps / AI Tools / AI Autonomous / Methodologies / Testing / API / Build / Data / Security</p><h3>Filter</h3><p>Filter by category, requirement level, or keyword search.</p>'
},
{id:'keys',title:_ja?'ショートカット':'Shortcuts',body:_ja?
'<h2>キーボードショートカット</h2><table><tr><td><code>F1</code> / <code>Ctrl+H</code></td><td>ヘルプ表示</td></tr><tr><td><code>Ctrl+K</code></td><td>ショートカット一覧</td></tr><tr><td><code>Ctrl+T</code></td><td>テーマ切替</td></tr><tr><td><code>Ctrl+L</code></td><td>言語切替</td></tr><tr><td><code>Ctrl+E</code></td><td>エクスポート</td></tr><tr><td><code>Ctrl+Shift+C</code></td><td>全ファイルコピー</td></tr><tr><td><code>Ctrl+M</code></td><td>プロジェクト管理</td></tr><tr><td><code>Escape</code></td><td>モーダルを閉じる</td></tr></table>'
:
'<h2>Keyboard Shortcuts</h2><table><tr><td><code>F1</code> / <code>Ctrl+H</code></td><td>Open help</td></tr><tr><td><code>Ctrl+K</code></td><td>Shortcut list</td></tr><tr><td><code>Ctrl+T</code></td><td>Toggle theme</td></tr><tr><td><code>Ctrl+L</code></td><td>Toggle language</td></tr><tr><td><code>Ctrl+E</code></td><td>Export</td></tr><tr><td><code>Ctrl+Shift+C</code></td><td>Copy all files</td></tr><tr><td><code>Ctrl+M</code></td><td>Project manager</td></tr><tr><td><code>Escape</code></td><td>Close modal</td></tr></table>'
},
{id:'caution',title:_ja?'⚠️ 注意事項':'⚠️ Cautions',body:_ja?
'<h2>使用上の注意・留意点</h2>'+
'<h3>🔴 データ保存について</h3>'+
'<p>全データはブラウザの<strong>localStorage</strong>に保存されます。以下の操作で<strong>全データが消失</strong>します:</p>'+
'<p>・ブラウザの「閲覧履歴を消去」→「Cookieとサイトデータ」を削除<br>・シークレット/プライベートモードでの使用<br>・ブラウザや端末の変更</p>'+
'<p>→ 対策: 作業後は必ず<strong>📤 JSONエクスポート</strong>と<strong>📦 ZIPダウンロード</strong>で保存してください。</p>'+
'<h3>🔴 ストレージ上限</h3>'+
'<p>localStorageの上限は約5MBです。20〜30プロジェクトで上限に達する可能性があります。古いプロジェクトはエクスポート後に削除してください。</p>'+
'<h3>🟡 生成ファイルについて</h3>'+
'<p>生成される135+ファイルは<strong>設計ドキュメント</strong>（SDD仕様書・DevContainer設定・AIルール等）です。npm installで即座に動くアプリケーションコードではありません。Claude Code / Cursor等のAIツールに入力して実コードを生成する運用が前提です。</p>'+
'<p class="workflow-ref">📘 <strong>詳しい手順は <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">生成後ワークフローガイド</a> を参照</strong></p>'+
'<h3>🟡 スキルレベル</h3>'+
'<p>スキルレベルにより表示される選択肢が変わります。途中変更すると既回答との不整合が起きうるため、<strong>最初に正しく設定</strong>してください。</p>'+
'<h3>🟡 言語切り替え</h3>'+
'<p>UIの日英切り替えは即座に反映されますが、<strong>生成済みファイルの内容は切り替わりません</strong>。英語ドキュメントが必要な場合は生成時の言語選択で明示的に選んでください。</p>'+
'<h3>🔵 その他</h3>'+
'<p>・ZIPエクスポートはCDN経由のJSZipに依存します（オフライン時は「全ファイルコピー」Ctrl+Shift+Cで代替）<br>・PDF出力時はライトモード推奨（ダーク背景がそのまま印刷されます）<br>・URL共有は回答が多いとURLが長くなりSNS等で切れる場合があります</p>'
:
'<h2>Usage Cautions & Notes</h2>'+
'<h3>🔴 Data Storage</h3>'+
'<p>All data is stored in <strong>localStorage</strong>. Data will be <strong>lost</strong> if you:</p>'+
'<p>・Clear browser data (cookies & site data)<br>・Use incognito/private mode<br>・Switch browsers or devices</p>'+
'<p>→ Always <strong>📤 Export JSON</strong> and <strong>📦 Download ZIP</strong> after work.</p>'+
'<h3>🔴 Storage Limit</h3>'+
'<p>localStorage limit is ~5MB. You may reach the limit with 20-30 projects. Export and delete old projects.</p>'+
'<h3>🟡 Generated Files</h3>'+
'<p>135+ generated files are <strong>design documents</strong> (SDD specs, DevContainer configs, AI rules). They are not runnable app code. Feed them to AI tools like Claude Code / Cursor to generate actual code.</p>'+
'<p class="workflow-ref">📘 <strong>For detailed workflow, see <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">Post-Gen Workflow Guide</a></strong></p>'+
'<h3>🟡 Skill Level</h3>'+
'<p>Changing skill level mid-project may cause inconsistencies with existing answers. <strong>Set it correctly at the start.</strong></p>'+
'<h3>🟡 Language Switch</h3>'+
'<p>UI language switches instantly, but <strong>generated file contents do not change</strong>. Choose the language explicitly during generation.</p>'+
'<h3>🔵 Other</h3>'+
'<p>・ZIP export requires JSZip via CDN (use "Copy All" Ctrl+Shift+C offline)<br>・Switch to light mode before PDF export<br>・URL sharing may truncate on SNS for complex projects</p>'
},
{id:'about',title:'About',body:'<h2>DevForge v9.5</h2><p>'+(_ja?'AI駆動開発 統合プラットフォーム':'AI-Driven Dev Platform')+'</p><p>Version 9.5.0 — 2026 Edition (Modular Architecture)</p><p>'+(_ja?''+_TECH_COUNT+'テクノロジー ・ 135+ファイル ・ 20の柱 ・ 48プリセット ・ Mermaid図 ・ プロンプトプレイブック':''+_TECH_COUNT+' technologies ・ 135+ files ・ 20 pillars ・ 48 presets ・ Mermaid diagrams ・ Prompt playbook')+'</p><p>© 2026 エンジニアリングのタネ制作委員会<br>by にしあん</p>'},
];
const nav=$('helpNav');
// Keep search input, clear nav links after it
const searchEl=$('helpSearch');
while(nav.lastChild&&nav.lastChild!==searchEl)nav.removeChild(nav.lastChild);
if(searchEl)searchEl.value='';
window._manual=MANUAL;
MANUAL.forEach(s=>{
const a=document.createElement('a');a.textContent=s.title;a.href='#';a.dataset.id=s.id;
a.onclick=e=>{e.preventDefault();$('helpBody').innerHTML=typeof s.body==='function'?s.body():s.body;document.querySelectorAll('.help-nav a').forEach(x=>x.classList.remove('on'));a.classList.add('on');};
if(s.id===(sec||'overview'))a.classList.add('on');
nav.appendChild(a);
});
// Tour restart button (P3: persistent re-discovery)
const tourBtn=document.createElement('button');tourBtn.className='help-tour-btn';
tourBtn.textContent=_ja?'🔄 ツアーを再開':'🔄 Restart Tour';
tourBtn.onclick=()=>{closeManual();if(typeof startTour==='function')startTour();};
nav.appendChild(tourBtn);
const initSec=MANUAL.find(s=>s.id===(sec||'overview'));
$('helpBody').innerHTML=typeof initSec.body==='function'?initSec.body():initSec.body;
trapFocus(o);
}
function filterManual(q){
if(!window._manual)return;
const links=document.querySelectorAll('#helpNav a');
const term=q.toLowerCase().trim();
if(!term){
links.forEach(a=>a.classList.remove('dim'));
const active=document.querySelector('#helpNav a.on');
if(active){const s=window._manual.find(m=>m.id===active.dataset.id);if(s)$('helpBody').innerHTML=typeof s.body==='function'?s.body():s.body;}
return;
}
let firstMatch=null;
links.forEach(a=>{
const s=window._manual.find(m=>m.id===a.dataset.id);
if(!s)return;
const bodyText=typeof s.body==='function'?s.body():s.body;
const text=(s.title+' '+bodyText.replace(/<[^>]*>/g,'')).toLowerCase();
const match=text.includes(term);
a.classList.toggle('dim',!match);
if(match&&!firstMatch)firstMatch=s;
});
if(firstMatch){
const re=new RegExp('('+term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')+')','gi');
const bodyText=typeof firstMatch.body==='function'?firstMatch.body():firstMatch.body;
const highlighted=bodyText.replace(/>([^<]+)</g,(m,txt)=>'>'+txt.replace(re,'<mark>$1</mark>')+'<');
$('helpBody').innerHTML=highlighted;
links.forEach(a=>{a.classList.remove('on');if(a.dataset.id===firstMatch.id)a.classList.add('on');});
}
}
function closeManual(){const o=$('helpOverlay');o.classList.remove('show');releaseFocus(o);removeModal(o);}
function showKB(){const el=$('kbOverlay');el.classList.add('show');trapFocus(el);pushModal(el,()=>{el.classList.remove('show');releaseFocus(el);});}
function closeKB(){const el=$('kbOverlay');el.classList.remove('show');releaseFocus(el);removeModal(el);}
function mobSw(t){
const tabs=document.querySelectorAll('.mobtab');
tabs.forEach(m=>{m.classList.remove('on');m.setAttribute('aria-selected','false');});
if(t==='c'){$('panC').classList.remove('hide');$('panP').classList.remove('show');tabs[0].classList.add('on');tabs[0].setAttribute('aria-selected','true');}
else{$('panC').classList.add('hide');$('panP').classList.add('show');tabs[1].classList.add('on');tabs[1].setAttribute('aria-selected','true');}
}

// Context-aware action groups, FAB minimize/restore, keyboard navigation, ARIA support

function createQbar(){
if($('qbar'))return; // Already exists
const ws=$('ws');if(!ws)return;
const _ja=S.lang==='ja';
const isPreview=!!S.previewFile;
const hasFiles=Object.keys(S.files).length>0;
const skill=S.skill||'intermediate';
const qb=document.createElement('div');
qb.id='qbar';
qb.className='qbar';
qb.setAttribute('role','toolbar');
qb.setAttribute('aria-label',_ja?'クイックアクション':'Quick Actions');
let html='';
// Export group
if(hasFiles){
html+=`<div class="qbar-group" data-group="export">`;
html+=`<button class="qbar-action qbar-primary" onclick="exportZIP()" title="${_ja?'ZIP形式でダウンロード (Ctrl+E)':'Download as ZIP (Ctrl+E)'}" aria-label="${_ja?'ZIPエクスポート':'Export ZIP'}">
<span class="qbar-icon">📦</span><span class="qbar-label">ZIP</span>
<span class="qbar-kb">Ctrl+E</span>
</button>`;
html+=`<button class="qbar-action" onclick="copyAllFiles()" title="${_ja?'全ファイルをクリップボードにコピー (Ctrl+Shift+C)':'Copy all files to clipboard (Ctrl+Shift+C)'}" aria-label="${_ja?'全コピー':'Copy All'}">
<span class="qbar-icon">📋</span><span class="qbar-label">${_ja?'全コピー':'Copy All'}</span>
<span class="qbar-kb">Ctrl+⇧+C</span>
</button>`;
// AI MD / PDF for intermediate+
if(skill!=='beginner'){
html+=`<button class="qbar-action" onclick="showAIMarkdown()" title="${_ja?'AI向けマークダウン生成':'Generate AI-optimized Markdown'}" aria-label="AI MD">
<span class="qbar-icon">🤖</span><span class="qbar-label">AI MD</span>
</button>`;
}
html+=`</div>`;
html+=`<span class="qbar-sep" role="separator"></span>`;
}

// Navigate group
if(hasFiles){
html+=`<div class="qbar-group" data-group="navigate">`;
html+=`<button class="qbar-action" onclick="S.pillar=5;showFileTree();updateQbar()" title="${_ja?'ダッシュボード表示 (Ctrl+5)':'Show Dashboard (Ctrl+5)'}" aria-label="${_ja?'ダッシュボード':'Dashboard'}">
<span class="qbar-icon">📊</span><span class="qbar-label">${_ja?'Dashboard':'Dashboard'}</span>
<span class="qbar-kb">Ctrl+5</span>
</button>`;
html+=`<button class="qbar-action" onclick="S.pillar=6;showRoadmapUI();updateQbar()" title="${_ja?'ロードマップ表示 (Ctrl+6)':'Show Roadmap (Ctrl+6)'}" aria-label="${_ja?'ロードマップ':'Roadmap'}">
<span class="qbar-icon">🗺️</span><span class="qbar-label">${_ja?'Roadmap':'Roadmap'}</span>
<span class="qbar-kb">Ctrl+6</span>
</button>`;
// AI Launcher for all skill levels; Explorer for intermediate+
html+=`<button class="qbar-action" onclick="showAILauncher()" title="${_ja?'AIプロンプト起動 (Ctrl+7)':'Launch AI Prompts (Ctrl+7)'}" aria-label="${_ja?'AI起動':'AI Launcher'}">
<span class="qbar-icon">🚀</span><span class="qbar-label">${_ja?'AI起動':'Launcher'}</span>
<span class="qbar-kb">Ctrl+7</span>
</button>`;
if(skill!=='beginner'){
html+=`<button class="qbar-action" onclick="showExplorer()" title="${_ja?'エクスプローラー (Ctrl+4)':'Explorer (Ctrl+4)'}" aria-label="Explorer">
<span class="qbar-icon">🗂️</span><span class="qbar-label">Explorer</span>
<span class="qbar-kb">Ctrl+4</span>
</button>`;
}
html+=`</div>`;
html+=`<span class="qbar-sep" role="separator"></span>`;
}

// Create group
if(hasFiles){
html+=`<div class="qbar-group" data-group="create">`;
html+=`<button class="qbar-action" onclick="doGenerate()" title="${_ja?'再生成':'Regenerate'}" aria-label="${_ja?'再生成':'Regenerate'}">
<span class="qbar-icon">🔄</span><span class="qbar-label">${_ja?'再生成':'Regen'}</span>
</button>`;
html+=`<button class="qbar-action" onclick="shareURL()" title="${_ja?'共有URL生成':'Share URL'}" aria-label="${_ja?'共有':'Share'}">
<span class="qbar-icon">🔗</span><span class="qbar-label">${_ja?'共有':'Share'}</span>
</button>`;
html+=`</div>`;
html+=`<span class="qbar-sep" role="separator"></span>`;
}

// File group (only when previewing a file)
if(isPreview){
html+=`<div class="qbar-group" data-group="file">`;
html+=`<button class="qbar-action" onclick="if(S.previewFile)openEditor(S.previewFile)" title="${_ja?'ファイル編集':'Edit File'}" aria-label="${_ja?'編集':'Edit'}">
<span class="qbar-icon">✏️</span><span class="qbar-label">${_ja?'編集':'Edit'}</span>
</button>`;
html+=`<button class="qbar-action" onclick="if(S.previewFile)copyFile(S.previewFile)" title="${_ja?'ファイルをコピー':'Copy File'}" aria-label="${_ja?'コピー':'Copy'}">
<span class="qbar-icon">📄</span><span class="qbar-label">${_ja?'コピー':'Copy'}</span>
</button>`;
html+=`</div>`;
html+=`<span class="qbar-sep" role="separator"></span>`;
}

// Minimize button (converts to FAB)
html+=`<button class="qbar-minimize" onclick="dismissQbar()" title="${_ja?'最小化':'Minimize'}" aria-label="${_ja?'最小化':'Minimize'}">
<span class="qbar-icon">−</span>
</button>`;
qb.innerHTML=html;
// Keyboard navigation
qb.addEventListener('keydown',(e)=>{
const actions=Array.from(qb.querySelectorAll('.qbar-action, .qbar-minimize'));
const idx=actions.indexOf(e.target);
if(idx<0)return;
if(e.key==='ArrowRight'){
e.preventDefault();
const next=actions[idx+1]||actions[0];
next.focus();
}else if(e.key==='ArrowLeft'){
e.preventDefault();
const prev=actions[idx-1]||actions[actions.length-1];
prev.focus();
}else if(e.key==='Home'){
e.preventDefault();
actions[0].focus();
}else if(e.key==='End'){
e.preventDefault();
actions[actions.length-1].focus();
}
});
ws.appendChild(qb);
// Restore from minimized state
if(!S.qbarDismissed){
qb.classList.add('qbar-visible');
}
}

function updateQbar(){
const qb=$('qbar');
if(!qb)return;
qb.remove();
createQbar();
}

function dismissQbar(){
const qb=$('qbar');
if(!qb)return;
qb.classList.remove('qbar-visible');
qb.classList.add('qbar-hiding');
setTimeout(()=>{
qb.remove();
showQbarFAB();
S.qbarDismissed=true;
save();
},200);
}

function showQbarFAB(){
if($('qbar-fab'))return;
const _ja=S.lang==='ja';
const fab=document.createElement('button');
fab.id='qbar-fab';
fab.className='qbar-fab';
fab.setAttribute('aria-label',_ja?'クイックアクションを復元':'Restore Quick Actions');
fab.title=_ja?'クイックアクションを復元':'Restore Quick Actions';
fab.innerHTML=`<span class="qbar-icon">⚡</span>`;
fab.onclick=restoreQbar;
const ws=$('ws');
if(ws)ws.appendChild(fab);
}

function restoreQbar(){
const fab=$('qbar-fab');
if(fab)fab.remove();
S.qbarDismissed=false;
save();
createQbar();
const qb=$('qbar');
if(qb){
qb.classList.add('qbar-visible');
}
}

// Helper: Show AI Markdown export
function showAIMarkdown(){
const _ja=S.lang==='ja';
// Generate AI-optimized markdown combining all key files
let md='# '+S.projectName+' — AI Context\n\n';
const keyFiles=['.spec/constitution.md','.spec/specification.md','CLAUDE.md','docs/01_architecture.md','docs/02_er.md','docs/03_api.md'];
keyFiles.forEach(path=>{
if(S.files[path]){
md+='## '+path+'\n\n';
md+='```\n'+S.files[path]+'\n```\n\n';
}
});
const blob=new Blob([md],{type:'text/markdown'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=fileSlug(S.projectName)+'-ai-context.md';
a.click();
URL.revokeObjectURL(url);
toast(_ja?'AI向けマークダウンをダウンロードしました':'Downloaded AI-optimized Markdown');
}

// Helper: Copy single file
function copyFile(path){
const _ja=S.lang==='ja';
if(!S.files[path])return;
navigator.clipboard.writeText(S.files[path]).then(()=>{
toast(_ja?`${path} をコピーしました`:`Copied ${path}`);
}).catch(()=>{
toast(_ja?'コピー失敗':'Copy failed');
});
}

// Unified command + file search with keyboard navigation

let _cpSelectedIdx=0;
let _cpResults=[];
function showCommandPalette(){
if($('cmdpalette'))return; // Already open

const _ja=S.lang==='ja';
const overlay=document.createElement('div');
overlay.id='cmdpalette';
overlay.className='cmdpalette-overlay';
overlay.setAttribute('role','dialog');
overlay.setAttribute('aria-modal','true');
overlay.setAttribute('aria-label',_ja?'コマンドパレット':'Command Palette');
overlay.innerHTML=`
<div class="cmdpalette-box">
<div class="cmdpalette-input-wrap">
<span class="cmdpalette-icon">⌘</span>
<input type="text" id="cmdpaletteInput" class="cmdpalette-input" placeholder="${_ja?'コマンドまたはファイルを検索...':'Search commands or files...'}" autocomplete="off" />
</div>
<div id="cmdpaletteResults" class="cmdpalette-results" role="listbox"></div>
</div>
`;
document.body.appendChild(overlay);
pushModal(overlay,closeCmdPalette);
const input=$('cmdpaletteInput');
const resultsDiv=$('cmdpaletteResults');
// Focus input
setTimeout(()=>input.focus(),50);
// Initial results (all commands)
updateCmdResults('',_ja,input,resultsDiv);
// Input handler
input.addEventListener('input',()=>{
updateCmdResults(input.value.trim().toLowerCase(),_ja,input,resultsDiv);
});
// Keyboard navigation
input.addEventListener('keydown',(e)=>{
if(e.key==='ArrowDown'){
e.preventDefault();
_cpSelectedIdx=Math.min(_cpSelectedIdx+1,_cpResults.length-1);
highlightCmdResult(resultsDiv);
}else if(e.key==='ArrowUp'){
e.preventDefault();
_cpSelectedIdx=Math.max(_cpSelectedIdx-1,0);
highlightCmdResult(resultsDiv);
}else if(e.key==='Enter'){
e.preventDefault();
if(_cpResults[_cpSelectedIdx]){
executeCmdResult(_cpResults[_cpSelectedIdx]);
closeCmdPalette();
}
}else if(e.key==='Escape'){
e.preventDefault();
closeCmdPalette();
}
});
// Close on overlay click
overlay.addEventListener('click',(e)=>{
if(e.target===overlay)closeCmdPalette();
});
// Focus trap
trapFocus(overlay);
}

function updateCmdResults(query,_ja,input,resultsDiv){
_cpSelectedIdx=0;
_cpResults=[];
const hasFiles=Object.keys(S.files).length>0;
// Build command list
const commands=[
// Export group
...(hasFiles?[
{cat:'export',icon:'📦',label:_ja?'ZIPエクスポート':'Export ZIP',labelEn:'Export ZIP',kb:'Ctrl+E',action:()=>exportZIP()},
{cat:'export',icon:'📋',label:_ja?'全ファイルコピー':'Copy All Files',labelEn:'Copy All Files',kb:'Ctrl+Shift+C',action:()=>copyAllFiles()},
{cat:'export',icon:'📤',label:_ja?'JSONエクスポート':'Export JSON',labelEn:'Export JSON',action:()=>exportProject()},
{cat:'export',icon:'🤖',label:_ja?'AI向けマークダウン':'AI Markdown',labelEn:'AI Markdown',action:()=>showAIMarkdown()},
]:[]),
// Navigate group
...(hasFiles?[
{cat:'navigate',icon:'📊',label:_ja?'ダッシュボード':'Dashboard',labelEn:'Dashboard',kb:'Ctrl+5',action:()=>{S.pillar=5;showFileTree();}},
{cat:'navigate',icon:'🗺️',label:_ja?'ロードマップ':'Roadmap',labelEn:'Roadmap',kb:'Ctrl+6',action:()=>{S.pillar=6;showRoadmapUI();}},
{cat:'navigate',icon:'🚀',label:_ja?'AIプロンプト起動':'AI Launcher',labelEn:'AI Launcher',kb:'Ctrl+7',action:()=>showAILauncher()},
{cat:'navigate',icon:'🗂️',label:_ja?'エクスプローラー':'Explorer',labelEn:'Explorer',kb:'Ctrl+4',action:()=>showExplorer()},
]:[]),
// App group
{cat:'app',icon:'💡',label:_ja?'ヘルプ':'Help',labelEn:'Help',kb:'F1',action:()=>showManual()},
{cat:'app',icon:'⌨️',label:_ja?'ショートカット一覧':'Shortcuts',labelEn:'Shortcuts',kb:'Ctrl+K',action:()=>showKB()},
{cat:'app',icon:'🌓',label:_ja?'テーマ切替':'Toggle Theme',labelEn:'Toggle Theme',kb:'Ctrl+T',action:()=>toggleTheme()},
{cat:'app',icon:'🌐',label:_ja?'言語切替':'Toggle Language',labelEn:'Toggle Language',kb:'Ctrl+L',action:()=>toggleLang()},
{cat:'app',icon:'📁',label:_ja?'プロジェクト管理':'Project Manager',labelEn:'Project Manager',kb:'Ctrl+M',action:()=>showPM()},
{cat:'app',icon:'🗑️',label:_ja?'履歴クリア':'Clear History',labelEn:'Clear History',action:()=>clearFileHistory()},
// Create group
...(hasFiles?[
{cat:'create',icon:'🔄',label:_ja?'再生成':'Regenerate',labelEn:'Regenerate',action:()=>doGenerate()},
{cat:'create',icon:'🔗',label:_ja?'共有URL生成':'Share URL',labelEn:'Share URL',action:()=>shareURL()},
{cat:'create',icon:'🗑️',label:_ja?'ファイルクリア':'Clear Files',labelEn:'Clear Files',action:()=>clearFiles()},
]:[]),
];
// Filter commands
let filtered=commands.filter(c=>{
const lbl=(_ja?c.label:c.labelEn||c.label).toLowerCase();
return lbl.includes(query);
});
// File search
let files=[];
if(hasFiles&&query.length>0){
files=Object.keys(S.files).filter(path=>path.toLowerCase().includes(query)).slice(0,20);
}

// Combine results
_cpResults=[...filtered,...files.map(path=>({cat:'file',icon:'📄',label:path,action:()=>previewFile(path)}))];
// Render
let html='';
if(_cpResults.length===0){
html=`<div class="cmdpalette-empty">${_ja?'一致する結果がありません':'No results found'}</div>`;
}else{
_cpResults.forEach((r,i)=>{
const catLabel=getCatLabel(r.cat,_ja);
const selected=i===_cpSelectedIdx?' cmdpalette-item-selected':'';
const aria=i===_cpSelectedIdx?' aria-selected="true"':' aria-selected="false"';
html+=`<div class="cmdpalette-item${selected}" role="option"${aria} data-idx="${i}">`;
html+=`<span class="cmdpalette-item-icon">${r.icon}</span>`;
html+=`<span class="cmdpalette-item-label">${esc(r.label)}</span>`;
html+=`<span class="cmdpalette-item-cat">${catLabel}</span>`;
if(r.kb)html+=`<span class="cmdpalette-item-kb">${esc(r.kb)}</span>`;
html+=`</div>`;
});
}

resultsDiv.innerHTML=html;
// Click handlers
resultsDiv.querySelectorAll('.cmdpalette-item').forEach((el,i)=>{
el.onclick=()=>{
executeCmdResult(_cpResults[i]);
closeCmdPalette();
};
});
}

function highlightCmdResult(resultsDiv){
resultsDiv.querySelectorAll('.cmdpalette-item').forEach((el,i)=>{
if(i===_cpSelectedIdx){
el.classList.add('cmdpalette-item-selected');
el.setAttribute('aria-selected','true');
el.scrollIntoView({block:'nearest'});
}else{
el.classList.remove('cmdpalette-item-selected');
el.setAttribute('aria-selected','false');
}
});
}

function executeCmdResult(result){
if(!result||!result.action)return;
setTimeout(()=>result.action(),100); // Delay to allow modal close
}

function closeCmdPalette(){
const cp=$('cmdpalette');
if(cp){
removeModal(cp);
cp.remove();
releaseFocus(cp);
}
_cpSelectedIdx=0;
_cpResults=[];
}

function getCatLabel(cat,_ja){
const labels={
export:_ja?'エクスポート':'Export',
navigate:_ja?'ナビゲート':'Navigate',
app:_ja?'アプリ':'App',
create:_ja?'作成':'Create',
file:_ja?'ファイル':'File'
};
return labels[cat]||cat;
}
/* Focus trap for modals */
function trapFocus(modalEl){
const focusable=modalEl.querySelectorAll('button,input,select,textarea,a[href],[tabindex]:not([tabindex="-1"])');
if(!focusable.length)return;
const first=focusable[0];const last=focusable[focusable.length-1];
function handler(e){
if(e.key!=='Tab')return;
if(e.shiftKey){if(document.activeElement===first){e.preventDefault();last.focus();}}
else{if(document.activeElement===last){e.preventDefault();first.focus();}}
}
modalEl._trapHandler=handler;
modalEl.addEventListener('keydown',handler);
first.focus();
}
function releaseFocus(modalEl){
if(modalEl._trapHandler){modalEl.removeEventListener('keydown',modalEl._trapHandler);delete modalEl._trapHandler;}
}
/* Announce to screen readers */
function announce(msg){
let el=$('srAnnounce');
if(!el){el=document.createElement('div');el.id='srAnnounce';el.setAttribute('role','status');el.setAttribute('aria-live','assertive');el.className='sr-only';document.body.appendChild(el);}
el.textContent='';setTimeout(()=>{el.textContent=msg;},50);
}
/* Modal stack for Escape handling */
const _modalStack=[];
function pushModal(el,closeFn){_modalStack.push({el,closeFn});}
function popModal(){
const top=_modalStack.pop();
if(top&&top.closeFn)top.closeFn();
return !!top;
}
function removeModal(el){
const idx=_modalStack.findIndex(m=>m.el===el);
if(idx>=0)_modalStack.splice(idx,1);
}
document.addEventListener('keydown',e=>{
const k=e.key.toLowerCase();
if(k==='f1'||(e.ctrlKey&&k==='h')){e.preventDefault();showManual();}
if(e.ctrlKey&&k==='k'){e.preventDefault();showKB();}
if(e.ctrlKey&&k==='p'){e.preventDefault();if(typeof showCommandPalette==='function')showCommandPalette();}
if(e.ctrlKey&&k==='t'){e.preventDefault();toggleTheme();}
if(e.ctrlKey&&k==='l'){e.preventDefault();toggleLang();}
if(e.ctrlKey&&k==='e'){e.preventDefault();exportZIP();}
if(e.ctrlKey&&e.shiftKey&&k==='c'){e.preventDefault();copyAllFiles();}
if(e.altKey&&k==='arrowleft'){e.preventDefault();viewBack();}
if(e.altKey&&k==='arrowright'){e.preventDefault();viewForward();}
if(e.ctrlKey&&k==='m'){e.preventDefault();showPM();}
if(e.ctrlKey&&k==='4'){e.preventDefault();if(typeof showExplorer==='function')showExplorer();}
if(e.ctrlKey&&k==='5'){e.preventDefault();S.pillar=5;if(typeof showFileTree==='function')showFileTree();}
if(e.ctrlKey&&k==='6'){e.preventDefault();S.pillar=6;if(typeof showRoadmapUI==='function')showRoadmapUI();}
if(e.ctrlKey&&k==='7'){e.preventDefault();if(typeof showAILauncher==='function')showAILauncher();}
if(e.ctrlKey&&k==='b'){e.preventDefault();if(typeof toggleSidebar==='function')toggleSidebar();}
if(e.key==='Escape'){
if(!popModal()){
// Fallback: close any visible modal
closeManual();closeHelpPopup();
const co=$('confirmOverlay');if(co)co.style.display='none';
const pm=$('pmOverlay');if(pm){pm.style.display='none';releaseFocus(pm);}
const kb=$('kbOverlay');if(kb){kb.classList.remove('show');releaseFocus(kb);}
}
}
});
// Warn before leaving page if files are generated and not yet downloaded (D1)
window.addEventListener('beforeunload',function(e){
if(Object.keys(S.files||{}).length>0&&!S._zipDone){
e.preventDefault();
e.returnValue='';
}
});
// Mobile swipe gestures (HCD: ④身体負荷 ②使いやすさ)
let _swipeStartX=0;
let _swipeStartY=0;
document.addEventListener('touchstart',e=>{
_swipeStartX=e.touches[0].clientX;
_swipeStartY=e.touches[0].clientY;
},{passive:true});
document.addEventListener('touchend',e=>{
if(document.body.clientWidth>768)return; // Evaluate at swipe time (handles resize/rotation)
const diffX=e.changedTouches[0].clientX-_swipeStartX;
const diffY=e.changedTouches[0].clientY-_swipeStartY;
if(Math.abs(diffX)<50||Math.abs(diffY)>50)return; // Minimum swipe distance + vertical scroll tolerance
if(diffX>0){
// Swipe right → show chat
const tabs=document.querySelectorAll('.mobtab');
if(tabs.length>0&&tabs[0])tabs[0].click();
}else{
// Swipe left → show preview
const tabs=document.querySelectorAll('.mobtab');
if(tabs.length>1&&tabs[1])tabs[1].click();
}
},{passive:true});
// C-3: Mobile Files tab handler
function mobFiles(){
if(typeof switchSidebarTab==='function')switchSidebarTab('files');
// Show sidebar content in the main area on mobile
const panel=$('ws');if(panel)panel.style.display='flex';
// Activate the files mobtab
document.querySelectorAll('.mobtab').forEach((t,i)=>{t.classList.toggle('on',i===2);t.setAttribute('aria-selected',i===2?'true':'false');});
}
function _getTourSteps(){
const _ja=S.lang==='ja';
var steps=[
{title:_ja?'🌱 スキルレベル':'🌱 Skill Level',desc:_ja?'Beginner / Intermediate / Pro を選ぶと、質問の選択肢が自動調整されます。':'Choose Beginner / Intermediate / Pro to auto-adjust question options.'},
{title:_ja?'📝 テンプレート':'📝 Templates',desc:_ja?'📦標準48種 ＋ 🎓分野別82種のプリセット。モード切替で選択。⚔️比較で違いを一覧。選ぶと回答が自動入力。':'📦 48 standard + 🎓 82 field presets. Toggle mode to switch. Use ⚔️ Compare for side-by-side. Pick one to auto-fill answers.'},
{title:_ja?'💬 質問フロー':'💬 Q&A Flow',desc:_ja?'Phase 1-3 の質問に答えるだけ。Beginner: Phase 2自動スキップ＆⭐おすすめ技術をハイライト。スキップ＆後で回答も可能。':'Just answer Phase 1-3 questions. Beginners: Phase 2 auto-skipped & ⭐ recommended tech highlighted. Skip & answer later anytime.'},
{title:_ja?'✎ 回答編集':'✎ Edit Answers',desc:_ja?'送信済みの回答に表示される ✎ ボタンで修正できます。':'Click the ✎ button on submitted answers to edit them.'},
{title:_ja?'📦 135+ファイル生成':'📦 135+ File Generation',desc:_ja?'全質問回答後、20の柱で135+ファイルが自動生成されます。':'After all questions, 135+ files auto-generate across 20 pillars.'},
{title:_ja?'⚡ 並列探索':'⚡ Parallel Explorer',desc:_ja?'Pillar ⑤ で7スタックを比較。回答に基づくおすすめランキング付き。':'Compare 7 stacks in Pillar ⑤ with recommendation ranking based on your answers.'},
{title:'📊 Dashboard',desc:_ja?'Pillar ⑥ でコンテキスト可視化＋'+_TECH_COUNT+'技術DBを閲覧。':'Visualize context + browse '+_TECH_COUNT+' tech DB in Pillar ⑥.'},
{title:_ja?'🤖 AIランチャー':'🤖 AI Launcher',desc:_ja?'Pillar ⑧ で仕様書をAIツールにワンクリック投入。37テンプレート＋トークン推定。':'Feed specs to AI tools in one click from Pillar ⑧. 37 templates + token estimation.'},
{title:_ja?'🎭 9人の専門家ブレスト':'🎭 9-Expert Brainstorm',desc:_ja?'AIランチャーの「🎭 9人の専門家ブレスト」で、9つの異なる視点からアイデアを爆発させましょう。クリエイティブ・技術・ビジネス・ユーザー・ディスラプター等の専門家がAIの中に召喚されます。':'Use "🎭 9-Expert Brainstorm" in AI Launcher to explode ideas from 9 perspectives. Creative, Technical, Business, User, and Disruptor experts are summoned inside your AI.'},
{title:_ja?'💾 データ保存の注意':'💾 Save Your Work',desc:_ja?'全データはブラウザのlocalStorageに保存されます。閲覧履歴の消去やブラウザ変更でデータが消失します。作業後は必ず📤 JSONエクスポートと📦 ZIPダウンロードで保存してください。':'All data is stored in browser localStorage. Clearing browser data or switching browsers will erase everything. Always export JSON 📤 and download ZIP 📦 after work.'},
{title:_ja?'⚠️ 注意事項を確認':'⚠️ Read Cautions',desc:_ja?'ヘルプ（F1）の「⚠️ 注意事項」タブにスキルレベル設定・言語切替・ストレージ上限などの重要な注意点をまとめています。':'Check the "⚠️ Cautions" tab in Help (F1) for important notes on skill level, language switching, storage limits, and more.'},
];
// Lv0-1: essential steps only (skill, templates, Q&A, generation, save, cautions)
if(S.skillLv<=1){var _ti=[0,1,2,4,9,10];return _ti.map(function(i){return steps[i];});}
return steps;
}
let tourStep=-1;
function startTour(){
const steps=_getTourSteps();
if(steps.length===0)return;
tourStep=0;showTourStep();
}
function showTourStep(){
const tc=$('tourContainer');
const steps=_getTourSteps();
if(tourStep<0||tourStep>=steps.length){closeTour();return;}
const step=steps[tourStep];
const dots=steps.map((_,i)=>'<div class="tour-dot'+(i===tourStep?' on':'')+'"></div>').join('');
tc.innerHTML='<div class="tour-card"><h4 class="tour-title">'+step.title+'</h4><p class="tour-desc">'+step.desc+'</p><div class="tour-dots">'+dots+'</div><div class="tour-acts" id="tourActs"></div></div>';
const acts=$('tourActs');
if(tourStep>0){const pb=document.createElement('button');pb.className='btn btn-g btn-xs';pb.textContent=t('tourPrev');pb.onclick=()=>{tourStep--;showTourStep();};acts.appendChild(pb);}
const nb=document.createElement('button');nb.className='btn btn-p btn-xs';nb.textContent=tourStep===steps.length-1?t('tourDone'):t('tourNext');
nb.onclick=()=>{tourStep++;showTourStep();};acts.appendChild(nb);
}
function closeTour(){tourStep=-1;$('tourContainer').innerHTML='';_lsSet('devforge-tour-done','1');}
/* Global error handler */
window.onerror=(msg,src,line)=>{console.error('DevForge error:',{msg,src,line});toast('⚠️ '+msg);};
window.onunhandledrejection=e=>{console.error('Unhandled:',e.reason);toast('⚠️ '+(e.reason?.message||e.reason));};
let _mermaidReady=false;let _mermaidLoading=false;
// OS theme auto-detection (HCD: ⑥文脈適合)
let theme=_lsGet('devforge-theme');
const themeManual=_lsGet('devforge-theme-manual')==='true';
if(!theme&&!themeManual){
// First visit: detect OS preference
const prefersLight=window.matchMedia&&window.matchMedia('(prefers-color-scheme: light)').matches;
theme=prefersLight?'light':'dark';
}else if(!theme){
theme='dark'; // Default fallback
}
// Real-time OS theme tracking (unless manually overridden)
if(!themeManual&&window.matchMedia){
const mq=window.matchMedia('(prefers-color-scheme: light)');
mq.addEventListener('change',e=>{
if(_lsGet('devforge-theme-manual')!=='true'){
theme=e.matches?'light':'dark';
applyTheme();
}
});
}
function _initMermaidTheme(){try{mermaid.initialize({startOnLoad:false,theme:theme==='light'?'default':'dark',securityLevel:'strict'});}catch(e){}}
function loadMermaid(cb){
if(_mermaidReady){cb();return;}
if(_mermaidLoading){setTimeout(()=>loadMermaid(cb),200);return;}
_mermaidLoading=true;
const s=document.createElement('script');
s.src='https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js';
s.integrity='sha384-WmdflGW9aGfoBdHc4rRyWzYuAjEmDwMdGdiPNacbwfGKxBW/SO6guzuQ76qjnSlr';
s.crossOrigin='anonymous';
s.onload=()=>{
_initMermaidTheme();
_mermaidReady=true;_mermaidLoading=false;cb();
};
s.onerror=()=>{_mermaidLoading=false;console.warn('Mermaid CDN load failed');cb();};
document.head.appendChild(s);
}
async function _ensureMermaid(){
if(_mermaidReady)return true;
return new Promise(r=>{loadMermaid(()=>r(_mermaidReady));});
}
function applyTheme(){document.documentElement.setAttribute('data-theme',theme);const btn=$('themeBtn');if(btn)btn.textContent=theme==='light'?'☀️':'🌙';if(_mermaidReady)_initMermaidTheme();}
function toggleTheme(){theme=theme==='light'?'dark':'light';_lsSet('devforge-theme',theme);_lsSet('devforge-theme-manual','true');applyTheme();}
function toggleLang(){S.lang=S.lang==='ja'?'en':'ja';save();applyLang();if(voiceRec)voiceRec.lang=S.lang==='ja'?'ja-JP':'en-US';}
function applyLang(){
const l=S.lang;
const ja=l==='ja';
// Hero section
if($('heroTitle'))$('heroTitle').textContent=t('heroTitle');
if($('heroDesc'))$('heroDesc').textContent=t('heroDesc');
if($('startBtn'))$('startBtn').textContent=t('startBtn');
['statFiles','statTech','statPillars','statAI'].forEach(k=>{if($(k))$(k).textContent=t(k);});
if($('statTechNum'))$('statTechNum').textContent=_TECH_COUNT;
if($('skillAsk'))$('skillAsk').textContent=t('skillAsk');
document.querySelectorAll('.sk-title').forEach((el,i)=>{el.textContent=t(['skBeginner','skIntermediate','skPro'][i]);});
document.querySelectorAll('.sk-desc').forEach((el,i)=>{el.textContent=t(['skBeginnerDesc','skIntermediateDesc','skProDesc'][i]);});
// Topbar buttons
const lb=$('langBtn');if(lb)lb.textContent=ja?'🌐 EN':'🌐 JA';
if($('helpBtn'))$('helpBtn').title=ja?'ヘルプ':'Help';
if($('kbBtn'))$('kbBtn').title=ja?'ショートカット':'Shortcuts';
if($('pmBtn'))$('pmBtn').title=ja?'プロジェクト管理':'Projects';
if($('searchBtn'))$('searchBtn').title=ja?'検索 (Ctrl+P)':'Search (Ctrl+P)';
// Landing stat labels
const statLbls=document.querySelectorAll('.stat-item .lbl');
const slJa=['生成ファイル','技術エントリ','柱 (Pillars)','AIツール対応'];
const slEn=['Generated Files','Tech Entries','Pillars','AI Tools'];
statLbls.forEach((el,i)=>{if(i<4)el.textContent=ja?slJa[i]:slEn[i];});
// Info cards
const icards=document.querySelectorAll('.icard');
const icJa=[['😱 3つの悪夢を解決','真っ白な画面の絶望・終わらない連携地獄・「俺の環境では動く」症候群…DevForgeが全て自動解決'],['🧪 20の柱×135+ファイル','設計書を自動生成 → AIに投入 → 実コード。質問に答えるだけで仕様・環境・AIルール全てを自動生成。'],['📱 モバイル対応','Expo / React Native 開発パス・EAS Build・OTA更新'],['🤖 AI自律開発','Vibe Coding・マルチAgent・Claude Code Subagents'],['💳 決済・CMS・EC','Stripe・microCMS・Medusa・Shopify Hydrogen'],['📦 フルエクスポート','ZIP・PDF・全ファイル結合コピー・URLシェア']];
const icEn=[['😱 Solve 3 Dev Nightmares','Blank screen paralysis, endless integration hell, "works on my machine" syndrome… DevForge auto-resolves all'],['🧪 20 Pillars × 135+ Files','Auto-generate specs → Feed to AI → Real code. Answer questions to auto-generate specs, env, AI rules & strategy.'],['📱 Mobile Support','Expo / React Native dev path, EAS Build, OTA updates'],['🤖 AI Autonomous Dev','Vibe Coding, Multi-Agent, Claude Code Subagents'],['💳 Payment/CMS/EC','Stripe, microCMS, Medusa, Shopify Hydrogen'],['📦 Full Export','ZIP, PDF, Copy All Files, URL Share']];
icards.forEach((el,i)=>{if(i<6){const d=ja?icJa[i]:icEn[i];const h4=el.querySelector('h4');const p=el.querySelector('p');if(h4)h4.textContent=d[0];if(p)p.textContent=d[1];}});
// P1: Lv0-1 beginner icard simplification — show only 3 simple cards
if(S.skillLv<=1){
// F5: set expectation — output is design docs, not code
const _lv0ic0=ja?['📖 設計書を自動で作る','質問に答えるだけでAI用の設計書を生成。そのままCursor等のAIツールに渡すと実コードに変換されます。']:['📖 Auto-Generate Design Docs','Answer questions to generate AI-ready design docs. Feed them to Cursor or other AI tools to get real code.'];
if(icards[0]){const h4=icards[0].querySelector('h4'),p=icards[0].querySelector('p');if(h4)h4.textContent=_lv0ic0[0];if(p)p.textContent=_lv0ic0[1];}
const _lv0ic1=ja?['🚀 3ステップで設計書完成','①質問に答える → ②ZIPダウンロード → ③AIに渡す。それだけ！']:['🚀 Done in 3 Steps','①Answer questions → ②Download ZIP → ③Feed to AI. That\'s it!'];
const _lv0ic2=ja?['🤖 AIにそのまま渡せる','生成ファイルをAIツールに投入するだけ。難しい知識は不要。']:['🤖 Ready to Feed to AI','Just give generated files to your AI tool. No technical knowledge needed.'];
if(icards[1]){const h4=icards[1].querySelector('h4'),p=icards[1].querySelector('p');if(h4)h4.textContent=_lv0ic1[0];if(p)p.textContent=_lv0ic1[1];}
if(icards[2]){const h4=icards[2].querySelector('h4'),p=icards[2].querySelector('p');if(h4)h4.textContent=_lv0ic2[0];if(p)p.textContent=_lv0ic2[1];}
for(var _ici=3;_ici<6;_ici++){if(icards[_ici])icards[_ici].style.display='none';}
}else{
for(var _ici=3;_ici<6;_ici++){if(icards[_ici])icards[_ici].style.display='';}
}
// Pillar badges
const pbadges=document.querySelectorAll('.pbadge');
const pbJa=['①SDD統合','②DevContainer','③MCP設定','④AIルール','⑤並列探索','⑥Dashboard','⑦ロードマップ','⑧AIランチャー','⑨デザインシステム','⑩リバースEng','⑪実装ガイド','⑫セキュリティ','⑬戦略インテリジェンス','⑭運用インテリジェンス','⑮未来戦略','⑯開発IQ','⑰プロンプトゲノム','⑱Prompt Ops','⑲エンタープライズ','⑳CI/CD'];
const pbEn=['①SDD','②DevContainer','③MCP','④AI Rules','⑤Explorer','⑥Dashboard','⑦Roadmap','⑧AI Launcher','⑨Design System','⑩Reverse Eng','⑪Impl Guide','⑫Security','⑬Strategic Intelligence','⑭Ops Intelligence','⑮Future Strategy','⑯Dev IQ','⑰Prompt Genome','⑱Prompt Ops','⑲Enterprise','⑳CI/CD'];
pbadges.forEach((el,i)=>{if(i<20)el.textContent=ja?pbJa[i]:pbEn[i];});
// F4: beginner-friendly pillar badge labels (override for Lv0-1 visible pillars)
if(S.skillLv<=1){
var _bpL=ja?{0:'①仕様書',3:'④AIルール',7:'⑧AIランチャー',8:'⑨デザイン'}:{0:'①Specs',3:'④AI Rules',7:'⑧AI Launcher',8:'⑨Design'};
pbadges.forEach(function(el,i){if(i<20&&_bpL[i]!==undefined)el.textContent=_bpL[i];});
}
// Pillar badge tooltips
const pbTipJa=['仕様書・タスク・検証の統合設計ドキュメント5本組','VSCode/Cursor対応Docker開発環境を即時構築','Model Context Protocol設定でAIをプロジェクト対応','10+ツール対応AIルール（Claude/Cursor/Copilot等）','7スタック並列比較＋おすすめランキング','コンテキスト可視化＋技術DBブラウザ','インタラクティブ学習ロードマップ（Layer別進捗）','37プロンプトテンプレート＋AIモデル推薦','デザイントークン＋シーケンス図自動生成','ゴール逆算型プランニング（リバースエンジニアリング）','業種別実装パターン＋AI運用手順書','OWASP/STRIDE対応セキュリティ監査プロンプト','業界特化設計図＋技術レーダー＋ステークホルダー戦略','SLO/SLI・Feature Flags・12 Ops Capabilities設計','市場・UX・エコシステム・規制フォーサイト（2026-2035）','32ドメイン×12手法のポリモーフィック開発戦略','CRITERIA 8軸プロンプト品質スコア＋AI成熟度評価','ReAct自律ワークフロー＋LLMOpsダッシュボード','マルチテナント設計＋組織モデル＋エンタープライズUI','9ステージCI/CDパイプライン＋デプロイ戦略設計'];
const pbTipEn=['5-doc spec suite: constitution, spec, plan, tasks, verification','Instant Docker dev env compatible with VSCode/Cursor','MCP config to give AI full project awareness','10+ AI tool configs (Claude, Cursor, Copilot, Windsurf, etc.)','Compare 7 stacks in parallel with recommendation ranking','Context visualization + browsable tech DB','Interactive learning roadmap with layer-based progress','37 prompt templates + AI model recommendations','Design tokens + sequence diagrams auto-generation','Goal-driven reverse engineering planning','Domain-specific implementation patterns + AI runbook','OWASP/STRIDE security audit prompts (context-aware)','Industry blueprint + tech radar + stakeholder strategy','SLO/SLI, Feature Flags, 12 Ops Capabilities design','Market, UX, ecosystem & regulatory foresight (2026-2035)','Polymorphic dev strategy: 32 domains × 12 approaches','CRITERIA 8-axis prompt quality scoring + AI maturity model','ReAct autonomous workflow + LLMOps dashboard','Multi-tenant design + org model + enterprise UI components','9-stage CI/CD pipeline + deploy strategy design'];
pbadges.forEach((el,i)=>{if(i<20)el.title=ja?pbTipJa[i]:pbTipEn[i];});
// Beginner badge filtering: Lv0-1 shows only 4 essential pillars to reduce cognitive load
var _bpSet=new Set([0,3,7,8]);
pbadges.forEach(function(el,i){if(i<20){el.style.display=(S.skillLv<=1&&!_bpSet.has(i))?'none':'';}});
// Keyboard shortcuts overlay
const kbT=$('kbTitle');if(kbT)kbT.textContent=t('kbTitle');
const kbLabels=document.querySelectorAll('.kblbl');
const kbArr=t('kb');
kbLabels.forEach((el,i)=>{if(i<kbArr.length)el.textContent=kbArr[i];});
// Input placeholder
const ni=$('nameIn');if(ni)ni.placeholder=ja?'プロジェクト名を入力...':'Enter project name...';
// Preview panel header
const panPT=$('panPTitle');if(panPT)panPT.textContent=ja?'📁 生成ファイル':'📁 Generated Files';
// Preview tabs
if($('prevTabs')&&$('prevTabs').children.length>0){
const tabs=$('prevTabs').children;
if(tabs[0])tabs[0].textContent=ja?'ツリー':'Tree';
if(tabs[1])tabs[1].textContent=ja?'プレビュー':'Preview';
}
// Pillar tabs
if($('pillarTabs')&&$('pillarTabs').children.length>0){
const names=t('pillar');
// Lv0-1: show only 4 essential pillar tabs to reduce cognitive load
var _ptFilter=S.skillLv<=1?new Set([0,3,7,8]):null;
if(Array.isArray(names)){Array.from($('pillarTabs').children).forEach((b,i)=>{
if(names[i])b.textContent=names[i];
b.style.display=(_ptFilter&&!_ptFilter.has(i))?'none':'';
});}
// F4: beginner-friendly pillar tab labels (override for Lv0-1 visible tabs)
if(S.skillLv<=1){
var _ptL=ja?{0:'📋 仕様書',3:'🤖 AIルール',7:'🚀 AIランチャー',8:'🎨 デザイン'}:{0:'📋 Specs',3:'🤖 AI Rules',7:'🚀 AI Launcher',8:'🎨 Design'};
Array.from($('pillarTabs').children).forEach(function(b,i){if(_ptL[i]!==undefined)b.textContent=_ptL[i];});
}
}
// Keyboard shortcuts overlay
const kbRows=document.querySelectorAll('.kb-row span:first-child');
const kbJa=['ヘルプ・マニュアル','ショートカット一覧','コマンドパレット','テーマ切替','言語切替','エクスポート','全ファイルコピー','プロジェクト管理','サイドバー切替','エクスプローラー','ダッシュボード','ロードマップ','AI起動'];
const kbEn=['Help / Manual','Shortcut List','Command Palette','Toggle Theme','Toggle Language','Export','Copy All Files','Project Manager','Toggle Sidebar','Explorer','Dashboard','Roadmap','AI Launcher'];
kbRows.forEach((el,i)=>{if(i<13)el.textContent=ja?kbJa[i]:kbEn[i];});
// Mobile tabs
const mobtabs=document.querySelectorAll('.mobtab');
if(mobtabs.length>=2){mobtabs[0].textContent=ja?'💬 チャット':'💬 Chat';mobtabs[1].textContent=ja?'📄 プレビュー':'📄 Preview';}
// Footer
const footer=document.querySelector('.app-footer');if(footer)footer.textContent=ja?'© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん':'© 2026 Engineering no Tane Committee | Created by にしあん';
// Placeholder in prevBody
const prevP=$('prevBody');if(prevP&&prevP.querySelector('p')&&!Object.keys(S.files||{}).length){
const p=prevP.querySelector('p');if(p&&!S.previewFile)p.textContent=ja?'質問に回答するとリアルタイムでプレビューが更新されます':'Preview updates in real-time as you answer questions';
}
// Phase pills
if(typeof updateSidebarLabels==='function')updateSidebarLabels();
initPills();
// Refresh presets for lang
if($('presetRow'))initPresets();
// Update html lang attribute and document title (D3)
document.documentElement.lang=S.lang;
document.title=ja?'DevForge v9.5 — AI駆動開発 統合プラットフォーム':'DevForge v9.5 — AI-Driven Development Platform';
// Compare button translation (D4)
const cl=$('compareLbl');if(cl)cl.textContent=ja?'テンプレート比較':'Compare Templates';
// Update QBar labels when language changes
if(typeof updateQbar==='function')updateQbar();
// Sync skill slider and label to current S.skillLv
var sl=$('skillLvSlider');if(sl)sl.value=S.skillLv;
if(typeof _updateSkillLabel==='function')_updateSkillLabel(S.skillLv);
// Lv0 hero supplemental hint
var h0=$('heroLv0Hint');
if(h0){
h0.style.display=S.skillLv===0?'block':'none';
h0.textContent=ja?'難しい知識は不要。質問に答えるだけ':'No technical knowledge needed. Just answer questions.';
}
// F2: hero stats skill-adaptation (Lv0-1 shows 4 pillars / key files to reduce info shock)
var _spn=$('statPillarNum');if(_spn)_spn.textContent=S.skillLv<=1?'4':'20';
var _sfn=$('statFileNum');if(_sfn&&!Object.keys(S.files||{}).length)_sfn.textContent=S.skillLv<=1?(ja?'主要':'Key'):'135+';
var _hd=$('heroDesc');
if(_hd){
if(S.skillLv<=1)_hd.textContent=ja?'質問に答えるだけで設計書を自動生成。AIにそのまま渡せば開発スタート。':'Answer questions to auto-generate design docs. Feed to AI to start coding.';
else _hd.textContent=t('heroDesc');
}
}
// Initialize
load();
applyTheme();
initPresets();
initVoice();
applyLang();
_initLinkInterceptor();
// D-2: Add keyboard support for skill cards
document.querySelectorAll('.skcard').forEach(el=>{
el.onkeydown=(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();el.click();}};
});
// Load from URL if shared
(function loadFromURL(){
try{
const h=location.hash;if(!h||!h.startsWith('#df='))return;
const data=JSON.parse(decodeURIComponent(escape(atob(h.slice(4)))));
// Backward compatibility: support old short keys {p,a,pr}
if(!data.projectName&&data.p){data.projectName=data.p;data.answers=data.a;data.preset=data.pr;}
if(data.projectName){
S.projectName=sanitizeName(data.projectName);
if(data.answers){
const safeAnswers={};
Object.keys(data.answers).forEach(k=>{
if(['__proto__','constructor','prototype'].includes(k))return;
if(typeof data.answers[k]==='string'){
safeAnswers[k]=sanitize(data.answers[k]);
}
});
S.answers=safeAnswers;
}
if(data.preset&&typeof data.preset==='string')S.preset=data.preset;
if(data.skill&&['beginner','intermediate','pro'].includes(data.skill))S.skill=data.skill;
if(typeof data.skillLv==='number'&&data.skillLv>=0&&data.skillLv<=6){
S.skillLv=data.skillLv; S.skill=skillTier(data.skillLv);
}
if(data.lang&&['ja','en'].includes(data.lang))S.lang=data.lang;
save();location.hash='';location.reload();
}
}catch(e){}
})();
// Restore session
if(S.projectName&&S.phase>0){
$('onboard').style.display='none';
$('ws').style.display='flex';
if(typeof initSidebar==='function')initSidebar();
initPills();updProgress();
if(Object.keys(S.files).length>0){initPrevTabs();initPillarTabs();showFileTree();createQbar();if(typeof renderPillarGrid==='function')renderPillarGrid();}
findNext();
}
// What's New indicator (HCD: C継続利用)
const CURRENT_VERSION='9.5.0';
const lastSeenVersion=_lsGet('devforge-last-version');
if(lastSeenVersion!==CURRENT_VERSION){
const helpBtn=$('helpBtn')||document.querySelector('[onclick*="showManual"]');
if(helpBtn){
const dot=document.createElement('span');
dot.className='whats-new-dot';
dot.title=S.lang==='ja'?'新機能あり':'New features';
helpBtn.style.position='relative';
helpBtn.appendChild(dot);
// Clear dot when help is opened
const _origShowManual=window.showManual;
window.showManual=function(){
_lsSet('devforge-last-version',CURRENT_VERSION);
if(dot)dot.remove();
if(_origShowManual)_origShowManual.apply(this,arguments);
};
}
}
// Tour
if(!_lsGet('devforge-tour-done')){setTimeout(()=>startTour(),1000);}
</script>
</body>
</html>