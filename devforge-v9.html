<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self' https://cdnjs.cloudflare.com; object-src 'none'; base-uri 'self'; form-action 'self';">
<title>DevForge v9.0 — AI駆動開発 統合プラットフォーム</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" integrity="sha384-+mbV2IY1Zk/X1p/nWllGySJSUN8uMs+gUAN10Or95UBH0fpj6GfKgPmgC5EXieXG" crossorigin="anonymous" onerror="window._noZip=true"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js" integrity="sha384-/TQbtLCAerC3jgaim+N78RZSDYV7ryeoBCVqTuzRrFec2akfBkHS7ACQ3PQhvMVi" crossorigin="anonymous" onerror="window._noMarked=true"></script>
<style>
:root{--bg:#0c0e13;--bg-1:#1e1e2e;--bg-2:#13161d;--bg-3:#1a1e28;--bg-4:#222733;--bg-s:var(--bg-2);--bd:var(--border);--fg:var(--text);--surface:#282e3c;--border:#2e3446;--border-light:#3a4158;--text:#e8ecf4;--text-2:#a4adc0;--text-3:#6b7590;--accent:#3b82f6;--accent-soft:rgba(59,130,246,.12);--accent-2:#22d3ee;--success:#34d399;--warn:#fbbf24;--warn-soft:rgba(251,191,36,.1);--warn-text:#fbbf24;--danger:#f87171;--layer-1:#3b82f6;--layer-2:#8b5cf6;--layer-3:#10b981;--layer-3h:#f59e0b;--layer-4:#ef4444;--layer-5:#06b6d4;--layer-6:#f97316;--layer-7:#a855f7;--chip-bg:#1e2230;--chip-border:#2e3446;--radius:10px;--radius-lg:16px;--mono:"IBM Plex Mono",monospace;--sans:"IBM Plex Sans JP",-apple-system,sans-serif}.compat-fixall{margin-left:auto}.compat-fixlv{margin-left:4px}[data-theme=light]{--bg:#f5f7fa;--bg-1:#e8ecf0;--bg-2:#fff;--bg-3:#edf0f5;--bg-4:#e2e6ed;--bg-s:var(--bg-2);--bd:var(--border);--fg:var(--text);--surface:#d8dce5;--border:#cdd2dc;--border-light:#bfc5d2;--text:#1e222d;--text-2:#4a5168;--text-3:#8690a6;--accent:#2563eb;--accent-soft:rgba(37,99,235,.08);--accent-2:#0891b2;--success:#059669;--warn:#d97706;--warn-soft:rgba(217,119,6,.06);--warn-text:#b45309;--danger:#dc2626;--layer-1:#2563eb;--layer-2:#7c3aed;--layer-3:#059669;--layer-3h:#d97706;--layer-4:#dc2626;--layer-5:#0891b2;--layer-6:#ea580c;--layer-7:#9333ea;--chip-bg:#e8ecf4;--chip-border:#d0d5e0}*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:var(--sans);background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-light);border-radius:3px}.app{max-width:1440px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}.topbar{display:flex;align-items:center;justify-content:space-between;padding:0 24px;height:50px;border-bottom:1px solid var(--border);background:var(--bg-2);position:sticky;top:0;z-index:100}.topbar-left{display:flex;align-items:center;gap:16px;min-width:0;flex:1}.topbar-brand{display:flex;align-items:center;gap:10px;flex-shrink:0}.topbar-brand svg{width:20px;height:20px}.topbar-brand span{font-weight:700;font-size:14px;letter-spacing:-.03em}.topbar-brand small{font-size:11px;color:var(--text-3);font-weight:400;margin-left:2px}.topbar-right{display:flex;gap:6px;flex-shrink:0}.pstrip{height:3px;background:var(--bg-3);position:sticky;top:50px;z-index:99}.pstrip-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .6s cubic-bezier(.4,0,.2,1);box-shadow:0 0 12px var(--accent)}.btn{padding:7px 16px;border:none;border-radius:7px;font-weight:600;font-size:12px;cursor:pointer;font-family:var(--sans);transition:all .15s;display:inline-flex;align-items:center;gap:5px;white-space:nowrap}.btn-p{background:var(--accent);color:#fff}.btn-p:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.btn-s{background:var(--bg-3);color:var(--text-2);border:1px solid var(--border)}.btn-s:hover{background:var(--bg-4);color:var(--text)}.btn-d{background:var(--success);color:#fff}.btn-d:hover{background:#059669}.btn-g{background:transparent;color:var(--text-3)}.btn-g:hover{color:var(--text)}.btn-sm{padding:5px 12px;font-size:11px}.btn-xs{padding:3px 10px;font-size:10px}.theme-btn{background:none;border:none;font-size:16px;cursor:pointer;padding:4px 8px;border-radius:6px;transition:background .15s;color:var(--text)}.theme-btn:hover{background:var(--bg-3)}.onboard{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;gap:24px;text-align:center}.onboard h1{font-size:28px;font-weight:700;letter-spacing:-.03em;background:linear-gradient(135deg,var(--accent),var(--accent-2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.onboard p{color:var(--text-2);font-size:14px;max-width:560px;line-height:1.7}.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:10px;max-width:760px;width:100%}.icard{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);padding:16px;text-align:left}.icard h4{font-size:13px;margin-bottom:4px}.icard p{font-size:11px;color:var(--text-3);line-height:1.5}.pillars-badge{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;max-width:700px}.pbadge{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;background:var(--bg-3);color:var(--text-2);border:1px solid var(--border)}.start-zone{display:flex;flex-direction:column;gap:12px;align-items:center;width:100%;max-width:560px}.nameIn{width:100%;padding:12px 16px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg-3);color:var(--text);font-size:14px;font-family:var(--sans);outline:none;transition:border-color .2s}.nameIn:focus{border-color:var(--accent)}.preset-row{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}.prchip{padding:5px 14px;border-radius:20px;font-size:11px;font-weight:600;background:var(--chip-bg);color:var(--text-2);border:1px solid var(--chip-border);cursor:pointer;transition:all .15s}.prchip:hover{border-color:var(--accent);color:var(--accent)}.prchip.on{background:var(--accent-soft);color:var(--accent);border-color:var(--accent)}.prchip-cmp{background:color-mix(in srgb,var(--warn) 10%,transparent)!important;color:var(--warn)!important;border-color:color-mix(in srgb,var(--warn) 30%,transparent)!important}.cmp-selectors{display:flex;align-items:center;gap:8px;margin-bottom:16px}.cmp-selectors select{flex:1;padding:8px;border-radius:var(--radius);border:1px solid var(--border);background:var(--bg-1);color:var(--text);font-size:12px}.cmp-vs{font-weight:700;color:var(--warn);font-size:13px}.cmp-table{width:100%;font-size:11px;border-collapse:collapse}.cmp-table th{text-align:left;padding:6px 8px;background:var(--bg-3);font-size:11px}.cmp-table td{padding:5px 8px;border-bottom:1px solid var(--border)}.cmp-label{font-weight:600;color:var(--text-3);min-width:70px}.cmp-diff td:not(.cmp-label){background:color-mix(in srgb,var(--warn) 6%,transparent)}.ws{display:flex;flex:1;overflow:hidden}#ws{flex:1;flex-direction:column;overflow:hidden}.panel-c{flex:1;display:flex;flex-direction:column;border-right:1px solid var(--border);min-width:0;overflow:hidden}.panel-p{width:50%;display:flex;flex-direction:column;min-width:0;overflow:hidden}.badge{font-size:11px;padding:2px 10px;border-radius:10px;background:var(--accent-soft);color:var(--accent);font-weight:600}.cbody{flex:1;overflow-y:auto;padding:16px 20px;display:flex;flex-direction:column;gap:12px}.izone{border-top:1px solid var(--border);background:var(--bg-2);flex-shrink:0}.msg{display:flex;gap:10px;animation:fadeUp .3s ease}@keyframes fadeUp{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.prev-head{display:flex;align-items:center;gap:8px;padding:12px 20px;border-bottom:1px solid var(--border);background:var(--bg-2)}.prev-head h3{font-size:14px;font-weight:600;flex:1}.prev-tabs{display:flex;gap:2px;background:var(--bg-3);border-radius:8px;padding:2px}.ptab{padding:4px 12px;border-radius:6px;font-size:11px;font-weight:600;color:var(--text-3);cursor:pointer;transition:all .15s;border:none;background:none;font-family:var(--sans)}.ptab.on{background:var(--bg-2);color:var(--text);box-shadow:0 1px 3px #0000001a}.prev-body{flex:1;overflow-y:auto;padding:20px}.prev-body pre{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:16px;font-family:var(--mono);font-size:12px;line-height:1.6;overflow-x:auto;white-space:pre-wrap;word-break:break-word}.file-tree{list-style:none;font-size:12px;font-family:var(--mono)}.ft-search{margin-bottom:8px}.ft-search input{width:100%;padding:6px 10px;font-size:11px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg-2);color:var(--text);font-family:var(--sans);outline:none}.ft-search input:focus{border-color:var(--accent)}.file-tree li{padding:3px 0;color:var(--text-2);cursor:pointer}.file-tree li:hover{color:var(--accent)}.file-tree li.folder{color:var(--warn);font-weight:600}.file-tree li.active{color:var(--accent);font-weight:600}.md-rendered{overflow:auto;max-height:calc(100vh - 200px);font-size:12px;line-height:1.6;padding:8px}.md-rendered h1,.md-rendered h2,.md-rendered h3{color:var(--text);margin:16px 0 8px}.md-rendered h1{font-size:16px;border-bottom:1px solid var(--border);padding-bottom:6px}.md-rendered h2{font-size:14px}.md-rendered h3{font-size:13px}.md-rendered p,.md-rendered li{color:var(--text-2);font-size:12px}.md-rendered pre{background:var(--bg-2);padding:10px;border-radius:6px;overflow-x:auto;font-size:11px}.md-rendered code{font-family:var(--mono);font-size:11px;background:var(--bg-2);padding:1px 4px;border-radius:3px}.md-rendered pre code{background:none;padding:0}.md-rendered table{width:100%;border-collapse:collapse;font-size:11px;margin:8px 0}.md-rendered th,.md-rendered td{border:1px solid var(--border);padding:4px 8px;text-align:left}.md-rendered th{background:var(--bg-2);font-weight:600;color:var(--text)}.md-rendered .mermaid{background:var(--bg-2);padding:16px;border-radius:8px;margin:12px 0;text-align:center;overflow-x:auto}.md-rendered .mermaid svg{max-width:100%}.md-rendered a{color:var(--accent);text-decoration:none;border-bottom:1px dotted var(--accent);cursor:pointer}.md-rendered a:hover{color:var(--text);border-bottom-color:var(--text)}.md-rendered a[target=_blank]:after{content:" \2197";font-size:.8em;opacity:.6}.md-rendered a.link-broken{color:var(--danger);border-bottom-color:var(--danger);opacity:.7}.pillar-tabs{display:flex;gap:2px;flex-wrap:wrap;padding:8px 16px;background:var(--bg-2);border-bottom:1px solid var(--border)}.piltab{padding:4px 10px;border-radius:6px;font-size:10px;font-weight:600;color:var(--text-3);cursor:pointer;border:none;background:none;font-family:var(--sans);transition:all .15s}.piltab.on{background:var(--accent-soft);color:var(--accent)}.piltab:hover{color:var(--text)}.ctx-bar{height:6px;background:var(--bg-4);border-radius:3px;margin-top:8px;overflow:hidden}.ctx-bar-fill{height:100%;border-radius:3px;transition:width .6s}.road-week{font-size:10px;color:var(--text-3);font-weight:600;padding:2px 8px;background:var(--bg-4);border-radius:10px;flex-shrink:0}.mobtabs{display:none;border-bottom:1px solid var(--border);background:var(--bg-2)}.mobtab{flex:1;text-align:center;padding:10px;font-size:12px;font-weight:600;color:var(--text-3);cursor:pointer}.mobtab.on{color:var(--accent);border-bottom:2px solid var(--accent)}.export-summary{display:flex;gap:16px;padding:12px 20px;font-size:12px;font-weight:600;color:var(--text-2);border-bottom:1px solid var(--border);flex-wrap:wrap}.export-summary span{display:flex;align-items:center;gap:4px}.qbar{position:fixed;bottom:16px;left:50%;transform:translate(-50%);display:flex;gap:6px;padding:8px 12px;background:var(--bg-2);border:1px solid var(--border);border-radius:12px;box-shadow:0 4px 20px #0000004d;z-index:90;align-items:center}.qbar-btn{padding:6px 12px;border:none;border-radius:8px;font-size:11px;font-weight:600;cursor:pointer;background:var(--bg-3);color:var(--text);transition:all .15s;white-space:nowrap}.qbar-btn:hover{background:var(--accent-soft);color:var(--accent)}.qbar-x{padding:4px 8px;border:none;background:none;color:var(--text-3);cursor:pointer;font-size:12px}.qbar-x:hover{color:var(--danger)}.export-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;padding:20px}.export-card{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:20px;text-align:center;cursor:pointer;transition:all .15s}.export-card-danger{border-color:color-mix(in srgb,var(--danger) 25%,transparent);opacity:.7}.export-card-danger:hover{border-color:var(--danger);background:color-mix(in srgb,var(--danger) 6%,transparent);opacity:1}.export-card-regen{border-color:var(--accent);border-style:dashed}.export-card:hover{border-color:var(--accent);transform:translateY(-2px)}.export-card .icon{font-size:32px;margin-bottom:8px}.export-card h4{font-size:13px;margin-bottom:4px}.export-card p{font-size:11px;color:var(--text-3)}.help-overlay{position:fixed;inset:0;background:#0009;z-index:200;display:none;align-items:center;justify-content:center}.help-overlay.show{display:flex}.help-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);width:90vw;max-width:800px;height:80vh;display:flex;overflow:hidden}.help-nav{width:200px;background:var(--bg-3);border-right:1px solid var(--border);overflow-y:auto;padding:12px 0;flex-shrink:0}.help-nav a{display:block;padding:8px 16px;font-size:12px;color:var(--text-2);text-decoration:none;transition:all .15s}.help-nav a:hover{background:var(--bg-4);color:var(--text)}.help-nav a.on{background:var(--accent-soft);color:var(--accent);font-weight:600}.help-search{width:calc(100% - 16px);margin:8px;padding:6px 10px;font-size:11px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg-1,var(--bg));color:var(--text);outline:none}.help-search:focus{border-color:var(--accent)}#helpPopup{position:fixed;z-index:300;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);padding:14px 18px;max-width:340px;box-shadow:0 8px 32px #00000040;font-size:12px;color:var(--text)}#helpPopup h4{font-size:13px;margin-bottom:6px;color:var(--text)}#helpPopup p{font-size:12px;color:var(--text-2);line-height:1.6;margin-bottom:6px}.hp-close{position:absolute;top:6px;right:8px;background:none;border:none;color:var(--text-3);cursor:pointer;font-size:14px;padding:2px 6px;border-radius:4px}.hp-close:hover{background:var(--bg-3);color:var(--text)}.hp-ex{background:var(--bg-3);padding:8px 10px;border-radius:6px;font-size:11px;color:var(--accent);line-height:1.5}.hp-link{display:block;margin-top:8px;font-size:11px;color:var(--accent);text-decoration:none}.hp-link:hover{text-decoration:underline}.help-nav a.dim{opacity:.3;pointer-events:none}mark{background:var(--accent-soft);color:var(--accent);padding:0 2px;border-radius:2px}.help-body{flex:1;overflow-y:auto;padding:24px}.help-body h2{font-size:18px;margin-bottom:12px}.help-body h3{font-size:14px;margin:16px 0 8px;color:var(--accent)}.help-body p{font-size:13px;line-height:1.7;margin-bottom:10px;color:var(--text-2)}.help-body code{font-family:var(--mono);background:var(--bg-3);padding:2px 6px;border-radius:4px;font-size:12px}.help-body table{width:100%;border-collapse:collapse;margin:10px 0;font-size:12px}.help-body th,.help-body td{padding:8px 12px;border:1px solid var(--border);text-align:left}.help-body th{background:var(--bg-3);font-weight:600}.hg-flow{display:flex;align-items:center;gap:6px;padding:10px;background:var(--bg-3);border-radius:8px;margin:8px 0;overflow-x:auto}.hg-n{padding:6px 8px;border-radius:6px;font-size:10px;text-align:center;font-weight:600;line-height:1.4;white-space:nowrap}.hg-a{color:var(--text-3);font-size:12px;flex-shrink:0}.hg-b{background:var(--accent-soft);color:var(--accent);border:1px solid color-mix(in srgb,var(--accent) 25%,transparent)}.hg-c{background:color-mix(in srgb,var(--accent-2) 10%,transparent);color:var(--accent-2);border:1px solid color-mix(in srgb,var(--accent-2) 25%,transparent)}.hg-p{background:color-mix(in srgb,#a855f7 10%,transparent);color:#a855f7;border:1px solid color-mix(in srgb,#a855f7 25%,transparent)}.hg-g{background:color-mix(in srgb,var(--success) 10%,transparent);color:var(--success);border:1px solid color-mix(in srgb,var(--success) 25%,transparent)}.app-footer{text-align:center;padding:16px;font-size:11px;color:var(--text-3);border-top:1px solid var(--border)}@media (max-width:1024px){.panel-p{width:45%}.panel-c{flex:1}.ctx-summary,.model-grid{grid-template-columns:repeat(2,1fr)}.exp-compare{grid-template-columns:1fr}.onboard h1{font-size:24px}.info-grid{grid-template-columns:repeat(2,1fr)}}@media (max-width:768px){.topbar{padding:0 12px}.mobtabs{display:flex}.ws{flex-direction:column}.panel-p{width:100%;display:none}.panel-p.show{display:flex}.panel-c.hide{display:none}.help-modal{flex-direction:column;width:95vw;height:90vh}.help-nav{width:100%;height:auto;max-height:120px;border-right:none;border-bottom:1px solid var(--border);display:flex;overflow-x:auto;padding:8px}.help-nav a{white-space:nowrap}.info-grid{grid-template-columns:1fr 1fr}.onboard h1{font-size:22px}.exp-select{flex-direction:column;gap:8px}.exp-select select{width:100%}.exp-ranking{gap:6px}.exp-rank-row{flex-wrap:wrap}.ctx-summary{grid-template-columns:1fr 1fr}.model-grid{grid-template-columns:1fr}.dash-fbar-name{width:70px;font-size:10px}.dg{padding:8px 10px;margin-bottom:4px}.dg-bar{grid-template-columns:55px 1fr 24px;gap:4px}.dg-lbl{font-size:10px}.dg-track{height:12px}.dg-cnt{font-size:10px}.launch-stats{grid-template-columns:1fr 1fr}.launch-folders{gap:4px}.launch-models{grid-template-columns:1fr 1fr}.launch-tpl{padding:8px}.tech-table th:nth-child(3),.tech-table td:nth-child(3){display:none}.tech-filter{flex-direction:column;gap:6px}.tech-filter select,.tech-filter input{width:100%}.diff-header{flex-direction:column;gap:4px}.diff-body{font-size:10px}.kb-modal{width:95vw;padding:16px}.road-layer h3{font-size:12px;padding:6px 10px}.road-task{font-size:11px;padding:6px 8px}.road-progress{padding:12px}.pill-drawer{display:none}}.spin{animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.tech-table{width:100%;border-collapse:collapse;font-size:11px}.tech-table th{position:sticky;top:0;background:var(--bg-2);padding:6px 8px;text-align:left;font-weight:600;border-bottom:2px solid var(--accent);font-size:10px;text-transform:uppercase;letter-spacing:.05em}.tech-table td{padding:5px 8px;border-bottom:1px solid var(--border)}.tech-table tr:hover{background:var(--bg-3)}.tech-filter{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}.tech-filter select,.tech-filter input{padding:5px 10px;border:1px solid var(--border);border-radius:6px;background:var(--bg-3);color:var(--text);font-size:11px;font-family:var(--sans)}.req-badge{display:inline-block;padding:1px 6px;border-radius:8px;font-size:9px;font-weight:700}.ctx-summary{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}.ctx-stat{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:12px;text-align:center}.ctx-stat .num{font-size:24px;font-weight:700;color:var(--accent)}.ctx-stat .lbl{font-size:10px;color:var(--text-3);margin-top:4px}.model-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}.model-card{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:12px}.model-card h4{font-size:12px;margin-bottom:6px}.model-card .fit{font-size:20px;font-weight:700}.fit-high{color:var(--success)}.fit-mid{color:var(--warn)}.fit-low{color:var(--danger)}.dash-head{margin-bottom:12px}.dash-head h3{font-size:14px;margin-bottom:4px}.dash-head p{font-size:11px;color:var(--text-3)}.dash-h4{font-size:12px;margin-bottom:8px}.dash-h4-mt{font-size:12px;margin:16px 0 8px}.dash-model-ctx{font-size:11px;color:var(--text-3);margin-top:4px}.dash-model-pct{font-size:10px;color:var(--text-3);margin-top:2px}.dash-fbar-row{display:flex;align-items:center;gap:8px;margin-bottom:4px}.dash-fbar{flex:1;height:8px;background:var(--bg-4);border-radius:4px;overflow:hidden}.dash-fbar-fill{height:100%;background:var(--accent);border-radius:4px}.dash-fbar-size{font-size:10px;color:var(--text-3);width:60px;text-align:right}.dg{background:var(--bg-2);border-radius:8px;padding:10px 12px;margin-bottom:6px;border:1px solid var(--border)}.dg-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.dg-nm{font-size:11px;font-weight:600}.dg-sub{font-size:16px;font-weight:700;color:var(--accent)}.dg-bar{display:grid;grid-template-columns:68px 1fr 28px;align-items:center;gap:6px;margin-bottom:3px}.dg-lbl{font-size:11px;color:var(--text-2);text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dg-track{height:14px;background:var(--bg-4);border-radius:3px;overflow:hidden}.dg-fill{height:100%;border-radius:3px;transition:width .4s}.dg-cnt{font-size:11px;font-weight:700;text-align:right}.dg-core .dg-fill{background:linear-gradient(90deg,var(--layer-2),color-mix(in srgb,var(--layer-2) 60%,#fff))}.dg-ai .dg-fill{background:linear-gradient(90deg,var(--accent-2),color-mix(in srgb,var(--accent-2) 60%,#fff))}.dg-infra .dg-fill{background:linear-gradient(90deg,var(--layer-5),color-mix(in srgb,var(--layer-5) 60%,#fff))}.dg-qa .dg-fill{background:linear-gradient(90deg,var(--warn),#fbbf24)}.dg-total{display:flex;justify-content:space-between;align-items:center;margin-top:8px;padding-top:6px;border-top:1px solid var(--border);font-size:11px;color:var(--text-2)}.dg-total strong{font-size:16px;color:var(--text)}.dash-total{font-size:11px;color:var(--text-3);margin-top:6px}.compat-ok{background:var(--bg-2);border:1px solid var(--success);border-radius:var(--radius);padding:10px 12px;font-size:12px;color:var(--success)}.compat-summary{display:flex;gap:12px;margin-bottom:8px;font-size:12px;font-weight:600}.compat-s-ok{color:var(--success)}.compat-s-warn{color:var(--warn)}.compat-s-err{color:var(--danger)}.compat-s-info{color:var(--accent)}.compat-error,.compat-warn,.compat-info{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:var(--radius);font-size:11px;margin-bottom:4px;flex-wrap:wrap}.compat-error{background:color-mix(in srgb,var(--danger) 9%,transparent);border:1px solid color-mix(in srgb,var(--danger) 25%,transparent)}.compat-warn{background:color-mix(in srgb,var(--warn) 9%,transparent);border:1px solid color-mix(in srgb,var(--warn) 25%,transparent)}.compat-info{background:color-mix(in srgb,var(--accent) 9%,transparent);border:1px solid color-mix(in srgb,var(--accent) 25%,transparent)}.compat-icon{font-size:14px;flex-shrink:0}.compat-pair{font-weight:700;font-size:10px;background:var(--bg-3);padding:2px 6px;border-radius:3px;white-space:nowrap}.compat-msg{flex:1;min-width:120px;line-height:1.5}.compat-fix{flex-shrink:0;font-size:10px!important;padding:2px 8px!important}.synergy-card{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:12px}.synergy-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.synergy-label{font-size:13px;font-weight:600}.synergy-score{font-size:28px;font-weight:700;padding:6px 14px;border-radius:8px}.synergy-bar{height:10px;background:var(--bg-4);border-radius:5px;overflow:hidden;margin-bottom:12px}.synergy-bar-fill{height:100%;border-radius:5px;transition:width .6s}.synergy-dims{display:flex;flex-direction:column;gap:6px;margin-bottom:8px}.synergy-dim{display:grid;grid-template-columns:110px 1fr 32px;align-items:center;gap:8px;font-size:11px}.synergy-dim-lbl{color:var(--text-2);text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.synergy-dim-bar{height:12px;background:var(--bg-4);border-radius:3px;overflow:hidden}.synergy-dim-fill{height:100%;border-radius:3px;transition:width .4s}.synergy-dim-val{font-weight:700;text-align:right}.synergy-domain{font-size:11px;color:var(--text-3);padding-top:8px;border-top:1px solid var(--border)}.synergy-domain strong{color:var(--accent)}.fdep-group{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:6px;overflow:hidden}.fdep-header{padding:8px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;font-size:12px;font-weight:600;user-select:none;transition:background .15s}.fdep-header:hover{background:var(--bg-4)}.fdep-icon{font-size:10px;width:12px;transition:transform .2s}.fdep-title{flex:1}.fdep-count{font-size:10px;color:var(--text-3);background:var(--bg-4);padding:2px 8px;border-radius:10px}.fdep-body{max-height:0;overflow:hidden;transition:max-height .3s ease}.fdep-body.fdep-open{max-height:500px;padding:8px 12px}.fdep-item{font-size:11px;padding:3px 0;display:flex;align-items:center;gap:4px}.fdep-ind-1{padding-left:16px}.fdep-ind-2{padding-left:32px}.fdep-exists a{color:var(--success);text-decoration:none}.fdep-exists a:hover{text-decoration:underline}.fdep-missing span{color:var(--text-3);opacity:.5}.guide-domain-steps{display:flex;flex-direction:column;gap:8px;margin:12px 0;background:var(--bg-3);padding:12px;border-radius:8px;border:1px solid var(--border)}.guide-step-mini{display:flex;align-items:center;gap:10px;font-size:12px;color:var(--text)}.guide-step-num-mini{width:24px;height:24px;min-width:24px;background:var(--accent);color:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:11px}.guide-ai-recipe{background:var(--bg-3);padding:12px;border-radius:8px;border:1px solid var(--border);margin:12px 0}.guide-ai-recipe h4{font-size:13px;margin-bottom:8px;color:var(--accent)}.guide-recipe-step{font-size:12px;padding:6px 0;color:var(--text-2);border-bottom:1px solid var(--border)}.guide-recipe-step:last-child{border-bottom:none}.guide-adr-intro{font-size:12px;color:var(--text-3);margin-bottom:8px}.guide-adrs{display:flex;flex-direction:column;gap:8px;margin:8px 0}.guide-adr{display:flex;gap:12px;background:var(--bg-3);padding:10px 12px;border-radius:8px;border:1px solid var(--border)}.guide-adr-icon{font-size:20px;min-width:28px}.guide-adr strong{font-size:12px;display:block;margin-bottom:2px;color:var(--text)}.guide-adr p{font-size:11px;color:var(--text-3);margin:0}.dash-backup{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 12px;border-radius:var(--radius);font-size:11px;margin-bottom:8px;flex-wrap:wrap}.dash-backup-red{background:color-mix(in srgb,var(--danger) 9%,transparent);border:1px solid color-mix(in srgb,var(--danger) 25%,transparent);color:var(--danger)}.dash-backup-yellow{background:color-mix(in srgb,var(--warn) 9%,transparent);border:1px solid color-mix(in srgb,var(--warn) 25%,transparent);color:var(--warn)}.dash-guide{background:var(--accent-soft);border:1px solid color-mix(in srgb,var(--accent) 25%,transparent);color:var(--accent)}.guide-action-p{margin-top:16px}.dash-info{font-size:12px}.dash-center{margin-top:16px;text-align:center}.dash-center .btn{font-size:11px}.fsize-chart{display:flex;flex-direction:column;gap:6px}.fsize-row{display:flex;align-items:center;gap:8px;font-size:11px}.fsize-lbl{min-width:90px;color:var(--text-3);white-space:nowrap;font-weight:600}.fsize-bar-wrap{flex:1;height:10px;background:var(--bg-3);border-radius:5px;overflow:hidden}.fsize-bar{height:100%;border-radius:5px;transition:width .4s}.fsize-val{min-width:50px;text-align:right;color:var(--text-3);font-size:10px}.dash-back{margin-top:8px;text-align:center}.dash-back .btn{font-size:11px}.dash-tfcount{font-size:11px;color:var(--text-3);align-self:center}.dash-tbl-wrap{max-height:60vh;overflow-y:auto}.dash-price{font-size:9px;color:var(--text-3)}.dash-empty{color:var(--text-3);text-align:center;margin-top:40px}.toast-msg{position:fixed;bottom:20px;left:50%;transform:translate(-50%);background:var(--bg-3);color:var(--text);padding:8px 20px;border-radius:20px;font-size:12px;z-index:999;border:1px solid var(--border)}.prev-footer{padding:12px 0;text-align:center;font-size:11px;color:var(--text-3);border-top:1px solid var(--border);margin-top:12px}.dash-total-mt{margin-top:8px}.launch-output{display:none}.tour-title{font-size:14px;margin-bottom:6px}.tour-desc{font-size:12px;color:var(--text-2);line-height:1.6}.tour-acts{display:flex;gap:6px;justify-content:flex-end;margin-top:8px}.gen-spinner{padding:16px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:10px}.gen-spinner-icon{display:inline-block;font-size:24px}.gen-prog-wrap{width:200px}.gen-prog-bar{height:6px;background:var(--bg-3);border-radius:3px;overflow:hidden}.gen-prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--success));border-radius:3px;transition:width .3s;width:0%}.gen-prog-label{font-size:11px;color:var(--text-2);margin-top:6px;font-weight:600}.complexity-label{font-weight:600}.complexity-sub{font-size:13px;margin-top:2px}.btn-start{padding:12px 40px;font-size:14px}.prev-placeholder{color:var(--text-3);font-size:13px;text-align:center;margin-top:40px}.btn-diff{color:var(--warn)}.tree-item{cursor:pointer}.tree-indent{padding-left:16px}.tree-disabled{opacity:.4}.tree-edited{float:right;font-size:9px;color:var(--warn);margin-right:4px}.tree-gen{float:right;font-size:10px;color:var(--success)}.launch-ok{color:var(--success)}.launch-warn{color:var(--warn)}.road-pct-sub{font-size:12px;font-weight:400;color:var(--text-3)}.road-layer-pct{font-size:10px;font-weight:400;opacity:.7}.road-actions{margin-top:12px;display:flex;gap:8px;justify-content:center}.road-actions .btn{font-size:11px}.exp-compare{display:grid;grid-template-columns:1fr 1fr;gap:12px}.exp-col{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:16px}.exp-col h3{font-size:14px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--border)}.exp-row{display:flex;justify-content:space-between;padding:4px 0;font-size:12px}.exp-row .label{color:var(--text-3)}.exp-row .val{font-weight:600}.exp-verdict{margin-top:12px;padding:12px;background:var(--accent-soft);border:1px solid rgba(59,130,246,.2);border-radius:var(--radius)}.exp-verdict h4{font-size:12px;color:var(--accent);margin-bottom:4px}.exp-verdict p{font-size:11px;color:var(--text-2)}.exp-select{display:flex;gap:8px;margin-bottom:12px}.exp-select select{flex:1;padding:8px 12px;border:1px solid var(--border);border-radius:7px;background:var(--bg-3);color:var(--text);font-size:12px;font-family:var(--sans)}.road-progress{background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:16px}.road-progress h4{font-size:12px;margin-bottom:8px}.road-progress-bar{height:12px;background:var(--bg-4);border-radius:6px;overflow:hidden}.road-progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--success));border-radius:6px;transition:width .6s}.road-pct{font-size:20px;font-weight:700;color:var(--accent);margin-top:4px}.road-layer{margin-bottom:20px}.road-layer h3{font-size:13px;color:var(--accent);margin-bottom:8px;padding:6px 10px;background:var(--accent-soft);border-radius:6px;display:inline-block}.road-task{display:flex;align-items:center;gap:8px;font-size:12px;cursor:pointer;transition:background .1s;border-radius:4px;padding:4px 8px}.road-task:hover{background:var(--bg-4)}.road-task input[type=checkbox]{accent-color:var(--accent);width:16px;height:16px;cursor:pointer}.road-task.checked{color:var(--text-3);text-decoration:line-through}.road-week-badge{font-size:9px;padding:2px 6px;background:var(--bg-4);border-radius:8px;color:var(--text-3);margin-left:auto;flex-shrink:0}.road-hrs-badge{font-size:9px;padding:2px 6px;background:var(--accent-soft);border-radius:8px;color:var(--accent);flex-shrink:0}.road-time{font-size:11px;color:var(--text-3);margin-top:6px}.road-time strong{color:var(--text)}.road-milestone{margin-top:8px;padding:6px 12px;background:linear-gradient(90deg,var(--accent-soft),transparent);border-radius:6px;font-size:12px;font-weight:600;color:var(--accent);animation:roadFadeIn .5s}@keyframes roadFadeIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.road-layer-head{cursor:pointer;user-select:none;display:flex!important;align-items:center;gap:4px;width:100%}.road-collapse-icon{font-size:10px;opacity:.6;width:12px;text-align:center}.road-layer-hrs{margin-left:auto;font-size:9px;font-weight:400;opacity:.6}.road-items{transition:max-height .3s ease,opacity .2s;overflow:hidden}.road-collapsed{max-height:0!important;opacity:0;margin:0;padding:0}.road-locked{opacity:.6}.road-lock-msg{font-size:10px;color:var(--text-3);padding:4px 12px;margin-bottom:8px;font-style:italic}.road-task-locked{pointer-events:none;opacity:.5}.road-task-locked input{pointer-events:none}.road-res-btn{font-size:12px;text-decoration:none;flex-shrink:0;opacity:.5;transition:opacity .15s;padding:0 2px}.road-res-btn:hover{opacity:1}.road-badge-anim{animation:roadBadge .6s ease;display:inline-block;margin-left:4px}@keyframes roadBadge{0%{transform:scale(0);opacity:0}50%{transform:scale(1.4)}to{transform:scale(1);opacity:1}}.hero-anim{position:relative;overflow:hidden;padding:20px;border-radius:var(--radius-lg)}.hero-anim:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from 0deg,transparent,var(--accent-soft),transparent);animation:spin 8s linear infinite;z-index:0}.hero-content{position:relative;z-index:1}.stat-row{display:flex;gap:24px;justify-content:center;flex-wrap:wrap}.stat-item{text-align:center}.stat-item .num{font-size:28px;font-weight:700;color:var(--accent)}.stat-item .lbl{font-size:11px;color:var(--text-3)}.version-badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;margin-bottom:12px}.kb-overlay{position:fixed;inset:0;background:#00000080;z-index:250;display:none;align-items:center;justify-content:center}.kb-overlay.show{display:flex}.kb-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:400px;width:90%}.kb-modal h3{font-size:16px;margin-bottom:16px}.kb-row{display:flex;justify-content:space-between;padding:6px 0;font-size:12px;color:var(--text-2);border-bottom:1px solid var(--border)}.kb-key{font-family:var(--mono);padding:2px 8px;background:var(--bg-3);border:1px solid var(--border);border-radius:4px;font-size:11px}.skill-sel{display:flex;gap:10px;margin-bottom:28px;flex-wrap:wrap;justify-content:center}.skcard{width:185px;padding:18px 14px;border-radius:var(--radius-lg);border:2px solid var(--border);background:var(--bg-2);cursor:pointer;transition:all .2s;text-align:left}.skcard:hover{border-color:var(--border-light);background:var(--bg-3)}.skcard.on{border-color:var(--accent);background:var(--accent-soft)}.skcard .em{font-size:26px;margin-bottom:8px}.skcard h4{font-size:13px;font-weight:600;margin-bottom:3px}.skcard p{font-size:11px;color:var(--text-3);line-height:1.5}.szl{font-size:11px;color:var(--text-3);margin-bottom:8px;text-align:center;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.chip{padding:6px 12px;border-radius:18px;font-size:12px;border:1.5px solid var(--chip-border,var(--border));background:var(--chip-bg,var(--bg-3));cursor:pointer;transition:all .12s;color:var(--text-2);user-select:none;display:flex;align-items:center;gap:5px}.chip:hover{border-color:var(--accent);color:var(--text)}.chip.on{border-color:var(--accent);background:var(--accent-soft);color:var(--accent);font-weight:500}.chip .ck{width:13px;height:13px;border-radius:3px;border:1.5px solid var(--text-3);display:flex;align-items:center;justify-content:center;font-size:9px;transition:all .12s}.chip.on .ck{border-color:var(--accent);background:var(--accent);color:#fff}.czone{padding:10px 20px}.czlabel{font-size:11px;color:var(--text-3);margin-bottom:8px;font-weight:500}.cgrid{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}.cfoot{padding:6px 20px 12px;display:flex;gap:6px;align-items:center}.cfoot input.cadd{flex:1;padding:8px 14px;border-radius:20px;border:1.5px solid var(--border);background:var(--bg-3);color:var(--text);font-size:12px;outline:none}.cfoot input.cadd:focus{border-color:var(--accent)}.ocards{padding:10px 20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}.ocard{padding:14px;border-radius:var(--radius);border:1.5px solid var(--border);background:var(--bg-3);cursor:pointer;transition:all .15s}.ocard:hover{border-color:var(--accent);background:var(--accent-soft)}.ocard h5{font-size:13px;font-weight:600;margin-bottom:3px}.ocard p{font-size:11px;color:var(--text-3);line-height:1.4}.m-edit{position:absolute;top:4px;right:4px;background:none;border:none;color:var(--text-3);cursor:pointer;font-size:13px;padding:2px 5px;border-radius:4px;opacity:0;transition:.15s}.msg:hover .m-edit{opacity:1}.m-edit:hover{color:var(--warn);background:var(--warn-soft)}.q-help{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:var(--accent-soft);color:var(--accent);font-size:10px;font-weight:700;cursor:pointer;margin-left:6px;transition:.15s}.q-help:hover{background:var(--accent);color:#fff}.voice-btn{background:none;border:1px solid var(--border);border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;color:var(--text-3);transition:.15s;flex-shrink:0}.voice-btn:hover{border-color:var(--accent);color:var(--accent)}.voice-btn.recording{border-color:var(--danger);color:var(--danger);animation:pulse 1s infinite}@keyframes pulse{0%,to{opacity:1}50%{opacity:.4}}.skip-btn{background:none;border:none;color:var(--text-3);font-size:11px;cursor:pointer;padding:4px 10px;border-radius:12px;transition:.15s}.skip-btn:hover{background:var(--bg-3);color:var(--text-2)}.dnd-list{list-style:none;padding:0;margin:0 0 8px}.dnd-item{display:flex;align-items:center;gap:8px;padding:8px 12px;margin:3px 0;border-radius:7px;border:1.5px solid var(--border);background:var(--bg-3);cursor:grab;transition:all .12s;user-select:none;font-size:12px;color:var(--text)}.dnd-item:active{cursor:grabbing;background:var(--bg-4);border-color:var(--accent);box-shadow:0 4px 12px #0000004d}.dnd-grip{color:var(--text-3);font-size:14px;cursor:grab}.dnd-label{flex:1}.dnd-priority{font-size:10px;font-weight:600;padding:2px 8px;border-radius:10px}.dnd-priority.p0{background:#ef444426;color:var(--danger)}.dnd-priority.p1{background:#eab30826;color:var(--warn)}.dnd-priority.p2{background:#64748b26;color:var(--text-3)}.drag-over{border-color:var(--accent);background:var(--accent-soft)}.confirm-overlay{position:fixed;inset:0;background:#0009;z-index:350;display:none;align-items:center;justify-content:center;animation:fadeIn .2s}.confirm-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:420px;width:90%}.confirm-modal h4{font-size:14px;font-weight:600;margin-bottom:12px}.confirm-modal .cm-val{background:var(--bg-4);padding:10px 14px;border-radius:var(--radius);font-size:12px;color:var(--text);margin-bottom:16px;max-height:120px;overflow-y:auto;line-height:1.6}.confirm-modal .cm-acts{display:flex;gap:8px;justify-content:flex-end}.complexity-card{margin:12px 0;padding:16px;border-radius:var(--radius-lg);background:var(--bg-3);border:1px solid var(--border);animation:fadeIn .3s}.complexity-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.complexity-score{font-size:32px;font-weight:700}.complexity-score.low{color:var(--success)}.complexity-score.mid{color:var(--warn)}.complexity-score.high{color:var(--danger)}.complexity-bar{height:6px;border-radius:3px;background:var(--bg-4);margin-bottom:12px;overflow:hidden}.complexity-fill{height:100%;border-radius:3px;transition:width .6s ease}.complexity-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}.complexity-item{display:flex;justify-content:space-between;font-size:12px;padding:4px 0;border-bottom:1px solid var(--border)}.pm-overlay{position:fixed;inset:0;background:#0009;z-index:350;display:none;align-items:center;justify-content:center;animation:fadeIn .2s}.pm-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto}.pm-modal h3{font-size:16px;font-weight:700;margin-bottom:16px}.pm-item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:var(--radius);border:1px solid var(--border);margin-bottom:6px;cursor:pointer;transition:.15s}.pm-item:hover,.pm-item.current{border-color:var(--accent);background:var(--accent-soft)}.pm-item-name{font-size:13px;font-weight:500}.pm-item-meta{font-size:10px;color:var(--text-3)}.pm-item-acts{display:flex;gap:4px}.pm-item-acts button{background:none;border:none;cursor:pointer;font-size:12px;padding:2px 4px}.pm-actions{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}.toc-panel{display:none;padding:6px 8px;overflow-x:auto;white-space:nowrap;border-bottom:1px solid var(--border);background:var(--bg-2)}.toc-item{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:4px;cursor:pointer;font-size:10px;color:var(--text-3);transition:.15s;margin-right:2px}.toc-item:hover{background:var(--accent-soft);color:var(--accent)}.toc-item.done{color:var(--success)}.toc-item.active{color:var(--accent);font-weight:600}.toc-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0;background:var(--border-light)}.toc-item.done .toc-dot{background:var(--success)}.toc-item.active .toc-dot{background:var(--accent)}.edit-banner{padding:8px 20px;background:var(--warn-soft,rgba(234,179,8,.1));color:var(--warn);font-size:11px;font-weight:600;display:flex;align-items:center;justify-content:space-between}.skipped-banner{padding:8px 20px;background:var(--accent-soft);color:var(--accent);font-size:11px;font-weight:600}.tour-container{position:fixed;bottom:20px;left:50%;transform:translate(-50%);z-index:400;max-width:440px;width:92%}.tour-card{background:var(--bg-2);border:2px solid var(--accent);border-radius:var(--radius-lg);padding:20px;box-shadow:0 8px 30px #0006}.tour-dots{display:flex;gap:6px;justify-content:center;margin:10px 0}.tour-dot{width:8px;height:8px;border-radius:50%;background:var(--border)}.tour-dot.on{background:var(--accent)}[data-theme=light] .skcard{background:var(--bg-2);border-color:var(--border)}[data-theme=light] .m-bot{background:var(--bg-3);border-color:var(--border)}[data-theme=light] .m-usr{background:#3b82f614;border-color:#3b82f633}[data-theme=light] .m-tip{color:var(--text-3)}[data-theme=light] .skcard:hover{background:var(--bg-3);border-color:var(--text-3)}[data-theme=light] .skcard.on{background:#3b82f60f;border-color:var(--accent)}[data-theme=light] .complexity-card{background:var(--bg-3);border-color:var(--border)}[data-theme=light] .dnd-item,[data-theme=light] .confirm-modal,[data-theme=light] .pm-modal,[data-theme=light] .tour-card{background:var(--bg-2);border-color:var(--border)}[data-theme=light] .voice-btn{border-color:var(--border);color:var(--text-3)}[data-theme=light] .pm-item{border-color:var(--border)}[data-theme=light] .pm-item:hover{background:#3b82f60a}@keyframes fadeIn{0%{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}.msg{margin-bottom:12px;animation:fadeIn .25s ease}.m-bot{background:var(--bg-3);padding:12px 14px;border-radius:3px var(--radius) var(--radius) var(--radius);border-left:3px solid var(--accent)}.m-usr{background:var(--surface,var(--bg-4));padding:12px 14px;border-radius:var(--radius) 3px var(--radius) var(--radius);margin-left:32px;border-right:3px solid var(--accent-2,#8b5cf6);position:relative}.m-tip{background:var(--warn-soft,rgba(234,179,8,.1));padding:8px 12px;border-radius:var(--radius);border-left:3px solid var(--warn);font-size:12px;color:var(--warn)}.m-lbl{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:.8px;margin-bottom:5px;color:var(--text-3);display:flex;align-items:center;gap:4px}.m-body{font-size:13px;line-height:1.7}.pill-drawer{position:fixed;left:0;top:50%;transform:translateY(-50%);z-index:900;display:flex;align-items:center}.pill-drawer-tab{width:16px;min-height:80px;background:var(--accent);border-radius:0 8px 8px 0;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .3s;writing-mode:vertical-rl;font-size:9px;color:#fff;font-weight:700;letter-spacing:1px;padding:8px 2px}.pill-drawer-tab:hover{opacity:1;width:20px}.pill-drawer-body{position:absolute;left:0;top:50%;transform:translateY(-50%);background:var(--bg-2);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:0 12px 12px 0;padding:12px 14px;min-width:220px;max-height:80vh;overflow-y:auto;box-shadow:0 4px 24px #00000026;opacity:0;pointer-events:none;transition:all .25s ease}.pill-drawer:hover .pill-drawer-body{opacity:1;pointer-events:auto;left:16px}.pill-drawer:hover .pill-drawer-tab{opacity:0;pointer-events:none}.pd-title{font-size:10px;font-weight:700;color:var(--text-3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}.pd-phase{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:8px;margin-bottom:4px;cursor:pointer;transition:all .15s;font-size:12px;font-weight:600;color:var(--text-2)}.pd-phase:hover{background:var(--accent-soft)}.pd-phase.active{background:var(--accent-soft);color:var(--accent)}.pd-phase.done{color:var(--success)}.pd-dot{width:8px;height:8px;border-radius:50%;background:var(--border-light);flex-shrink:0;transition:.2s}.pd-phase.active .pd-dot{background:var(--accent);box-shadow:0 0 6px var(--accent)}.pd-phase.done .pd-dot{background:var(--success)}.pd-progress{margin-top:8px;padding-top:8px;border-top:1px solid var(--border);font-size:10px;color:var(--text-3);display:flex;align-items:center;gap:6px}.pd-bar{flex:1;height:4px;background:var(--bg-3);border-radius:2px;overflow:hidden}.pd-bar-fill{height:100%;background:var(--accent);border-radius:2px;transition:width .3s}.pd-gen{margin-top:10px;width:100%;font-size:11px;padding:6px 0}.pd-qlist{margin:0;padding:0 0 0 16px;list-style:none}.pd-q{padding:3px 4px;font-size:10px;color:var(--text-3);cursor:pointer;border-radius:4px;transition:all .15s;display:flex;align-items:center;gap:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.pd-q:hover{background:var(--bg-3);color:var(--text)}.pd-q.current{color:var(--accent);font-weight:600}.pd-q .pd-qmark{width:6px;height:6px;border-radius:50%;flex-shrink:0}.pd-q.answered .pd-qmark{background:var(--success)}.pd-q:not(.answered) .pd-qmark{background:var(--border-light)}.pd-q.current .pd-qmark{background:var(--accent);box-shadow:0 0 4px var(--accent)}.pd-q.q-na{opacity:.3;pointer-events:none;text-decoration:line-through}.gen-lang-overlay{position:fixed;inset:0;background:#0009;z-index:1100;display:flex;align-items:center;justify-content:center;animation:fadeIn .2s}.gen-lang-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;max-width:360px;width:90%;text-align:center}.gen-lang-modal h3{margin-bottom:8px;font-size:16px}.gen-lang-modal p{font-size:12px;color:var(--text-3);margin-bottom:16px}.gen-lang-btns{display:flex;gap:10px;justify-content:center}.gen-lang-btn{flex:1;padding:14px 12px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-3);cursor:pointer;transition:all .15s;font-size:13px;font-weight:600;color:var(--text)}.gen-lang-btn:hover{border-color:var(--accent);background:var(--accent-soft)}.gen-lang-btn .flag{font-size:24px;display:block;margin-bottom:6px}.flex-end{display:flex;gap:6px;justify-content:flex-end}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.skip-link{position:absolute;top:-40px;left:0;background:var(--accent);color:#fff;padding:8px 16px;z-index:9999;font-size:14px;border-radius:0 0 var(--radius) 0;transition:top .2s}.skip-link:focus{top:0}*:focus-visible{outline:2px solid var(--accent);outline-offset:2px;border-radius:2px}.skcard:focus-visible{outline:2px solid var(--accent);outline-offset:2px}[role=dialog]:focus{outline:none}.prev-path{font-size:11px;color:var(--text-3)}.prev-toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.prev-toolbar-r{display:flex;gap:4px}.prev-nav-btn{min-width:28px;padding:2px 6px}.prev-nav-btn.disabled{opacity:.3;pointer-events:none}.view-nav{display:flex;gap:2px}.view-nav-btn{min-width:26px;padding:2px 5px;font-size:11px}.view-nav-btn.disabled{opacity:.25;pointer-events:none}.empty-preview{color:var(--text-3);font-size:13px;text-align:center;margin-top:40px}.empty-preview-sm{color:var(--text-3);font-size:12px;text-align:center;margin-top:40px}.ft-separator{color:var(--border);font-size:10px;padding:6px 0}.road-summary{margin-top:12px;padding:12px;background:var(--bg-3);border-radius:var(--radius);font-size:12px;text-align:center}.exp-header{margin-bottom:12px}.exp-header h3{font-size:14px;margin-bottom:4px}.exp-header p{font-size:11px;color:var(--text-3)}.exp-ranking{margin:12px 0;padding:12px;background:var(--bg-3);border-radius:var(--radius);border:1px solid var(--border)}.exp-ranking h4{font-size:12px;margin-bottom:10px;color:var(--accent)}.exp-rank-row{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;border-radius:4px;cursor:pointer;transition:background .15s}.exp-rank-row:hover{background:var(--bg-2)}.exp-rank-top{background:var(--bg-2);border:1px solid var(--accent);border-radius:6px}.exp-rank-left{display:flex;align-items:center;gap:8px;min-width:200px}.exp-rank-medal{font-size:14px;min-width:28px;text-align:center}.exp-rank-name{font-size:12px;font-weight:500}.exp-rank-right{display:flex;align-items:center;gap:8px;flex:1;max-width:200px}.exp-rank-bar{flex:1;height:6px;background:var(--bg-1);border-radius:3px;overflow:hidden}.exp-rank-bar-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .3s}.exp-rank-score{font-size:11px;font-weight:600;color:var(--accent);min-width:36px;text-align:right}.exp-rank-reasons{display:flex;flex-wrap:wrap;gap:4px;margin:2px 0 6px 36px}.exp-rank-tag{font-size:10px;padding:1px 6px;background:var(--accent);color:#fff;border-radius:10px;opacity:.8}.exp-metrics-sep{margin-top:10px;border-top:1px solid var(--border);padding-top:8px}.launch-stats{display:flex;gap:12px;margin:12px 0}.launch-stat{flex:1;text-align:center;padding:10px;background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius)}.launch-num{font-size:20px;font-weight:700;color:var(--accent);display:block}.launch-lbl{font-size:10px;color:var(--text-3)}.launch-folders{margin:12px 0;padding:12px;background:var(--bg-3);border-radius:var(--radius);border:1px solid var(--border)}.launch-folders h4{font-size:12px;margin-bottom:8px}.launch-folder-row{display:flex;align-items:center;gap:8px;padding:4px 0;font-size:11px}.launch-folder-row label{display:flex;align-items:center;gap:4px;min-width:120px}.launch-folder-row span{flex:1;text-align:right;color:var(--text-3);font-size:10px;min-width:140px}.launch-bar{flex:1;height:4px;background:var(--bg-1);border-radius:2px;max-width:80px}.launch-bar-fill{height:100%;background:var(--accent);border-radius:2px}.launch-models{margin:8px 0;padding:10px;background:var(--bg-3);border-radius:var(--radius);border:1px solid var(--border)}.launch-models h4{font-size:12px;margin-bottom:6px}.launch-model-row{font-size:11px;padding:3px 0;display:flex;justify-content:space-between}.launch-model-pct{font-weight:600;font-size:10px}.launch-templates{margin:12px 0}.launch-templates h4{font-size:12px;margin-bottom:8px}.launch-tpl{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:6px;cursor:pointer;transition:border-color .15s,background .15s}.launch-tpl:hover{border-color:var(--accent);background:var(--bg-2)}.launch-tpl-icon{font-size:22px;min-width:30px;text-align:center}.launch-tpl-info{display:flex;flex-direction:column;gap:2px}.launch-tpl-info strong{font-size:12px}.launch-tpl-info span{font-size:10px;color:var(--text-3)}.launch-output{margin:12px 0;border:1px solid var(--accent);border-radius:var(--radius);overflow:hidden}.launch-output-head{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--accent);color:#fff}.launch-output-head h4{margin:0;font-size:13px}.launch-output-meta{padding:6px 12px;font-size:10px;color:var(--text-3);background:var(--bg-3);border-bottom:1px solid var(--border)}.launch-output-pre{padding:12px;font-size:11px;max-height:300px;overflow:auto;white-space:pre-wrap;word-break:break-word;background:var(--bg-1);margin:0}.diff-header{padding:8px 12px;border-bottom:1px solid var(--border);background:var(--bg-3);display:flex;justify-content:space-between;align-items:center}.diff-title{font-size:12px;font-weight:600}.diff-stats{font-size:11px;color:var(--text-3)}.diff-stats .add{color:var(--success)}.diff-stats .del{color:var(--danger)}.diff-stats .btn{font-size:10px;margin-left:8px}.diff-body{font-family:monospace;font-size:11px;line-height:1.6;padding:8px;overflow-y:auto;max-height:calc(100vh - 200px)}.diff-same{padding:1px 8px;color:var(--text-3)}.diff-add{padding:1px 8px;background:color-mix(in srgb,var(--success) 9%,transparent);color:var(--success)}.diff-del{padding:1px 8px;background:color-mix(in srgb,var(--danger) 9%,transparent);color:var(--danger);text-decoration:line-through}.diff-ln{display:inline-block;width:35px;text-align:right;margin-right:8px}.diff-same .diff-ln{opacity:.5}.editor-toolbar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-bottom:1px solid var(--border);background:var(--bg-3)}.editor-toolbar .title{font-size:12px;font-weight:600}.editor-toolbar .actions{display:flex;gap:6px}.editor-toolbar .btn{font-size:11px}.editor-area{width:100%;height:calc(100% - 42px);border:none;outline:none;resize:none;background:var(--bg-1);color:var(--text);font-family:Fira Code,monospace;font-size:12px;line-height:1.6;padding:12px;tab-size:2;box-sizing:border-box}.exp-dim{opacity:.2}.exp-current{color:var(--accent)}.exp-select h4{margin:0}.exp-win{color:var(--success)}.exp-tie{color:var(--warn)}.guide-overlay{position:fixed;inset:0;background:#000000a6;z-index:250;display:flex;align-items:center;justify-content:center;animation:fadeIn .3s}.guide-modal{background:var(--bg-2);border:1px solid var(--border);border-radius:16px;padding:28px;max-width:520px;width:92%;max-height:85vh;overflow-y:auto;box-shadow:0 24px 64px #00000059}.guide-header{display:flex;align-items:center;gap:14px;margin-bottom:16px;position:relative}.guide-em{font-size:36px}.guide-title{font-size:18px;font-weight:800;letter-spacing:-.02em}.guide-sub{font-size:12px;font-weight:600}div.guide-sub.guide-lv-b{background:none;color:var(--success)}div.guide-sub.guide-lv-i{background:none;color:var(--warn)}div.guide-sub.guide-lv-p{background:none;color:var(--danger)}.guide-close{position:absolute;top:0;right:0;background:none;border:none;color:var(--text-3);font-size:18px;cursor:pointer;padding:4px 8px;border-radius:6px}.guide-close:hover{background:var(--bg-3);color:var(--text)}.guide-badge{font-size:11px;color:var(--accent);background:var(--accent-soft);padding:6px 14px;border-radius:20px;text-align:center;margin-bottom:20px;font-weight:600;letter-spacing:.02em}.guide-steps{display:flex;flex-direction:column;gap:14px;margin-bottom:20px}.guide-step{display:flex;gap:14px;padding:14px;background:var(--bg-3);border:1px solid var(--border);border-radius:12px}.guide-step-num{width:32px;height:32px;min-width:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px}.guide-step-title{font-size:13px;font-weight:700;margin-bottom:4px}.guide-step-desc{font-size:12px;color:var(--text-2);line-height:1.7}.guide-step-desc code{font-family:var(--mono);font-size:11px;background:var(--bg);padding:1px 5px;border-radius:4px;color:var(--accent-2)}.guide-actions{display:flex;gap:10px;justify-content:flex-end}.guide-prog{display:flex;align-items:center;gap:8px;margin-bottom:14px}.guide-prog-bar{flex:1;height:6px;background:var(--bg-3);border-radius:3px;overflow:hidden}.guide-prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--success));border-radius:3px;transition:width .4s}.guide-prog-txt{font-size:11px;font-weight:700;color:var(--accent);min-width:28px;text-align:right}.guide-ck{display:flex;align-items:center;flex-shrink:0;cursor:pointer}.guide-ck input{display:none}.guide-ckbox{width:20px;height:20px;min-width:20px;border-radius:5px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;transition:all .15s}.guide-step-done .guide-ckbox{background:var(--success);border-color:var(--success)}.guide-step-done .guide-step-title{text-decoration:line-through;opacity:.6}.guide-step-done .guide-step-desc{opacity:.5}.guide-lv-b{background:#34d3991f;color:var(--success)}.guide-lv-i{background:#fbbf241f;color:var(--warn)}.guide-lv-p{background:#fb71851f;color:var(--danger)}@media print{:root{--bg:#fff;--bg-2:#fff;--bg-3:#f5f5f5;--bg-4:#eee;--text:#111;--text-2:#333;--text-3:#666;--border:#ccc;--accent:#2563eb;--success:#059669;--warn:#d97706;--danger:#dc2626}body{background:#fff;color:#111;font-size:11pt}.topbar,.pstrip,.mobtabs,.pill-drawer,.tour-container,.guide-overlay,.help-overlay,.kb-overlay,.pm-overlay,.confirm-overlay,.toast-msg,.btn,.export-grid,.izone,.toc-panel,.edit-banner,.skipped-banner{display:none!important}.panel-c,.panel-p{width:100%;border:none;overflow:visible}.ws{flex-direction:column;overflow:visible}.prev-body pre{border:1px solid #ccc;background:#f9f9f9;page-break-inside:avoid}.md-rendered h1,.md-rendered h2,.md-rendered h3{page-break-after:avoid}.md-rendered table{page-break-inside:avoid}a{color:#2563eb;text-decoration:underline}.prev-head{background:#fff;border-bottom:2px solid #111}}.audit-results{background:var(--bg-s);border:1px solid var(--bd);border-radius:var(--radius);padding:12px;margin-top:8px}.audit-results h4{margin:0 0 8px;font-size:13px;color:var(--fg)}.audit-summary-err,.audit-summary-warn,.audit-summary-info{display:inline-block;font-size:11px;padding:2px 8px;border-radius:10px;margin-right:6px;margin-bottom:6px}.audit-summary-err{background:color-mix(in srgb,var(--danger) 12%,transparent);color:var(--danger)}.audit-summary-warn{background:color-mix(in srgb,var(--warn) 12%,transparent);color:var(--warn-text,#b45309)}.audit-summary-info{background:color-mix(in srgb,var(--accent) 12%,transparent);color:var(--accent)}.prchip-custom{border-style:dashed;opacity:.8}.prchip-custom.sel{opacity:1;border-color:var(--accent);background:var(--bg-2)}.techdb-overlay{position:fixed;inset:0;background:#0009;z-index:9999;display:flex;align-items:center;justify-content:center}.techdb-modal{background:var(--bg-1);border-radius:12px;width:min(90vw,700px);max-height:80vh;display:flex;flex-direction:column;box-shadow:0 8px 32px #0000004d}.techdb-hd{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}.techdb-hd h3{margin:0;flex:1}.techdb-search{padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--bg-2);color:var(--text);width:180px}.techdb-body{display:flex;flex:1;overflow:hidden;min-height:300px}.techdb-cats{width:160px;overflow-y:auto;border-right:1px solid var(--border);padding:8px}.techdb-cat{padding:6px 10px;border-radius:6px;cursor:pointer;font-size:.85em;margin-bottom:2px}.techdb-cat:hover,.techdb-cat.sel{background:var(--accent);color:#fff}.techdb-items{flex:1;overflow-y:auto;padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px;align-content:start}.techdb-item{padding:8px 12px;border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .15s}.techdb-item:hover{border-color:var(--accent);background:var(--bg-2)}.techdb-item b{display:block;margin-bottom:4px}.techdb-req,.techdb-price{font-size:.75em;opacity:.7;margin-right:8px}.btn-tech-browse{margin-top:8px;opacity:.7}.btn-tech-browse:hover{opacity:1}

</style>
</head>
<body>
<a href="#cbody" class="skip-link">Skip to content</a>
<div class="app" id="app">
  <!-- Topbar -->
  <header class="topbar" role="banner">
    <div class="topbar-left">
      <div class="topbar-brand">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
        <span>DevForge <small>v9</small></span>
      </div>

    </div>
    <div class="topbar-right">
      <button class="theme-btn" onclick="toggleLang()" title="EN/JA" aria-label="Toggle language" id="langBtn">🌐</button>
      <button class="theme-btn" onclick="toggleTheme()" title="Theme" aria-label="Toggle theme" id="themeBtn">🌙</button>
      <button class="theme-btn" onclick="showManual()" title="Help" id="helpBtn">❓</button>
      <button class="theme-btn" onclick="showKB()" title="Shortcuts" id="kbBtn">⌨️</button>
      <button class="theme-btn" onclick="showPM()" title="Projects" id="pmBtn">📁</button>
    </div>
  </header>
  <div class="pstrip"><div class="pstrip-fill" id="pbar" style="width:0%"></div></div>

  <!-- Left Hover Navigation Drawer -->
  <nav class="pill-drawer" role="navigation" aria-label="Progress" id="pillDrawer">
    <div class="pill-drawer-tab">PHASE</div>
    <div class="pill-drawer-body">
      <div class="pd-title" id="pdTitle">Progress</div>
      <div id="pills"></div>
      <div class="pd-progress"><div class="pd-bar"><div class="pd-bar-fill" id="pdBar" style="width:0%"></div></div><span id="pdPct">0%</span></div>
      <button class="btn btn-p pd-gen" id="pdGenBtn" onclick="generateAll()">🚀 生成</button>
    </div>
  </nav>


  <!-- Onboarding -->
  <div class="onboard" id="onboard" role="region" aria-label="Onboarding">
    <div class="hero-anim">
      <div class="hero-content">
        <div class="version-badge">v9.0 — 2026 Edition</div>
        <h1 id="heroTitle">DevForge v9</h1>
        <p id="heroDesc">質問に答えるだけで、88+ファイルの開発ドキュメント・環境設定・AIルール・学習ロードマップを自動生成。11の柱でAI駆動開発をゼロから完全サポート。</p>
      </div>
    </div>
    <div class="stat-row">
      <div class="stat-item"><div class="num" id="statFileNum">88+</div><div class="lbl" id="statFiles">生成ファイル</div></div>
      <div class="stat-item"><div class="num" id="statTechNum"></div><div class="lbl" id="statTech">技術エントリ</div></div>
      <div class="stat-item"><div class="num">11</div><div class="lbl" id="statPillars">柱 (Pillars)</div></div>
      <div class="stat-item"><div class="num">10</div><div class="lbl" id="statAI">AIツール対応</div></div>
    </div>
    <div class="info-grid">
      <div class="icard"><h4>📝 88+ファイル生成</h4><p>SDD仕様書・Docker・MCP・AIルール10種・ロードマップ9種・仕様書40種</p></div>
      <div class="icard"><h4>🧪 11の柱</h4><p>SDD・DevContainer・MCP・AIルール・並列探索・Dashboard・ロードマップ・AIランチャー・デザインシステム・リバースEng・実装ガイド</p></div>
      <div class="icard"><h4>📱 モバイル対応</h4><p>Expo / React Native 開発パス・EAS Build・OTA更新</p></div>
      <div class="icard"><h4>🤖 AI自律開発</h4><p>Vibe Coding・マルチAgent・Claude Code Subagents</p></div>
      <div class="icard"><h4>💳 決済・CMS・EC</h4><p>Stripe・microCMS・Medusa・Shopify Hydrogen</p></div>
      <div class="icard"><h4>📦 フルエクスポート</h4><p>ZIP・PDF・全ファイル結合コピー・URLシェア</p></div>
    </div>
    <div class="pillars-badge">
      <span class="pbadge">①SDD統合</span><span class="pbadge">②DevContainer</span><span class="pbadge">③MCP設定</span>
      <span class="pbadge">④AIルール</span><span class="pbadge">⑤並列探索</span><span class="pbadge">⑥Dashboard</span><span class="pbadge">⑦ロードマップ</span><span class="pbadge">⑧AIランチャー</span><span class="pbadge">⑨デザインシステム</span><span class="pbadge">⑩リバースEng</span><span class="pbadge">⑪実装ガイド</span>
    </div>
    <div class="start-zone">
      <div class="szl" id="skillAsk">Select your skill level</div>
      <div class="skill-sel" id="skillSel" role="radiogroup" aria-label="Skill level">
        <div class="skcard" data-lv="beginner" onclick="pickSkill('beginner')" role="radio" aria-checked="false" tabindex="0"><div class="em">🌱</div><h4 class="sk-title">Beginner</h4><p class="sk-desc">初めてのWeb開発。最適な選択肢をガイドします</p></div>
        <div class="skcard on" data-lv="intermediate" onclick="pickSkill('intermediate')" role="radio" aria-checked="true" tabindex="0"><div class="em">⚡</div><h4 class="sk-title">Intermediate</h4><p class="sk-desc">1年以上の経験。Svelte, DDD等の中級オプション解放</p></div>
        <div class="skcard" data-lv="pro" onclick="pickSkill('pro')" role="radio" aria-checked="false" tabindex="0"><div class="em">🔥</div><h4 class="sk-title">Professional</h4><p class="sk-desc">全オプション解放。MDD, RBAC, SSO等＋確認ダイアログ付き</p></div>
      </div>
      <input class="nameIn" id="nameIn" placeholder="" aria-label="Project name">
      <div class="preset-row" id="presetRow"></div>
      <button class="btn btn-g btn-xs" onclick="showPresetCompare()" style="margin-bottom:8px" id="compareBtn">⚔️ <span id="compareLbl">テンプレート比較</span></button>
      <button class="btn btn-p btn-start" onclick="start()" id="startBtn">🚀 開始する</button>
    </div>
    <div class="app-footer">© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん</div>
  </div>

  <!-- Workspace -->
  <main id="ws" role="main" aria-label="Workspace" style="display:none;">
    <div class="toc-panel" id="tocPanel" role="navigation" aria-label="Table of contents"></div>
    <div class="mobtabs" role="tablist" aria-label="View switch"><div class="mobtab on" onclick="mobSw('c')" role="tab" aria-selected="true">💬 チャット</div><div class="mobtab" onclick="mobSw('p')" role="tab" aria-selected="false">📄 プレビュー</div></div>
    <div class="ws">
      <div class="panel-c" id="panC">
        <div class="cbody" id="cbody" role="log" aria-live="polite" aria-label="Conversation"></div>
        <div class="izone" id="izone" role="form" aria-label="Answer input"></div>
      </div>
      <div class="panel-p" id="panP" role="complementary" aria-label="Preview panel">
        <div class="prev-head">
          <h3 id="panPTitle">📁 生成ファイル</h3>
          <div class="view-nav" id="viewNav"><button class="btn btn-xs btn-s view-nav-btn disabled" id="viewBackBtn" onclick="viewBack()" title="前の画面" aria-label="Previous screen">⏮</button><button class="btn btn-xs btn-s view-nav-btn disabled" id="viewFwdBtn" onclick="viewForward()" title="次の画面" aria-label="Next screen">⏭</button></div>
          <div class="prev-tabs" id="prevTabs" role="tablist" aria-label="Preview tabs"></div>
        </div>
        <div class="pillar-tabs" id="pillarTabs" role="tablist" aria-label="Pillar tabs"></div>
        <div class="prev-body" id="prevBody" aria-live="polite"><p class="prev-placeholder">質問に回答するとリアルタイムでプレビューが更新されます</p></div>
      </div>
    </div>
  </main>

  <!-- Help Overlay -->
  <div class="help-overlay" id="helpOverlay" role="dialog" aria-modal="true" aria-label="Help manual" onclick="if(event.target===this)closeManual()">
    <div class="help-modal" role="document">
      <div class="help-nav" id="helpNav" role="navigation" aria-label="Help navigation">
        <input id="helpSearch" class="help-search" placeholder="🔍" oninput="filterManual(this.value)" aria-label="Search help">
      </div>
      <div class="help-body" id="helpBody"></div>
    </div>
  </div>

  <!-- Keyboard Shortcut Overlay -->
  <div class="kb-overlay" id="kbOverlay" role="dialog" aria-modal="true" aria-label="Keyboard shortcuts" onclick="if(event.target===this)closeKB()">
    <div class="kb-modal" role="document">
      <h3 id="kbTitle">⌨️ ショートカット</h3>
      <div class="kb-row"><span class="kblbl">ヘルプ・マニュアル</span><span class="kb-key">F1 / Ctrl+H</span></div>
      <div class="kb-row"><span class="kblbl">ショートカット一覧</span><span class="kb-key">Ctrl+K</span></div>
      <div class="kb-row"><span class="kblbl">テーマ切替</span><span class="kb-key">Ctrl+T</span></div>
      <div class="kb-row"><span class="kblbl">言語切替</span><span class="kb-key">Ctrl+L</span></div>
      <div class="kb-row"><span class="kblbl">エクスポート</span><span class="kb-key">Ctrl+E</span></div>
      <div class="kb-row"><span class="kblbl">全ファイルコピー</span><span class="kb-key">Ctrl+Shift+C</span></div>
      <div class="kb-row"><span class="kblbl">プロジェクト管理</span><span class="kb-key">Ctrl+M</span></div>
    </div>
  </div>
  <!-- Help Popup (per-question) -->
  <div id="helpPopup" role="tooltip" aria-live="polite" style="display:none;"></div>
  <!-- Confirm Overlay (Pro mode) -->
  <div class="confirm-overlay" id="confirmOverlay" role="alertdialog" aria-modal="true" aria-label="Confirmation"></div>
  <!-- Project Manager Overlay -->
  <div class="pm-overlay" id="pmOverlay" role="dialog" aria-modal="true" aria-label="Project manager" onclick="if(event.target===this)closePM()"></div>
  <!-- Tour Container -->
  <div class="tour-container" id="tourContainer" role="complementary" aria-label="Guided tour"></div>
</div>
<script>
/* ═══ GLOBAL STATE ═══ */
const $=id=>document.getElementById(id);
const KEY='devforge-v9';
const V=9;
let S={phase:0,step:0,answers:{},projectName:'',skill:'intermediate',preset:'custom',lang:'ja',genLang:'ja',theme:'dark',pillar:0,previewFile:null,files:{},skipped:[],progress:{},editedFiles:{},prevFiles:{},_v:V};
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function escAttr(s){return String(s).replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/"/g,'&quot;');}
function _jp(s,d){if(s==null)return d;try{return JSON.parse(s);}catch(e){return d;}}
function sanitize(s,max=500){if(!s||typeof s!=='string')return '';return s.replace(/<[^>]*>/g,'').slice(0,max).trim();}
function sanitizeName(s){if(!s||typeof s!=='string')return '';return s.replace(/[<>"'&\\\/]/g,'').slice(0,100).trim();}
function fileSlug(s){if(!s)return 'devforge-project';const r=s.replace(/[^a-zA-Z0-9\s_-]/g,'').replace(/[\s_]+/g,'-').replace(/-{2,}/g,'-').replace(/^-|-$/g,'').slice(0,80);return r||'devforge-project';}
function toast(m){const t=document.createElement('div');t.className='toast-msg';t.textContent=m;t.setAttribute('role','alert');document.body.appendChild(t);if(typeof announce==='function')announce(m);setTimeout(()=>t.remove(),2200);}
function hasDM(m){return (S.answers.dev_methods||'').includes(m);}
let _lsOK=true;try{localStorage.setItem('_t','1');localStorage.removeItem('_t');}catch(e){_lsOK=false;}
function _lsGet(k){if(!_lsOK)return null;try{return localStorage.getItem(k);}catch(e){return null;}}
function _lsSet(k,v){if(!_lsOK)return;try{localStorage.setItem(k,v);}catch(e){}}
function _lsRm(k){if(!_lsOK)return;try{localStorage.removeItem(k);}catch(e){}}
function save(){const d=JSON.stringify(S);if(d.length>4*1024*1024)console.warn('DevForge: state exceeds 4MB');_lsSet(KEY,d);}
function load(){
let d=_lsGet(KEY);
if(!d){d=_lsGet('devforge-v8');if(d)_lsRm('devforge-v8');}
// Migrate legacy dfv8_ keys to devforge- namespace
const _legacyTpl=_lsGet('dfv8_templates');if(_legacyTpl){_lsSet('devforge-templates',_legacyTpl);_lsRm('dfv8_templates');}
// Migrate dfv8_road_* keys
try{const ps=JSON.parse(_lsGet('devforge-projects')||'{}');Object.keys(ps).forEach(n=>{const lk='dfv8_road_'+n;const nk='devforge-road-'+n;const v=_lsGet(lk);if(v&&!_lsGet(nk)){_lsSet(nk,v);}_lsRm(lk);});}catch(e){}
if(!d)return;
try{
const o=JSON.parse(d);
if(typeof o.phase==='number')S.phase=o.phase;
if(typeof o.step==='number')S.step=o.step;
if(o.answers&&typeof o.answers==='object'&&!Array.isArray(o.answers))S.answers=o.answers;
if(typeof o.projectName==='string')S.projectName=o.projectName;
if(typeof o.skill==='string')S.skill=o.skill;
if(typeof o.preset==='string')S.preset=o.preset;
if(typeof o.lang==='string')S.lang=o.lang;
if(typeof o.genLang==='string')S.genLang=o.genLang;
if(typeof o.theme==='string')S.theme=o.theme;
if(typeof o.pillar==='number')S.pillar=o.pillar;
if(typeof o.previewFile==='string'||o.previewFile===null)S.previewFile=o.previewFile;
if(o.files&&typeof o.files==='object'&&!Array.isArray(o.files))S.files=o.files;
if(Array.isArray(o.skipped))S.skipped=o.skipped;
if(o.progress&&typeof o.progress==='object'&&!Array.isArray(o.progress))S.progress=o.progress;
if(o.editedFiles&&typeof o.editedFiles==='object'&&!Array.isArray(o.editedFiles))S.editedFiles=o.editedFiles;
if(o.prevFiles&&typeof o.prevFiles==='object'&&!Array.isArray(o.prevFiles))S.prevFiles=o.prevFiles;
if(typeof o._v==='number')S._v=o._v;
if(!S._v||S._v<V){
S.genLang=S.genLang||S.lang||'ja';
S.editedFiles=S.editedFiles||{};
S.prevFiles=S.prevFiles||{};
S._v=V;
save();
}
}catch(e){_lsRm(KEY);}
}
let voiceRec=null,voiceBtn=null,_confirmCb=null;
/* ═══ I18N ═══ */
const I18N={
ja:{
p1:'Phase 1',p2:'Phase 2',p3:'Phase 3',
heroTitle:'DevForge v9',
heroDesc:'質問に答えるだけで、93+ファイルの開発ドキュメント・環境設定・AIルール・学習ロードマップを自動生成。13の柱でAI駆動開発をゼロから完全サポート。',
startBtn:'🚀 開始する',
statFiles:'生成ファイル',statTech:'技術エントリ',statPillars:'柱 (Pillars)',statAI:'AIツール対応',
skillAsk:'スキルレベルを選択',
skBeginner:'初心者',skBeginnerDesc:'初めてのWeb開発。最適な選択肢をガイドします',
skIntermediate:'中級者',skIntermediateDesc:'1年以上の経験。Svelte, DDD等の中級オプション解放',
skPro:'上級者',skProDesc:'全オプション解放。MDD, RBAC, SSO等＋確認ダイアログ付き',
send:'送信',confirm:'決定',skip:'スキップ ▸',selectMin:'最低1つ選択してください',
sortLabel:'ドラッグで優先順位を並べ替えてください:',sortConfirm:'この順序で決定',
skipMsg:'⏭️ この質問はスキップしました。後で回答できます。',
skippedTitle:'📋 スキップした質問が ',skippedSuffix:' 件あります。回答しましょう。',
skippedDone:'✅ すべての質問に回答完了！',
skippedBanner:'⏭️ スキップ回答中 — 残り ',skippedBannerSuffix:' 件',
answerConfirm:'回答を確認',edit:'修正',
tourNext:'次へ',tourPrev:'前へ',tourDone:'完了',tourStart:'ツアー開始',
phEnd1:'Phase 1 完了！技術選定に進みます。',
phEnd2:'Phase 2 完了！機能・データ設計に進みます。',
genBtn:'📦 93+ファイル生成',
genDone:'✅ 93+ファイルが生成されました！プレビューパネルで確認してください。',
copyDone:'クリップボードにコピーしました',
pmTitle:'📁 プロジェクト管理',pmNew:'新規プロジェクト',pmEmpty:'保存されたプロジェクトはありません',
helpClose:'閉じる',
kbTitle:'⌨️ ショートカット',
kb:['ヘルプ・マニュアル','ショートカット一覧','テーマ切替','言語切替','エクスポート','全ファイルコピー','プロジェクト管理'],
pillar:['①SDD統合','②DevContainer','③MCP設定','④AIルール','⑤並列探索','⑥Dashboard','⑦ロードマップ','⑧AIランチャー','⑨デザインシステム','⑩リバースEng','⑪実装ガイド','⑫セキュリティ','⑬戦略インテリジェンス']
},
en:{
p1:'Phase 1',p2:'Phase 2',p3:'Phase 3',
heroTitle:'DevForge v9',
heroDesc:'Answer questions to auto-generate 93+ development documents, environment configs, AI rules & learning roadmaps. 13 pillars for complete AI-driven development support.',
startBtn:'🚀 Get Started',
statFiles:'Generated Files',statTech:'Tech Entries',statPillars:'Pillars',statAI:'AI Tools',
skillAsk:'Select your skill level',
skBeginner:'Beginner',skBeginnerDesc:'First-time web dev. Curated options to guide you smoothly',
skIntermediate:'Intermediate',skIntermediateDesc:'1+ year experience. Unlocks Svelte, DDD & mid-level options',
skPro:'Professional',skProDesc:'All options unlocked. MDD, RBAC, SSO & full customization with confirmation',
send:'Send',confirm:'Confirm',skip:'Skip ▸',selectMin:'Select at least one',
sortLabel:'Drag to sort by priority:',sortConfirm:'Confirm order',
skipMsg:'⏭️ This question was skipped. You can answer it later.',
skippedTitle:'📋 You have ',skippedSuffix:' skipped questions. Let\'s answer them.',
skippedDone:'✅ All questions answered!',
skippedBanner:'⏭️ Answering skipped — ',skippedBannerSuffix:' remaining',
answerConfirm:'Confirm answer',edit:'Edit',
tourNext:'Next',tourPrev:'Back',tourDone:'Done',tourStart:'Start Tour',
phEnd1:'Phase 1 complete! Moving to tech stack.',
phEnd2:'Phase 2 complete! Moving to feature design.',
genBtn:'📦 Generate 93+ Files',
genDone:'✅ 93+ files generated! Check the preview panel.',
copyDone:'Copied to clipboard',
pmTitle:'📁 Project Manager',pmNew:'New Project',pmEmpty:'No saved projects',
helpClose:'Close',
kbTitle:'⌨️ Shortcuts',
kb:['Help / Manual','Shortcuts','Toggle Theme','Toggle Language','Export','Copy All Files','Project Manager'],
pillar:['①SDD','②DevContainer','③MCP','④AI Rules','⑤Explorer','⑥Dashboard','⑦Roadmap','⑧AI Launcher','⑨Design System','⑩Reverse Eng','⑪Impl Guide','⑫Security','⑬Strategic Intelligence']
}
};
const t=k=>I18N[S.lang][k]||k;
/* ═══ TEMPLATE PRESETS (36 patterns) ═══ */
const _PD={frontend:'React + Next.js',backend:'Supabase',mobile:'none',ai_auto:'none',payment:'none'};
function _mp(p){return Object.assign({},_PD,p);}
const PR={
saas:_mp({name:'SaaSアプリ',nameEn:'SaaS App',icon:'☁️',purpose:'サブスクリプション型Webサービスの構築',purposeEn:'Build a subscription-based web service',target:['スタートアップ','中小企業','フリーランス'],targetEn:['Startups','SMBs','Freelancers'],features:['ユーザー登録・ログイン','ダッシュボード','課金・プラン管理','チーム招待','分析レポート'],featuresEn:['User Registration & Login','Dashboard','Billing & Plan Management','Team Invitations','Analytics Reports'],
entities:'User, Team, Subscription, Invoice, Activity',payment:'stripe'}),
ai_agent:_mp({name:'AIエージェント',nameEn:'AI Agent',icon:'🤖',purpose:'AIを活用したタスク自動化・対話型アシスタント',purposeEn:'AI-powered task automation & conversational assistant',target:['エンジニア','スタートアップ'],targetEn:['Engineers','Startups'],features:['チャットインターフェース','プロンプト管理','履歴・コンテキスト管理','API連携','使用量ダッシュボード'],featuresEn:['Chat Interface','Prompt Management','History & Context Management','API Integration','Usage Dashboard'],
entities:'User, Conversation, Message, Prompt, ApiUsage, Agent, Tool',ai_auto:'マルチAgent協調',payment:'stripe'}),
ai_content:_mp({name:'AIコンテンツ生成',nameEn:'AI Content Gen',icon:'✨',purpose:'AIを活用した文章・画像・動画の自動生成プラットフォーム',purposeEn:'AI-powered text, image & video auto-generation platform',target:['マーケター','ブロガー','クリエイター'],targetEn:['Marketers','Bloggers','Creators'],features:['テンプレート選択','AIコンテンツ生成','編集・リライト','SEO最適化','エクスポート'],featuresEn:['Template Selection','AI Content Generation','Edit & Rewrite','SEO Optimization','Export'],
entities:'User, Template, Generation, Content, Project, CreditUsage',ai_auto:'Vibe Coding入門',payment:'stripe'}),
automation:_mp({name:'ワークフロー自動化',nameEn:'Workflow Automation',icon:'⚙️',purpose:'タスクやプロセスを自動化するiPaaS/ノーコード連携ツール',purposeEn:'iPaaS/no-code tool for automating tasks and processes',target:['中小企業','マーケター','管理者'],targetEn:['SMBs','Marketers','Admins'],frontend:'React (Vite SPA)',backend:'Node.js + Express',features:['ビジュアルフローエディタ','トリガー・アクション設定','API連携','実行ログ','スケジュール実行'],featuresEn:['Visual Flow Editor','Trigger & Action Config','API Integration','Execution Logs','Scheduled Runs'],
entities:'User, Workflow, Trigger, Action, Execution, Connection, Log',payment:'stripe'}),
marketplace:_mp({name:'マーケットプレイス',nameEn:'Marketplace',icon:'🏪',purpose:'売り手と買い手をつなぐ双方向プラットフォーム',purposeEn:'Two-sided platform connecting buyers and sellers',target:['一般消費者','フリーランス','スモールビジネス'],targetEn:['Consumers','Freelancers','Small Businesses'],features:['出品・商品登録','検索・フィルタ','メッセージ機能','決済・エスクロー','レビュー・評価'],featuresEn:['Product Listing','Search & Filter','Messaging','Payment & Escrow','Reviews & Ratings'],
entities:'User, Listing, Category, Order, Transaction, Review, Message',payment:'stripe'}),
ec:_mp({name:'ECサイト',nameEn:'E-Commerce',icon:'🛍️',purpose:'オンラインショップの構築',purposeEn:'Build an online shop',target:['一般消費者','ショップオーナー'],targetEn:['Consumers','Shop Owners'],backend:'Node.js + Express',features:['商品管理','カート・決済','注文管理','在庫管理','レビュー機能'],featuresEn:['Product Management','Cart & Checkout','Order Management','Inventory Management','Reviews'],entities:'Product, Order, User, Category, Cart, Payment',payment:'ec_build'}),
dashboard:_mp({name:'ダッシュボード',nameEn:'Dashboard',icon:'📊',purpose:'データを集約・可視化してインサイトを提供する分析ツール',purposeEn:'Analytics tool to aggregate and visualize data for insights',target:['経営者','マーケター','データアナリスト'],targetEn:['Executives','Marketers','Data Analysts'],features:['KPIウィジェット','グラフ・チャート','データフィルタ','レポート出力','アラート通知'],featuresEn:['KPI Widgets','Charts & Graphs','Data Filters','Report Export','Alert Notifications'],
entities:'User, DataSource, Widget, Dashboard, Report, Alert'}),
chatbot:_mp({name:'チャットボット',nameEn:'Chatbot',icon:'💬',purpose:'AIカスタマーサポート・FAQ自動応答システム',purposeEn:'AI customer support & FAQ auto-response system',target:['中小企業','EC事業者'],targetEn:['SMBs','E-commerce Businesses'],frontend:'React (Vite SPA)',features:['チャットウィジェット','FAQ学習・管理','会話フロー設計','有人エスカレーション','分析レポート'],featuresEn:['Chat Widget','FAQ Learning & Management','Conversation Flow Design','Human Escalation','Analytics Reports'],
entities:'User, Bot, Conversation, Message, Intent, KnowledgeBase, Handoff',ai_auto:'Vibe Coding入門'}),
fintech:_mp({name:'フィンテック',nameEn:'Fintech',icon:'💰',purpose:'決済・家計管理・請求書など金融系Webアプリ',purposeEn:'Financial web app for payments, budgeting & invoicing',target:['フリーランス','中小企業','一般消費者'],targetEn:['Freelancers','SMBs','Consumers'],backend:'Node.js + NestJS',features:['口座連携','収支ダッシュボード','請求書発行','自動カテゴリ分類','レポート出力'],featuresEn:['Account Linking','Income/Expense Dashboard','Invoice Generation','Auto-categorization','Report Export'],
entities:'User, Account, Transaction, Invoice, Category, Budget, Report',mobile:'Expo (React Native)',payment:'stripe'}),
devtool:_mp({name:'開発者ツール',nameEn:'Dev Tool',icon:'🛠️',purpose:'開発者の生産性を向上させるユーティリティ・API',purposeEn:'Developer utility & API to boost productivity',target:['エンジニア','スタートアップ'],targetEn:['Engineers','Startups'],backend:'Node.js + Express',features:['APIキー管理','ドキュメント','使用量モニタ','Webhook設定','Playground'],featuresEn:['API Key Management','Documentation','Usage Monitor','Webhook Config','Playground'],
entities:'User, ApiKey, Project, RequestLog, Webhook, Documentation',payment:'stripe'}),
creator:_mp({name:'クリエイターエコノミー',nameEn:'Creator Economy',icon:'🎨',purpose:'コンテンツ販売・ファンコミュニティ・サブスク課金プラットフォーム',purposeEn:'Content sales, fan community & subscription platform',target:['クリエイター','インフルエンサー'],targetEn:['Creators','Influencers'],features:['プロフィール・ポートフォリオ','有料コンテンツ配信','サブスク課金','ファンコメント・投げ銭','アナリティクス'],featuresEn:['Profile & Portfolio','Paid Content Distribution','Subscription Billing','Fan Comments & Tips','Analytics'],
entities:'User, Content, Subscription, Payment, Comment, Tip, Tier',payment:'stripe'}),
newsletter:_mp({name:'ニュースレター/メディア',nameEn:'Newsletter/Media',icon:'📰',purpose:'ニュースレター配信・メディア運営プラットフォーム',purposeEn:'Newsletter distribution & media management platform',target:['ライター','メディア運営者','マーケター'],targetEn:['Writers','Media Operators','Marketers'],features:['記事エディタ','購読者管理','配信スケジュール','開封・クリック分析','有料プラン'],featuresEn:['Article Editor','Subscriber Management','Delivery Schedule','Open & Click Analytics','Paid Plans'],
entities:'User, Post, Subscriber, Campaign, Analytics, Plan',payment:'stripe'}),
pwa:_mp({name:'PWAアプリ',nameEn:'PWA App',icon:'📱',purpose:'ネイティブアプリ体験をWebで提供するモバイルファースト',purposeEn:'Mobile-first web app with native app experience',target:['一般消費者','スタートアップ'],targetEn:['Consumers','Startups'],frontend:'React (Vite SPA)',backend:'Firebase',features:['オフライン対応','プッシュ通知','ホーム画面追加','カメラ・位置情報','データ同期'],featuresEn:['Offline Support','Push Notifications','Add to Home Screen','Camera & Location','Data Sync'],
entities:'User, Content, Notification, SyncQueue, Setting',mobile:'Expo (React Native)'}),
booking:_mp({name:'予約システム',nameEn:'Booking System',icon:'📅',purpose:'サービスやリソースの予約・スケジュールを管理するシステム',purposeEn:'Booking & schedule management system for services',target:['店舗オーナー','フリーランス','一般消費者'],targetEn:['Shop Owners','Freelancers','Consumers'],features:['カレンダー表示','予約作成・変更','リマインダー通知','決済連携','スタッフ管理'],featuresEn:['Calendar View','Create & Modify Bookings','Reminder Notifications','Payment Integration','Staff Management'],
entities:'User, Service, Booking, TimeSlot, Staff, Payment, Reminder',payment:'stripe'}),
event:_mp({name:'イベントプラットフォーム',nameEn:'Event Platform',icon:'🎪',purpose:'オンライン・オフラインイベントの開催・参加管理',purposeEn:'Online/offline event hosting & attendance management',target:['イベント主催者','コミュニティ','企業'],targetEn:['Event Organizers','Communities','Companies'],features:['イベント作成・公開','チケット販売','参加者管理','ライブ配信連携','アンケート'],featuresEn:['Event Creation & Publishing','Ticket Sales','Attendee Management','Live Streaming Integration','Surveys'],
entities:'User, Event, Ticket, Attendee, Venue, Session, Survey',payment:'stripe'}),
health:_mp({name:'ヘルステック',nameEn:'Health Tech',icon:'🏥',purpose:'健康・フィットネス・ウェルネスの記録と改善を支援するアプリ',purposeEn:'Health, fitness & wellness tracking and improvement app',target:['一般消費者','トレーナー'],targetEn:['Consumers','Trainers'],frontend:'React (Vite SPA)',backend:'Firebase',features:['健康データ記録','トレーニング管理','食事ログ','目標・進捗グラフ','リマインダー'],featuresEn:['Health Data Logging','Training Management','Meal Logs','Goals & Progress Graphs','Reminders'],
entities:'User, HealthLog, Workout, Meal, Goal, Progress, Reminder',mobile:'Expo (React Native)'}),
hr:_mp({name:'HR/採用管理',nameEn:'HR/Recruiting',icon:'👥',purpose:'採用プロセスと人事管理を効率化するツール',purposeEn:'Tool to streamline recruiting and HR management',target:['人事担当者','採用担当者','経営者'],targetEn:['HR Staff','Recruiters','Executives'],features:['求人管理','応募者トラッキング','面接スケジュール','評価・スコアカード','オンボーディング'],featuresEn:['Job Management','Applicant Tracking','Interview Scheduling','Evaluation Scorecards','Onboarding'],
entities:'User, JobPosting, Applicant, Interview, Evaluation, Department, Onboarding'}),
linkbio:_mp({name:'Link in Bio',nameEn:'Link in Bio',icon:'🔗',purpose:'SNSプロフィール用のマイクロサイト・リンク集約ツール',purposeEn:'Micro-site & link aggregation tool for social profiles',target:['インフルエンサー','クリエイター','フリーランス'],targetEn:['Influencers','Creators','Freelancers'],features:['カスタムリンクページ','テーマ・デザイン編集','アクセス解析','SNS連携','収益化リンク'],featuresEn:['Custom Link Page','Theme & Design Editor','Access Analytics','Social Integration','Monetization Links'],
entities:'User, Page, Link, Theme, ClickLog, Integration'}),
gamify:_mp({name:'ゲーミフィケーション',nameEn:'Gamification',icon:'🎮',purpose:'ゲーム要素でユーザーエンゲージメントを向上',purposeEn:'Boost user engagement with game elements',target:['教育者','マーケター','コミュニティ管理者'],targetEn:['Educators','Marketers','Community Managers'],frontend:'React (Vite SPA)',backend:'Firebase',features:['ポイント・バッジシステム','リーダーボード','チャレンジ・ミッション','報酬・交換','進捗ダッシュボード'],featuresEn:['Points & Badge System','Leaderboard','Challenges & Missions','Rewards & Redemption','Progress Dashboard'],
entities:'User, Badge, Challenge, Reward, Leaderboard, PointLog, Achievement'}),
collab:_mp({name:'リアルタイムコラボ',nameEn:'Realtime Collab',icon:'🤝',purpose:'チームが同時編集・共同作業できるリアルタイムツール',purposeEn:'Real-time tool for team collaborative editing',target:['リモートチーム','スタートアップ','教育者'],targetEn:['Remote Teams','Startups','Educators'],features:['リアルタイム同時編集','カーソル共有','コメント・メンション','バージョン履歴','権限管理'],featuresEn:['Real-time Co-editing','Cursor Sharing','Comments & Mentions','Version History','Permission Management'],
entities:'User, Document, Workspace, Comment, Version, Permission, Activity',payment:'stripe'}),
iot:_mp({name:'IoTダッシュボード',nameEn:'IoT Dashboard',icon:'📡',purpose:'IoTデバイスのデータ監視・制御・可視化ツール',purposeEn:'IoT device data monitoring, control & visualization',target:['エンジニア','製造業'],targetEn:['Engineers','Manufacturing'],frontend:'React (Vite SPA)',backend:'Node.js + Express',features:['デバイス登録・管理','リアルタイムデータ表示','アラート設定','遠隔制御','履歴データ分析'],featuresEn:['Device Registration & Management','Real-time Data Display','Alert Settings','Remote Control','Historical Data Analysis'],
entities:'User, Device, SensorData, Alert, Command, DeviceGroup, Log'}),
portfolio:_mp({name:'ポートフォリオ',nameEn:'Portfolio',icon:'🖼️',purpose:'スキル・実績を魅力的に紹介するサイト',purposeEn:'Showcase skills and achievements attractively',target:['学生','フリーランス'],targetEn:['Students','Freelancers'],frontend:'Astro',features:['自己紹介','プロジェクト一覧','スキル表示','お問い合わせ'],featuresEn:['About Me','Project Gallery','Skills Display','Contact Form'],entities:'Project, Skill, ContactMessage'}),
cms:_mp({name:'CMS/ブログ',nameEn:'CMS/Blog',icon:'📝',purpose:'コンテンツを投稿・管理・公開できるシステム',purposeEn:'System to create, manage and publish content',target:['ブロガー','編集者'],targetEn:['Bloggers','Editors'],features:['記事作成・編集','カテゴリ管理','画像アップロード','SEO設定','下書き保存'],featuresEn:['Article Editor','Category Management','Image Upload','SEO Settings','Draft Saving'],entities:'User, Post, Category, Tag, Media'}),
lms:_mp({name:'学習プラットフォーム',nameEn:'Learning Platform',icon:'📚',purpose:'体系的に知識を習得できる教育システム',purposeEn:'Structured education system for knowledge acquisition',target:['学生','社会人学習者','教育者'],targetEn:['Students','Working Professionals','Educators'],frontend:'React (Vite SPA)',backend:'Firebase',features:['コース一覧','レッスン視聴','進捗管理','クイズ機能','修了証発行'],featuresEn:['Course Catalog','Lesson Viewing','Progress Tracking','Quiz System','Certificate Issuance'],
entities:'User, Course, Lesson, Progress, Quiz, Certificate',mobile:'Expo (React Native)',payment:'stripe'}),
community:_mp({name:'コミュニティ',nameEn:'Community',icon:'🌐',purpose:'共通の関心を持つ人々が交流できるプラットフォーム',purposeEn:'Platform for people with common interests to interact',target:['コミュニティメンバー','管理者'],targetEn:['Community Members','Admins'],features:['プロフィール','投稿・コメント','グループ','イベント管理','通知'],featuresEn:['Profiles','Posts & Comments','Groups','Event Management','Notifications'],entities:'User, Post, Comment, Group, Event'}),
property_mgmt:_mp({name:'不動産管理',nameEn:'Property Management',icon:'🏢',purpose:'賃貸・売買物件の管理、入居者対応、家賃回収を一元管理',purposeEn:'Centralized rental/sales property management, tenant communication & rent collection',target:['不動産オーナー','管理会社','仲介業者'],targetEn:['Property Owners','Management Companies','Real Estate Agents'],features:['物件登録・管理','入居者情報管理','契約・更新管理','家賃請求・督促','修繕依頼トラッキング','収支レポート'],featuresEn:['Property Registration & Management','Tenant Info Management','Contract & Renewal Management','Rent Billing & Reminders','Repair Request Tracking','Financial Reports'],entities:'Property, Unit, Tenant, Lease, Payment, MaintenanceRequest, Owner, Invoice',payment:'stripe'}),
contract_mgmt:_mp({name:'契約管理',nameEn:'Contract Management',icon:'📜',purpose:'契約書の作成・承認フロー・期限管理・電子署名を統合管理',purposeEn:'Integrated contract creation, approval workflow, deadline tracking & e-signature',target:['法務部','営業部','中小企業','フリーランス'],targetEn:['Legal Dept','Sales Dept','SMBs','Freelancers'],features:['契約書テンプレート','承認ワークフロー','電子署名連携','期限・更新アラート','バージョン管理','検索・タグ付け'],featuresEn:['Contract Templates','Approval Workflow','E-signature Integration','Deadline & Renewal Alerts','Version Control','Search & Tagging'],entities:'Contract, Template, Party, Approval, Signature, Milestone, Alert, Clause',payment:'stripe'}),
helpdesk:_mp({name:'ヘルプデスク',nameEn:'Help Desk',icon:'🎧',purpose:'カスタマーサポートのチケット管理とナレッジベース統合',purposeEn:'Customer support ticket management with integrated knowledge base',target:['サポートチーム','IT部門','SaaS企業'],targetEn:['Support Teams','IT Departments','SaaS Companies'],features:['チケット起票・管理','優先度・ステータス設定','担当者アサイン','ナレッジベース連携','SLA追跡','顧客満足度評価'],featuresEn:['Ticket Creation & Management','Priority & Status Settings','Agent Assignment','Knowledge Base Integration','SLA Tracking','Customer Satisfaction Rating'],entities:'SupportTicket, User, Agent, Category, Priority, KnowledgeArticle, Response, SLA',ai_auto:'Vibe Coding入門',payment:'stripe'}),
tutoring:_mp({name:'家庭教師マッチング',nameEn:'Tutoring Marketplace',icon:'👨‍🏫',purpose:'講師と生徒をマッチングし、オンライン・対面授業を予約管理',purposeEn:'Match tutors with students, manage online/in-person lesson bookings',target:['学生','保護者','講師','教育事業者'],targetEn:['Students','Parents','Tutors','Education Businesses'],features:['講師プロフィール・検索','科目・スキルフィルタ','レッスン予約','オンライン授業連携','レビュー・評価','決済・手数料管理'],featuresEn:['Tutor Profiles & Search','Subject & Skill Filters','Lesson Booking','Online Class Integration','Reviews & Ratings','Payment & Fee Management'],entities:'Tutor, Student, Subject, Lesson, Booking, Review, Payment, Availability',payment:'stripe'}),
veterinary:_mp({name:'動物病院',nameEn:'Veterinary Clinic',icon:'🐾',purpose:'動物病院のカルテ管理・予約・ワクチン接種記録システム',purposeEn:'Vet clinic medical records, appointments & vaccination tracking',target:['獣医師','動物病院スタッフ','ペットオーナー'],targetEn:['Veterinarians','Clinic Staff','Pet Owners'],features:['ペット情報・カルテ管理','診察予約','ワクチン接種履歴','処方箋管理','会計・請求','リマインダー通知'],featuresEn:['Pet Info & Medical Records','Appointment Scheduling','Vaccination History','Prescription Management','Billing & Invoicing','Reminder Notifications'],entities:'Pet, Owner, Appointment, MedicalRecord, Vaccination, Prescription, Invoice, Veterinarian',payment:'stripe'}),
restaurant:_mp({name:'飲食店管理',nameEn:'Restaurant Management',icon:'🍽️',purpose:'飲食店のPOS・予約・在庫・スタッフ管理を統合',purposeEn:'Integrated POS, reservations, inventory & staff management for restaurants',target:['飲食店オーナー','店長','スタッフ'],targetEn:['Restaurant Owners','Managers','Staff'],frontend:'React (Vite SPA)',features:['テーブル予約管理','POS・注文管理','在庫・発注管理','メニュー編集','売上レポート','スタッフシフト'],featuresEn:['Table Reservation Management','POS & Order Management','Inventory & Ordering','Menu Editor','Sales Reports','Staff Scheduling'],entities:'Table, Reservation, Order, MenuItem, Inventory, Staff, Shift, Payment',payment:'stripe'}),
construction_pay:_mp({name:'建設業決済',nameEn:'Construction Payment',icon:'🏗️',purpose:'建設プロジェクトの支払管理・請求書発行・進捗連動決済',purposeEn:'Construction project payment management, invoicing & milestone-based payments',target:['建設会社','下請け業者','元請け'],targetEn:['Construction Companies','Subcontractors','General Contractors'],features:['プロジェクト管理','マイルストーン設定','進捗報告','請求書発行','支払スケジュール','承認ワークフロー'],featuresEn:['Project Management','Milestone Setup','Progress Reporting','Invoice Generation','Payment Schedule','Approval Workflow'],entities:'Project, Contractor, Milestone, Invoice, Payment, ProgressReport, Approval, Estimate',payment:'stripe'}),
clinic:_mp({name:'クリニック・医院',nameEn:'Medical Clinic',icon:'🏥',purpose:'診療所の電子カルテ・予約・処方箋・会計を統合管理',purposeEn:'Integrated EMR, appointments, prescriptions & billing for clinics',target:['医師','看護師','医療事務','患者'],targetEn:['Doctors','Nurses','Medical Admin','Patients'],features:['電子カルテ','診察予約','処方箋管理','検査結果記録','会計・レセプト','待合状況表示'],featuresEn:['Electronic Medical Records','Appointment Scheduling','Prescription Management','Test Result Logging','Billing & Claims','Waiting Room Status'],entities:'Patient, Appointment, MedicalRecord, Prescription, Examination, Invoice, Doctor, Claim',payment:'stripe'}),
knowledge_base:_mp({name:'ナレッジベース',nameEn:'Knowledge Base',icon:'📖',purpose:'組織の知識・ノウハウを体系化し検索可能にするドキュメントDB',purposeEn:'Systematize and search organizational knowledge & know-how documentation',target:['全社員','カスタマーサポート','教育担当'],targetEn:['All Employees','Customer Support','Training Staff'],features:['記事作成・編集','カテゴリ・タグ管理','全文検索','バージョン履歴','アクセス権限','AI検索提案'],featuresEn:['Article Creation & Editing','Category & Tag Management','Full-text Search','Version History','Access Control','AI Search Suggestions'],entities:'Article, Category, Tag, Version, User, AccessControl, SearchLog, Feedback',ai_auto:'Vibe Coding入門'}),
field_service:_mp({name:'現場サービス',nameEn:'Field Service',icon:'🚚',purpose:'現場作業員の派遣・スケジュール・作業報告を一元管理',purposeEn:'Centralized dispatch, scheduling & work reporting for field workers',target:['サービス企業','技術者','ディスパッチャー'],targetEn:['Service Companies','Technicians','Dispatchers'],features:['作業オーダー管理','スケジューリング','リアルタイム位置追跡','作業報告・写真','在庫管理','請求書発行'],featuresEn:['Work Order Management','Scheduling','Real-time Location Tracking','Work Reports & Photos','Inventory Management','Invoice Generation'],entities:'WorkOrder, Technician, Schedule, Location, Report, Inventory, Customer, Invoice',mobile:'Expo (React Native)',payment:'stripe'}),
crm:_mp({name:'CRM',nameEn:'CRM',icon:'📇',purpose:'顧客管理・案件管理・営業パイプライン最適化',purposeEn:'Customer management, deal tracking & sales pipeline optimization',target:['営業チーム','マーケター','経営者'],targetEn:['Sales Teams','Marketers','Executives'],features:['連絡先・企業管理','案件パイプライン','商談フォローアップ','売上予測','メール連携','活動ログ'],featuresEn:['Contact & Company Management','Deal Pipeline','Follow-up Tracking','Revenue Forecasting','Email Integration','Activity Log'],entities:'User, Contact, Company, Deal, Pipeline, Activity, Task',payment:'stripe'}),
social:_mp({name:'SNS',nameEn:'Social Network',icon:'📱',purpose:'ソーシャルネットワーク・フィード・フォロー・DM',purposeEn:'Social network with feed, follow, DM features',target:['一般ユーザー','クリエイター','コミュニティ'],targetEn:['General Users','Creators','Communities'],frontend:'React (Vite SPA)',backend:'Firebase',features:['プロフィール','投稿・フィード','フォロー/フォロワー','いいね・コメント','DM','通知'],featuresEn:['Profiles','Posts & Feed','Follow/Followers','Likes & Comments','Direct Messages','Notifications'],entities:'User, Post, Comment, Like, Follow, Message, Notification',mobile:'Expo (React Native)'}),
logistics:_mp({name:'物流管理',nameEn:'Logistics',icon:'🚛',purpose:'配送追跡・ルート最適化・倉庫管理・ドライバー管理',purposeEn:'Shipment tracking, route optimization, warehouse & driver management',target:['物流企業','運送業者','倉庫管理者'],targetEn:['Logistics Companies','Carriers','Warehouse Managers'],features:['配送追跡','ルート最適化','倉庫在庫管理','ドライバー管理','リアルタイム位置情報','配達証明'],featuresEn:['Shipment Tracking','Route Optimization','Warehouse Inventory','Driver Management','Real-time Location','Proof of Delivery'],entities:'Shipment, Route, Warehouse, Driver, Inventory, User',mobile:'Expo (React Native)',payment:'stripe'}),
survey:_mp({name:'アンケート',nameEn:'Survey',icon:'📋',purpose:'アンケート作成・回答収集・分析・レポート出力',purposeEn:'Survey creation, response collection, analysis & reporting',target:['マーケター','研究者','人事担当'],targetEn:['Marketers','Researchers','HR Staff'],features:['フォームビルダー','質問タイプ選択','条件分岐','回答収集','集計・分析','CSVエクスポート'],featuresEn:['Form Builder','Question Types','Conditional Logic','Response Collection','Analytics','CSV Export'],entities:'User, Form, Question, Answer, Analytics'}),
job_board:_mp({name:'求人サイト',nameEn:'Job Board',icon:'💼',purpose:'求人掲載・応募管理・マッチング・スカウト',purposeEn:'Job posting, application management, matching & scouting',target:['求職者','企業人事','転職エージェント'],targetEn:['Job Seekers','HR Teams','Recruiters'],features:['求人検索・フィルタ','応募・保存','企業プロフィール','マッチング通知','スカウト機能','応募管理'],featuresEn:['Job Search & Filter','Apply & Save','Company Profiles','Matching Notifications','Scouting','Application Management'],entities:'User, Job, SavedJob, Company, Applicant',payment:'stripe'}),
custom:{name:'',icon:'⚡'},
};
/* ═══ QUESTIONS (Skill-Aware Dynamic) ═══ */
/* KPI chip builder — purpose-linked dynamic chips */
function _kpiChips(ja,lv){
const p=(S.answers.purpose||'').toLowerCase();
// Common KPIs (always shown)
const common=ja
?['📈 月間1000ユーザー','📈 DAU 100+','😊 NPS 50以上','⚡ レスポンス200ms以内','⚡ 稼働率99.9%+']
:['📈 1,000 MAU','📈 100+ DAU','😊 NPS 50+','⚡ <200ms response','⚡ 99.9%+ uptime'];
// Purpose-specific KPI pools
const pools=ja?{
saas:['💰 月売上10万円(MRR)','🔄 月間チャーン5%以下','🔄 DAU/MAU比率30%+','💰 LTV5万円','🔄 機能利用率80%+','💰 ARPU500円'],
ec:['💰 GMV月100万円','💰 CV率3%+','🏪 カート放棄30%以下','🏪 客単価3000円','🏪 取引完了率95%+','😊 レビュー評価4.5★+'],
marketplace:['💰 GMV月100万円','💰 テイクレート10%','🏪 月500新規出品','🏪 取引完了率95%+','👥 需給バランス比率'],
education:['📚 コース完了率80%+','📚 クイズ合格率70%+','📚 視聴完了率70%+','📚 月100修了証発行','🔄 7日連続利用率50%+','🔄 セッション時間5分+'],
community:['👥 日次投稿50件+','👥 メンバー月10%増','👥 UGC率30%+','👥 アクティブグループ70%+','🔄 DAU/MAU比率30%+'],
content:['📚 月30記事公開','📚 月間5000PV','📚 開封率30%+','📚 CTR 5%+','🔄 セッション時間5分+','💰 購読者月10%増'],
analytics:['🏢 レポート作成1分以内','🏢 日次100万件処理','😊 CSAT 4.5/5','⚡ エラー率0.1%以下'],
automation:['🤖 手動作業70%削減','🤖 処理時間50%短縮','⚡ エラー率0.1%以下','⚡ API成功率99.5%+','🏢 タスク完了率90%+'],
ai:['🤖 AI正答率90%+','🤖 有人対応20%以下','🤖 生成品質スコア4/5','🤖 プロンプト成功率85%+','😊 CSAT 4.5/5'],
portfolio:['📈 月間5000PV','📚 CTR 5%+','⚡ LCP 2.5秒以内','😊 問合せ率3%+'],
booking:['🏪 予約転換率60%+','🏪 リソース稼働率80%+','🏪 ノーショー5%以下','😊 CSAT 4.5/5','💰 月間予約500件+'],
fintech:['💰 月間取引高1000万円','🏢 不正検知率99%+','⚡ 決済成功率99.5%+','😊 CSAT 4.5/5'],
hr:['🏢 採用日数30日以内','🏢 オファー承諾率80%+','🏢 オンボーディング完了率95%+','😊 従業員満足度4/5'],
health:['🔄 7日連続利用率50%+','🔄 目標達成率60%+','📚 データ記録率80%+','😊 ユーザー継続率70%+'],
iot:['⚡ デバイス稼働率95%+','⚡ データ遅延1秒以内','⚡ アラート応答5分以内','🏢 デバイス接続1000台+'],
event:['🏪 チケット販売率80%+','😊 参加者満足度4.5/5','👥 リピート参加率40%+','💰 イベント収益目標達成'],
gamify:['🔄 バッジ獲得率60%+','🔄 デイリークエスト完了率50%+','🔄 リーダーボード参加率30%+','📈 エンゲージメント率40%+'],
collab:['👥 同時編集5人+','👥 編集頻度日次10回+','🔄 機能利用率80%+','😊 NPS 50以上'],
devtool:['📈 API呼出月10万回','📈 開発者登録月100人+','📚 ドキュメントカバレッジ90%+','⚡ API成功率99.5%+'],
creator:['💰 ファンLTV1万円','💰 コンテンツ収益化率20%+','👥 ファンエンゲージメント率30%+','📈 購読者月10%増'],
newsletter:['📚 開封率30%+','📚 CTR 5%+','💰 有料購読者月5%増','📈 購読者月10%増'],
chatbot:['🤖 自動解決率80%+','🤖 有人対応20%以下','😊 CSAT 4.5/5','⚡ 応答時間2秒以内'],
pwa:['📈 インストール率10%+','📈 オフライン利用率20%+','🔄 プッシュ通知開封率30%+','⚡ LCP 2.5秒以内'],
tool:['🏢 タスク完了率90%+','🏢 処理時間50%短縮','😊 CSAT 4.5/5','⚡ 稼働率99.9%+','🔄 機能利用率80%+']
}:{
saas:['💰 $1K MRR','🔄 <5% monthly churn','🔄 30%+ DAU/MAU','💰 $500 LTV','🔄 80%+ feature adoption','💰 $5 ARPU'],
ec:['💰 $10K GMV','💰 3%+ conversion','🏪 <30% cart abandon','🏪 $30 AOV','🏪 95%+ fulfillment','😊 4.5★+ reviews'],
marketplace:['💰 $10K GMV','💰 10% take rate','🏪 500 listings/mo','🏪 95%+ fulfillment','👥 Supply/demand balance'],
education:['📚 80%+ completion','📚 70%+ quiz pass','📚 70%+ watch-through','📚 100 certs/month','🔄 50%+ 7-day streak','🔄 5min+ session'],
community:['👥 50+ posts/day','👥 10%+ member growth/mo','👥 30%+ UGC ratio','👥 70%+ active groups','🔄 30%+ DAU/MAU'],
content:['📚 30 posts/month','📚 5,000 PV/month','📚 30%+ open rate','📚 5%+ CTR','🔄 5min+ session','💰 10%+ subscriber growth/mo'],
analytics:['🏢 Reports in <1min','🏢 1M records/day','😊 CSAT 4.5/5','⚡ <0.1% error rate'],
automation:['🤖 70% manual reduction','🤖 50% time saved','⚡ <0.1% error rate','⚡ 99.5%+ API success','🏢 90%+ task completion'],
ai:['🤖 90%+ AI accuracy','🤖 <20% human handoff','🤖 4/5 quality score','🤖 85%+ prompt success','😊 CSAT 4.5/5'],
portfolio:['📈 5,000 PV/month','📚 5%+ CTR','⚡ LCP <2.5s','😊 3%+ inquiry rate'],
booking:['🏪 60%+ booking conv.','🏪 80%+ utilization','🏪 <5% no-show','😊 CSAT 4.5/5','💰 500+ bookings/mo'],
fintech:['💰 $100K transactions/mo','🏢 99%+ fraud detection','⚡ 99.5%+ payment success','😊 CSAT 4.5/5'],
hr:['🏢 <30 days time-to-hire','🏢 80%+ offer acceptance','🏢 95%+ onboarding','😊 4/5 employee satisfaction'],
health:['🔄 50%+ 7-day streak','🔄 60%+ goal achievement','📚 80%+ data logging','😊 70%+ user retention'],
iot:['⚡ 95%+ device uptime','⚡ <1s data latency','⚡ <5min alert response','🏢 1,000+ devices'],
event:['🏪 80%+ sell-through','😊 4.5/5 attendee satisfaction','👥 40%+ repeat attendance','💰 Revenue target met'],
gamify:['🔄 60%+ badge earn rate','🔄 50%+ daily quest','🔄 30%+ leaderboard participation','📈 40%+ engagement rate'],
collab:['👥 5+ concurrent editors','👥 10+ daily edits','🔄 80%+ feature adoption','😊 NPS 50+'],
devtool:['📈 100K API calls/mo','📈 100+ devs/month','📚 90%+ docs coverage','⚡ 99.5%+ API success'],
creator:['💰 $100 fan LTV','💰 20%+ monetization rate','👥 30%+ fan engagement','📈 10%+ subscriber growth/mo'],
newsletter:['📚 30%+ open rate','📚 5%+ CTR','💰 5%+ paid subscriber growth/mo','📈 10%+ subscriber growth/mo'],
chatbot:['🤖 80%+ auto-resolution','🤖 <20% human handoff','😊 CSAT 4.5/5','⚡ <2s response time'],
pwa:['📈 10%+ install rate','📈 20%+ offline usage','🔄 30%+ push open rate','⚡ LCP <2.5s'],
tool:['🏢 90%+ task completion','🏢 50% time saved','😊 CSAT 4.5/5','⚡ 99.9%+ uptime','🔄 80%+ feature adoption']
};
// Detect purpose category from answer
const detect=[
[/SaaS|サブスク|subscription/i,'saas'],
[/EC|Eコマース|E-Commerce|ショップ|shop|commerce/i,'ec'],
[/マーケットプレイス|marketplace|売り手.*買い手|buyer.*seller/i,'marketplace'],
[/教育|学習|Education|Learning|LMS|コース|course/i,'education'],
[/コミュニティ|community|フォーラム|forum|交流/i,'community'],
[/コンテンツ|content|メディア|media|ブログ|blog|ニュース|news|配信/i,'content'],
[/IoT|デバイス|device|センサー|sensor|監視|monitor/i,'iot'],
[/分析|analytics|可視化|visualiz|ダッシュボード|dashboard|データ分析|data.*analy/i,'analytics'],
[/チャットボット|chatbot|FAQ|カスタマー.*サポート|customer.*support/i,'chatbot'],
[/AI|人工知能|エージェント|agent|対話型/i,'ai'],
[/自動化|automat|ワークフロー|workflow|RPA|iPaaS/i,'automation'],
[/ポートフォリオ|portfolio|実績|showcase/i,'portfolio'],
[/予約|booking|スケジュール|schedule|予約/i,'booking'],
[/金融|fintech|決済|payment|家計|budget|請求|invoice/i,'fintech'],
[/HR|採用|recruit|人事|hiring/i,'hr'],
[/健康|health|フィットネス|fitness|ウェルネス|wellness/i,'health'],
[/イベント|event|チケット|ticket|開催/i,'event'],
[/ゲーミ|gamif|ゲーム|game|ポイント|point|バッジ|badge/i,'gamify'],
[/コラボ|collab|共同|同時編集|realtime/i,'collab'],
[/開発者|developer|devtool|API|ユーティリティ|utility/i,'devtool'],
[/クリエイター|creator|ファン|fan|コンテンツ販売/i,'creator'],
[/ニュースレター|newsletter|メール配信|mail/i,'newsletter'],
[/PWA|プログレッシブ|モバイルファースト|mobile.?first/i,'pwa'],
[/業務|business|効率化|ツール|tool/i,'tool'],
];
let matched=[];
for(const[rx,key]of detect){if(rx.test(p)&&pools[key]){matched.push(...pools[key]);break;}}
// If no match, add generic SaaS+tool mix
if(!matched.length){
const fallback=pools[ja?'saas':'saas'];
matched.push(...fallback.slice(0,3));
}
// Deduplicate
const seen=new Set();const all=[...common,...matched].filter(c=>{if(seen.has(c))return false;seen.add(c);return true;});
// Skill-level trim
if(lv==='beginner')return all.slice(0,6);
if(lv==='pro')return all;
return all.slice(0,10);
}
function getQ(){
const lv=S.skill;
const ja=S.lang==='ja';
return {
1:{name:ja?'プロジェクト定義':'Project Definition',questions:[
{id:'purpose',q:ja?'プロジェクトの目的':'Project Purpose',type:'chip-text',chips:ja?['業務効率化ツール','コンテンツ配信','教育・学習支援','EC・マーケットプレイス','コミュニティ構築','ポートフォリオ','データ分析・可視化','自動化ツール','SaaS']:['Business Tool','Content Delivery','Education','E-Commerce','Community','Portfolio','Data Analytics','Automation','SaaS'],placeholder:ja?'自由入力…':'Type freely...',tip:ja?'「誰が何をできるようになるか」を明確に':'Clarify "who can do what"',help:'purpose'},
{id:'target',q:ja?'ターゲットユーザー':'Target Users',type:'chip-multi',chips:ja?['学生','フリーランス','スタートアップ','中小企業','エンジニア','デザイナー','教育者','一般消費者','管理者','経営者']:['Students','Freelancers','Startups','SMBs','Engineers','Designers','Educators','Consumers','Admins','Executives'],placeholder:ja?'追加…':'Add...',tip:ja?'具体的なペルソナをイメージしましょう':'Imagine a specific persona',help:'target'},
{id:'success',q:ja?'成功指標（KPI）':'Success Metrics (KPI)',type:'chip-multi',chips:_kpiChips(ja,lv),placeholder:ja?'追加…':'Add...',tip:ja?'3〜5つに絞りましょう（プロジェクト種別に応じた指標を提案中）':'Pick 3-5 (suggestions based on your project type)',help:'success'},
{id:'scope_out',q:ja?'スコープ外（やらないこと）':'Out of Scope',type:'chip-multi',chips:ja?['チャット機能','動画配信','決済機能','多言語対応','ネイティブアプリ','AI機能','管理画面','API公開','SNS連携','プッシュ通知']:['Chat','Video streaming','Payments','i18n','Native app','AI features','Admin panel','Public API','Social media','Push notifications'],placeholder:ja?'追加…':'Add...',tip:ja?'スコープを絞ることがMVP完成の鍵':'Scoping down is key to MVP success',help:'scope_out'},
{id:'deadline',q:ja?'リリース目標':'Release Target',type:'options',options:[{label:ja?'2週間':'2 weeks',desc:ja?'超MVP':'Ultra MVP'},{label:ja?'1ヶ月':'1 month',desc:ja?'基本機能':'Basic features'},{label:ja?'3ヶ月':'3 months',desc:ja?'本格MVP':'Full MVP'},{label:ja?'6ヶ月':'6 months',desc:'v1.0'}],tip:ja?'MVPを優先しましょう':'Prioritize MVP',help:'deadline'},
]},
2:{name:ja?'技術選定':'Tech Stack',questions:[
{id:'frontend',q:ja?'フロントエンド':'Frontend',type:'options',options:[{label:'React + Next.js',desc:ja?'SSR/SSG/ISR — 求人最多・エコシステム最大':'SSR/SSG/ISR — most jobs & largest ecosystem'},{label:'React (Vite SPA)',desc:ja?'CSR高速 — 管理画面やSaaS向け':'Fast CSR — for admin panels & SaaS'},...(lv!=='beginner'?[{label:'Vue 3 + Nuxt',desc:ja?'学習容易・日本コミュニティ充実':'Easy to learn, strong JP community'},{label:'Svelte + SvelteKit',desc:ja?'最小バンドル・高速':'Smallest bundle, fast'},
{label:'Astro',desc:ja?'コンテンツサイト・静的サイト':'Content & static sites'}]:[]),...(lv==='pro'?[{label:'Angular',desc:ja?'エンタープライズ大規模':'Enterprise scale'},{label:'React Router v7 (Remix)',desc:ja?'Web標準・フレームワーク統合':'Web standards, framework-unified'}]:[])],tip:ja?'知っている技術が最速です':'Pick what you know',help:'frontend'},
{id:'css_fw',q:ja?'CSSフレームワーク':'CSS Framework',type:'options',help:'css_fw',options:[{label:'Tailwind CSS',desc:ja?'2026年シェア1位 — ユーティリティファースト':'#1 in 2026 — utility-first'},{label:'shadcn/ui + Tailwind',desc:ja?'Radix UI + Tailwind — コピペUI':'Radix UI + Tailwind — copy-paste UI'},{label:'Bootstrap',desc:ja?'レガシー互換・クラス名でスタイル':'Legacy compat, class-based styling'},...(lv!=='beginner'?[{label:'CSS Modules',desc:ja?'スコープ付きCSS':'Scoped CSS'},
{label:'Vanilla CSS',desc:ja?'フレームワーク不使用':'No framework'}]:[])],tip:ja?'Tailwind CSSが2026年のデファクト':'Tailwind CSS is the 2026 standard'},
{id:'backend',q:ja?'バックエンド/DB':'Backend/DB',type:'options',options:[{label:'Firebase',desc:ja?'Google BaaS — 最速プロトタイプ':'Google BaaS — fastest prototype'},{label:'Supabase',desc:ja?'OSS PostgreSQL BaaS — 急成長中':'OSS PostgreSQL BaaS — rapid growth'},...(lv!=='beginner'?[{label:'Node.js + Express',desc:ja?'実績豊富・エコシステム最大・Express 5.x':'Most proven, largest ecosystem, Express 5.x'},{label:'Node.js + Fastify',desc:ja?'Express 5x高速':'5x faster than Express'},
{label:'Node.js + NestJS',desc:ja?'DI・TypeScript完全対応':'DI, full TypeScript support'}]:[]),...(lv==='pro'?[{label:'Python + FastAPI',desc:ja?'AI/ML連携最適・非同期':'Best for AI/ML, async'},{label:'Python + Django',desc:ja?'フルスタック・管理画面付き':'Full-stack with admin panel'},{label:'Java + Spring Boot',desc:ja?'金融・エンタープライズ':'Finance & enterprise'},{label:'Go + Gin',desc:ja?'高パフォーマンス・マイクロサービス':'High-perf microservices'},
{label:'Hono',desc:ja?'Edge Runtime・超軽量':'Edge Runtime, ultra-light'}]:[]),{label:ja?'なし（静的サイト）':'None (static site)',desc:ja?'バックエンド不要':'No backend needed'}],tip:ja?'BaaSならコード不要で開始可能':'BaaS needs no server code',help:'backend'},
{id:'database',q:ja?'データベース':'Database',type:'options',help:'database',condition:{backend:v=>!/なし|None|static/i.test(v)},options:[{label:'PostgreSQL',desc:ja?'2026年SQL推奨1位 — 堅牢・拡張性':'#1 SQL in 2026 — robust & extensible'},{label:'Supabase (PostgreSQL)',desc:ja?'BaaS + リアルタイム + Auth付き':'BaaS + realtime + Auth included'},{label:'Firebase Firestore',desc:ja?'NoSQL BaaS — スキーマレス':'NoSQL BaaS — schemaless'},...(lv!=='beginner'?[{label:'MongoDB',desc:ja?'ドキュメントDB — 柔軟スキーマ':'Document DB — flexible schema'},
{label:'MySQL',desc:ja?'実績豊富 — WordPress/Laravel':'Proven track record — WordPress/Laravel'}]:[]),...(lv==='pro'?[{label:'SQLite',desc:ja?'組込み/Edge — Turso互換':'Embedded/Edge — Turso compatible'},{label:'Redis',desc:ja?'キャッシュ/セッション/Pub-Sub':'Cache/Session/Pub-Sub'},{label:'Neon',desc:ja?'サーバーレスPostgreSQL':'Serverless PostgreSQL'}]:[])],tip:ja?'迷ったらPostgreSQL':'When in doubt, PostgreSQL'},
{id:'orm',q:ja?'ORM':'ORM',type:'options',help:'orm',condition:{backend:v=>!/Firebase|Supabase|Convex|なし|None|static/i.test(v)},options:[{label:'Prisma',desc:ja?'2026年Node.js ORM 1位 — 型安全・Studio付き':'#1 Node.js ORM 2026 — type-safe + Studio'},{label:'Drizzle',desc:ja?'軽量・SQLライク — TypeScript完全対応':'Lightweight SQL-like — full TypeScript'},...(lv!=='beginner'?[{label:'TypeORM',desc:ja?'デコレータベース — NestJS親和':'Decorator-based — NestJS compatible'}]:[]),...(lv==='pro'?[{label:'SQLAlchemy (Python)',desc:ja?'Python標準ORM':'Python standard ORM'},
{label:'Kysely',desc:ja?'SQL型安全ビルダー':'Type-safe SQL builder'}]:[]),{label:ja?'なし / BaaS使用':'None / Using BaaS',desc:ja?'Firebase/Supabase利用時':'When using Firebase/Supabase'}],tip:ja?'PrismaのStudioはDB管理に便利':'Prisma Studio is great for DB management'},
{id:'mobile',q:ja?'モバイル対応 ★v8':'Mobile Support ★v8',type:'options',help:'mobile',options:[{label:'Expo (React Native)',desc:ja?'推奨 — SDK55・EAS Build/Submit・OTA・React共有80%+':'Recommended — SDK55, EAS Build/Submit, OTA, 80%+ React reuse'},...(lv!=='beginner'?[{label:'Flutter',desc:ja?'Dart製・ピクセルパーフェクトUI・マルチプラットフォーム':'Dart, pixel-perfect UI, multi-platform'},
{label:'React Native (bare)',desc:ja?'ネイティブモジュール完全制御':'Full native module control'}]:[]),...(lv==='pro'?[{label:ja?'Swift/Kotlin (ネイティブ)':'Swift/Kotlin (Native)',desc:ja?'最高パフォーマンス・プラットフォーム固有':'Best performance, platform-specific'}]:[]),{label:'PWA',desc:ja?'Service Worker — インストール可能Web':'Service Worker — installable web'},{label:ja?'なし':'None',desc:ja?'Web専用':'Web only'}],tip:ja?'ExpoならReact知識をそのままモバイルへ':'Expo lets you reuse React skills for mobile'},
{id:'ai_auto',q:ja?'AI自律開発レベル ★v8':'AI Dev Level ★v8',type:'options',help:'ai_auto',options:[{label:ja?'Vibe Coding入門':'Vibe Coding Intro',desc:ja?'Level 1 — AIペアプログラミング・Tab補完':'Level 1 — AI pair programming, Tab completion'},...(lv!=='beginner'?[{label:ja?'エージェント型開発':'Agentic Dev',desc:ja?'Level 2 — Cursor Agent/Cline/Antigravity マルチファイル編集':'Level 2 — Cursor Agent/Cline/Antigravity multi-file editing'},
{label:ja?'マルチAgent協調':'Multi-Agent',desc:ja?'Level 2-3 — Antigravity Manager View/Sub-Agents並列実行':'Level 2-3 — Antigravity Manager View/Sub-Agents parallel exec'}]:[]),...(lv==='pro'?[{label:ja?'フル自律開発':'Full Autonomous',desc:ja?'Level 3 — Claude Code Subagents/Jules(非同期)/Agent Teams':'Level 3 — Claude Code Subagents/Jules(async)/Agent Teams'},
{label:ja?'オーケストレーター':'Orchestrator',desc:ja?'Agent Architect — CI/CD統合・本番パイプライン':'Agent Architect — CI/CD integration, prod pipeline'}]:[]),{label:ja?'なし':'None',desc:ja?'手動コーディング':'Manual coding'}],tip:ja?'2028年までに新規本番コードの40%がVibe Coding生成 (Gartner)':'40% of new production code via Vibe Coding by 2028 (Gartner)'},
{id:'payment',q:ja?'決済・CMS・EC ★v8':'Payment/CMS/EC ★v8',type:'chip-multi',chips:ja?['Stripe決済','Stripe Billing (サブスク)',...(lv!=='beginner'?['Paddle (SaaS MoR)','Lemon Squeezy (デジタル商品)','Polar (OSS収益化)']:[]),'microCMS (国産ヘッドレス)',...(lv!=='beginner'?['Strapi (OSS CMS)','Sanity','Contentful']:[]),...(lv==='pro'?['Medusa (OSS EC)','Shopify Hydrogen','Stripe Connect (マーケットプレイス)','Saleor (Python EC)']:[]),'なし']:['Stripe','Stripe Billing (Sub)',...(lv!=='beginner'?['Paddle (SaaS MoR)',
'Lemon Squeezy (Digital)','Polar (OSS Monetize)']:[]),'microCMS (JP Headless)',...(lv!=='beginner'?['Strapi (OSS CMS)','Sanity','Contentful']:[]),...(lv==='pro'?['Medusa (OSS EC)','Shopify Hydrogen','Stripe Connect (Marketplace)','Saleor (Python EC)']:[]),'None'],
placeholder:ja?'追加…':'Add...',tip:ja?'Stripeが最も導入しやすい。MoR=税務処理代行':'Stripe is easiest to integrate. MoR = tax handling',help:'payment'},
{id:'ai_tools',q:ja?'AIコーディングツール（複数可）':'AI Coding Tools (multi)',type:'chip-multi',condition:{ai_auto:v=>v&&!/none|なし/i.test(v)},chips:['Cursor','Claude Code','GitHub Copilot','Google Antigravity',...(lv!=='beginner'?['Windsurf','Cline/RooCode','Kiro','Gemini CLI','Aider','Amazon Q Developer']:[]),...(lv==='pro'?['Codex (OpenAI)','Augment Code','Bolt.new','Devin','Lovable','Continue.dev','Tabnine']:[])],placeholder:ja?'追加…':'Add...',tip:ja?'Cursor / Antigravity (IDE) + Claude Code (CLI) が最強コンビ':'Cursor / Antigravity (IDE) + Claude Code (CLI) is the strongest combo',help:'ai_tools'},
{id:'deploy',q:ja?'デプロイ先':'Deployment',type:'options',options:[{label:'Vercel',desc:ja?'Next.js最適・無料枠充実・Edge Functions':'Best for Next.js, generous free tier, Edge Functions'},{label:'Firebase Hosting',desc:ja?'Firebase統合・Google CDN':'Firebase integration, Google CDN'},...(lv!=='beginner'?[{label:'Cloudflare Pages',desc:ja?'エッジ最速・Workers統合':'Fastest edge, Workers integration'},{label:'Railway',desc:ja?'フルスタック簡単デプロイ・PostgreSQL付き':'Easy full-stack deploy with PostgreSQL'},
{label:'Fly.io',desc:ja?'Dockerベース・グローバルエッジ':'Docker-based, global edge'},{label:'Render',desc:ja?'フルスタック簡単デプロイ・無料枠あり':'Easy full-stack deploy, free tier'}]:[]),...(lv==='pro'?[{label:'AWS (EC2/ECS/Lambda)',desc:ja?'フルカスタム・IaC':'Full custom, IaC'},{label:ja?'Docker (自前)':'Docker (self-hosted)',desc:ja?'完全制御・K8s対応':'Full control, K8s ready'}]:[]),{label:'Netlify',desc:ja?'静的/JAMstack — 無料枠充実':'Static/JAMstack — generous free tier'}],tip:ja?'Vercel/Netlify無料枠で十分':'Vercel/Netlify free tiers are plenty',help:'deploy'},
{id:'dev_methods',q:ja?'駆動開発手法（複数可）':'Dev Methods (multi)',type:'chip-multi',chips:[...(lv==='beginner'?(ja?['TDD（テスト駆動）','BDD（振る舞い駆動）','SDD（仕様駆動）']:['TDD (Test-Driven)','BDD (Behavior-Driven)','SDD (Spec-Driven)']):(ja?['TDD（テスト駆動）','BDD（振る舞い駆動）','SDD（仕様駆動）','DDD（ドメイン駆動）','FDD（機能駆動）',...(lv==='pro'?['MDD（モデル駆動）']:[])]:['TDD (Test-Driven)','BDD (Behavior-Driven)','SDD (Spec-Driven)','DDD (Domain-Driven)','FDD (Feature-Driven)',...(lv==='pro'?['MDD (Model-Driven)']:[])]))],
placeholder:ja?'追加…':'Add...',tip:lv==='beginner'?(ja?'TDD + SDD がAI駆動開発の基本':'TDD + SDD are AI-driven dev basics'):(ja?'SDD→BDD→TDD→DDD の組み合わせが最強':'SDD→BDD→TDD→DDD combo is strongest'),help:'dev_methods'},
]},
3:{name:ja?'機能・データ設計':'Feature & Data Design',questions:[
{id:'mvp_features',q:ja?'MVP機能（3〜5個推奨）':'MVP Features (3-5 recommended)',type:'chip-multi',sortable:true,chips:ja?['ユーザー登録・ログイン','プロフィール編集','ダッシュボード','一覧表示・検索','詳細ページ','作成・編集・削除','ファイルアップロード','通知機能','お気に入り','コメント機能','シェア機能','設定画面',...(lv!=='beginner'?['API連携','管理画面','エクスポート','多言語','サブスクリプション']:[]),...(lv==='pro'?['リアルタイム同期','Webhook','RBAC','監査ログ','マルチテナント']:[])]
:['User Auth','Profile Edit','Dashboard','List & Search','Detail Page','CRUD','File Upload','Notifications','Favorites','Comments','Share','Settings',...(lv!=='beginner'?['API Integration','Admin Panel','Export','i18n','Subscription']:[]),...(lv==='pro'?['Realtime Sync','Webhook','RBAC','Audit Log','Multi-tenant']:[])],placeholder:ja?'追加…':'Add...',tip:ja?'3〜5個に絞りましょう':'Keep it to 3-5',help:'mvp_features'},
{id:'future_features',q:ja?'将来追加機能':'Future Features',type:'chip-multi',chips:ja?['課金・サブスク','チーム機能','カレンダー連携','チャット','分析レポート','AI機能','モバイルアプリ','API公開','外部連携','A/Bテスト']
:['Billing','Team features','Calendar','Chat','Analytics','AI features','Mobile app','Public API','Integrations','A/B testing'],placeholder:ja?'追加…':'Add...',tip:ja?'Phase 2, 3として計画':'Plan for Phase 2, 3',help:'future_features'},
{id:'data_entities',q:ja?'データテーブル':'Data Entities',type:'chip-multi',condition:{backend:v=>!/なし|None|static/i.test(v)},chips:['User','Post','Comment','Tag','Category','Product','Order','Task','Project','Message','Notification','File','Setting','Log',...(lv!=='beginner'?['Course','Lesson','Progress','Quiz','Certificate','Event','Group','Review','Invoice','Subscription']:[])],placeholder:ja?'追加…':'Add...',tip:ja?'英語・単数形が標準':'English, singular form is standard',help:'data_entities'},
{id:'auth',q:ja?'認証方式':'Authentication',type:'chip-multi',condition:{backend:v=>!/なし|None|static/i.test(v)},chips:ja?['メール/パスワード','Google OAuth','GitHub OAuth','Magic Link',...(lv!=='beginner'?['Auth.js/NextAuth','Clerk','Supabase Auth']:[]),...(lv==='pro'?['SSO/SAML','MFA','API Key']:[])]
:['Email/Password','Google OAuth','GitHub OAuth','Magic Link',...(lv!=='beginner'?['Auth.js/NextAuth','Clerk','Supabase Auth']:[]),...(lv==='pro'?['SSO/SAML','MFA','API Key']:[])],placeholder:'',tip:ja?'OAuth系は実装簡単でUX向上':'OAuth is easy to implement and improves UX',help:'auth'},
{id:'screens',q:ja?'主要画面':'Key Screens',type:'chip-multi',sortable:true,chips:ja?['ランディングページ','ログイン/登録','ダッシュボード','一覧ページ','詳細ページ','作成/編集フォーム','プロフィール','設定','404エラー','お問い合わせ',...(lv!=='beginner'?['管理画面','分析画面','オンボーディング']:[]),...(lv==='pro'?['APIドキュメント','ステータスページ','利用規約']:[])]
:['Landing Page','Login/Register','Dashboard','List Page','Detail Page','Create/Edit Form','Profile','Settings','404 Error','Contact',...(lv!=='beginner'?['Admin Panel','Analytics','Onboarding']:[]),...(lv==='pro'?['API Docs','Status Page','Terms of Service']:[])],placeholder:ja?'追加…':'Add...',tip:ja?'ワイヤーフレームを描くとスムーズ':'Wireframing helps a lot',help:'screens'},
{id:'skill_level',q:ja?'スキルレベル確認':'Confirm Skill Level',type:'options',help:'skill_level',options:[{label:'Beginner',desc:ja?'HTML/CSS学習中 — 初心者向けロードマップ':'Learning HTML/CSS — beginner roadmap'},{label:'Intermediate',desc:ja?'React/Node.js経験あり — 中級者パス':'React/Node.js experience — intermediate path'},{label:'Professional',desc:ja?'フルスタック実務経験 — プロ向け高度パス':'Full-stack production exp — advanced path'}],tip:ja?'ロードマップの難易度に影響します':'Affects roadmap difficulty'},
{id:'learning_goal',q:ja?'学習目標期間':'Learning Timeline',type:'options',help:'learning_goal',options:[{label:ja?'3ヶ月集中':'3 months intensive',desc:ja?'集中的に学習':'Focused learning'},{label:ja?'6ヶ月標準':'6 months standard',desc:ja?'バランスよく':'Balanced pace'},{label:ja?'12ヶ月じっくり':'12 months thorough',desc:ja?'深く理解':'Deep understanding'}],tip:ja?'ロードマップのペースに影響します':'Affects roadmap pace'},
{id:'learning_path',q:ja?'学習パターン ★v8':'Learning Pattern ★v8',type:'options',help:'learning_path',options:[{label:ja?'PERN Stack':'PERN Stack',desc:ja?'React+Node.js+PostgreSQL — 最も汎用的':'React+Node.js+PostgreSQL — most versatile'},{label:ja?'React + BaaS':'React + BaaS',desc:ja?'Firebase/Supabase — 最短ルート':'Firebase/Supabase — fastest route'},
...(lv!=='beginner'?[{label:ja?'フルスタック+モバイル':'Fullstack+Mobile',desc:ja?'React+Next.js+Expo — Web+Mobile統合':'React+Next.js+Expo — Web+Mobile unified'}]:[]),...(lv==='pro'?[{label:ja?'AI自律オーケストレーター':'AI Orchestrator',desc:ja?'Claude Code中心 — Agent Architect特化':'Claude Code focused — Agent Architect path'},
{label:ja?'SaaS収益化特化':'SaaS Monetization',desc:ja?'Stripe+microCMS+Next.js — 収益化パス':'Stripe+microCMS+Next.js — monetization path'}]:[])],tip:ja?'ロードマップの学習パスを決定します':'Determines your learning path'},
]},
};
}
/* ═══ TECH MASTER TABLE (dynamic count) ═══ */
const REQ_LABELS={
ja:{required:'必須',top1:'推奨No.1',top2:'推奨No.2','rec-jp':'推奨(JP)','rec-oss':'推奨(OSS)',recommended:'推奨',optional:'選択'},
en:{required:'Required',top1:'Top Pick',top2:'2nd Pick','rec-jp':'Rec (JP)','rec-oss':'Rec (OSS)',recommended:'Recommended',optional:'Optional'}
};
const PRICE_LABELS={
ja:{usage:'従量制',free:'無料','free-oss':'無料(OSS)','free-tier':'無料〜','free-15':'無料〜$15','free-19':'無料〜$19','free-20':'無料〜$20','free-23':'無料〜$23','free-25':'無料〜$25','free-26':'無料〜$26','free-39':'無料〜$39','free-99':'無料〜$99','free-100':'無料〜$100','free-105':'無料〜$105','free-300':'無料〜$300+','free-399':'無料〜$399','free-1295':'無料〜$1,295',paid:'有料','free(preview)':'無料(Preview)','pay-as-you-go':'従量課金','bundled':'IDE付属'},
en:{usage:'Usage-based',free:'Free','free-oss':'Free (OSS)','free-tier':'Free tier','free-15':'Free–$15','free-19':'Free–$19','free-20':'Free–$20','free-23':'Free–$23','free-25':'Free–$25','free-26':'Free–$26','free-39':'Free–$39','free-99':'Free–$99','free-100':'Free–$100','free-105':'Free–$105','free-300':'Free–$300+','free-399':'Free–$399','free-1295':'Free–$1,295',paid:'Paid','free(preview)':'Free (Preview)','pay-as-you-go':'Pay-as-you-go','bundled':'Bundled'}
};
function priceLabel(code){if(!code)return '';return (PRICE_LABELS[S.lang]||PRICE_LABELS.en)[code]||code;}
function reqLabel(code){return (REQ_LABELS[S.lang]||REQ_LABELS.en)[code]||code;}
const TECH_DB=[
// Languages
{name:'HTML5',cat:'lang',sub:'markup',req:'required',level:'all',weeks:'2-4'},
{name:'CSS3',cat:'lang',sub:'style',req:'required',level:'all',weeks:'3-6'},
{name:'JavaScript (ES6+)',cat:'lang',sub:'language',req:'required',level:'all',weeks:'4-12'},
{name:'TypeScript',cat:'lang',sub:'language',req:'required',level:'int',weeks:'2-4'},
{name:'SQL',cat:'lang',sub:'query',req:'required',level:'int',weeks:'2-4'},
{name:'Python',cat:'lang',sub:'language',req:'optional',level:'back',weeks:'4-8'},
{name:'Java',cat:'lang',sub:'language',req:'optional',level:'ent',weeks:'8-16'},
{name:'Go',cat:'lang',sub:'language',req:'optional',level:'perf',weeks:'4-8'},
{name:'Rust',cat:'lang',sub:'language',req:'optional',level:'sys',weeks:'8-16'},
{name:'GraphQL SDL',cat:'lang',sub:'query',req:'optional',level:'pro',weeks:'1-2'},
// Frontend (28)
{name:'React',cat:'front',sub:'fw',req:'top1',level:'int'},
{name:'Next.js',cat:'front',sub:'meta-fw',req:'recommended',level:'int'},
{name:'Vue 3',cat:'front',sub:'fw',req:'optional',level:'int'},
{name:'Nuxt',cat:'front',sub:'meta-fw',req:'optional',level:'int'},
{name:'Svelte',cat:'front',sub:'fw',req:'optional',level:'int'},
{name:'SvelteKit',cat:'front',sub:'meta-fw',req:'optional',level:'int'},
{name:'Angular',cat:'front',sub:'fw',req:'optional',level:'ent'},
{name:'Astro',cat:'front',sub:'fw',req:'optional',level:'content'},
{name:'Tailwind CSS',cat:'front',sub:'css-fw',req:'top1',level:'int'},
{name:'shadcn/ui',cat:'front',sub:'ui',req:'recommended',level:'int'},
{name:'React Router',cat:'front',sub:'routing',req:'required',level:'react'},
{name:'React Query',cat:'front',sub:'data',req:'recommended',level:'int'},
{name:'Zustand',cat:'front',sub:'state',req:'recommended',level:'int'},
{name:'Redux Toolkit',cat:'front',sub:'state',req:'optional',level:'large'},
{name:'Vite',cat:'front',sub:'build',req:'top1',level:'int'},
{name:'Vitest',cat:'front',sub:'test',req:'recommended',level:'int'},
{name:'Playwright',cat:'front',sub:'e2e',req:'recommended',level:'int'},
{name:'Storybook',cat:'front',sub:'ui-dev',req:'optional',level:'pro'},
{name:'ESLint',cat:'front',sub:'lint',req:'required',level:'int'},
{name:'Prettier',cat:'front',sub:'format',req:'required',level:'int'},
// Mobile (22)
{name:'React Native',cat:'mobile',sub:'fw',req:'top1',level:'int'},
{name:'Expo',cat:'mobile',sub:'platform',req:'top1',level:'int'},
{name:'Expo Router',cat:'mobile',sub:'routing',req:'recommended',level:'int'},
{name:'Expo SDK',cat:'mobile',sub:'sdk',req:'recommended',level:'int'},
{name:'EAS Build',cat:'mobile',sub:'build',req:'recommended',level:'int'},
{name:'EAS Submit',cat:'mobile',sub:'store',req:'recommended',level:'int'},
{name:'EAS Update (OTA)',cat:'mobile',sub:'update',req:'recommended',level:'int'},
{name:'NativeWind',cat:'mobile',sub:'css',req:'recommended',level:'int'},
{name:'Tamagui',cat:'mobile',sub:'ui',req:'optional',level:'universal'},
{name:'React Native Reanimated',cat:'mobile',sub:'animation',req:'recommended',level:'int'},
{name:'FlashList',cat:'mobile',sub:'list',req:'recommended',level:'perf'},
{name:'Maestro',cat:'mobile',sub:'e2e',req:'recommended',level:'pro'},
{name:'Flutter',cat:'mobile',sub:'alt-fw',req:'optional',level:'dart'},
// Backend (30)
{name:'Node.js',cat:'back',sub:'runtime',req:'top1',level:'int'},
{name:'Express',cat:'back',sub:'fw',req:'recommended',level:'int'},
{name:'Fastify',cat:'back',sub:'fw',req:'recommended',level:'int'},
{name:'NestJS',cat:'back',sub:'fw',req:'optional',level:'ent'},
{name:'Hono',cat:'back',sub:'fw',req:'optional',level:'edge'},
{name:'Django',cat:'back',sub:'fw',req:'optional',level:'py'},
{name:'FastAPI',cat:'back',sub:'fw',req:'optional',level:'py'},
{name:'Spring Boot',cat:'back',sub:'fw',req:'optional',level:'java'},
{name:'PostgreSQL',cat:'back',sub:'db',req:'top1',level:'int'},
{name:'MongoDB',cat:'back',sub:'db',req:'top2',level:'int'},
{name:'MySQL',cat:'back',sub:'db',req:'optional',level:'int'},
{name:'Redis',cat:'back',sub:'cache',req:'recommended',level:'int'},
{name:'Prisma',cat:'back',sub:'orm',req:'top1',level:'int'},
{name:'Drizzle',cat:'back',sub:'orm',req:'top2',level:'int'},
{name:'NextAuth.js / Auth.js',cat:'back',sub:'auth',req:'recommended',level:'int'},
{name:'JWT',cat:'back',sub:'auth-spec',req:'required',level:'int'},
{name:'OAuth 2.0',cat:'back',sub:'auth-spec',req:'recommended',level:'int'},
{name:'Socket.io',cat:'back',sub:'ws',req:'optional',level:'rt'},
{name:'GraphQL (Apollo)',cat:'back',sub:'api',req:'optional',level:'pro'},
{name:'Swagger/OpenAPI',cat:'back',sub:'doc',req:'recommended',level:'int'},
// BaaS (8)
{name:'Firebase',cat:'baas',sub:'full',req:'recommended',level:'mvp'},
{name:'Supabase',cat:'baas',sub:'full',req:'recommended',level:'sql'},
{name:'Vercel Edge Functions',cat:'baas',sub:'serverless',req:'optional',level:'front'},
{name:'Cloudflare Workers',cat:'baas',sub:'edge',req:'optional',level:'global'},
{name:'Neon',cat:'baas',sub:'db',req:'optional',level:'pg'},
// Payment/CMS/EC (22)
{name:'Stripe',cat:'payment',sub:'payment',req:'top1',level:'int',price:'2.9%+30¢'},
{name:'Stripe Billing',cat:'payment',sub:'subscription',req:'recommended',level:'int',price:'usage'},
{name:'Stripe Connect',cat:'payment',sub:'marketplace',req:'optional',level:'pro',price:'usage'},
{name:'Paddle',cat:'payment',sub:'mor',req:'optional',level:'int',price:'5%+50¢'},
{name:'Lemon Squeezy (Stripe)',cat:'payment',sub:'mor',req:'optional',level:'beg',price:'5%+50¢'},
{name:'Polar',cat:'payment',sub:'mor',req:'optional',level:'int',price:'5%+40¢'},
{name:'PayPal',cat:'payment',sub:'payment',req:'optional',level:'beg',price:'2.9%+30¢'},
{name:'microCMS',cat:'payment',sub:'cms',req:'rec-jp',level:'beg',price:'¥0〜¥4,900'},
{name:'Strapi',cat:'payment',sub:'cms',req:'rec-oss',level:'int',price:'free-15'},
{name:'Sanity',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-99'},
{name:'Contentful',cat:'payment',sub:'cms',req:'optional',level:'pro',price:'free-300'},
{name:'Payload',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-oss'},
{name:'Shopify Hydrogen',cat:'payment',sub:'ec',req:'optional',level:'pro',price:'$39〜'},
{name:'Medusa',cat:'payment',sub:'ec',req:'rec-oss',level:'int',price:'free'},
{name:'Saleor',cat:'payment',sub:'ec',req:'optional',level:'pro',price:'free-1295'},
{name:'Clerk',cat:'payment',sub:'auth',req:'optional',level:'int',price:'free-25'},
{name:'Auth0',cat:'payment',sub:'auth',req:'optional',level:'pro',price:'free-23'},
// DevOps (20)
{name:'Git',cat:'devops',sub:'vcs',req:'required',level:'all'},
{name:'GitHub',cat:'devops',sub:'platform',req:'required',level:'all'},
{name:'Docker',cat:'devops',sub:'container',req:'recommended',level:'int'},
{name:'Docker Compose',cat:'devops',sub:'orchestration',req:'recommended',level:'int'},
{name:'GitHub Actions',cat:'devops',sub:'ci',req:'recommended',level:'int'},
{name:'Vercel',cat:'devops',sub:'paas',req:'recommended',level:'int'},
{name:'Railway',cat:'devops',sub:'paas',req:'recommended',level:'int'},
{name:'AWS',cat:'devops',sub:'iaas',req:'optional',level:'pro'},
{name:'Kubernetes',cat:'devops',sub:'k8s',req:'optional',level:'pro'},
{name:'Terraform',cat:'devops',sub:'iac',req:'optional',level:'pro'},
{name:'Nginx',cat:'devops',sub:'web',req:'optional',level:'pro'},
{name:'Linux Basics',cat:'devops',sub:'os',req:'recommended',level:'int'},
// AI Tools (22)
{name:'Cursor',cat:'ai',sub:'ide',req:'top1',level:'int',price:'$20'},
{name:'Claude Code',cat:'ai',sub:'cli',req:'recommended',level:'int',price:'$20〜$200'},
{name:'GitHub Copilot',cat:'ai',sub:'ext',req:'recommended',level:'beg',price:'$10〜$39'},
{name:'Windsurf',cat:'ai',sub:'ide',req:'optional',level:'int',price:'free-15'},
{name:'Gemini CLI',cat:'ai',sub:'cli',req:'optional',level:'int',price:'free'},
{name:'Cline / RooCode',cat:'ai',sub:'ext',req:'optional',level:'pro',price:'usage'},
{name:'Kiro',cat:'ai',sub:'ide',req:'optional',level:'int',price:'$20'},
{name:'Codex (OpenAI)',cat:'ai',sub:'cli',req:'optional',level:'pro',price:'$20'},
{name:'CLAUDE.md',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'.cursor/rules',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'AGENTS.md',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'MCP',cat:'ai',sub:'protocol',req:'recommended',level:'int'},
{name:'Spec Kit',cat:'ai',sub:'sdd',req:'recommended',level:'int'},
// AI Autonomous (18)
{name:'Devin',cat:'ai_auto',sub:'autonomous',req:'optional',level:'pro',price:'$20〜$500'},
{name:'Replit Agent',cat:'ai_auto',sub:'browser',req:'optional',level:'beg',price:'$25'},
{name:'Claude Code Subagents',cat:'ai_auto',sub:'parallel',req:'optional',level:'pro'},
{name:'Claude Code Tasks',cat:'ai_auto',sub:'dag',req:'optional',level:'pro'},
{name:'Claude-Flow',cat:'ai_auto',sub:'orchestrator',req:'optional',level:'pro'},
{name:'Lovable',cat:'ai_auto',sub:'generator',req:'optional',level:'beg',price:'$25'},
{name:'Bolt.new',cat:'ai_auto',sub:'generator',req:'optional',level:'beg',price:'free-oss'},
{name:'v0 (Vercel)',cat:'ai_auto',sub:'ui-gen',req:'optional',level:'int',price:'$20'},
{name:'Codex App (OpenAI)',cat:'ai_auto',sub:'agentic',req:'optional',level:'pro',price:'$20'},
// ── Additional Languages (6) ──
{name:'C#',cat:'lang',sub:'language',req:'optional',level:'dotnet',weeks:'6-12'},
{name:'PHP',cat:'lang',sub:'language',req:'optional',level:'wp',weeks:'4-8'},
{name:'Ruby',cat:'lang',sub:'language',req:'optional',level:'rails',weeks:'4-8'},
{name:'Markdown',cat:'lang',sub:'markup',req:'required',level:'all',weeks:'1d'},
{name:'JSON',cat:'lang',sub:'data',req:'required',level:'all',weeks:'1d'},
{name:'YAML',cat:'lang',sub:'config',req:'recommended',level:'int',weeks:'1d'},
// ── Additional Frontend (8) ──
{name:'Bootstrap',cat:'front',sub:'css-fw',req:'optional',level:'legacy'},
{name:'Radix UI',cat:'front',sub:'ui',req:'optional',level:'a11y'},
{name:'Framer Motion',cat:'front',sub:'animation',req:'optional',level:'pro'},
{name:'GSAP',cat:'front',sub:'animation',req:'optional',level:'pro'},
{name:'React Testing Library',cat:'front',sub:'test',req:'recommended',level:'int'},
{name:'Figma',cat:'front',sub:'design',req:'recommended',level:'int'},
{name:'Chrome DevTools',cat:'front',sub:'debug',req:'required',level:'all'},
{name:'React DevTools',cat:'front',sub:'debug',req:'required',level:'react'},
// ── Additional Mobile (9) ──
{name:'EAS Workflows',cat:'mobile',sub:'ci',req:'recommended',level:'pro'},
{name:'React Native Gesture Handler',cat:'mobile',sub:'gesture',req:'recommended',level:'int'},
{name:'Detox',cat:'mobile',sub:'e2e',req:'optional',level:'pro'},
{name:'React Native DevTools',cat:'mobile',sub:'debug',req:'required',level:'int'},
{name:'Hermes V1',cat:'mobile',sub:'engine',req:'required',level:'all'},
{name:'Expo Modules API',cat:'mobile',sub:'native',req:'optional',level:'pro'},
{name:'Config Plugins',cat:'mobile',sub:'native-config',req:'recommended',level:'int'},
{name:'Swift/Kotlin (Native)',cat:'mobile',sub:'native-dev',req:'optional',level:'pro'},
{name:'Expo Go',cat:'mobile',sub:'dev-tool',req:'recommended',level:'beg'},
// ── Additional Backend (10) ──
{name:'Flask',cat:'back',sub:'fw',req:'optional',level:'py'},
{name:'Gin',cat:'back',sub:'fw',req:'optional',level:'go'},
{name:'SQLite',cat:'back',sub:'db',req:'optional',level:'embed'},
{name:'TypeORM',cat:'back',sub:'orm',req:'optional',level:'int'},
{name:'SQLAlchemy',cat:'back',sub:'orm',req:'recommended',level:'py'},
{name:'Passport.js',cat:'back',sub:'auth',req:'recommended',level:'int'},
{name:'bcrypt / argon2',cat:'back',sub:'crypto',req:'required',level:'int'},
{name:'Bull/BullMQ',cat:'back',sub:'queue',req:'optional',level:'int'},
{name:'Postman',cat:'back',sub:'api-test',req:'recommended',level:'int'},
{name:'Jest / Pytest',cat:'back',sub:'test',req:'recommended',level:'int'},
// ── Additional BaaS (3) ──
{name:'AWS Lambda',cat:'baas',sub:'serverless',req:'optional',level:'aws'},
{name:'AWS Amplify',cat:'baas',sub:'full',req:'optional',level:'aws'},
{name:'Convex',cat:'baas',sub:'reactive',req:'optional',level:'rt'},
// ── Additional Payment/CMS/EC (5) ──
{name:'Prismic',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-100'},
{name:'Hygraph',cat:'payment',sub:'cms',req:'optional',level:'pro',price:'free-399'},
{name:'Storyblok',cat:'payment',sub:'cms',req:'optional',level:'int',price:'free-105'},
{name:'Vendure',cat:'payment',sub:'ec',req:'optional',level:'pro',price:'free-oss'},
{name:'WooCommerce',cat:'payment',sub:'ec',req:'optional',level:'beg',price:'free'},
// ── Additional DevOps (9) ──
{name:'Fly.io',cat:'devops',sub:'paas',req:'optional',level:'int'},
{name:'Netlify',cat:'devops',sub:'paas',req:'optional',level:'static'},
{name:'GCP (Cloud Run)',cat:'devops',sub:'iaas',req:'optional',level:'pro'},
{name:'PM2',cat:'devops',sub:'process',req:'optional',level:'node'},
{name:'Prometheus',cat:'devops',sub:'monitor',req:'optional',level:'pro'},
{name:'Grafana',cat:'devops',sub:'viz',req:'optional',level:'pro'},
{name:'Let\'s Encrypt',cat:'devops',sub:'ssl',req:'recommended',level:'prod'},
{name:'Cloudflare',cat:'devops',sub:'cdn',req:'optional',level:'pro'},
// ── Additional AI Tools (10) ──
{name:'Claude (Chat)',cat:'ai',sub:'chat',req:'recommended',level:'all',price:'$20'},
{name:'ChatGPT',cat:'ai',sub:'chat',req:'optional',level:'all',price:'$20'},
{name:'Gemini',cat:'ai',sub:'chat',req:'optional',level:'all',price:'free-20'},
{name:'skills.md',cat:'ai',sub:'config',req:'recommended',level:'int'},
{name:'Hooks',cat:'ai',sub:'automation',req:'optional',level:'pro'},
{name:'Conductor',cat:'ai',sub:'parallel',req:'optional',level:'pro'},
{name:'Vibe Kanban',cat:'ai',sub:'agent-mgmt',req:'optional',level:'pro'},
{name:'Context7',cat:'ai',sub:'mcp-server',req:'recommended',level:'int'},
{name:'Playwright MCP',cat:'ai',sub:'test-mcp',req:'recommended',level:'int'},
{name:'VS Code',cat:'ai',sub:'editor',req:'required',level:'all',price:'free'},
// ── Additional AI Autonomous (10) ──
{name:'Zencoder/Zenflow',cat:'ai_auto',sub:'spec-agent',req:'optional',level:'pro',price:'paid'},
{name:'Kilo Code',cat:'ai_auto',sub:'precision',req:'optional',level:'pro',price:'paid'},
{name:'Continue.dev',cat:'ai_auto',sub:'oss',req:'optional',level:'int',price:'free'},
{name:'Claude Code Agent Teams',cat:'ai_auto',sub:'multi-agent',req:'optional',level:'pro'},
{name:'Claude Code Swarms',cat:'ai_auto',sub:'swarm',req:'optional',level:'pro'},
{name:'Claude Code Headless',cat:'ai_auto',sub:'ci-cd',req:'optional',level:'pro'},
{name:'Gas Town',cat:'ai_auto',sub:'k8s-agents',req:'optional',level:'pro'},
{name:'Multiclaude',cat:'ai_auto',sub:'team',req:'optional',level:'pro'},
{name:'CodeGPT',cat:'ai_auto',sub:'fullstack',req:'optional',level:'int',price:'paid'},
{name:'Manus',cat:'ai_auto',sub:'autonomous',req:'optional',level:'pro',price:'paid'},
{name:'Google Antigravity',cat:'ai',sub:'ide',req:'optional',level:'int',price:'free(preview)'},
{name:'OpenRouter',cat:'ai',sub:'router',req:'optional',level:'int',price:'pay-as-you-go'},
{name:'Augment Code',cat:'ai',sub:'ide',req:'optional',level:'pro',price:'$20〜$250'},
{name:'Aider',cat:'ai',sub:'cli',req:'optional',level:'int',price:'free-oss'},
{name:'Jules (Google)',cat:'ai_auto',sub:'async-agent',req:'optional',level:'int',price:'free'},
{name:'Amazon Q Developer',cat:'ai',sub:'ext',req:'optional',level:'int',price:'free-19'},
{name:'Gemini Code Assist',cat:'ai',sub:'ext',req:'optional',level:'int',price:'free-tier'},
{name:'JetBrains Junie',cat:'ai',sub:'ext',req:'optional',level:'int',price:'bundled'},
{name:'Tabnine',cat:'ai',sub:'ext',req:'optional',level:'int',price:'free-39'},
{name:'Qwen3-Coder',cat:'ai_auto',sub:'oss-model',req:'optional',level:'pro',price:'free-oss'},
{name:'DeepSeek V3.2',cat:'ai_auto',sub:'oss-model',req:'optional',level:'pro',price:'free-oss'},
// ── Design & Methodology (12) ──
{name:'TDD',cat:'method',sub:'methodology',req:'recommended',level:'int'},
{name:'BDD',cat:'method',sub:'methodology',req:'recommended',level:'int'},
{name:'DDD',cat:'method',sub:'methodology',req:'recommended',level:'pro'},
{name:'FDD',cat:'method',sub:'methodology',req:'optional',level:'int'},
{name:'MDD',cat:'method',sub:'methodology',req:'optional',level:'int'},
{name:'SDD',cat:'method',sub:'methodology',req:'recommended',level:'int'},
{name:'Clean Architecture',cat:'method',sub:'pattern',req:'recommended',level:'pro'},
{name:'Microservices',cat:'method',sub:'pattern',req:'optional',level:'pro'},
{name:'Monorepo (Turborepo)',cat:'method',sub:'structure',req:'optional',level:'pro'},
{name:'Conventional Commits',cat:'method',sub:'convention',req:'recommended',level:'int'},
{name:'Semantic Versioning',cat:'method',sub:'convention',req:'recommended',level:'int'},
{name:'Agile / Scrum',cat:'method',sub:'process',req:'recommended',level:'all'},
// ── Testing & Quality (8) ──
{name:'Cypress',cat:'test',sub:'e2e',req:'optional',level:'int'},
{name:'Testing Library',cat:'test',sub:'unit',req:'recommended',level:'int'},
{name:'MSW (Mock Service Worker)',cat:'test',sub:'mock',req:'recommended',level:'int'},
{name:'Faker.js',cat:'test',sub:'data',req:'optional',level:'int'},
{name:'Lighthouse CI',cat:'test',sub:'perf',req:'recommended',level:'int'},
{name:'Sentry',cat:'test',sub:'monitor',req:'recommended',level:'int',price:'free-26'},
{name:'SonarQube',cat:'test',sub:'quality',req:'optional',level:'pro'},
{name:'Codecov',cat:'test',sub:'coverage',req:'optional',level:'int'},
// ── API & Communication (6) ──
{name:'tRPC',cat:'api',sub:'typesafe',req:'optional',level:'int'},
{name:'Hono',cat:'api',sub:'edge-fw',req:'optional',level:'edge'},
{name:'Zod',cat:'api',sub:'validation',req:'recommended',level:'int'},
{name:'Axios',cat:'api',sub:'http',req:'optional',level:'int'},
{name:'WebSocket',cat:'api',sub:'realtime',req:'optional',level:'int'},
{name:'Server-Sent Events',cat:'api',sub:'realtime',req:'optional',level:'int'},
// ── Build & Toolchain (6) ──
{name:'Turbopack',cat:'build',sub:'bundler',req:'optional',level:'next'},
{name:'esbuild',cat:'build',sub:'bundler',req:'optional',level:'pro'},
{name:'SWC',cat:'build',sub:'compiler',req:'recommended',level:'int'},
{name:'pnpm',cat:'build',sub:'pkgmgr',req:'recommended',level:'int'},
{name:'Turborepo',cat:'build',sub:'monorepo',req:'optional',level:'pro'},
{name:'Changesets',cat:'build',sub:'versioning',req:'optional',level:'pro'},
// ── Data & Analytics (6) ──
{name:'Drizzle Studio',cat:'data',sub:'gui',req:'optional',level:'int'},
{name:'Prisma Studio',cat:'data',sub:'gui',req:'recommended',level:'int'},
{name:'PostHog',cat:'data',sub:'analytics',req:'optional',level:'int',price:'free-tier'},
{name:'Plausible',cat:'data',sub:'analytics',req:'optional',level:'int',price:'$9〜'},
{name:'Vercel Analytics',cat:'data',sub:'analytics',req:'recommended',level:'int',price:'free-tier'},
{name:'OpenTelemetry',cat:'data',sub:'observability',req:'optional',level:'pro'},
// ── Security (6) ──
{name:'Helmet.js',cat:'security',sub:'headers',req:'recommended',level:'int'},
{name:'CORS',cat:'security',sub:'policy',req:'required',level:'int'},
{name:'CSP',cat:'security',sub:'policy',req:'recommended',level:'int'},
{name:'rate-limiter-flexible',cat:'security',sub:'ratelimit',req:'recommended',level:'int'},
{name:'npm audit',cat:'security',sub:'deps',req:'required',level:'all'},
{name:'Snyk',cat:'security',sub:'scanning',req:'optional',level:'pro',price:'free-tier'},
];
const _TECH_COUNT=TECH_DB.length;
/* ═══ HELP DATA ═══ */
const HELP_DATA={
purpose:{
ja:{title:'プロジェクトの目的',desc:'「誰が・何を・なぜ」使うのかを1文で表現しましょう。',example:'例: "フリーランスが見積書を5分で作成できるSaaS"'},
en:{title:'Project Purpose',desc:'Express "who uses what and why" in one sentence.',example:'e.g. "A SaaS where freelancers create invoices in 5 min"'}
},
target:{
ja:{title:'ターゲットユーザー',desc:'具体的なペルソナを2〜3人イメージすると設計がブレません。',example:'例: "30代エンジニア、副業で受注管理に困っている"'},
en:{title:'Target Users',desc:'Imagine 2-3 specific personas to keep your design focused.',example:'e.g. "30s engineer struggling with freelance order management"'}
},
success:{
ja:{title:'成功指標（KPI）',desc:'プロジェクト種別に応じた指標を自動提案。📈成長 💰収益 🔄継続 😊満足 ⚡技術 の10カテゴリから3〜5つ選択。',example:'例: EC→"GMV月100万" / 教育→"完了率80%+"'},
en:{title:'Success Metrics (KPI)',desc:'Auto-suggested by project type. Pick 3-5 from 10 categories: 📈Growth 💰Revenue 🔄Retention 😊Satisfaction ⚡Perf.',example:'e.g. EC→"$10K GMV" / Education→"80%+ completion"'}
},
scope_out:{
ja:{title:'スコープ外',desc:'「やらないこと」を決めるのがMVP成功の鍵。',example:'例: "v1ではモバイルアプリは作らない"'},
en:{title:'Out of Scope',desc:'Deciding what NOT to do is key to MVP success.',example:'e.g. "No mobile app in v1"'}
},
deadline:{
ja:{title:'リリース目標',desc:'2週間=超MVP、1ヶ月=基本MVP、3ヶ月=本格版。',example:'TIP: 2週間でまずデプロイ、その後改善サイクルが最速'},
en:{title:'Release Target',desc:'2 weeks = ultra MVP, 1 month = basic MVP, 3 months = full version.',example:'TIP: Deploy in 2 weeks first, then iterate fast'}
},
frontend:{
ja:{title:'フロントエンド',desc:'既に知っている技術を選ぶのが最速。',example:'初心者→React、SSR→Next.js',link:'https://stateofjs.com'},
en:{title:'Frontend',desc:'Choosing a tech you already know is fastest.',example:'Beginner→React, SSR→Next.js',link:'https://stateofjs.com'}
},
backend:{
ja:{title:'バックエンド/DB',desc:'BaaS(Firebase/Supabase)はサーバーコード不要で最速。',example:'静的サイト→なし、認証あり→Firebase/Supabase'},
en:{title:'Backend/DB',desc:'BaaS (Firebase/Supabase) needs no server code — fastest path.',example:'Static→None, Auth needed→Firebase/Supabase'}
},
ai_tools:{
ja:{title:'AIツール',desc:'Cursor/Antigravity=AI IDE、Claude Code/Aider=CLI、Copilot/Tabnine=補完拡張、OpenRouter=API統合ハブ。',example:'推奨: Cursor or Antigravity + Claude Code'},
en:{title:'AI Tools',desc:'Cursor/Antigravity=AI IDE, Claude Code/Aider=CLI, Copilot/Tabnine=completion ext, OpenRouter=API hub.',example:'Recommended: Cursor or Antigravity + Claude Code'}
},
deploy:{
ja:{title:'デプロイ先',desc:'Vercel/Netlify=無料枠で十分。',example:'Next.js→Vercel、静的→Netlify'},
en:{title:'Deployment',desc:'Vercel/Netlify free tier is enough to start.',example:'Next.js→Vercel, Static→Netlify'}
},
dev_methods:{
ja:{title:'駆動開発手法',desc:'TDD=テスト先行、BDD=振る舞い設計、DDD=ドメインモデル中心。',example:'推奨: TDD（必須）+ BDD'},
en:{title:'Dev Methodologies',desc:'TDD=test-first, BDD=behavior-driven, DDD=domain-model-centric.',example:'Recommended: TDD (essential) + BDD'}
},
mvp_features:{
ja:{title:'MVP機能',desc:'3〜5個に絞る。「これがないと使えない」機能だけ選択。',example:'最小: 認証 + メイン機能1つ + 設定'},
en:{title:'MVP Features',desc:'Narrow to 3-5. Only pick features users cannot live without.',example:'Minimum: Auth + 1 core feature + Settings'}
},
future_features:{
ja:{title:'将来追加機能',desc:'Phase 2, 3として計画。MVPリリース後に再評価。',example:'課金→PMF確認後、モバイル→DAU 1000+時'},
en:{title:'Future Features',desc:'Plan as Phase 2-3. Re-evaluate after MVP launch.',example:'Billing→after PMF, Mobile→at DAU 1000+'}
},
data_entities:{
ja:{title:'データテーブル',desc:'英語・単数形・PascalCaseが標準。',example:'User, Post, Comment（Usersではなく単数形）'},
en:{title:'Data Tables',desc:'English, singular, PascalCase is standard.',example:'User, Post, Comment (singular, not Users)'}
},
auth:{
ja:{title:'認証方式',desc:'OAuth(Google/GitHub)は実装簡単でUX向上。',example:'最小: メール/PW + Google OAuth'},
en:{title:'Authentication',desc:'OAuth (Google/GitHub) is easy to implement and improves UX.',example:'Minimum: Email/PW + Google OAuth'}
},
screens:{
ja:{title:'主要画面',desc:'ユーザーフローに沿って画面を洗い出し。',example:'LP → ログイン → ダッシュボード → 詳細'},
en:{title:'Key Screens',desc:'Map out screens following the user flow.',example:'LP → Login → Dashboard → Detail'}
},
payment:{
ja:{title:'決済・CMS・EC',desc:'Stripe=最も導入しやすい。MoR=税務処理代行。',example:'SaaS→Stripe、グローバル→Paddle'},
en:{title:'Payment/CMS/EC',desc:'Stripe is easiest to integrate. MoR = Merchant of Record (handles tax).',example:'SaaS→Stripe, Global→Paddle'}
},
css_fw:{
ja:{title:'CSSフレームワーク',desc:'Tailwind CSSが2026年の事実上の標準。ユーティリティファーストで高速開発。',example:'推奨: Tailwind CSS + shadcn/ui'},
en:{title:'CSS Framework',desc:'Tailwind CSS is the de facto standard in 2026. Utility-first for rapid dev.',example:'Recommended: Tailwind CSS + shadcn/ui'}
},
orm:{
ja:{title:'ORM',desc:'ORMはデータベース操作を型安全に行うためのツール。BaaS使用時は不要。',example:'推奨: Prisma (型安全・Studio付き)'},
en:{title:'ORM',desc:'ORM enables type-safe database operations. Not needed with BaaS.',example:'Recommended: Prisma (type-safe, Studio included)'}
},
learning_path:{
ja:{title:'学習パターン',desc:'技術スタックの組み合わせに基づいた学習パスを選択。',example:'初心者→BaaS、中級→PERN、上級→AI Orchestrator'},
en:{title:'Learning Path',desc:'Choose a learning path based on your tech stack combination.',example:'Beginner→BaaS, Intermediate→PERN, Advanced→AI Orchestrator'}
},
skill_level:{
ja:{title:'スキルレベル',desc:'選択により質問の選択肢が動的に変化します。Beginner=基本選択肢のみ、Intermediate=中級選択肢追加、Pro=全選択肢解放。途中変更は非推奨。',example:'迷ったらIntermediate。後から選択肢が足りなければProに変更可能'},
en:{title:'Skill Level',desc:'Your choice dynamically adjusts available options. Beginner=basic options only, Intermediate=adds mid-level options, Pro=unlocks all. Avoid changing mid-project.',example:'If unsure, pick Intermediate. You can switch to Pro later if needed'}
},
database:{
ja:{title:'データベース',desc:'PostgreSQL=本格的なRDB（Supabase/Neonで無料運用可）、SQLite=ローカル/組込み用途、MongoDB=NoSQL柔軟なスキーマ。BaaS選択時はBaaS側のDBが使われるため不要。',example:'迷ったらPostgreSQL + Prisma。Supabaseなら無料で本番運用可能'},
en:{title:'Database',desc:'PostgreSQL=production RDB (free via Supabase/Neon), SQLite=local/embedded, MongoDB=NoSQL flexible schema. Not needed if using BaaS (BaaS provides its own DB).',example:'Default: PostgreSQL + Prisma. Supabase offers free production hosting'}
},
mobile:{
ja:{title:'モバイル対応',desc:'PWA=Webベースでインストール不要、Expo=React Native簡易構築（EAS Build対応）、React Native=ネイティブ制御が必要な場合。モバイル不要なら「なし」でOK。',example:'まずPWAで検証、ストア配信が必要になったらExpoに移行が最速ルート'},
en:{title:'Mobile Support',desc:'PWA=web-based no install needed, Expo=simplified React Native (EAS Build), React Native=when native control needed. Select "None" if mobile is not required.',example:'Start with PWA for validation, migrate to Expo when store distribution is needed'}
},
ai_auto:{
ja:{title:'AI自律開発レベル',desc:'Vibe Coding=AIにざっくり指示してコード生成、Agentic Dev=Cursor Agent/Cline等がマルチファイル自動編集、Multi-Agent=複数Agentが並列作業、Full Autonomous=Claude Code Subagents/Jules等で非同期自律開発。',example:'初心者→Vibe Coding、中級→Agentic Dev、上級→Multi-Agent以上'},
en:{title:'AI Autonomous Level',desc:'Vibe Coding=rough instructions to AI, Agentic Dev=Cursor Agent/Cline multi-file editing, Multi-Agent=parallel agent work, Full Autonomous=Claude Code Subagents/Jules async development.',example:'Beginner→Vibe Coding, Intermediate→Agentic Dev, Advanced→Multi-Agent+'}
},
learning_goal:{
ja:{title:'学習目標',desc:'このプロジェクトで習得したい技術領域を選択。選択に応じてロードマップの学習パスが最適化されます。',example:'「フルスタック開発」を選ぶとフロントからデプロイまで網羅的なパスが生成されます'},
en:{title:'Learning Goal',desc:'Select the technical area you want to master through this project. The roadmap learning path optimizes based on your selection.',example:'Choosing "Full-Stack Dev" generates a comprehensive path from frontend to deployment'}
},
};
/* ═══ STACK COMPATIBILITY & SEMANTIC CONSISTENCY RULES — 54 rules (ERROR×11 + WARN×34 + INFO×9) ═══ */
const COMPAT_RULES=[
// ── FE ↔ Mobile (2 ERROR) ──
{id:'fe-mob-expo',p:['frontend','mobile'],lv:'error',
t:a=>inc(a.mobile,'Expo')&&!inc(a.frontend,'React'),
ja:'ExpoはReact Native専用です。フロントをReact系に変更してください',
en:'Expo requires React. Change frontend to a React-based option',
fix:{f:'frontend',s:'React + Next.js'}},
{id:'fe-mob-astro',p:['frontend','mobile'],lv:'error',
t:a=>inc(a.frontend,'Astro')&&inc(a.mobile,'Expo'),
ja:'AstroはSSG専用でExpoと併用できません。React + Next.jsを推奨',
en:'Astro is SSG-only and incompatible with Expo. Use React + Next.js',
fix:{f:'frontend',s:'React + Next.js'}},
{id:'be-mobile-static',p:['backend','mobile'],lv:'info',
t:a=>isStaticBE(a)&&a.mobile&&!inc(a.mobile,'なし')&&!inc(a.mobile,'None')&&a.mobile!=='none'&&!inc(a.mobile,'PWA'),
ja:'モバイルアプリにはAPI用バックエンドが必要です。Supabase/Firebase等のBaaSを検討してください',
en:'Mobile apps need an API backend. Consider BaaS like Supabase/Firebase',
fix:{f:'backend',s:'Supabase'}},
// ── Mobile ↔ Auth (2 WARN) ──
{id:'mob-noauth',p:['mobile','auth'],lv:'warn',
t:a=>{
if(!a.mobile||!a.auth)return false;
const hasMobile=a.mobile&&!inc(a.mobile,'なし')&&!inc(a.mobile,'None')&&a.mobile!=='none'&&!inc(a.mobile,'PWA');
const hasAuth=a.auth&&!inc(a.auth,'なし')&&!inc(a.auth,'None')&&a.auth!=='none';
return hasMobile&&!hasAuth;
},
ja:'モバイルアプリでは認証がほぼ必須です。Supabase Auth/Firebase Auth推奨',
en:'Mobile apps almost always need authentication. Use Supabase Auth/Firebase Auth',
fix:{f:'auth',s:'Supabase Auth'}},
{id:'mob-auth-nextauth',p:['mobile','auth'],lv:'warn',
t:a=>a.mobile&&inc(a.mobile,'Expo')&&inc(a.auth,'NextAuth'),
ja:'NextAuthはWeb専用。React Nativeには@react-native-google-signin等のアダプター必要',
en:'NextAuth is web-only. React Native needs adapters like @react-native-google-signin',
fix:{f:'auth',s:'Supabase Auth'}},
// ── BE ↔ ORM (3 ERROR, 1 WARN) ──
{id:'be-orm-py-prisma',p:['backend','orm'],lv:'error',
t:a=>isPyBE(a)&&inc(a.orm,'Prisma')||isPyBE(a)&&inc(a.orm,'Drizzle')||isPyBE(a)&&inc(a.orm,'TypeORM'),
ja:'Prisma/Drizzle/TypeORMはNode.js専用です。SQLAlchemyを選択してください',
en:'Prisma/Drizzle/TypeORM are Node.js-only. Choose SQLAlchemy',
fix:{f:'orm',s:'SQLAlchemy (Python)'}},
{id:'be-orm-java-prisma',p:['backend','orm'],lv:'error',
t:a=>(inc(a.backend,'Java')||inc(a.backend,'Go'))&&(inc(a.orm,'Prisma')||inc(a.orm,'Drizzle')),
ja:'Prisma/DrizzleはNode.js/TypeScript専用です',
en:'Prisma/Drizzle are Node.js/TypeScript-only',
fix:{f:'orm',s:'None / Using BaaS'}},
{id:'be-orm-node-sqla',p:['backend','orm'],lv:'error',
t:a=>isNodeBE(a)&&inc(a.orm,'SQLAlchemy'),
ja:'SQLAlchemyはPython専用です。Prisma/Drizzleを選択してください',
en:'SQLAlchemy is Python-only. Choose Prisma or Drizzle',
fix:{f:'orm',s:'Prisma'}},
{id:'be-orm-static',p:['backend','orm'],lv:'warn',
t:a=>isStaticBE(a)&&a.orm&&!inc(a.orm,'なし')&&!inc(a.orm,'None')&&a.orm!=='none',
ja:'静的サイトではORMは不要です',
en:'ORM is unnecessary for static sites',
fix:{f:'orm',s:'None / Using BaaS'}},
// ── BE ↔ DB (4 WARN) ──
{id:'be-db-fb-notfs',p:['backend','database'],lv:'warn',
t:a=>inc(a.backend,'Firebase')&&a.database&&!inc(a.database,'Firestore'),
ja:'Firebase利用時はFirestoreが最適です',
en:'Firestore is the optimal DB for Firebase',
fix:{f:'database',s:'Firestore'}},
{id:'be-db-supa-notpg',p:['backend','database'],lv:'warn',
t:a=>inc(a.backend,'Supabase')&&a.database&&!inc(a.database,'Supabase')&&!inc(a.database,'PostgreSQL')&&!inc(a.database,'Neon'),
ja:'Supabase利用時はSupabase (PostgreSQL)が統合されています',
en:'Supabase integrates best with Supabase (PostgreSQL)',
fix:{f:'database',s:'Supabase (PostgreSQL)'}},
{id:'be-db-static-db',p:['backend','database'],lv:'warn',
t:a=>isStaticBE(a)&&a.database&&!inc(a.database,'なし')&&a.database!=='None',
ja:'静的サイトではDBは通常不要です',
en:'Static sites typically do not need a database',
fix:{f:'database',s:'None'}},
{id:'be-db-py-fs',p:['backend','database'],lv:'warn',
t:a=>isPyBE(a)&&inc(a.database,'Firestore'),
ja:'PythonとFirestoreの相性は中程度。PostgreSQLが推奨です',
en:'Python + Firestore compatibility is moderate. PostgreSQL recommended',
fix:{f:'database',s:'PostgreSQL'}},
// ── BE ↔ Deploy (5 WARN) ──
{id:'be-dep-java-vercel',p:['backend','deploy'],lv:'warn',
t:a=>(inc(a.backend,'Java')||inc(a.backend,'Go'))&&inc(a.deploy,'Vercel'),
ja:'VercelはNode.js/Python前提です。Railway/AWS/Dockerが必要',
en:'Vercel supports Node.js/Python. Use Railway/AWS/Docker for Java/Go',
fix:{f:'deploy',s:'Railway'}},
{id:'be-dep-fb-notfbh',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'Firebase')&&a.deploy&&!inc(a.deploy,'Firebase'),
ja:'Firebase利用時はFirebase Hostingが最適です',
en:'Firebase Hosting is optimal when using Firebase backend',
fix:{f:'deploy',s:'Firebase Hosting'}},
{id:'be-dep-supa-fbh',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'Supabase')&&inc(a.deploy,'Firebase'),
ja:'SupabaseにはVercelまたはSupabase Hostingが推奨です',
en:'Use Vercel or Supabase Hosting with Supabase backend',
fix:{f:'deploy',s:'Vercel'}},
{id:'be-dep-nest-vercel',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'NestJS')&&inc(a.deploy,'Vercel'),
ja:'NestJSのサーバーレスデプロイは制限があります。Railwayが推奨',
en:'NestJS serverless deploys have limitations. Railway recommended',
fix:{f:'deploy',s:'Railway'}},
{id:'be-dep-django-vercel',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.backend,'Django')&&inc(a.deploy,'Vercel'),
ja:'DjangoのVercelデプロイは制限あり。Railway/Fly.ioが推奨',
en:'Django on Vercel has limitations. Railway/Fly.io recommended',
fix:{f:'deploy',s:'Railway'}},
// ── FE ↔ Deploy (2 WARN) ──
{id:'fe-dep-angular-vercel',p:['frontend','deploy'],lv:'warn',
t:a=>inc(a.frontend,'Angular')&&inc(a.deploy,'Vercel'),
ja:'AngularのVercel対応は限定的。Firebase HostingまたはAWSが推奨',
en:'Angular on Vercel is limited. Use Firebase Hosting or AWS',
fix:{f:'deploy',s:'Firebase Hosting'}},
{id:'fe-dep-nuxt-fbh',p:['frontend','deploy'],lv:'warn',
t:a=>inc(a.frontend,'Nuxt')&&inc(a.deploy,'Firebase'),
ja:'Nuxt 3はVercel/Netlifyが最適デプロイ先です',
en:'Nuxt 3 deploys best on Vercel or Netlify',
fix:{f:'deploy',s:'Vercel'}},
// ── AI Auto ↔ Skill (3 WARN) ──
{id:'ai-sk-auto-beg',p:['ai_auto','skill_level'],lv:'warn',
t:a=>inc(a.ai_auto,'自律')||inc(a.ai_auto,'Autonomous'),
ja:'フル自律開発には上級スキルが必要です。段階的に進めましょう',
en:'Full autonomous dev requires advanced skills. Progress gradually',
cond:a=>a.skill_level==='Beginner'},
{id:'ai-sk-orch-notpro',p:['ai_auto','skill_level'],lv:'warn',
t:a=>(inc(a.ai_auto,'オーケストレーター')||inc(a.ai_auto,'Orchestrator'))&&a.skill_level!=='Professional',
ja:'オーケストレーターはCI/CD統合の経験が必要です',
en:'Orchestrator requires CI/CD integration experience'},
{id:'ai-sk-multi-beg',p:['ai_auto','skill_level'],lv:'warn',
t:a=>(inc(a.ai_auto,'マルチ')||inc(a.ai_auto,'Multi'))&&a.skill_level==='Beginner',
ja:'マルチAgent協調は中級以上の経験が推奨です',
en:'Multi-Agent coordination recommended for intermediate+'},
// ── BE ↔ Payment (2 WARN) ──
{id:'be-pay-static-stripe',p:['backend','payment'],lv:'warn',
t:a=>isStaticBE(a)&&a.payment&&(inc(a.payment,'Stripe')),
ja:'Stripe webhookにはサーバーが必要。Supabase Edge Functionsで対応可能',
en:'Stripe webhooks need a server. Supabase Edge Functions can help',
fix:{f:'backend',s:'Supabase'}},
{id:'be-pay-saleor-notpy',p:['backend','payment'],lv:'warn',
t:a=>a.payment&&inc(a.payment,'Saleor')&&!isPyBE(a),
ja:'SaleorはPython/Django製です。Python系バックエンドが必要',
en:'Saleor is built with Python/Django. Python backend required',
fix:{f:'backend',s:'Python + Django'}},
{id:'ai-antigravity-windsurf',p:['ai_tools'],lv:'warn',
t:a=>inc(a.ai_tools,'Antigravity')&&inc(a.ai_tools,'Windsurf'),
ja:'AntigravityはWindsurf統合版です。どちらか一方で十分です',
en:'Antigravity integrates Windsurf. One is sufficient',
fix:{f:'ai_tools',s:'Google Antigravity'}},
{id:'ai-openrouter-hub',p:['ai_tools'],lv:'info',
t:a=>inc(a.ai_tools,'OpenRouter'),
ja:'OpenRouterはBYOKハブです。Aider/Cline等のAPIバックエンドとして活用できます',
en:'OpenRouter is a BYOK hub. Use as API backend for Aider/Cline etc.'},
// ── ORM ↔ DB (2 WARN/ERROR) ──
{id:'orm-prisma-mongo',p:['orm','database'],lv:'warn',
t:a=>inc(a.orm,'Prisma')&&inc(a.database,'MongoDB'),
ja:'PrismaのMongoDB対応はPreview段階です。本番環境では注意が必要',
en:'Prisma MongoDB support is in Preview. Use with caution in production'},
{id:'orm-drizzle-fs',p:['orm','database'],lv:'error',
t:a=>inc(a.orm,'Drizzle')&&inc(a.database,'Firestore'),
ja:'DrizzleはSQL専用です。Firestore非対応',
en:'Drizzle is SQL-only, not compatible with Firestore',
fix:{f:'orm',s:'None / Using BaaS'}},
{id:'orm-drizzle-mongo',p:['orm','database'],lv:'error',
t:a=>inc(a.orm,'Drizzle')&&inc(a.database,'MongoDB'),
ja:'DrizzleはSQL専用です。MongoDB非対応',
en:'Drizzle is SQL-only, not compatible with MongoDB',
fix:{f:'orm',s:'Prisma'}},
// ── Deploy ↔ DB (2 WARN/INFO) ──
{id:'dep-db-vercel-pg',p:['deploy','database'],lv:'warn',
t:a=>inc(a.deploy,'Vercel')&&inc(a.database,'PostgreSQL')&&!inc(a.database,'Neon')&&!inc(a.database,'Supabase'),
ja:'Vercel+PostgreSQLは外部ホスティング必要。Neon/Supabase/Vercel Postgresを推奨',
en:'Vercel+PostgreSQL needs external hosting. Use Neon/Supabase/Vercel Postgres',
fix:{f:'database',s:'Neon (PostgreSQL)'}},
{id:'dep-db-cf-pg',p:['deploy','database'],lv:'info',
t:a=>inc(a.deploy,'Cloudflare')&&inc(a.database,'PostgreSQL'),
ja:'Cloudflare Workers→外部DBはHyperdriveまたはD1への移行を推奨',
en:'Cloudflare Workers → external DB: use Hyperdrive or consider D1'},
{id:'dep-db-cf-fs',p:['deploy','database'],lv:'warn',
t:a=>inc(a.deploy,'Cloudflare')&&inc(a.database,'Firestore'),
ja:'Cloudflare Workers + Firestoreはレイテンシー高。D1/KV/Durableを推奨',
en:'Cloudflare + Firestore has high latency. Consider D1/KV/Durable Objects',
fix:{f:'deploy',s:'Firebase Hosting'}},
// ── Deploy ↔ Backend (Cloudflare Workers compatibility) (1 ERROR, 1 WARN, 1 INFO) ──
{id:'be-dep-heavy-cf',p:['backend','deploy'],lv:'error',
t:a=>inc(a.deploy,'Cloudflare')&&(inc(a.backend,'Django')||inc(a.backend,'Spring')||inc(a.backend,'Laravel')),
ja:'Django/Spring/LaravelはCloudflare Workers非対応（V8制限）。Hono/Express推奨',
en:'Django/Spring/Laravel incompatible with Cloudflare Workers (V8 limits). Use Hono/Express',
fix:{f:'backend',s:'Node.js + Hono'}},
{id:'be-dep-node-cf',p:['backend','deploy'],lv:'warn',
t:a=>inc(a.deploy,'Cloudflare')&&(inc(a.backend,'Express')||inc(a.backend,'NestJS'))&&!inc(a.backend,'Hono'),
ja:'Express/NestJSは一部Node API非対応。Cloudflare Workers最適化にはHono推奨',
en:'Express/NestJS have Node API limitations on Cloudflare. Hono is optimized for Workers',
fix:{f:'backend',s:'Node.js + Hono'}},
{id:'be-dep-hono-cf',p:['backend','deploy'],lv:'info',
t:a=>inc(a.deploy,'Cloudflare')&&inc(a.backend,'Hono'),
ja:'✨ Hono + Cloudflare Workersは最適な組み合わせです（超高速Edge実行）',
en:'✨ Hono + Cloudflare Workers is optimal (ultra-fast edge execution)'},
// ── Domain ↔ Auth/Payment (2 ERROR/WARN) ──
{id:'dom-sec-noauth',p:['purpose','auth'],lv:'error',
t:a=>{
if(!a.purpose||!a.auth)return false;
const dom=detectDomain(a.purpose);
const highSecDomains=['fintech','health','legal'];
const hasAuth=a.auth&&!inc(a.auth,'なし')&&!inc(a.auth,'None')&&a.auth!=='none';
return highSecDomains.includes(dom)&&!hasAuth;
},
ja:'金融/医療/法務ドメインでは認証必須です',
en:'Auth is required for fintech/health/legal domains',
fix:{f:'auth',s:'Supabase Auth'}},
{id:'dom-ec-nopay',p:['purpose','payment'],lv:'warn',
t:a=>{
if(!a.purpose||!a.payment)return false;
const dom=detectDomain(a.purpose);
const hasPay=a.payment&&!inc(a.payment,'なし')&&!inc(a.payment,'None')&&a.payment!=='none';
return dom==='ec'&&!hasPay;
},
ja:'ECドメインで決済未選択です。Stripe等の決済方式を検討してください',
en:'EC domain without payment. Consider Stripe or other payment methods'},
// ── AI Auto ↔ Tools (1 WARN) ──
{id:'ai-auto-notools',p:['ai_auto','ai_tools'],lv:'warn',
t:a=>{
if(!a.ai_auto||!a.ai_tools)return false;
const hasAuto=a.ai_auto&&!inc(a.ai_auto,'なし')&&!inc(a.ai_auto,'None')&&a.ai_auto!=='none';
const hasTools=a.ai_tools&&!inc(a.ai_tools,'なし')&&!inc(a.ai_tools,'None')&&a.ai_tools!=='none';
return hasAuto&&!hasTools;
},
ja:'AI自律レベル設定済みですが、AIツール未選択です。Cursor/Claude Code等を選択してください',
en:'AI autonomous level set but no AI tools selected. Choose Cursor/Claude Code etc.'},
// ── Convex ↔ FE/ORM (2 WARN/INFO) ──
{id:'be-convex-noreact',p:['backend','frontend'],lv:'warn',
t:a=>inc(a.backend,'Convex')&&!inc(a.frontend,'React')&&!inc(a.frontend,'Next'),
ja:'ConvexはReact最適化されています。React/Next.js推奨',
en:'Convex is optimized for React. React/Next.js recommended'},
{id:'be-convex-orm',p:['backend','orm'],lv:'info',
t:a=>inc(a.backend,'Convex')&&a.orm&&!inc(a.orm,'なし')&&!inc(a.orm,'None')&&a.orm!=='none',
ja:'ConvexはTypeScript定義で完結します。ORMは通常不要',
en:'Convex uses TypeScript definitions. ORM typically not needed',
fix:{f:'orm',s:'None / Using BaaS'}},
// ── Misc (2 INFO) ──
{id:'ai-tools-multi',p:['ai_tools'],lv:'info',
t:a=>{
if(!a.ai_tools)return false;
const tools=(a.ai_tools||'').split(',').filter(x=>x.trim()).length;
return tools>=3;
},
ja:'複数AIツール(3+)選択時は、CLAUDE.md等のAIルールが統一管理されます',
en:'Multiple AI tools (3+) selected: AI rules are unified via CLAUDE.md'},
{id:'mobile-expo-rn',p:['mobile'],lv:'info',
t:a=>inc(a.mobile,'bare')||inc(a.mobile,'Bare'),
ja:'React Native bareは柔軟性が高いですが、Expoの方が開発速度が速いです',
en:'React Native bare offers flexibility, but Expo is faster for development',
fix:{f:'mobile',s:'Expo (Managed)'}},
// ── Semantic Consistency Rules (Phase A) ── 8 rules ──
// A1: scope_out「ネイティブ」 vs mobile有効
{id:'sem-scope-mobile',p:['scope_out','mobile'],lv:'error',
t:a=>(inc(a.scope_out,'ネイティブ')||inc(a.scope_out,'native')||inc(a.scope_out,'Native'))&&a.mobile&&a.mobile!=='none'&&!inc(a.mobile,'PWA'),
ja:'スコープ外に「ネイティブアプリ」がありますが、モバイル対応が有効です。生成文書が矛盾します — どちらかを修正してください',
en:'Scope excludes "native apps" but mobile support is enabled. Generated docs will conflict — fix one or the other'},
// A2: scope_out「決済/EC」 vs payment有効
{id:'sem-scope-payment',p:['scope_out','payment'],lv:'warn',
t:a=>(inc(a.scope_out,'決済')||inc(a.scope_out,'EC')||inc(a.scope_out,'payment')||inc(a.scope_out,'Payment'))&&a.payment&&!inc(a.payment,'なし')&&!inc(a.payment,'None')&&a.payment!=='none',
ja:'スコープ外に「決済/EC」がありますが、決済方式が選択されています。仕様書のスコープ定義に矛盾が生じます',
en:'Scope excludes "payment/EC" but a payment method is selected. Spec scope definition will conflict'},
// A3: scope_out「EC」 vs entities に Product/Order
{id:'sem-scope-entities',p:['scope_out','data_entities'],lv:'warn',
t:a=>(inc(a.scope_out,'EC')||inc(a.scope_out,'commerce')||inc(a.scope_out,'Commerce'))&&(inc(a.data_entities,'Product')||inc(a.data_entities,'Order')||inc(a.data_entities,'Cart')),
ja:'スコープ外に「EC」がありますが、エンティティにProduct/Orderが含まれています。ERとスコープが矛盾します',
en:'Scope excludes "EC" but entities include Product/Order. ER and scope will conflict'},
// A4: deploy=Vercel && backend=Express/Fastify（常駐サーバー型）
{id:'sem-deploy-express',p:['deploy','backend'],lv:'warn',
t:a=>inc(a.deploy,'Vercel')&&(inc(a.backend,'Express')||inc(a.backend,'Fastify'))&&!inc(a.frontend,'Next.js'),
ja:'VercelでExpress/Fastifyを動かすにはServerless Functionsに変換が必要です。Next.js API RoutesまたはRailway/Renderへの分離を検討してください',
en:'Running Express/Fastify on Vercel requires Serverless Functions. Consider Next.js API Routes or split to Railway/Render',
fix:{f:'deploy',s:'Railway'}},
// A5: backend=Supabase && auth に NextAuth/Auth.js
{id:'sem-auth-supa-nextauth',p:['auth','backend'],lv:'warn',
t:a=>inc(a.backend,'Supabase')&&(inc(a.auth,'NextAuth')||inc(a.auth,'Auth.js')),
ja:'Supabase利用時はSupabase Authが統合されています。NextAuth/Auth.jsとの併用は認証SoTが二重化します',
en:'Supabase includes built-in Auth. Using NextAuth/Auth.js creates dual auth sources of truth',
fix:{f:'auth',s:'Supabase Auth'}},
// A6: backend≠Supabase && auth に Supabase Auth
{id:'sem-auth-nosupa-supaauth',p:['auth','backend'],lv:'warn',
t:a=>!inc(a.backend,'Supabase')&&inc(a.auth,'Supabase Auth'),
ja:'Supabase Authが選択されていますが、バックエンドがSupabaseではありません。認証の接続先が不明確になります',
en:'Supabase Auth selected but backend is not Supabase. Auth connection target will be unclear',
fix:{f:'backend',s:'Supabase'}},
// A7: purpose=教育系 && entities に Product/Order（ドメイン不一致）
{id:'sem-purpose-entities',p:['purpose','data_entities'],lv:'info',
t:a=>(inc(a.purpose,'教育')||inc(a.purpose,'学習')||inc(a.purpose,'Education')||inc(a.purpose,'Learning')||inc(a.purpose,'LMS'))&&(inc(a.data_entities,'Product')||inc(a.data_entities,'Order')),
ja:'教育・学習系のプロジェクトにProduct/Orderエンティティがあります。教材販売が目的でなければCourse/Lessonへの変更を検討してください',
en:'Education project has Product/Order entities. Consider Course/Lesson unless this is for course sales',
fixFn:a=>({f:'data_entities',s:(a.data_entities||'').replace(/Product/g,'Course').replace(/Order/g,'Enrollment')})},
// A8: deploy=Vercel && backend含Express && frontend含Next.js（BFF曖昧）
{id:'sem-deploy-bff',p:['deploy','backend','frontend'],lv:'info',
t:a=>inc(a.deploy,'Vercel')&&inc(a.backend,'Express')&&inc(a.frontend,'Next.js'),
ja:'Next.js + Express + Vercelの構成です。ExpressをNext.js API Routesに統合するか、Expressを別ホスト（Railway等）にする設計判断が必要です。生成文書ではAPI Routes統合を前提とします',
en:'Next.js + Express + Vercel stack detected. Decide whether to merge Express into Next.js API Routes or host Express separately. Generated docs will assume API Routes integration'},
// ── Security Rules (3 rules: 1 ERROR + 2 WARN) ──
// S1: 金融/医療/法務 + MFA未設定
{id:'dom-sec-nomfa',p:['purpose','mvp_features'],lv:'warn',
t:a=>{
const dom=detectDomain(a.purpose||'');
if(!dom)return false;
const isSensitiveDomain=['fintech','health','legal'].includes(dom);
const hasMFA=inc(a.mvp_features,'MFA')||inc(a.mvp_features,'二要素')||inc(a.mvp_features,'2FA')||inc(a.mvp_features,'多要素');
return isSensitiveDomain&&!hasMFA;
},
ja:'金融/医療/法務系のプロジェクトですが、MFA（多要素認証）が設定されていません。セキュリティ強化のためMFA導入を推奨します',
en:'Finance/health/legal project without MFA (multi-factor authentication). MFA is strongly recommended for security'},
// S2: 決済あり + 認証なし
{id:'dom-sec-pay-noauth',p:['payment','auth'],lv:'error',
t:a=>{
const hasPay=a.payment&&!inc(a.payment,'なし')&&!inc(a.payment,'None')&&a.payment!=='none';
const noAuth=!a.auth||inc(a.auth,'なし')||inc(a.auth,'None')||a.auth==='none';
return hasPay&&noAuth;
},
ja:'決済機能が有効ですが、認証が設定されていません。決済機能には必ず認証が必要です',
en:'Payment is enabled but authentication is not configured. Payment features require authentication',
fix:{f:'auth',s:'Supabase Auth'}},
// S3: 機密エンティティ + 認証なし
{id:'dom-sec-sensitive-noauth',p:['data_entities','auth'],lv:'warn',
t:a=>{
const sensitiveEntities=['Patient','Transaction','Payment','MedicalRecord','Claim','Contract','Invoice','BankAccount','CreditCard','Prescription','Diagnosis'];
const hasSensitive=sensitiveEntities.some(e=>inc(a.data_entities,e));
const noAuth=!a.auth||inc(a.auth,'なし')||inc(a.auth,'None')||a.auth==='none';
return hasSensitive&&noAuth;
},
ja:'Patient/Transaction等の機密情報を扱うエンティティがありますが、認証が設定されていません。個人情報保護のため認証の導入を推奨します',
en:'Sensitive entities (Patient/Transaction/etc.) detected without authentication. Authentication is recommended for privacy protection',
fix:{f:'auth',s:'Supabase Auth'}},
];
// helpers
function inc(v,k){return v&&typeof v==='string'&&v.indexOf(k)!==-1;}
function isPyBE(a){return inc(a.backend,'Python')||inc(a.backend,'FastAPI')||inc(a.backend,'Django');}
function isNodeBE(a){return inc(a.backend,'Express')||inc(a.backend,'Fastify')||inc(a.backend,'NestJS')||inc(a.backend,'Hono');}
function isStaticBE(a){return inc(a.backend,'なし')||inc(a.backend,'None')||inc(a.backend,'static');}
function checkCompat(answers){
if(!answers)return[];
return COMPAT_RULES.filter(r=>{
try{
if(r.cond&&!r.cond(answers))return false;
const keys=r.p;
if(keys.some(k=>!answers[k]))return false;
return r.t(answers);
}catch(e){return false;}
}).map(r=>({id:r.id,pair:r.p,level:r.lv,msg:S.lang==='ja'?r.ja:r.en,fix:r.fix||(r.fixFn?r.fixFn(answers):null)}));
}
// ── Stack Synergy Score Data ──
const SYNERGY_FE_BE={'Next.js|Supabase':95,'Next.js|Firebase':92,'Next.js|Vercel':98,'Next.js|Express':85,'Next.js|NestJS':88,'Next.js|Convex':93,'React|Express':80,'React|Firebase':88,'React|Supabase':90,'Vue|Nuxt|Express':82,'Vue|Nuxt|Firebase':85,'Svelte|SvelteKit|Supabase':90,'Astro|static':95,'Astro|Supabase':88,'Angular|NestJS':90,'Angular|Firebase':92};
const SYNERGY_DEPLOY={'Next.js|Vercel':98,'Nuxt|Vercel':95,'Nuxt|Netlify':93,'SvelteKit|Vercel':94,'Astro|Vercel':96,'Astro|Netlify':95,'Astro|Cloudflare':93,'React|Vercel':90,'React|Netlify':88,'Firebase|Firebase':98,'Supabase|Vercel':95,'Express|Railway':92,'NestJS|Railway':94,'Django|Railway':93,'FastAPI|Railway':91,'Spring|Railway':88,'Convex|Vercel':96};
const SYNERGY_DOMAIN={'fintech|Supabase':15,'fintech|PostgreSQL':12,'fintech|Stripe':18,'health|Supabase':14,'health|PostgreSQL':12,'legal|PostgreSQL':10,'ec|Stripe':20,'ec|Saleor':18,'ec|Supabase':12,'education|Firebase':10,'education|Supabase':12,'saas|Supabase':15,'saas|Stripe':18,'iot|Firebase':12,'iot|Supabase':10,'community|Firebase':14,'content|Supabase':12,'marketplace|Stripe':15};
function calcSynergy(a){
if(!a||!a.frontend||!a.backend)return{overall:60,d1:60,d2:60,d3:60,d4:60,d5:60,domain:null};
const fe=a.frontend||'';const be=a.backend||'';const dep=a.deploy||'';const db=a.database||'';const pay=a.payment||'';
// D1: FE↔BE affinity
let d1=60;
const feKey=fe.split(' ')[0];const beKey=be.split(' ')[0]||be.split('+')[1]?.trim()||be;
const key1=feKey+'|'+beKey;const key2=fe.includes('Next')?'Next.js|'+beKey:null;
d1=SYNERGY_FE_BE[key1]||SYNERGY_FE_BE[key2]||60;
if(inc(fe,'React')&&inc(be,'Express'))d1=80;
if(inc(fe,'React')&&inc(be,'Supabase'))d1=90;
if(inc(fe,'Vue')&&inc(be,'Express'))d1=82;
if(inc(fe,'Svelte')&&inc(be,'Supabase'))d1=90;
// D2: Ecosystem unity
let d2=50;
const isBaaS=inc(be,'Firebase')||inc(be,'Supabase')||inc(be,'Convex');
if(isBaaS&&((inc(be,'Firebase')&&inc(db,'Firestore'))||(inc(be,'Supabase')&&inc(db,'Supabase'))||(inc(be,'Convex')&&!db)))d2+=20;
if(inc(fe,'Next')&&inc(dep,'Vercel'))d2+=15;
if(inc(fe,'Nuxt')&&(inc(dep,'Vercel')||inc(dep,'Netlify')))d2+=12;
if(inc(fe,'Astro')&&(inc(dep,'Vercel')||inc(dep,'Netlify')||inc(dep,'Cloudflare')))d2+=15;
d2=Math.min(100,d2);
// D3: Domain fit
let d3=60;
const dom=detectDomain(a.purpose||'');
if(dom){
const keys=[dom+'|'+beKey,dom+'|'+db.split(' ')[0],dom+'|'+pay.split(' ')[0]];
keys.forEach(k=>{if(SYNERGY_DOMAIN[k])d3+=SYNERGY_DOMAIN[k];});
d3=Math.min(100,d3);
}
// D4: Deploy alignment
let d4=60;
const depKey1=(fe.includes('Next')?'Next.js':feKey)+'|'+dep.split(' ')[0];
const depKey2=beKey+'|'+dep.split(' ')[0];
d4=SYNERGY_DEPLOY[depKey1]||SYNERGY_DEPLOY[depKey2]||60;
if(inc(be,'Firebase')&&inc(dep,'Firebase'))d4=98;
if(inc(be,'Supabase')&&inc(dep,'Vercel'))d4=95;
// D5: Complexity balance
let d5=70;
const skill=a.skill_level||'Intermediate';
const complexStack=(inc(be,'NestJS')||inc(be,'Spring')||inc(be,'Django'))?1:0;
const hasMobile=a.mobile&&!inc(a.mobile,'なし')&&!inc(a.mobile,'None')&&a.mobile!=='none'?1:0;
const hasPayment=pay&&!inc(pay,'なし')&&!inc(pay,'None')&&pay!=='none'?1:0;
const complexity=complexStack+hasMobile+hasPayment;
if(skill==='Beginner'&&complexity>=2)d5=40;
else if(skill==='Beginner'&&complexity===1)d5=60;
else if(skill==='Professional')d5=90;
else d5=70;
const overall=Math.round(d1*0.25+d2*0.25+d3*0.2+d4*0.2+d5*0.1);
return{overall,d1:Math.round(d1),d2:Math.round(d2),d3:Math.round(d3),d4:Math.round(d4),d5:Math.round(d5),domain:dom};
}
/* ═══ LEARNING RESOURCES DB ═══ */
/* Each entry: { n: display name, u: URL }
Add new entries when new tech choices are added to questions.
Keys should match the lookup keys used in showRoadmapUI(). */
const RESOURCES={
/* Web Fundamentals */
html:{n:'MDN Web Docs',u:'https://developer.mozilla.org/ja/docs/Web'},
tailwind:{n:'Tailwind Docs',u:'https://tailwindcss.com/docs'},
js:{n:'javascript.info',u:'https://ja.javascript.info/'},
/* Frontend Frameworks */
react:{n:'React Docs',u:'https://react.dev/learn'},
nextjs:{n:'Next.js Docs',u:'https://nextjs.org/docs'},
vue:{n:'Vue.js Guide',u:'https://ja.vuejs.org/guide/introduction'},
svelte:{n:'Svelte Tutorial',u:'https://svelte.dev/tutorial'},
astro:{n:'Astro Docs',u:'https://docs.astro.build'},
angular:{n:'Angular Docs',u:'https://angular.dev/overview'},
remix:{n:'Remix Docs',u:'https://remix.run/docs/en/main'},
/* UI Libraries */
shadcn:{n:'shadcn/ui',u:'https://ui.shadcn.com/docs'},
/* State & Data */
zustand:{n:'Zustand',u:'https://zustand-demo.pmnd.rs/'},
rquery:{n:'TanStack Query',u:'https://tanstack.com/query/latest'},
/* Testing */
vitest:{n:'Vitest',u:'https://vitest.dev/guide/'},
/* Backend Runtimes */
node:{n:'Node.js Docs',u:'https://nodejs.org/docs/latest/api/'},
express:{n:'Express.js',u:'https://expressjs.com/'},
fastify:{n:'Fastify',u:'https://fastify.dev/docs/latest/'},
nestjs:{n:'NestJS',u:'https://docs.nestjs.com/'},
fastapi:{n:'FastAPI',u:'https://fastapi.tiangolo.com/'},
django:{n:'Django',u:'https://docs.djangoproject.com/'},
spring:{n:'Spring Boot',u:'https://spring.io/guides'},
go:{n:'Go Gin',u:'https://gin-gonic.com/docs/'},
hono:{n:'Hono',u:'https://hono.dev/docs/'},
/* ORM */
prisma:{n:'Prisma Docs',u:'https://www.prisma.io/docs'},
drizzle:{n:'Drizzle ORM',u:'https://orm.drizzle.team/docs/overview'},
typeorm:{n:'TypeORM',u:'https://typeorm.io/'},
sqlalchemy:{n:'SQLAlchemy',u:'https://docs.sqlalchemy.org/'},
kysely:{n:'Kysely',u:'https://kysely.dev/docs/intro'},
/* BaaS / DB */
firebase:{n:'Firebase Docs',u:'https://firebase.google.com/docs'},
supabase:{n:'Supabase Docs',u:'https://supabase.com/docs'},
postgres:{n:'PostgreSQL Docs',u:'https://www.postgresql.org/docs/'},
mongo:{n:'MongoDB Manual',u:'https://www.mongodb.com/docs/manual/'},
mysql:{n:'MySQL Docs',u:'https://dev.mysql.com/doc/'},
redis:{n:'Redis Docs',u:'https://redis.io/docs/'},
neon:{n:'Neon Docs',u:'https://neon.tech/docs'},
/* Auth */
nextauth:{n:'Auth.js',u:'https://authjs.dev/'},
clerk:{n:'Clerk Docs',u:'https://clerk.com/docs'},
/* Mobile */
expo:{n:'Expo Docs',u:'https://docs.expo.dev/'},
flutter:{n:'Flutter Docs',u:'https://docs.flutter.dev/'},
rn:{n:'React Native',u:'https://reactnative.dev/docs/getting-started'},
/* DevOps */
docker:{n:'Docker Docs',u:'https://docs.docker.com/'},
ghactions:{n:'GitHub Actions',u:'https://docs.github.com/actions'},
/* Deploy */
vercel:{n:'Vercel Docs',u:'https://vercel.com/docs'},
cloudflare:{n:'CF Pages',u:'https://developers.cloudflare.com/pages/'},
railway:{n:'Railway Docs',u:'https://docs.railway.com/'},
/* AI Dev */
cursor:{n:'Cursor Docs',u:'https://docs.cursor.com/'},
claudecode:{n:'Claude Code',u:'https://docs.anthropic.com/en/docs/claude-code'},
mcp:{n:'MCP Spec',u:'https://modelcontextprotocol.io/'},
copilot:{n:'GitHub Copilot',u:'https://docs.github.com/copilot'},
windsurf:{n:'Windsurf Docs',u:'https://docs.windsurf.com/'},
antigravity:{n:'Google Antigravity',u:'https://antigravity.google/'},
openrouter:{n:'OpenRouter Docs',u:'https://openrouter.ai/docs'},
augment:{n:'Augment Code',u:'https://www.augmentcode.com/'},
aider:{n:'Aider Docs',u:'https://aider.chat/docs/'},
jules:{n:'Jules (Google)',u:'https://jules.google/'},
amazonq:{n:'Amazon Q Developer',u:'https://aws.amazon.com/q/developer/'},
geminiassist:{n:'Gemini Code Assist',u:'https://cloud.google.com/gemini/docs/codeassist/overview'},
junie:{n:'JetBrains Junie',u:'https://www.jetbrains.com/junie/'},
tabnine:{n:'Tabnine',u:'https://www.tabnine.com/'},
/* Payments */
stripe:{n:'Stripe Docs',u:'https://docs.stripe.com/'},
paddle:{n:'Paddle Docs',u:'https://developer.paddle.com/'},
/* Dev Methods */
tdd:{n:'TDD Guide',u:'https://martinfowler.com/bliki/TestDrivenDevelopment.html'},
bdd:{n:'BDD Intro',u:'https://cucumber.io/docs/bdd/'},
ddd:{n:'DDD Reference',u:'https://www.domainlanguage.com/ddd/reference/'},
sdd:{n:'SDD Overview',u:'https://en.wikipedia.org/wiki/Specification-driven_development'},
fdd:{n:'FDD Guide',u:'https://en.wikipedia.org/wiki/Feature-driven_development'},
};
/* ═══ GENERATOR TEMPLATES — Bilingual dictionary for Pillar ⑦ Roadmap ═══ */
const GT=(()=>{
const ja={
none:'なし',
/* LEARNING_PATH.md */
lp_title:'学習ロードマップ',lp_skill:'スキルレベル',lp_target:'目標期間',
l1:'Web基盤',l2:'フロントエンド',l3:'バックエンド',l3m:'モバイル',
l4:'DevOps',l5:'AI駆動開発',l6:'収益化',l7:'駆動開発手法',l7span:'全期間',
html5b:'HTML5 基礎（2-4週）',css3b:'CSS3 基礎（3-6週）',jsb:'JavaScript ES6+（4-12週）',
tsAdv:'TypeScript ディープダイブ',cssAdv:'最新CSS (Container Queries, :has())',
setup:'セットアップ・基礎',stMgmt:'状態管理',dataFetch:'データフェッチ',
testing:'テスト',dbDesign:'データベース設計',auth:'認証・認可',
mobEnv:'環境構築',mobNav:'ナビゲーション・画面設計',
mobNative:'ネイティブ機能（カメラ/通知）',mobStore:'ストアビルド・提出',
deploy:'デプロイ',monitor:'モニタリング基盤',aiUse:'活用',
mcpCfg:'MCP設定・活用',aiOpt:'AI Agent Rules 最適化',practice:'実践',
billing:'課金フロー実装',opsScale:'運用・スケール',
/* TECH_STACK_GUIDE.md */
ts_title:'技術スタックガイド',ts_selected:'選択された技術スタック',
cat:'カテゴリ',tech:'技術',rationale:'理由',
feLabel:'フロントエンド',beLabel:'バックエンド',dbLabel:'データベース',
deployLabel:'デプロイ',mobileLabel:'モバイル',payLabel:'決済/CMS',
nextR:'SSR/SSG対応、SEO最適化',vueR:'学習コスト低、柔軟性',feGenR:'高性能、エコシステム充実',
supaR:'BaaS型、高速MVP開発',expR:'軽量、学習コスト低',nestR:'エンタープライズ対応、DI',beGenR:'スケーラブル',
pgR:'ACID準拠、JSON対応、Supabase互換',dbGenR:'柔軟なスキーマ',
vercelR:'Next.js最適化、自動デプロイ',deployGenR:'高い柔軟性',
expoR:'React知識転用、OTA更新',mobGenR:'クロスプラットフォーム対応',
payR:'SaaS/EC収益化基盤',
ts_deps:'技術間の関連性',ts_versions:'推奨バージョン',
/* MOBILE_GUIDE.md */
mob_title:'モバイル開発ガイド',mob_env:'環境構築',mob_dir:'ディレクトリ構造',
mob_home:'ホーム画面',mob_explore:'探索画面',mob_profile:'プロフィール',
mob_root:'ルートレイアウト',mob_eas:'設定',mob_libs:'推奨ライブラリ',
mob_anim:'アニメーション',mob_list:'高速リスト',mob_img:'画像最適化',
mob_none:'現在のプロジェクトではモバイル開発は対象外です。\n将来的にExpo (React Native)での対応を推奨します。',
/* TOOLS_SETUP.md */
tool_title:'開発ツールセットアップガイド',tool_essential:'必須ツール',
tool_rec:'推奨',tool_pkgmgr:'パッケージマネージャー',tool_init:'プロジェクト初期化',
tool_docker:'データベース (Docker使用)',tool_ai:'AIコーディングツール',
tool_ext:'拡張機能',tool_used:'使用時',tool_vsInst:'VS Code拡張からインストール',
tool_official:'公式サイトからインストール',tool_env:'環境変数テンプレート',
/* RESOURCES.md */
res_title:'学習リソース集',res_official:'公式ドキュメント',
res_ai:'AI駆動開発',res_bp:'ベストプラクティス',res_docs:'ドキュメント',
res_proto:'プロトコル',res_patterns:'パターン',
res_books:'推奨書籍・コース',res_fullstack:'フルスタックWeb開発入門',
res_tsPractice:'TypeScript実践ガイド',res_design:'で学ぶ設計原則',
res_saas:'SaaS開発とStripe決済実装',res_headless:'ヘッドレスアーキテクチャ入門',
res_beg:'初心者向け',res_int:'中級者向け',
/* MILESTONES.md */
ms_title:'マイルストーン計画',ms_target:'目標期間',
ms_m:['環境構築・基礎','コア機能実装','UI/UX・テスト','デプロイ・CI/CD','最適化・モニタリング','本番運用・改善','スケール・次フェーズ'],
ms_criteria:'マイルストーン達成基準を定義',ms_review:'週次レビュー実施',ms_retro:'振り返り・改善',
/* AI_WORKFLOW.md */
aiw_title:'AI駆動開発ワークフローガイド',aiw_flow:'AI開発フロー',
aiw_s1:'.spec/ を読む',aiw_s2:'タスク選択',aiw_s3:'AI実装',aiw_s4:'レビュー',aiw_s5:'テスト',aiw_s6:'コミット',
aiw_select:'AIツール使い分け',aiw_task:'タスク',aiw_rec:'推奨ツール',
aiw_newfile:'新規ファイル作成',aiw_bugfix:'バグ修正',aiw_testgen:'テスト生成',aiw_refactor:'リファクタリング',
aiw_ctx:'コンテキスト理解',aiw_term:'ターミナル直接操作',aiw_inline:'インライン補完',aiw_multi:'マルチファイル編集',
aiw_mcp:'MCP活用パターン',aiw_mcp1:'最新ライブラリドキュメント参照',aiw_mcp2:'プロジェクト構造の理解',aiw_mcp3:'E2Eテスト自動化',
aiw_prompt:'プロンプトテンプレート',aiw_addFeature:'新機能追加',
aiw_promptText:`.spec/tasks.mdの[タスク名]を実装してください。
.spec/specification.mdの要件に従い、
.spec/technical-plan.mdのアーキテクチャに沿って実装してください。
テストも同時に作成してください。`,
aiw_bugfixPrompt:'バグ修正',
aiw_bugfixText:`以下のエラーを修正してください:
[エラー内容を貼り付け]
手順:
1. docs/25_error_logs.mdを参照し、既知の問題か確認
2. 根本原因を特定
3. 修正とテストを実装
4. docs/25_error_logs.mdにエラーを記録`,
aiw_refactorPrompt:'リファクタリング',
aiw_refactorText:`以下のコードをリファクタリングしてください:
[対象ファイル/コードを貼り付け]
手順:
1. .spec/specification.mdの要件を再確認
2. 問題点を特定 (SOLID原則違反、重複コード等)
3. 段階的に改善 (テストを壊さない)
4. docs/24_progress.mdを更新`,
/* AI_AUTONOMOUS.md */
aia_title:'AI自律開発ガイド',aia_level:'レベル',
aia_vibe:'Vibe Codingの実践',aia_vibeDesc:'自然言語で意図を伝え、AIが実装する開発スタイル。',
aia_basic:'基本フロー',
aia_f1:'意図を明確に伝える',aia_f1ex:'「ユーザー一覧画面を作って」',
aia_f2:'AIが実装',aia_f2ex:'コード生成・テスト・リファクタリング',
aia_f3:'レビュー・修正',aia_f3ex:'人間が最終確認',
aia_f4:'イテレーション',aia_f4ex:'フィードバックを繰り返し',
aia_tools:'推奨ツール',
aia_vibe1:'Cursor + Claude: 基本的なVibe Coding',aia_vibe2:'Claude Code: ターミナルベースの自律実装',aia_vibe3:'Antigravity: Agent-first IDE（Editor + Manager View）',
aia_multi1:'Claude Code Subagents: 並列タスク実行',aia_multi2:'Claude-Flow: マルチAgent協調',aia_multi3:'AGENTS.md: Agent間の役割定義',
aia_full1:'Devin: 完全自律型AIエンジニア',aia_full2:'Claude Code Tasks: DAGタスク管理',aia_full3:'Gas Town: K8s for AI Agents',aia_async1:'Jules (Google): 非同期コーディングAgent',
aia_bp:'ベストプラクティス',
aia_bp1:'.spec/を必ず最初に読ませる',aia_bp2:'小さなタスクに分割する',aia_bp3:'テストを先に書かせる (TDD)',aia_bp4:'コミット前に必ずレビュー',
aia_none:'現在のプロジェクトではAI自律開発は対象外です。\nまずはAIコーディングツール（',aia_none2:'）の基本活用から始めましょう。',
/* SAAS_COMMERCE_GUIDE.md */
sc_title:'SaaS・EC収益化ガイド',sc_selected:'選択',
sc_compare:'決済プラットフォーム比較',sc_platform:'プラットフォーム',sc_rate:'料率',sc_feat:'特徴',
sc_stripe:'API最強、カスタマイズ自在',sc_paddle:'SaaS特化、税務自動',sc_lemon:'Stripe傘下、個人開発者向け',
sc_impl:'Stripe実装ガイド',sc_webhook:'Webhook処理',
sc_paid:'決済完了',sc_renew:'サブスク更新',sc_cancel:'解約',
sc_cms:'ヘッドレスCMS実装',sc_ec:'ヘッドレスEC',
sc_prodMgmt:'商品管理',sc_payment:'決済',sc_ship:'配送',sc_fulfill:'カスタムFulfillment',
sc_none:'現在のプロジェクトでは決済・EC機能は対象外です。\n将来的にStripe決済やヘッドレスCMSの導入を推奨します。',
/* Dashboard roadmap labels */
dRoadDeploy:'デプロイ',dRoadReset:'🔄 リセット',dRoadFiles:'📁 ファイル一覧',dRoadProgress:'📈 全体進捗',
};
const en={
none:'None',
lp_title:'Learning Roadmap',lp_skill:'Skill Level',lp_target:'Target',
l1:'Web Fundamentals',l2:'Frontend',l3:'Backend',l3m:'Mobile',
l4:'DevOps',l5:'AI-Driven Dev',l6:'Monetization',l7:'Dev Methodologies',l7span:'Entire Duration',
html5b:'HTML5 Basics (2-4 weeks)',css3b:'CSS3 Basics (3-6 weeks)',jsb:'JavaScript ES6+ (4-12 weeks)',
tsAdv:'TypeScript deep dive',cssAdv:'Modern CSS (Container Queries, :has())',
setup:'Setup & Basics',stMgmt:'State Management',dataFetch:'Data Fetching',
testing:'Testing',dbDesign:'Database Design',auth:'Auth & Authorization',
mobEnv:'Environment Setup',mobNav:'Navigation & Screen Design',
mobNative:'Native Features (Camera/Push)',mobStore:'Store Build & Submission',
deploy:'Deploy',monitor:'Monitoring Setup',aiUse:'Integration',
mcpCfg:'MCP Configuration',aiOpt:'AI Agent Rules Optimization',practice:'Practice',
billing:'Billing Flow Implementation',opsScale:'Operations & Scaling',
ts_title:'Tech Stack Guide',ts_selected:'Selected Tech Stack',
cat:'Category',tech:'Technology',rationale:'Rationale',
feLabel:'Frontend',beLabel:'Backend',dbLabel:'Database',
deployLabel:'Deploy',mobileLabel:'Mobile',payLabel:'Payment/CMS',
nextR:'SSR/SSG support, SEO optimized',vueR:'Low learning curve, flexible',feGenR:'High performance, rich ecosystem',
supaR:'BaaS, rapid MVP',expR:'Lightweight, easy to learn',nestR:'Enterprise-grade, DI',beGenR:'Scalable',
pgR:'ACID compliant, JSON support, Supabase compatible',dbGenR:'Flexible schema',
vercelR:'Next.js optimized, auto-deploy',deployGenR:'High flexibility',
expoR:'Reuse React skills, OTA updates',mobGenR:'Cross-platform',
payR:'SaaS/EC monetization platform',
ts_deps:'Technology Dependencies',ts_versions:'Recommended Versions',
mob_title:'Mobile Dev Guide',mob_env:'Environment Setup',mob_dir:'Directory Structure',
mob_home:'Home screen',mob_explore:'Explore screen',mob_profile:'Profile',
mob_root:'Root layout',mob_eas:'Config',mob_libs:'Recommended Libraries',
mob_anim:'Animations',mob_list:'High-perf list',mob_img:'Image optimization',
mob_none:'Mobile development is not in scope for this project.\nConsider Expo (React Native) for future mobile support.',
tool_title:'Dev Tools Setup Guide',tool_essential:'Essential Tools',
tool_rec:'Recommended',tool_pkgmgr:'Package Manager',tool_init:'Project Init',
tool_docker:'Database (via Docker)',tool_ai:'AI Coding Tools',
tool_ext:'Extensions',tool_used:'if used',tool_vsInst:'Install from VS Code extensions',
tool_official:'Install from official site',tool_env:'Environment Variables',
res_title:'Learning Resources',res_official:'Official Documentation',
res_ai:'AI-Driven Development',res_bp:'Best Practices',res_docs:'Docs',
res_proto:'Protocol',res_patterns:'Patterns',
res_books:'Recommended Books & Courses',res_fullstack:'Full-Stack Web Development',
res_tsPractice:'TypeScript in Practice',res_design:' Design Principles',
res_saas:'SaaS Development with Stripe',res_headless:'Headless Architecture Guide',
res_beg:'Beginner',res_int:'Intermediate',
ms_title:'Milestone Plan',ms_target:'Target',
ms_m:['Setup & Foundations','Core Feature Implementation','UI/UX & Testing','Deploy & CI/CD','Optimization & Monitoring','Production & Improvement','Scale & Next Phase'],
ms_criteria:'Define milestone acceptance criteria',ms_review:'Conduct weekly reviews',ms_retro:'Retrospective & improvement',
aiw_title:'AI-Driven Dev Workflow Guide',aiw_flow:'AI Dev Flow',
aiw_s1:'.spec/ review',aiw_s2:'Task selection',aiw_s3:'AI implementation',aiw_s4:'Review',aiw_s5:'Test',aiw_s6:'Commit',
aiw_select:'AI Tool Selection',aiw_task:'Task',aiw_rec:'Recommended',
aiw_newfile:'New file creation',aiw_bugfix:'Bug fix',aiw_testgen:'Test generation',aiw_refactor:'Refactoring',
aiw_ctx:'Context awareness',aiw_term:'Direct terminal access',aiw_inline:'Inline completion',aiw_multi:'Multi-file editing',
aiw_mcp:'MCP Usage Patterns',aiw_mcp1:'Latest library docs reference',aiw_mcp2:'Project structure comprehension',aiw_mcp3:'E2E test automation',
aiw_prompt:'Prompt Templates',aiw_addFeature:'Add New Feature',
aiw_promptText:`Implement [task name] from .spec/tasks.md.
Follow the requirements in .spec/specification.md
and the architecture defined in .spec/technical-plan.md.
Create tests alongside the implementation.`,
aiw_bugfixPrompt:'Bug Fix',
aiw_bugfixText:`Fix the following error:
[Paste error here]
Steps:
1. Reference docs/25_error_logs.md to check if it is a known issue
2. Identify root cause
3. Implement fix and tests
4. Log error to docs/25_error_logs.md`,
aiw_refactorPrompt:'Refactoring',
aiw_refactorText:`Refactor the following code:
[Paste target file/code here]
Steps:
1. Re-verify requirements in .spec/specification.md
2. Identify issues (SOLID violations, code duplication, etc.)
3. Improve gradually (do not break tests)
4. Update docs/24_progress.md`,
aia_title:'AI Autonomous Dev Guide',aia_level:'Level',
aia_vibe:'Vibe Coding in Practice',aia_vibeDesc:'A development style where you express intent in natural language and AI implements it.',
aia_basic:'Basic Flow',
aia_f1:'Communicate intent clearly',aia_f1ex:'"Create a user list screen"',
aia_f2:'AI implements',aia_f2ex:'Code generation, testing, refactoring',
aia_f3:'Review & fix',aia_f3ex:'Human final review',
aia_f4:'Iteration',aia_f4ex:'Repeat feedback cycles',
aia_tools:'Recommended Tools',
aia_vibe1:'Cursor + Claude: Basic Vibe Coding',aia_vibe2:'Claude Code: Terminal-based autonomous implementation',aia_vibe3:'Antigravity: Agent-first IDE (Editor + Manager View)',
aia_multi1:'Claude Code Subagents: Parallel task execution',aia_multi2:'Claude-Flow: Multi-Agent coordination',aia_multi3:'AGENTS.md: Agent role definitions',
aia_full1:'Devin: Fully autonomous AI engineer',aia_full2:'Claude Code Tasks: DAG task management',aia_full3:'Gas Town: K8s for AI Agents',aia_async1:'Jules (Google): Async coding agent',
aia_bp:'Best Practices',
aia_bp1:'Always feed .spec/ first',aia_bp2:'Break into small tasks',aia_bp3:'Write tests first (TDD)',aia_bp4:'Always review before committing',
aia_none:'AI autonomous development is not in scope.\nStart with AI coding tools (',aia_none2:') for the basics.',
sc_title:'SaaS & E-Commerce Guide',sc_selected:'Selected',
sc_compare:'Payment Platform Comparison',sc_platform:'Platform',sc_rate:'Rate',sc_feat:'Features',
sc_stripe:'Best API, highly customizable',sc_paddle:'SaaS-focused, auto tax',sc_lemon:'Stripe-owned, indie-friendly',
sc_impl:'Stripe Implementation',sc_webhook:'Webhook Handler',
sc_paid:'Payment completed',sc_renew:'Subscription renewed',sc_cancel:'Cancelled',
sc_cms:'Headless CMS',sc_ec:'Headless E-Commerce',
sc_prodMgmt:'Product Management',sc_payment:'Payment',sc_ship:'Shipping',sc_fulfill:'Custom Fulfillment',
sc_none:'Payment/E-Commerce features are not in scope.\nConsider Stripe payments or Headless CMS for future implementation.',
dRoadDeploy:'Deploy',dRoadReset:'🔄 Reset',dRoadFiles:'📁 File List',dRoadProgress:'📈 Overall Progress',
};
return {ja,en,t:(key)=>(({ja,en})[S.genLang||S.lang]||en)[key]||en[key]||key};
})();
/* ═══ WIZARD CORE ═══ */
function initPills(){
const _ja=S.lang==='ja';
const c=$('pills');if(!c)return;c.innerHTML='';
const qs=getQ();
for(let i=1;i<=3;i++){
const ph=qs[i];if(!ph)continue;
const d=document.createElement('div');d.className='pd-phase';d.id='pp'+i;
d.innerHTML='<span class="pd-dot"></span>'+ph.name;
d.onclick=()=>{if(S.phase>=i){S.phase=i;S.step=0;save();showQ();updProgress();}};
c.appendChild(d);
/* Question list under each phase */
const ul=document.createElement('ul');ul.className='pd-qlist';ul.id='pq'+i;
ph.questions.forEach((q,si)=>{
const li=document.createElement('li');li.className='pd-q';
li.setAttribute('data-qid',q.id);
const shortQ=q.q.length>18?q.q.slice(0,18)+'…':q.q;
li.innerHTML='<span class="pd-qmark"></span>'+shortQ;
li.onclick=(e)=>{e.stopPropagation();if(S.phase>i||(S.phase===i&&S.step>=si)){S.phase=i;S.step=si;save();showQ();updProgress();}};
ul.appendChild(li);
});
c.appendChild(ul);
}
const tl=$('pdTitle');if(tl)tl.textContent=_ja?'進捗':'Progress';
const gb=$('pdGenBtn');if(gb)gb.textContent=_ja?'🚀 生成':'🚀 Generate';
}
function isQActive(q){
if(!q.condition)return true;
const[k,fn]=Object.entries(q.condition)[0];
return fn(S.answers[k]||'');
}
function updProgress(){
const qs=getQ();let total=0,done=0;
for(let p=1;p<=3;p++){const ph=qs[p];if(!ph)continue;ph.questions.forEach(q=>{if(!isQActive(q))return;total++;if(S.answers[q.id])done++;});}
const pct=total?Math.round(done/total*100):0;
$('pbar').style.width=pct+'%';
const pdBar=$('pdBar');if(pdBar)pdBar.style.width=pct+'%';
const pdPct=$('pdPct');if(pdPct)pdPct.textContent=done+'/'+total+' ('+pct+'%)';
for(let i=1;i<=3;i++){
const el=$('pp'+i);if(el){el.classList.toggle('active',S.phase===i);el.classList.toggle('done',S.phase>i);}
/* Update question-level status */
const ph=qs[i];if(!ph)continue;
ph.questions.forEach((q,si)=>{
const li=document.querySelector('.pd-q[data-qid="'+q.id+'"]');
if(!li)return;
const active=isQActive(q);
li.classList.toggle('answered',active&&!!S.answers[q.id]);
li.classList.toggle('current',active&&S.phase===i&&S.step===si);
li.classList.toggle('q-na',!active);
});
}
updTOC();
}
function addMsg(type,text,tip,qid,helpId){
const _ja=S.lang==='ja';
const body=$('cbody'),d=document.createElement('div');d.className='msg';
const cls=type==='bot'?'m-bot':'m-usr';
const w=document.createElement('div');w.className=cls;w.style.position='relative';
const lbl=document.createElement('div');lbl.className='m-lbl';
lbl.textContent=type==='bot'?(_ja?'AI アシスタント':'AI Assistant'):(_ja?'あなた':'You');
if(type==='bot'&&helpId&&HELP_DATA[helpId]){
const hb=document.createElement('span');hb.className='q-help';hb.textContent='?';hb.title=_ja?'ヘルプ':'Help';
hb.onclick=(e)=>showHelp(helpId,e);
lbl.appendChild(hb);
}
const bd=document.createElement('div');bd.className='m-body';
text.split('\n').forEach((l,i,a)=>{bd.appendChild(document.createTextNode(l));if(i<a.length-1)bd.appendChild(document.createElement('br'));});
w.appendChild(lbl);w.appendChild(bd);
if(type==='user'&&qid){
const eb=document.createElement('button');
eb.className='m-edit';eb.textContent='✎';eb.title=_ja?'編集':'Edit';
eb.onclick=()=>editAnswer(qid,d);
w.appendChild(eb);
d.dataset.qid=qid;
}
d.appendChild(w);body.appendChild(d);
if(tip){const tt=document.createElement('div');tt.className='msg';tt.innerHTML='<div class="m-tip">💡 '+esc(tip)+'</div>';body.appendChild(tt);}
body.scrollTop=body.scrollHeight;
return d;
}
function showQ(){
const qs=getQ();
const ph=qs[S.phase];if(!ph)return;
// Skip conditional questions
while(S.step<ph.questions.length){
const q=ph.questions[S.step];
if(!isQActive(q)){S.step++;continue;}
break;
}
if(S.step>=ph.questions.length){phaseEnd();return;}
const q=ph.questions[S.step];
$('pdTitle').textContent=ph.name;
updProgress();
addMsg('bot',q.q,q.tip,null,q.help);
renderInputFor(q,(val)=>{
if(S.skill==='pro'){showConfirm(val,()=>{doSubmit(q.id,val);});}
else{doSubmit(q.id,val);}
},true);
}
function doSubmit(qid,val){
S.answers[qid]=sanitize(val.trim?val.trim():String(val));
addMsg('user',String(val),null,qid);
showCompatAlert(S.answers);
S.step++;save();
setTimeout(()=>{
const ph=getQ()[S.phase];
if(!ph||S.step>=ph.questions.length)phaseEnd();
else showQ();
},300);
}
function showCompatAlert(answers){
const issues=checkCompat(answers).filter(i=>i.level==='error'||i.level==='warn'||i.level==='info');
if(!issues.length)return;
const _ja=S.lang==='ja';const body=$('cbody');
issues.forEach(iss=>{
const d=document.createElement('div');d.className='msg';
const icon=iss.level==='error'?'❌':iss.level==='warn'?'⚠️':'ℹ️';
const cls=iss.level==='error'?'compat-error':iss.level==='warn'?'compat-warn':'compat-info';
let h=`<div class="${cls}"><span class="compat-icon">${icon}</span><span class="compat-msg">${esc(iss.msg)}</span>`;
if(iss.fix)h+=`<button class="btn btn-xs btn-s compat-fix" onclick="S.answers['${escAttr(iss.fix.f)}']='${escAttr(iss.fix.s)}';save();this.parentNode.innerHTML='✅ ${_ja?'修正済':'Fixed'}: ${escHtml(iss.fix.f)} → ${escHtml(iss.fix.s)}'">${_ja?'修正':'Fix'}</button>`;
h+='</div>';d.innerHTML=h;body.appendChild(d);
});
body.scrollTop=body.scrollHeight;
}
function phaseEnd(){
if(S.phase<3){
const msg=t('phEnd'+S.phase);
addMsg('bot',msg);
if(typeof announce==='function')announce(msg);
S.phase++;S.step=0;save();
setTimeout(()=>showQ(),400);
} else {
handleSkipped();
}
}
function skipQ(qid){
if(!S.skipped.includes(qid))S.skipped.push(qid);
addMsg('bot',t('skipMsg'));
S.step++;save();
setTimeout(()=>{
const ph=getQ()[S.phase];
if(!ph||S.step>=ph.questions.length)phaseEnd();
else showQ();
},250);
}
function handleSkipped(){
S.skipped=S.skipped.filter(id=>!S.answers[id]);
if(S.skipped.length===0){finish();return;}
addMsg('bot',t('skippedTitle')+S.skipped.length+t('skippedSuffix'));
askNextSkipped();
}
function askNextSkipped(){
S.skipped=S.skipped.filter(id=>!S.answers[id]);
if(S.skipped.length===0){addMsg('bot',t('skippedDone'));finish();return;}
const qid=S.skipped[0];
let targetQ=null;
for(const ph of Object.values(getQ())){for(const q of ph.questions){if(q.id===qid){targetQ=q;break;}}}
if(!targetQ){S.skipped.shift();askNextSkipped();return;}
const zone=$('izone');zone.innerHTML='';
const banner=document.createElement('div');banner.className='skipped-banner';
banner.innerHTML='<span>'+t('skippedBanner')+S.skipped.length+t('skippedBannerSuffix')+'</span>';
zone.appendChild(banner);
addMsg('bot',targetQ.q,targetQ.tip,null,targetQ.help);
renderInputFor(targetQ,(val)=>{
S.answers[qid]=sanitize(val.trim?val.trim():String(val));
addMsg('user',String(val),null,qid);
S.skipped.shift();
showCompatAlert(S.answers);save();
setTimeout(()=>askNextSkipped(),250);
},false);
}
function finish(){
showGenerate();
showComplexity();
}
function showGenerate(){
const zone=$('izone');zone.innerHTML='';
const btn=document.createElement('button');btn.className='btn btn-p';btn.style.cssText='padding:14px 40px;font-size:14px;margin:20px;';
btn.textContent=t('genBtn');
btn.onclick=()=>{generateAll();};
zone.appendChild(btn);
}
function findNext(){
const qs=getQ();
for(let p=1;p<=3;p++){const ph=qs[p];if(!ph)continue;
for(let s=0;s<ph.questions.length;s++){
const q=ph.questions[s];
if(!isQActive(q))continue;
if(!S.answers[q.id]){S.phase=p;S.step=s;showQ();return;}
}
}
finish();
}
/* ═══ V9 RENDER FUNCTIONS ═══ */
const _TECHDB_MAP={
frontend:'front',backend:'back',css_fw:'front',
database:'back',orm:'back',mobile:'mobile',
ai_auto:'ai_auto',payment:'payment',ai_tools:'ai',
deploy:'devops',dev_methods:'method'
};
const _CAT_LABELS={
ja:{lang:'言語',front:'フロントエンド',mobile:'モバイル',back:'バックエンド',
baas:'BaaS',payment:'決済/CMS/EC',devops:'DevOps',ai:'AIツール',
ai_auto:'AI自律',method:'手法',test:'テスト',api:'API',
build:'ビルド',data:'データ',security:'セキュリティ'},
en:{lang:'Language',front:'Frontend',mobile:'Mobile',back:'Backend',
baas:'BaaS',payment:'Payment/CMS/EC',devops:'DevOps',ai:'AI Tools',
ai_auto:'AI Autonomous',method:'Methods',test:'Testing',api:'API',
build:'Build',data:'Data',security:'Security'}
};
function renderInputFor(q,onSubmit,allowSkip){
const zone=$('izone');
const existingBanner=zone.querySelector('.edit-banner')||zone.querySelector('.skipped-banner');
if(!existingBanner)zone.innerHTML='';
if(q.type==='chip-text')renderChips(zone,q,false,onSubmit,true);
else if(q.type==='chip-multi')renderChips(zone,q,true,onSubmit,true);
else if(q.type==='options')renderOpts(zone,q,onSubmit);
// Add TECH_DB browser button
if(_TECHDB_MAP[q.id]&&typeof TECH_DB!=='undefined'){
const _ja=S.lang==='ja';
const tb=document.createElement('button');
tb.className='btn btn-xs btn-tech-browse';
tb.textContent=_ja?'🔍 技術マスターから選択...':'🔍 Browse Tech Master...';
tb.onclick=()=>showTechBrowser(q.id,val=>{
// options型: 直接サブミット、chip-multi型: チップ追加
if(q.type==='options'){onSubmit(val);}
else{
// chip-multiの場合、カスタムチップとして追加
const gr=zone.querySelector('.cgrid');
if(gr){
const ch=document.createElement('div');ch.className='chip active';
ch.textContent='✓ '+val;ch.dataset.val=val;
ch.onclick=()=>ch.classList.toggle('active');
gr.appendChild(ch);
}
}
});
zone.appendChild(tb);
}
if(allowSkip!==false){
const sk=document.createElement('div');sk.style.cssText='padding:4px 20px 10px;text-align:right;';
const btn=document.createElement('button');btn.className='skip-btn';btn.textContent=t('skip');
btn.onclick=()=>skipQ(q.id);
sk.appendChild(btn);zone.appendChild(sk);
}
}
function renderChips(zone,q,multi,onSubmit,withVoice){
const _ja=S.lang==='ja';
const sel=new Set();
const cz=document.createElement('div');cz.className='czone';
const lb=document.createElement('div');lb.className='czlabel';lb.textContent=_ja?(multi?'選択してください（複数可・自由入力併用）':'選択するか下に入力'):(multi?'Select multiple or type below':'Select or type below');
cz.appendChild(lb);
const gr=document.createElement('div');gr.className='cgrid';
(q.chips||[]).forEach(ch=>{
const c=document.createElement('div');c.className='chip';
c.setAttribute('tabindex','0');
c.setAttribute('role',multi?'checkbox':'option');
if(multi){const ck=document.createElement('span');ck.className='ck';ck.textContent='✓';c.appendChild(ck);}
c.appendChild(document.createTextNode(ch));
c.onclick=()=>{
if(multi){if(sel.has(ch)){sel.delete(ch);c.classList.remove('on')}else{sel.add(ch);c.classList.add('on')}}
else{onSubmit(ch);}
};
c.onkeydown=(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();c.click();}};
gr.appendChild(c);
});
cz.appendChild(gr);zone.appendChild(cz);
const ft=document.createElement('div');ft.className='cfoot';
const inp=document.createElement('input');inp.className='cadd';inp.placeholder=q.placeholder||(_ja?'自由入力…':'Type here…');
if(multi){
inp.addEventListener('keypress',e=>{
if(e.key==='Enter'&&inp.value.trim()){
const v=inp.value.trim();sel.add(v);
const c=document.createElement('div');c.className='chip on';
const ck=document.createElement('span');ck.className='ck';ck.textContent='✓';c.appendChild(ck);
c.appendChild(document.createTextNode(v));c.onclick=()=>{sel.delete(v);c.remove();};
gr.appendChild(c);inp.value='';
}
});
const btn=document.createElement('button');btn.className='btn btn-p btn-sm';btn.textContent=t('confirm');
btn.onclick=()=>{if(inp.value.trim())sel.add(inp.value.trim());if(!sel.size){toast(t('selectMin'));return;}
const items=Array.from(sel);
if(q.sortable&&items.length>1){renderDnD(zone,items,onSubmit);}
else{onSubmit(items.join(', '));}
};
ft.appendChild(inp);ft.appendChild(btn);
if(withVoice&&voiceRec){const vb=document.createElement('button');vb.className='voice-btn';vb.textContent='🎙️';vb.title=_ja?'音声入力':'Voice Input';vb.onclick=()=>toggleVoice(vb);ft.appendChild(vb);}
} else {
inp.addEventListener('keypress',e=>{if(e.key==='Enter'&&inp.value.trim())onSubmit(inp.value.trim());});
const btn=document.createElement('button');btn.className='btn btn-p btn-sm';btn.textContent=t('send');
btn.onclick=()=>{if(inp.value.trim())onSubmit(inp.value.trim());};
ft.appendChild(inp);ft.appendChild(btn);
if(withVoice&&voiceRec){const vb=document.createElement('button');vb.className='voice-btn';vb.textContent='🎙️';vb.title=_ja?'音声入力':'Voice Input';vb.onclick=()=>toggleVoice(vb);ft.appendChild(vb);}
}
zone.appendChild(ft);
}
function renderOpts(zone,q,onSubmit){
const cards=document.createElement('div');cards.className='ocards';
(q.options||[]).forEach(o=>{
const c=document.createElement('div');c.className='ocard';
c.setAttribute('tabindex','0');
c.setAttribute('role','option');
const h=document.createElement('h5');h.textContent=typeof o==='string'?o:o.label;c.appendChild(h);
if(o.desc){const p=document.createElement('p');p.textContent=o.desc;c.appendChild(p);}
c.onclick=()=>onSubmit(typeof o==='string'?o:o.label);
c.onkeydown=(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();c.click();}};
cards.appendChild(c);
});
zone.appendChild(cards);
}
function showTechBrowser(qId, onSelect){
const _ja=S.lang==='ja';
const cats=_TECHDB_MAP[qId];
if(!cats)return;
// 対象カテゴリのエントリをフィルタ
const primaryCat=cats;
const allCats=[...new Set(TECH_DB.filter(t=>t.cat===primaryCat).map(t=>t.cat))];
// モーダル構築
const ov=document.createElement('div');ov.className='techdb-overlay';
ov.onclick=e=>{if(e.target===ov)ov.remove();};
const modal=document.createElement('div');modal.className='techdb-modal';
// ヘッダー + 検索
const hd=document.createElement('div');hd.className='techdb-hd';
hd.innerHTML='<h3>'+(_ja?'技術マスターから選択':'Browse Tech Master')+'</h3>';
const search=document.createElement('input');search.className='techdb-search';
search.placeholder=_ja?'検索...':'Search...';
hd.appendChild(search);modal.appendChild(hd);
// カテゴリタブ + アイテムグリッド
const body=document.createElement('div');body.className='techdb-body';
const catList=document.createElement('div');catList.className='techdb-cats';
const itemGrid=document.createElement('div');itemGrid.className='techdb-items';
// 全カテゴリ表示（primaryCatをデフォルト選択）
const labels=_CAT_LABELS[_ja?'ja':'en'];
Object.keys(labels).forEach(cat=>{
const items=TECH_DB.filter(t=>t.cat===cat);
if(!items.length)return;
const btn=document.createElement('div');btn.className='techdb-cat';
btn.textContent=labels[cat]+' ('+items.length+')';
btn.dataset.cat=cat;
if(cat===primaryCat)btn.classList.add('sel');
btn.onclick=()=>{
catList.querySelectorAll('.techdb-cat').forEach(c=>c.classList.remove('sel'));
btn.classList.add('sel');
renderItems(cat);
};
catList.appendChild(btn);
});
function renderItems(cat){
itemGrid.innerHTML='';
const items=TECH_DB.filter(t=>t.cat===cat);
const q=search.value.toLowerCase();
items.filter(t=>!q||t.name.toLowerCase().includes(q)).forEach(t=>{
const card=document.createElement('div');card.className='techdb-item';
card.innerHTML='<b>'+esc(t.name)+'</b><span class="techdb-req">'+
(typeof reqLabel==='function'?reqLabel(t.req):t.req)+'</span>'+
(t.price?'<span class="techdb-price">'+(typeof priceLabel==='function'?priceLabel(t.price):t.price)+'</span>':'');
card.onclick=()=>{onSelect(t.name);ov.remove();};
itemGrid.appendChild(card);
});
}
search.oninput=()=>{
const sel=catList.querySelector('.techdb-cat.sel');
renderItems(sel?sel.dataset.cat:primaryCat);
};
body.appendChild(catList);body.appendChild(itemGrid);
modal.appendChild(body);ov.appendChild(modal);
document.body.appendChild(ov);
renderItems(primaryCat);
}
function renderDnD(zone,items,onSubmit){
const _ja=S.lang==='ja';
zone.innerHTML='';
const wrap=document.createElement('div');wrap.style.cssText='padding:10px 20px;';
const lbl=document.createElement('div');lbl.className='czlabel';lbl.textContent=t('sortLabel');
wrap.appendChild(lbl);
const list=document.createElement('ul');list.className='dnd-list';
let dragItem=null;
items.forEach((item,i)=>{
const li=document.createElement('li');li.className='dnd-item';li.draggable=true;li.dataset.idx=i;
const grip=document.createElement('span');grip.className='dnd-grip';grip.textContent='⠿';
const label=document.createElement('span');label.className='dnd-label';label.textContent=item;
const pri=document.createElement('span');pri.className='dnd-priority';
li.appendChild(grip);li.appendChild(label);li.appendChild(pri);
li.addEventListener('dragstart',e=>{dragItem=li;li.style.opacity='0.4';e.dataTransfer.effectAllowed='move';});
li.addEventListener('dragend',()=>{dragItem=null;li.style.opacity='1';list.querySelectorAll('.dnd-item').forEach(el=>el.classList.remove('drag-over'));updPri();});
li.addEventListener('dragover',e=>{e.preventDefault();e.dataTransfer.dropEffect='move';li.classList.add('drag-over');});
li.addEventListener('dragleave',()=>li.classList.remove('drag-over'));
li.addEventListener('drop',e=>{e.preventDefault();li.classList.remove('drag-over');if(dragItem&&dragItem!==li){const rect=li.getBoundingClientRect();const mid=rect.top+rect.height/2;if(e.clientY<mid)list.insertBefore(dragItem,li);else list.insertBefore(dragItem,li.nextSibling);}});
list.appendChild(li);
});
wrap.appendChild(list);
function updPri(){
const _ja=S.lang==='ja';
const els=list.querySelectorAll('.dnd-item');const n=els.length;
els.forEach((el,i)=>{
const p=el.querySelector('.dnd-priority');
if(i<Math.ceil(n*0.3)){p.textContent=_ja?'P0 必須':'P0 Must';p.className='dnd-priority p0';}
else if(i<Math.ceil(n*0.7)){p.textContent=_ja?'P1 重要':'P1 Important';p.className='dnd-priority p1';}
else{p.textContent=_ja?'P2 任意':'P2 Optional';p.className='dnd-priority p2';}
});
}
updPri();
const ft=document.createElement('div');ft.style.cssText='padding:6px 20px 12px;display:flex;gap:6px;justify-content:flex-end;';
const btn=document.createElement('button');btn.className='btn btn-p btn-sm';btn.textContent=t('sortConfirm');
btn.onclick=()=>{
const ordered=Array.from(list.querySelectorAll('.dnd-label')).map(el=>el.textContent);
const priLabels=Array.from(list.querySelectorAll('.dnd-priority')).map(el=>el.textContent.split(' ')[0]);
onSubmit(ordered.map((item,i)=>'['+priLabels[i]+'] '+item).join(', '));
};
ft.appendChild(btn);wrap.appendChild(ft);zone.appendChild(wrap);
}
/* ═══ V9 EDIT ANSWER ═══ */
function editAnswer(qid,msgEl){
const _ja=S.lang==='ja';
let targetQ=null;
for(const ph of Object.values(getQ())){for(const q of ph.questions){if(q.id===qid){targetQ=q;break;}}}
if(!targetQ)return;
const savedPhase=S.phase,savedStep=S.step;
let isEditing=true;
msgEl.style.outline='2px solid var(--warn)';msgEl.style.borderRadius='var(--radius)';
toast(_ja?'回答を編集中…':'Editing answer…');
const zone=$('izone');zone.innerHTML='';
const banner=document.createElement('div');banner.className='edit-banner';
banner.innerHTML='<span>'+(_ja?'✏️ 「'+esc(targetQ.q)+'」を編集中':'✏️ Editing: '+esc(targetQ.q))+'</span>';
const cancelBtn=document.createElement('button');cancelBtn.className='btn btn-g btn-xs';cancelBtn.textContent=_ja?'キャンセル':'Cancel';
cancelBtn.onclick=()=>{
if(!isEditing)return;isEditing=false;
msgEl.style.outline='';msgEl.style.borderRadius='';zone.innerHTML='';
S.phase=savedPhase;S.step=savedStep;
if(Object.keys(S.files).length>0){showExportGrid();}else{findNext();}
};
banner.appendChild(cancelBtn);zone.appendChild(banner);
renderInputFor(targetQ,(newVal)=>{
if(!isEditing)return;isEditing=false;
S.answers[qid]=sanitize(newVal.trim?newVal.trim():String(newVal));
const bd=msgEl.querySelector('.m-body');bd.textContent='';
String(newVal).split('\n').forEach((l,i,a)=>{bd.appendChild(document.createTextNode(l));if(i<a.length-1)bd.appendChild(document.createElement('br'));});
msgEl.style.outline='';msgEl.style.borderRadius='';zone.innerHTML='';
showCompatAlert(S.answers);
save();toast(_ja?'回答を更新しました':'Answer updated');
// If files already generated, regenerate silently (no language chooser)
if(Object.keys(S.files).length>0&&S.genLang){
doGenerate(S.genLang);
// doGenerate's setTimeout will restore export grid + file tree
} else {
// Still in Q&A flow — resume wizard
S.phase=savedPhase;S.step=savedStep;findNext();
}
},false);
}
/* ═══ V9 HELP POPUP ═══ */
function showHelp(id,e){
const _ja=S.lang==='ja';
const raw=HELP_DATA[id];if(!raw)return;const data=raw[S.lang]||raw.ja;
const popup=$('helpPopup');
popup.style.display='block';
popup.style.top=Math.min(e.clientY+10,window.innerHeight-250)+'px';
popup.style.left=Math.max(0,Math.min(e.clientX-100,window.innerWidth-380))+'px';
const safeLink=data.link&&(data.link.startsWith('https://')||data.link.startsWith('http://'))?data.link:'';
popup.innerHTML='<button class="hp-close" onclick="closeHelpPopup()" aria-label="'+t('helpClose')+'">✕</button><h4>'+esc(data.title)+'</h4><p>'+esc(data.desc)+'</p>'+(data.example?'<div class="hp-ex">'+esc(data.example)+'</div>':'')+(safeLink?'<a class="hp-link" href="'+esc(safeLink)+'" target="_blank" rel="noopener">📎 '+(_ja?'参考リンク':'Reference')+'</a>':'');
setTimeout(()=>{document.addEventListener('click',closeHelpOnClick,{once:true});},100);
}
function closeHelpPopup(){$('helpPopup').style.display='none';}
function closeHelpOnClick(e){if(!$('helpPopup').contains(e.target))closeHelpPopup();}
/* ═══ POST-GENERATION GUIDE ═══ */
function showPostGenGuide(force){
if(!force&&_lsGet('devforge-guide-shown'))return;
_lsSet('devforge-guide-shown','1');
const _ja=S.lang==='ja';
const lv=S.answers.skill_level||'Intermediate';
const isB=lv.includes('Beginner');const isP=lv.includes('Professional');
const overlay=document.createElement('div');
overlay.className='guide-overlay';
overlay.onclick=e=>{if(e.target===overlay)overlay.remove();};
const level=isB?{em:'🌱',name:_ja?'Beginner':'Beginner',cls:'guide-lv-b'}:isP?{em:'⚡',name:_ja?'Professional':'Professional',cls:'guide-lv-p'}:{em:'🔥',name:_ja?'Intermediate':'Intermediate',cls:'guide-lv-i'};
const steps=isB?(_ja?[
['ロードマップに従う','ダッシュボード柱⑦のロードマップUIがそのまま学習計画。Layer 1から順にチェック。📖で公式ドキュメントにジャンプ。'],
['3ファイルだけ覚える','<code>README.md</code>(GitHub公開用) / <code>.devcontainer/</code>(開発環境一発) / <code>CLAUDE.md</code>(AIに全仕様を理解させる)'],
['AIに丸ごと渡す','「全ファイルコピー」(Ctrl+Shift+C)でAIに貼り付け → 仕様を把握した状態で開発スタート。'],
]:[
['Follow the Roadmap','Dashboard Pillar ⑦ is your learning plan. Check off from Layer 1. Hit 📖 for official docs.'],
['Remember 3 Files','<code>README.md</code>(GitHub ready) / <code>.devcontainer/</code>(instant dev env) / <code>CLAUDE.md</code>(AI understands your project)'],
['Feed Everything to AI','"Copy All" (Ctrl+Shift+C) → Paste into AI → Start coding with full context.'],
]):isP?(_ja?[
['Agent Teams並列開発','AGENTS.mdでエージェント役割定義 → Claude Code Subagents / Antigravity Manager Viewで並列実行。'],
['SDD仕様駆動','<code>.spec/</code>がSSoT。tasks.mdをタスクキューとしてAIに投入。verification.mdで品質判定。'],
['6工程パイプライン','柱⑧のランチャーで📋レビュー→🔨実装→🧪テスト→♻️リファクタ→🔒セキュリティ→📝ドキュメント。'],
]:[
['Agent Teams Parallel Dev','AGENTS.md defines roles → Run with Claude Code Subagents / Antigravity Manager View.'],
['SDD Spec-Driven','<code>.spec/</code> is your SSoT. Feed tasks.md as task queue. Verify with verification.md.'],
['6-Stage Pipeline','Pillar ⑧ launcher: 📋Review → 🔨Implement → 🧪Test → ♻️Refactor → 🔒Security → 📝Docs.'],
]):(_ja?[
['SDD仕様駆動開発','<code>.spec/</code>がSSoT。AIへの指示は「tasks.mdの○○を実装して、specification.mdに従って」で完結。'],
['マルチAIツール統一','柱④の10ファイルでCursor/Claude Code/Copilot/Windsurf/Cline/Gemini全対応。フォルダに置くだけ。'],
['MCP拡張','mcp-config.jsonをプロジェクトルートに配置 → AIがcontext7/filesystem/playwright等を即利用。'],
]:[
['SDD Spec-Driven Dev','<code>.spec/</code> is your SSoT. Tell AI: "implement X from tasks.md following specification.md".'],
['Multi-AI Tool Unity','Pillar ④ generates 10 files covering Cursor/Claude Code/Copilot/Windsurf/Cline/Gemini. Just drop in.'],
['MCP Extension','Place mcp-config.json in root → AI instantly uses context7, filesystem, playwright MCPs.'],
]);
const lvKey=isB?'b':isP?'p':'i';
const prog=JSON.parse(_lsGet('devforge-guide-prog')||'{}');
const stepsHtml=steps.map((s,i)=>{
const done=prog[lvKey+i];
return `<div class="guide-step${done?' guide-step-done':''}" data-gi="${lvKey}${i}"><label class="guide-ck"><input type="checkbox" ${done?'checked':''} onchange="toggleGuideStep('${lvKey}${i}',this.checked,this.closest('.guide-step'))"><span class="guide-ckbox">${done?'✓':''}</span></label><div class="guide-step-num ${level.cls}">${i+1}</div><div><div class="guide-step-title">${s[0]}</div><div class="guide-step-desc">${s[1]}</div></div></div>`;
}).join('');
const doneCount=steps.filter((_,i)=>prog[lvKey+i]).length;
const progBar=`<div class="guide-prog"><div class="guide-prog-bar"><div class="guide-prog-fill" style="width:${Math.round(doneCount/steps.length*100)}%"></div></div><span class="guide-prog-txt">${doneCount}/${steps.length}</span></div>`;
overlay.innerHTML=`<div class="guide-modal">
<div class="guide-header">
<span class="guide-em">${level.em}</span>
<div>
<div class="guide-title">${_ja?'生成完了！次にやること':'Generation Complete! Next Steps'}</div>
<div class="guide-sub ${level.cls}">${level.name} ${_ja?'向けガイド':'Guide'}</div>
</div>
<button class="guide-close" onclick="this.closest('.guide-overlay').remove()">✕</button>
</div>
<div class="guide-badge">${_ja?'世界で唯一の仕様駆動AIプロジェクトジェネレーター':'The world\'s only spec-driven AI project generator'}</div>
${progBar}
<div class="guide-steps">${stepsHtml}</div>
<div class="guide-actions">
<button class="btn btn-s btn-sm" onclick="this.closest('.guide-overlay').remove();showManual('guide')">${_ja?'📖 詳細ガイド':'📖 Full Guide'}</button>
<button class="btn btn-s btn-sm" onclick="this.closest('.guide-overlay').remove();showManual('workflow')">${_ja?'📘 ワークフロー':'📘 Workflow'}</button>
<button class="btn btn-p btn-sm" onclick="this.closest('.guide-overlay').remove()">${_ja?'✨ 始める':'✨ Let\'s Go'}</button>
</div>
</div>`;
document.body.appendChild(overlay);
}
function toggleGuideStep(key,checked,el){
const prog=JSON.parse(_lsGet('devforge-guide-prog')||'{}');
if(checked)prog[key]=1;else delete prog[key];
_lsSet('devforge-guide-prog',JSON.stringify(prog));
if(el)el.classList.toggle('guide-step-done',checked);
if(el){const ckbox=el.querySelector('.guide-ckbox');if(ckbox)ckbox.textContent=checked?'✓':'';}
// Update progress bar
const overlay=el?.closest('.guide-overlay');
if(!overlay)return;
const total=overlay.querySelectorAll('.guide-step').length;
const done=overlay.querySelectorAll('.guide-step-done').length;
const fill=overlay.querySelector('.guide-prog-fill');
const txt=overlay.querySelector('.guide-prog-txt');
if(fill)fill.style.width=Math.round(done/total*100)+'%';
if(txt)txt.textContent=done+'/'+total;
}
/* ═══ V9 CONFIRM DIALOG ═══ */
function showConfirm(val,onOk){
if(S.skill!=='pro'){onOk();return;}
_confirmCb=onOk;
const ov=$('confirmOverlay');ov.style.display='flex';
pushModal(ov,()=>{ov.style.display='none';releaseFocus(ov);_confirmCb=null;});
ov.innerHTML='<div class="confirm-modal"><h4>'+t('answerConfirm')+'</h4>'
+'<div class="cm-val">'+esc(String(val))+'</div>'
+'<div class="cm-acts">'
+'<button class="btn btn-g btn-sm" onclick="removeModal($(\'confirmOverlay\'));$(\'confirmOverlay\').style.display=\'none\';releaseFocus($(\'confirmOverlay\'));_confirmCb=null;">'+t('edit')+'</button>'
+'<button class="btn btn-p btn-sm" onclick="removeModal($(\'confirmOverlay\'));$(\'confirmOverlay\').style.display=\'none\';releaseFocus($(\'confirmOverlay\'));if(_confirmCb){_confirmCb();_confirmCb=null;}">'+t('confirm')+'</button>'
+'</div></div>';
trapFocus(ov);
}
/* ═══ V9 COMPLEXITY ANALYSIS ═══ */
function getComplexityHTML(){
const a=S.answers;const _ja=S.lang==='ja';
const fs=(a.mvp_features||'').split(',').map(s=>s.trim()).filter(Boolean);
const fCount=fs.length;
const eCount=((a.data_entities||'').split(',')).filter(Boolean).length;
const sCount=((a.screens||'').split(',')).filter(Boolean).length;
const authCount=((a.auth||'').split(',')).filter(Boolean).length;
const hasTDD=hasDM('TDD')?1:0,hasBDD=hasDM('BDD')?1:0,hasDDD=hasDM('DDD')?1:0;
const beComplex=(a.backend||'').includes('なし')||(a.backend||'').includes('None')?0:(a.backend||'').includes('Firebase')||(a.backend||'').includes('Supabase')?1:2;
let score=0;
score+=Math.min(fCount*8,50);
score+=Math.min(eCount*3,20);
score+=Math.min(sCount*2,14);
score+=authCount*2;
score+=beComplex*5;
score+=(hasTDD+hasBDD+hasDDD)*3;
score=Math.min(score,100);
const level=score<=30?'low':score<=60?'mid':'high';
const levelLabel=score<=30?(_ja?'🟢 シンプル':'🟢 Simple'):score<=60?(_ja?'🟡 中規模':'🟡 Medium'):(_ja?'🔴 大規模':'🔴 Large');
const weeks=score<=30?(_ja?'2-4週':'2-4 wks'):score<=60?(_ja?'1-3ヶ月':'1-3 mo'):(_ja?'3-6ヶ月':'3-6 mo');
const devs=score<=30?(_ja?'1人':'1'):score<=60?(_ja?'1-2人':'1-2'):(_ja?'2-4人':'2-4');
const color=score<=30?'var(--success)':score<=60?'var(--warn)':'var(--danger)';
const _s=_ja?'件':'';
return `<div class="complexity-card"><div class="complexity-header"><div><div class="dash-total complexity-label">${_ja?'プロジェクト複雑度':'PROJECT COMPLEXITY'}</div><div class="complexity-sub">${levelLabel}</div>
</div><div class="complexity-score ${level}">${score}</div></div><div class="complexity-bar"><div class="complexity-fill" style="width:${score}%;background:${color};"></div></div><div class="complexity-grid"><div class="complexity-item"><span>${_ja?'MVP機能':'MVP Features'}</span>
<span>${fCount}${_s}</span></div><div class="complexity-item"><span>${_ja?'エンティティ':'Entities'}</span><span>${eCount}${_s}</span></div><div class="complexity-item"><span>${_ja?'画面数':'Screens'}</span><span>${sCount}${_s}</span>
</div><div class="complexity-item"><span>${_ja?'認証方式':'Auth Methods'}</span><span>${authCount}${_s}</span></div><div class="complexity-item"><span>${_ja?'推定期間':'Est. Duration'}</span><span>${weeks}</span></div>
<div class="complexity-item"><span>${_ja?'推奨人数':'Team Size'}</span><span>${devs}</span></div></div></div>`;
}
function showComplexity(){
const body=$('cbody');
const card=document.createElement('div');
card.innerHTML=getComplexityHTML();
body.appendChild(card.firstChild);body.scrollTop=body.scrollHeight;
}
/* ═══ V9 TOC NAVIGATION ═══ */
function updTOC(){
const toc=$('tocPanel');if(!toc||!S.projectName)return;
toc.style.display='block';
const qs=getQ();let items=[];
for(let p=1;p<=3;p++){
const ph=qs[p];if(!ph)continue;
for(const q of ph.questions){
if(!isQActive(q))continue;
const done=!!S.answers[q.id];
const active=S.phase===p&&ph.questions.indexOf(q)===S.step;
items.push('<div class="toc-item'+(done?' done':'')+(active?' active':'')+'" onclick="jumpToQ(\''+q.id+'\')" title="'+esc(q.q)+'"><span class="toc-dot"></span><span>'+esc(q.q)+'</span></div>');
}
}
toc.innerHTML=items.join('');
}
function jumpToQ(qid){
const el=document.querySelector('[data-qid="'+qid+'"]');
if(el)el.scrollIntoView({behavior:'smooth',block:'center'});
}
/* ═══ V9 VOICE INPUT ═══ */
function initVoice(){
const _ja=S.lang==='ja';
if(!('webkitSpeechRecognition' in window)&&!('SpeechRecognition' in window))return;
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
voiceRec=new SR();voiceRec.lang=_ja?'ja-JP':'en-US';voiceRec.interimResults=false;voiceRec.maxAlternatives=1;
voiceRec.onresult=(e)=>{
const text=e.results[0][0].transcript;
const inp=document.querySelector('.cadd');
if(inp){inp.value+=text;inp.focus();}
if(voiceBtn){voiceBtn.classList.remove('recording');voiceBtn.textContent='🎙️';}
};
voiceRec.onend=()=>{if(voiceBtn){voiceBtn.classList.remove('recording');voiceBtn.textContent='🎙️';}};
voiceRec.onerror=()=>{if(voiceBtn){voiceBtn.classList.remove('recording');voiceBtn.textContent='🎙️';}};
}
function toggleVoice(btn){
const _ja=S.lang==='ja';
if(!voiceRec)return;
voiceBtn=btn;
if(btn.classList.contains('recording')){voiceRec.stop();btn.classList.remove('recording');btn.textContent='🎙️';}
else{voiceRec.lang=_ja?'ja-JP':'en-US';voiceRec.start();btn.classList.add('recording');btn.textContent='⏹️';}
}
/* ═══ V9 PROJECT MANAGER ═══ */
function getProjects(){return _jp(_lsGet('devforge-projects'),{});}
function saveProject(){
if(!S.projectName)return;
const ps=getProjects();
ps[S.projectName]={state:JSON.parse(JSON.stringify(S)),date:new Date().toISOString()};
_lsSet('devforge-projects',JSON.stringify(ps));
}
function switchProject(name){
const ps=getProjects();const p=ps[name];
if(p&&p.state){
const _SAFE_KEYS=['phase','step','answers','projectName','skill','preset','lang','genLang','theme','pillar','previewFile','files','skipped','progress','editedFiles','prevFiles','_v'];
_SAFE_KEYS.forEach(k=>{if(Object.prototype.hasOwnProperty.call(p.state,k))S[k]=p.state[k];});
save();location.reload();
}
}
function deleteProject(name){
const ps=getProjects();delete ps[name];
_lsSet('devforge-projects',JSON.stringify(ps));
if(S.projectName===name){_lsRm(KEY);location.reload();}
else showPM();
}
function exportProject(){
const _ja=S.lang==='ja';
const ps=getProjects();const p=ps[S.projectName];
if(!p){toast(_ja?'保存されたプロジェクトがありません':'No saved project');return;}
const blob=new Blob([JSON.stringify(p,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');a.href=url;a.download=fileSlug(S.projectName)+'.devforge.json';a.click();
URL.revokeObjectURL(url);
toast(_ja?'📁 プロジェクトをエクスポートしました':'📁 Project exported');
_lsSet('devforge-last-export',new Date().toISOString());
}
function importProject(){
const _ja=S.lang==='ja';
const inp=document.createElement('input');inp.type='file';inp.accept='.json,.devforge.json';
inp.onchange=e=>{
const f=e.target.files[0];if(!f)return;
const reader=new FileReader();
reader.onload=ev=>{
try{
const data=JSON.parse(ev.target.result);
if(!data.state||!data.state.projectName){toast(_ja?'❌ 無効なファイル形式':'❌ Invalid file format');return;}
data.state.projectName=sanitizeName(data.state.projectName);
if(data.state.answers){
Object.keys(data.state.answers).forEach(k=>{
if(['__proto__','constructor','prototype'].includes(k)){delete data.state.answers[k];return;}
if(typeof data.state.answers[k]==='string'){
data.state.answers[k]=sanitize(data.state.answers[k]);
} else {
delete data.state.answers[k];
}
});
}
if(data.state.files){
Object.keys(data.state.files).forEach(k=>{
if(['__proto__','constructor','prototype'].includes(k)){delete data.state.files[k];return;}
if(typeof data.state.files[k]!=='string'){delete data.state.files[k];}
});
}
const ps=getProjects();
ps[data.state.projectName]=data;
_lsSet('devforge-projects',JSON.stringify(ps));
const _SAFE_KEYS=['phase','step','answers','projectName','skill','preset','lang','genLang','theme','pillar','previewFile','files','skipped','progress','editedFiles','prevFiles','_v'];
_SAFE_KEYS.forEach(k=>{if(Object.prototype.hasOwnProperty.call(data.state,k))S[k]=data.state[k];});
save();
toast(_ja?'✅ インポート完了':'✅ Import complete');
location.reload();
}catch(err){toast(_ja?'❌ 読み込みエラー':'❌ Read error');}
};
reader.readAsText(f);
};
inp.click();
}
function newProject(){
if(S.projectName)saveProject();
_lsRm(KEY);location.reload();
}
function showPM(){
const _ja=S.lang==='ja';
const ov=$('pmOverlay');ov.style.display='flex';
pushModal(ov,()=>{ov.style.display='none';releaseFocus(ov);});
const ps=getProjects();const names=Object.keys(ps);
let html='<div class="pm-modal"><h3>'+t('pmTitle')+'</h3>';
if(names.length===0){html+='<p class="dash-empty">'+t('pmEmpty')+'</p>';}
else{
names.forEach(name=>{
const isCurrent=name===S.projectName;
const meta=ps[name].date?new Date(ps[name].date).toLocaleDateString():'';
html+='<div class="pm-item'+(isCurrent?' current':'')+'" onclick="switchProject(\''+name.replace(/\\/g,'\\\\').replace(/'/g,"\\'")+'\')"><div><div class="pm-item-name">'+esc(name)+(isCurrent?' ✓':'')+'</div><div class="pm-item-meta">'+meta+'</div></div><div class="pm-item-acts"><button onclick="event.stopPropagation();deleteProject(\''+name.replace(/\\/g,'\\\\').replace(/'/g,"\\'")+'\')">🗑️</button></div></div>';
});
}
html+='<div class="pm-actions"><button class="btn btn-s" onclick="newProject()">➕ '+(_ja?'新規プロジェクト':'New Project')+'</button><button class="btn btn-s" onclick="importProject()">📥 '+(_ja?'インポート':'Import')+'</button>';
if(S.projectName)html+='<button class="btn btn-s" onclick="exportProject()">📤 '+(_ja?'エクスポート':'Export')+'</button>';
html+='<button class="btn btn-g btn-sm" onclick="closePM()">'+(_ja?'閉じる':'Close')+'</button></div></div>';
ov.innerHTML=html;
trapFocus(ov);
}
function closePM(){$('pmOverlay').style.display='none';releaseFocus($('pmOverlay'));removeModal($('pmOverlay'));}
/* ═══ PRESET & START ═══ */
function pickSkill(lv){S.skill=lv;document.querySelectorAll('.skcard').forEach(c=>{c.classList.toggle('on',c.dataset.lv===lv);c.setAttribute('aria-checked',String(c.dataset.lv===lv));});save();}
function initPresets(){
const row=$('presetRow');row.innerHTML='';
const _ja=S.lang==='ja';
Object.entries(PR).forEach(([k,v])=>{
if(k==='custom'||!v.name)return;
const c=document.createElement('span');c.className='prchip';
c.textContent=(v.icon||'')+(v.icon?' ':'')+(!_ja&&v.nameEn?v.nameEn:v.name);
c.onclick=(e)=>pickPreset(k,e);
// Preview tooltip
const _en=!_ja;
const desc=(_en&&v.purposeEn)?v.purposeEn:v.purpose||'';
const fe=v.frontend||'-';
const be=v.backend||'-';
const fts=(_en&&v.featuresEn?v.featuresEn:v.features)||[];
const ftStr=Array.isArray(fts)?fts.slice(0,3).join(', ')+(fts.length>3?' …':''):fts;
c.title=`${desc}\n─────\nFrontend: ${fe}\nBackend: ${be}\nFeatures: ${ftStr}`;
row.appendChild(c);
});
// Compare button
const cb=document.createElement('span');cb.className='prchip prchip-cmp';
cb.textContent=_ja?'⚔️ 比較':'⚔️ Compare';
cb.onclick=()=>showPresetCompare();
row.appendChild(cb);
// "Start from scratch" custom mode chip
const cs=document.createElement('span');cs.className='prchip prchip-custom';
cs.textContent=_ja?'📝 白紙から始める':'📝 Start from scratch';
cs.onclick=()=>{
S.preset='custom';
document.querySelectorAll('.prchip').forEach(c=>c.classList.remove('sel'));
cs.classList.add('sel');
toast(_ja?'カスタムモード — 全質問に回答します':'Custom mode — answer all questions');
};
row.appendChild(cs);
}
function showPresetCompare(){
const _ja=S.lang==='ja';const _en=S.lang==='en';
const keys=Object.keys(PR).filter(k=>k!=='custom'&&PR[k].name);
const opts=keys.map(k=>{const p=PR[k];return `<option value="${k}">${p.icon||''} ${_en&&p.nameEn?p.nameEn:p.name}</option>`;}).join('');
const ov=document.createElement('div');ov.className='guide-overlay';ov.id='cmpOv';
ov.onclick=e=>{if(e.target===ov)ov.remove();};
ov.innerHTML=`<div class="guide-modal" style="max-width:680px;width:95%;">
<div class="guide-header"><span class="guide-em">⚔️</span><div><div class="guide-title">${_ja?'テンプレート比較':'Template Comparison'}</div><div class="guide-sub">${_ja?'2つのプリセットを並べて比較':'Compare two presets side by side'}</div></div><button class="guide-close" onclick="$('cmpOv').remove()">✕</button></div>
<div class="cmp-selectors"><select id="cmpA" onchange="renderCompare()">${opts}</select><span class="cmp-vs">VS</span><select id="cmpB" onchange="renderCompare()">${opts.replace('value="'+keys[0]+'"','value="'+keys[1]+'"')}</select></div>
<div id="cmpBody"></div>
</div>`;
document.body.appendChild(ov);
$('cmpB').value=keys[1];
renderCompare();
}
function renderCompare(){
const _ja=S.lang==='ja';const _en=S.lang==='en';
const a=PR[$('cmpA').value];const b=PR[$('cmpB').value];
const n=k=>(_en&&k+'En' in a)?a[k+'En']:a[k];
const nb=k=>(_en&&k+'En' in b)?b[k+'En']:b[k];
const ft=v=>{const f=Array.isArray(v)?v:[];return f.length;};
const rows=[
[_ja?'目的':'Purpose',n('purpose')||'-',nb('purpose')||'-'],
['Frontend',a.frontend||'-',b.frontend||'-'],
['Backend',a.backend||'-',b.backend||'-'],
[_ja?'機能数':'Features',ft(_en?a.featuresEn:a.features),ft(_en?b.featuresEn:b.features)],
['Mobile',a.mobile||'none',b.mobile||'none'],
['AI',a.ai_auto||'none',b.ai_auto||'none'],
[_ja?'決済':'Payment',a.payment||'none',b.payment||'none'],
['Entities',(a.entities||'').split(',').length,(b.entities||'').split(',').length],
];
let h='<table class="cmp-table"><tr><th></th><th>'+(a.icon||'')+' '+(n('name')||'')+'</th><th>'+(b.icon||'')+' '+(nb('name')||'')+'</th></tr>';
rows.forEach(r=>{
const diff=String(r[1])!==String(r[2]);
h+=`<tr${diff?' class="cmp-diff"':''}><td class="cmp-label">${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td></tr>`;
});
h+='</table>';
$('cmpBody').innerHTML=h;
}
function pickPreset(k,e){
S.preset=k;
document.querySelectorAll('.prchip').forEach(c=>c.classList.remove('on'));
if(e&&e.target)e.target.classList.add('on');
const p=PR[k];
if(p&&p.name)$('nameIn').value=(S.lang==='en'&&p.nameEn)?p.nameEn:p.name;
save();
}
function start(){
const _ja=S.lang==='ja';
const name=sanitizeName($('nameIn').value);
if(!name){toast(_ja?'プロジェクト名を入力してください':'Please enter a project name');return;}
S.projectName=name;S.phase=1;S.step=0;S.skipped=[];
const p=PR[S.preset];const _en=S.lang==='en';
if(p&&p.name){
if(p.purpose)S.answers.purpose=(_en&&p.purposeEn)?p.purposeEn:p.purpose;
if(p.target){const t=_en&&p.targetEn?p.targetEn:p.target;S.answers.target=Array.isArray(t)?t.join(', '):t;}
if(p.frontend)S.answers.frontend=p.frontend;
if(p.backend)S.answers.backend=p.backend;
if(p.features){const f=_en&&p.featuresEn?p.featuresEn:p.features;S.answers.mvp_features=Array.isArray(f)?f.join(', '):f;}
if(p.entities)S.answers.data_entities=p.entities;
if(p.mobile&&p.mobile!=='none')S.answers.mobile=p.mobile;
if(p.ai_auto&&p.ai_auto!=='none'){
if(_en){
const _aiMap={'Vibe Coding入門':'Vibe Coding Intro','エージェント型開発':'Agentic Dev','マルチAgent協調':'Multi-Agent','フル自律開発':'Full Autonomous','オーケストレーター':'Orchestrator'};
S.answers.ai_auto=_aiMap[p.ai_auto]||p.ai_auto;
} else { S.answers.ai_auto=p.ai_auto; }
}
if(p.payment&&p.payment!=='none'){
const _payMap=_en
?{stripe:'Stripe',ec_build:'Stripe, Medusa (OSS EC)',stripe_billing:'Stripe Billing (Sub)'}
:{stripe:'Stripe決済',ec_build:'Stripe決済, Medusa (OSS EC)',stripe_billing:'Stripe Billing (サブスク)'};
S.answers.payment=_payMap[p.payment]||p.payment;
}
}
const presetName=p&&p.name?(_en&&p.nameEn?p.nameEn:p.name):'';
const preFilledCount=Object.keys(S.answers).length;
save();saveProject();
$('onboard').style.display='none';
$('ws').style.display='flex';
initPills();updProgress();showQ();
if(presetName&&preFilledCount>0){
toast(_ja?`✅ "${presetName}" を適用 — ${preFilledCount}件の回答を自動入力`:`✅ Applied "${presetName}" — ${preFilledCount} answers pre-filled`);
}
}
/* ═══ PREVIEW SYSTEM ═══ */
let _prevHistory=[];
let _prevHistIdx=-1;
let _prevNavFlag=false;
let _viewHistory=[];
let _viewHistIdx=-1;
let _viewNavFlag=false;
function _sanitizeHTML(html){
const allowedTags=['h1','h2','h3','h4','h5','h6','p','br','hr','ul','ol','li','a','strong','em','code','pre','blockquote','table','thead','tbody','tr','th','td','img','div','span','b','i','u','s','del','ins','sup','sub','dl','dt','dd'];
const allowedAttrs={a:['href','title','class','target','rel'],img:['src','alt','title','class'],code:['class'],pre:['class'],div:['class'],span:['class'],table:['class'],th:['colspan','rowspan'],td:['colspan','rowspan']};
const temp=document.createElement('div');temp.innerHTML=html;
function clean(el){
const tag=el.tagName.toLowerCase();
if(!allowedTags.includes(tag)){el.remove();return;}
const attrs=allowedAttrs[tag]||[];
Array.from(el.attributes).forEach(a=>{
if(!attrs.includes(a.name)){el.removeAttribute(a.name);}
else if(a.name==='href'||a.name==='src'){
const v=a.value.toLowerCase();
if(v.startsWith('javascript:')||v.startsWith('data:')||v.startsWith('vbscript:')||v.startsWith('about:')){el.removeAttribute(a.name);}
else if(!v.startsWith('http://')&&!v.startsWith('https://')&&!v.startsWith('mailto:')&&!v.startsWith('#')&&!v.startsWith('./')&&!v.startsWith('../')){el.removeAttribute(a.name);}
}
});
Array.from(el.children).forEach(c=>clean(c));
}
Array.from(temp.children).forEach(c=>clean(c));
return temp.innerHTML;
}
function _miniMD(raw){
if(!raw)return '';
const escH=(s)=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const lines=raw.split('\n');
let html='',inCode=false,inList=false,listType='',inTable=false,tableHeaders=[],inQuote=false,para='';
const flushPara=()=>{if(para.trim()){html+='<p>'+_procInline(para.trim())+'</p>';para='';}};
const _procInline=(s)=>{
s=s.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
s=s.replace(/\*(.+?)\*/g,'<em>$1</em>');
s=s.replace(/`(.+?)`/g,'<code>$1</code>');
s=s.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(m,txt,url)=>{
const u=url.trim().toLowerCase();
if(!u.startsWith('http://')&&!u.startsWith('https://')&&!u.startsWith('./')&&!u.startsWith('../')&&!u.startsWith('#'))return m;
return '<a href="'+escH(url)+'">'+txt+'</a>';
});
return s;
};
for(let i=0;i<lines.length;i++){
const line=lines[i],trim=line.trim();
if(inCode){
if(trim==='```'){html+='</code></pre>';inCode=false;}
else html+=escH(line)+'\n';
continue;
}
if(trim.startsWith('```')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
const lang=trim.slice(3).trim();
html+='<pre><code'+(lang?' class="language-'+escH(lang)+'"':'')+'>';
inCode=true;continue;
}
if(trim.startsWith('####')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h4>'+_procInline(trim.slice(4).trim())+'</h4>';continue;
}
if(trim.startsWith('###')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h3>'+_procInline(trim.slice(3).trim())+'</h3>';continue;
}
if(trim.startsWith('##')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h2>'+_procInline(trim.slice(2).trim())+'</h2>';continue;
}
if(trim.startsWith('#')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<h1>'+_procInline(trim.slice(1).trim())+'</h1>';continue;
}
if(/^(\-{3,}|\*{3,})$/.test(trim)){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
html+='<hr>';continue;
}
if(trim.startsWith('|')&&trim.endsWith('|')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);inQuote&&(html+='</blockquote>',inQuote=false);
const cells=trim.slice(1,-1).split('|').map(c=>c.trim());
if(!inTable){html+='<table><thead><tr>';cells.forEach(c=>html+='<th>'+_procInline(c)+'</th>');html+='</tr></thead><tbody>';tableHeaders=cells;inTable=true;}
else if(cells.every(c=>/^:?\-+:?$/.test(c))){}
else{html+='<tr>';cells.forEach(c=>html+='<td>'+_procInline(c)+'</td>');html+='</tr>';}
continue;
}
if(inTable&&!trim.startsWith('|')){html+='</tbody></table>';inTable=false;}
if(trim.startsWith('>')){
flushPara();inList&&(html+=listType==='ol'?'</ol>':'</ul>',inList=false);
if(!inQuote){html+='<blockquote>';inQuote=true;}
html+='<p>'+_procInline(trim.slice(1).trim())+'</p>';continue;
}
if(inQuote&&!trim.startsWith('>')){html+='</blockquote>';inQuote=false;}
const ulMatch=trim.match(/^[\-\*]\s+(\[[ x]\]\s+)?(.+)$/);
const olMatch=trim.match(/^\d+\.\s+(.+)$/);
if(ulMatch||olMatch){
flushPara();inQuote&&(html+='</blockquote>',inQuote=false);
const isCheck=ulMatch&&ulMatch[1];
const text=ulMatch?(ulMatch[2]||''):olMatch[1];
const newType=olMatch?'ol':'ul';
if(!inList){html+='<'+newType+'>';listType=newType;inList=true;}
else if(listType!==newType){html+='</'+listType+'><'+newType+'>';listType=newType;}
if(isCheck){const checked=ulMatch[1].includes('x');html+='<li><input type="checkbox"'+(checked?' checked':'')+' disabled> '+_procInline(text)+'</li>';}
else html+='<li>'+_procInline(text)+'</li>';
continue;
}
if(inList&&!ulMatch&&!olMatch){html+=listType==='ol'?'</ol>':'</ul>';inList=false;}
if(!trim){flushPara();continue;}
para+=(para?' ':'')+trim;
}
flushPara();
if(inCode)html+='</code></pre>';
if(inList)html+=listType==='ol'?'</ol>':'</ul>';
if(inQuote)html+='</blockquote>';
if(inTable)html+='</tbody></table>';
return html;
}
function _patchLinks(html){
return html.replace(/<a href="(https?:\/\/[^"]+)"/g,'<a href="$1" target="_blank" rel="noopener"');
}
function safeMD(raw){
if(window._noMarked||typeof marked==='undefined')return _miniMD(raw);
const html=marked.parse(raw);
return _patchLinks(_sanitizeHTML(html));
}
function diffBtn(path){
return (S.prevFiles[path]||S.editedFiles[path])?'<button class="btn btn-xs btn-s btn-diff" onclick="showDiff(\''+escAttr(path)+'\')">🔀 Diff</button>':'';
}
function prevToolbar(path,showRaw){
const _ja=S.lang==='ja';
const rawBtn=showRaw?`<button class="btn btn-xs btn-s" onclick="toggleMdRaw('${escAttr(path)}')">📝 Raw</button>`:'';
const canBack=_prevHistIdx>0;
const canFwd=_prevHistIdx<_prevHistory.length-1;
const navBtns=`<button class="btn btn-xs btn-s prev-nav-btn${canBack?'':' disabled'}" onclick="prevBack()" title="${_ja?'戻る':'Back'}">◀</button><button class="btn btn-xs btn-s prev-nav-btn${canFwd?'':' disabled'}" onclick="prevForward()" title="${_ja?'進む':'Forward'}">▶</button>`;
return `<div class="prev-toolbar">${navBtns}<span class="prev-path">📄 ${esc(path)}</span><div class="prev-toolbar-r">${rawBtn}<button class="btn btn-xs btn-s" onclick="openEditor('${escAttr(path)}')">✏️ ${_ja?'編集':'Edit'}</button>${diffBtn(path)}<button class="btn btn-xs btn-s" onclick="copyFileContent('${escAttr(path)}')">📋 ${_ja?'コピー':'Copy'}</button><button class="btn btn-xs btn-s" onclick="printCurrentFile()">🖨️ ${_ja?'印刷':'Print'}</button></div></div>`;
}
function initPrevTabs(){
const _ja=S.lang==='ja';
const tabs=$('prevTabs');tabs.innerHTML='';
const ja=_ja;
[ja?'ツリー':'Tree',ja?'プレビュー':'Preview'].forEach((n,i)=>{
const b=document.createElement('button');b.className='ptab'+(i===0?' on':'');
b.setAttribute('role','tab');b.setAttribute('aria-selected',String(i===0));
b.textContent=n;b.onclick=()=>{
document.querySelectorAll('.ptab').forEach(t=>{t.classList.remove('on');t.setAttribute('aria-selected','false');});
b.classList.add('on');b.setAttribute('aria-selected','true');
if(i===0)showFileTree();else showFilePreview();
};tabs.appendChild(b);
});
}
function initPillarTabs(){
const tabs=$('pillarTabs');tabs.innerHTML='';
const names=t('pillar');
names.forEach((n,i)=>{
const b=document.createElement('button');b.className='piltab'+(i===0?' on':'');
b.setAttribute('role','tab');b.setAttribute('aria-selected',String(i===0));
b.textContent=n;b.onclick=()=>{
S.pillar=i;
document.querySelectorAll('.piltab').forEach(t=>{t.classList.remove('on');t.setAttribute('aria-selected','false');});
b.classList.add('on');b.setAttribute('aria-selected','true');
if(i===4) showExplorer();
else if(i===5) showDashboard();
else if(i===6) showRoadmapUI();
else if(i===7) showAILauncher();
else if(i===8) showFileTree(); // Design System
else if(i===9) showFileTree(); // Reverse Engineering
else if(i===10) showFileTree(); // Implementation Intelligence
else if(i===11) showFileTree(); // Security Intelligence
else if(i===12) showFileTree(); // Strategic Intelligence
else showFileTree();
};tabs.appendChild(b);
});
}
function updatePreview(){
showFileTree();
}
function showFileTree(){
const _ja=S.lang==='ja';
const body=$('prevBody');
const pillar=S.pillar;
// Special UI pillars
if(pillar===4){showExplorer();return;}
if(pillar===5){showDashboard();return;}
if(pillar===6){showRoadmapUI();return;}
if(pillar===7){showAILauncher();return;}
pushView({pillar:pillar,type:'tree',file:null});
// pillar===8: Design System - show file tree (no special UI)
const tree=buildFileTree();
const hasFiles=Object.keys(S.files).length>0;
let h='<div class="ft-search"><input type="text" id="ftSearch" placeholder="'+(_ja?'🔍 ファイル検索…':'🔍 Search files…')+'" oninput="filterFileTree(this.value)"></div>';
h+='<ul class="file-tree" id="ftList">';
tree.forEach(f=>{
if(!f.name||f.name==='───────────'){h+='<li class="ft-separator">────────────────</li>';return;}
if(f.folder) h+=`<li class="folder">📁 ${f.name}/</li>`;
else {
const isGen=hasFiles&&S.files[f.path];
const isActive=S.previewFile===f.path;
const isEdited=S.editedFiles&&S.editedFiles[f.path];
h+=`<li data-path="${esc(f.path)}" onclick="previewFile('${escAttr(f.path)}')" class="tree-item${isActive?' active':''}${f.name.startsWith(' ')?' tree-indent':''}${isGen?'':' tree-disabled'}">
${isGen?'📄':'⬜'} ${esc(f.name.trim())}${isEdited?'<span class="tree-edited" title="Edited">●</span>':''}${isGen?'<span class="tree-gen">✓</span>':''}
</li>`;
}
});
h+='</ul>';
if(hasFiles){
const count=Object.keys(S.files).length;
const editCount=S.editedFiles?Object.keys(S.editedFiles).length:0;
h+=`<div class="prev-footer">
${count} ${_ja?'ファイル生成済み':'files generated'}${editCount?` · <span class="tree-edited">${editCount} ${_ja?'編集済み':'edited'}</span>`:''}
</div>`;
}

body.innerHTML=h;
}
function buildFileTree(){
const _ja=S.lang==='ja';
const files=[];
const pillar=S.pillar;
if(pillar===0){ // SDD
files.push({folder:true,name:'.spec'});
['constitution.md','specification.md','technical-plan.md','tasks.md','verification.md'].forEach(f=>
files.push({name:' '+f,path:'.spec/'+f}));
} else if(pillar===1){ // DevContainer
files.push({folder:true,name:'.devcontainer'});
['devcontainer.json','Dockerfile','docker-compose.yml','post-create.sh'].forEach(f=>
files.push({name:' '+f,path:'.devcontainer/'+f}));
files.push({name:'.env.example',path:'.env.example'});
} else if(pillar===2){ // MCP
files.push({folder:true,name:'.mcp'});
['project-context.md','tools-manifest.json','README.md'].forEach(f=>
files.push({name:' '+f,path:'.mcp/'+f}));
files.push({name:'mcp-config.json',path:'mcp-config.json'});
} else if(pillar===3){ // AI Rules
['.cursor/rules','.github/copilot-instructions.md','.windsurfrules','.clinerules',
'.kiro/spec.md','CLAUDE.md','AI_BRIEF.md','AGENTS.md','codex-instructions.md',
'skills/project.md','skills/catalog.md','skills/pipelines.md','skills/factory.md',
'skills/README.md','skills/skill_map.md','skills/agents/coordinator.md','skills/agents/reviewer.md',
'.ai/hooks.yml','.gemini/settings.json'
].forEach(f=>files.push({name:f,path:f}));
} else if(pillar===4){ // Explorer
files.push({name:_ja?'(並列実装探索 — UIのみ)':'(Parallel Explorer — UI only)',path:'_explorer'});
} else if(pillar===5){ // Dashboard
files.push({name:_ja?'(Context Dashboard — UIのみ)':'(Context Dashboard — UI only)',path:'_dashboard'});
} else if(pillar===6){ // Roadmap
files.push({folder:true,name:'roadmap'});
['LEARNING_PATH.md','TECH_STACK_GUIDE.md','MOBILE_GUIDE.md','TOOLS_SETUP.md',
'RESOURCES.md','MILESTONES.md','AI_WORKFLOW.md','AI_AUTONOMOUS.md','SAAS_COMMERCE_GUIDE.md'
].forEach(f=>files.push({name:' '+f,path:'roadmap/'+f}));
} else if(pillar===7){ // AI Launcher
files.push({name:_ja?'(AIランチャー — UIのみ)':'(AI Launcher — UI only)',path:'_launcher'});
} else if(pillar===8){ // Design System
files.push({folder:true,name:'docs'});
['26_design_system','27_sequence_diagrams'].forEach(f=>
files.push({name:' '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===9){ // Reverse Engineering
files.push({folder:true,name:'docs'});
['29_reverse_engineering','30_goal_decomposition','41_growth_intelligence'].forEach(f=>
files.push({name:' '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===10){ // Implementation Intelligence
files.push({folder:true,name:'docs'});
['39_implementation_playbook','40_ai_dev_runbook','42_skill_guide'].forEach(f=>
files.push({name:' '+f+'.md',path:'docs/'+f+'.md'}));
if(S.files['skills/impl-patterns.md']){
files.push({folder:true,name:'skills'});
files.push({name:' impl-patterns.md',path:'skills/impl-patterns.md'});
}
} else if(pillar===11){ // Security Intelligence
files.push({folder:true,name:'docs'});
['43_security_intelligence','44_threat_model','45_compliance_matrix','46_ai_security','47_security_testing'].forEach(f=>
files.push({name:' '+f+'.md',path:'docs/'+f+'.md'}));
} else if(pillar===12){ // Strategic Intelligence
files.push({folder:true,name:'docs'});
['48_industry_blueprint','49_tech_radar','50_stakeholder_strategy','51_operational_excellence','52_advanced_scenarios'].forEach(f=>
files.push({name:' '+f+'.md',path:'docs/'+f+'.md'}));
}
// Common files
files.push({name:'───────────',path:''});
files.push({folder:true,name:'.github/workflows'});
files.push({name:' ci.yml',path:'.github/workflows/ci.yml'});
files.push({name:'───────────',path:''});
files.push({folder:true,name:'docs'});
['01_project_overview','02_requirements','03_architecture','04_er_diagram',
'05_api_design','06_screen_design','07_test_cases','08_security',
'09_release_checklist','10_gantt','11_wbs','12_driven_dev','13_glossary',
'14_risk','15_meeting','16_review','17_monitoring',
'18_data_migration','19_performance','20_a11y','21_changelog',
'22_prompt_playbook','23_tasks','24_progress','25_error_logs',
'26_design_system','27_sequence_diagrams','28_qa_strategy','31_industry_playbook',
'32_qa_blueprint','33_test_matrix','34_incident_response','35_sitemap',
'36_test_strategy','37_bug_prevention','38_business_model'].forEach(f=>
files.push({name:' '+f+'.md',path:'docs/'+f+'.md'}));
files.push({name:'───────────',path:''});
['README.md','.gitignore','package.json','LICENSE'].forEach(f=>files.push({name:f,path:f}));
return files;
}
function previewFile(path){
const _ja=S.lang==='ja';
if(!path||path==='')return;
if(!_prevNavFlag){
if(_prevHistIdx<_prevHistory.length-1){
_prevHistory=_prevHistory.slice(0,_prevHistIdx+1);
}
_prevHistory.push(path);
_prevHistIdx=_prevHistory.length-1;
}
_prevNavFlag=false;
pushView({pillar:S.pillar,type:'preview',file:path});
S.previewFile=path;save();
document.querySelectorAll('.file-tree li').forEach(li=>{
li.classList.toggle('active',li.getAttribute('data-path')===path);
});
if(S.files[path]){
const raw=S.files[path];
if(path.endsWith('.md')&&raw.includes('```mermaid')){
let html=safeMD(raw);
let _mmBlocks=[];
html=html.replace(/<pre><code class="language-mermaid">([\s\S]*?)<\/code><\/pre>/g,
(m,code)=>{const id='_mm'+_mmBlocks.length;
_mmBlocks.push(code.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>'));
return '<div class="mermaid" id="'+id+'"></div>';});
$('prevBody').innerHTML=prevToolbar(path,true)+`<div id="mdRendered" class="md-rendered">${html}</div>`;
_mmBlocks.forEach((c,i)=>{const el=document.getElementById('_mm'+i);if(el)el.textContent=c;});
_markBrokenLinks();
loadMermaid(()=>{
if(_mermaidReady){
try{
const nodes=document.querySelectorAll('#mdRendered .mermaid');
if(nodes.length>0){
if(mermaid.run) mermaid.run({nodes:nodes});
else if(mermaid.init) mermaid.init(undefined,nodes);
}
}catch(e){console.warn('Mermaid render:',e);}
}
});
} else if(path.endsWith('.md')){
const html=safeMD(raw);
$('prevBody').innerHTML=prevToolbar(path,true)+`<div id="mdRendered" class="md-rendered">${html}</div>`;
_markBrokenLinks();
} else {
$('prevBody').innerHTML=prevToolbar(path,false)+`<pre>${escHtml(raw)}</pre>`;
}
// Switch preview tab to active
document.querySelectorAll('.ptab').forEach((t,i)=>{t.classList.toggle('on',i===1);});
} else {
$('prevBody').innerHTML=`<p class="empty-preview-sm">${_ja?'ファイルは生成後にプレビュー可能です':'File preview available after generation'}</p>`;
}
}
let _mdRawMode=false;
function toggleMdRaw(path){
_mdRawMode=!_mdRawMode;
if(_mdRawMode){
const el=$('mdRendered');
if(el) el.outerHTML=`<pre id="mdRaw">${escHtml(S.files[path])}</pre>`;
} else { previewFile(path); }
}
function copyFileContent(path){
if(S.files[path]){
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(S.files[path]).then(()=>toast(t('copyDone'))).catch(()=>{_fallbackCopy(S.files[path]);toast(t('copyDone'));});
} else {_fallbackCopy(S.files[path]);toast(t('copyDone'));}
}
}
function _fallbackCopy(text){const ta=document.createElement('textarea');ta.value=text;ta.style.cssText='position:fixed;left:-9999px;';document.body.appendChild(ta);ta.select();try{document.execCommand('copy');}catch(e){}ta.remove();}
function prevBack(){
if(_prevHistIdx>0){
_prevHistIdx--;
_prevNavFlag=true;
previewFile(_prevHistory[_prevHistIdx]);
}
}
function prevForward(){
if(_prevHistIdx<_prevHistory.length-1){
_prevHistIdx++;
_prevNavFlag=true;
previewFile(_prevHistory[_prevHistIdx]);
}
}
function printCurrentFile(){
const path=S.previewFile;
if(!path||!S.files[path])return;
const raw=S.files[path];
const G=S.genLang==='ja';
const content=path.endsWith('.md')?safeMD(raw):'<pre>'+escHtml(raw)+'</pre>';
const css='body{font-family:-apple-system,sans-serif;padding:40px;max-width:800px;margin:0 auto;color:#1e222d;}'+'pre{background:#f5f5f5;padding:16px;border-radius:8px;overflow-x:auto;}'+'table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background:#f0f0f0;}';
const _CSP_META='<meta http-equiv="Content-Security-Policy" content="default-src \'none\'; style-src \'unsafe-inline\'; img-src data: blob:;">';
const html='<!DOCTYPE html><html><head>'+_CSP_META+'<title>'+escHtml(path)+'</title><style>'+css+'</style></head><body>'+'<h1 style="border-bottom:2px solid #3b82f6;padding-bottom:8px;">'+escHtml(path)+'</h1>'+content+'</body></html>';
const win=window.open('','_blank');
if(win){win.document.write(html);win.document.close();}
else{
const blob=new Blob([html],{type:'text/html'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download=fileSlug(S.projectName)+'-'+path.replace(/\//g,'_');a.click();
}
}
function showFilePreview(){
const _ja=S.lang==='ja';
if(S.previewFile&&S.files[S.previewFile]){
previewFile(S.previewFile);
} else {
$('prevBody').innerHTML=`<p class="dash-empty">${_ja?'ファイルツリーからファイルを選択してください':'Select a file from the tree'}</p>`;
}
}
function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function _viewEq(a,b){return a&&b&&a.pillar===b.pillar&&a.type===b.type&&a.file===b.file;}
function pushView(vs){
if(_viewNavFlag)return;
if(_viewHistIdx>=0&&_viewEq(_viewHistory[_viewHistIdx],vs))return;
if(_viewHistIdx<_viewHistory.length-1)_viewHistory=_viewHistory.slice(0,_viewHistIdx+1);
_viewHistory.push(vs);
if(_viewHistory.length>50){_viewHistory=_viewHistory.slice(-50);}
_viewHistIdx=_viewHistory.length-1;
updViewNav();
}
function _restoreView(vs){
_viewNavFlag=true;
S.pillar=vs.pillar;
document.querySelectorAll('.piltab').forEach((t,i)=>{
t.classList.toggle('on',i===vs.pillar);
t.setAttribute('aria-selected',String(i===vs.pillar));
});
switch(vs.type){
case 'tree':showFileTree();break;
case 'preview':if(vs.file){_prevNavFlag=true;previewFile(vs.file);}break;
case 'explorer':showExplorer();break;
case 'dashboard':showDashboard();break;
case 'techdb':renderTechDB();break;
case 'roadmap':showRoadmapUI();break;
case 'launcher':showAILauncher();break;
default:showFileTree();
}
_viewNavFlag=false;
updViewNav();
}
function viewBack(){
if(_viewHistIdx>0){_viewHistIdx--;_restoreView(_viewHistory[_viewHistIdx]);}
}
function viewForward(){
if(_viewHistIdx<_viewHistory.length-1){_viewHistIdx++;_restoreView(_viewHistory[_viewHistIdx]);}
}
function updViewNav(){
const bb=$('viewBackBtn'),fb=$('viewFwdBtn');
if(!bb||!fb)return;
const _ja=S.lang==='ja';
bb.classList.toggle('disabled',_viewHistIdx<=0);
fb.classList.toggle('disabled',_viewHistIdx>=_viewHistory.length-1);
bb.title=_ja?'前の画面':'Previous Screen';
fb.title=_ja?'次の画面':'Next Screen';
}
function filterFileTree(q){
const list=$('ftList');if(!list)return;
const items=list.querySelectorAll('li');
const lq=q.toLowerCase();
items.forEach(li=>{
if(li.classList.contains('ft-separator')||li.classList.contains('folder')){
li.style.display=q?'none':'';return;
}
const path=li.dataset.path||li.textContent;
li.style.display=(!q||path.toLowerCase().includes(lq))?'':'none';
});
}
function _resolveFileRef(href,currentFile){
if(!href)return null;
const h=href.trim();
if(h.startsWith('http://')||h.startsWith('https://')||h.startsWith('#'))return null;
let resolved=null;
if(h.startsWith('./')){
const dir=currentFile.includes('/')?currentFile.substring(0,currentFile.lastIndexOf('/')+1):'';
resolved=dir+h.slice(2);
}else if(h.startsWith('../')){
const parts=currentFile.split('/');parts.pop();
const upParts=h.split('/');
for(let i=0;i<upParts.length;i++){
if(upParts[i]==='..'){parts.pop();}
else if(upParts[i]!=='.'&&upParts[i]!==''){resolved=parts.join('/')+(parts.length?'/':'')+upParts.slice(i).join('/');break;}
}
}else{
resolved=h;
}
if(resolved&&S.files[resolved])return resolved;
const basename=resolved?resolved.split('/').pop().replace(/^\d+_/,''):'';
if(basename){
for(const key in S.files){
const keyBase=key.split('/').pop().replace(/^\d+_/,'');
if(keyBase===basename||key.endsWith('/'+basename))return key;
}
}
return null;
}
function _markBrokenLinks(){
const links=document.querySelectorAll('.md-rendered a[href]');
links.forEach(a=>{
const href=a.getAttribute('href');
if(!href||href.startsWith('http://')||href.startsWith('https://')||href.startsWith('#'))return;
const resolved=_resolveFileRef(href,S.previewFile||'');
if(!resolved)a.classList.add('link-broken');
});
}
function _initLinkInterceptor(){
document.addEventListener('click',e=>{
const a=e.target.closest('.md-rendered a[href]');
if(!a)return;
const href=a.getAttribute('href');
if(!href)return;
if(href.startsWith('http://')||href.startsWith('https://')){
e.preventDefault();
window.open(href,'_blank','noopener');
return;
}
if(href.startsWith('#')){
e.preventDefault();
const id=href.slice(1);
const el=document.getElementById(id);
if(el)el.scrollIntoView({behavior:'smooth'});
return;
}
e.preventDefault();
const resolved=_resolveFileRef(href,S.previewFile||'');
if(resolved){
previewFile(resolved);
}else{
const _ja=S.lang==='ja';
toast((_ja?'ファイルが見つかりません: ':'File not found: ')+href);
}
},true);
}
/* ═══ FILE GENERATION ENGINE — 13 PILLARS ═══ */
function generateAll(){
const _be=S.answers.backend||'';
const _minKeys=(/なし|None|static/i.test(_be))?['frontend','backend']:['frontend','backend','database'];
if(_minKeys.some(k=>!S.answers[k])){
toast(S.lang==='ja'?'⚠️ 基本項目（FE/BE/DB）を先に回答してください':'⚠️ Answer basic items (FE/BE/DB) first');
return;
}
showGenLangChooser();
}
function showGenLangChooser(){
const _j=S.lang==='ja';
const ov=document.createElement('div');ov.className='gen-lang-overlay';ov.id='genLangOv';
ov.innerHTML=`<div class="gen-lang-modal">
<h3>${_j?'📄 生成ファイルの言語':'📄 File Language'}</h3>
<p>${_j?'生成するドキュメントの言語を選択してください':'Choose the language for generated documents'}</p>
<div class="gen-lang-btns">
<div class="gen-lang-btn" onclick="doGenerate('ja')"><span class="flag">🇯🇵</span>日本語</div>
<div class="gen-lang-btn" onclick="doGenerate('en')"><span class="flag">🇺🇸</span>English</div>
</div>
</div>`;
document.body.appendChild(ov);
}
function doGenerate(lang){
// Minimum answer safeguard
const _be2=S.answers.backend||'';
const _minKeys=(/なし|None|static/i.test(_be2))?['frontend','backend']:['frontend','backend','database'];
const _missing=_minKeys.filter(k=>!S.answers[k]);
if(_missing.length>0){
toast(S.lang==='ja'?'⚠️ 必須項目が未回答です: '+_missing.join(', '):'⚠️ Required fields unanswered: '+_missing.join(', '));
return;
}
snapshotFiles();
S.genLang=lang;save();
const ov=$('genLangOv');if(ov)ov.remove();
// Pre-generation compatibility gate
const _cErrs=checkCompat(S.answers).filter(c=>c.level==='error');
if(_cErrs.length>0){
const _j=S.lang==='ja';
const msg=_cErrs.map(e=>'❌ '+e.msg).join('\n');
if(!confirm((_j?'⚠️ スタック相性エラーが検出されました:\n\n':'⚠️ Stack compatibility errors detected:\n\n')+msg+'\n\n'+(_j?'このまま生成しますか？':'Continue generating?')))return;
}
addMsg('bot',S.lang==='ja'?'🔨 ファイルを生成中...':'🔨 Generating files...');
$('izone').innerHTML='<div class="gen-spinner"><div class="gen-prog-wrap"><div class="gen-prog-bar"><div class="gen-prog-fill" id="genProgFill"></div></div><div class="gen-prog-label" id="genProgLabel"></div></div><div class="spin gen-spinner-icon">⚙️</div></div>';
const a=S.answers;const pn=S.projectName;
S.files={};const _errs=[];const _j=S.lang==='ja';
const steps=[
{fn:()=>genPillar1_SDD(a,pn),lbl:_j?'柱① SDD仕様書':'Pillar ① SDD',err:'P1-SDD'},
{fn:()=>genPillar2_DevContainer(a,pn),lbl:_j?'柱② DevContainer':'Pillar ② DevContainer',err:'P2-Dev'},
{fn:()=>genPillar3_MCP(a,pn),lbl:_j?'柱③ MCP':'Pillar ③ MCP',err:'P3-MCP'},
{fn:()=>genPillar4_AIRules(a,pn),lbl:_j?'柱④ AIルール':'Pillar ④ AI Rules',err:'P4-AI'},
{fn:()=>genPillar5_QualityIntelligence(a,pn),lbl:_j?'品質インテリジェンス':'Quality Intelligence',err:'P5-QA'},
{fn:()=>genPillar7_Roadmap(a,pn),lbl:_j?'柱⑦ ロードマップ':'Pillar ⑦ Roadmap',err:'P7-Road'},
{fn:()=>genPillar9_DesignSystem(a,pn),lbl:_j?'柱⑨ デザインシステム':'Pillar ⑨ Design System',err:'P9-DS'},
{fn:()=>genPillar10_ReverseEngineering(a,pn),lbl:_j?'柱⑩ リバースEng':'Pillar ⑩ Reverse Eng',err:'P10-Rev'},
{fn:()=>genPillar11_ImplIntelligence(a,pn),lbl:_j?'柱⑪ 実装インテリジェンス':'Pillar ⑪ Impl Intelligence',err:'P11-Impl'},
{fn:()=>genPillar12_SecurityIntelligence(a,pn),lbl:_j?'柱⑫ セキュリティ':'Pillar ⑫ Security',err:'P12-Sec'},
{fn:()=>genPillar13_StrategicIntelligence(a,pn),lbl:_j?'柱⑬ 戦略インテリジェンス':'Pillar ⑬ Strategic Intelligence',err:'P13-Strategy'},
{fn:()=>genDocs21(a,pn),lbl:_j?'仕様書28種':'28 Spec Docs',err:'Docs'},
{fn:()=>genCommonFiles(a,pn),lbl:_j?'共通ファイル':'Common Files',err:'Common'},
];
let si=0;
function runStep(){
if(si>=steps.length){finishGen(_errs);return;}
const s=steps[si];const pct=Math.round((si/steps.length)*100);
const fill=$('genProgFill');if(fill)fill.style.width=pct+'%';
const lbl=$('genProgLabel');if(lbl)lbl.textContent=s.lbl;
if(typeof announce==='function')announce(s.lbl);
setTimeout(()=>{
try{s.fn();}catch(e){_errs.push(s.err);console.error('❌ '+s.err+' error:',e);}
si++;runStep();
},60);
}
setTimeout(runStep,300);
}
function finishGen(_errs){
if(_errs.length){toast('⚠️ '+_errs.length+(S.lang==='ja'?' 件のエラー: ':' errors: ')+_errs.join(', '));}
// Phase C: Post-generation audit
const _auditFindings=postGenerationAudit(S.files,S.answers);
const fill=$('genProgFill');if(fill)fill.style.width='100%';
const lbl=$('genProgLabel');if(lbl)lbl.textContent=S.lang==='ja'?'✅ 完了':'✅ Done';
const _fc=Object.keys(S.files).length;
const _ja=S.lang==='ja';
addMsg('bot',_ja?`✅ 生成完了！全${_fc}ファイルが準備できました。ファイルツリーからプレビューするか、エクスポートしてください。`:`✅ Generation complete! All ${_fc} files are ready. Preview in the file tree or export.`);
// Show audit results if any
if(_auditFindings.length>0){
const _sb=$('cbody');
const aErrs=_auditFindings.filter(f=>f.level==='error');
const aWarns=_auditFindings.filter(f=>f.level==='warn');
const aInfos=_auditFindings.filter(f=>f.level==='info');
let auditHtml='<div class="audit-results"><h4>'+(S.lang==='ja'?'🔍 生成後セルフ検証':'🔍 Post-Generation Audit')+'</h4>';
if(aErrs.length) auditHtml+='<div class="audit-summary-err">❌ '+aErrs.length+(S.lang==='ja'?' 件の問題':' issues')+'</div>';
if(aWarns.length) auditHtml+='<div class="audit-summary-warn">⚠️ '+aWarns.length+(S.lang==='ja'?' 件の注意':' warnings')+'</div>';
if(aInfos.length) auditHtml+='<div class="audit-summary-info">ℹ️ '+aInfos.length+(S.lang==='ja'?' 件の参考':' notes')+'</div>';
_auditFindings.forEach(f=>{
const cls=f.level==='error'?'compat-error':f.level==='warn'?'compat-warn':'compat-info';
const icon=f.level==='error'?'❌':f.level==='warn'?'⚠️':'ℹ️';
auditHtml+=`<div class="${cls}"><span class="compat-icon">${icon}</span><span class="compat-msg">${esc(f.msg)}</span></div>`;
});
auditHtml+='</div>';
const ad=document.createElement('div');ad.className='msg';ad.innerHTML=auditHtml;_sb.appendChild(ad);
}
if($('statFileNum'))$('statFileNum').textContent=_fc;
// Save recommendation notice
const _sn=document.createElement('div');_sn.className='msg';
const _sb2=$('cbody');
_sn.innerHTML=`<div class="compat-warn"><span class="compat-icon">💾</span><span class="compat-msg">${_ja?'データはブラウザのみに保存されています。<strong>📦 ZIP</strong> と <strong>📤 JSONエクスポート</strong> で必ずローカル保存してください。':'Data is only stored in your browser. Be sure to save locally with <strong>📦 ZIP</strong> and <strong>📤 JSON Export</strong>.'}</span></div>`;
_sb2.appendChild(_sn);_sb2.scrollTop=_sb2.scrollHeight;
showExportGrid();
showFileTree();
initPrevTabs();initPillarTabs();updProgress();save();
// Quick action bar
if(!$('qbar')){
const qb=document.createElement('div');qb.id='qbar';qb.className='qbar';
qb.innerHTML=`<button class="qbar-btn" onclick="exportZIP()">📦 ZIP</button><button class="qbar-btn" onclick="copyAllFiles()">📋 ${_ja?'全コピー':'Copy All'}</button><button class="qbar-btn" onclick="S.pillar=5;showFileTree()">📊 Dashboard</button><button class="qbar-btn" onclick="S.pillar=6;showRoadmapUI()">🗺️ Roadmap</button><button class="qbar-x" onclick="this.parentNode.remove()">✕</button>`;
const ws=$('ws');if(ws)ws.appendChild(qb);
}
setTimeout(showPostGenGuide,400);
}
function showExportGrid(){
const _ja=S.lang==='ja';const fc=Object.keys(S.files).length;
const totalChars=Object.values(S.files).reduce((s,v)=>s+v.length,0);
const tokens=Math.round(totalChars/4);
const sizeKB=Math.round(totalChars/1024);
const summary=`<div class="export-summary">
<span>📁 ${fc} ${_ja?'ファイル':'files'}</span>
<span>📏 ~${sizeKB.toLocaleString()}KB</span>
<span>🔤 ~${tokens.toLocaleString()} ${_ja?'トークン':'tokens'}</span>
</div>`;
$('izone').innerHTML=summary+`<div class="export-grid">
<div class="export-card" onclick="exportZIP()"><div class="icon">📦</div><h4>${_ja?'ZIP ダウンロード':'ZIP Download'}</h4><p>${_ja?'全'+fc+'ファイルをZIPで保存':'Save all '+fc+' files as ZIP'}</p></div>
<div class="export-card" onclick="exportPDF()"><div class="icon">📄</div><h4>${_ja?'PDF 印刷':'PDF Print'}</h4><p>${_ja?'仕様書をPDF化':'Export specs as PDF'}</p></div>
<div class="export-card" onclick="copyAllFiles()"><div class="icon">📋</div><h4>${_ja?'全ファイルコピー':'Copy All Files'}</h4><p>${_ja?'全結合テキストをコピー':'Copy all combined text'}</p></div>
<div class="export-card" onclick="copyForAI()"><div class="icon">🤖</div><h4>${_ja?'AI向けMarkdown':'AI Markdown'}</h4><p>${_ja?'TOC付きMD形式でコピー':'Copy as MD with TOC for AI'}</p></div>
<div class="export-card" onclick="saveTemplate()"><div class="icon">💾</div><h4>${_ja?'テンプレート保存':'Save Template'}</h4><p>${_ja?'設定を保存して再利用':'Save settings for reuse'}</p></div>
<div class="export-card" onclick="shareURL()"><div class="icon">🔗</div><h4>${_ja?'URL共有':'Share URL'}</h4><p>${_ja?'設定をURLで共有':'Share settings via URL'}</p></div>
<div class="export-card export-card-regen" onclick="generateAll()"><div class="icon">🔄</div><h4>${_ja?'再生成':'Regenerate'}</h4><p>${_ja?'回答から全ファイル再作成':'Rebuild all files from answers'}</p></div>
<div class="export-card export-card-danger" onclick="clearFiles()"><div class="icon">🗑️</div><h4>${_ja?'生成ファイルをクリア':'Clear Generated Files'}</h4><p>${_ja?fc+'ファイルを削除（回答は保持）':'Delete '+fc+' files (answers kept)'}</p></div>
</div>`;
}
function clearFiles(){
const _ja=S.lang==='ja';const fc=Object.keys(S.files).length;
if(!fc){toast(_ja?'クリアするファイルがありません':'No files to clear');return;}
const msg=_ja?fc+'ファイルの生成結果をクリアします。\n回答データは保持されます。続行しますか？':'Clear '+fc+' generated files?\nYour answers will be kept.';
if(!confirm(msg))return;
S.files={};S.editedFiles={};S.prevFiles={};S.genLang=null;S.previewFile=null;
save();showFileTree();showExportGrid();
toast(_ja?'✅ 生成ファイルをクリアしました':'✅ Generated files cleared');
}
/* ── Pillar ① SDD Integration (Phase B: Context-Aware) ── */
function genPillar1_SDD(a,pn){
const G=S.genLang==='ja';
const date=new Date().toISOString().split('T')[0];
const fe=a.frontend||'React + Next.js';
const be=a.backend||'Node.js + Express';
const db=a.database||'PostgreSQL';
const methods=(a.dev_methods||'TDD').split(', ');
const auth=resolveAuth(a);
const arch=resolveArch(a);
const sched=buildSchedule(a);
// B4: scope_out auto-adjustment + G3: domain inference
let scopeOut=a.scope_out || (()=>{
const domain=detectDomain(a.purpose);
const defaults={
education: G?'ネイティブアプリ, 動画配信インフラ, 決済以外の金融機能':'Native apps, Video streaming infrastructure, Non-payment financial features',
ec: G?'ネイティブアプリ, 実店舗POS連携, 会計ソフト連携, 物流管理':'Native apps, POS integration, Accounting software, Logistics management',
community: G?'ネイティブアプリ, 動画配信, リアルタイムビデオ通話, メール配信':'Native apps, Video streaming, Real-time video calls, Email delivery',
saas: G?'ネイティブアプリ, オンプレミスデプロイ, ホワイトラベル対応':'Native apps, On-premise deployment, White-label support',
content: G?'ネイティブアプリ, 動画配信, コメント通知メール':'Native apps, Video streaming, Comment notification emails',
analytics: G?'ネイティブアプリ, ETLパイプライン構築, データウェアハウス':'Native apps, ETL pipeline, Data warehouse',
booking: G?'ネイティブアプリ, 決済代行, カレンダー同期(外部API)':'Native apps, Payment processing, Calendar sync (external API)',
marketplace: G?'ネイティブアプリ, 物流管理, エスクロー決済':'Native apps, Logistics management, Escrow payments',
};
return defaults[domain] || (G?'ネイティブアプリ, モバイルアプリ':'Native apps, Mobile apps');
})();
if(a.mobile&&!isNone(a.mobile)&&!String(a.mobile).includes('PWA')){
scopeOut=scopeOut.replace(/ネイティブアプリ/g,G?'ストア配布用ネイティブビルド（Expo Web UIは対象内）':'Native app store builds (Expo Web UI is in scope)');
scopeOut=scopeOut.replace(/native apps?/gi,'Native app store builds (Expo Web UI is in scope)');
}
// Auth detail lines
const authLines=['- '+(G?'認証SoT（Source of Truth）':'Auth SoT')+': '+auth.sot,
'- '+(G?'トークン形式':'Token Type')+': '+auth.tokenType,
'- '+(G?'トークン検証':'Token Verification')+': '+auth.tokenVerify];
if(auth.social.length) authLines.push('- '+(G?'ソーシャルログイン':'Social Login')+': '+auth.social.join(', '));
authLines.push('- '+(G?'HTTPS必須':'HTTPS required'),'- '+(G?'環境変数でシークレット管理':'Secrets via env vars'),'- '+(G?'SQLインジェクション・XSS対策':'SQL injection & XSS prevention'));
// Architecture label
const archLabel=G?{baas:'BaaS統合型',bff:'BFF（API Routes統合）',split:'FE/BE分離型',traditional:'従来型クライアント-サーバー'}[arch.pattern]:{baas:'BaaS Integration',bff:'BFF (API Routes)',split:'FE/BE Split',traditional:'Traditional Client-Server'}[arch.pattern];
// ════ Constitution ════
S.files['.spec/constitution.md']=[
'# '+pn+' — '+(G?'プロジェクト憲法 (Constitution)':'Project Constitution'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. プロジェクトの使命':'## 1. Mission',a.purpose||(G?'（未定義）':'(Undefined)'),'',
G?'## 2. ターゲットユーザー':'## 2. Target Users',a.target||(G?'（未定義）':'(Undefined)'),'',
G?'## 3. 成功指標':'## 3. Success Metrics',
a.success || (()=>{
const domain=detectDomain(a.purpose);
const kpis={
education: G?'- コース完了率: 70%以上\n- 月間アクティブ学習者数 (MAL): 前月比+10%\n- 学習者満足度 (NPS): 40以上':'- Course completion rate: 70%+\n- Monthly Active Learners (MAL): +10% MoM\n- Learner NPS: 40+',
ec: G?'- 月間GMV: 前月比+15%\n- 購入CVR: 3%以上\n- カート離脱率: 70%以下':'- Monthly GMV: +15% MoM\n- Purchase CVR: 3%+\n- Cart abandonment: <70%',
community: G?'- 月間アクティブユーザー (MAU): 前月比+10%\n- 投稿/コメント率: DAU対比30%以上\n- 7日リテンション率: 40%以上':'- Monthly Active Users (MAU): +10% MoM\n- Post/comment rate: 30%+ of DAU\n- 7-day retention: 40%+',
saas: G?'- MRR（月次経常収益）: 前月比+10%\n- チャーン率: 月5%以下\n- NPS: 40以上':'- MRR: +10% MoM\n- Monthly churn: <5%\n- NPS: 40+',
content: G?'- 月間PV: 前月比+20%\n- 平均滞在時間: 3分以上\n- リピート訪問率: 30%以上':'- Monthly PV: +20% MoM\n- Avg session: 3min+\n- Return visit rate: 30%+',
analytics: G?'- DAU: 前月比+10%\n- レポート生成数: 週10件以上/ユーザー\n- データ更新頻度: リアルタイム(< 1分)':'- DAU: +10% MoM\n- Reports generated: 10+/week/user\n- Data refresh: real-time (<1min)',
booking: G?'- 予約完了率: 80%以上\n- 月間予約件数: 前月比+15%\n- キャンセル率: 10%以下':'- Booking completion: 80%+\n- Monthly bookings: +15% MoM\n- Cancellation rate: <10%',
marketplace: G?'- 月間取引件数: 前月比+15%\n- 出品者定着率: 60%以上\n- 購入者CVR: 5%以上':'- Monthly transactions: +15% MoM\n- Seller retention: 60%+\n- Buyer CVR: 5%+',
};
return kpis[domain] || (G?'- テストカバレッジ: 80%以上\n- ユーザー満足度: NPS 40以上\n- p95レスポンスタイム: 500ms以下':'- Test coverage: 80%+\n- User satisfaction: NPS 40+\n- p95 response time: <500ms');
})(),'',
G?'## 4. 技術原則':'## 4. Tech Principles',
'- '+(G?'フロントエンド':'Frontend')+': '+fe,
'- '+(G?'バックエンド':'Backend')+': '+be,
'- '+(G?'データベース':'Database')+': '+db,
'- '+(G?'アーキテクチャ':'Architecture')+': '+archLabel,
'- '+(G?'駆動開発手法':'Dev Methods')+': '+methods.join(', '),'',
G?'## 5. 品質基準':'## 5. Quality Standards',
'- '+(G?'テストカバレッジ: 80%以上':'Test Coverage: 80%+'),
'- TypeScript strict mode',
'- ESLint + Prettier '+(G?'適用':'enforced'),
'- CI/CD '+(G?'パイプライン必須':'pipeline required'),'',
G?'## 6. セキュリティ方針':'## 6. Security Policy',...authLines,'',
G?'## 7. スコープ外':'## 7. Out of Scope',scopeOut,''
].join('\n');
// B1: Architecture-aware API design
let apiDesignLines;
if(arch.isBaaS){
const bn=be.includes('Supabase')?'Supabase':be.includes('Firebase')?'Firebase':'Convex';
const rt=be.includes('Supabase')?'Supabase Realtime (WebSocket)':be.includes('Firebase')?'Firestore onSnapshot':'Convex Subscriptions';
const fn=be.includes('Supabase')?'Supabase Edge Functions (Deno)':be.includes('Firebase')?'Cloud Functions':'Convex Functions';
apiDesignLines=['- '+(G?'アクセス方式':'Access')+': '+bn+' Client SDK','- '+(G?'認証':'Auth')+': '+auth.tokenType,'- '+(G?'リアルタイム':'Realtime')+': '+rt,'- '+(G?'サーバーサイドロジック':'Server Logic')+': '+fn];
} else if(arch.pattern==='bff'){
apiDesignLines=['- RESTful API (Next.js API Routes / Route Handlers)','- '+(G?'バージョニング':'Versioning')+': /api/v1/','- '+(G?'認証':'Auth')+': '+auth.tokenType,'- '+(G?'レスポンス':'Response')+': JSON','- '+(G?'注意':'Note')+': '+(G?'Express のロジックは Next.js API Routes に統合。別途 Express サーバーは不要':'Express logic integrated into Next.js API Routes. No separate Express server needed.')];
} else {
apiDesignLines=['- RESTful API (OpenAPI 3.0)','- '+(G?'バージョニング':'Versioning')+': /api/v1/','- '+(G?'認証':'Auth')+': '+auth.tokenType,'- '+(G?'レスポンス':'Response')+': JSON'];
}
const hasMob=a.mobile&&!isNone(a.mobile);
const hasPay=a.payment&&!isNone(a.payment);
// ════ Specification ════
const specLines=[
'# '+pn+' — '+(G?'要件仕様書 (Specification)':'Specification'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. 機能要件':'## 1. Functional Requirements','',
G?'### 1.1 MVP機能':'### 1.1 MVP Features',
...(a.mvp_features||'').split(', ').flatMap(f=>{
const fd=getFeatureDetail(f);
const lines=['#### '+f.trim()];
if(fd){
const criteria=G?fd.criteria_ja:fd.criteria_en;
lines.push((G?'**受入条件:**':'**Acceptance Criteria:**'));
criteria.forEach(c=>{
const expanded=c.replace(/\{auth\}/g,a.auth||'OAuth');
lines.push('- [ ] '+expanded);
});
} else {
lines.push('- [ ] '+(G?'CRUD実装':'CRUD implementation'));
lines.push('- [ ] '+(G?'バリデーション':'Validation'));
lines.push('- [ ] '+(G?'権限チェック':'Authorization check'));
}
lines.push('');
return lines;
}),
G?'### 1.2 主要画面':'### 1.2 Key Screens',
(a.screens||'').split(', ').map(s=>'- '+s).join('\n'),'',
G?'### 1.3 ルーティング':'### 1.3 Routing',
'| URL | '+(G?'画面名':'Screen')+' | '+(G?'認証':'Auth')+' |',
'|-----|------|------|',
...genRoutes(a).map(r=>'| `'+r.path+'` | '+r.name+' | '+(r.auth?(G?'🔒 要':'🔒 Yes'):(G?'🌐 公開':'🌐 Public'))+' |'),
'',
G?'### 1.4 データモデル':'### 1.4 Data Model','```',
(G?'エンティティ':'Entities')+': '+(a.data_entities||(G?'（未定義）':'(Undefined)')),'```','',
G?'## 2. 非機能要件':'## 2. Non-functional Requirements',
'- '+(G?'レスポンスタイム':'Response Time')+': '+(S.skill==='pro'?'< 200ms (p95)':S.skill==='intermediate'?'< 500ms (p95)':'< 1000ms (p95)'),
'- '+(G?'可用性':'Availability')+': '+(S.skill==='pro'?'99.9%':S.skill==='intermediate'?'99%':(G?'ベストエフォート（PaaS依存）':'Best effort (PaaS-dependent)')),
'- '+(G?'同時接続':'Concurrent Users')+': '+(S.skill==='pro'?'1000+':S.skill==='intermediate'?'〜200':'〜50'),
'- '+(G?'モバイル対応':'Mobile')+': '+(hasMob?'✅ '+a.mobile:(G?'レスポンシブWebのみ':'Responsive Web only')),'',
G?'## 3. 技術スタック':'## 3. Tech Stack',
'| '+(G?'レイヤー':'Layer')+' | '+(G?'技術':'Tech')+' |','|---------|------|',
'| '+(G?'フロントエンド':'Frontend')+' | '+fe+' |',
'| '+(G?'バックエンド':'Backend')+' | '+be+' |',
'| '+(G?'データベース':'Database')+' | '+db+' |',
'| '+(G?'認証SoT':'Auth SoT')+' | '+auth.sot+' |',
'| '+(G?'デプロイ':'Deploy')+' | '+(a.deploy||'Vercel')+' |',
];
if(hasMob) specLines.push('| '+(G?'モバイル':'Mobile')+' | '+a.mobile+' |');
if(hasPay) specLines.push('| '+(G?'決済':'Payment')+' | '+a.payment+' |');
specLines.push('',G?'## 4. API設計方針':'## 4. API Design',...apiDesignLines,'');
// Stripe integration design
if(hasPay&&(a.payment||'').includes('Stripe')){
const isEdge=arch.isBaaS&&be.includes('Supabase');
specLines.push(
G?'## 5. 決済設計 (Stripe)':'## 5. Payment Design (Stripe)','',
G?'### 5.1 プラン設計':'### 5.1 Plan Design',
'| '+(G?'プラン':'Plan')+' | '+(G?'価格':'Price')+' | '+(G?'制限':'Limits')+' |',
'|--------|-------|------|',
'| Free | ¥0 | '+(G?'基本機能のみ':'Basic features only')+' |',
'| Pro | ¥980/'+(G?'月':'mo')+' | '+(G?'全機能・優先サポート':'All features, priority support')+' |',
'| Enterprise | ¥9,800/'+(G?'月':'mo')+' | '+(G?'全機能+SLA+専用サポート':'All features + SLA + dedicated support')+' |','',
G?'### 5.2 決済フロー':'### 5.2 Payment Flow',
'```',
G?'1. ユーザーがプラン選択':'1. User selects plan',
G?'2. Stripe Checkout セッション作成':'2. Create Stripe Checkout session',
G?'3. Stripe決済画面にリダイレクト':'3. Redirect to Stripe payment page',
G?'4. 決済完了 → success_url にリダイレクト':'4. Payment complete → redirect to success_url',
G?'5. Webhook (invoice.paid) → DB更新':'5. Webhook (invoice.paid) → update DB',
'```','',
G?'### 5.3 Webhookイベント':'### 5.3 Webhook Events',
'| Event | '+(G?'処理':'Action')+' |',
'|-------|------|',
'| `checkout.session.completed` | '+(G?'サブスクリプション開始':'Start subscription')+' |',
'| `invoice.paid` | '+(G?'支払確認・期間更新':'Confirm payment, renew period')+' |',
'| `customer.subscription.updated` | '+(G?'プラン変更反映':'Apply plan change')+' |',
'| `customer.subscription.deleted` | '+(G?'解約処理':'Cancel subscription')+' |','',
G?'### 5.4 実装':'### 5.4 Implementation',
'- Endpoint: `/api/webhook/stripe`',
'- '+(G?'署名検証':'Signature verification')+': `stripe.webhooks.constructEvent()`',
'- '+(G?'冪等性':'Idempotency')+': event.id '+(G?'でDB重複チェック':'DB dedup check'),
'- '+(G?'顧客紐付':'Customer mapping')+': User.stripe_customer_id','',
);
}
// RBAC design
const hasAdmin=/管理者|admin/i.test(a.target||'');
if(hasAdmin){
const rbacSectionNum=hasPay&&(a.payment||'').includes('Stripe')?6:5;
specLines.push(
(G?'## '+rbacSectionNum+'. ロール・権限設計 (RBAC)':'## '+rbacSectionNum+'. Role & Permission Design (RBAC)'),'',
G?'### ロール定義':'### Role Definitions',
'| '+(G?'ロール':'Role')+' | '+(G?'説明':'Description')+' | '+(G?'権限':'Permissions')+' |',
'|--------|------|------|',
'| user | '+(G?'一般ユーザー':'Regular user')+' | '+(G?'自分のデータのCRUD':'Own data CRUD')+' |',
'| admin | '+(G?'管理者':'Administrator')+' | '+(G?'全データの閲覧・編集・ユーザー管理':'All data view/edit, user management')+' |',
'| super_admin | '+(G?'スーパー管理者':'Super admin')+' | '+(G?'システム設定・ロール変更':'System config, role changes')+' |','',
G?'### 権限チェック':'### Permission Check',
'- profiles.role '+(G?'カラムでロール管理':'column for role management'),
'- '+(G?'ミドルウェア':'Middleware')+': '+(arch.isBaaS?'RLS + auth.jwt() role check':(G?'API Middleware で role チェック':'API middleware role check')),
'- '+(G?'管理者ルート':'Admin routes')+': /admin/ → role=admin '+(G?'以上':'or above'),
'- '+(G?'監査ログ':'Audit log')+': '+(G?'管理者操作は全件記録':'Log all admin actions'),'',
);
}
S.files['.spec/specification.md']=specLines.join('\n');
// Directory structure adapts to architecture
const dirLines=[pn+'/',
'├── src/',
'│ ├── app/ # '+(G?'ページ・ルーティング':'Pages & routing'),
'│ ├── components/ # '+(G?'UIコンポーネント':'UI components'),
'│ ├── lib/ # '+(G?'ユーティリティ':'Utilities'),
'│ ├── hooks/ # '+(G?'カスタムフック':'Custom hooks'),
'│ └── types/ # '+(G?'TypeScript型定義':'TypeScript types')];
if(arch.isBaaS){
if(be.includes('Supabase')) dirLines.push('├── supabase/ # '+(G?'マイグレーション・Edge Functions':'Migrations & Edge Functions'));
else if(be.includes('Firebase')) dirLines.push('├── functions/ # '+(G?'Cloud Functions':'Cloud Functions'));
} else {
if(arch.pattern!=='bff') dirLines.push('├── api/ # '+(G?'バックエンドAPI':'Backend API'));
const ormN=(a.orm&&a.orm.includes('Drizzle'))?'drizzle':'prisma';
dirLines.push('├── '+ormN+'/ # '+(G?'スキーマ・マイグレーション':'Schema & migrations'));
}
dirLines.push('├── tests/ # '+(G?'テスト':'Tests'),
'├── .spec/ # '+(G?'SDD仕様書':'SDD specs'),
'├── .devcontainer/ # '+(G?'開発環境':'Dev environment'),
'├── roadmap/ # '+(G?'学習ロードマップ':'Learning roadmap'),
'└── docs/ # '+(G?'ドキュメント':'Documents'));
const dirNote=arch.pattern==='bff'?'\n> '+(G?'Note: Express のロジックは src/app/api/ 配下の Route Handlers に統合':'Note: Express logic integrated into src/app/api/ Route Handlers')+'\n':'';
const entities=(a.data_entities||'users, items').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const entityLines=entities.map(en=>{
const cols=getEntityColumns(en,G,entities);
const lines=['### '+en,'- id: UUID (PK)'];
cols.forEach(c=>lines.push('- '+c.col+': '+c.type+(c.constraint?' ('+c.constraint+')':'')+(c.desc?' — '+c.desc:'')));
lines.push('- created_at: timestamp','- updated_at: timestamp');
return lines.join('\n');
}).join('\n\n');
// B5: ER inference
const er=inferER(a);
const erRelSection=er.relationships.length?'\n'+(G?'### リレーション':'### Relationships')+'\n```\n'+er.relationships.join('\n')+'\n```':'';
const erWarnSection=er.warnings.length?'\n'+(G?'### ⚠️ ドメイン適合性の注記':'### ⚠️ Domain Fit Notes')+'\n'+er.warnings.join('\n'):'';
const supaNote=(arch.isBaaS&&be.includes('Supabase'))?'> '+(G?'Supabase Dashboard または supabase/migrations/ でスキーマ管理':'Manage schema via Supabase Dashboard or supabase/migrations/')+'\n\n':'';
const deployNote=arch.pattern==='split'?' (FE) + Railway/Render ('+be+')':'';
// Per-table RLS policies
let rlsSection='';
if(arch.isBaaS&&be.includes('Supabase')){
const rlsLines=[G?'### RLS（Row Level Security）方針':'### RLS (Row Level Security) Policy',
G?'全テーブルにRLS有効化。ポリシー例:':'Enable RLS on all tables. Policy examples:','','```sql'];
(a.data_entities||'').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean).forEach(e=>{
const en=e.trim();const tbl=pluralize(en);
const cols=getEntityColumns(en,G,entities);
const hasUserId=cols.some(c=>c.col==='user_id');
const hasOwnerId=cols.some(c=>c.col==='owner_id'||c.col==='instructor_id'||c.col==='provider_id'||c.col==='sender_id');
const ownerCol=hasUserId?'user_id':cols.find(c=>c.col==='owner_id'||c.col==='instructor_id'||c.col==='provider_id')?.col;
if(en.toLowerCase()==='user'){
rlsLines.push(`-- ${tbl}: ${G?'本人のみ読取・更新':'Owner read/update only'}`,
`CREATE POLICY "${tbl}_select" ON ${tbl} FOR SELECT USING (auth.uid() = id);`,
`CREATE POLICY "${tbl}_update" ON ${tbl} FOR UPDATE USING (auth.uid() = id);`,'');
} else if(ownerCol){
rlsLines.push(`-- ${tbl}: ${G?'本人のデータのみ操作可':'Owner CRUD only'}`,
`CREATE POLICY "${tbl}_select" ON ${tbl} FOR SELECT USING (auth.uid() = ${ownerCol});`,
`CREATE POLICY "${tbl}_insert" ON ${tbl} FOR INSERT WITH CHECK (auth.uid() = ${ownerCol});`,
`CREATE POLICY "${tbl}_update" ON ${tbl} FOR UPDATE USING (auth.uid() = ${ownerCol});`,
`CREATE POLICY "${tbl}_delete" ON ${tbl} FOR DELETE USING (auth.uid() = ${ownerCol});`,'');
} else {
rlsLines.push(`-- ${tbl}: ${G?'認証ユーザーは読取可':'Authenticated read'}`,
`CREATE POLICY "${tbl}_select" ON ${tbl} FOR SELECT USING (auth.role() = 'authenticated');`,'');
}
});
rlsLines.push('```');
rlsSection='\n'+rlsLines.join('\n');
}
// Stripe integration section (uses hasPay/hasStripe from above)
const hasStripe=hasPay&&(a.payment||'').includes('Stripe');
let stripeSection='';
if(hasStripe){
const fn=arch.isBaaS&&be.includes('Supabase')?'Supabase Edge Function':'API Route';
stripeSection='\n\n'+(G?'## 7. 決済設計 (Stripe)':'## 7. Payment Design (Stripe)')+'\n\n'+
(G?'### サブスクリプションモデル':'### Subscription Model')+'\n'+
'| '+(G?'プラン':'Plan')+' | '+(G?'価格':'Price')+' | '+(G?'機能制限':'Limits')+' |\n'+
'|------|------|------|\n'+
'| Free | ¥0 | '+(G?'基本機能のみ':'Basic features only')+' |\n'+
'| Pro | ¥980/'+(G?'月':'mo')+' | '+(G?'全機能+優先サポート':'All features + priority support')+' |\n'+
'| Enterprise | ¥9,800/'+(G?'月':'mo')+' | '+(G?'全機能+SLA+専用サポート':'All features + SLA + dedicated support')+' |\n\n'+
(G?'### Webhook処理フロー':'### Webhook Flow')+'\n```\n'+
'Stripe → POST /api/webhook/stripe → '+(G?'署名検証':'Verify signature')+'\n'+
' ├── invoice.paid → subscription.status = active\n'+
' ├── invoice.payment_failed → '+(G?'リトライ通知メール':'Retry notification email')+'\n'+
' ├── customer.subscription.deleted → subscription.status = canceled\n'+
' └── customer.subscription.updated → '+(G?'プラン変更反映':'Update plan info')+'\n```\n\n'+
(G?'### DB設計':'### DB Design')+'\n'+
(G?'subscriptions テーブル:':'subscriptions table:')+'\n'+
'- user_id: UUID (FK → users)\n'+
'- stripe_subscription_id: TEXT (UNIQUE)\n'+
'- stripe_customer_id: TEXT\n'+
'- status: active | canceled | past_due | trialing\n'+
'- plan: free | pro | enterprise\n'+
'- current_period_end: TIMESTAMP\n\n'+
(G?'### 実装場所':'### Implementation')+': '+fn+'\n'+
'- POST /api/checkout → stripe.checkout.sessions.create()\n'+
'- POST /api/webhook/stripe → '+(G?'イベント処理':'Event handling')+'\n'+
'- GET /api/subscription → '+(G?'現在のプラン取得':'Get current plan');
}
const fullEntitySection=supaNote+entityLines+erRelSection+erWarnSection+rlsSection;
// ════ Technical Plan ════
S.files['.spec/technical-plan.md']=[
'# '+pn+' — '+(G?'技術計画書 (Technical Plan)':'Technical Plan'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. アーキテクチャ概要':'## 1. Architecture Overview',
(G?'### パターン':'### Pattern')+': '+archLabel,'','```',arch.diagram,'```',
arch.note?'\n> '+arch.note+'\n':'',
G?'## 2. ディレクトリ構造':'## 2. Directory Structure','```',dirLines.join('\n'),'```',dirNote,'',
G?'## 3. データベース設計':'## 3. Database Design',fullEntitySection,'',
G?'## 4. 認証設計':'## 4. Auth Design',
'- '+(G?'認証SoT':'Auth SoT')+': **'+auth.sot+'**',
'- '+(G?'トークン':'Token')+': '+auth.tokenType,
'- '+(G?'検証方法':'Verification')+': '+auth.tokenVerify,
auth.social.length?'- '+(G?'対応プロバイダ':'Providers')+': '+auth.social.join(', '):'','',
G?'## 5. 開発環境':'## 5. Dev Environment',
'- Docker DevContainer (.devcontainer/)',
'- '+(arch.isBaaS?be+' CLI (local emulator)':'Node.js LTS + '+db),
'- '+((a.ai_tools||'Cursor').split(', ')[0])+' + '+(G?'AI支援':'AI-assisted'),'',
'## 6. CI/CD','- GitHub Actions','- lint → test → build → deploy',
'- '+(G?'デプロイ先':'Deploy')+': '+(a.deploy||'Vercel')+deployNote,
stripeSection,''
].join('\n');
// B7: Tasks from single schedule source
const sprintTasks=(si)=>{
if(si===0) return ['- [ ] '+(G?'リポジトリ作成・初期設定':'Repo init & config'),
'- [ ] '+(G?'DevContainer設定':'DevContainer setup'),
'- [ ] '+(G?'CI/CD パイプライン構築':'CI/CD pipeline'),
'- [ ] '+(G?'データベーススキーマ定義':'Database schema')+((arch.isBaaS&&be.includes('Supabase'))?' + '+(G?'RLSポリシー設定':'RLS policy setup'):''),
'- [ ] '+(G?'認証基盤実装':'Auth implementation')+' ('+auth.sot+')'].join('\n');
if(si===1) return (a.mvp_features||(G?'CRUD操作':'CRUD Operations')).split(', ').map(f=>'- [ ] '+f).join('\n');
if(si===2) return (a.screens||(G?'ダッシュボード, ログイン':'Dashboard, Login')).split(', ').map(s=>'- [ ] '+s+' '+(G?'画面実装':'screen')).join('\n');
if(si===3) return ['- [ ] '+(G?'ユニットテスト (カバレッジ80%+)':'Unit tests (80%+ coverage)'),
'- [ ] '+(G?'E2Eテスト (主要フロー)':'E2E tests (key flows)'),
'- [ ] '+(G?'パフォーマンス最適化':'Performance optimization'),
'- [ ] '+(G?'本番デプロイ':'Production deploy'),
'- [ ] '+(G?'ドキュメント整備':'Documentation')].join('\n');
if(si===4) return ['- [ ] '+a.mobile+' '+(G?'プロジェクト初期化':'project init'),
'- [ ] '+(G?'画面実装（モバイル版）':'Mobile screens'),
'- [ ] '+(G?'ストアビルド設定':'Store build config'),
'- [ ] '+(G?'テスト':'Testing')].join('\n');
return '';
};
S.files['.spec/tasks.md']=[
'# '+pn+' — '+(G?'タスク一覧 (Tasks)':'Task List'),
'> Generated by DevForge v9 — '+date,
'> '+(G?'計画期間':'Timeline')+': '+sched.totalWeeks+' '+(G?'週間':'weeks')+' ('+sched.startDate+' 〜)','',
...sched.sprints.map((sp,i)=>'## '+sp.name+': '+(G?sp.focus_ja:sp.focus_en)+' ['+sp.weeks+']\n'+sprintTasks(i)),''
].join('\n\n');
// ════ Verification ════
const mobTest=hasMob?'| '+(G?'モバイルE2E':'Mobile E2E')+' | Maestro / Detox | '+(G?'主要フロー':'Key flows')+' |':'';
const rlsTest=(arch.isBaaS&&be.includes('Supabase'))?'- [ ] '+(G?'RLSポリシーテスト (全テーブル)':'RLS policy tests (all tables)'):'';
const features=(a.mvp_features||'').split(', ').filter(Boolean);
S.files['.spec/verification.md']=[
'# '+pn+' — '+(G?'検証計画書 (Verification)':'Verification Plan'),
'> Generated by DevForge v9 — '+date,'',
G?'## 1. テスト戦略':'## 1. Test Strategy',
'| '+(G?'テスト種別':'Test Type')+' | '+(G?'ツール':'Tool')+' | '+(G?'カバレッジ目標':'Coverage Goal')+' |',
'|-----------|--------|-------------|',
'| '+(G?'ユニットテスト':'Unit Test')+' | Vitest | 80% |',
'| '+(G?'統合テスト':'Integration')+' | Vitest | '+(G?'主要API全て':'All major APIs')+' |',
'| '+(G?'E2Eテスト':'E2E Test')+' | Playwright | '+(G?'主要フロー':'Key flows')+' |',
mobTest,'',
G?'## 2. 駆動開発手法による検証':'## 2. Dev Method Verification',
methods.map(m=>'### '+m+'\n- '+(G?'実施タイミング: 全Sprint':'Timing: All sprints')+'\n- '+(G?'検証項目: 仕様との整合性':'Verify: Spec alignment')).join('\n\n'),'',
G?'## 3. パフォーマンス基準':'## 3. Performance Benchmarks',
'- Lighthouse Score: 90+','- LCP: < 2.5s','- FID: < 100ms','- CLS: < 0.1','',
G?'## 4. セキュリティチェック':'## 4. Security Checklist',
'- [ ] '+(G?'OWASP Top 10対策確認':'OWASP Top 10 compliance'),
'- [ ] '+(G?'依存パッケージ脆弱性スキャン':'Dependency vulnerability scan'),
'- [ ] '+(G?'認証・認可テスト':'Auth/authorization tests')+' ('+auth.sot+')',
'- [ ] '+(G?'データバリデーション確認':'Data validation check'),
rlsTest,'',
// G4: Feature-specific verification checklist
G?'## 5. 機能別検証チェックリスト':'## 5. Feature Verification Checklist',
...features.flatMap(f=>{
const fd=getFeatureDetail(f);
if(!fd) return ['### '+f,'- [ ] '+(G?'実装完了':'Implementation done'),'- [ ] '+(G?'ユニットテスト通過':'Unit tests passing'),''];
const criteria=(G?fd.criteria_ja:fd.criteria_en).map(c=>c.replace(/\{auth\}/g,a.auth||'OAuth'));
return ['### '+f,...criteria.map(c=>'- [ ] '+c),''];
}),
].join('\n');
}
/* ── Pillar ② DevContainer (Phase B: BaaS-Aware) ── */
function genPillar2_DevContainer(a,pn){
const G=S.genLang==='ja';
const fe=a.frontend||'React';
const be=a.backend||'Node.js + Express';
const db=a.database||'PostgreSQL';
const orm=a.orm||'';
const isNode=be.includes('Node')||be.includes('Express')||be.includes('Fastify')||be.includes('Hono')||be.includes('NestJS');
const isPython=be.includes('Python')||be.includes('Django')||be.includes('FastAPI');
const isBaaS=/Supabase|Firebase|Convex/.test(be);
const isSupabase=be.includes('Supabase');
const isFirebase=be.includes('Firebase');
const baseImage=isNode||isBaaS?'mcr.microsoft.com/devcontainers/javascript-node:22':isPython?'mcr.microsoft.com/devcontainers/python:3.12':'mcr.microsoft.com/devcontainers/base:ubuntu';
// DB service: only for non-BaaS
const dbService=isBaaS?'':db.includes('Postgre')?'postgres':db.includes('Mongo')?'mongo':db.includes('MySQL')?'mysql':'';
// Extensions
const exts=['dbaeumer.vscode-eslint','esbenp.prettier-vscode','bradlc.vscode-tailwindcss'];
if(isSupabase) exts.push('supabase.supabase-vscode');
else if(isNode&&!isBaaS&&(orm.includes('Prisma')||!orm)) exts.push('prisma.prisma');
else if(isPython) exts.push('ms-python.python');
exts.push('github.copilot','github.copilot-chat');
// Forward ports
const ports=[3000];
if(isSupabase) ports.push(54321,54322,54323); // Supabase API + Auth + Studio
else if(isFirebase) ports.push(4000,9099); // Emulator UI + Auth
else if(dbService==='postgres') ports.push(5432);
else if(dbService==='mongo') ports.push(27017);
else if(isPython) ports.push(8000);
S.files['.devcontainer/devcontainer.json']=JSON.stringify({
name:pn+' Dev Environment',
dockerComposeFile:'docker-compose.yml',
service:'app',
workspaceFolder:'/workspace',
customizations:{vscode:{extensions:exts.filter(Boolean),settings:{'editor.formatOnSave':true,'editor.defaultFormatter':'esbenp.prettier-vscode'}}},
forwardPorts:ports,
postCreateCommand:'bash .devcontainer/post-create.sh',
features:{'ghcr.io/devcontainers/features/docker-in-docker:2':{}}
},null,2);
// Dockerfile
let dockerLines=['FROM '+baseImage];
if(isNode||isBaaS) dockerLines.push('RUN npm install -g pnpm@latest');
else if(isPython) dockerLines.push('RUN pip install --upgrade pip');
if(isSupabase) dockerLines.push('RUN npm install -g supabase@latest');
if(isFirebase) dockerLines.push('RUN npm install -g firebase-tools@latest');
dockerLines.push('WORKDIR /workspace');
if(isNode||isBaaS){dockerLines.push('COPY package*.json ./','RUN npm install');}
else if(isPython){dockerLines.push('COPY requirements.txt ./','RUN pip install -r requirements.txt');}
dockerLines.push('COPY . .');
S.files['.devcontainer/Dockerfile']=dockerLines.join('\n')+'\n';
// Docker Compose
let compose='version: \'3.8\'\nservices:\n app:\n build:\n context: ..\n dockerfile: .devcontainer/Dockerfile\n volumes:\n - ..:/workspace:cached\n command: sleep infinity\n ports:\n - "3000:3000"\n';
if(isSupabase) compose+=' - "54321:54321"\n - "54322:54322"\n - "54323:54323"\n';
else if(isFirebase) compose+=' - "4000:4000"\n - "9099:9099"\n';
// DB service only for non-BaaS
if(dbService==='postgres') compose+=' db:\n image: postgres:16\n environment:\n POSTGRES_USER: dev\n POSTGRES_PASSWORD: devpass\n POSTGRES_DB: '+pn.toLowerCase().replace(/[^a-z0-9]/g,'_')+'\n ports:\n - "5432:5432"\n volumes:\n - pgdata:/var/lib/postgresql/data\nvolumes:\n pgdata:\n';
else if(dbService==='mongo') compose+=' db:\n image: mongo:7\n ports:\n - "27017:27017"\n volumes:\n - mongodata:/data/db\nvolumes:\n mongodata:\n';
else if(dbService==='mysql') compose+=' db:\n image: mysql:8\n environment:\n MYSQL_ROOT_PASSWORD: devpass\n MYSQL_DATABASE: '+pn.toLowerCase().replace(/[^a-z0-9]/g,'_')+'\n ports:\n - "3306:3306"\n volumes:\n - mysqldata:/var/lib/mysql\nvolumes:\n mysqldata:\n';
S.files['.devcontainer/docker-compose.yml']=compose;
// Post-create script
const postLines=['#!/bin/bash','echo "🚀 Setting up '+pn+'..."'];
if(isNode||isBaaS) postLines.push('npm install');
else if(isPython) postLines.push('pip install -r requirements.txt');
if(isSupabase){
postLines.push('','# Supabase local development','npx supabase init --force 2>/dev/null || true','npx supabase start','echo "📦 Supabase Studio: http://localhost:54323"');
} else if(isFirebase){
postLines.push('','# Firebase emulators','firebase init emulators --non-interactive 2>/dev/null || true','echo "📦 Start emulators with: firebase emulators:start"');
} else if(isNode&&dbService==='postgres'){
if(orm.includes('Drizzle')){
postLines.push('npx drizzle-kit push','echo "📦 Drizzle Studio: npx drizzle-kit studio"');
} else {
postLines.push('npx prisma generate','npx prisma db push');
}
}
postLines.push('','echo "✅ Setup complete! Run \'npm run dev\' to start."');
S.files['.devcontainer/post-create.sh']=postLines.join('\n')+'\n';
// .env.example — framework-aware prefix
const envPrefix=fe.includes('Next')?'NEXT_PUBLIC_':fe.includes('Vite')||fe.includes('SPA')?'VITE_':'REACT_APP_';
const envLines=['# Environment Variables','# Copy to .env.local and fill in values',''];
if(isSupabase){
envLines.push('# Supabase',envPrefix+'SUPABASE_URL=http://localhost:54321',envPrefix+'SUPABASE_ANON_KEY=your-anon-key','SUPABASE_SERVICE_ROLE_KEY=your-service-role-key');
} else if(isFirebase){
envLines.push('# Firebase',envPrefix+'FIREBASE_API_KEY=',envPrefix+'FIREBASE_AUTH_DOMAIN=',envPrefix+'FIREBASE_PROJECT_ID=');
} else if(dbService==='postgres'){
envLines.push('# Database','DATABASE_URL=postgresql://dev:devpass@localhost:5432/'+pn.toLowerCase().replace(/[^a-z0-9]/g,'_'));
}
envLines.push('','# Auth','AUTH_SECRET=your-secret-here','');
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
if(hasPay&&a.payment.includes('Stripe')){
envLines.push('# Stripe','STRIPE_SECRET_KEY=sk_test_xxx','STRIPE_WEBHOOK_SECRET=whsec_xxx',envPrefix+'STRIPE_PUBLISHABLE_KEY=pk_test_xxx','');
}
envLines.push('# Security','ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com','RATE_LIMIT_MAX=100','RATE_LIMIT_WINDOW_MS=60000','');
S.files['.env.example']=envLines.join('\n');
}
/* ── Pillar ③ MCP (Phase B: Context-Aware) ── */
function genPillar3_MCP(a,pn){
const G=S.genLang==='ja';
const tools=(a.ai_tools||'Cursor').split(', ');
const auth=resolveAuth(a);
const arch=resolveArch(a);
const archLabel=G?{baas:'BaaS統合型',bff:'BFF(API Routes)',split:'FE/BE分離',traditional:'従来型'}[arch.pattern]:{baas:'BaaS Integration',bff:'BFF (API Routes)',split:'FE/BE Split',traditional:'Traditional'}[arch.pattern];
const er=inferER(a);
const domain=detectDomain(a.purpose)||'general';
const be=a.backend||'Node.js + Express';
const fe=a.frontend||'React + Next.js';
// Enhanced Project Context with auth details, domain context, dev methods
S.files['.mcp/project-context.md']=`# ${pn} — MCP Project Context
## Project Overview
- **Name**: ${pn}
- **Purpose**: ${a.purpose||'N/A'}
- **Domain**: ${domain}
- **Stack**: ${fe} + ${be} + ${a.database||'PostgreSQL'}
- **Architecture**: ${archLabel}
- **Deploy**: ${a.deploy||'Vercel'}${arch.pattern==='split'?' (FE) + Railway/Render (BE)':''}
${!isNone(a.mobile)?'- **Mobile**: '+a.mobile+'\n':''}${!isNone(a.payment)?'- **Payment**: '+a.payment+'\n':''}
## Authentication Details
- **Auth SoT**: ${auth.sot}
- **Token Type**: ${auth.tokenType}
- **Verification**: ${auth.tokenVerify}
- **Social Providers**: ${auth.social.join(', ')||'None'}
## Key Entities
${a.data_entities||'users, items'}
${er.relationships.length?'\n## Relationships\n'+er.relationships.join('\n'):''}
## Dev Methods
${a.dev_methods||'TDD, BDD'}
## AI Tools
${tools.join(', ')}
## Domain Context
${G?'このプロジェクトは':'This project is in the'} **${domain}** ${G?'ドメインです。以下の点に注意してください:':'domain. Focus on:'}
${_domainFocus(domain,G)}
## Generated File Structure
- \`.spec/\` — ${G?'仕様書5種':'5 spec docs'}
- \`.devcontainer/\` — ${G?'開発環境4種':'4 dev env files'}
- \`.mcp/\` — ${G?'MCP設定':'MCP config'}
- \`docs/\` — ${G?'31ドキュメント':'31 docs'}
- AI rules — CLAUDE.md, AI_BRIEF.md, .cursorrules, AGENTS.md, skills/
- CI/CD — .github/workflows/ci.yml
`;
// Backend-specific MCP server selection
const mcpServers={
filesystem:{command:'npx',args:['-y','@modelcontextprotocol/server-filesystem','/workspace']},
context7:{command:'npx',args:['-y','@anthropic/mcp-context7']},
playwright:{command:'npx',args:['-y','@anthropic/mcp-playwright']},
};
// Add backend-specific servers
if(be.includes('Supabase')){
mcpServers.supabase={command:'npx',args:['-y','@modelcontextprotocol/server-supabase']};
}
if(be.includes('Firebase')){
mcpServers.firebase={command:'npx',args:['-y','firebase-mcp-server']};
}
if(be.includes('Express')&&(a.database||'').includes('PostgreSQL')){
mcpServers.postgres={command:'npx',args:['-y','@modelcontextprotocol/server-postgres']};
}
if(be.includes('Express')&&(a.database||'').includes('MongoDB')){
mcpServers.mongodb={command:'npx',args:['-y','mongodb-mcp-server']};
}
if((a.dev_methods||'').includes('Docker')){
mcpServers.docker={command:'docker',args:['run','-i','--rm','mcp/docker']};
}
// Domain-specific tool recommendations
const domainTools=_domainTools(domain,G);
S.files['.mcp/tools-manifest.json']=JSON.stringify({
schema:'1.0',
project:pn,
mcpServers:mcpServers,
recommendations:{
core:G?['context7 — 最新ドキュメント参照','playwright — E2Eテスト自動化','filesystem — ファイル操作']:['context7 — Latest docs reference','playwright — E2E test automation','filesystem — File operations'],
backend:be.includes('Supabase')?[G?'supabase — DB操作・認証・ストレージ':'supabase — DB ops, auth, storage']:be.includes('Firebase')?[G?'firebase — Firestore・Auth・Functions':'firebase — Firestore, Auth, Functions']:be.includes('PostgreSQL')?[G?'postgres — SQL実行・マイグレーション':'postgres — SQL execution, migrations']:[],
domain:domainTools
},
categories:{
dev:['filesystem','context7',be.includes('Supabase')?'supabase':be.includes('Firebase')?'firebase':be.includes('PostgreSQL')?'postgres':null].filter(Boolean),
test:['playwright'],
deploy:[(a.dev_methods||'').includes('Docker')?'docker':null].filter(Boolean)
}
},null,2);
S.files['mcp-config.json']=JSON.stringify({
mcpServers:mcpServers,
environment:{
SUPABASE_URL:be.includes('Supabase')?'${SUPABASE_URL}':'',
SUPABASE_ANON_KEY:be.includes('Supabase')?'${SUPABASE_ANON_KEY}':'',
FIREBASE_PROJECT_ID:be.includes('Firebase')?'${FIREBASE_PROJECT_ID}':'',
DATABASE_URL:(a.database||'').includes('PostgreSQL')?'${DATABASE_URL}':'',
MONGODB_URI:(a.database||'').includes('MongoDB')?'${MONGODB_URI}':''
}
},null,2);
// New: .mcp/README.md with installation & usage guide
S.files['.mcp/README.md']=`# MCP Configuration for ${pn}
## Overview
This directory contains **Model Context Protocol (MCP)** configuration for ${pn}.
MCP enables AI coding assistants (Claude Code, Cursor, Windsurf, etc.) to access project-specific context, databases, and tools.
## Installed MCP Servers
${Object.keys(mcpServers).map(k=>'- **'+k+'**: '+(G?_mcpDesc(k,'ja'):_mcpDesc(k,'en'))).join('\n')}
## Installation
### 1. Prerequisites
- Node.js 18+ (for npx servers)
${(a.dev_methods||'').includes('Docker')?'- Docker (for docker MCP server)\n':''}
### 2. Configure AI Tool
${G?'AI ツールの設定ファイルに `mcp-config.json` を追加してください:':'Add `mcp-config.json` to your AI tool config:'}
**Claude Code:**
\`\`\`bash
cp mcp-config.json ~/.config/claude/mcp-config.json
\`\`\`
**Cursor:**
\`\`\`bash
# Cursor settings → MCP → Import mcp-config.json
\`\`\`
### 3. Set Environment Variables
\`\`\`bash
${be.includes('Supabase')?'export SUPABASE_URL="https://xxx.supabase.co"\nexport SUPABASE_ANON_KEY="eyJ..."\n':''}${be.includes('Firebase')?'export FIREBASE_PROJECT_ID="your-project-id"\n':''}\${(a.database||'').includes('PostgreSQL')?'export DATABASE_URL="postgresql://..."\n':''}${(a.database||'').includes('MongoDB')?'export MONGODB_URI="mongodb://..."\n':''}
\`\`\`
## Usage Examples
${be.includes('Supabase')?`### Supabase MCP
\`\`\`
${G?'「Userテーブルの全レコードを取得して」':'Get all records from User table'}
${G?'「新しいPostを作成して」':'Create a new Post'}
${G?'「認証ユーザーのプロフィールを表示して」':'Show authenticated user profile'}
\`\`\`
`:''}${be.includes('Firebase')?`### Firebase MCP
\`\`\`
${G?'「usersコレクションを取得して」':'Fetch users collection'}
${G?'「Firebase Authで新規ユーザー作成」':'Create new user with Firebase Auth'}
\`\`\`
`:''}
### Context7 MCP
\`\`\`
${G?'「Next.jsの最新ドキュメントを参照して」':'Reference latest Next.js docs'}
${G?'「Reactの公式ガイドを検索して」':'Search React official guide'}
\`\`\`
### Playwright MCP
\`\`\`
${G?'「ログインフローのE2Eテストを書いて」':'Write E2E test for login flow'}
${G?'「商品購入のテストシナリオを実行して」':'Run test scenario for product purchase'}
\`\`\`
## Troubleshooting
### MCP Server Not Found
\`\`\`bash
# Verify npx can access servers
npx -y @modelcontextprotocol/server-filesystem --version
\`\`\`
### Permission Denied
\`\`\`bash
# Check file permissions
chmod +x /workspace
\`\`\`
### Connection Errors
${G?'- 環境変数が正しく設定されているか確認してください\n- ネットワーク接続を確認してください':'- Verify environment variables are set correctly\n- Check network connectivity'}
## Resources
- [MCP Documentation](https://modelcontextprotocol.io/)
- [Available MCP Servers](https://github.com/modelcontextprotocol/servers)
`;
}
// Helper: Domain-specific focus points
function _domainFocus(domain,G){
const focuses={
education:G?'- 学習進捗の正確な管理\n- WCAG準拠のアクセシビリティ\n- データ保護(FERPA/GDPR)':'- Accurate learning progress tracking\n- WCAG accessibility compliance\n- Data protection (FERPA/GDPR)',
ec:G?'- 在庫同期・競合制御\n- 決済フローの完全性\n- スパイクトラフィック対策':'- Inventory sync & concurrency control\n- Payment flow integrity\n- Spike traffic handling',
marketplace:G?'- 二者間決済・エスクロー\n- レビュー・評価システム\n- メッセージング機能':'- Two-sided payments & escrow\n- Review & rating system\n- Messaging feature',
community:G?'- 投稿フィルタリング\n- 通報・モデレーション\n- スパム対策':'- Content filtering\n- Reporting & moderation\n- Spam prevention',
booking:G?'- 同時予約競合\n- キャンセル・変更処理\n- タイムゾーン処理':'- Concurrent booking conflicts\n- Cancellation/modification handling\n- Timezone handling',
saas:G?'- マルチテナント分離(RLS)\n- プラン別機能制限\n- サブスク管理':'- Multi-tenant isolation (RLS)\n- Plan-based feature restrictions\n- Subscription management',
fintech:G?'- トランザクション完全性(ACID)\n- 二重処理防止\n- PCI DSS準拠':'- Transaction integrity (ACID)\n- Double-processing prevention\n- PCI DSS compliance',
iot:G?'- デバイス認証・認可\n- オフライン動作\n- ファームウェア更新':'- Device authentication & authorization\n- Offline operation\n- Firmware updates',
realestate:G?'- 契約・更新管理\n- 修繕リクエスト追跡\n- 収支レポート':'- Contract & renewal management\n- Repair request tracking\n- Financial reports',
legal:G?'- 電子署名連携\n- バージョン管理\n- 承認ワークフロー':'- E-signature integration\n- Version control\n- Approval workflow',
hr:G?'- 応募者トラッキング\n- 面接スケジュール\n- 評価・スコアカード':'- Applicant tracking\n- Interview scheduling\n- Evaluation scorecards',
health:G?'- HIPAA準拠\n- カルテ管理\n- 予約・処方箋':'- HIPAA compliance\n- Medical records management\n- Appointments & prescriptions',
content:G?'- 全文検索\n- バージョン履歴\n- アクセス権限':'- Full-text search\n- Version history\n- Access control',
analytics:G?'- KPI集計\n- グラフ表示\n- リアルタイム更新':'- KPI aggregation\n- Chart display\n- Real-time updates',
portfolio:G?'- SEO最適化\n- レスポンシブデザイン\n- お問い合わせフォーム':'- SEO optimization\n- Responsive design\n- Contact form',
tool:G?'- APIキー管理\n- 使用量モニタリング\n- レート制限':'- API key management\n- Usage monitoring\n- Rate limiting'
};
return focuses[domain]||'';
}
// Helper: Domain-specific MCP tool recommendations
function _domainTools(domain,G){
const tools={
education:G?['context7 — 教育系APIドキュメント参照']:['context7 — Education API docs'],
ec:G?['playwright — 購入フローE2Eテスト']:['playwright — Purchase flow E2E tests'],
saas:G?['postgres/supabase — RLS設定・マルチテナント']:['postgres/supabase — RLS config, multi-tenant'],
fintech:G?['postgres — トランザクションテスト']:['postgres — Transaction testing'],
iot:G?['docker — デバイスシミュレーション']:['docker — Device simulation'],
health:G?['playwright — HIPAA準拠テスト']:['playwright — HIPAA compliance tests'],
ai:G?['context7 — AI APIドキュメント']:['context7 — AI API docs'],
automation:G?['playwright — ワークフロー自動テスト']:['playwright — Workflow automation tests'],
event:G?['postgres — イベント集計']:['postgres — Event aggregation'],
gamify:G?['postgres — ポイント・ランキング計算']:['postgres — Point & ranking calculation'],
collab:G?['docker — リアルタイム同期テスト']:['docker — Real-time sync tests'],
devtool:G?['postgres — Webhook配信ログ']:['postgres — Webhook delivery logs'],
creator:G?['stripe — サブスク決済テスト']:['stripe — Subscription payment tests'],
newsletter:G?['postgres — 配信統計分析']:['postgres — Send analytics']
};
return tools[domain]||[];
}
// Helper: MCP server descriptions
function _mcpDesc(name,lang){
const descs={
filesystem:{ja:'ファイル読み書き・検索',en:'File read/write & search'},
context7:{ja:'最新ドキュメント参照',en:'Latest docs reference'},
playwright:{ja:'E2Eテスト自動化',en:'E2E test automation'},
supabase:{ja:'Supabase DB操作・認証',en:'Supabase DB ops & auth'},
firebase:{ja:'Firebase Firestore・Auth',en:'Firebase Firestore & Auth'},
postgres:{ja:'PostgreSQL SQL実行',en:'PostgreSQL SQL execution'},
mongodb:{ja:'MongoDB クエリ実行',en:'MongoDB query execution'},
docker:{ja:'Dockerコンテナ操作',en:'Docker container operations'}
};
return (descs[name]||{})[lang]||name;
}
/* ── Pillar ④ AI Agent Rules (Phase B: Context-Aware, 11 files) ── */
function genPillar4_AIRules(a,pn){
const G=S.genLang==='ja';
const db=a.database||'PostgreSQL';
const be=a.backend||'Node.js + Express';
const auth=resolveAuth(a);
const arch=resolveArch(a);
const orm=arch.isBaaS?(be.includes('Supabase')?'Supabase Client SDK':be.includes('Firebase')?'Firebase SDK':'Convex Client'):(a.orm&&a.orm.includes('Drizzle')?'Drizzle ORM':'Prisma ORM');
const archNote=G?{baas:'BaaS統合パターン（サーバーレス）',bff:'BFF パターン（Next.js API Routes統合）',split:'フロント/バック分離（別ホスト）',traditional:'従来型クライアント-サーバー'}[arch.pattern]:{baas:'BaaS Integration (serverless)',bff:'BFF Pattern (Next.js API Routes)',split:'FE/BE Split (separate hosts)',traditional:'Traditional Client-Server'}[arch.pattern];
const core=`Project: ${pn}
Stack: ${a.frontend||'React'} + ${be} + ${db}
Architecture: ${archNote}
Auth SoT: ${auth.sot}
Methods: ${a.dev_methods||'TDD'}
Entities: ${a.data_entities||'users'}
Purpose: ${a.purpose||'N/A'}`;
const coreRules=`1. Always use TypeScript with strict mode
2. Follow ${(a.dev_methods||'TDD').split(', ')[0]} methodology
3. Write tests before implementation
4. Use ${a.frontend||'React'} conventions
5. Database: ${db} with ${orm}
6. Auth: ${auth.sot} — token type: ${auth.tokenType}
7. Architecture: ${archNote}
8. Follow project structure in .spec/technical-plan.md`;
const forbidden=arch.isBaaS?
`- No raw SQL in application code (use ${orm} methods)
- OK: DDL/RLS/migration SQL in supabase/migrations/
- No separate Express/Fastify server (use ${be} functions)
- No manual JWT handling (use ${auth.sot})`:
arch.pattern==='bff'?
`- No separate Express server (use Next.js API Routes)
- No \`any\` types
- No console.log in production
- No hardcoded secrets`:
`- No \`any\` types
- No console.log in production
- No hardcoded secrets
- No raw SQL in application code (use ${orm})
- OK: DDL/migration SQL in migration files`;
// Cursor-specific rules
const cursorRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}
## Cursor-Specific
- Use @workspace to reference project context
- Use @file to reference spec files (.spec/, docs/)
- Leverage multi-file editing for related changes
- Before editing, read relevant specs with @file`;
// Cline-specific rules
const clineRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}
## Cline-Specific
- Follow Plan→Act loop for each task
- After task completion: run npm test
- Update docs/24_progress.md after completing tasks
- Log errors to docs/25_error_logs.md`;
// Windsurf-specific rules
const windsurfRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}
## Windsurf-Specific
- Leverage Cascade for context-aware coding
- Create Flows for repetitive tasks
- Keep context focused: AI_BRIEF.md + current task only
- Use Flows to automate test generation`;
// Copilot (generic rules only)
const copilotRules=`You are an AI assistant for "${pn}".
${core}
## Rules
${coreRules}`;
S.files['.cursor/rules']=cursorRules;
S.files['.github/copilot-instructions.md']=`# GitHub Copilot Instructions\n${copilotRules}`;
S.files['.windsurfrules']=windsurfRules;
S.files['.clinerules']=clineRules;
S.files['.kiro/spec.md']=`# Kiro Spec\n${core}\n\n## Spec Files\nSee .spec/ directory for full specifications.`;
// Generate domain context rotation table
const domain=detectDomain(a.purpose)||'_default';
const pb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
let domainCtx='';
if(pb&&pb.ctx_ja&&pb.ctx_ja.length>0&&pb.ctx_ja[0]!==''){
domainCtx='\n\n## Domain Context Rotation\n| '+(G?'タスク種別':'Task Type')+' | '+(G?'参照ドキュメント':'Reference Docs')+' |\n|------|------|\n';
const ctx=G?pb.ctx_ja:pb.ctx_en;
ctx.forEach(c=>{
const[task,docs]=c.split('→');
domainCtx+='| '+task+' | '+docs+' |\n';
});
}
// ═══ A1: File Selection Matrix (Task-specific context loading) ═══
const fileSelectionMatrix=G?
'| タスク種別 | 推奨読込ファイル | 推定トークン |\n|---------|---------------|----------|\n| 🆕 新規機能 | AI_BRIEF.md + .spec/specification.md + docs/04_er_diagram.md | ~6K |\n| 🐛 バグ修正 | AI_BRIEF.md + docs/25_error_logs.md + 該当ソースファイル | ~4K |\n| 📝 設計レビュー | .spec/constitution.md + .spec/specification.md + docs/32_qa_blueprint.md | ~7K |\n| 🔒 セキュリティ | docs/08_security.md + docs/25_error_logs.md + .spec/verification.md | ~5K |\n| 🧪 テスト作成 | docs/07_test_cases.md + docs/33_test_matrix.md + 対象コード | ~6K |\n| 📚 ドキュメント | AI_BRIEF.md + 該当実装 + .spec/specification.md | ~5K |\n| 🚀 デプロイ | docs/09_release.md + .github/workflows/ci.yml + .devcontainer/ | ~3K |\n| 🎯 計画・マイルストーン | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| 🔍 調査タスク | AI_BRIEF.md のみ（詳細はサブエージェントに委譲） | ~3K |\n| 📋 戦略・コンプライアンス | docs/48_industry_blueprint.md + docs/50_stakeholder_strategy.md | ~5K |':
'| Task Type | Recommended Files | Est. Tokens |\n|-----------|------------------|-------------|\n| 🆕 New Feature | AI_BRIEF.md + .spec/specification.md + docs/04_er_diagram.md | ~6K |\n| 🐛 Bug Fix | AI_BRIEF.md + docs/25_error_logs.md + relevant source | ~4K |\n| 📝 Design Review | .spec/constitution.md + .spec/specification.md + docs/32_qa_blueprint.md | ~7K |\n| 🔒 Security | docs/08_security.md + docs/25_error_logs.md + .spec/verification.md | ~5K |\n| 🧪 Test Writing | docs/07_test_cases.md + docs/33_test_matrix.md + target code | ~6K |\n| 📚 Documentation | AI_BRIEF.md + implementation + .spec/specification.md | ~5K |\n| 🚀 Deployment | docs/09_release.md + .github/workflows/ci.yml + .devcontainer/ | ~3K |\n| 🎯 Planning / Milestones | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| 🔍 Research | AI_BRIEF.md only (delegate details to sub-agents) | ~3K |\n| 📋 Strategic / Compliance | docs/48_industry_blueprint.md + docs/50_stakeholder_strategy.md | ~5K |';
const compressionProtocol=G?
'\n## Context Compression Protocol\n\n**トリガー**: コンテキスト使用率 ≥80% 時\n\n**圧縮手順**:\n1. **要約モードに切替**: 全ドキュメントを AI_BRIEF.md のみに置換\n2. **タスク特化**: 現在のタスクに直接関係するファイルのみ保持\n3. **サブエージェント委譲**: 調査タスクはサブエージェントに委譲し、結論(要約)のみ受取\n4. **履歴圧縮**: 過去の会話履歴を要約して保存\n\n**圧縮例**:\n- Before: AI_BRIEF.md (3K) + ER (2K) + API (2K) + Screen (2K) + Tasks (1K) = 10K\n- After: AI_BRIEF.md (3K) + 現在タスクの該当セクション (1K) = 4K\n':
'\n## Context Compression Protocol\n\n**Trigger**: Context usage ≥80%\n\n**Compression steps**:\n1. **Switch to summary mode**: Replace all docs with AI_BRIEF.md only\n2. **Task-specific**: Keep only files directly related to current task\n3. **Sub-agent delegation**: Delegate research tasks to sub-agents, receive summary only\n4. **History compression**: Summarize and save past conversation history\n\n**Compression example**:\n- Before: AI_BRIEF.md (3K) + ER (2K) + API (2K) + Screen (2K) + Tasks (1K) = 10K\n- After: AI_BRIEF.md (3K) + relevant section for current task (1K) = 4K\n';
const subAgentPattern=G?
'\n## Sub-agent Delegation Pattern\n\n**原則**: メインエージェントのコンテキストを調査結果で汚染しない\n\n**委譲すべきタスク**:\n- 📊 技術調査（ライブラリ比較、ベストプラクティス検索）\n- 🔍 コードベース探索（特定機能の実装箇所特定）\n- 📖 ドキュメント要約（長大なドキュメントの要点抽出）\n- 🧪 テストケース生成（網羅的なテストパターン列挙）\n\n**Summary-Only Import**:\n- ❌ サブエージェントの全出力をコンテキストに含めない\n- ✅ サブエージェントは結論・推奨事項・次のアクションのみ返す\n- 📏 要約サイズ目標: 元の10-20%（例: 5K → 500-1000トークン）\n\n**実行フォーマット**:\n```\nTask: [サブエージェントに委譲するタスク]\nContext: AI_BRIEF.md\nOutput format: 結論(3行) + 推奨事項(箇条書き3つ) + 次のアクション\n```\n':
'\n## Sub-agent Delegation Pattern\n\n**Principle**: Don\'t pollute main agent context with research results\n\n**Tasks to delegate**:\n- 📊 Technical research (library comparison, best practice search)\n- 🔍 Codebase exploration (locate implementation of specific features)\n- 📖 Document summarization (extract key points from long docs)\n- 🧪 Test case generation (enumerate comprehensive test patterns)\n\n**Summary-Only Import**:\n- ❌ Don\'t include full sub-agent output in context\n- ✅ Sub-agent returns conclusion, recommendations, next action only\n- 📏 Summary size target: 10-20% of original (e.g., 5K → 500-1000 tokens)\n\n**Execution format**:\n```\nTask: [Task to delegate to sub-agent]\nContext: AI_BRIEF.md\nOutput format: Conclusion (3 lines) + Recommendations (3 bullets) + Next action\n```\n';
// detectIndustry() は p13 で function宣言（ホイスティングで利用可能）
// INDUSTRY_INTEL は p13 の const（ランタイム時にはアクセス可能）
const _ind=typeof detectIndustry==='function'?detectIndustry(a.purpose):null;
const _ii=_ind&&typeof INDUSTRY_INTEL!=='undefined'?INDUSTRY_INTEL[_ind]:null;
const domainRisksMd=_ii?(G?
'\n## コンプライアンス & ドメインリスク\n\n### 規制要件\n'+_ii.reg_ja.map(r=>'- '+r).join('\n')+'\n\n### 主要失敗要因\n'+_ii.fail_ja.map(f=>'- ⚠️ '+f).join('\n')+'\n':
'\n## Compliance & Domain Risks\n\n### Regulatory Requirements\n'+_ii.reg_en.map(r=>'- '+r).join('\n')+'\n\n### Key Failure Factors\n'+_ii.fail_en.map(f=>'- ⚠️ '+f).join('\n')+'\n'
):'';
S.files['CLAUDE.md']=`# CLAUDE.md — ${pn}\n${core}\n\n## Spec-Driven Development\nRead .spec/constitution.md first.\nAll changes must align with .spec/specification.md.\nUse .spec/tasks.md as the source of truth for work items.\n\n## Auth\n- Source of Truth: ${auth.sot}\n- Token: ${auth.tokenType}\n- Verification: ${auth.tokenVerify}\n${auth.social.length?'- Providers: '+auth.social.join(', '):''}\n\n## Code Style\n- TypeScript strict\n- ESLint + Prettier\n- Vitest for testing\n- ${orm} for ${db}\n\n## Forbidden\n${forbidden}${domainRisksMd}\n\n## Design System Reference\nMUST reference \`docs/26_design_system.md\` before implementing any UI.\n- Colors, spacing, typography: Use only predefined tokens\n- Components: Follow framework mapping table\n- AI Design Protocol: Do not violate prohibited actions\n\n## Workflow Cycle\n1. Read docs/ → Select needed context\n2. Plan → Outline approach before coding\n3. Implement → Code with tests\n4. Update docs/24_progress.md → Mark completed tasks\n5. Log errors to docs/25_error_logs.md → Prevent recurrence\n\n## Thinking Protocol\nBefore implementing any change:\n1. State the task in one sentence\n2. List files that will be modified\n3. Identify potential side effects\n4. Implement → Test → Verify\n\n## Context Management\n- Write: All specs live in docs/ — read before coding\n- Select: Only load files relevant to current task\n- Compress: If context is large, read AI_BRIEF.md (~3K tokens) instead\n- Isolate: Use subagents for research, keep main context clean${domainCtx}\n\n## File Selection Matrix\n${G?'**タスク種別別の推奨読込ファイル**':'**Task-specific recommended files**'}\n\n${fileSelectionMatrix}${compressionProtocol}${subAgentPattern}\n\n## Key Context Files\n| File | When to Read | Tokens |\n|------|-------------|--------|\n| AI_BRIEF.md | Always (start here) | ~3K |\n| .spec/constitution.md | Before any change | ~1K |\n| .spec/tasks.md | Before picking work | ~1K |\n| docs/29_reverse_engineering.md | Before sprint planning | ~2K |\n| docs/24_progress.md | Before/after tasks | ~0.5K |\n| docs/25_error_logs.md | When debugging | ~0.5K |`;
// ═══ A3: AGENTS.md Sub-agent Coordination Enhancement ═══
const agentSpecMatrix=G?
'| エージェント | 専門領域 | 必要コンテキスト | トークン予算 |\n|----------|--------|-------------|----------|\n| Planner | 計画・マイルストーン | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| Frontend | UI/UX実装 | AI_BRIEF.md + docs/06_screen_design.md + docs/26_design_system.md | ~5K |\n| Backend | API/DB実装 | AI_BRIEF.md + docs/04_er_diagram.md + docs/05_api_design.md | ~6K |\n| Test | テスト作成 | AI_BRIEF.md + docs/07_test_cases.md + docs/33_test_matrix.md | ~6K |\n| QA | 品質検証 | docs/32_qa_blueprint.md + docs/37_bug_prevention.md | ~4K |\n| DevOps | デプロイ | docs/09_release_checklist.md + .devcontainer/ + .github/workflows/ | ~3K |\n| Research | 調査専門 | AI_BRIEF.md のみ（結論返却） | ~3K |':
'| Agent | Specialization | Required Context | Token Budget |\n|-------|---------------|------------------|-------------|\n| Planner | Planning & milestones | docs/29_reverse_engineering.md + docs/30_goal_decomposition.md + .spec/tasks.md | ~5K |\n| Frontend | UI/UX impl | AI_BRIEF.md + docs/06_screen_design.md + docs/26_design_system.md | ~5K |\n| Backend | API/DB impl | AI_BRIEF.md + docs/04_er_diagram.md + docs/05_api_design.md | ~6K |\n| Test | Test creation | AI_BRIEF.md + docs/07_test_cases.md + docs/33_test_matrix.md | ~6K |\n| QA | Quality assurance | docs/32_qa_blueprint.md + docs/37_bug_prevention.md | ~4K |\n| DevOps | Deployment | docs/09_release_checklist.md + .devcontainer/ + .github/workflows/ | ~3K |\n| Research | Investigation | AI_BRIEF.md only (return conclusion) | ~3K |';
const handoffProtocol=G?
'\n## Handoff Protocol（引継ぎフォーマット）\n\n**引継ぎ時に必ず含める情報**:\n```yaml\nfrom: [引継ぎ元エージェント名]\nto: [引継ぎ先エージェント名]\ntask: [タスク概要 1文]\ncontext: [必要最小限のコンテキスト]\ndeliverables:\n - [成果物1]\n - [成果物2]\nnext_action: [次のアクション]\nblocking_issues: [ブロッカーがあれば]\n```\n\n**Summary-Only Import原則**:\n- 調査エージェントは全文返却禁止\n- 結論(3行) + 推奨事項(3つ) + 次のアクションのみ\n- メインエージェントは要約のみコンテキストに追加\n':
'\n## Handoff Protocol\n\n**Required information in handoff**:\n```yaml\nfrom: [Source agent name]\nto: [Target agent name]\ntask: [Task summary in 1 sentence]\ncontext: [Minimal necessary context]\ndeliverables:\n - [Deliverable 1]\n - [Deliverable 2]\nnext_action: [Next action]\nblocking_issues: [If any blockers]\n```\n\n**Summary-Only Import Principle**:\n- Research agents MUST NOT return full text\n- Conclusion (3 lines) + Recommendations (3 bullets) + Next action only\n- Main agent adds summary only to context\n';
S.files['AGENTS.md']=`# AGENTS.md — ${pn}\n\n## Agent Guidelines\n${core}\n\n## Task Assignment\n- Frontend agent: UI components, pages, styling\n- Backend agent: ${arch.isBaaS?a.backend+' functions, RLS policies':arch.pattern==='bff'?'Next.js API Routes, middleware':'API routes, database, auth'}\n- Test agent: Unit tests, E2E tests\n- DevOps agent: CI/CD, deployment\n\n## Agent Specialization Matrix\n${G?'**エージェント種別と責任範囲**':'**Agent types and responsibilities**'}\n\n${agentSpecMatrix}${handoffProtocol}\n\n## Coordination\n- All agents must read .spec/ before starting\n- Use tasks.md for work coordination\n- Commit with conventional commits`;
S.files['codex-instructions.md']=`# Codex Instructions (OpenAI)\n${copilotRules}\n\n## Codex Agent Mode\n- Use agentic mode for multi-file refactoring\n- Verify changes with npm test before committing\n- Respect .spec/ constraints`;
S.files['skills/project.md']=`# ${pn} ${G?'— AIスキル':'— AI Skills'}\n${G?'工場テンプレート形式。詳細はskills/catalog.md参照':'Factory Template format. See skills/catalog.md for details'}\n\n${G?'## スキル':'## Skills'}\n\n### 1. spec-review\n- **${G?'役割':'Role'}**: ${G?'設計':'Design'}\n- **${G?'目的':'Purpose'}**: ${G?'.spec/検証':'Verify .spec/'}\n- **${G?'入力':'Input'}**: .spec/constitution.md, specification.md\n- **${G?'判断':'Judgment'}**: ${G?'矛盾0件':' 0 contradictions'}\n- **${G?'次':'Next'}**: code-gen\n\n### 2. code-gen\n- **${G?'役割':'Role'}**: ${G?'制作':'Production'}\n- **${G?'目的':'Purpose'}**: ${G?'コード生成':'Generate code'}\n- **${G?'入力':'Input'}**: .spec/technical-plan.md\n- **${G?'判断':'Judgment'}**: ${G?'エラー0':'0 errors'}\n- **${G?'次':'Next'}**: test-gen\n\n### 3. test-gen\n- **${G?'役割':'Role'}**: ${G?'制作':'Production'}\n- **${G?'目的':'Purpose'}**: ${G?'テスト生成':'Generate tests'}\n- **${G?'入力':'Input'}**: ${G?'新規コード':'New code'}\n- **${G?'判断':'Judgment'}**: ${G?'カバレッジ80%+':'Coverage ≥80%'}\n- **${G?'次':'Next'}**: deploy-check\n\n### 4. doc-gen\n- **${G?'役割':'Role'}**: ${G?'運用':'Operations'}\n- **${G?'目的':'Purpose'}**: ${G?'ドキュメント生成':'Generate docs'}\n- **${G?'判断':'Judgment'}**: ${G?'未文書化0':'0 undocumented'}\n- **${G?'次':'Next'}**: refactor\n\n### 5. refactor\n- **${G?'役割':'Role'}**: ${G?'設計':'Design'}\n- **${G?'目的':'Purpose'}**: ${G?'リファクタリング提案':'Suggest refactoring'}\n- **${G?'判断':'Judgment'}**: ${G?'重複10%↓':'Duplication ≤10%'}\n- **${G?'次':'Next'}**: spec-review\n\n${G?'## テンプレート':'## Template'}\n\`\`\`markdown\n### [skill-id]\n- **${G?'役割':'Role'}**: [Planning/Design/Production/Operations]\n- **${G?'目的':'Purpose'}**: [${G?'何をするか':'What it does'}]\n- **${G?'判断':'Judgment'}**: [${G?'成功条件':'Success criteria'}]\n- **${G?'次':'Next'}**: [${G?'次のスキル':'Next skill'}]\n\`\`\`\n`;
S.files['.gemini/settings.json']=`{\n "project": "${pn}",\n "model": "gemini-3-pro",\n "context": {\n "spec_dir": ".spec/",\n "include": ["src/", "package.json", "tsconfig.json"],\n "exclude": ["node_modules/", "dist/"]\n },\n "safety": "balanced",\n "tools": ["code_execution", "grounding"]\n}`;
S.files['.ai/hooks.yml']=`# AI Hooks Configuration
hooks:
pre-commit:
- name: lint-check
command: npm run lint
- name: type-check
command: npx tsc --noEmit
pre-push:
- name: test
command: npm test
post-generate:
- name: format
command: npx prettier --write .
`;
// ═══ AI_BRIEF.md — Condensed Single-File Spec for AI Agents ═══
// Goal: ~3000 tokens containing everything an AI needs to start coding
const entities=(a.data_entities||'User').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const features=(a.mvp_features||'CRUD').split(', ').filter(Boolean);
const screens=(a.screens||'Dashboard').split(', ').filter(Boolean);
const fe=a.frontend||'React';
const deploy=a.deploy||'Vercel';
// Build compact DB schema
const dbSchema=entities.map(en=>{
const cols=getEntityColumns(en,G,entities);
const colList=cols.map(c=>{
const fk=c.constraint.includes('FK')?` → ${c.constraint.match(/FK\((\w+)\)/)?.[1]||'?'}`:'';
const req=c.constraint.includes('NOT NULL')?'!':'';
return `${c.col}${req}:${c.type.replace('VARCHAR(255)','str').replace('VARCHAR(100)','str').replace('VARCHAR(50)','str').replace('VARCHAR(20)','enum').replace('DECIMAL(10,2)','decimal').replace('BOOLEAN','bool').replace('TIMESTAMP','ts').replace('BIGINT','bigint').replace('JSONB','json').replace('UUID','uuid').replace('TEXT','text').replace('DATE','date').replace('TIME','time').replace('INT','int')}${fk}`;
}).join(', ');
return ` ${en}: id:uuid(PK)${colList?', '+colList:''}, created_at:ts, updated_at:ts`;
}).join('\n');
// Build compact ER relationships
const erData=inferER(a);
const erCompact=erData.relationships.map(r=>r.replace(/\s+/g,' ')).join('; ');
// Build compact features with acceptance criteria
const featureCompact=features.map(f=>{
const fd=getFeatureDetail(f);
if(fd){
const criteria=(G?fd.criteria_ja:fd.criteria_en).map(c=>c.replace(/\{auth\}/g,a.auth||'OAuth'));
return ` ${f}: ${criteria.slice(0,4).join(' / ')}`;
}
return ` ${f}`;
}).join('\n');
// Build compact routes
const routes=genRoutes(a);
const routeCompact=routes.map(r=>`${r.auth?'🔒':'🌐'} ${r.path} → ${r.name}`).join(', ');
// Per-table RLS (compact)
let rlsCompact='';
if(arch.isBaaS&&be.includes('Supabase')){
rlsCompact=entities.map(en=>{
const cols=getEntityColumns(en,G,entities);
const ownerCol=en.toLowerCase()==='user'?'id':cols.find(c=>c.col==='user_id'||c.col==='owner_id'||c.col==='instructor_id'||c.col==='provider_id')?.col;
if(!ownerCol) return ` ${pluralize(en)}: authenticated=SELECT`;
return ` ${pluralize(en)}: auth.uid()=${ownerCol} → SELECT/INSERT/UPDATE/DELETE`;
}).join('\n');
}
// Stripe section (compact)
let stripeCompact='';
if(a.payment&&(a.payment||'').includes('Stripe')){
stripeCompact=`
## Payment (Stripe)
Plans: Free(¥0) / Pro(¥980/mo) / Enterprise(¥9,800/mo)
Webhook: POST /api/webhook/stripe
invoice.paid → subscription.status=active
customer.subscription.deleted → status=canceled
Tables: subscriptions(user_id, stripe_subscription_id, stripe_customer_id, status, plan, current_period_end)
Keys: STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY`;
}
// RBAC section (compact)
let rbacCompact='';
const hasAdminBrief=/管理者|admin/i.test(a.target||'');
if(hasAdminBrief){
rbacCompact=`
## RBAC
Roles: user(own data) / admin(all data, user mgmt)${/講師|instructor/i.test(a.target||'')?` / instructor(own content+students)`:''}
Column: profiles.role
Admin routes: /admin/ → role=admin check`;
}
const _trb=typeof TECH_RADAR_BASE!=='undefined'?TECH_RADAR_BASE:null;
const briefDomainRisk=_ii?(G?
'\n## ドメインリスク\n'+_ii.fail_ja.slice(0,3).map(f=>'- '+f).join('\n')+'\n':
'\n## Domain Risks\n'+_ii.fail_en.slice(0,3).map(f=>'- '+f).join('\n')+'\n'
):'';
// Tech Radar: 選択技術の分類を表示
const _feRadar=_trb?(['frontend','backend','infrastructure','ai'].map(cat=>{
const r=_trb[cat];if(!r)return '';
const all=[...r.adopt.map(t=>t+':Adopt'),...r.trial.map(t=>t+':Trial'),...r.assess.map(t=>t+':Assess'),...r.hold.map(t=>t+':Hold')];
// ユーザー選択技術とマッチ
const stack=[a.frontend,a.backend,a.database,a.deploy].filter(Boolean).join(' ');
return all.filter(e=>stack.includes(e.split(':')[0].split(' ')[0])).join(', ');
}).filter(Boolean).join(', ')):'';
const briefTechRadar=_feRadar?(G?'\nTech Radar: '+_feRadar+'\n':'\nTech Radar: '+_feRadar+'\n'):'';
S.files['AI_BRIEF.md']=`# ${pn} — AI Implementation Brief
> ${G?'このファイル1つで開発開始可能。':'Start coding with this single file.'} ~3K tokens.
## Stack
${fe} + ${be} + ${a.database||'PostgreSQL'} → ${deploy}
Auth: ${auth.sot} (${auth.tokenType})
ORM: ${orm}
Pattern: ${archNote}
## Context Protocol
1. Start: Read THIS file (AI_BRIEF.md)
2. Deep dive: .spec/{constitution,specification}.md
3. Current state: docs/24_progress.md
4. Before coding: Relevant docs/ file
5. After task: Update docs/24_progress.md
6. On error: Log to docs/25_error_logs.md
7. Context full: Keep AI_BRIEF.md + current task only
## Context Loading Strategy
**Phase-based file loading priority**:
${G?'- **Phase 0 企画**: .spec/constitution.md → .spec/specification.md + docs/29_reverse_engineering.md':'- **Phase 0 Planning**: .spec/constitution.md → .spec/specification.md + docs/29_reverse_engineering.md'}
${G?'- **Phase 1 設計**: + docs/04_er_diagram.md + docs/05_api_design.md + docs/30_goal_decomposition.md + docs/32_qa_blueprint.md':'- **Phase 1 Design**: + docs/04_er_diagram.md + docs/05_api_design.md + docs/30_goal_decomposition.md + docs/32_qa_blueprint.md'}
${G?'- **Phase 2 実装**: + AI_BRIEF.md (主要) + docs/24_progress.md + 該当ソース':'- **Phase 2 Implementation**: + AI_BRIEF.md (primary) + docs/24_progress.md + relevant source'}
${G?'- **Phase 3 テスト**: + docs/07_test_cases.md + docs/33_test_matrix.md + docs/36_test_strategy.md':'- **Phase 3 Testing**: + docs/07_test_cases.md + docs/33_test_matrix.md + docs/36_test_strategy.md'}
${G?'- **Phase 4 運用**: + docs/34_incident_response.md + docs/09_release_checklist.md + docs/25_error_logs.md':'- **Phase 4 Operations**: + docs/34_incident_response.md + docs/09_release_checklist.md + docs/25_error_logs.md'}
**Token budget allocation**:
${G?'- 🎯 現在タスク: 40% (4K)':'- 🎯 Current task: 40% (4K)'}
${G?'- 📋 Spec/設計: 30% (3K)':'- 📋 Spec/design: 30% (3K)'}
${G?'- 📊 進捗/履歴: 20% (2K)':'- 📊 Progress/history: 20% (2K)'}
${G?'- 🔄 予備バッファ: 10% (1K)':'- 🔄 Reserve buffer: 10% (1K)'}
**New files reference** (${G?'最新生成ファイル':'latest generated files'}):
- docs/29_reverse_engineering.md ${G?'— ゴール逆算プランニング':'— Goal-driven planning'}
- docs/30_goal_decomposition.md ${G?'— ゴール分解・ギャップ分析':'— Goal decomposition & gap analysis'}
- docs/34_incident_response.md ${G?'— 障害対応':'— Incident response'}
- docs/35_sitemap.md ${G?'— 情報設計':'— Information architecture'}
- docs/36_test_strategy.md ${G?'— フェーズ別テスト戦略':'— Phase-based testing'}
- docs/37_bug_prevention.md ${G?'— バグ予防':'— Bug prevention'}
- docs/38_business_model.md ${G?'— ビジネスモデル (payment≠none時)':'— Business model (if payment≠none)'}
- skills/agents/*.md ${G?'— エージェント定義 (ai_auto=multi/full時)':'— Agent definitions (if ai_auto=multi/full)'}
## DB Schema
\`\`\`
${dbSchema}
\`\`\`
## Relationships
${erCompact}
${rlsCompact?'\n## RLS Policies\n'+rlsCompact:''}
## Features (MVP)
${featureCompact}
## Routes
${routeCompact}
${stripeCompact}${rbacCompact}${briefDomainRisk}${briefTechRadar}
## Dev Rules
- TypeScript strict, Vitest, Playwright
- ${(a.dev_methods||'TDD').split(', ')[0]} methodology
- ${orm} for DB access
- ${auth.sot} for all auth
- Forbidden: ${arch.isBaaS?'raw SQL, Express server, manual JWT':'any types, console.log in prod, hardcoded secrets'}
## File Structure
.spec/ → ${G?'仕様書':'Specifications'} (constitution, specification, technical-plan, tasks, verification)
docs/ → ${G?'設計ドキュメント':'Design documents'} (ER, API, screen, test cases, security, etc.)
.devcontainer/ → ${G?'開発環境':'Dev environment'}
CLAUDE.md → ${G?'Claude Code用ルール':'Claude Code rules'}
.cursor/rules → ${G?'Cursor用ルール':'Cursor rules'}
## Quick Start
1. \`npm install\` → setup dependencies
2. Read this file → understand full spec
3. Create DB schema (see DB Schema above)
4. Implement features top-to-bottom (see Features)
5. Run \`npm test\` after each feature
`;
// ═══ Phase 2 & 3: Skills Catalog + Pipelines (only if ai_auto ≠ None) ═══
const aiAuto=a.ai_auto||'';
if(aiAuto&&!isNone(aiAuto)){
// Detect domain for domain-specific skills
const domain=detectDomain(a.purpose);
// Compressed: role:name_ja:name_en:purpose_ja:purpose_en:judgment_ja:judgment_en
const coreSkills=['0:ゴール逆算:Goal Reversal:KPI→機能→実装の逆算:KPI → Features → Impl:ギャップ0:0 gaps','0:要件レビュー:Req Review:要件検証:Verify reqs:欠落0:0 gaps','1:設計検証:Arch Review:技術評価:Eval tech:P0リスク0:0 P0 risks','2:実装支援:Code Support:実装支援:Impl support:エラー0:0 errors','3:デプロイ検証:Deploy Check:デプロイ前チェック:Pre-deploy check:全PASS:All PASS'];
const domainSkillsMap={
education:['1:教材設計:Curriculum:教材設計:Design curriculum:説明可能:Explainable','2:問題生成:Quiz Gen:問題生成:Gen quiz:各3問:3 each'],
ec:['1:商品検証:Catalog:商品検証:Verify catalog:必須100%:Req 100%','1:決済検証:Checkout:決済検証:Verify checkout:OWASP準拠:OWASP OK'],
saas:['0:機能仕様:Feature Spec:機能仕様:Feature spec:AC3+:≥3 AC','1:API設計:API Design:API設計:API design:違反0:0 violations'],
community:['1:モデレーション:Moderation:モデレーション:Moderation:違反1%↓:≤1% violations','3:分析:Analytics:行動分析:Behavior analysis:可視化:Visualized'],
booking:['0:予約設計:Booking Logic:予約設計:Booking logic:重複0:0 duplicates','2:リマインダー:Reminder:通知最適化:Optimize notify:到達95%+:≥95% delivery'],
health:['1:記録検証:Health Log:健康記録検証:Verify health logs:異常値0:0 anomalies','2:目標設定:Goal Setting:目標達成率計算:Calc goal achievement:達成率可視化:Visualized rate'],
marketplace:['0:取引設計:Trade Design:取引フロー設計:Design trade flow:安全性確保:Safety ensured','1:レビュー検証:Review Check:レビュー信頼性検証:Verify review trust:偽装0:0 fake'],
content:['2:配信最適化:Delivery Opt:コンテンツ配信最適化:Optimize content delivery:遅延100ms↓:≤100ms delay','3:分析:Analytics:閲覧分析:View analytics:エンゲージ可視化:Engagement vis'],
analytics:['1:ダッシュボード設計:Dashboard:ダッシュボード設計:Design dashboard:KPI明確:Clear KPI','2:レポート生成:Report Gen:レポート自動生成:Auto-gen reports:正確性100%:100% accuracy'],
business:['0:CRM設計:CRM Design:顧客管理設計:Design CRM:リード漏れ0:0 lead loss','1:営業フロー:Sales Flow:営業プロセス最適化:Optimize sales process:CVR向上:Improve CVR'],
iot:['1:デバイス管理:Device Mgmt:デバイス管理:Device management:全台接続:All connected','2:センサー分析:Sensor Analysis:センサーデータ分析:Analyze sensor data:異常検知:Anomaly detected','3:アラート設計:Alert Design:アラート設計:Design alerts:誤報1%↓:≤1% false alarm'],
realestate:['0:物件管理:Property Mgmt:物件データ管理:Manage property data:登録100%:100% listed','1:内見予約:Viewing:内見予約管理:Manage viewings:重複0:0 overlaps','2:契約検証:Contract:契約書検証:Verify contracts:必須項目100%:100% required'],
legal:['0:契約レビュー:Contract Review:契約書レビュー:Review contracts:リスク条項0:0 risk clauses','1:コンプライアンス:Compliance:法令準拠チェック:Compliance check:違反0:0 violations','3:文書管理:Doc Mgmt:文書バージョン管理:Doc version control:最新版追跡:Latest tracked'],
hr:['0:採用フロー:Hiring Flow:採用プロセス設計:Design hiring flow:漏れ0:0 gaps','1:評価設計:Eval Design:評価制度設計:Design evaluation:基準明確:Clear criteria','3:オンボーディング:Onboarding:入社手続き管理:Manage onboarding:完了率100%:100% completion'],
fintech:['1:取引検証:Tx Validation:取引データ検証:Validate transactions:不正0:0 fraud','1:リスク分析:Risk Analysis:リスク評価:Risk assessment:P0対応済:P0 addressed','3:レポート生成:Report Gen:財務レポート:Financial reports:正確性100%:100% accuracy'],
ai:['0:プロンプト設計:Prompt Design:プロンプト最適化:Optimize prompts:精度90%+:≥90% accuracy','1:RAG構築:RAG Setup:コンテキスト管理:Manage context:関連性95%+:≥95% relevance','2:モデル評価:Model Eval:応答品質評価:Eval response quality:幻覚1%↓:≤1% hallucination'],
automation:['0:ワークフロー設計:Workflow Design:自動化フロー設計:Design automation flow:漏れ0:0 gaps','1:条件分岐:Branching:条件分岐ロジック:Branching logic:網羅100%:100% coverage','2:エラーハンドリング:Error Handling:リトライ・フォールバック:Retry & fallback:復旧率98%+:≥98% recovery'],
event:['0:チケット設計:Ticket Design:チケット販売設計:Design ticket sales:在庫管理100%:100% inventory','1:参加者管理:Attendee Mgmt:参加者管理:Manage attendees:重複0:0 duplicates','2:通知最適化:Notify Opt:イベント通知最適化:Optimize event notifications:到達95%+:≥95% delivery'],
gamify:['0:ポイント設計:Point Design:ポイントシステム設計:Design point system:整合性100%:100% consistency','1:バッジ条件:Badge Logic:バッジ獲得条件:Badge unlock logic:漏れ0:0 gaps','2:ランキング:Leaderboard:ランキング計算:Calc leaderboard:精度100%:100% accuracy'],
collab:['0:同期設計:Sync Design:リアルタイム同期設計:Design realtime sync:遅延200ms↓:≤200ms latency','1:競合解決:Conflict Resolve:競合解決アルゴリズム:Conflict resolution:損失0:0 data loss','2:バージョン管理:Versioning:変更履歴管理:Manage change history:追跡100%:100% tracked'],
devtool:['0:API設計:API Design:開発者API設計:Design developer API:DX評価4.5+:≥4.5 DX','1:SDK構築:SDK Build:SDK・サンプル構築:Build SDK & samples:カバレッジ80%+:≥80% coverage','2:ドキュメント:Docs:ドキュメント生成:Generate docs:網羅性95%+:≥95% completeness'],
creator:['0:収益化設計:Monetization:収益化戦略設計:Design monetization:収益源3+:≥3 revenue streams','1:ファン管理:Fan Mgmt:ファンコミュニティ管理:Manage fan community:エンゲージ8%+:≥8% engagement','2:分析:Analytics:クリエイター分析:Creator analytics:インサイト可視化:Insights vis'],
newsletter:['0:コンテンツ戦略:Content Strategy:配信コンテンツ戦略:Delivery content strategy:開封率25%+:≥25% open rate','1:セグメント設計:Segment Design:セグメント配信設計:Design segment delivery:精度95%+:≥95% accuracy','2:A/Bテスト:A/B Test:A/Bテスト設計:Design A/B test:統計的有意性:Statistical significance']
};
const domainSkills=domainSkillsMap[domain]||[];
const allSkills=[...coreSkills,...domainSkills];
const roleNames=G?['企画 (Planning)','設計 (Design)','制作 (Production)','運用 (Operations)']:['Planning','Design','Production','Operations'];
// Enhanced skill details (19 skills: 14 core + 5 domain-specific)
const skillDetails={
'教材設計':{input:'docs/03,04',process:G?'ER図→学習フロー抽出→難易度分類→構成生成':'ER→flow→difficulty→curriculum',output:G?'構成マップ(md)':'Curriculum (md)'},
'機能仕様':{input:'.spec/constitution',process:G?'使命→ストーリー抽出→受入条件3つ→優先度付与':'Mission→stories→3 AC→priority',output:G?'仕様書(md)':'Spec (md)'},
'API設計':{input:'docs/04,05',process:G?'ER→エンドポイント生成→REST命名チェック→標準化':'ER→endpoints→REST check→standardize',output:G?'API仕様(OpenAPI)':'API spec (OpenAPI)'},
'決済検証':{input:'docs/08',process:G?'OWASP照合→Webhook検証→RLSチェック':'OWASP→webhook→RLS',output:G?'チェックリスト':'Checklist'},
'要件レビュー':{input:'.spec/constitution,specification',process:G?'使命→KPI照合→機能網羅チェック→欠落列挙':'Mission→KPI check→feature coverage→list gaps',output:G?'矛盾リスト+修正案':'Gap list + fix proposal'},
'設計検証':{input:'.spec/technical-plan',process:G?'スタック評価→依存関係チェック→リスク分析→代替案':'Stack eval→deps check→risk→alternatives',output:G?'リスク評価表':'Risk assessment'},
'実装支援':{input:'.spec/specification,technical-plan',process:G?'仕様読込→型定義→CRUD実装→テスト生成':'Read spec→types→CRUD impl→gen tests',output:G?'実装コード+テスト':'Code + tests'},
'デプロイ検証':{input:'docs/09,ci.yml',process:G?'環境変数チェック→ビルド検証→ヘルスチェック→ロールバック確認':'Env check→build verify→health→rollback',output:G?'デプロイレポート':'Deploy report'},
'問題生成':{input:'docs/03,Lesson',process:G?'学習目標抽出→難易度設定→正常系3問+異常系3問→解説生成':'Goals→difficulty→3 normal+3 edge→explanations',output:G?'問題セット(JSON)':'Quiz set (JSON)'},
'商品検証':{input:'Product,Category',process:G?'必須フィールド検査→SKU重複チェック→価格妥当性→画像存在確認':'Required fields→SKU dup→price valid→image check',output:G?'検証レポート':'Validation report'},
'モデレーション':{input:'Post,Comment',process:G?'禁止語チェック→スパム判定→報告集計→対応優先度付与':'Banned words→spam detect→report aggregate→priority',output:G?'モデレーションキュー':'Moderation queue'},
'予約設計':{input:'Service,TimeSlot',process:G?'空き枠計算→重複検出→バッファ設定→通知設計':'Availability calc→dup detect→buffer→notify design',output:G?'予約ロジック仕様':'Booking logic spec'},
'記録検証':{input:'HealthLog,Goal',process:G?'入力値範囲チェック→異常値検出→トレンド分析→アラート条件設定':'Range check→anomaly detect→trend→alert config',output:G?'健康レポート':'Health report'},
'CRM設計':{input:'User,Contact',process:G?'リード定義→ファネル設計→スコアリング→自動化ルール':'Lead def→funnel→scoring→automation rules',output:G?'CRM設計書':'CRM design doc'},
'デバイス管理':{input:'Device,Sensor',process:G?'デバイス登録→接続状態監視→ファーム更新管理→ログ収集':'Register→monitor→firmware→logs',output:G?'デバイス管理画面':'Device dashboard'},
'物件管理':{input:'Property,Category',process:G?'物件登録→写真管理→間取り設定→公開管理':'Register→photos→floor plan→publish',output:G?'物件データベース':'Property DB'},
'契約レビュー':{input:'Contract,Template',process:G?'テンプレート照合→リスク条項検出→期限チェック→承認フロー':'Template match→risk detect→deadline→approval',output:G?'レビュー結果':'Review result'},
'採用フロー':{input:'JobPosting,Applicant',process:G?'求人作成→応募管理→面接調整→評価集約→内定':'Post→apply→interview→eval→offer',output:G?'採用パイプライン':'Hiring pipeline'},
'取引検証':{input:'Transaction,Account',process:G?'残高確認→二重支払チェック→限度額検証→監査ログ':'Balance→dup check→limit→audit log',output:G?'検証レポート':'Validation report'}
};
let catalogMd=`# ${pn} ${G?'— AIスキルカタログ':'— AI Skills Catalog'}\n${G?'ドメイン特化スキル + コア開発スキル':'Domain-specific skills + core development skills'}\n\n`;
roleNames.forEach((role,idx)=>{
const roleSkills=allSkills.filter(s=>parseInt(s.split(':')[0])===idx);
if(roleSkills.length===0)return;
catalogMd+=`## ${role}\n\n`;
roleSkills.forEach(s=>{
const[,nameJa,nameEn,purposeJa,purposeEn,judgmentJa,judgmentEn]=s.split(':');
const name=G?nameJa:nameEn;
const purpose=G?purposeJa:purposeEn;
const judgment=G?judgmentJa:judgmentEn;
const detail=skillDetails[nameJa]||skillDetails[nameEn];
catalogMd+=`### ${name}\n- **${G?'目的':'Purpose'}**: ${purpose}\n- **${G?'判断基準':'Judgment'}**: ${judgment}\n`;
if(detail){
catalogMd+=`- **${G?'入力':'Input'}**: ${detail.input}\n- **${G?'処理':'Process'}**: ${detail.process}\n- **${G?'出力':'Output'}**: ${detail.output}\n`;
}else{
catalogMd+=`- **${G?'入力':'Input'}**: ${G?'関連ドキュメント':'Relevant documents'}\n- **${G?'出力':'Output'}**: ${G?'検証レポート/生成物':'Validation report / deliverables'}\n`;
}
catalogMd+='\n';
});
});
// Advanced skills based on ai_auto level
const hasMultiAgent=aiAuto.includes('Multi')||aiAuto.includes('マルチ')||aiAuto.includes('Full')||aiAuto.includes('フル')||aiAuto.includes('Orch');
const hasFullAuto=aiAuto.includes('Full')||aiAuto.includes('フル')||aiAuto.includes('Orch');
if(hasMultiAgent){
catalogMd+=`## ${G?'高度スキル':'Advanced'}\n`;
catalogMd+=`### ${G?'並列レビュー':'Parallel Review'}\n- **${G?'目的':'Purpose'}**: ${G?'複数エージェントで同時レビュー':'Multi-agent simultaneous review'}\n- **${G?'判断':'Judgment'}**: ${G?'全合意':'All agree'}\n- **${G?'入力':'Input'}**: ${G?'対象コード':'Target code'}\n- **${G?'処理':'Process'}**: ${G?'分割→並列レビュー→結果マージ→合意形成':'Split→parallel review→merge→consensus'}\n- **${G?'出力':'Output'}**: ${G?'統合レビュー':'Unified review'}\n\n`;
catalogMd+=`### ${G?'コードレビュー自動化':'Auto Code Review'}\n- **${G?'目的':'Purpose'}**: ${G?'PR単位で自動コードレビュー':'Auto review per PR'}\n- **${G?'判断':'Judgment'}**: ${G?'問題0件':'0 issues'}\n- **${G?'入力':'Input'}**: ${G?'PRの差分':'PR diff'}\n- **${G?'処理':'Process'}**: ${G?'差分解析→パターンチェック→セキュリティスキャン→提案生成':'Diff→pattern check→security scan→suggestions'}\n- **${G?'出力':'Output'}**: ${G?'レビューコメント':'Review comments'}\n\n`;
catalogMd+=`### ${G?'ドキュメント自動更新':'Auto Doc Update'}\n- **${G?'目的':'Purpose'}**: ${G?'コード変更に連動してドキュメント更新':'Update docs on code changes'}\n- **${G?'判断':'Judgment'}**: ${G?'乖離0':'0 drift'}\n- **${G?'入力':'Input'}**: ${G?'変更コード+既存docs/':'Changed code + existing docs/'}\n- **${G?'処理':'Process'}**: ${G?'変更検出→影響ドキュメント特定→差分生成→反映':'Detect change→find affected docs→gen diff→apply'}\n- **${G?'出力':'Output'}**: ${G?'更新済ドキュメント':'Updated docs'}\n\n`;
catalogMd+=`### ${G?'圧縮':'Compression'}\n- **${G?'判断':'Judgment'}**: ${G?'トークン80%削減':'80% token reduction'}\n\n`;
}
if(hasFullAuto){
catalogMd+=`## ${G?'自律':'Autonomous'}\n### ${G?'統括':'Orchestration'}\n- **${G?'判断':'Judgment'}**: ${G?'全完了':'All done'}\n### ${G?'自己修復':'Self-Heal'}\n- **${G?'判断':'Judgment'}**: ${G?'リトライ成功':'Retry OK'}\n\n`;
}
// Domain-specific skill
const domainPb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
if(domainPb&&domainPb.skill_ja&&domainPb.skill_ja!==''){
const skillParts=(G?domainPb.skill_ja:domainPb.skill_en).split('|');
if(skillParts.length>=5){
catalogMd+=`## ${G?'業種特化スキル':'Domain-Specific'}\n### ${G?'業種カスタムスキル':'Custom Domain Skill'}\n`;
catalogMd+=`- **${G?'役割':'Role'}**: ${skillParts[0]}\n`;
catalogMd+=`- **${G?'目的':'Purpose'}**: ${skillParts[1]}\n`;
catalogMd+=`- **${G?'入力':'Input'}**: ${skillParts[2]}\n`;
catalogMd+=`- **${G?'判断基準':'Judgment'}**: ${skillParts[3]}\n`;
catalogMd+=`- **${G?'出力':'Output'}**: ${skillParts[4]}\n\n`;
}
}
catalogMd+=`${G?'## 工場テンプレート':'## Factory Template'}\n${G?'詳細はskills/project.mdを参照':'See skills/project.md for template details'}\n`;
S.files['skills/catalog.md']=catalogMd;
// ═══ Phase 3: Pipelines (simplified) ═══
const aiLevel=aiAuto.includes('Vibe')||aiAuto.includes('入門')?'vibe':aiAuto.includes('Agentic')||aiAuto.includes('開発')?'agentic':aiAuto.includes('Multi')||aiAuto.includes('マルチ')?'multi':aiAuto.includes('Full')||aiAuto.includes('フル')?'full':'orch';
const basePipe={n:'Feature Dev',t:'New task',s:['req-review','arch-validate','code-gen','test-gen','deploy-check'],g:aiLevel==='vibe'||aiLevel==='agentic'?'human':'auto'};
const bugPipe={n:'Bug Fix',t:'Bug report',s:['reproduce','root-cause','fix','test','log'],g:aiLevel==='vibe'?'human':'auto'};
const pipelines=[basePipe];
if(aiLevel!=='vibe')pipelines.push(bugPipe);
if(aiLevel==='full'||aiLevel==='orch')pipelines.push({n:'Release',t:'Version tag',s:['qa','staging','security','prod'],g:'staging'});
let pipelineMd=`# ${pn} ${G?'— パイプライン':'— Pipelines'}\n\n`;
pipelines.forEach(p=>{
pipelineMd+=`## ${p.n}\n- **${G?'トリガー':'Trigger'}**: ${p.t}\n- **${G?'スキル':'Skills'}**: ${p.s.join(' → ')}\n- **${G?'ゲート':'Gate'}**: ${p.g}\n- **${G?'エラー':'Error'}**: ${G?'ログ → リトライ':'log → retry'}\n\n\`\`\`mermaid\ngraph LR\n T[${G?'開始':'Start'}]`;
p.s.forEach((s,i)=>pipelineMd+=` --> S${i+1}[${s}]`);
pipelineMd+=` --> Done[${G?'完了':'Done'}]\n\`\`\`\n\n`;
});
pipelineMd+=`${G?'## 実行方法':'## Execution'}\n1. ${G?'トリガー':'Trigger'}\n2. ${G?'スキル実行':'Run skills'}\n3. ${G?'PASS → 次':'PASS → next'}\n`;
S.files['skills/pipelines.md']=pipelineMd;
// ═══ skills/factory.md (Manus Skills Factory Template) ═══
const thinkingAxis={
education:G?'理解できるか?':'Understandable?',
ec:G?'コンバージョンするか?':'Converts?',
saas:G?'ユーザー価値があるか?':'User value?',
fintech:G?'安全か?':'Secure?',
health:G?'正確か?':'Accurate?',
marketplace:G?'信頼できるか?':'Trustworthy?',
community:G?'健全か?':'Healthy?',
content:G?'エンゲージメントするか?':'Engaging?',
analytics:G?'正確か?':'Accurate?',
booking:G?'重複しないか?':'No conflicts?',
business:G?'効率的か?':'Efficient?',
iot:G?'接続できるか?':'Connected?',
realestate:G?'成約するか?':'Converts?',
legal:G?'準拠しているか?':'Compliant?',
hr:G?'公平か?':'Fair?',
ai:G?'幻覚がないか?':'No hallucinations?',
automation:G?'自動化できるか?':'Automatable?',
event:G?'満足できるか?':'Satisfying?',
gamify:G?'継続できるか?':'Retaining?',
collab:G?'同期できるか?':'Synced?',
devtool:G?'使いやすいか?':'Developer-friendly?',
creator:G?'収益化できるか?':'Monetizable?',
newsletter:G?'開封されるか?':'Opened?'
};
const axis=thinkingAxis[domain]||(G?'目標達成できるか?':'Goal-achievable?');
let factoryMd='# '+(G?'Manus Skills式スキルファクトリー':'Manus Skills Factory Template')+'\n\n';
factoryMd+=G?'**重要**: このテンプレートは「1スキル=1判断」原則に基づき、カスタムスキルを設計するためのファクトリーです。AIエージェントは、新しいタスクに遭遇した際、このフォーマットでスキルを定義してください。\n\n':'**IMPORTANT**: This template follows "1 Skill = 1 Judgment" principle for designing custom skills. AI agents MUST use this format when defining new skills for encountered tasks.\n\n';
factoryMd+=(G?'## 原則: 1スキル=1判断':'## Principle: 1 Skill = 1 Judgment')+'\n\n';
factoryMd+=G?'- **スキルは判断単位**: 複数の判断を1スキルに詰め込まない\n- **判断基準は明確**: "PASS/FAIL"または"数値目標"で測定可能\n- **入力→処理→判断→出力**: この4ステップで完結する\n\n':'- **Skill is a judgment unit**: Don\'t pack multiple judgments into one skill\n- **Judgment criteria are clear**: Measurable as "PASS/FAIL" or "numerical targets"\n- **Input → Process → Judge → Output**: Complete in these 4 steps\n\n';
factoryMd+=(G?'## ドメイン別思考軸':'## Domain-Specific Thinking Axis')+'\n\n';
factoryMd+='**'+(G?'現在のドメイン':'Current Domain')+'**: '+domain+'\n';
factoryMd+='**'+(G?'中心的な問い':'Central Question')+'**: **'+axis+'**\n\n';
factoryMd+=G?'すべてのスキルは、この思考軸に沿った判断を行うべきです。\n\n':'All skills should make judgments aligned with this thinking axis.\n\n';
factoryMd+=(G?'## スキル定義フォーマット':'## Skill Definition Format')+'\n\n```\n';
factoryMd+=(G?'### スキル名: 【具体的な判断内容】':'### Skill Name: [Specific Judgment]')+'\n\n';
factoryMd+='**'+(G?'役割':'Role')+'** (Planning/Design/Production/Operations): '+(G?'該当フェーズを選択':'Select applicable phase')+'\n\n';
factoryMd+='**'+(G?'目的':'Purpose')+'**: '+(G?'このスキルが何を判断するか（1文で）':'What this skill judges (one sentence)')+'\n\n';
factoryMd+='**'+(G?'入力':'Input')+'**:\n- '+(G?'必要なファイル/データ':'Required files/data')+'\n- '+(G?'前提条件':'Prerequisites')+'\n\n';
factoryMd+='**'+(G?'処理':'Processing')+'**:\n1. '+(G?'ステップ1':'Step 1')+'\n2. '+(G?'ステップ2':'Step 2')+'\n3. '+(G?'ステップ3':'Step 3')+'\n\n';
factoryMd+='**'+(G?'判断基準':'Judgment Criteria')+'**: '+(G?'PASS条件（測定可能）':'PASS condition (measurable)')+'\n';
factoryMd+=(G?'- 例: エラー0件, カバレッジ80%+, 応答時間2秒以下':'- Example: 0 errors, coverage ≥80%, response time ≤2s')+'\n\n';
factoryMd+='**'+(G?'出力':'Output')+'**:\n- PASS/'+(G?'FAIL':'FAIL')+'\n- '+(G?'判断理由':'Reason')+'\n- '+(G?'次のアクション':'Next action')+'\n```\n\n';
factoryMd+=(G?'## カスタムスキル作成手順':'## Custom Skill Creation Steps')+'\n\n';
factoryMd+='1. **'+(G?'判断内容を特定':'Identify judgment')+'**\n - '+(G?'何を判断するか明確にする':'Clarify what to judge')+'\n - '+(G?'複数の判断がある場合は分割する':'Split if multiple judgments exist')+'\n\n';
factoryMd+='2. **'+(G?'入力を定義':'Define inputs')+'**\n - '+(G?'必要なドキュメント/ファイルをリスト':'List required documents/files')+'\n - '+(G?'前提条件を明記':'Specify prerequisites')+'\n\n';
factoryMd+='3. **'+(G?'処理ステップを分解':'Break down processing')+'**\n - '+(G?'3-5ステップで記述':'Describe in 3-5 steps')+'\n - '+(G?'各ステップは具体的に':'Each step should be concrete')+'\n\n';
factoryMd+='4. **'+(G?'判断基準を数値化':'Quantify criteria')+'**\n - '+(G?'測定可能な基準にする':'Make measurable criteria')+'\n - '+(G?'思考軸に沿っているか確認':'Check alignment with thinking axis')+'\n\n';
factoryMd+='5. **'+(G?'出力を設計':'Design output')+'**\n - PASS/FAIL + '+(G?'理由':'reason')+'\n - '+(G?'次のアクション（次のスキル名 or 完了）':'Next action (next skill name or complete)')+'\n\n';
factoryMd+=(G?'## サンプルスキル':'## Sample Skill')+'\n\n```\n';
factoryMd+=(G?'### スキル名: データベース設計検証':'### Skill Name: Database Design Validation')+'\n\n';
factoryMd+='**'+(G?'役割':'Role')+'**: Design\n\n';
factoryMd+='**'+(G?'目的':'Purpose')+'**: '+(G?'ER図とentitiesが一致し、FK参照が正しいか判断':'Judge if ER diagram matches entities and FK references are correct')+'\n\n';
factoryMd+='**'+(G?'入力':'Input')+'**:\n- docs/04_er_diagram.md\n- .spec/technical-plan.md (entities)\n\n';
factoryMd+='**'+(G?'処理':'Processing')+'**:\n1. '+(G?'ER図から全エンティティ抽出':'Extract all entities from ER diagram')+'\n2. '+(G?'technical-planのentitiesリストと照合':'Compare with entities list in technical-plan')+'\n3. '+(G?'FK参照先が全て存在するか確認':'Verify all FK references exist')+'\n\n';
factoryMd+='**'+(G?'判断基準':'Judgment Criteria')+'**: '+(G?'不一致0件 AND FK未定義0件':'0 mismatches AND 0 undefined FKs')+'\n\n';
factoryMd+='**'+(G?'出力':'Output')+'**:\n- PASS/'+(G?'FAIL':'FAIL')+'\n- '+(G?'不一致リスト（あれば）':'Mismatch list (if any)')+'\n- '+(G?'次: API設計検証':'Next: API Design Validation')+'\n```\n\n';
factoryMd+=(G?'## ドメイン別スキル例':'## Domain-Specific Skill Examples')+'\n\n';
if(domainSkills.length>0){
factoryMd+=(G?'現在のドメイン（':'Current domain (')+domain+(G?'）の登録済みスキル:':') registered skills:')+'\n';
domainSkills.forEach((sk,i)=>{
const[r,nJa,nEn,pJa,pEn,jJa,jEn]=sk.split(':');
factoryMd+=(i+1)+'. **'+(G?nJa:nEn)+'** - '+(G?jJa:jEn)+'\n';
});
}else{
factoryMd+=G?'（このドメインはまだスキルが登録されていません。上記フォーマットで作成してください）':'(No skills registered for this domain yet. Create using the format above)';
}
factoryMd+='\n';
S.files['skills/factory.md']=factoryMd;
// ═══ C2: md Package Distribution (~10KB, ai_auto=multi/full/orch only) ═══
const isMultiOrAbove=aiLevel==='multi'||aiLevel==='full'||aiLevel==='orch';
if(isMultiOrAbove){
// skills/README.md - Package overview
let skillsReadme='# '+pn+' Skills Package\n\n';
skillsReadme+=G?'**世界唯一のAI Development OS**: このパッケージは、AIエージェントが自律的に開発を進めるための完全なスキル体系です。\n\n':'**World\'s First AI Development OS**: This package is a complete skill system for AI agents to autonomously develop software.\n\n';
skillsReadme+=(G?'## クイックスタート':'## Quick Start')+'\n\n';
skillsReadme+='1. **'+(G?'全体像を把握':'Understand overview')+'**: `skills/skill_map.md` '+(G?'でスキル依存関係を確認':'for skill dependency map')+'\n';
skillsReadme+='2. **'+(G?'詳細を確認':'Check details')+'**: `skills/catalog.md` '+(G?'で全スキル詳細を確認':'for all skill details')+'\n';
skillsReadme+='3. **'+(G?'パイプライン実行':'Execute pipeline')+'**: `skills/pipelines.md` '+(G?'で自動化フロー確認':'for automation flows')+'\n';
skillsReadme+='4. **'+(G?'カスタムスキル作成':'Create custom skills')+'**: `skills/factory.md` '+(G?'のテンプレート使用':'using template')+'\n\n';
skillsReadme+=(G?'## ファイル構成':'## File Structure')+'\n\n';
skillsReadme+='```\n';
skillsReadme+='skills/\n';
skillsReadme+='├── README.md # '+(G?'このファイル':'This file')+'\n';
skillsReadme+='├── skill_map.md # '+(G?'依存関係マップ':'Dependency map')+'\n';
skillsReadme+='├── catalog.md # '+(G?'全スキルカタログ':'Full catalog')+'\n';
skillsReadme+='├── pipelines.md # '+(G?'自動化パイプライン':'Automation pipelines')+'\n';
skillsReadme+='├── factory.md # '+(G?'スキル工場テンプレート':'Skill factory template')+'\n';
skillsReadme+='├── project.md # '+( G?'プロジェクトスキル':'Project skills')+'\n';
skillsReadme+='└── agents/\n';
skillsReadme+=' ├── coordinator.md # '+(G?'オーケストレーター':'Coordinator agent')+'\n';
skillsReadme+=' └── reviewer.md # '+(G?'レビューアー':'Reviewer agent')+'\n';
skillsReadme+='```\n\n';
skillsReadme+=(G?'## AI成熟度モデル':'## AI Maturity Model')+'\n\n';
skillsReadme+=(G?'**現在レベル**: '+aiLevel.toUpperCase():'**Current Level**: '+aiLevel.toUpperCase())+'\n\n';
const maturityLevels=[
{level:'Prompt',desc_ja:'個別プロンプト',desc_en:'Individual prompts',current:aiLevel==='vibe'},
{level:'Skill',desc_ja:'スキル単位（1スキル=1判断）',desc_en:'Skill-based (1 skill = 1 judgment)',current:aiLevel==='agentic'},
{level:'Agent',desc_ja:'エージェント単位（複数スキル統合）',desc_en:'Agent-based (multiple skills)',current:aiLevel==='multi'},
{level:'Package',desc_ja:'パッケージ単位（スキル群配布）',desc_en:'Package-based (skill sets)',current:aiLevel==='full'},
{level:'Series',desc_ja:'シリーズ単位（業種別パッケージ群）',desc_en:'Series-based (industry packages)',current:aiLevel==='orch'}
];
maturityLevels.forEach((m,i)=>{
const arrow=m.current?'👉 ':' ';
const label=G?m.desc_ja:m.desc_en;
skillsReadme+=arrow+(i+1)+'. **'+m.level+'** - '+label+(m.current?' ✅':'')+'\n';
});
skillsReadme+='\n';
skillsReadme+=(G?'## 使い方':'## Usage')+'\n\n';
skillsReadme+='### '+(G?'スキル実行':'Execute Skill')+'\n';
skillsReadme+='```javascript\n';
skillsReadme+='// 1. '+(G?'スキルを選択':'Select skill')+'\n';
skillsReadme+='const skill = getSkill(\'spec-review\');\n\n';
skillsReadme+='// 2. '+(G?'入力を準備':'Prepare input')+'\n';
skillsReadme+='const input = {\n';
skillsReadme+=' files: [\'/.spec/constitution.md\', \'.spec/specification.md\'],\n';
skillsReadme+=' context: AI_BRIEF\n';
skillsReadme+='};\n\n';
skillsReadme+='// 3. '+(G?'実行':'Execute')+'\n';
skillsReadme+='const result = await executeSkill(skill, input);\n\n';
skillsReadme+='// 4. '+(G?'判定':'Judge')+'\n';
skillsReadme+='if (result.judgment === \'PASS\') {\n';
skillsReadme+=' // '+(G?'次のスキルへ':'Proceed to next skill')+'\n';
skillsReadme+='} else {\n';
skillsReadme+=' // '+(G?'修正して再実行':'Fix and re-execute')+'\n';
skillsReadme+='}\n';
skillsReadme+='```\n\n';
S.files['skills/README.md']=skillsReadme;
// skills/skill_map.md - Dependency map with 4-layer business model
let skillMapMd='# '+pn+' Skill Map\n\n';
skillMapMd+=G?'**スキル依存関係マップ**: すべてのスキルの依存関係と4層ビジネスモデルを可視化します。\n\n':'**Skill Dependency Map**: Visualizes all skill dependencies and 4-layer business model.\n\n';
skillMapMd+=(G?'## 4層ビジネスモデル':'## 4-Layer Business Model')+'\n\n';
skillMapMd+='```mermaid\ngraph TB\n';
skillMapMd+=' subgraph P['+(G?'企画':'Planning')+']\n';
skillMapMd+=' P1['+( G?'要件レビュー':'Req Review')+']\n';
skillMapMd+=' end\n';
skillMapMd+=' subgraph D['+(G?'設計':'Design')+']\n';
skillMapMd+=' D1['+(G?'設計検証':'Arch Review')+']\n';
skillMapMd+=' D2['+(G?'API設計':'API Design')+']\n';
skillMapMd+=' end\n';
skillMapMd+=' subgraph C['+(G?'制作':'Production')+']\n';
skillMapMd+=' C1['+(G?'実装支援':'Code Support')+']\n';
skillMapMd+=' C2['+(G?'テスト生成':'Test Gen')+']\n';
skillMapMd+=' end\n';
skillMapMd+=' subgraph O['+(G?'運用':'Operations')+']\n';
skillMapMd+=' O1['+(G?'デプロイ検証':'Deploy Check')+']\n';
skillMapMd+=' O2['+(G?'ドキュメント生成':'Doc Gen')+']\n';
skillMapMd+=' end\n\n';
skillMapMd+=' P1 --> D1\n';
skillMapMd+=' D1 --> D2\n';
skillMapMd+=' D2 --> C1\n';
skillMapMd+=' C1 --> C2\n';
skillMapMd+=' C2 --> O1\n';
skillMapMd+=' O1 --> O2\n';
skillMapMd+=' O2 -.->|'+(G?'振り返り':'Retrospective')+'| P1\n';
skillMapMd+='```\n\n';
skillMapMd+=(G?'## スキル一覧':'## Skill List')+'\n\n';
skillMapMd+='| '+(G?'スキルID':'Skill ID')+' | '+(G?'役割':'Role')+' | '+(G?'依存':'Depends On')+' | '+(G?'次':'Next')+' |\n';
skillMapMd+='|----------|------|------|------|\n';
skillMapMd+='| spec-review | Planning | - | arch-review |\n';
skillMapMd+='| arch-review | Design | spec-review | api-design |\n';
skillMapMd+='| api-design | Design | arch-review | code-gen |\n';
skillMapMd+='| code-gen | Production | api-design | test-gen |\n';
skillMapMd+='| test-gen | Production | code-gen | deploy-check |\n';
skillMapMd+='| deploy-check | Operations | test-gen | doc-gen |\n';
skillMapMd+='| doc-gen | Operations | deploy-check | - |\n\n';
skillMapMd+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
skillMapMd+='- **skills/catalog.md** — '+(G?'全スキル詳細':'All skill details')+'\n';
skillMapMd+='- **skills/pipelines.md** — '+(G?'実行フロー':'Execution flows')+'\n';
skillMapMd+='- **skills/factory.md** — '+(G?'カスタムスキル作成':'Custom skill creation')+'\n\n';
S.files['skills/skill_map.md']=skillMapMd;
// skills/agents/coordinator.md - Orchestrator agent definition
let coordMd='# Coordinator Agent\n\n';
coordMd+=G?'**役割**: 複数エージェントの統括・タスク配分・進捗管理\n\n':'**Role**: Orchestrate multiple agents, task allocation, progress management\n\n';
coordMd+=(G?'## 責務':'## Responsibilities')+'\n\n';
coordMd+='1. **'+(G?'タスク分解':'Task Decomposition')+'**: '+(G?'大きなタスクを実行可能な単位に分割':'Break large tasks into executable units')+'\n';
coordMd+='2. **'+(G?'エージェント割当':'Agent Assignment')+'**: '+(G?'各タスクに最適なエージェントを割当':'Assign optimal agent to each task')+'\n';
coordMd+='3. **'+(G?'進捗監視':'Progress Monitoring')+'**: docs/24_progress.md '+(G?'を更新':'updates')+'\n';
coordMd+='4. **'+(G?'ブロッカー解消':'Blocker Resolution')+'**: '+(G?'依存関係の問題を検出・解決':'Detect and resolve dependency issues')+'\n\n';
coordMd+=(G?'## 入力':'## Input')+'\n\n';
coordMd+='- .spec/tasks.md '+(G?'— 全タスクリスト':'— All tasks list')+'\n';
coordMd+='- docs/24_progress.md '+(G?'— 現在の進捗':'— Current progress')+'\n';
coordMd+='- AI_BRIEF.md '+(G?'— プロジェクト全体像':'— Project overview')+'\n\n';
coordMd+=(G?'## 判断基準':'## Judgment Criteria')+'\n\n';
coordMd+='- [ ] '+(G?'全タスクが適切に割当済み':'All tasks properly assigned')+'\n';
coordMd+='- [ ] '+(G?'ブロッカー0件':'0 blockers')+'\n';
coordMd+='- [ ] '+(G?'進捗が予定通り':'Progress on track')+'\n\n';
coordMd+=(G?'## 出力':'## Output')+'\n\n';
coordMd+='- '+(G?'更新された.spec/tasks.md':'Updated .spec/tasks.md')+'\n';
coordMd+='- '+(G?'更新されたdocs/24_progress.md':'Updated docs/24_progress.md')+'\n';
coordMd+='- '+(G?'次のフェーズへの移行可否判定':'Go/No-go decision for next phase')+'\n\n';
S.files['skills/agents/coordinator.md']=coordMd;
// skills/agents/reviewer.md - Reviewer agent definition
let reviewerMd='# Reviewer Agent\n\n';
reviewerMd+=G?'**役割**: コード品質・設計整合性・セキュリティの自動レビュー\n\n':'**Role**: Automated review of code quality, design consistency, and security\n\n';
reviewerMd+=(G?'## 責務':'## Responsibilities')+'\n\n';
reviewerMd+='1. **'+(G?'コード品質':'Code Quality')+'**: '+(G?'TypeScript strict準拠、ESLintエラー0':'TypeScript strict, 0 ESLint errors')+'\n';
reviewerMd+='2. **'+(G?'設計整合性':'Design Consistency')+'**: .spec/specification.md '+(G?'との一致':'alignment')+'\n';
reviewerMd+='3. **'+(G?'セキュリティ':'Security')+'**: docs/08_security.md '+(G?'のチェックリスト確認':'checklist verification')+'\n';
reviewerMd+='4. **'+(G?'テストカバレッジ':'Test Coverage')+'**: ≥80%\n\n';
reviewerMd+=(G?'## 入力':'## Input')+'\n\n';
reviewerMd+='- '+(G?'変更されたコードファイル':'Modified code files')+'\n';
reviewerMd+='- .spec/specification.md\n';
reviewerMd+='- docs/32_qa_blueprint.md\n';
reviewerMd+='- docs/37_bug_prevention.md\n\n';
reviewerMd+=(G?'## 判断基準':'## Judgment Criteria')+'\n\n';
reviewerMd+='- [ ] '+(G?'全テスト PASS':'All tests PASS')+'\n';
reviewerMd+='- [ ] '+(G?'カバレッジ ≥80%':'Coverage ≥80%')+'\n';
reviewerMd+='- [ ] '+(G?'セキュリティ違反 0件':'0 security violations')+'\n';
reviewerMd+='- [ ] .spec/'+(G?'整合性確認済':'consistency verified')+'\n\n';
reviewerMd+=(G?'## 出力':'## Output')+'\n\n';
reviewerMd+='- PASS / FAIL\n';
reviewerMd+='- '+(G?'問題リスト（あれば）':'Issue list (if any)')+'\n';
reviewerMd+='- '+(G?'改善提案':'Improvement suggestions')+'\n\n';
S.files['skills/agents/reviewer.md']=reviewerMd;
}
// ═══ Phase 4: AGENTS.md enhancement ═══
S.files['AGENTS.md']+=`\n\n## Pipeline Coordination\n- Pipelines: skills/pipelines.md\n- Catalog: skills/catalog.md\n- Gates: ${aiLevel==='vibe'||aiLevel==='agentic'?'human':'auto'}\n- Error: docs/25 → retry → escalate\n- Context: AI_BRIEF.md only\n`;
}
}
/* ═══ Quality Intelligence Engine (Industry-Adaptive QA Strategy) ═══ */
function genPillar5_QualityIntelligence(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'_default';
const purpose=a.purpose||'';
const features=(a.mvp_features||'').split(/[,、\n]/).map(s=>s.trim()).filter(Boolean);
const entities=(a.data_entities||'').split(/[,、]\s*/).map(s=>s.trim()).filter(Boolean);
// Infer industry from domain or default to saas
const industryMap={
fintech:'fintech',health:'health',ec:'ec',saas:'saas',community:'social',
education:'education',gamify:'gaming',iot:'iot',booking:'travel',
realestate:'realestate',content:'media',hr:'hr',analytics:'marketing',
marketplace:'ec',business:'saas',legal:'government',portfolio:'media',
tool:'saas',ai:'saas',automation:'saas',event:'travel',collab:'saas',
devtool:'saas',creator:'media',newsletter:'media'
};
const industry=industryMap[domain]||'saas';
const tm=INDUSTRY_TEST_MATRIX[industry]||INDUSTRY_TEST_MATRIX.saas;
// ═══ docs/32_qa_blueprint.md ═══
let doc32='# '+(G?'業種適応型QAブループリント':'Industry-Adaptive QA Blueprint')+'\n\n';
doc32+=G?'**重要**: このドキュメントは、業種特有のQA戦略とリスク評価を提供します。AIエージェントは、テスト計画策定時に必ずこのブループリントを参照してください。\n\n':'**IMPORTANT**: This document provides industry-specific QA strategies and risk assessments. AI agents MUST reference this blueprint when creating test plans.\n\n';
// Industry Overview
doc32+=(G?'## 対象業種':'## Target Industry')+'\n\n';
doc32+='**'+(G?'業種':'Industry')+'**: '+industry+'\n';
doc32+='**'+(G?'ドメイン':'Domain')+'**: '+domain+'\n';
doc32+='**'+(G?'プロジェクト目的':'Project Purpose')+'**: '+purpose+'\n\n';
// Critical Functions
doc32+=(G?'## 重要機能（Critical Functions）':'## Critical Functions')+'\n\n';
doc32+=G?'この業種で最も重要視すべき機能:\n\n':'Most critical functions for this industry:\n\n';
const critFuncs=G?tm.critical_functions_ja:tm.critical_functions_en;
critFuncs.forEach((cf,i)=>{
doc32+=(i+1)+'. **'+cf+'**\n';
});
doc32+='\n';
// Test Focus Areas
doc32+=(G?'## テスト重点領域':'## Test Focus Areas')+'\n\n';
const testFocus=G?tm.test_focus_ja:tm.test_focus_en;
testFocus.forEach((tf,i)=>{
doc32+='### '+(i+1)+'. '+tf+'\n\n';
// Add test details based on focus area
if(i===0){
doc32+=G?'- テストケース: 正常系・異常系・境界値\n- カバレッジ目標: 80%+\n- 自動化: 必須\n\n':'- Test cases: Normal, error, boundary\n- Coverage target: 80%+\n- Automation: Required\n\n';
}else if(i===1){
doc32+=G?'- 静的解析ツール使用\n- コードレビュー必須\n- OWASP Top 10準拠\n\n':'- Use static analysis tools\n- Code review required\n- OWASP Top 10 compliance\n\n';
}else if(i===2){
doc32+=G?'- 負荷テスト実施\n- レスポンスタイム測定\n- リソース監視\n\n':'- Conduct load testing\n- Measure response time\n- Monitor resources\n\n';
}else{
doc32+=G?'- 実機テスト推奨\n- ユーザビリティ評価\n- アクセシビリティチェック\n\n':'- Real device testing recommended\n- Usability evaluation\n- Accessibility check\n\n';
}
});
// Risk Priority Matrix
doc32+=(G?'## リスク優先度マトリクス':'## Risk Priority Matrix')+'\n\n';
const priObj={};
tm.priority.split('|').forEach(p=>{
const[k,v]=p.split(':');
priObj[k]=v;
});
doc32+='| '+(G?'カテゴリ':'Category')+' | '+(G?'優先度':'Priority')+' | '+(G?'対策':'Mitigation')+' |\n';
doc32+='|----------|----------|----------|\n';
const catMap={
Security:G?'セキュリティ':'Security',
Performance:G?'パフォーマンス':'Performance',
DataIntegrity:G?'データ整合性':'Data Integrity',
UX:'UX',
Compliance:G?'コンプライアンス':'Compliance'
};
Object.entries(catMap).forEach(([key,label])=>{
const priority=priObj[key]||'MED';
const mitigation=priority==='HIGH'||priority==='CRITICAL'?(G?'専門家レビュー・自動化テスト':'Expert review, automated tests'):(G?'定期チェック':'Regular checks');
doc32+='| '+label+' | '+priority+' | '+mitigation+' |\n';
});
doc32+='\n';
// Typical Bugs & Prevention
doc32+=(G?'## 典型的バグパターン':'## Typical Bug Patterns')+'\n\n';
const typicalBugs=G?tm.typical_bugs_ja:tm.typical_bugs_en;
typicalBugs.forEach((bug,i)=>{
doc32+='### '+(i+1)+'. '+bug+'\n\n';
doc32+='**'+(G?'検出方法':'Detection')+'**: ';
if(i===0){
doc32+=G?'単体テスト・統合テスト\n':'Unit tests, integration tests\n';
}else if(i===1){
doc32+=G?'E2Eテスト・手動テスト\n':'E2E tests, manual tests\n';
}else if(i===2){
doc32+=G?'コードレビュー・静的解析\n':'Code review, static analysis\n';
}else{
doc32+=G?'ログ監視・アラート\n':'Log monitoring, alerts\n';
}
doc32+='**'+(G?'予防策':'Prevention')+'**: ';
if(i===0){
doc32+=G?'設計段階でのレビュー、早期プロトタイプ検証\n':'Design review, early prototype validation\n';
}else if(i===1){
doc32+=G?'ペアプログラミング、TDD実践\n':'Pair programming, TDD practice\n';
}else{
doc32+=G?'チェックリスト使用、自動化\n':'Use checklists, automation\n';
}
doc32+='\n';
});
// Recommended Tools
doc32+=(G?'## 推奨テストツール':'## Recommended Testing Tools')+'\n\n';
const tools=G?tm.tools_ja:tm.tools_en;
tools.forEach((tool,i)=>{
const[name,type]=tool.split(/[（(]/);
const cleanType=(type||'').replace(/[）)]/g,'');
doc32+=(i+1)+'. **'+name.trim()+'**';
if(cleanType){
doc32+=' - '+cleanType;
}
doc32+='\n';
});
doc32+='\n';
// Risk Heatmap
doc32+=(G?'## リスクヒートマップ':'## Risk Heatmap')+'\n\n';
doc32+='```\n';
doc32+=(G?'影響度 ＼ 発生確率 │ 低 中 高':'Impact \\ Probability │ Low Med High')+'\n';
doc32+='─────────────────┼──────────────────\n';
const highRisk=priObj.Security==='HIGH'||priObj.Security==='CRITICAL'?'🔴':'🟡';
const medRisk=priObj.DataIntegrity==='HIGH'?'🟡':'🟢';
doc32+=(G?' 大 │ 🟡 🟡 ':' High │ 🟡 🟡 ')+highRisk+'\n';
doc32+=(G?' 中 │ 🟢 🟡 🟡':' Med │ 🟢 🟡 🟡')+'\n';
doc32+=(G?' 小 │ 🟢 🟢 ':' Low │ 🟢 🟢 ')+medRisk+'\n';
doc32+='```\n\n';
doc32+=G?'🔴 = 即対応必須 | 🟡 = 計画的対応 | 🟢 = 定期チェック\n\n':'🔴 = Immediate action | 🟡 = Planned action | 🟢 = Regular check\n\n';
// Compliance Checklist
if(priObj.Compliance==='HIGH'||priObj.Compliance==='CRITICAL'){
doc32+=(G?'## コンプライアンスチェックリスト':'## Compliance Checklist')+'\n\n';
const compStd={
fintech:'PCI DSS',health:'HIPAA',education:'FERPA',hr:'GDPR',
legal:'SOX',government:'WCAG 2.1 AA'
}[industry]||'GDPR';
doc32+='**'+(G?'準拠基準':'Standard')+'**: '+compStd+'\n\n';
doc32+='- [ ] '+(G?'データ暗号化（保存時・転送時）':'Data encryption (at rest & in transit)')+'\n';
doc32+='- [ ] '+(G?'アクセスログ記録':'Access log recording')+'\n';
doc32+='- [ ] '+(G?'データ保持期間管理':'Data retention management')+'\n';
doc32+='- [ ] '+(G?'監査証跡完全性':'Audit trail completeness')+'\n';
doc32+='- [ ] '+(G?'インシデント対応手順':'Incident response procedures')+'\n\n';
}

S.files['docs/32_qa_blueprint.md']=doc32;
// ═══ docs/33_test_matrix.md ═══
let doc33='# '+(G?'具体的テストマトリクス':'Concrete Test Matrix')+'\n\n';
doc33+=G?'**重要**: このマトリクスは、実装すべきテストケースの具体例を提供します。AIエージェントは、テスト実装時にこのマトリクスをテンプレートとして使用してください。\n\n':'**IMPORTANT**: This matrix provides concrete test case examples. AI agents MUST use this matrix as a template when implementing tests.\n\n';
// Test Case Template
doc33+=(G?'## テストケーステンプレート':'## Test Case Template')+'\n\n';
doc33+='| '+(G?'機能':'Feature')+' | '+(G?'テストケース':'Test Case')+' | '+(G?'期待結果':'Expected Result')+' | '+(G?'優先度':'Priority')+' |\n';
doc33+='|------|------|------|------|\n';
// Generate test cases for critical functions
critFuncs.slice(0,3).forEach((func,i)=>{
const pri=i===0?'P0':(i===1?'P1':'P2');
// Normal case
doc33+='| '+func+' | '+(G?'正常系: ':'Normal: ')+(G?'有効なデータで実行':'Execute with valid data')+' | '+(G?'成功':'Success')+' (200/201) | '+pri+' |\n';
// Error case
doc33+='| '+func+' | '+(G?'異常系: ':'Error: ')+(G?'不正なデータ':'Invalid data')+' | '+(G?'エラー':'Error')+' (400/422) | '+pri+' |\n';
// Boundary case
if(i===0){
doc33+='| '+func+' | '+(G?'境界値: ':'Boundary: ')+(G?'最大/最小値':'Max/min values')+' | '+(G?'適切に処理':'Handled properly')+' | '+pri+' |\n';
}
});
doc33+='\n';
// Bug Pattern × Detection × Prevention
doc33+=(G?'## バグパターン × 検出方法 × 予防策':'## Bug Pattern × Detection × Prevention')+'\n\n';
doc33+='| '+(G?'バグパターン':'Bug Pattern')+' | '+(G?'検出方法':'Detection Method')+' | '+(G?'予防策':'Prevention')+' |\n';
doc33+='|----------|----------|----------|\n';
typicalBugs.forEach((bug,i)=>{
const detection=i===0?(G?'単体テスト':'Unit tests'):(i===1?(G?'E2Eテスト':'E2E tests'):(i===2?(G?'静的解析':'Static analysis'):(G?'ログ監視':'Log monitoring')));
const prevention=i===0?(G?'設計レビュー':'Design review'):(i===1?'TDD':(i===2?(G?'チェックリスト':'Checklist'):(G?'自動化':'Automation')));
doc33+='| '+bug+' | '+detection+' | '+prevention+' |\n';
});
doc33+='\n';
// Cross-Cutting Concerns Test Cases
doc33+=(G?'## 業界横断テストケース':'## Cross-Cutting Test Cases')+'\n\n';
const crossCutting=Object.values(QA_CROSS_CUTTING).filter(c=>c.domains.includes(domain)||c.domains.includes(industry));
if(crossCutting.length>0){
crossCutting.forEach((cc,i)=>{
const label=G?cc.ja:cc.en;
doc33+='### '+(i+1)+'. '+label+'\n\n';
// Generate sample test case
if(label.includes('同時')||label.includes('Concurrent')){
doc33+='- '+(G?'100人同時アクセステスト':'100 concurrent users test')+'\n';
doc33+='- '+(G?'期待: データ競合0件':'Expected: 0 race conditions')+'\n\n';
}else if(label.includes('冪等')||label.includes('Idempot')){
doc33+='- '+(G?'同一リクエスト2回送信':'Send same request twice')+'\n';
doc33+='- '+(G?'期待: 結果同一、副作用1回のみ':'Expected: Same result, side effect once only')+'\n\n';
}else if(label.includes('スパイク')||label.includes('Spike')){
doc33+='- '+(G?'通常の100倍トラフィック':'100x normal traffic')+'\n';
doc33+='- '+(G?'期待: エラー率5%以下':'Expected: Error rate ≤5%')+'\n\n';
}else if(label.includes('レート')||label.includes('Rate')){
doc33+='- '+(G?'制限超過リクエスト':'Request beyond limit')+'\n';
doc33+='- '+(G?'期待: 429 Too Many Requests':'Expected: 429 Too Many Requests')+'\n\n';
}else{
doc33+='- '+(G?'機能テスト実施':'Functional test')+'\n';
doc33+='- '+(G?'期待: 仕様通り動作':'Expected: Works as specified')+'\n\n';
}
});
}else{
doc33+=G?'（該当する業界横断テストパターンなし）\n\n':'(No applicable cross-cutting patterns)\n\n';
}

// Tool-Specific Test Examples
doc33+=(G?'## ツール別テスト例':'## Tool-Specific Test Examples')+'\n\n';
tools.slice(0,3).forEach((tool,i)=>{
const[name]=tool.split(/[（(]/);
doc33+='### '+name.trim()+'\n\n```javascript\n';
if(name.includes('Jest')||name.includes('Vitest')){
doc33+="describe('"+critFuncs[0]+"', () => {\n";
doc33+=" test('should return success with valid data', async () => {\n";
doc33+=" const result = await "+critFuncs[0].toLowerCase().replace(/\s+/g,'')+"(validData);\n";
doc33+=" expect(result.status).toBe(200);\n";
doc33+=" });\n});\n";
}else if(name.includes('Playwright')||name.includes('Cypress')){
doc33+="test('"+critFuncs[0]+"', async ({ page }) => {\n";
doc33+=" await page.goto('/"+critFuncs[0].toLowerCase().replace(/\s+/g,'-')+"');\n";
doc33+=" await page.click('button[type=\"submit\"]');\n";
doc33+=" await expect(page.locator('.success')).toBeVisible();\n";
doc33+="});\n";
}else{
doc33+="// "+name.trim()+(G?' 使用例':' usage example')+"\n";
doc33+="// "+(G?'設定と実行手順はドキュメント参照':'Refer to documentation for setup and execution')+"\n";
}
doc33+='```\n\n';
});
// Coverage Goals
doc33+=(G?'## カバレッジ目標':'## Coverage Goals')+'\n\n';
doc33+='| '+(G?'カテゴリ':'Category')+' | '+(G?'目標':'Target')+' |\n';
doc33+='|----------|----------|\n';
doc33+='| '+(G?'ライン':'Line')+' | ≥80% |\n';
doc33+='| '+(G?'ブランチ':'Branch')+' | ≥70% |\n';
doc33+='| '+(G?'関数':'Function')+' | ≥85% |\n';
doc33+='| '+(G?'ステートメント':'Statement')+' | ≥80% |\n';
doc33+='\n';
doc33+=G?'**注**: 重要機能（P0）は100%カバレッジを目指す\n\n':'**Note**: Critical functions (P0) should aim for 100% coverage\n\n';
S.files['docs/33_test_matrix.md']=doc33;
// ═══ B1: docs/34_incident_response.md (~10KB) ═══
let doc34='# '+(G?'インシデント対応プレイブック':'Incident Response Playbook')+'\n\n';
doc34+=G?'**重要**: このプレイブックは本番障害発生時の対応手順を定義します。全メンバーは事前にこの手順を理解し、障害発生時は冷静に実行してください。\n\n':'**IMPORTANT**: This playbook defines incident response procedures for production outages. All team members MUST understand these procedures beforehand and execute calmly during incidents.\n\n';
// Severity Classification
doc34+=(G?'## Severity分類':'## Severity Classification')+'\n\n';
doc34+='| Severity | '+(G?'定義':'Definition')+' | '+(G?'対応時間':'Response Time')+' | '+(G?'具体例 ('+domain+')':'Examples ('+domain+')')+' |\n';
doc34+='|----------|------|------|------|\n';
// Domain-specific examples
const s1Ex={
ec:G?'決済処理停止':'Payment processing down',
fintech:G?'残高不整合・取引停止':'Balance inconsistency, trading halt',
health:G?'患者データ消失':'Patient data loss',
education:G?'試験データ消失':'Exam data loss',
saas:G?'全サービス停止':'Complete service outage',
community:G?'個人情報漏洩':'Personal data breach',
booking:G?'予約システム停止':'Booking system down',
marketplace:G?'取引決済停止':'Transaction payment down',
iot:G?'全デバイス接続断':'All devices disconnected',
realestate:G?'契約データ消失':'Contract data loss',
legal:G?'機密情報漏洩':'Confidential data breach',
hr:G?'給与データ漏洩':'Payroll data breach'
}[domain]||(G?'サービス全停止':'Complete service down');
const s2Ex={
ec:G?'カート機能障害':'Cart malfunction',
fintech:G?'一部取引遅延':'Partial transaction delays',
health:G?'予約機能障害':'Appointment feature down',
education:G?'動画再生不可':'Video playback failure',
saas:G?'主要機能停止':'Core feature down',
community:G?'投稿機能停止':'Post feature down',
booking:G?'通知送信失敗':'Notification delivery failure',
iot:G?'一部デバイス障害':'Partial device failures'
}[domain]||(G?'主要機能停止':'Core feature down');
const s3Ex={
ec:G?'検索精度低下':'Search accuracy degraded',
saas:G?'パフォーマンス低下':'Performance degradation',
education:G?'レスポンス遅延':'Response delays'
}[domain]||(G?'性能劣化':'Performance degradation');
const s4Ex=G?'軽微なUI不具合':'Minor UI glitch';
doc34+='| S1 🔴 | '+(G?'サービス停止・データ損失':'Service down, data loss')+' | '+( G?'15分以内':'≤15 min')+' | '+s1Ex+' |\n';
doc34+='| S2 🟠 | '+(G?'主要機能停止':'Core feature down')+' | '+(G?'1時間以内':'≤1 hour')+' | '+s2Ex+' |\n';
doc34+='| S3 🟡 | '+(G?'性能劣化':'Performance degraded')+' | '+(G?'24時間以内':'≤24 hours')+' | '+s3Ex+' |\n';
doc34+='| S4 🟢 | '+(G?'軽微な不具合':'Minor bug')+' | '+(G?'次回リリース':'Next release')+' | '+s4Ex+' |\n\n';
// Runbook Template
doc34+=(G?'## Runbookテンプレート':'## Runbook Template')+'\n\n';
doc34+=(G?'### 1. 検知 (Detection)':'### 1. Detection')+'\n\n';
doc34+='- **'+(G?'アラート':'Alert')+'**: '+(G?'監視ツール（CloudWatch/Datadog/Sentry）からアラート受信':'Receive alert from monitoring tool (CloudWatch/Datadog/Sentry)')+'\n';
doc34+='- **'+(G?'確認':'Verify')+'**: '+(G?'ダッシュボードでメトリクス確認':'Check metrics on dashboard')+'\n';
doc34+='- **'+(G?'影響範囲特定':'Scope')+'**: '+(G?'全ユーザー or 特定機能 or 特定リージョン':'All users / specific feature / specific region')+'\n\n';
doc34+=(G?'### 2. トリアージ (Triage)':'### 2. Triage')+'\n\n';
doc34+='- **Severity'+(G?'判定':'Classification')+'**: '+(G?'上記分類表に基づき判定':'Classify based on table above')+'\n';
doc34+='- **'+(G?'初動':'Initial Action')+'**: S1/S2'+(G?'は即座にインシデントチャネル開設':'→ Open incident channel immediately')+'\n';
doc34+='- **'+(G?'担当者招集':'Assemble Team')+'**: '+(G?'オンコール担当 + バックエンド + インフラ':'On-call + Backend + Infra')+'\n\n';
doc34+=(G?'### 3. 緩和 (Mitigation)':'### 3. Mitigation')+'\n\n';
doc34+='**'+(G?'優先順位':'Priority')+'**: '+(G?'復旧 > 原因究明':'Recovery > Root cause analysis')+'\n\n';
doc34+=(G?'緩和策の例:':'Mitigation examples:')+'\n';
doc34+='- '+(G?'ロールバック: 直近デプロイが原因の場合':'Rollback: If caused by recent deploy')+'\n';
doc34+='- '+(G?'スケールアップ: リソース不足の場合':'Scale up: If resource exhaustion')+'\n';
doc34+='- '+(G?'機能無効化: 特定機能が原因の場合':'Disable feature: If specific feature causes issue')+'\n';
doc34+='- '+(G?'キャッシュクリア: データ不整合の場合':'Clear cache: If data inconsistency')+'\n';
doc34+='- '+(G?'手動データ修正: DB不整合の場合':'Manual data fix: If DB inconsistency')+'\n\n';
doc34+=(G?'### 4. 根本原因分析 (Root Cause Analysis)':'### 4. Root Cause Analysis')+'\n\n';
doc34+=(G?'復旧後に実施:':'After recovery:')+'\n';
doc34+='- **'+(G?'ログ分析':'Log Analysis')+'**: docs/25_error_logs.md'+(G?'に記録':'に記録')+'\n';
doc34+='- **5 Whys**: '+(G?'根本原因まで深掘り':'Dig deep until root cause')+'\n';
doc34+='- **'+(G?'タイムライン作成':'Timeline')+'**: '+(G?'発生→検知→対応→復旧の時系列':'Occurrence → Detection → Response → Recovery')+'\n\n';
doc34+=(G?'### 5. 再発防止 (Prevention)':'### 5. Prevention')+'\n\n';
doc34+='- **'+(G?'修正チケット作成':'Fix Ticket')+'**: .spec/tasks.md'+(G?'に追加':'に追加')+'\n';
doc34+='- **'+(G?'監視追加':'Add Monitoring')+'**: '+(G?'同様の障害を早期検知できるアラート追加':'Add alerts to detect similar issues early')+'\n';
doc34+='- **'+(G?'テスト追加':'Add Tests')+'**: docs/33_test_matrix.md'+(G?'にリグレッションテスト追加':'に追加')+'\n';
doc34+='- **'+(G?'ドキュメント更新':'Update Docs')+'**: '+(G?'本プレイブックに新たな対処法追加':'Add new procedures to this playbook')+'\n\n';
// Escalation Matrix
doc34+=(G?'## エスカレーションマトリクス':'## Escalation Matrix')+'\n\n';
doc34+='| Severity | '+ (G?'初動（分）':'Initial (min)')+' | '+(G?'エスカレーション（分）':'Escalation (min)')+' | '+(G?'通知先':'Notify')+' |\n';
doc34+='|----------|------|------|------|\n';
doc34+='| S1 🔴 | 15 | 30 | '+(G?'CTO + 全エンジニア':'CTO + All engineers')+' |\n';
doc34+='| S2 🟠 | 60 | 120 | '+(G?'テックリード + 該当チーム':'Tech lead + Relevant team')+' |\n';
doc34+='| S3 🟡 | 1440 (24h) | - | '+(G?'担当者のみ':'Assignee only')+' |\n';
doc34+='| S4 🟢 | - | - | '+(G?'次回計画会議で':'Next planning meeting')+' |\n\n';
// Post-Mortem Template
doc34+=(G?'## ポストモーテムテンプレート':'## Post-Mortem Template')+'\n\n';
doc34+='```markdown\n';
doc34+='# '+(G?'ポストモーテム: [障害タイトル]':'Post-Mortem: [Incident Title]')+'\n\n';
doc34+='**'+(G?'発生日時':'Date')+'**: YYYY-MM-DD HH:MM\n';
doc34+='**Severity**: S1/S2/S3/S4\n';
doc34+='**'+(G?'影響':'Impact')+'**: '+(G?'影響を受けたユーザー数・機能':'Affected users, features')+'\n';
doc34+='**'+(G?'検知→復旧時間':'Detection to Recovery')+'**: XX'+(G?'分':'min')+'\n\n';
doc34+='## '+(G?'何が起きたか':'What Happened')+'\n'+(G?'障害の概要を1-2文で':'1-2 sentence summary')+'\n\n';
doc34+='## '+(G?'タイムライン':'Timeline')+'\n';
doc34+='- HH:MM - '+(G?'障害発生':'Incident occurred')+'\n';
doc34+='- HH:MM - '+(G?'アラート検知':'Alert detected')+'\n';
doc34+='- HH:MM - '+(G?'対応開始':'Response started')+'\n';
doc34+='- HH:MM - '+(G?'復旧完了':'Recovery completed')+'\n\n';
doc34+='## '+(G?'根本原因':'Root Cause')+'\n'+(G?'5 Whysの結果':'Result of 5 Whys')+'\n\n';
doc34+='## '+(G?'再発防止策':'Prevention Measures')+'\n';
doc34+='- [ ] '+(G?'アクションアイテム1':'Action item 1')+'\n';
doc34+='- [ ] '+(G?'アクションアイテム2':'Action item 2')+'\n';
doc34+='```\n\n';
// Domain-Specific Runbooks
const domainPlaybook=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
if(domainPlaybook&&domainPlaybook.prevent_ja){
doc34+=(G?'## ドメイン固有の注意事項 ('+domain+')':'## Domain-Specific Notes ('+domain+')')+'\n\n';
const preventList=G?domainPlaybook.prevent_ja:domainPlaybook.prevent_en;
preventList.forEach((p,i)=>{
doc34+=(i+1)+'. '+p+'\n';
});
doc34+='\n';
}

// Link to error logs
doc34+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc34+='- **docs/25_error_logs.md** — '+(G?'過去の障害記録':'Past incident records')+'\n';
doc34+='- **docs/37_bug_prevention.md** — '+(G?'バグ予防チェックリスト':'Bug prevention checklist')+'\n';
doc34+='- **.spec/verification.md** — '+(G?'リリース前検証手順':'Pre-release verification')+'\n\n';
S.files['docs/34_incident_response.md']=doc34;
// ═══ B3: docs/36_test_strategy.md (~12KB) ═══
let doc36='# '+(G?'フェーズ別テスト戦略':'Phase-Based Testing Strategy')+'\n\n';
doc36+=G?'**重要**: このドキュメントは開発フェーズごとのテスト戦略を定義します。各フェーズで必要なテストを実施し、品質を段階的に向上させてください。\n\n':'**IMPORTANT**: This document defines testing strategies for each development phase. Execute required tests at each phase to progressively improve quality.\n\n';
// Phase 1: Design Review
doc36+=(G?'## Phase 1: 設計レビュー':'## Phase 1: Design Review')+'\n\n';
doc36+=(G?'**目的**: 実装前に設計の整合性とセキュリティリスクを検証':'**Purpose**: Verify design consistency and security risks before implementation')+'\n\n';
doc36+='### 1.1 '+(G?'.spec/ 整合性チェック':'.spec/ Consistency Check')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] constitution.md ⇔ specification.md '+(G?'の機能一致':'feature alignment')+'\n';
doc36+='- [ ] specification.md ⇔ technical-plan.md '+(G?'のスタック一致':'stack alignment')+'\n';
doc36+='- [ ] tasks.md '+(G?'の全タスクがspecに対応':'all tasks map to spec')+'\n';
doc36+='- [ ] verification.md '+(G?'の検証項目が全機能をカバー':'verification covers all features')+'\n\n';
doc36+='### 1.2 ER'+(G?'図検証':'Diagram Verification')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] '+(G?'全エンティティがdata_entitiesに存在':'All entities exist in data_entities')+'\n';
doc36+='- [ ] FK'+(G?'参照先が全て定義済み':'references are all defined')+'\n';
doc36+='- [ ] '+(G?'循環参照がない':'No circular references')+'\n';
doc36+='- [ ] '+(G?'孤立エンティティがない':'No orphaned entities')+'\n\n';
doc36+='### 1.3 '+(G?'セキュリティ脅威モデル':'Security Threat Modeling')+'\n\n';
doc36+='**'+(G?'実施内容':'Activities')+'**:\n';
doc36+='- **STRIDE'+(G?'分析':'Analysis')+'**: '+(G?'なりすまし・改ざん・否認・情報漏洩・DoS・権限昇格':'Spoofing, Tampering, Repudiation, Info disclosure, DoS, Elevation')+'\n';
doc36+='- **OWASP Top 10**: docs/08_security.md '+(G?'と照合':'check against')+'\n';
doc36+='- **'+(G?'データフロー図':'Data Flow Diagram')+'**: '+(G?'機密データの経路確認':'Verify sensitive data paths')+'\n\n';
// Phase 2: Integration Testing
doc36+=(G?'## Phase 2: 統合テスト':'## Phase 2: Integration Testing')+'\n\n';
doc36+=(G?'**目的**: API・認証・データフローの統合動作を検証':'**Purpose**: Verify integrated behavior of API, auth, and data flows')+'\n\n';
doc36+='### 2.1 API'+(G?'コントラクトテスト':'Contract Testing')+'\n\n';
doc36+='**'+(G?'ツール':'Tool')+'**: '+( tools.find(t=>t.includes('Pact')||t.includes('契約'))||'Pact / Contract tests')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] '+(G?'全エンドポイントがdocs/05_api_design.mdに存在':'All endpoints exist in docs/05_api_design.md')+'\n';
doc36+='- [ ] '+(G?'リクエスト・レスポンススキーマ一致':'Request/response schema match')+'\n';
doc36+='- [ ] '+(G?'エラーコードが仕様通り':'Error codes match spec')+'\n\n';
const authBackend=a.backend||'';
const authFlow=authBackend.includes('Supabase')?'Supabase Auth':authBackend.includes('Firebase')?'Firebase Auth':'Auth.js';
doc36+='### 2.2 '+(G?'認証フローテスト ('+authFlow+')':'Auth Flow Testing ('+authFlow+')')+'\n\n';
doc36+='**'+(G?'テストケース':'Test Cases')+'**:\n';
doc36+='- [ ] '+(G?'サインアップ → メール確認 → ログイン':'Signup → Email verify → Login')+'\n';
doc36+='- [ ] '+(G?'パスワードリセット':'Password reset')+'\n';
doc36+='- [ ] '+(G?'トークン有効期限切れ → リフレッシュ':'Token expiry → Refresh')+'\n';
if(authBackend.includes('Supabase')){
doc36+='- [ ] RLS'+(G?'ポリシーが全テーブルで動作':'policies work on all tables')+'\n';
}
doc36+='- [ ] '+(G?'不正トークンでアクセス拒否':'Invalid token → Access denied')+'\n\n';
doc36+='### 2.3 '+(G?'データ整合性テスト':'Data Integrity Testing')+'\n\n';
doc36+='**'+(G?'検証項目':'Checks')+'**:\n';
doc36+='- [ ] FK'+(G?'違反時にエラー':'violation → Error')+'\n';
doc36+='- [ ] UNIQUE'+(G?'制約違反時にエラー':'constraint violation → Error')+'\n';
doc36+='- [ ] '+(G?'カスケード削除が正しく動作':'Cascade delete works correctly')+'\n';
doc36+='- [ ] '+(G?'トランザクション失敗時にロールバック':'Transaction failure → Rollback')+'\n\n';
// Phase 3: Pre-Release Testing
doc36+=(G?'## Phase 3: リリース前テスト':'## Phase 3: Pre-Release Testing')+'\n\n';
doc36+=(G?'**目的**: 本番環境で発生しうる問題を事前検出':'**Purpose**: Detect issues that could occur in production')+'\n\n';
doc36+='### 3.1 E2E'+(G?'シナリオテスト':'Scenario Testing')+'\n\n';
doc36+='**'+(G?'ツール':'Tool')+'**: '+(tools.find(t=>t.includes('Playwright')||t.includes('Cypress'))||'Playwright / Cypress')+'\n\n';
doc36+='**'+(G?'主要シナリオ':'Critical Scenarios')+'**:\n';
features.slice(0,5).forEach((f,i)=>{
doc36+=(i+1)+'. '+f+' '+(G?'の完全フロー':'complete flow')+'\n';
});
doc36+='\n';
doc36+='### 3.2 '+(G?'並行性テスト':'Concurrency Testing')+'\n\n';
doc36+='**'+(G?'シナリオ':'Scenarios')+'**:\n';
// Domain-specific concurrency scenarios
if(domain==='ec'||domain==='marketplace'){
doc36+='- [ ] '+(G?'最後の1個問題: 2人が同時に最後の在庫を購入':'Last item problem: 2 users buy last stock simultaneously')+'\n';
}
if(domain==='fintech'){
doc36+='- [ ] '+(G?'二重送金: 同一送金リクエストを2回送信':'Double payment: Send same payment request twice')+'\n';
}
if(domain==='booking'||domain==='realestate'){
doc36+='- [ ] '+(G?'ダブルブッキング: 同一時間帯に2件予約':'Double booking: 2 bookings for same time slot')+'\n';
}
doc36+='- [ ] '+(G?'楽観的ロック: バージョン競合時の処理':'Optimistic lock: Version conflict handling')+'\n';
doc36+='- [ ] '+(G?'デッドロック: 複数トランザクション衝突':'Deadlock: Multiple transaction collision')+'\n\n';
doc36+='### 3.3 '+(G?'パフォーマンスベンチマーク':'Performance Benchmarking')+'\n\n';
doc36+='**'+(G?'ツール':'Tool')+'**: k6 / Artillery / Locust\n\n';
doc36+='**'+(G?'ベンチマーク目標':'Benchmark Targets')+'**:\n';
doc36+='- **'+(G?'レスポンスタイム':'Response Time')+'**: P95 ≤ 500ms\n';
doc36+='- **'+(G?'スループット':'Throughput')+'**: ≥ 100 req/sec\n';
doc36+='- **'+(G?'同時接続':'Concurrent Users')+'**: 1000+ '+(G?'ユーザーで安定':'users stable')+'\n';
doc36+='- **'+(G?'エラー率':'Error Rate')+'**: ≤ 0.1%\n\n';
// Phase 4: Post-Release Monitoring
doc36+=(G?'## Phase 4: リリース後監視':'## Phase 4: Post-Release Monitoring')+'\n\n';
doc36+=(G?'**目的**: 本番環境での異常を早期検知':'**Purpose**: Early detection of anomalies in production')+'\n\n';
doc36+='### 4.1 '+(G?'インシデント検知閾値':'Incident Detection Thresholds')+'\n\n';
doc36+='| '+(G?'メトリクス':'Metric')+' | '+(G?'警告':'Warning')+' | '+(G?'重大':'Critical')+' |\n';
doc36+='|----------|----------|----------|\n';
doc36+='| '+(G?'エラー率':'Error Rate')+' | >1% | >5% |\n';
doc36+='| P95 '+(G?'レスポンス':'Response')+' | >1s | >3s |\n';
doc36+='| CPU'+(G?'使用率':'Usage')+' | >70% | >90% |\n';
doc36+='| '+(G?'メモリ':'Memory')+' | >80% | >95% |\n';
doc36+='| DB'+(G?'接続数':'Connections')+' | >80% | >95% |\n\n';
doc36+='### 4.2 '+(G?'回帰アラート':'Regression Alerts')+'\n\n';
doc36+='**'+(G?'監視項目':'Monitor')+'**:\n';
doc36+='- **'+(G?'エラースパイク':'Error Spike')+'**: '+(G?'直近1時間のエラー数が前週平均の3倍':'Errors in last hour >3x weekly average')+'\n';
doc36+='- **'+(G?'レイテンシ劣化':'Latency Degradation')+'**: P95 '+(G?'が前日比1.5倍':'is 1.5x vs yesterday')+'\n';
doc36+='- **'+(G?'コンバージョン低下':'Conversion Drop')+'**: '+(G?'主要KPIが前週比20%低下':'Key KPI down 20% vs last week')+'\n\n';
doc36+='### 4.3 '+(G?'ドメイン別監視 ('+domain+')':'Domain-Specific Monitoring ('+domain+')')+'\n\n';
// Domain-specific monitoring
if(domain==='ec'||domain==='marketplace'){
doc36+='- **'+(G?'決済成功率':'Payment Success Rate')+'**: ≥98%\n';
doc36+='- **'+(G?'カゴ落ち率':'Cart Abandonment')+'**: ≤30%\n';
}else if(domain==='fintech'){
doc36+='- **'+(G?'取引処理時間':'Transaction Processing Time')+'**: ≤2s\n';
doc36+='- **'+(G?'残高不整合':'Balance Inconsistency')+'**: 0 件/日\n';
}else if(domain==='booking'||domain==='realestate'){
doc36+='- **'+(G?'予約重複':'Booking Duplicates')+'**: 0 件/日\n';
doc36+='- **'+(G?'通知到達率':'Notification Delivery')+'**: ≥95%\n';
}else if(domain==='iot'){
doc36+='- **'+(G?'デバイス接続率':'Device Connection Rate')+'**: ≥99%\n';
doc36+='- **'+(G?'データ欠損':'Data Loss')+'**: ≤0.1%\n';
}else{
doc36+='- **'+(G?'主要機能可用性':'Core Feature Availability')+'**: ≥99.9%\n';
doc36+='- **'+(G?'ユーザーエラー報告':'User Error Reports')+'**: '+(G?'月次トレンド監視':'Monitor monthly trend')+'\n';
}
doc36+='\n';
// ── KPI Regression Testing (P5-P10 Feedback Loop) ──
doc36+='### 4.4 '+(G?'KPIリグレッションテスト':'KPI Regression Testing')+'\n\n';
doc36+=(G?'**重要**: docs/29_reverse_engineering.md で定義されたゴールKPIを継続的に監視し、リリース後もゴール達成度を追跡してください。\n\n':'**IMPORTANT**: Continuously monitor goal KPIs defined in docs/29_reverse_engineering.md and track goal achievement post-release.\n\n');
// Access REVERSE_FLOW_MAP if available (loaded from p10-reverse.js)
if(typeof REVERSE_FLOW_MAP!=='undefined'){
const flowMap=REVERSE_FLOW_MAP[domain]||REVERSE_FLOW_MAP._default;
const kpis=G?flowMap.kpi_ja:flowMap.kpi_en;
doc36+='**'+(G?'監視対象KPI':'KPIs to Monitor')+'** ('+(G?'docs/29から':'from docs/29')+'):\n';
kpis.forEach((kpi,i)=>{
doc36+=(i+1)+'. '+kpi+'\n';
});
doc36+='\n';
}else{
// Fallback if REVERSE_FLOW_MAP not available
doc36+='**'+(G?'監視対象KPI':'KPIs to Monitor')+'**: '+(G?'docs/29_reverse_engineering.md 参照':'See docs/29_reverse_engineering.md')+'\n\n';
}

doc36+='**'+(G?'テスト頻度':'Test Frequency')+'**: '+(G?'週次':'Weekly')+'\n';
doc36+='**'+(G?'アラート条件':'Alert Condition')+'**: '+(G?'目標値から20%以上乖離':'Deviation >20% from target')+'\n';
doc36+='**'+(G?'対応フロー':'Response Flow')+'**:\n';
doc36+='1. '+(G?'KPI乖離検出 → docs/25_error_logs.md に記録':'KPI deviation detected → Log in docs/25_error_logs.md')+'\n';
doc36+='2. '+(G?'原因分析 (5 Whys) → 根本原因特定':'Root cause analysis (5 Whys)')+'\n';
doc36+='3. '+(G?'改善施策実施 → docs/30_goal_decomposition.md のギャップマトリクス更新':'Implement improvements → Update gap matrix in docs/30_goal_decomposition.md')+'\n';
doc36+='4. '+(G?'効果測定 → KPI回復確認':'Measure impact → Verify KPI recovery')+'\n\n';
doc36+='**'+(G?'相互参照':'Cross-References')+'**:\n';
doc36+='- **docs/29_reverse_engineering.md** — '+(G?'ゴールKPI定義':'Goal KPI definitions')+'\n';
doc36+='- **docs/30_goal_decomposition.md** — '+(G?'ギャップ分析マトリクス':'Gap analysis matrix')+'\n';
doc36+='- **docs/24_progress.md** — '+(G?'進捗トラッキング':'Progress tracking')+'\n\n';
// Stack-Specific Tool Configuration
doc36+=(G?'## スタック別ツール設定':'## Stack-Specific Tool Configuration')+'\n\n';
const testTool=tools.find(t=>t.includes('Vitest'))?'Vitest':tools.find(t=>t.includes('Jest'))?'Jest':'Vitest';
const e2eTool=tools.find(t=>t.includes('Playwright'))?'Playwright':tools.find(t=>t.includes('Cypress'))?'Cypress':'Playwright';
doc36+='### '+testTool+' '+(G?'設定':'Configuration')+'\n\n';
doc36+='```javascript\n';
doc36+='// vitest.config.js / jest.config.js\n';
doc36+='export default {\n';
doc36+=' coverage: {\n';
doc36+=' provider: \'v8\',\n';
doc36+=' reporter: [\'text\', \'json\', \'html\'],\n';
doc36+=' lines: 80,\n';
doc36+=' functions: 85,\n';
doc36+=' branches: 70,\n';
doc36+=' statements: 80,\n';
doc36+=' },\n';
doc36+=' testTimeout: 10000,\n';
doc36+='};\n```\n\n';
doc36+='### '+e2eTool+' '+(G?'設定':'Configuration')+'\n\n';
doc36+='```javascript\n';
if(e2eTool==='Playwright'){
doc36+='// playwright.config.js\n';
doc36+='export default {\n';
doc36+=' testDir: \'./e2e\',\n';
doc36+=' timeout: 30000,\n';
doc36+=' retries: process.env.CI ? 2 : 0,\n';
doc36+=' use: {\n';
doc36+=' baseURL: process.env.BASE_URL || \'http://localhost:3000\',\n';
doc36+=' trace: \'on-first-retry\',\n';
doc36+=' },\n';
doc36+='};\n';
}else{
doc36+='// cypress.config.js\n';
doc36+='export default {\n';
doc36+=' e2e: {\n';
doc36+=' baseUrl: \'http://localhost:3000\',\n';
doc36+=' video: false,\n';
doc36+=' screenshotOnRunFailure: true,\n';
doc36+=' },\n';
doc36+='};\n';
}
doc36+='```\n\n';
// Related Documents
doc36+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc36+='- **docs/07_test_cases.md** — '+(G?'テストケース詳細':'Detailed test cases')+'\n';
doc36+='- **docs/33_test_matrix.md** — '+(G?'具体的テスト例':'Concrete test examples')+'\n';
doc36+='- **docs/37_bug_prevention.md** — '+(G?'バグ予防チェックリスト':'Bug prevention checklist')+'\n';
doc36+='- **.spec/verification.md** — '+(G?'リリース前検証':'Pre-release verification')+'\n\n';
S.files['docs/36_test_strategy.md']=doc36;
// ═══ B4: docs/37_bug_prevention.md (~8KB) ═══
let doc37='# '+(G?'バグ予防チェックリスト':'Bug Prevention Checklist')+'\n\n';
doc37+=G?'**重要**: このチェックリストは、実装・レビュー・テスト時に必ず確認すべき項目をリスト化しています。見落としを防ぎ、品質を向上させるために活用してください。\n\n':'**IMPORTANT**: This checklist lists items that MUST be verified during implementation, review, and testing. Use this to prevent oversights and improve quality.\n\n';
// Priority-Ordered Checklist (based on INDUSTRY_TEST_MATRIX.priority)
doc37+=(G?'## 優先度順チェックリスト ('+domain+'に最適化)':'## Priority-Ordered Checklist (Optimized for '+domain+')')+'\n\n';
const priorityOrder=['Security','DataIntegrity','Performance','UX','Compliance'];
const domainPriority={};
tm.priority.split('|').forEach(p=>{
const[k,v]=p.split(':');
domainPriority[k]=v;
});
// Sort by priority (CRITICAL > HIGH > MED > LOW)
const sortedPriorities=priorityOrder.sort((a,b)=>{
const order={CRITICAL:0,HIGH:1,MED:2,LOW:3};
return order[domainPriority[a]||'MED']-order[domainPriority[b]||'MED'];
});
sortedPriorities.forEach((cat,idx)=>{
const priority=domainPriority[cat]||'MED';
const icon=priority==='CRITICAL'||priority==='HIGH'?'🔴':(priority==='MED'?'🟡':'🟢');
const label={
Security:G?'セキュリティ':'Security',
DataIntegrity:G?'データ整合性':'Data Integrity',
Performance:G?'パフォーマンス':'Performance',
UX:'UX',
Compliance:G?'コンプライアンス':'Compliance'
}[cat];
doc37+='### '+(idx+1)+'. '+icon+' '+label+' ('+priority+')\n\n';
if(cat==='Security'){
doc37+='- [ ] '+(G?'ユーザー入力は全てサニタイズ済み':'All user inputs sanitized')+'\n';
doc37+='- [ ] SQL'+(G?'インジェクション対策（ORMのパラメタライズドクエリ使用）':'injection prevention (use ORM parameterized queries)')+'\n';
doc37+='- [ ] XSS'+(G?'対策（出力時エスケープ）':'prevention (escape on output)')+'\n';
doc37+='- [ ] CSRF'+(G?'トークン実装':'token implemented')+'\n';
doc37+='- [ ] '+(G?'認証なしでアクセスできるエンドポイントがない':'No unauthenticated endpoint access')+'\n';
doc37+='- [ ] '+(G?'パスワードはハッシュ化（bcrypt/Argon2）':'Passwords hashed (bcrypt/Argon2)')+'\n';
doc37+='- [ ] '+(G?'環境変数に機密情報なし（.envから読込）':'No secrets in code (load from .env)')+'\n';
}else if(cat==='DataIntegrity'){
doc37+='- [ ] FK'+(G?'制約が全て定義済み':'constraints all defined')+'\n';
doc37+='- [ ] UNIQUE'+(G?'制約が適切に設定':'constraints properly set')+'\n';
doc37+='- [ ] NOT NULL'+(G?'制約が必須フィールドに設定':'constraints on required fields')+'\n';
doc37+='- [ ] '+(G?'トランザクション境界が明確':'Transaction boundaries clear')+'\n';
doc37+='- [ ] '+(G?'楽観的/悲観的ロックが必要箇所に実装':'Optimistic/pessimistic locks where needed')+'\n';
doc37+='- [ ] '+(G?'カスケード削除が意図通り':'Cascade deletes work as intended')+'\n';
}else if(cat==='Performance'){
doc37+='- [ ] N+1'+(G?'クエリ問題がない':'query problem eliminated')+'\n';
doc37+='- [ ] '+(G?'インデックスが検索フィールドに設定':'Indexes on search fields')+'\n';
doc37+='- [ ] '+(G?'ページネーション実装（大量データ対応）':'Pagination for large datasets')+'\n';
doc37+='- [ ] '+(G?'キャッシュ戦略が適切':'Caching strategy appropriate')+'\n';
doc37+='- [ ] '+(G?'画像・動画は最適化済み':'Images/videos optimized')+'\n';
}else if(cat==='UX'){
doc37+='- [ ] '+(G?'ローディング状態表示':'Loading state displayed')+'\n';
doc37+='- [ ] '+(G?'エラーメッセージがユーザーフレンドリー':'User-friendly error messages')+'\n';
doc37+='- [ ] '+(G?'バリデーションメッセージが具体的':'Specific validation messages')+'\n';
doc37+='- [ ] '+(G?'空状態メッセージ（データなし時）':'Empty state message (no data)')+'\n';
doc37+='- [ ] '+(G?'モバイルレスポンシブ':'Mobile responsive')+'\n';
}else if(cat==='Compliance'){
doc37+='- [ ] '+(G?'個人情報取扱い同意取得':'Personal data consent obtained')+'\n';
doc37+='- [ ] '+(G?'データ削除機能実装（GDPR対応）':'Data deletion feature (GDPR)')+'\n';
doc37+='- [ ] '+(G?'アクセスログ記録':'Access logging')+'\n';
doc37+='- [ ] '+(G?'監査証跡完全性':'Audit trail completeness')+'\n';
}
doc37+='\n';
});
// 6-Category Bug Classification
doc37+=(G?'## 6カテゴリバグ分類':'## 6-Category Bug Classification')+'\n\n';
const bugCategories=[
{ja:'機能バグ',en:'Functional',check_ja:'仕様通り動作するか',check_en:'Works as specified'},
{ja:'UI/UXバグ',en:'UI/UX',check_ja:'見た目・操作性に問題ないか',check_en:'Appearance and usability OK'},
{ja:'データバグ',en:'Data',check_ja:'データ不整合・消失がないか',check_en:'No data inconsistency or loss'},
{ja:'パフォーマンスバグ',en:'Performance',check_ja:'レスポンス時間が許容範囲か',check_en:'Response time acceptable'},
{ja:'セキュリティバグ',en:'Security',check_ja:'脆弱性がないか',check_en:'No vulnerabilities'},
{ja:'統合バグ',en:'Integration',check_ja:'外部サービス連携が正常か',check_en:'External service integration OK'}
];
bugCategories.forEach((cat,i)=>{
const label=G?cat.ja:cat.en;
const check=G?cat.check_ja:cat.check_en;
doc37+='### '+(i+1)+'. '+label+'\n';
doc37+='**'+(G?'チェック':'Check')+'**: '+check+'\n';
doc37+='**'+(G?'検出方法':'Detection')+'**: ';
if(i<2){
doc37+=G?'単体テスト・E2Eテスト':'Unit tests, E2E tests';
}else if(i<4){
doc37+=G?'統合テスト・手動検証':'Integration tests, manual verification';
}else{
doc37+=G?'静的解析・ペネトレーションテスト':'Static analysis, penetration tests';
}
doc37+='\n';
doc37+='**'+(G?'予防策':'Prevention')+'**: ';
if(i<2){
doc37+=G?'仕様レビュー・プロトタイプ検証':'Spec review, prototype validation';
}else if(i<4){
doc37+=G?'コードレビュー・TDD実践':'Code review, TDD practice';
}else{
doc37+=G?'セキュリティガイドライン遵守':'Follow security guidelines';
}
doc37+='\n\n';
});
// Concurrency Scenarios (Domain-Specific)
doc37+=(G?'## 並行性シナリオ ('+domain+'特化)':'## Concurrency Scenarios ('+domain+'-Specific)')+'\n\n';
if(domain==='ec'||domain==='marketplace'){
doc37+='### 1. '+(G?'最後の1個問題':'Last Item Problem')+'\n';
doc37+='**'+(G?'シナリオ':'Scenario')+'**: '+(G?'在庫1個の商品に2人が同時に購入ボタンをクリック':'2 users click buy on item with stock=1 simultaneously')+'\n';
doc37+='**'+(G?'期待動作':'Expected')+'**: '+(G?'1人は成功、1人は在庫切れエラー':'1 succeeds, 1 gets out-of-stock error')+'\n';
doc37+='**'+(G?'実装方法':'Implementation')+'**: '+(G?'楽観的ロック or SELECT FOR UPDATE':'Optimistic lock or SELECT FOR UPDATE')+'\n\n';
}
if(domain==='fintech'){
doc37+='### 2. '+(G?'二重送金問題':'Double Payment Problem')+'\n';
doc37+='**'+(G?'シナリオ':'Scenario')+'**: '+(G?'同一送金リクエストを短時間に2回送信':'Send same payment request twice in short interval')+'\n';
doc37+='**'+(G?'期待動作':'Expected')+'**: '+(G?'1回のみ実行、2回目は重複エラー':'Execute once, 2nd returns duplicate error')+'\n';
doc37+='**'+(G?'実装方法':'Implementation')+'**: '+(G?'冪等性キー（idempotency key）':'Idempotency key')+'\n\n';
}
if(domain==='booking'||domain==='realestate'){
doc37+='### 3. '+(G?'ダブルブッキング問題':'Double Booking Problem')+'\n';
doc37+='**'+(G?'シナリオ':'Scenario')+'**: '+(G?'同一時間帯に2件の予約が同時に作成される':'2 bookings for same time slot created simultaneously')+'\n';
doc37+='**'+(G?'期待動作':'Expected')+'**: '+(G?'1件は成功、1件は時間帯重複エラー':'1 succeeds, 1 gets time slot conflict error')+'\n';
doc37+='**'+(G?'実装方法':'Implementation')+'**: '+(G?'UNIQUE制約 (service_id, time_slot) + トランザクション':'UNIQUE constraint (service_id, time_slot) + transaction')+'\n\n';
}else{
doc37+='### '+(G?'一般的な並行性問題':'General Concurrency Issues')+'\n';
doc37+='- **'+(G?'データ競合':'Race Condition')+'**: '+(G?'トランザクション分離レベル設定':'Set transaction isolation level')+'\n';
doc37+='- **'+(G?'デッドロック':'Deadlock')+'**: '+(G?'ロック順序を統一':'Unify lock order')+'\n';
doc37+='- **'+(G?'Lost Update':'Lost Update')+'**: '+(G?'楽観的ロックで防止':'Prevent with optimistic lock')+'\n\n';
}

// 7 Common Oversights
doc37+=(G?'## 7つの見落としやすい項目':'## 7 Common Oversights')+'\n\n';
doc37+='### 1. '+(G?'タイムゾーン':'Timezone')+'\n';
doc37+='- [ ] '+(G?'DBにUTC保存、表示時にユーザータイムゾーンで変換':'Store in DB as UTC, convert to user timezone on display')+'\n';
doc37+='- [ ] '+(G?'日時計算はライブラリ使用（date-fns/dayjs）':'Use library for date calculations (date-fns/dayjs)')+'\n\n';
doc37+='### 2. Unicode/Emoji\n';
doc37+='- [ ] VARCHAR'+(G?'サイズは文字数ではなくバイト数で考慮':'size in bytes, not characters')+'\n';
doc37+='- [ ] '+(G?'絵文字対応（utf8mb4）':'Emoji support (utf8mb4)')+'\n\n';
doc37+='### 3. '+(G?'並行変更':'Concurrent Modification')+'\n';
doc37+='- [ ] '+(G?'同一データを2人が同時編集→Last Write Wins問題':'2 users edit same data → Last Write Wins problem')+'\n';
doc37+='- [ ] '+(G?'バージョンカラムで楽観的ロック':'Optimistic lock with version column')+'\n\n';
doc37+='### 4. '+(G?'ファイルアップロード':'File Upload')+'\n';
doc37+='- [ ] '+(G?'ファイルサイズ制限':'File size limit')+'\n';
doc37+='- [ ] '+(G?'MIMEタイプ検証':'MIME type validation')+'\n';
doc37+='- [ ] '+(G?'ファイル名サニタイズ':'Filename sanitization')+'\n';
doc37+='- [ ] '+(G?'ウイルススキャン（本番推奨）':'Virus scan (recommended in prod)')+'\n\n';
doc37+='### 5. '+(G?'レート制限':'Rate Limiting')+'\n';
doc37+='- [ ] API'+(G?'エンドポイントにレート制限実装':'rate limiting on endpoints')+'\n';
doc37+='- [ ] '+(G?'ログイン試行回数制限（ブルートフォース対策）':'Login attempt limit (brute force prevention)')+'\n\n';
doc37+='### 6. '+(G?'メール配信':'Email Delivery')+'\n';
doc37+='- [ ] '+(G?'送信失敗時のリトライ':'Retry on delivery failure')+'\n';
doc37+='- [ ] '+(G?'送信履歴記録':'Record delivery history')+'\n';
doc37+='- [ ] '+(G?'スパム判定されない設定（SPF/DKIM）':'SPF/DKIM to avoid spam')+'\n\n';
doc37+='### 7. '+(G?'ブラウザストレージ':'Browser Storage')+'\n';
doc37+='- [ ] localStorage'+(G?'に機密情報保存しない':'no sensitive data')+'\n';
doc37+='- [ ] '+(G?'容量上限（5-10MB）を考慮':'Consider quota (5-10MB)')+'\n';
doc37+='- [ ] '+(G?'ユーザーが削除できる仕組み':'User can clear data')+'\n\n';
// Related Documents
doc37+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc37+='- **docs/32_qa_blueprint.md** — '+(G?'業種別QA戦略':'Industry-specific QA strategy')+'\n';
doc37+='- **docs/33_test_matrix.md** — '+(G?'具体的テストマトリクス':'Concrete test matrix')+'\n';
doc37+='- **docs/36_test_strategy.md** — '+(G?'フェーズ別テスト戦略':'Phase-based testing strategy')+'\n';
doc37+='- **docs/34_incident_response.md** — '+(G?'インシデント対応':'Incident response')+'\n\n';
S.files['docs/37_bug_prevention.md']=doc37;
}
/* ── Pillar ⑦ Roadmap (9 files) — uses GT (gen-templates.js) — Phase B ── */
function genPillar7_Roadmap(a,pn){
const T=k=>(GT[S.genLang]||GT.en)[k]||GT.en[k]||k;
const level=a.skill_level||'Intermediate';const goal=a.learning_goal||(S.genLang==='ja'?'6ヶ月標準':'6-month standard');
const fe=a.frontend||'React + Next.js';const be=a.backend||'Node.js + Express';
const mob=a.mobile||T('none');const ai=a.ai_auto||T('none');const pay=a.payment||T('none');
const noMob=mob===GT.ja.none||mob===GT.en.none;const noAI=ai===GT.ja.none||ai===GT.en.none;const noPay=pay===GT.ja.none||pay===GT.en.none;
const isB=level.includes('Beginner');const isP=level.includes('Professional');
const _auth=resolveAuth(a);const _arch=resolveArch(a);
const _orm=_arch.isBaaS?(be.includes('Supabase')?'Supabase Client':be.includes('Firebase')?'Firebase SDK':'Convex'):(a.orm&&a.orm.includes('Drizzle')?'Drizzle ORM':'Prisma ORM');
const months=goal.includes('3')?3:goal.includes('12')?12:6;
const slug=pn.toLowerCase().replace(/[^a-z0-9]/g,'-');
/* ── 1. LEARNING_PATH.md ── */
S.files['roadmap/LEARNING_PATH.md']=`# ${pn} — ${T('lp_title')}
> ${T('lp_skill')}: ${level} | ${T('lp_target')}: ${goal} | Generated by DevForge v9
## Layer 1: ${T('l1')} ${isB?'[Month 1-2]':'[Week 1-2]'}
${isB?`- [ ] ${T('html5b')}\n- [ ] ${T('css3b')}\n- [ ] ${T('jsb')}`:`- [ ] ${T('tsAdv')}\n- [ ] ${T('cssAdv')}`}
## Layer 2: ${T('l2')} [${isB?'Month 3-4':'Month 1-2'}]
- [ ] ${fe} ${T('setup')}
- [ ] Tailwind CSS + shadcn/ui
- [ ] ${T('stMgmt')} (Zustand/Redux)
- [ ] React Query (${T('dataFetch')})
- [ ] ${T('testing')} (Vitest + Playwright)
## Layer 3: ${T('l3')} [${isB?'Month 5-6':'Month 2-3'}]
- [ ] ${be} ${T('setup')}
- [ ] ${T('dbDesign')} + ${_orm}
- [ ] REST API / GraphQL
- [ ] ${T('auth')} (${_auth.sot})
${!noMob?`\n## Layer 3.5: ${T('l3m')} [Month ${isB?7:4}-${isB?8:5}]\n- [ ] ${mob} ${T('mobEnv')}\n- [ ] ${T('mobNav')}\n- [ ] ${T('mobNative')}\n- [ ] ${T('mobStore')}\n`:''}
## Layer 4: DevOps [${isB?'Month '+(noMob?7:9):'Month '+(noMob?4:6)}]
- [ ] Docker + DevContainer
- [ ] GitHub Actions CI/CD
- [ ] ${a.deploy||'Vercel'} ${T('deploy')}
- [ ] ${T('monitor')}
## Layer 5: ${T('l5')} [${isB?'Month '+(noMob?8:10):'Month '+(noMob?5:7)}]
- [ ] ${(a.ai_tools||'Cursor').split(', ')[0]} ${T('aiUse')}
- [ ] ${T('mcpCfg')}
- [ ] ${T('aiOpt')}
${!noAI?`- [ ] ${ai} ${T('practice')}\n`:''}${!noPay?`\n## Layer 6: ${T('l6')} [Month ${months-1}-${months}]\n- [ ] ${pay}\n- [ ] ${T('billing')}\n- [ ] ${T('opsScale')}\n`:''}
## Layer 7: ${T('l7')} [${T('l7span')}]
${(a.dev_methods||'TDD').split(', ').map(m=>'- [ ] '+m+' '+T('practice')).join('\n')}
`;
/* ── 2. TECH_STACK_GUIDE.md ── */
const feR=fe.includes('Next')?T('nextR'):fe.includes('Vue')?T('vueR'):T('feGenR');
const beR=be.includes('Supabase')?T('supaR'):be.includes('Express')?T('expR'):be.includes('NestJS')?T('nestR'):T('beGenR');
const dbVal=a.database||'PostgreSQL';
const dbR=dbVal.includes('Postgre')?T('pgR'):T('dbGenR');
const dpVal=a.deploy||'Vercel';
const dpR=dpVal.includes('Vercel')?T('vercelR'):T('deployGenR');
S.files['roadmap/TECH_STACK_GUIDE.md']=`# ${pn} — ${T('ts_title')}
> Generated by DevForge v9
## ${T('ts_selected')}
| ${T('cat')} | ${T('tech')} | ${T('rationale')} |
|---------|------|------|
| ${T('feLabel')} | ${fe} | ${feR} |
| ${T('beLabel')} | ${be} | ${beR} |
| ${T('dbLabel')} | ${dbVal} | ${dbR} |
| ${T('deployLabel')} | ${dpVal} | ${dpR} |
${!noMob?`| ${T('mobileLabel')} | ${mob} | ${mob.includes('Expo')?T('expoR'):T('mobGenR')} |\n`:''}${!noPay?`| ${T('payLabel')} | ${pay} | ${T('payR')} |\n`:''}
## ${T('ts_deps')}
\`\`\`
${fe} ←→ ${be} ←→ ${dbVal}
↓ ↓
Tailwind ${_orm}
↓ ↓
shadcn/ui ${dpVal}
\`\`\`
## ${T('ts_versions')}
- Node.js: 22 LTS
- React: 19+
- Next.js: 15+
- TypeScript: 5.7+
- ${_orm}: ${_arch.isBaaS?"SDK latest":"6+"}
`;
/* ── 3. MOBILE_GUIDE.md ── */
S.files['roadmap/MOBILE_GUIDE.md']=!noMob?`# ${pn} — ${T('mob_title')}
> ${mob} | Generated by DevForge v9
## ${T('mob_env')}
\`\`\`bash
npx create-expo-app ${slug}-mobile --template blank-typescript
cd ${slug}-mobile
npx expo install expo-router expo-camera expo-notifications
\`\`\`
## ${T('mob_dir')}
\`\`\`
app/
├── (tabs)/
│ ├── index.tsx # ${T('mob_home')}
│ ├── explore.tsx # ${T('mob_explore')}
│ └── profile.tsx # ${T('mob_profile')}
├── _layout.tsx # ${T('mob_root')}
└── +not-found.tsx # 404
\`\`\`
## EAS Build${T('mob_eas')}
\`\`\`json
{ "build": { "production": { "distribution": "store" }, "preview": { "distribution": "internal" } } }
\`\`\`
## ${T('mob_libs')}
- NativeWind (Tailwind for RN)
- React Native Reanimated (${T('mob_anim')})
- FlashList (${T('mob_list')})
- Expo Image (${T('mob_img')})
`:`# ${T('mob_title')}\n\n${T('mob_none')}`;
/* ── 4. TOOLS_SETUP.md ── */
const aiTools=(a.ai_tools||'Cursor').split(', ');
const toolLines=aiTools.map(t=>`- **${t}**: ${t==='Cursor'?'https://cursor.sh/':t.includes('Antigravity')?'https://antigravity.google/':t.includes('Claude')?'Claude Code CLI: npm install -g @anthropic-ai/claude-code':t.includes('Aider')?'pip install aider-chat (BYOK)':t.includes('Amazon Q')?T('tool_vsInst')+' / aws.amazon.com/q/developer/':t.includes('Augment')?T('tool_vsInst')+' / augmentcode.com':t.includes('Tabnine')?T('tool_vsInst')+' / tabnine.com':t.includes('OpenRouter')?'https://openrouter.ai/ (API key)':t.includes('Copilot')?T('tool_vsInst'):T('tool_official')}`).join('\n');
S.files['roadmap/TOOLS_SETUP.md']=`# ${pn} — ${T('tool_title')}
> Generated by DevForge v9
## 1. ${T('tool_essential')}
\`\`\`bash
# Node.js (${T('tool_rec')}: v22 LTS)
# https://nodejs.org/
# ${T('tool_pkgmgr')}
npm install -g pnpm
# ${T('tool_init')}
pnpm create next-app ${slug} --typescript --tailwind --eslint
# ${T('tool_docker')}
docker compose up -d
\`\`\`
## 2. ${T('tool_ai')}
${toolLines}
## 3. VS Code ${T('tool_ext')}
- ESLint, Prettier, Tailwind CSS IntelliSense
- ${_arch.isBaaS?(be.includes("Supabase")?"supabase.supabase-vscode":"ms-azuretools.vscode-azurefunctions"):"prisma.prisma"}, GitLens, Error Lens
- GitHub Copilot (${T('tool_used')})
## 4. ${T('tool_env')} (.env.example)
\`\`\`
DATABASE_URL="postgresql://dev:devpass@localhost:5432/${slug.replace(/-/g,'_')}"
NEXTAUTH_SECRET="your-secret-here"
NEXTAUTH_URL="http://localhost:3000"
${pay.includes('Stripe')?'STRIPE_SECRET_KEY="sk_test_..."\nSTRIPE_PUBLISHABLE_KEY="pk_test_..."\nSTRIPE_WEBHOOK_SECRET="whsec_..."':''}
\`\`\`
`;
/* ── 5. RESOURCES.md ── */
S.files['roadmap/RESOURCES.md']=`# ${pn} — ${T('res_title')}
> Generated by DevForge v9
## ${T('res_official')}
${fe.includes('React')?'- [React](https://react.dev/)\n- [Next.js](https://nextjs.org/docs)':''}
${fe.includes('Vue')?'- [Vue 3](https://vuejs.org/)\n- [Nuxt](https://nuxt.com/)':''}
${be.includes('Node')?'- [Node.js](https://nodejs.org/docs/)':''}
${be.includes('Supabase')?'- [Supabase](https://supabase.com/docs)':''}
- [TypeScript](https://www.typescriptlang.org/docs/)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [${_orm}](${_arch.isBaaS?(be.includes("Supabase")?"https://supabase.com/docs":"https://firebase.google.com/docs"):"https://www.prisma.io/docs"})
## ${T('res_ai')}
- [CLAUDE.md ${T('res_bp')}](https://docs.anthropic.com/)
- [Cursor ${T('res_docs')}](https://docs.cursor.com/)
- [MCP ${T('res_proto')}](https://modelcontextprotocol.io/)
${!noAI?`- [Vibe Coding ${T('res_patterns')}](https://vibecoding.dev/)`:''}\
## ${T('res_books')}
- "${T('res_fullstack')}" (${isB?T('res_beg'):T('res_int')})
- "${T('res_tsPractice')}"
- "${(a.dev_methods||'TDD').split(', ')[0]}${T('res_design')}"
${!noPay?`- "${T('res_saas')}"\n- "${T('res_headless')}"`:''}\
`;
/* ── 6. MILESTONES.md ── */
const msLabels=T('ms_m');
S.files['roadmap/MILESTONES.md']=`# ${pn} — ${T('ms_title')}
> ${T('ms_target')}: ${goal} | Generated by DevForge v9
${Array.from({length:months},(_,i)=>`## Month ${i+1}: ${(typeof msLabels==='object'?msLabels:GT.en.ms_m)[Math.min(i,6)]}
- [ ] ${T('ms_criteria')}
- [ ] ${T('ms_review')}
- [ ] ${T('ms_retro')}`).join('\n\n')}
`;
/* ── 7. AI_WORKFLOW.md ── */
S.files['roadmap/AI_WORKFLOW.md']=`# ${pn} — ${T('aiw_title')}
> Generated by DevForge v9
## ${T('aiw_flow')}
\`\`\`
1. ${T('aiw_s1')} → 2. ${T('aiw_s2')} → 3. ${T('aiw_s3')} → 4. ${T('aiw_s4')} → 5. ${T('aiw_s5')} → 6. ${T('aiw_s6')}
\`\`\`
## ${T('aiw_select')}
| ${T('aiw_task')} | ${T('aiw_rec')} | ${T('rationale')} |
|--------|-----------|------|
| ${T('aiw_newfile')} | ${aiTools[0]} | ${T('aiw_ctx')} |
| ${T('aiw_bugfix')} | Claude Code | ${T('aiw_term')} |
| ${T('aiw_testgen')} | GitHub Copilot | ${T('aiw_inline')} |
| ${T('aiw_refactor')} | Cursor | ${T('aiw_multi')} |
## ${T('aiw_mcp')}
1. **context7**: ${T('aiw_mcp1')}
2. **filesystem**: ${T('aiw_mcp2')}
3. **playwright**: ${T('aiw_mcp3')}
## ${T('aiw_prompt')}
### 1. ${T('aiw_addFeature')}
\`\`\`
${T('aiw_promptText')}
\`\`\`
### 2. ${T('aiw_bugfixPrompt')}
\`\`\`
${T('aiw_bugfixText')}
\`\`\`
### 3. ${T('aiw_refactorPrompt')}
\`\`\`
${T('aiw_refactorText')}
\`\`\`
`;
/* ── 8. AI_AUTONOMOUS.md ── */
const aiIsVibe=ai.includes('Vibe');const aiIsMulti=ai.includes('マルチ')||ai.includes('Multi');const aiIsFull=ai.includes('フル')||ai.includes('Full');
S.files['roadmap/AI_AUTONOMOUS.md']=!noAI?`# ${pn} — ${T('aia_title')}
> ${T('aia_level')}: ${ai} | Generated by DevForge v9
## ${T('aia_vibe')}
${T('aia_vibeDesc')}
### ${T('aia_basic')}
1. **${T('aia_f1')}**: ${T('aia_f1ex')}
2. **${T('aia_f2')}**: ${T('aia_f2ex')}
3. **${T('aia_f3')}**: ${T('aia_f3ex')}
4. **${T('aia_f4')}**: ${T('aia_f4ex')}
### ${T('aia_tools')}
${aiIsVibe?`- ${T('aia_vibe1')}\n- ${T('aia_vibe2')}\n- ${T('aia_vibe3')}`:''}
${aiIsMulti?`- ${T('aia_multi1')}\n- ${T('aia_multi2')}\n- ${T('aia_multi3')}`:''}
${aiIsFull?`- ${T('aia_full1')}\n- ${T('aia_full2')}\n- ${T('aia_full3')}\n- ${T('aia_async1')}`:''}
### ${T('aia_bp')}
1. ${T('aia_bp1')}
2. ${T('aia_bp2')}
3. ${T('aia_bp3')}
4. ${T('aia_bp4')}
`:`# ${T('aia_title')}\n\n${T('aia_none')}${aiTools[0]}${T('aia_none2')}`;
/* ── 9. SAAS_COMMERCE_GUIDE.md ── */
S.files['roadmap/SAAS_COMMERCE_GUIDE.md']=!noPay?`# ${pn} — ${T('sc_title')}
> ${T('sc_selected')}: ${pay} | Generated by DevForge v9
## ${T('sc_compare')}
| ${T('sc_platform')} | ${T('sc_rate')} | MoR | ${T('sc_feat')} |
|---------------|------|-----|------|
| Stripe | 2.9%+30¢ | Beta | ${T('sc_stripe')} |
| Paddle | 5%+50¢ | ✅ | ${T('sc_paddle')} |
| Lemon Squeezy (Stripe) | 5%+50¢ | ✅ | ${T('sc_lemon')} |
${pay.includes('Stripe')?`## ${T('sc_impl')}
\`\`\`bash
npm install stripe @stripe/stripe-js
\`\`\`
### Checkout Session
\`\`\`typescript
import Stripe from 'stripe';
const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);
const session = await stripe.checkout.sessions.create({
line_items: [{ price: 'price_xxx', quantity: 1 }],
mode: 'subscription',
success_url: '/success',
cancel_url: '/cancel',
});
\`\`\`
### ${T('sc_webhook')}
\`\`\`typescript
// POST /api/webhooks/stripe
const event = stripe.webhooks.constructEvent(body, sig, secret);
switch(event.type) {
case 'checkout.session.completed': // ${T('sc_paid')}
case 'invoice.paid': // ${T('sc_renew')}
case 'customer.subscription.deleted': // ${T('sc_cancel')}
}
\`\`\`
`:''}${pay.includes('CMS')?`## ${T('sc_cms')} (microCMS)
\`\`\`bash
npm install microcms-js-sdk
\`\`\`
\`\`\`typescript
import { createClient } from 'microcms-js-sdk';
const client = createClient({
serviceDomain: 'your-domain',
apiKey: process.env.MICROCMS_API_KEY!,
});
const data = await client.getList({ endpoint: 'articles' });
\`\`\`
`:''}${pay.includes('EC')?`## ${T('sc_ec')} (Medusa)
\`\`\`bash
npx create-medusa-app@latest
\`\`\`
- ${T('sc_prodMgmt')}: Admin Dashboard
- ${T('sc_payment')}: Stripe Plugin
- ${T('sc_ship')}: ${T('sc_fulfill')}
`:''}
`:`# ${T('sc_title')}\n\n${T('sc_none')}`;
}
/* ═══ Pillar 9: Design System & Sequence Diagrams ═══ */
// Domain-specific color tokens
const _dc=(p,s,ac,cta,sj,se)=>({p,s,ac,cta,sj,se});
const DOMAIN_COLORS={
education:_dc('#4F46E5','#10B981','#F59E0B','#4F46E5','温かみ・信頼・集中','Warm, trustworthy, focus'),
ec:_dc('#EF4444','#F97316','#FCD34D','#EF4444','緊急感・行動促進・CTA強調','Urgency, action-driven, CTA emphasis'),
fintech:_dc('#1E3A5F','#0EA5E9','#10B981','#0EA5E9','信頼性・プロフェッショナル・安定感','Trust, professional, stability'),
health:_dc('#059669','#3B82F6','#E0F2FE','#3B82F6','清潔・信頼・安心感','Clean, trustworthy, reassuring'),
saas:_dc('#7C3AED','#0EA5E9','#F97316','#7C3AED','革新性・信頼性・エネルギー','Innovative, trustworthy, energetic'),
booking:_dc('#0EA5E9','#10B981','#F59E0B','#0EA5E9','開放感・信頼・緊急感','Open, trustworthy, urgency'),
marketplace:_dc('#F97316','#3B82F6','#10B981','#F97316','活気・信頼・安全','Vibrant, trustworthy, safe'),
community:_dc('#8B5CF6','#EC4899','#F59E0B','#8B5CF6','繋がり・楽しさ・創造性','Connection, fun, creativity'),
content:_dc('#1E293B','#3B82F6','#F59E0B','#3B82F6','可読性・集中・専門性','Readability, focus, expertise'),
iot:_dc('#06B6D4','#10B981','#F59E0B','#06B6D4','テクノロジー・清潔・データ','Technology, clean, data'),
realestate:_dc('#1F2937','#D97706','#10B981','#D97706','高級感・信頼・安定','Premium, trustworthy, stable'),
legal:_dc('#1F2937','#4B5563','#1E40AF','#1E40AF','権威・厳格・信頼','Authority, rigor, trust'),
hr:_dc('#7C3AED','#3B82F6','#10B981','#7C3AED','人間性・成長・調和','Humane, growth, harmony'),
portfolio:_dc('#1E293B','#0EA5E9','#F59E0B','#0EA5E9','シンプル・洗練・個性','Simple, refined, personality'),
_default:_dc('#0EA5E9','#6366F1','#F59E0B','#0EA5E9','汎用・バランス・信頼','General, balanced, trustworthy')
};
// Domain-specific visual strategy (effects, layouts, textures)
const _dvs=(ej,ee,lj,le,tj,te)=>({ej,ee,lj,le,tj,te});
const DOMAIN_VISUAL={
ec:_dvs('CTA振動,カウントダウン,在庫カウンタ','CTA pulse,countdown,stock counter','カード型グリッド,スティッキーカート','Card grid,sticky cart','商品画像ズーム,カルーセル,レビュースター','Product zoom,carousel,review stars'),
education:_dvs('進捗バー,ステップインジケータ,コンフェティ','Progress bar,step indicator,confetti','サイドバー型,ダッシュボードレイアウト','Sidebar,dashboard layout','暖色グラデ,ラウンド角,親しみやすいイラスト','Warm gradients,rounded corners,friendly illustrations'),
fintech:_dvs('数値アニメ,チャートトランジション,ステータスバッジ','Number animation,chart transition,status badge','固定ヘッダー,左ナビゲーション','Fixed header,left navigation','ダークUI,モノスペース数字,グラスモーフィズム','Dark UI,monospace numbers,glassmorphism'),
health:_dvs('カレンダー,タイムラインUI,バイタルグラフ','Calendar,timeline UI,vital graphs','カード型,タブ切替,清潔な余白','Card-based,tab switching,clean whitespace','ソフトシャドウ,グリーン系アクセント,アイコン多用','Soft shadows,green accents,heavy icon use'),
saas:_dvs('オンボーディングステッパー,ツールチップ,トースト','Onboarding stepper,tooltip,toast','フルスクリーンダッシュボード,コマンドパレット','Full dashboard,command palette','ニューモーフィズム,マイクロアニメ,パララックスHero','Neumorphism,micro-animations,parallax hero'),
booking:_dvs('日付ピッカー,可用性マップ,リアルタイム更新','Date picker,availability map,realtime updates','スプリットレイアウト(検索+結果)','Split layout(search+results)','スクロール連動マップ,フェードイン,ホバーエフェクト','Scroll-linked map,fade-in,hover effects'),
_default:_dvs('スクロール連動フェードイン,ホバーエフェクト','Scroll-linked fade-in,hover effects','レスポンシブグリッド,スティッキーヘッダー','Responsive grid,sticky header','パララックス,スムーズスクロール,マイクロアニメ','Parallax,smooth scroll,micro-animations')
};
// Domain-specific sequence flow templates
const _dsf=(nj,ne,steps)=>({nj,ne,steps});
const DOMAIN_SEQ_FLOWS={
ec:_dsf('購入フロー','Purchase Flow',[['U','C','商品をカートに追加','Add to cart'],['C','API','Checkout API呼出','Call Checkout API'],['API','API','在庫確認+ロック','Check stock+lock'],['API','C','注文作成+在庫減算','Create order+deduct stock'],['C','U','注文完了画面','Show confirmation']]),
education:_dsf('受講フロー','Enrollment Flow',[['U','C','コース選択','Select course'],['C','API','受講登録API','Enrollment API'],['API','C','Enrollment作成','Create enrollment'],['U','C','レッスン受講','Start lesson'],['C','API','進捗更新','Update progress'],['API','C','進捗保存+修了判定','Save+check completion']]),
booking:_dsf('予約フロー','Booking Flow',[['U','C','空き枠検索','Search slots'],['C','API','空き確認','Check availability'],['U','C','予約情報入力','Enter booking info'],['C','API','予約確定+枠ロック','Confirm+lock slot'],['API','C','確認メール送信','Send confirmation']]),
health:_dsf('診療予約','Appointment Flow',[['U','C','医師・日時選択','Select doctor+time'],['C','API','空き確認','Check availability'],['U','C','症状入力','Enter symptoms'],['C','API','予約確定','Confirm appointment'],['API','C','リマインド送信','Send reminder']]),
fintech:_dsf('送金フロー','Transfer Flow',[['U','C','送金先・金額入力','Enter recipient+amount'],['C','API','残高確認+凍結','Check balance+hold'],['API','API','KYCチェック','KYC verification'],['API','C','送金実行','Execute transfer'],['API','C','通知送信','Send notification']]),
saas:_dsf('オンボーディング','Onboarding Flow',[['U','C','サインアップ','Sign up'],['C','API','Workspace作成','Create workspace'],['C','U','初期設定ウィザード','Setup wizard'],['U','C','チーム招待','Invite team'],['C','API','メンバー追加+権限設定','Add members+set roles']])
};
function genPillar9_DesignSystem(a,pn){
const G=S.genLang==='ja';
const fe=a.frontend||'React + Next.js';
const be=a.backend||'Node.js + Express';
const auth=resolveAuth(a);
const arch=resolveArch(a);
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
const entities=(a.data_entities||'').split(/[,、]\s*/).map(s=>s.trim()).filter(Boolean);
const screens=(a.screens||'').split(/[,、]/).map(s=>s.trim()).filter(Boolean);
// Domain detection for color and flow customization
const domain=detectDomain(a.purpose)||'_default';
const dc=DOMAIN_COLORS[domain]||DOMAIN_COLORS._default;
// Framework-specific CSS approach
const isTailwind=fe.includes('Next')||fe.includes('Vite')||fe.includes('React');
const isVuetify=fe.includes('Vue');
const isMaterial=fe.includes('Angular');
// Design Tokens
const colorSection=G?'## デザイントークン':'## Design Tokens';
const colorPalette=G?'### カラーパレット':'### Color Palette';
const typography=G?'### タイポグラフィ':'### Typography Scale';
const spacing=G?'### スペーシング':'### Spacing Scale';
const breakpoints=G?'### ブレークポイント':'### Breakpoints';
const components=G?'## コンポーネントカタログ':'## Component Catalog';
const darkMode=G?'## ダーク/ライトモード':'## Dark/Light Mode';
const guidelines=G?'## AI実装ガイドライン':'## AI Implementation Guidelines';
let designDoc='# '+(G?'デザインシステム':'Design System')+'\n\n';
designDoc+=G?'**重要**: AIエージェントは、UI実装時に必ずこのデザインシステムを参照し、一貫性を保ってください。\n\n':'**IMPORTANT**: AI agents MUST reference this design system when implementing UI to maintain consistency.\n\n';
// Color Palette
designDoc+=colorSection+'\n\n'+colorPalette+'\n\n';
if(isTailwind){
designDoc+='```css\n/* Tailwind config (tailwind.config.js) */\ntheme: {\n extend: {\n colors: {\n primary: \''+dc.p+'\',\n secondary: \''+dc.s+'\',\n accent: \''+dc.ac+'\',\n cta: \''+dc.cta+'\',\n success: \'#10b981\',\n warning: \'#f59e0b\',\n error: \'#ef4444\',\n surface: {\n light: \'#ffffff\',\n dark: \'#1e293b\'\n }\n }\n }\n}\n```\n';
}else if(isVuetify){
designDoc+='```js\n// Vuetify theme (vuetify.config.js)\ntheme: {\n themes: {\n light: {\n primary: \''+dc.p+'\',\n secondary: \''+dc.s+'\',\n accent: \''+dc.ac+'\'\n },\n dark: {\n primary: \''+dc.cta+'\',\n secondary: \''+dc.s+'\',\n accent: \''+dc.ac+'\'\n }\n }\n}\n```\n';
}else{
designDoc+='```css\n:root {\n --color-primary: '+dc.p+';\n --color-secondary: '+dc.s+';\n --color-accent: '+dc.ac+';\n --color-cta: '+dc.cta+';\n --color-bg: #ffffff;\n --color-surface: #f8fafc;\n --color-text: #0f172a;\n --color-success: #10b981;\n --color-warning: #f59e0b;\n --color-error: #ef4444;\n}\n[data-theme="dark"] {\n --color-bg: #0f172a;\n --color-surface: #1e293b;\n --color-text: #f1f5f9;\n}\n```\n';
}
// Color Strategy
designDoc+=(G?'#### カラー戦略\n\n':'#### Color Strategy\n\n');
designDoc+=(G?dc.sj:dc.se)+'\n\n';
// Typography
designDoc+='\n'+typography+'\n\n| '+(G?'要素':'Element')+' | '+(G?'サイズ':'Size')+' | '+(G?'ウェイト':'Weight')+' | '+(G?'行間':'Line Height')+' |\n|------|------|--------|-------------|\n';
designDoc+='| h1 | 36px/2.25rem | 700 | 1.2 |\n| h2 | 30px/1.875rem | 600 | 1.3 |\n| h3 | 24px/1.5rem | 600 | 1.4 |\n| body | 16px/1rem | 400 | 1.5 |\n| small | 14px/0.875rem | 400 | 1.4 |\n| xs | 12px/0.75rem | 400 | 1.3 |\n\n';
// Spacing
designDoc+=spacing+'\n\n| '+(G?'トークン':'Token')+' | '+(G?'値':'Value')+' | '+(G?'用途':'Usage')+' |\n|------|-------|-------|\n';
designDoc+='| xs | 4px | '+(G?'アイコン間隔':'Icon gaps')+'|\n| sm | 8px | '+(G?'コンパクト間隔':'Compact spacing')+'|\n| md | 16px | '+(G?'標準間隔':'Standard spacing')+'|\n| lg | 24px | '+(G?'セクション間':'Section gaps')+'|\n| xl | 32px | '+(G?'カード間':'Card spacing')+'|\n| 2xl | 48px | '+(G?'大セクション間':'Large sections')+'|\n\n';
// Breakpoints
designDoc+=breakpoints+'\n\n```css\n/* Mobile: 0-640px */\n/* Tablet: 641-1024px */\n/* Desktop: 1025-1536px */\n/* Wide: 1537px+ */\n```\n\n';
// Component Catalog
designDoc+=components+'\n\n';
if(screens.length>0){
screens.forEach(scr=>{
const comps=getScreenComponents(scr,G);
if(comps){
designDoc+='### '+(G?'画面：':'Screen: ')+scr+'\n';
comps.forEach(c=>designDoc+='- '+c+'\n');
designDoc+='\n';
}
});
}
// Major Component Specifications
designDoc+=(G?'### 主要コンポーネント仕様\n\n':'### Core Component Specifications\n\n');
designDoc+='| '+(G?'コンポーネント':'Component')+' | '+(G?'Props':'Props')+' | '+(G?'バリエーション':'Variants')+' |\n|-------------|-------|------------|\n';
designDoc+='| Button | variant, size, disabled | primary, secondary, outline, ghost |\n';
designDoc+='| Input | type, placeholder, error | text, email, password, number |\n';
designDoc+='| Card | elevated, outlined | default, clickable, media |\n';
designDoc+='| Modal | open, onClose | sm, md, lg, fullscreen |\n';
designDoc+='| Table | data, columns, sortable | default, striped, compact |\n';
designDoc+='| Badge | color, size | success, warning, error, info |\n\n';
// Framework Component Mapping
designDoc+=(G?'### コンポーネント対応表\n\n':'### Component Framework Mapping\n\n');
designDoc+='| '+(G?'コンポーネント':'Component')+' | Tailwind (shadcn/ui) | Vuetify | Angular Material |\n|-------------|----------------------|---------|------------------|\n';
designDoc+='| Button | `<Button>` | `<v-btn>` | `<mat-button>` |\n';
designDoc+='| Input | `<Input>` | `<v-text-field>` | `<mat-form-field>` + `<input matInput>` |\n';
designDoc+='| Card | `<Card>` | `<v-card>` | `<mat-card>` |\n';
designDoc+='| Modal/Dialog | `<Dialog>` | `<v-dialog>` | `<mat-dialog>` |\n';
designDoc+='| Table | `<Table>` | `<v-data-table>` | `<mat-table>` |\n';
designDoc+='| Select | `<Select>` | `<v-select>` | `<mat-select>` |\n';
designDoc+='| Checkbox | `<Checkbox>` | `<v-checkbox>` | `<mat-checkbox>` |\n';
designDoc+='| Tabs | `<Tabs>` | `<v-tabs>` | `<mat-tab-group>` |\n\n';
if(isTailwind){
designDoc+=(G?'**推奨**: shadcn/ui または Headless UI をベースに、デザイントークンを適用\n':'**Recommendation**: Use shadcn/ui or Headless UI as base, apply design tokens\n')+'\n';
}else if(isVuetify){
designDoc+=(G?'**推奨**: Vuetify の標準コンポーネントをカスタマイズ\n':'**Recommendation**: Customize Vuetify standard components\n')+'\n';
}else if(isMaterial){
designDoc+=(G?'**推奨**: Angular Material の標準コンポーネントを使用\n':'**Recommendation**: Use Angular Material standard components\n')+'\n';
}
// Motion & Transition
designDoc+=(G?'## モーション & トランジション\n\n':'## Motion & Transitions\n\n');
designDoc+='| '+(G?'トークン':'Token')+' | '+(G?'値':'Value')+' | '+(G?'用途':'Usage')+' |\n|---------|-------|-------|\n';
designDoc+='| duration-fast | 150ms | '+(G?'ホバー、フォーカス':'Hover, focus')+'|\n';
designDoc+='| duration-normal | 250ms | '+(G?'パネル開閉、トグル':'Panel, toggle')+'|\n';
designDoc+='| duration-slow | 400ms | '+(G?'モーダル、ページ遷移':'Modal, page transition')+'|\n';
designDoc+='| easing-default | cubic-bezier(0.4,0,0.2,1) | '+(G?'標準':'Default')+'|\n';
designDoc+='| easing-in | cubic-bezier(0.4,0,1,1) | '+(G?'退出':'Exit')+'|\n';
designDoc+='| easing-out | cubic-bezier(0,0,0.2,1) | '+(G?'進入':'Enter')+'|\n\n';
// Visual Enhancement Dictionary
designDoc+=(G?'## ビジュアルエンハンスメント辞書\n\n':'## Visual Enhancement Dictionary\n\n');
designDoc+=(G?'AIエージェントに以下のキーワードを指示することで、「AI感」を排除した高品質な演出が実装可能です。\n\n':'Use these keywords when instructing AI agents to implement professional-quality effects that eliminate the "AI look".\n\n');
designDoc+='| '+(G?'キーワード':'Keyword')+' | '+(G?'効果':'Effect')+' | CSS/JS |\n|---------|------|--------|\n';
designDoc+='| '+(G?'パララックス':'Parallax')+' | '+(G?'奥行きと躍動感':'Depth and dynamism')+' | `transform: translateZ()`, Intersection Observer |\n';
designDoc+='| '+(G?'ニューモーフィズム':'Neumorphism')+' | '+(G?'触覚的な高級感':'Tactile premium feel')+' | `box-shadow: inset ...`, same-hue bg |\n';
designDoc+='| '+(G?'グラスモーフィズム':'Glassmorphism')+' | '+(G?'透明感と奥行き':'Transparency and depth')+' | `backdrop-filter: blur()`, `bg-opacity` |\n';
designDoc+='| '+(G?'スクロール連動':'Scroll-linked')+' | '+(G?'没入型インタラクション':'Immersive interaction')+' | `IntersectionObserver`, `scroll-behavior` |\n';
designDoc+='| '+(G?'マイクロアニメーション':'Micro-animation')+' | '+(G?'応答性と洗練':'Responsiveness and polish')+' | `transition: 150ms`, `@keyframes` |\n';
designDoc+='| View Transitions | '+(G?'ページ遷移の余韻':'Smooth page transitions')+' | `document.startViewTransition()` |\n\n';
// Domain-specific visual recommendations
const dvs=DOMAIN_VISUAL[domain]||DOMAIN_VISUAL._default;
designDoc+=(G?'### '+pn+' 推奨ビジュアル戦略\n\n':'### '+pn+' Recommended Visual Strategy\n\n');
designDoc+='| '+(G?'カテゴリ':'Category')+' | '+(G?'推奨':'Recommendation')+' |\n|----------|------|\n';
designDoc+='| '+(G?'演出効果':'Effects')+' | '+(G?dvs.ej:dvs.ee)+' |\n';
designDoc+='| '+(G?'レイアウト':'Layout')+' | '+(G?dvs.lj:dvs.le)+' |\n';
designDoc+='| '+(G?'テクスチャ・質感':'Texture')+' | '+(G?dvs.tj:dvs.te)+' |\n\n';
// Design Token Export
designDoc+=(G?'## デザイントークン エクスポート\n\n':'## Design Token Export\n\n');
designDoc+=(G?'以下のJSON形式でトークンを管理することを推奨します：\n\n':'Recommended to manage tokens in JSON format:\n\n');
designDoc+='```json\n{\n "color": {\n "primary": "'+dc.p+'",\n "secondary": "'+dc.s+'",\n "accent": "'+dc.ac+'",\n "cta": "'+dc.cta+'",\n "success": "#10b981",\n "warning": "#f59e0b",\n "error": "#ef4444"\n },\n "spacing": {\n "xs": "4px",\n "sm": "8px",\n "md": "16px",\n "lg": "24px",\n "xl": "32px",\n "2xl": "48px"\n },\n "radius": {\n "sm": "4px",\n "md": "8px",\n "lg": "16px",\n "full": "9999px"\n },\n "shadow": {\n "sm": "0 1px 2px 0 rgb(0 0 0 / 0.05)",\n "md": "0 4px 6px -1px rgb(0 0 0 / 0.1)",\n "lg": "0 10px 15px -3px rgb(0 0 0 / 0.1)"\n }\n}\n```\n\n';
// Dark/Light Mode
designDoc+=darkMode+'\n\n';
if(isTailwind){
designDoc+='```jsx\n// app/layout.tsx\nimport { ThemeProvider } from "next-themes"\n\nexport default function RootLayout({ children }) {\n return (\n <html suppressHydrationWarning>\n <body>\n <ThemeProvider attribute="class" defaultTheme="system" enableSystem>\n {children}\n </ThemeProvider>\n </body>\n </html>\n )\n}\n```\n\n'+(G?'使用例: `className="bg-white dark:bg-gray-900"`':'Usage: `className="bg-white dark:bg-gray-900"`')+'\n\n';
}else{
designDoc+='```js\n// Toggle theme\nfunction toggleTheme() {\n document.documentElement.dataset.theme = \n document.documentElement.dataset.theme === "dark" ? "light" : "dark";\n}\n```\n\n';
}
// AI Guidelines
designDoc+=guidelines+'\n\n';
designDoc+=(G?'### AI Design Protocol（AI感を排除するルール）\n\n':'### AI Design Protocol (Rules to Eliminate AI Look)\n\n');
designDoc+=(G?'1. **トークン参照義務**: すべてのスタイル指定は、定義済みデザイントークン経由で行う。未定義の値を使用しない\n2. **未定義値の禁止**: トークンにない色・余白・サイズは使用禁止（例: `#123456`, `13px`, `font-size: 19px`）\n3. **装飾追加禁止**: 仕様にないシャドウ・グラデーション・アニメーションを追加しない\n4. **レイアウト改変禁止**: 指定されたグリッド構造・フレックスボックス配置を変更しない\n5. **コンポーネント対応表遵守**: フレームワーク標準コンポーネントを使用し、独自実装を避ける\n6. **一貫性検証**: 実装前にデザイントークンとの整合性をチェック\n7. **仕様外の最適化禁止**: 「より良く見せるため」の独自判断による変更は行わない\n\n':'1. **Token Reference Mandatory**: All style specifications must use predefined design tokens. No undefined values.\n2. **Undefined Values Prohibited**: Colors/spacing/sizes not in tokens are forbidden (e.g., `#123456`, `13px`, `font-size: 19px`)\n3. **Decoration Addition Prohibited**: Do not add shadows/gradients/animations not in spec\n4. **Layout Modification Prohibited**: Do not change specified grid structure/flexbox layouts\n5. **Component Mapping Compliance**: Use framework standard components, avoid custom implementations\n6. **Consistency Verification**: Check alignment with design tokens before implementation\n7. **No Unsolicited Optimization**: Do not make changes based on \"making it look better\" judgment\n\n');
designDoc+=(G?'### 基本ルール\n\n':'### Basic Rules\n\n');
designDoc+=(G?'1. **色**: 必ず定義済みトークンを使用。直接カラーコード（#000 等）を記述しない\n2. **スペーシング**: 4px グリッドに従う (xs/sm/md/lg/xl/2xl)\n3. **タイポグラフィ**: 定義されたスケールのみ使用\n4. **コンポーネント**: 推奨ライブラリから選択（独自実装は最小限）\n5. **ダークモード**: すべてのUI要素でLight/Dark対応を実装\n6. **レスポンシブ**: モバイルファースト設計（最小→最大）\n7. **アクセシビリティ**: ARIA属性、キーボードナビゲーション、コントラスト比 4.5:1 以上\n\n':'1. **Colors**: Always use predefined tokens. Never hardcode colors (#000)\n2. **Spacing**: Follow 4px grid (xs/sm/md/lg/xl/2xl)\n3. **Typography**: Use defined scale only\n4. **Components**: Choose from recommended library (minimize custom)\n5. **Dark Mode**: Implement Light/Dark support for all UI elements\n6. **Responsive**: Mobile-first design (min → max)\n7. **Accessibility**: ARIA attributes, keyboard navigation, contrast ratio ≥ 4.5:1\n\n');
designDoc+=(G?'### 禁止アクション\n\n':'### Prohibited Actions\n\n');
designDoc+=(G?'- ❌ トークンにない色を使う（例: `#1a2b3c`）\n- ❌ 独自の余白値（例: `margin: 13px`）\n- ❌ 仕様外のシャドウ追加（例: `box-shadow: 0 8px 16px ...`）\n- ❌ グラデーション追加（例: `background: linear-gradient(...)`）\n- ❌ フォントサイズの独自設定（例: `font-size: 17px`）\n- ❌ コンポーネントライブラリの独自改変\n- ❌ レイアウト構造の変更（例: Grid → Flexbox）\n\n':'- ❌ Using colors not in tokens (e.g., `#1a2b3c`)\n- ❌ Custom spacing values (e.g., `margin: 13px`)\n- ❌ Adding shadows not in spec (e.g., `box-shadow: 0 8px 16px ...`)\n- ❌ Adding gradients (e.g., `background: linear-gradient(...)`)\n- ❌ Custom font sizes (e.g., `font-size: 17px`)\n- ❌ Modifying component library defaults\n- ❌ Changing layout structure (e.g., Grid → Flexbox)\n\n');
// Figma Design Fidelity Protocol
designDoc+=(G?'### デザイン忠実度プロトコル（Figma MCP連携）\n\n':'### Design Fidelity Protocol (Figma MCP Integration)\n\n');
designDoc+=(G?
'**原則: Design as Single Source of Truth（SSOT）**\n\n'+
'AIにUIを「ガチャ」させず、Figmaデザインを確定的に再現する。\n\n'+
'#### ワークフロー\n\n'+
'1. **Figma MCPサーバー有効化**: `Preferences → Enable local MCP server`\n'+
'2. **Selection Link取得**: 対象要素を選択 → `Ctrl+L` でリンクコピー\n'+
'3. **セクション単位実装**: 1セクション=1プロンプトで精度を保つ\n'+
'4. **Live Preview検証**: VS Code Live Serverで即時確認\n'+
'5. **反復改善（Vibe Coding）**: 60点→80点→100点の段階的品質向上\n\n'+
'#### 画像永続化\n\n'+
'- Figma MCPの画像リンクはアプリ終了で無効化される\n'+
'- **対策A**: Figmaからエクスポート → ローカル `/images` に保存 → パス書換え\n'+
'- **対策B**: Unsplash API で永続リンクに差替え\n\n'
:
'**Principle: Design as Single Source of Truth (SSOT)**\n\n'+
'Eliminate "Design Gacha" — reproduce Figma designs deterministically.\n\n'+
'#### Workflow\n\n'+
'1. **Enable Figma MCP server**: `Preferences → Enable local MCP server`\n'+
'2. **Get Selection Link**: Select target element → `Ctrl+L` to copy link\n'+
'3. **Section-by-section implementation**: 1 section = 1 prompt for accuracy\n'+
'4. **Live Preview verification**: VS Code Live Server for instant feedback\n'+
'5. **Iterative refinement (Vibe Coding)**: 60→80→100 point quality improvement\n\n'+
'#### Image Persistence\n\n'+
'- Figma MCP image links invalidate when app closes\n'+
'- **Option A**: Export from Figma → save to local `/images` → rewrite paths\n'+
'- **Option B**: Replace with Unsplash API persistent links\n\n'
);
// Anti-AI Quality Checklist
designDoc+=(G?'### Anti-AI品質チェックリスト\n\n':'### Anti-AI Quality Checklist\n\n');
designDoc+=(G?
'実装完了時に以下を確認し、「AI感」の残存を防止する：\n\n'+
'- [ ] 全色がデザイントークン経由か（ハードコード `#xxx` がないか）\n'+
'- [ ] 余白が4pxグリッドに従っているか（13px, 17px等の中途半端な値がないか）\n'+
'- [ ] アニメーションのイージングが定義済みトークンを使用しているか\n'+
'- [ ] レスポンシブがモバイルファーストで実装されているか\n'+
'- [ ] ダークモード切替で全要素が適切に変化するか\n'+
'- [ ] ホバー/フォーカス状態が全インタラクティブ要素に定義されているか\n'+
'- [ ] コンポーネントライブラリの標準コンポーネントを使用しているか\n'+
'- [ ] フォントサイズが定義済みスケールのみか\n'+
'- [ ] Figmaデザインとのピクセル単位の差異がないか\n\n'
:
'Verify these items after implementation to prevent residual "AI look":\n\n'+
'- [ ] All colors use design tokens (no hardcoded `#xxx`)\n'+
'- [ ] Spacing follows 4px grid (no awkward values like 13px, 17px)\n'+
'- [ ] Animation easing uses defined tokens\n'+
'- [ ] Responsive is mobile-first\n'+
'- [ ] Dark mode toggle works for all elements\n'+
'- [ ] Hover/focus states defined for all interactive elements\n'+
'- [ ] Using component library standard components\n'+
'- [ ] Font sizes use defined scale only\n'+
'- [ ] Pixel-perfect match with Figma design\n\n'
);
S.files['docs/26_design_system.md']=designDoc;
// Sequence Diagrams
let seqDoc='# '+(G?'シーケンス図':'Sequence Diagrams')+'\n\n';
seqDoc+=G?'**重要**: AIエージェントは、複雑なフローを実装する前にこのシーケンス図を参照してください。\n\n':'**IMPORTANT**: AI agents MUST reference these sequence diagrams before implementing complex flows.\n\n';
// Auth Flow
seqDoc+=(G?'## 認証フロー':'## Authentication Flow')+'\n\n```mermaid\nsequenceDiagram\n participant U as User\n participant C as Client\n participant ';
if(auth.provider==='supabase'){
seqDoc+='S as Supabase Auth\n U->>C: '+(G?'ログイン要求':'Login request')+'\n C->>S: signInWithPassword(email, password)\n S-->>C: {access_token, refresh_token}\n C->>C: '+(G?'トークン保存':'Store tokens')+'\n C->>S: getUser() with access_token\n S-->>C: User object\n C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}else if(auth.provider==='firebase'){
seqDoc+='F as Firebase Auth\n U->>C: '+(G?'ログイン要求':'Login request')+'\n C->>F: signInWithEmailAndPassword()\n F-->>C: User + ID Token\n C->>C: '+(G?'トークン保存':'Store token')+'\n C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}else if(auth.provider==='authjs'){
seqDoc+='A as Auth.js\n U->>C: '+(G?'ログイン要求':'Login request')+'\n C->>A: signIn("credentials")\n A->>A: '+(G?'認証情報検証':'Verify credentials')+'\n A-->>C: Session cookie\n C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}else{
seqDoc+='API as Backend API\n U->>C: '+(G?'ログイン要求':'Login request')+'\n C->>API: POST /api/auth/login\n API->>API: '+(G?'認証情報検証':'Verify credentials')+'\n API-->>C: {token, user}\n C->>C: '+(G?'トークン保存':'Store token')+'\n C-->>U: '+(G?'ダッシュボード表示':'Show dashboard')+'\n```\n\n';
}
// CRUD Flow
if(entities.length>0){
const firstEntity=entities[0];
seqDoc+=(G?'## CRUD操作（':'## CRUD Operation (')+firstEntity+(G?'）':')')+'\n\n```mermaid\nsequenceDiagram\n participant U as User\n participant C as Client\n participant ';
if(arch.isBaaS){
const baasName=be.includes('Supabase')?'Supabase':be.includes('Firebase')?'Firebase':'Convex';
seqDoc+=baasName[0]+' as '+baasName+'\n U->>C: '+(G?'作成ボタンクリック':'Click create button')+'\n C->>'+baasName[0]+': insert({...data})\n '+baasName[0]+'-->>C: '+(G?'作成成功':'Created successfully')+'\n C-->>U: '+(G?'成功通知':'Show success')+'\n U->>C: '+(G?'一覧表示要求':'Request list')+'\n C->>'+baasName[0]+': select().eq(...)\n '+baasName[0]+'-->>C: '+firstEntity+' list\n C-->>U: '+(G?'一覧表示':'Display list')+'\n```\n\n';
}else{
seqDoc+='API as Backend API\n U->>C: '+(G?'作成ボタンクリック':'Click create button')+'\n C->>API: POST /api/'+pluralize(firstEntity)+'\n API->>API: '+(G?'バリデーション':'Validate')+'\n API->>API: '+(G?'DB保存':'Save to DB')+'\n API-->>C: '+(G?'作成成功':'201 Created')+'\n C-->>U: '+(G?'成功通知':'Show success')+'\n```\n\n';
}
// Related Entity Operation Flow
if(entities.length>1){
const ent1=entities[0];
const ent2=entities[1];
seqDoc+=(G?'## 関連エンティティ操作（':'## Related Entity Operation (')+ent1+' ↔ '+ent2+(G?'）':')')+'\n\n```mermaid\nsequenceDiagram\n participant U as User\n participant C as Client\n participant API as Backend\n U->>C: '+(G?ent1+'を選択':('Select '+ent1))+'\n C->>API: GET /api/'+pluralize(ent1)+'/:id\n API-->>C: '+ent1+' '+(G?'詳細':'details')+'\n C->>API: GET /api/'+pluralize(ent1)+'/:id/'+pluralize(ent2)+'\n API-->>C: '+(G?'関連する':'Related ')+ent2+' list\n C-->>U: '+(G?'関連データ表示':'Display related data')+'\n U->>C: '+(G?ent2+'を追加':('Add '+ent2))+'\n C->>API: POST /api/'+pluralize(ent2)+'\n API->>API: '+(G?ent1+'との関連付け':('Associate with '+ent1))+'\n API-->>C: '+(G?'作成成功':'201 Created')+'\n C-->>U: '+(G?'更新完了':'Updated')+'\n```\n\n';
}
}
// Domain-specific Sequence Flow
const dsf=DOMAIN_SEQ_FLOWS[domain];
if(dsf){
seqDoc+=(G?'## '+dsf.nj:'## '+dsf.ne)+'\n\n```mermaid\nsequenceDiagram\n participant U as User\n participant C as Client\n participant API as Backend\n';
dsf.steps.forEach(step=>{
const [from,to,actJ,actE]=step;
seqDoc+=' '+from+'->>'+to+': '+(G?actJ:actE)+'\n';
});
seqDoc+='```\n\n';
}
// Payment Flow (if Stripe)
if(hasPay&&(a.payment||'').includes('Stripe')){
seqDoc+=(G?'## 決済フロー（Stripe）':'## Payment Flow (Stripe)')+'\n\n```mermaid\nsequenceDiagram\n participant U as User\n participant C as Client\n participant API as Backend\n participant S as Stripe\n participant W as Webhook\n U->>C: '+(G?'プラン選択':'Select plan')+'\n C->>API: POST /api/checkout\n API->>S: stripe.checkout.sessions.create()\n S-->>API: session_id\n API-->>C: {session_id}\n C->>S: '+(G?'Checkoutページへリダイレクト':'Redirect to Checkout')+'\n U->>S: '+(G?'カード情報入力':'Enter card info')+'\n S->>W: webhook: checkout.session.completed\n W->>W: '+(G?'DB更新（サブスク作成）':'Update DB (create subscription)')+'\n W-->>S: 200 OK\n S-->>U: '+(G?'完了ページへリダイレクト':'Redirect to success page')+'\n```\n\n';
}
// Error Handling
seqDoc+=(G?'## エラーハンドリング':'## Error Handling')+'\n\n```mermaid\nsequenceDiagram\n participant C as Client\n participant API as Backend\n C->>API: '+(G?'リクエスト':'Request')+'\n API-->>C: 400/401/403/500\n C->>C: '+(G?'エラーメッセージ抽出':'Parse error message')+'\n C->>C: '+(G?'トースト表示':'Show toast notification')+'\n alt '+(G?'401 認証エラー':'401 Unauthorized')+'\n C->>C: '+(G?'ログイン画面へリダイレクト':'Redirect to login')+'\n else '+(G?'5xx サーバーエラー':'5xx Server Error')+'\n C->>C: '+(G?'リトライボタン表示':'Show retry button')+'\n end\n```\n\n';
S.files['docs/27_sequence_diagrams.md']=seqDoc;
}
/* ═══ Pillar 10: Reverse Engineering (Goal-Driven Planning) ═══ */
// ── Domain-Specific Reverse Flow Map (15 domains + default) ──
const REVERSE_FLOW_MAP={
education:{
goal_ja:'学習成果の最大化',goal_en:'Maximize Learning Outcomes',
flow_ja:['学習成果・修了率KPI定義','カリキュラム・コンテンツ設計','学習進捗測定機能','リマインド・通知自動化'],
flow_en:['Define learning outcomes & completion KPIs','Design curriculum & content','Implement progress tracking','Automate reminders & notifications'],
kpi_ja:['コース修了率 ≥70%','平均学習時間/週 ≥3h','課題提出率 ≥80%','受講者満足度 ≥4.2/5'],
kpi_en:['Course completion rate ≥70%','Avg study time/week ≥3h','Assignment submission ≥80%','Learner satisfaction ≥4.2/5'],
risks_ja:['コンテンツ制作遅延','学習者離脱率高','評価基準曖昧'],
risks_en:['Content production delays','High learner dropout','Vague grading criteria']
},
ec:{
goal_ja:'売上・CVR最大化',goal_en:'Maximize Revenue & CVR',
flow_ja:['売上目標・CVR設定','商品戦略（価格・在庫）','UI/UX最適化（カート・決済）','集客施策（SEO・広告）'],
flow_en:['Set revenue & CVR targets','Product strategy (pricing/inventory)','Optimize UI/UX (cart/checkout)','Marketing (SEO/ads)'],
kpi_ja:['CVR ≥2.5%','平均注文額 ≥5,000円','カート放棄率 ≤60%','リピート率 ≥30%'],
kpi_en:['CVR ≥2.5%','Avg order value ≥$50','Cart abandonment ≤60%','Repeat rate ≥30%'],
risks_ja:['在庫切れ・欠品','決済エラー率高','物流遅延'],
risks_en:['Stock-outs','High payment errors','Shipping delays']
},
saas:{
goal_ja:'MRR成長・チャーン率低減',goal_en:'MRR Growth & Churn Reduction',
flow_ja:['MRR・チャーン率目標設定','機能優先度決定（MVPコア機能）','オンボーディング最適化','リテンション施策'],
flow_en:['Set MRR & churn targets','Prioritize features (MVP core)','Optimize onboarding','Retention strategies'],
kpi_ja:['MRR成長率 ≥10%/月','チャーン率 ≤5%/月','アクティベーション率 ≥60%','NPS ≥40'],
kpi_en:['MRR growth ≥10%/mo','Churn ≤5%/mo','Activation rate ≥60%','NPS ≥40'],
risks_ja:['機能スコープ過多','オンボーディング離脱','競合参入'],
risks_en:['Feature scope creep','Onboarding drop-offs','Competitor entry']
},
fintech:{
goal_ja:'取引量・信頼性・規制準拠',goal_en:'Transaction Volume, Trust & Compliance',
flow_ja:['規制準拠要件確認（金融庁・GDPR等）','セキュリティ基盤（暗号化・2FA）','取引フロー設計','監視・監査体制'],
flow_en:['Verify compliance (FSA/GDPR)','Security foundation (encryption/2FA)','Design transaction flow','Monitoring & audit'],
kpi_ja:['取引成功率 ≥99.5%','平均決済時間 ≤3秒','セキュリティインシデント 0件','監査合格率 100%'],
kpi_en:['Transaction success ≥99.5%','Avg payment time ≤3s','Security incidents: 0','Audit pass rate: 100%'],
risks_ja:['規制変更対応遅延','不正検知精度不足','システム障害時の資金保全'],
risks_en:['Slow regulatory adaptation','Weak fraud detection','Fund security during outages']
},
health:{
goal_ja:'患者満足度・診療効率向上',goal_en:'Patient Satisfaction & Efficiency',
flow_ja:['診療目標・待ち時間KPI設定','予約システム最適化','電子カルテ連携','患者フィードバック収集'],
flow_en:['Set care goals & wait time KPIs','Optimize booking system','EHR integration','Patient feedback collection'],
kpi_ja:['予約充足率 ≥85%','平均待ち時間 ≤15分','診察時間 15分/人','患者満足度 ≥4.5/5'],
kpi_en:['Booking rate ≥85%','Avg wait time ≤15min','Consult time: 15min/patient','Patient satisfaction ≥4.5/5'],
risks_ja:['医療情報漏洩','予約重複・ダブルブッキング','システム障害時の診療継続'],
risks_en:['Medical data breach','Booking conflicts','Service continuity during outages']
},
marketplace:{
goal_ja:'取引量・GMV最大化',goal_en:'Maximize Transactions & GMV',
flow_ja:['GMV目標設定','マッチング精度向上','エスクロー決済実装','評価システム信頼性'],
flow_en:['Set GMV targets','Improve matching accuracy','Implement escrow','Rating system trust'],
kpi_ja:['GMV成長率 ≥15%/月','マッチング成約率 ≥40%','平均評価 ≥4.3/5','紛争解決時間 ≤48h'],
kpi_en:['GMV growth ≥15%/mo','Match conversion ≥40%','Avg rating ≥4.3/5','Dispute resolution ≤48h'],
risks_ja:['不正出品・詐欺','決済トラブル','評価操作'],
risks_en:['Fraud listings','Payment disputes','Rating manipulation']
},
community:{
goal_ja:'ユーザーエンゲージメント向上',goal_en:'User Engagement Growth',
flow_ja:['エンゲージメントKPI設定（DAU/MAU）','コンテンツ推薦アルゴリズム','モデレーション自動化','コミュニティガイドライン策定'],
flow_en:['Set engagement KPIs (DAU/MAU)','Content recommendation algo','Automate moderation','Define community guidelines'],
kpi_ja:['DAU/MAU比率 ≥30%','投稿数 ≥500/日','平均滞在時間 ≥20分','通報処理時間 ≤2h'],
kpi_en:['DAU/MAU ratio ≥30%','Posts ≥500/day','Avg session ≥20min','Report handling ≤2h'],
risks_ja:['荒らし・スパム増加','コンテンツ品質低下','ユーザー離脱'],
risks_en:['Spam/trolling surge','Content quality decay','User churn']
},
content:{
goal_ja:'コンテンツ配信・エンゲージメント',goal_en:'Content Delivery & Engagement',
flow_ja:['配信KPI設定（PV・滞在時間）','コンテンツパイプライン構築','SEO最適化','収益化戦略'],
flow_en:['Set delivery KPIs (PV/session time)','Build content pipeline','SEO optimization','Monetization strategy'],
kpi_ja:['PV ≥10,000/日','平均滞在時間 ≥3分','直帰率 ≤60%','広告CTR ≥1.5%'],
kpi_en:['PV ≥10,000/day','Avg time ≥3min','Bounce rate ≤60%','Ad CTR ≥1.5%'],
risks_ja:['コンテンツ制作遅延','SEO順位下落','広告収益減'],
risks_en:['Content production delays','SEO ranking drop','Ad revenue decline']
},
analytics:{
goal_ja:'データ分析精度・レポート自動化',goal_en:'Analytics Accuracy & Automation',
flow_ja:['分析KPI・ダッシュボード設計','データパイプライン構築','可視化ツール選定','自動レポート生成'],
flow_en:['Design analytics KPIs & dashboards','Build data pipeline','Select viz tools','Auto report generation'],
kpi_ja:['データ鮮度 ≤1時間','ダッシュボード応答時間 ≤2秒','レポート自動化率 ≥80%','データ精度 ≥99%'],
kpi_en:['Data freshness ≤1h','Dashboard response ≤2s','Report automation ≥80%','Data accuracy ≥99%'],
risks_ja:['データパイプライン障害','分析精度不足','レポート遅延'],
risks_en:['Data pipeline failures','Poor analysis accuracy','Report delays']
},
booking:{
goal_ja:'予約充足率・キャンセル率最適化',goal_en:'Booking Rate & Cancellation Optimization',
flow_ja:['予約目標・キャンセルKPI設定','在庫管理システム構築','通知・リマインダー自動化','決済・キャンセルポリシー'],
flow_en:['Set booking & cancellation KPIs','Build inventory system','Automate notifications','Payment & cancellation policy'],
kpi_ja:['予約充足率 ≥75%','キャンセル率 ≤15%','平均予約単価 ≥8,000円','リピート率 ≥40%'],
kpi_en:['Booking rate ≥75%','Cancellation ≤15%','Avg booking value ≥$80','Repeat rate ≥40%'],
risks_ja:['ダブルブッキング','直前キャンセル','在庫更新遅延'],
risks_en:['Double booking','Last-minute cancellations','Inventory sync delays']
},
iot:{
goal_ja:'デバイス安定稼働・データ収集',goal_en:'Device Uptime & Data Collection',
flow_ja:['稼働率・データ収集KPI設定','デバイス管理・認証基盤','データストリーミング構築','異常検知・アラート'],
flow_en:['Set uptime & data KPIs','Device mgmt & auth','Build data streaming','Anomaly detection & alerts'],
kpi_ja:['デバイス稼働率 ≥99%','データ取得頻度 ≥1回/分','異常検知精度 ≥95%','アラート応答時間 ≤5分'],
kpi_en:['Device uptime ≥99%','Data frequency ≥1/min','Anomaly accuracy ≥95%','Alert response ≤5min'],
risks_ja:['デバイス接続不安定','データ欠損','セキュリティ侵害'],
risks_en:['Unstable connections','Data loss','Security breaches']
},
realestate:{
goal_ja:'成約率・物件掲載数最大化',goal_en:'Conversion & Listing Maximization',
flow_ja:['成約KPI・物件掲載目標設定','検索・フィルタ最適化','内見予約システム','契約書類デジタル化'],
flow_en:['Set conversion & listing KPIs','Optimize search/filters','Viewing booking system','Digital contracts'],
kpi_ja:['成約率 ≥15%','物件掲載数 ≥500件','内見予約率 ≥30%','契約処理時間 ≤7日'],
kpi_en:['Conversion ≥15%','Listings ≥500','Viewing rate ≥30%','Contract time ≤7 days'],
risks_ja:['物件情報更新遅延','内見日程調整トラブル','契約書類不備'],
risks_en:['Listing update delays','Viewing schedule conflicts','Contract errors']
},
legal:{
goal_ja:'案件処理効率・文書精度向上',goal_en:'Case Efficiency & Doc Accuracy',
flow_ja:['案件処理時間・精度KPI設定','文書管理・検索システム','契約レビュー自動化','請求・タイムトラッキング'],
flow_en:['Set case time & accuracy KPIs','Doc mgmt & search system','Auto contract review','Billing & time tracking'],
kpi_ja:['案件処理時間 ≤14日/件','文書検索精度 ≥98%','契約レビュー時間 ≤24h','請求精度 100%'],
kpi_en:['Case time ≤14 days','Doc search accuracy ≥98%','Contract review ≤24h','Billing accuracy 100%'],
risks_ja:['文書紛失・漏洩','契約ミス・解釈齟齬','請求ミス'],
risks_en:['Doc loss/leaks','Contract errors','Billing mistakes']
},
hr:{
goal_ja:'採用効率・従業員満足度向上',goal_en:'Hiring Efficiency & Employee Satisfaction',
flow_ja:['採用KPI・従業員満足度目標設定','ATS（採用管理）構築','オンボーディング自動化','パフォーマンス評価システム'],
flow_en:['Set hiring & satisfaction KPIs','Build ATS','Automate onboarding','Performance review system'],
kpi_ja:['採用充足率 ≥90%','Time to hire ≤30日','従業員満足度 ≥4.0/5','離職率 ≤10%/年'],
kpi_en:['Hiring fill rate ≥90%','Time to hire ≤30 days','Employee satisfaction ≥4.0/5','Turnover ≤10%/yr'],
risks_ja:['採用プロセス遅延','候補者離脱','従業員エンゲージメント低下'],
risks_en:['Hiring delays','Candidate drop-offs','Low engagement']
},
portfolio:{
goal_ja:'訪問者エンゲージメント・問い合わせ獲得',goal_en:'Visitor Engagement & Lead Generation',
flow_ja:['訪問・問い合わせKPI設定','作品ポートフォリオ構築','SEO・SNS連携','問い合わせフォーム最適化'],
flow_en:['Set visit & lead KPIs','Build project portfolio','SEO & social integration','Optimize contact form'],
kpi_ja:['月間訪問者 ≥500人','平均滞在時間 ≥2分','問い合わせ率 ≥3%','SNS流入 ≥30%'],
kpi_en:['Monthly visitors ≥500','Avg session ≥2min','Contact rate ≥3%','Social traffic ≥30%'],
risks_ja:['作品更新停滞','SEO順位低下','問い合わせ減少'],
risks_en:['Stale portfolio','SEO drop','Lead decline']
},
tool:{
goal_ja:'ユーザー利用頻度・機能満足度',goal_en:'User Frequency & Feature Satisfaction',
flow_ja:['利用KPI・機能満足度目標設定','コア機能実装優先','UI/UX最適化','ドキュメント・サポート'],
flow_en:['Set usage & satisfaction KPIs','Prioritize core features','Optimize UI/UX','Docs & support'],
kpi_ja:['週間利用頻度 ≥3回','機能満足度 ≥4.3/5','エラー率 ≤1%','問い合わせ応答時間 ≤24h'],
kpi_en:['Weekly usage ≥3x','Feature satisfaction ≥4.3/5','Error rate ≤1%','Support response ≤24h'],
risks_ja:['機能複雑化','使い方不明','競合ツール台頭'],
risks_en:['Feature complexity','Unclear usage','Competitor tools']
},
ai:{
goal_ja:'AI精度・応答速度・ユーザー満足度',goal_en:'AI Accuracy, Response Speed & User Satisfaction',
flow_ja:['AI精度・応答速度KPI設定','プロンプト最適化・モデル選定','コンテキスト管理・RAG構築','ユーザーフィードバック学習'],
flow_en:['Set AI accuracy & speed KPIs','Prompt optimization & model selection','Context management & RAG','User feedback learning'],
kpi_ja:['応答精度 ≥90%','平均応答時間 ≤2秒','ユーザー満足度 ≥4.5/5','フィードバック反映率 ≥80%'],
kpi_en:['Response accuracy ≥90%','Avg response time ≤2s','User satisfaction ≥4.5/5','Feedback incorporation ≥80%'],
risks_ja:['幻覚(ハルシネーション)','コンテキスト破綻','レート制限超過'],
risks_en:['Hallucinations','Context loss','Rate limit exceeded']
},
automation:{
goal_ja:'自動化率・エラー率・処理時間',goal_en:'Automation Rate, Error Rate & Processing Time',
flow_ja:['自動化率・エラー率KPI設定','ワークフロー設計・条件分岐','監視・リトライ機構','継続的改善ループ'],
flow_en:['Set automation & error KPIs','Workflow design & branching','Monitoring & retry mechanism','Continuous improvement loop'],
kpi_ja:['自動化率 ≥80%','エラー率 ≤3%','処理時間短縮 ≥50%','手動介入率 ≤10%'],
kpi_en:['Automation rate ≥80%','Error rate ≤3%','Processing time reduction ≥50%','Manual intervention ≤10%'],
risks_ja:['無限ループ','条件分岐ミス','監視漏れ'],
risks_en:['Infinite loops','Branching errors','Monitoring gaps']
},
event:{
goal_ja:'参加率・満足度・収益最大化',goal_en:'Participation, Satisfaction & Revenue Maximization',
flow_ja:['参加率・満足度KPI設定','チケット販売戦略','イベント管理システム','事後フォローアップ'],
flow_en:['Set participation & satisfaction KPIs','Ticket sales strategy','Event management system','Post-event follow-up'],
kpi_ja:['参加率 ≥85%','満足度 ≥4.5/5','チケット売上目標達成 ≥95%','リピート参加率 ≥40%'],
kpi_en:['Participation ≥85%','Satisfaction ≥4.5/5','Ticket sales goal ≥95%','Repeat participation ≥40%'],
risks_ja:['集客不足','当日キャンセル','運営トラブル'],
risks_en:['Low attendance','Last-minute cancellations','Operational issues']
},
gamify:{
goal_ja:'エンゲージメント・継続率向上',goal_en:'Engagement & Retention Improvement',
flow_ja:['エンゲージメントKPI設定','ポイント・バッジシステム設計','リーダーボード・チャレンジ','報酬最適化'],
flow_en:['Set engagement KPIs','Design points & badges system','Leaderboard & challenges','Reward optimization'],
kpi_ja:['DAU/MAU比率 ≥35%','平均セッション時間 ≥15分','ポイント獲得率 ≥70%','バッジ解除率 ≥50%'],
kpi_en:['DAU/MAU ratio ≥35%','Avg session ≥15min','Point earn rate ≥70%','Badge unlock rate ≥50%'],
risks_ja:['ポイントインフレ','不正獲得','モチベーション低下'],
risks_en:['Point inflation','Cheating','Motivation decline']
},
collab:{
goal_ja:'共同作業効率・同期精度',goal_en:'Collaboration Efficiency & Sync Accuracy',
flow_ja:['コラボレーションKPI設定','リアルタイム同期基盤','競合解決アルゴリズム','バージョン管理・履歴'],
flow_en:['Set collaboration KPIs','Real-time sync foundation','Conflict resolution algorithm','Version control & history'],
kpi_ja:['同期遅延 ≤200ms','競合発生率 ≤5%','データ損失 0件','同時編集ユーザー数 ≥10人'],
kpi_en:['Sync latency ≤200ms','Conflict rate ≤5%','Data loss: 0','Concurrent users ≥10'],
risks_ja:['データ競合','同期遅延','接続断'],
risks_en:['Data conflicts','Sync delays','Connection loss']
},
devtool:{
goal_ja:'開発者体験・API採用率',goal_en:'Developer Experience & API Adoption',
flow_ja:['DX・API採用率KPI設定','API設計・ドキュメント','SDK・サンプルコード','コミュニティ・サポート'],
flow_en:['Set DX & adoption KPIs','API design & docs','SDKs & sample code','Community & support'],
kpi_ja:['API採用率 ≥50社','ドキュメント満足度 ≥4.5/5','問い合わせ応答時間 ≤4h','SDK利用率 ≥70%'],
kpi_en:['API adoption ≥50 companies','Doc satisfaction ≥4.5/5','Support response ≤4h','SDK usage ≥70%'],
risks_ja:['API仕様変更','ドキュメント不足','サポート遅延'],
risks_en:['API breaking changes','Insufficient docs','Support delays']
},
creator:{
goal_ja:'クリエイター収益・ファンエンゲージメント',goal_en:'Creator Revenue & Fan Engagement',
flow_ja:['収益・ファンKPI設定','コンテンツ収益化戦略','ファンコミュニティ構築','分析・インサイト提供'],
flow_en:['Set revenue & fan KPIs','Content monetization strategy','Build fan community','Analytics & insights'],
kpi_ja:['月間収益 ≥100,000円','ファン数 ≥500人','エンゲージメント率 ≥8%','リピート課金率 ≥60%'],
kpi_en:['Monthly revenue ≥$1,000','Fans ≥500','Engagement rate ≥8%','Repeat payment ≥60%'],
risks_ja:['収益化遅延','ファン離脱','コンテンツ枯渇'],
risks_en:['Monetization delays','Fan churn','Content shortage']
},
newsletter:{
goal_ja:'開封率・クリック率・購読者増',goal_en:'Open Rate, Click Rate & Subscriber Growth',
flow_ja:['開封率・購読者KPI設定','コンテンツ戦略・配信頻度','セグメント配信・A/Bテスト','購読者獲得施策'],
flow_en:['Set open rate & subscriber KPIs','Content strategy & frequency','Segment delivery & A/B test','Subscriber acquisition'],
kpi_ja:['開封率 ≥25%','クリック率 ≥3%','購読者増加率 ≥10%/月','解除率 ≤2%'],
kpi_en:['Open rate ≥25%','Click rate ≥3%','Subscriber growth ≥10%/mo','Unsubscribe ≤2%'],
risks_ja:['スパム判定','コンテンツ質低下','配信遅延'],
risks_en:['Spam filtering','Content quality decline','Delivery delays']
},
_default:{
goal_ja:'プロダクト完成・ローンチ',goal_en:'Product Completion & Launch',
flow_ja:['ゴール・成功指標定義','要件分解・優先順位付け','技術スタック選定','実装計画・スケジュール'],
flow_en:['Define goals & success metrics','Decompose requirements & prioritize','Select tech stack','Implementation plan & schedule'],
kpi_ja:['MVP完成率 100%','テストカバレッジ ≥80%','バグ修正率 ≥95%','ローンチ予定通り'],
kpi_en:['MVP completion 100%','Test coverage ≥80%','Bug fix rate ≥95%','Launch on schedule'],
risks_ja:['スコープ拡大','技術負債蓄積','リソース不足'],
risks_en:['Scope creep','Tech debt accumulation','Resource shortage']
}
};
function genPillar10_ReverseEngineering(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'_default';
const rf=REVERSE_FLOW_MAP[domain]||REVERSE_FLOW_MAP._default;
const purpose=a.purpose||'';
const mvp=a.mvp_features||'';
const entities=(a.data_entities||'').split(/[,、]\s*/).map(s=>s.trim()).filter(Boolean);
const features=mvp.split(/[,、\n]/).map(s=>s.trim()).filter(Boolean);
const skill=S.skill||'intermediate';
// ═══ docs/29_reverse_engineering.md ═══
let doc29='# '+(G?'リバースエンジニアリング（ゴール逆算型プランニング）':'Reverse Engineering (Goal-Driven Planning)')+'\n\n';
doc29+=G?'**重要**: このドキュメントは「ゴールから逆算して実装ステップを導出する」リバースエンジニアリング手法を提示します。AIエージェントは、実装前にこのフローを参照し、目標達成に向けた最適な順序でタスクを進めてください。\n\n':'**IMPORTANT**: This document presents reverse engineering methodology to derive implementation steps from goals. AI agents MUST reference this flow before implementation to proceed in optimal order for goal achievement.\n\n';
// ── Goal Definition ──
doc29+=(G?'## ゴール定義':'## Goal Definition')+'\n\n';
doc29+='**'+(G?'プロダクトの目的':'Product Purpose')+'**: '+purpose+'\n\n';
doc29+='**'+(G?'中心ゴール':'Central Goal')+'**: '+(G?rf.goal_ja:rf.goal_en)+'\n\n';
doc29+='**'+(G?'成功指標（KPI）':'Success Metrics (KPIs)')+'**:\n';
const kpis=G?rf.kpi_ja:rf.kpi_en;
kpis.forEach(k=>doc29+='- '+k+'\n');
doc29+='\n';
// ── Reverse Flow (Domain-Specific) ──
doc29+=(G?'## 逆算フロー（'+domain+'ドメイン特化）':'## Reverse Flow ('+domain+' Domain-Specific)')+'\n\n';
doc29+=G?'ゴールから逆算して、以下の順序で実装を進めます：\n\n':'Working backward from the goal, implement in this order:\n\n';
const flowSteps=G?rf.flow_ja:rf.flow_en;
flowSteps.forEach((step,i)=>{
doc29+=(i+1)+'. **'+step+'**\n';
if(i===0){
doc29+=(G?' - 測定可能なKPIを定義（定量的目標）\n - 目標達成の判断基準を明確化\n':' - Define measurable KPIs (quantitative targets)\n - Clarify success criteria\n')+'\n';
}else if(i===1){
doc29+=(G?' - KPI達成に直結する機能・コンテンツを設計\n - 優先順位付け（Impact × Effort マトリクス）\n':' - Design features/content directly contributing to KPIs\n - Prioritize (Impact × Effort matrix)\n')+'\n';
}else if(i===2){
doc29+=(G?' - 実装スケジュール・タスク分解\n - 依存関係チェーン整理\n':' - Implementation schedule & task decomposition\n - Dependency chain organization\n')+'\n';
}else{
doc29+=(G?' - 自動化・効率化施策\n - 継続的改善サイクル構築\n':' - Automation & efficiency measures\n - Continuous improvement cycle\n')+'\n';
}
});
// ── Implementation-Level Reverse Flow (Industry Playbook) ──
const pb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
if(pb&&pb.impl_ja&&pb.impl_ja.length>0&&pb.impl_ja[0]!==''){
doc29+=(G?'## 実装レベル・リバースフロー（業種特化パターン）':'## Implementation-Level Reverse Flow (Industry-Specific Patterns)')+'\n\n';
doc29+=G?'具体的なデータフロー・ビジネスロジックの実装パターン:\n\n':'Concrete data flow & business logic implementation patterns:\n\n';
const implPatterns=G?pb.impl_ja:pb.impl_en;
implPatterns.forEach((pattern,i)=>{
doc29+=(i+1)+'. '+pattern+'\n\n';
});
}
// ── Milestone Schedule (Mermaid Gantt) ── Dynamic dates from today
const today=new Date();
const formatDate=(d)=>{const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');return y+'-'+m+'-'+day;};
const addDays=(d,days)=>{const r=new Date(d);r.setDate(r.getDate()+days);return r;};
const p1Start=addDays(today,7);
const p1Mid=addDays(today,14);
const p1End=addDays(today,21);
const p2Start=addDays(today,21);
const p2End=addDays(today,35);
const p3Start=addDays(today,35);
const p3End=addDays(today,56);
const p4Start=addDays(today,56);
const p4End=addDays(today,70);
doc29+=(G?'## マイルストーン逆算スケジュール':'## Milestone Reverse Schedule')+'\n\n```mermaid\ngantt\n title '+(G?'ゴール達成までのマイルストーン':'Milestones to Goal Achievement')+'\n dateFormat YYYY-MM-DD\n section '+(G?'Phase 1: 基盤構築':'Phase 1: Foundation')+'\n';
flowSteps.slice(0,2).forEach((step,i)=>{
const start=i===0?formatDate(p1Start):formatDate(p1Mid);
const end=i===0?formatDate(addDays(p1Mid,-1)):formatDate(p1End);
doc29+=' '+step.replace(/[:\-（）()]/g,' ')+' :'+start+', '+end+'\n';
});
doc29+=' section '+(G?'Phase 2: MVP実装':'Phase 2: MVP Implementation')+'\n';
if(flowSteps.length>2){
const step=flowSteps[2];
doc29+=' '+step.replace(/[:\-（）()]/g,' ')+' :'+formatDate(p2Start)+', '+formatDate(p2End)+'\n';
}
doc29+=' section '+(G?'Phase 3: 最適化':'Phase 3: Optimization')+'\n';
if(flowSteps.length>3){
const step=flowSteps[3];
doc29+=' '+step.replace(/[:\-（）()]/g,' ')+' :'+formatDate(p3Start)+', '+formatDate(p3End)+'\n';
}
doc29+=' section '+(G?'Phase 4: ローンチ':'Phase 4: Launch')+'\n';
doc29+=' '+(G?'最終テスト・デプロイ':'Final testing & deploy')+' :milestone, '+formatDate(p4End)+', 0d\n';
doc29+='```\n\n';
// ── Risk & Blocker Analysis ── Use domain-specific prevent strategies
doc29+=(G?'## リスク・ブロッカー分析':'## Risk & Blocker Analysis')+'\n\n';
doc29+='| '+(G?'リスク項目':'Risk Item')+' | '+(G?'影響度':'Impact')+' | '+(G?'発生確率':'Probability')+' | '+(G?'対策':'Mitigation')+' |\n|------|------|------|------|\n';
const risks=G?rf.risks_ja:rf.risks_en;
const playbook=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
const preventList=playbook?(G?playbook.prevent_ja:playbook.prevent_en):[];
risks.forEach((risk,i)=>{
const impact=i===0?'High':(i===1?'Medium':'Low');
const prob=i===0?'Medium':(i===1?'High':'Low');
let mitigation='';
if(preventList&&preventList.length>i){
const preventEntry=preventList[i];
const segments=preventEntry.split(/[:|]/);
if(segments.length>=3){
mitigation=segments[segments.length-1].trim();
}else{
mitigation=segments[segments.length-1].trim();
}
}
if(!mitigation||mitigation===''){
mitigation=G?(i===0?'早期プロトタイプ検証':'定期レビュー会'):(i===0?'Early prototype validation':'Regular review meetings');
}
doc29+='| '+risk+' | '+impact+' | '+prob+' | '+mitigation+' |\n';
});
doc29+='\n';
// ── Progress Tracking ──
doc29+=(G?'## 進捗トラッキング':'## Progress Tracking')+'\n\n';
doc29+=G?'**重要**: `docs/24_progress.md` を使用して実装進捗を記録してください。各マイルストーン完了時にステータスを更新し、ブロッカーがあれば即座に記録してください。\n\n':'**IMPORTANT**: Use `docs/24_progress.md` to track implementation progress. Update status upon milestone completion and log blockers immediately.\n\n';
doc29+=(G?'**推奨ワークフロー**:':'**Recommended Workflow**:')+'\n';
doc29+='1. '+(G?'各Phase開始時: 24_progress.md にスプリント目標を記載':'Phase start: Log sprint goal in 24_progress.md')+'\n';
doc29+='2. '+(G?'実装中: タスク完了ごとにステータス更新':'During implementation: Update status per task completion')+'\n';
doc29+='3. '+(G?'ブロッカー発生時: 25_error_logs.md に原因・対策を記録':'On blocker: Log cause & mitigation in 25_error_logs.md')+'\n';
doc29+='4. '+(G?'Phase完了時: KPI達成度を確認・記録':'Phase complete: Verify & log KPI achievement')+'\n\n';
S.files['docs/29_reverse_engineering.md']=doc29;
// ═══ docs/30_goal_decomposition.md ═══
let doc30='# '+(G?'ゴール分解・ギャップ分析':'Goal Decomposition & Gap Analysis')+'\n\n';
doc30+=G?'**重要**: このドキュメントは、中心ゴールをサブゴール階層に分解し、現状とのギャップ・優先度を明確化します。AIエージェントは、実装順序を決定する際にこのマトリクスを参照してください。\n\n':'**IMPORTANT**: This document decomposes the central goal into sub-goal hierarchies and clarifies gaps & priorities. AI agents MUST reference this matrix when determining implementation order.\n\n';
// ── Goal Tree (Mermaid mindmap) ──
doc30+=(G?'## ゴールツリー':'## Goal Tree')+'\n\n```mermaid\nmindmap\n root(('+(G?rf.goal_ja:rf.goal_en)+'))\n';
// Level 1: Flow steps
flowSteps.slice(0,3).forEach((step,i)=>{
doc30+=' '+step.replace(/[（）()]/g,'')+'\n';
// Level 2: Features (sample 2 per step)
if(i===0&&kpis.length>0){
doc30+=' '+kpis[0].split(' ')[0]+'\n';
if(kpis.length>1)doc30+=' '+kpis[1].split(' ')[0]+'\n';
}else if(i===1&&features.length>0){
doc30+=' '+features[0]+'\n';
if(features.length>1)doc30+=' '+features[1]+'\n';
}else if(i===2&&entities.length>0){
doc30+=' '+entities[0]+(G?' 実装':' implementation')+'\n';
if(entities.length>1)doc30+=' '+entities[1]+(G?' 実装':' implementation')+'\n';
}
});
doc30+='```\n\n';
// ── Sub-Goal Decomposition (3-5 levels) ──
doc30+=(G?'## サブゴール分解（3-5階層）':'## Sub-Goal Decomposition (3-5 Levels)')+'\n\n';
doc30+='### '+(G?'レベル1: 戦略目標':'Level 1: Strategic Goals')+'\n';
flowSteps.slice(0,2).forEach((step,i)=>{
doc30+=(i+1)+'. **'+step+'**\n';
});
doc30+='\n### '+(G?'レベル2: 戦術目標':'Level 2: Tactical Goals')+'\n';
if(features.length>0){
features.slice(0,4).forEach((f,i)=>{
doc30+=(i+1)+'. '+f+'\n';
});
}else{
doc30+='1. '+(G?'MVP機能実装':'MVP feature implementation')+'\n';
doc30+='2. '+(G?'UI/UX最適化':'UI/UX optimization')+'\n';
}
doc30+='\n### '+(G?'レベル3: 実装タスク':'Level 3: Implementation Tasks')+'\n';
if(entities.length>0){
entities.slice(0,3).forEach((ent,i)=>{
doc30+=(i+1)+'. '+ent+(G?' CRUD実装':' CRUD implementation')+'\n';
});
}else{
doc30+='1. '+(G?'データベース設計':'Database design')+'\n';
doc30+='2. '+(G?'API実装':'API implementation')+'\n';
}
doc30+='\n';
// ── Gap Analysis Matrix ──
doc30+=(G?'## ギャップ分析マトリクス':'## Gap Analysis Matrix')+'\n\n';
doc30+='| '+(G?'サブゴール':'Sub-Goal')+' | '+(G?'現状':'Current State')+' | '+(G?'目標':'Target')+' | '+(G?'ギャップ':'Gap')+' | '+(G?'対策':'Action')+' |\n|------|------|------|------|------|\n';
flowSteps.slice(0,3).forEach((step,i)=>{
const current=G?(i===0?'未定義':'未実装'):(i===0?'Undefined':'Not implemented');
const target=G?(i===0?'KPI定義完了':'MVP実装完了'):(i===0?'KPI defined':'MVP implemented');
const gap=G?(i===0?'測定可能な指標が不明':'機能未開発'):(i===0?'Measurable metrics unclear':'Features not developed');
const action=G?(i===0?'24_progress.mdに記載':'開発開始'):(i===0?'Log in 24_progress.md':'Start development');
doc30+='| '+step+' | '+current+' | '+target+' | '+gap+' | '+action+' |\n';
});
doc30+='\n';
// ── Priority Matrix (Impact × Effort) ──
doc30+=(G?'## 優先度マトリクス（Impact × Effort）':'## Priority Matrix (Impact × Effort)')+'\n\n';
doc30+='```\n';
doc30+=' '+(G?'大':'High')+' |\n';
doc30+=' Impact '+(G?'中':'Med')+' '+(G?'🟢P1':'🟢P1')+' | '+(G?'🟡P2':'🟡P2')+'\n';
doc30+=' '+(G?'小':'Low')+' '+(G?'🟡P2':'🟡P2')+' | '+(G?'⚪P3':'⚪P3')+'\n';
doc30+=' ─────┼─────\n';
doc30+=' '+(G?'低':'Low')+' '+(G?'高':'High')+'\n';
doc30+=' Effort\n';
doc30+='```\n\n';
doc30+='**'+(G?'優先順位':'Priority')+'**:\n';
doc30+='- '+(G?'🟢 P1 (高Impact・低Effort): ':'🟢 P1 (High Impact, Low Effort): ')+(flowSteps[0]||'Core feature')+'\n';
doc30+='- '+(G?'🟡 P2 (高Impact・高Effort または 中Impact): ':'🟡 P2 (High Impact & Effort or Med Impact): ')+(flowSteps[1]||'Secondary features')+'\n';
doc30+='- '+(G?'⚪ P3 (低Impact): ':'⚪ P3 (Low Impact): ')+(G?'Nice-to-have機能':'Nice-to-have features')+'\n\n';
// ── Dependency Chain (Mermaid flowchart) ── Stack-aware based on resolveArch
const arch=resolveArch(a);
doc30+=(G?'## 依存関係チェーン':'## Dependency Chain')+'\n\n```mermaid\nflowchart TD\n';
const node1=G?'A[KPI定義]':'A[Define KPIs]';
const node2=G?'B[機能設計]':'B[Design Features]';
let node3,node4,node5,node6,node7;
if(arch.isBaaS){
// BaaS: No traditional API layer, use schema + RLS/Rules
node3=G?'C[スキーマ設計]':'C[Design Schema]';
node4=G?'D[RLS/Rules実装]':'D[Implement RLS/Rules]';
node5=G?'E[UI実装]':'E[Implement UI]';
node6=G?'F[テスト]':'F[Testing]';
node7=G?'G[デプロイ]':'G[Deploy]';
}else if(arch.pattern==='bff'){
// BFF: API Routes within Next.js
node3=G?'C[DB設計]':'C[Design DB]';
node4=G?'D[API Routes実装]':'D[Implement API Routes]';
node5=G?'E[Pages実装]':'E[Implement Pages]';
node6=G?'F[テスト]':'F[Testing]';
node7=G?'G[デプロイ]':'G[Deploy]';
}else{
// Traditional: Separate FE/BE
node3=G?'C[DB設計]':'C[Design DB]';
node4=G?'D[API実装]':'D[Implement API]';
node5=G?'E[UI実装]':'E[Implement UI]';
node6=G?'F[テスト]':'F[Testing]';
node7=G?'G[デプロイ]':'G[Deploy]';
}
doc30+=' '+node1+' --> '+node2+'\n';
doc30+=' '+node2+' --> '+node3+'\n';
doc30+=' '+node3+' --> '+node4+'\n';
doc30+=' '+node4+' --> '+node5+'\n';
doc30+=' '+node5+' --> '+node6+'\n';
doc30+=' '+node6+' --> '+node7+'\n';
doc30+=' style A fill:#4ade80\n';
doc30+=' style B fill:#4ade80\n';
doc30+=' style C fill:#fbbf24\n';
doc30+=' style D fill:#fbbf24\n';
doc30+=' style E fill:#fbbf24\n';
doc30+=' style F fill:#f87171\n';
doc30+=' style G fill:#f87171\n';
doc30+='```\n\n';
doc30+=G?'**凡例**: 🟢 完了 | 🟡 進行中 | 🔴 未着手\n\n':'**Legend**: 🟢 Complete | 🟡 In Progress | 🔴 Not Started\n\n';
// ── Implementation Checklist ──
doc30+=(G?'## 実装チェックリスト':'## Implementation Checklist')+'\n\n';
flowSteps.forEach((step,i)=>{
doc30+='- [ ] **'+step+'**\n';
if(i===0){
doc30+=' - [ ] '+(G?'KPI指標を24_progress.mdに記載':'Log KPI metrics in 24_progress.md')+'\n';
doc30+=' - [ ] '+(G?'測定方法確定（Analytics等）':'Define measurement method (Analytics, etc.)')+'\n';
}else if(i===1){
doc30+=' - [ ] '+(G?'機能要件定義':'Define feature requirements')+'\n';
doc30+=' - [ ] '+(G?'優先度決定':'Determine priority')+'\n';
}else if(i===2){
doc30+=' - [ ] '+(G?'DB/API実装':'Implement DB/API')+'\n';
doc30+=' - [ ] '+(G?'テストケース作成':'Create test cases')+'\n';
}else{
doc30+=' - [ ] '+(G?'自動化スクリプト作成':'Create automation scripts')+'\n';
doc30+=' - [ ] '+(G?'継続的改善ループ構築':'Build continuous improvement loop')+'\n';
}
});
doc30+='\n';
// ═══ C3: Goal Tracking Schema (~4KB) ═══
doc30+=(G?'## Goal Tracking スキーマ':'## Goal Tracking Schema')+'\n\n';
doc30+=G?'**重要**: 目標達成の進捗を追跡するための5テーブル構成。データベースに実装することで、KPIの可視化と継続的改善が可能になります。\n\n':'**IMPORTANT**: 5-table schema for tracking goal progress. Implement in database to enable KPI visualization and continuous improvement.\n\n';
doc30+='### 1. UserGoal\n';
doc30+=(G?'**目的**: ユーザー別・プロジェクト別の目標管理':'**Purpose**: Goal management per user/project')+'\n\n';
doc30+='```sql\n';
doc30+='CREATE TABLE user_goals (\n';
doc30+=' id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc30+=' user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n';
doc30+=' project_id UUID REFERENCES projects(id) ON DELETE CASCADE,\n';
doc30+=' goal_type VARCHAR(50) NOT NULL, -- '+(G?'\'revenue\', \'cvr\', \'mrr\', \'churn\', \'engagement\' 等':'\'revenue\', \'cvr\', \'mrr\', \'churn\', \'engagement\', etc.')+'\n';
doc30+=' target_value DECIMAL(10,2) NOT NULL, -- '+(G?'目標値':'Target value')+'\n';
doc30+=' current_value DECIMAL(10,2) DEFAULT 0, -- '+(G?'現在値':'Current value')+'\n';
doc30+=' deadline DATE,\n';
doc30+=' status VARCHAR(20) DEFAULT \'active\', -- \'active\', \'completed\', \'failed\'\n';
doc30+=' created_at TIMESTAMP DEFAULT NOW(),\n';
doc30+=' updated_at TIMESTAMP DEFAULT NOW()\n';
doc30+=');\n```\n\n';
doc30+='### 2. ReversePlan\n';
doc30+=(G?'**目的**: 目標達成のためのリバースプランニング':'**Purpose**: Reverse planning for goal achievement')+'\n\n';
doc30+='```sql\n';
doc30+='CREATE TABLE reverse_plans (\n';
doc30+=' id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc30+=' goal_id UUID NOT NULL REFERENCES user_goals(id) ON DELETE CASCADE,\n';
doc30+=' title VARCHAR(255) NOT NULL,\n';
doc30+=' description TEXT,\n';
doc30+=' total_steps INT DEFAULT 4, -- '+(G?'標準4ステップ':'Standard 4 steps')+'\n';
doc30+=' completed_steps INT DEFAULT 0,\n';
doc30+=' status VARCHAR(20) DEFAULT \'draft\', -- \'draft\', \'active\', \'completed\'\n';
doc30+=' created_at TIMESTAMP DEFAULT NOW(),\n';
doc30+=' updated_at TIMESTAMP DEFAULT NOW()\n';
doc30+=');\n```\n\n';
doc30+='### 3. PlanStep\n';
doc30+=(G?'**目的**: プランの各ステップ詳細':'**Purpose**: Details of each plan step')+'\n\n';
doc30+='```sql\n';
doc30+='CREATE TABLE plan_steps (\n';
doc30+=' id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc30+=' plan_id UUID NOT NULL REFERENCES reverse_plans(id) ON DELETE CASCADE,\n';
doc30+=' step_order INT NOT NULL, -- 1, 2, 3, 4\n';
doc30+=' title VARCHAR(255) NOT NULL,\n';
doc30+=' description TEXT,\n';
doc30+=' status VARCHAR(20) DEFAULT \'pending\', -- \'pending\', \'in_progress\', \'completed\'\n';
doc30+=' started_at TIMESTAMP,\n';
doc30+=' completed_at TIMESTAMP,\n';
doc30+=' created_at TIMESTAMP DEFAULT NOW(),\n';
doc30+=' updated_at TIMESTAMP DEFAULT NOW(),\n';
doc30+=' UNIQUE(plan_id, step_order)\n';
doc30+=');\n```\n\n';
doc30+='### 4. ProgressTracking\n';
doc30+=(G?'**目的**: KPI進捗の時系列データ':'**Purpose**: Time-series KPI progress data')+'\n\n';
doc30+='```sql\n';
doc30+='CREATE TABLE progress_tracking (\n';
doc30+=' id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc30+=' goal_id UUID NOT NULL REFERENCES user_goals(id) ON DELETE CASCADE,\n';
doc30+=' measured_value DECIMAL(10,2) NOT NULL,\n';
doc30+=' measured_at TIMESTAMP DEFAULT NOW(),\n';
doc30+=' notes TEXT,\n';
doc30+=' created_at TIMESTAMP DEFAULT NOW()\n';
doc30+=');\n\n';
doc30+='CREATE INDEX idx_progress_goal_time ON progress_tracking(goal_id, measured_at DESC);\n';
doc30+='```\n\n';
doc30+='### 5. PlanAdjustment\n';
doc30+=(G?'**目的**: プラン修正履歴（継続的改善）':'**Purpose**: Plan adjustment history (continuous improvement)')+'\n\n';
doc30+='```sql\n';
doc30+='CREATE TABLE plan_adjustments (\n';
doc30+=' id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n';
doc30+=' plan_id UUID NOT NULL REFERENCES reverse_plans(id) ON DELETE CASCADE,\n';
doc30+=' reason TEXT NOT NULL, -- '+(G?'調整理由':'Reason for adjustment')+'\n';
doc30+=' before_value TEXT, -- JSON: '+(G?'調整前の値':'Before values')+'\n';
doc30+=' after_value TEXT, -- JSON: '+(G?'調整後の値':'After values')+'\n';
doc30+=' adjusted_by UUID REFERENCES users(id),\n';
doc30+=' adjusted_at TIMESTAMP DEFAULT NOW()\n';
doc30+=');\n```\n\n';
doc30+=(G?'## スキーマ使用例':'## Schema Usage Example')+'\n\n';
doc30+='```javascript\n';
doc30+='// 1. '+(G?'目標作成':'Create goal')+'\n';
doc30+='const goal = await supabase.from(\'user_goals\').insert({\n';
doc30+=' user_id: userId,\n';
doc30+=' goal_type: \'mrr\',\n';
doc30+=' target_value: 100000, // '+(G?'目標MRR: 10万円/月':'Target MRR: $1000/mo')+'\n';
doc30+=' deadline: \'2026-06-30\',\n';
doc30+='}).select().single();\n\n';
doc30+='// 2. '+(G?'リバースプラン作成':'Create reverse plan')+'\n';
doc30+='const plan = await supabase.from(\'reverse_plans\').insert({\n';
doc30+=' goal_id: goal.id,\n';
doc30+=' title: \'MRR '+flowSteps[0]+'\',\n';
doc30+=' total_steps: 4\n';
doc30+='}).select().single();\n\n';
doc30+='// 3. '+(G?'進捗記録':'Record progress')+'\n';
doc30+='await supabase.from(\'progress_tracking\').insert({\n';
doc30+=' goal_id: goal.id,\n';
doc30+=' measured_value: 45000, // '+(G?'現在のMRR':'Current MRR')+'\n';
doc30+=' notes: \'Month 2 progress\'\n';
doc30+='});\n\n';
doc30+='// 4. '+(G?'目標達成率計算':'Calculate achievement rate')+'\n';
doc30+='const achievementRate = (goal.current_value / goal.target_value) * 100;\n';
doc30+='```\n\n';
S.files['docs/30_goal_decomposition.md']=doc30;
// ═══ C1: Business Model & Monetization (~8KB, conditional) ═══
const hasPay=a.payment&&!isNone(a.payment);
if(hasPay){
const domain=detectDomain(a.purpose)||'_default';
let doc38='# '+pn+' — '+(G?'ビジネスモデル・収益化戦略':'Business Model & Monetization Strategy')+'\n\n';
doc38+=G?'**重要**: このドキュメントはビジネス視点からの収益モデル・価格戦略・コンバージョンファネルを定義します。エンジニアリングとビジネス戦略を接続する重要なドキュメントです。\n\n':'**IMPORTANT**: This document defines revenue model, pricing strategy, and conversion funnel from business perspective. Critical bridge between engineering and business strategy.\n\n';
// Revenue Model Analysis
doc38+=(G?'## 収益モデル分析':'## Revenue Model Analysis')+'\n\n';
const revenueModels={
saas:{model:G?'サブスクリプション':'Subscription',tiers:G?'Free / Pro (¥980/月) / Enterprise (¥9,800/月)':'Free / Pro ($10/mo) / Enterprise ($100/mo)',primary:G?'月次定期課金':'Monthly recurring revenue'},
ec:{model:G?'手数料 + 決済手数料':'Commission + Payment fees',tiers:G?'出品者手数料5% + 決済手数料3.6%':'Seller fee 5% + Payment fee 3.6%',primary:G?'取引総額(GMV)の一定割合':'% of GMV'},
marketplace:{model:G?'取引手数料':'Transaction fees',tiers:G?'出品者5% + 購入者3% or 一律8%':'Seller 5% + Buyer 3% or Flat 8%',primary:G?'成約時手数料':'Commission on completion'},
education:{model:G?'フリーミアム':'Freemium',tiers:G?'無料コンテンツ → プレミアムコース購入':'Free content → Premium course purchase',primary:G?'コース販売 + サブスク':'Course sales + Subscription'},
fintech:{model:G?'取引手数料 + サブスク':'Transaction fees + Subscription',tiers:G?'無料取引(上限あり) / Pro (¥980/月 無制限)':'Free trades (limited) / Pro ($10/mo unlimited)',primary:G?'取引量 + 有料会員':'Transaction volume + Paid members'},
booking:{model:G?'予約手数料':'Booking fees',tiers:G?'予約1件あたり10% or 月額サブスク':'10% per booking or Monthly subscription',primary:G?'予約成立時の手数料':'Commission on booking'},
content:{model:G?'広告 + サブスク':'Ads + Subscription',tiers:G?'無料(広告表示) / プレミアム(¥480/月 広告なし)':'Free (with ads) / Premium ($5/mo ad-free)',primary:G?'広告収益 + 有料会員':'Ad revenue + Paid members'},
community:{model:G?'フリーミアム':'Freemium',tiers:G?'基本無料 / プレミアム機能(¥500/月)':'Free basic / Premium features ($5/mo)',primary:G?'有料会員 + 広告':'Paid members + Ads'}
};
const revModel=revenueModels[domain]||{model:G?'サブスクリプション':'Subscription',tiers:G?'Free / Pro / Enterprise':'Free / Pro / Enterprise',primary:G?'月次定期課金':'Monthly recurring revenue'};
doc38+='**'+(G?'推奨モデル':'Recommended Model')+'** ('+domain+'): '+revModel.model+'\n\n';
doc38+='**'+(G?'料金体系':'Pricing Tiers')+'**:\n'+revModel.tiers+'\n\n';
doc38+='**'+(G?'主要収益源':'Primary Revenue')+'**: '+revModel.primary+'\n\n';
// Pricing Strategy
doc38+=(G?'## 価格戦略':'## Pricing Strategy')+'\n\n';
doc38+='### Tier'+(G?'設計':'Design')+'\n\n';
doc38+='| Tier | '+(G?'価格':'Price')+' | '+(G?'主要機能':'Key Features')+' | '+(G?'ターゲット':'Target')+' |\n';
doc38+='|------|------|------|------|\n';
doc38+='| Free | ¥0 | '+(G?'基本機能・制限あり':'Basic features, limited')+' | '+(G?'個人・お試し':'Personal, trial')+' |\n';
doc38+='| Pro | ¥980/'+( G?'月':'mo')+' | '+(G?'全機能・制限緩和':'All features, relaxed limits')+' | '+(G?'小規模チーム':'Small teams')+' |\n';
doc38+='| Enterprise | ¥9,800/'+( G?'月':'mo')+' | '+(G?'無制限・専用サポート':'Unlimited, dedicated support')+' | '+(G?'大企業':'Enterprise')+' |\n\n';
// Conversion Funnel (Mermaid)
doc38+=(G?'## コンバージョンファネル':'## Conversion Funnel')+'\n\n';
doc38+='```mermaid\ngraph TD\n';
doc38+=' A['+(G?'訪問':'Visit')+' 🌐] -->|30%| B['+(G?'サインアップ':'Signup')+' ✍️]\n';
doc38+=' B -->|60%| C['+(G?'アクティベーション':'Activate')+' ⚡]\n';
doc38+=' C -->|20%| D['+(G?'有料転換':'Convert')+' 💳]\n';
doc38+=' D -->|70%| E['+(G?'継続利用':'Retain')+' 🔁]\n\n';
doc38+=' style A fill:#e1f5ff\n';
doc38+=' style B fill:#fff4e6\n';
doc38+=' style C fill:#e8f5e9\n';
doc38+=' style D fill:#f3e5f5\n';
doc38+=' style E fill:#fce4ec\n';
doc38+='```\n\n';
// KPI per stage
doc38+='### '+(G?'ステージ別KPI':'KPIs per Stage')+'\n\n';
doc38+='| '+(G?'ステージ':'Stage')+' | KPI | '+(G?'目標':'Target')+' | '+(G?'改善施策':'Improvement Actions')+' |\n';
doc38+='|------|------|------|------|\n';
doc38+='| '+(G?'訪問→サインアップ':'Visit→Signup')+' | '+( G?'サインアップ率':'Signup rate')+' | ≥30% | '+(G?'LP最適化・信頼性向上':'Optimize LP, build trust')+' |\n';
doc38+='| '+(G?'サインアップ→アクティベーション':'Signup→Activation')+' | '+(G?'アクティベーション率':'Activation rate')+' | ≥60% | '+(G?'オンボーディング改善':'Improve onboarding')+' |\n';
doc38+='| '+(G?'アクティベーション→有料転換':'Activation→Conversion')+' | '+(G?'有料転換率':'Conversion rate')+' | ≥20% | '+(G?'価値提示・限定オファー':'Show value, limited offer')+' |\n';
doc38+='| '+(G?'有料転換→継続':'Conversion→Retention')+' | '+(G?'継続率':'Retention rate')+' | ≥70% | '+(G?'定期エンゲージメント':'Regular engagement')+' |\n\n';
// Unit Economics
doc38+=(G?'## ユニットエコノミクス':'## Unit Economics')+'\n\n';
doc38+='### '+(G?'概算テンプレート':'Estimation Template')+'\n\n';
doc38+='**CAC** ('+(G?'顧客獲得コスト':'Customer Acquisition Cost')+')\n';
doc38+='- '+(G?'広告費':'Ad spend')+': ¥100,000/'+( G?'月':'mo')+'\n';
doc38+='- '+(G?'新規顧客':'New customers')+': 100/'+( G?'月':'mo')+'\n';
doc38+='- **CAC = ¥1,000/'+( G?'顧客':'customer')+'**\n\n';
doc38+='**LTV** ('+(G?'顧客生涯価値':'Lifetime Value')+')\n';
doc38+='- ARPU ('+(G?'ユーザー単価':'Avg Revenue per User')+'): ¥980/'+( G?'月':'mo')+'\n';
doc38+='- '+(G?'平均利用期間':'Avg lifetime')+': 12'+( G?'ヶ月':'months')+'\n';
doc38+='- **LTV = ¥11,760**\n\n';
doc38+='**LTV/CAC '+(G?'比率':'Ratio')+'**\n';
doc38+='- LTV/CAC = ¥11,760 / ¥1,000 = **11.76**\n';
doc38+='- '+(G?'目標':'Target')+': **≥3** ('+(G?'健全':'healthy')+')\n';
doc38+='- '+(G?'評価':'Assessment')+': ✅ '+(G?'優秀':'Excellent')+'\n\n';
doc38+='**Payback '+(G?'期間':'Period')+'**\n';
doc38+='- CAC / ARPU = ¥1,000 / ¥980 = **1.02'+( G?'ヶ月':'months')+'**\n';
doc38+='- '+(G?'目標':'Target')+': **≤12'+( G?'ヶ月':'months')+'**\n';
doc38+='- '+(G?'評価':'Assessment')+': ✅ '+(G?'優秀':'Excellent')+'\n\n';
// Monetization Tactics
doc38+=(G?'## 収益化戦術':'## Monetization Tactics')+'\n\n';
const domainTactics={
saas:G?['無料トライアル14日','使用量制限で有料誘導','年払い割引(2ヶ月分)']:['14-day free trial','Usage limits to drive upgrades','Annual discount (2mo free)'],
ec:G?['初回注文クーポン','まとめ買い割引','会員ランク制度']:['First order coupon','Bulk purchase discount','Member rank system'],
education:G?['最初の3レッスン無料','修了証発行は有料','コミュニティアクセス(有料)']:['First 3 lessons free','Paid certificate issuance','Premium community access'],
marketplace:G?['初回取引手数料無料','大口出品者割引','プレミアム掲載']:['First transaction fee-free','Volume seller discount','Premium listings'],
fintech:G?['少額取引無料','即時送金は有料','投資アドバイス(有料)']:['Small transaction free','Instant transfer paid','Investment advice (paid)']
};
const tactics=domainTactics[domain]||(G?['無料トライアル','使用量制限','年払い割引']:['Free trial','Usage limits','Annual discount']);
tactics.forEach((tactic,i)=>{
doc38+=(i+1)+'. **'+tactic+'**\n';
});
doc38+='\n';
// Growth Levers
const rfMap=REVERSE_FLOW_MAP[domain]||REVERSE_FLOW_MAP._default;
doc38+=(G?'## 成長レバー':'## Growth Levers')+'\n\n';
doc38+=G?'このドメインの主要なKPI（目標値は docs/30_goal_decomposition.md 参照）:\n\n':'Key KPIs for this domain (targets in docs/30_goal_decomposition.md):\n\n';
const kpis=G?rfMap.kpi_ja:rfMap.kpi_en;
kpis.forEach((kpi,i)=>{
doc38+=(i+1)+'. '+kpi+'\n';
});
doc38+='\n';
// Related Documents
doc38+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc38+='- **docs/30_goal_decomposition.md** — '+(G?'目標分解とKPI':'Goal decomposition & KPIs')+'\n';
doc38+='- **.spec/constitution.md** — '+(G?'プロジェクトビジョン':'Project vision')+'\n';
doc38+='- **docs/24_progress.md** — '+(G?'進捗追跡':'Progress tracking')+'\n';
doc38+='- **docs/05_api_design.md** — '+(G?'決済API実装':'Payment API implementation')+'\n\n';
S.files['docs/38_business_model.md']=doc38;
}
// ═══ C2: Growth Intelligence (always generated) ═══
const gdomain=detectDomain(a.purpose)||'_default';
const gd=DOMAIN_GROWTH[gdomain]||DOMAIN_GROWTH._default;
let doc41='# '+pn+' — '+(G?'グロースインテリジェンス':'Growth Intelligence')+'\n\n';
// Section 1: Stack Compatibility Score
const syn=calcSynergy(a);
doc41+='## '+(G?'1. スタック相性スコア':'1. Tech Stack Compatibility Score')+'\n\n';
doc41+='| '+(G?'次元':'Dimension')+' | '+(G?'スコア':'Score')+' | '+(G?'説明':'Description')+' |\n|-----|-------|------|\n';
const dimNames=G?['FE↔BE親和性','エコシステム統一性','ドメイン適合度','デプロイ整合性','複雑度バランス']:['FE↔BE Affinity','Ecosystem Unity','Domain Fit','Deploy Alignment','Complexity Balance'];
[syn.d1,syn.d2,syn.d3,syn.d4,syn.d5].forEach((s,i)=>{
doc41+='| '+dimNames[i]+' | '+s+'/100 | '+(s>=80?(G?'✅ 良好':'✅ Good'):s>=60?(G?'⚠️ 改善余地':'⚠️ Room to improve'):(G?'❌ 要対策':'❌ Action needed'))+' |\n';
});
doc41+='\n'+(G?'**総合スタックスコア**: ':'**Overall Stack Score**: ')+syn.overall+'/100\n\n';
// Compat warnings
const cw=checkCompat(a);
if(cw.length>0){
doc41+='### '+(G?'互換性アラート':'Compatibility Alerts')+'\n\n';
cw.slice(0,8).forEach(r=>{
doc41+='- '+(r.severity==='error'?'❌':'⚠️')+' **'+r.id+'**: '+(G?r.msg_ja:r.msg_en)+'\n';
});
doc41+='\n';
}
// Section 2: Growth Funnel (Mermaid)
const stages=G?gd.fj:gd.fe;
doc41+='## '+(G?'2. ドメイン別グロースファネル':'2. Domain Growth Funnel')+'\n\n';
doc41+='```mermaid\ngraph LR\n';
stages.forEach((s,i)=>{
if(i<stages.length-1) doc41+=' S'+i+'["'+s+' ('+gd.cvr[i]+'%)"] --> S'+(i+1)+'["'+stages[i+1]+' ('+gd.cvr[i+1]+'%)"]\n';
});
doc41+='```\n\n';
doc41+='| '+(G?'ステージ':'Stage')+' | '+(G?'ベンチマーク':'Benchmark')+' | '+(G?'前段からのCVR':'Stage CVR')+' |\n|--------|-----------|----------|\n';
stages.forEach((s,i)=>{
const cvr=i===0?'-':((gd.cvr[i]/gd.cvr[i-1]*100).toFixed(1)+'%');
doc41+='| '+s+' | '+gd.cvr[i]+'% | '+cvr+' |\n';
});
doc41+='\n';
// Section 3: Growth Equation
doc41+='## '+(G?'3. グロース方程式':'3. Growth Equation')+'\n\n';
doc41+='```\n'+gd.eq+'\n```\n\n';
doc41+=(G?'**感度分析**: 各変数を10%改善すると、全体収益は約10%向上（複利効果で実際はそれ以上）。複数のレバーを同時に改善することで掛け算的成長が可能。\n\n':'**Sensitivity**: Improving each variable by 10% yields ~10% revenue lift (compounding makes it higher). Simultaneously improving multiple levers creates multiplicative growth.\n\n');
// Section 4: Growth Levers
const levers=G?gd.lj:gd.le;
doc41+='## '+(G?'4. グロースレバー（優先順）':'4. Growth Levers (Prioritized)')+'\n\n';
levers.forEach((l,i)=>{doc41+=(i+1)+'. '+l+'\n';});
doc41+='\n';
// Section 5: Pricing Strategy
doc41+='## '+(G?'5. 価格戦略（松竹梅モデル）':'5. Pricing Strategy (Three-Tier Model)')+'\n\n';
const prices=G?gd.pj:gd.pe;
const tierNames=G?['🥉 松（エントリー）','🥈 竹（メイン）★推奨','🥇 梅（プレミアム）']:['🥉 Good (Entry)','🥈 Better (Main) ★Recommended','🥇 Best (Premium)'];
doc41+='| '+(G?'ティア':'Tier')+' | '+(G?'価格帯':'Price Range')+' |\n|------|------|\n';
prices.forEach((p,i)=>{doc41+='| '+tierNames[i]+' | '+p+' |\n';});
doc41+='\n'+(G?'> **心理効果**: 3択を提示すると中間（竹）が選ばれやすい（妥協効果）。最上位は「アンカー」として竹の割安感を演出する。\n\n':'> **Psychology**: Presenting 3 options makes the middle tier most popular (compromise effect). The top tier serves as an anchor to make the middle tier feel like good value.\n\n');
// Section 6: Performance Budget
doc41+='## '+(G?'6. パフォーマンス予算':'6. Performance Budget')+'\n\n';
doc41+='| '+(G?'指標':'Metric')+' | '+(G?'目標':'Target')+' | '+(G?'ビジネスインパクト':'Business Impact')+' |\n|------|------|-------|\n';
doc41+='| LCP | < 2.5s | '+(G?'離脱率-25%':'Bounce rate -25%')+' |\n';
doc41+='| FID | < 100ms | '+(G?'UXスコア+20pt':'UX score +20pt')+' |\n';
doc41+='| CLS | < 0.1 | '+(G?'信頼性+15%':'Trust +15%')+' |\n';
doc41+='| '+(G?'初回バンドル':'Initial Bundle')+' | < 200KB (gzip) | '+(G?'FCP改善':'FCP improvement')+' |\n\n';
// Tech-specific tips
const fe=a.frontend||'';
if(fe.includes('Next')){
doc41+=(G?'**Next.js最適化**: ISR活用, next/image, Edge Middleware, Server Components優先\n\n':'**Next.js Optimization**: Use ISR, next/image, Edge Middleware, prefer Server Components\n\n');
}else if(fe.includes('Vue')||fe.includes('Nuxt')){
doc41+=(G?'**Vue/Nuxt最適化**: Lazy Hydration, コンポーネント分割, auto-imports\n\n':'**Vue/Nuxt Optimization**: Lazy Hydration, component splitting, auto-imports\n\n');
}else{
doc41+=(G?'**SPA最適化**: React.lazy + Suspense, ルート分割, Dynamic Import\n\n':'**SPA Optimization**: React.lazy + Suspense, route splitting, Dynamic Import\n\n');
}
// Section 7: Cross-references
doc41+='## '+(G?'7. 関連ドキュメント':'7. Related Documents')+'\n\n';
doc41+='- **docs/30_goal_decomposition.md** — '+(G?'目標分解とKPI':'Goal decomposition & KPIs')+'\n';
doc41+='- **docs/38_business_model.md** — '+(G?'ビジネスモデル詳細（決済設定時）':'Business model details (when payment configured)')+'\n';
doc41+='- **docs/24_progress.md** — '+(G?'進捗追跡':'Progress tracking')+'\n';
doc41+='- **docs/28_qa_strategy.md** — '+(G?'品質戦略':'QA strategy')+'\n\n';
S.files['docs/41_growth_intelligence.md']=doc41;
}
/* ═══ Pillar 11: Implementation Intelligence ═══ */

function genPillar11_ImplIntelligence(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'_default';
const appType=detectAppType(a);
const aiLevel=a.ai_auto||'none';
const frontend=a.frontend||'React + Vite';
const backend=a.backend||'Supabase';
const db=a.database||'PostgreSQL';
// ── docs/39_implementation_playbook.md ──
const pattern=DOMAIN_IMPL_PATTERN[domain]||DOMAIN_IMPL_PATTERN._default;
const appTypePattern=APP_TYPE_MAP[appType]||APP_TYPE_MAP.spa;
const entities=(a.data_entities||'User').split(',').map(e=>e.trim());
let doc39='';
doc39+='# '+(G?'実装プレイブック':'Implementation Playbook')+'\n\n';
doc39+=(G?'**プロジェクト**：':'**Project**: ')+pn+'\n';
doc39+=(G?'**業種**：':'**Domain**: ')+(G?'検知結果 - ':'Detected - ')+domain+'\n';
doc39+=(G?'**アプリタイプ**：':'**App Type**: ')+appType+'\n';
doc39+=(G?'**生成日**：':'**Generated**: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc39+='---\n\n';
// 1. Domain-Specific Implementation Patterns
doc39+='## '+(G?'1. 業種別実装パターン':'1. Domain-Specific Implementation Patterns')+'\n\n';
doc39+='### '+(G?'推奨実装手法':'Recommended Practices')+'\n';
(G?pattern.impl_ja:pattern.impl_en).forEach((p,i)=>{
doc39+=(i+1)+'. '+p+'\n';
});
doc39+='\n### '+(G?'ガードレール（防止すべき典型バグ）':'Guard Rails (Typical Bugs to Prevent)')+'\n';
(G?pattern.guard_ja:pattern.guard_en).forEach((g,i)=>{
doc39+='- ❌ '+g+'\n';
});
doc39+='\n### '+(G?'擬似コードテンプレート':'Pseudo-code Template')+'\n';
doc39+='```javascript\n';
doc39+=pattern.pseudo+'\n';
doc39+='```\n\n';
// 2. Stack-Specific Guidance
doc39+='## '+(G?'2. スタック固有ガイダンス':'2. Stack-Specific Guidance')+'\n\n';
doc39+='### '+(G?'フロントエンド：':'Frontend: ')+frontend+'\n';
if(frontend.includes('Next')){
doc39+=(G?'- App Routerを使用（Pages Routerは非推奨）\n':'- Use App Router (Pages Router deprecated)\n');
doc39+=(G?'- サーバーコンポーネントを優先、クライアントコンポーネントは必要最小限\n':'- Prefer Server Components, minimize Client Components\n');
doc39+=(G?'- データフェッチはasync/await直接記述\n':'- Data fetching with async/await directly\n');
}else if(frontend.includes('Vite')||frontend.includes('SPA')){
doc39+=(G?'- 状態管理はZustand推奨（Reduxは大規模のみ）\n':'- State management with Zustand (Redux for large-scale only)\n');
doc39+=(G?'- コード分割はReact.lazy+Suspense\n':'- Code splitting with React.lazy + Suspense\n');
doc39+=(G?'- ビルド最適化はVite plugin-react-swc\n':'- Build optimization with Vite plugin-react-swc\n');
}else if(frontend.includes('Vue')){
doc39+=(G?'- Composition API優先\n':'- Prefer Composition API\n');
doc39+=(G?'- 状態管理はPinia\n':'- State management with Pinia\n');
doc39+=(G?'- TypeScript strict mode推奨\n':'- Recommend TypeScript strict mode\n');
}
doc39+='\n### '+(G?'バックエンド：':'Backend: ')+backend+'\n';
if(backend.includes('Supabase')){
doc39+=(G?'- Row Level Security (RLS)を全テーブルに設定\n':'- Set Row Level Security (RLS) on all tables\n');
doc39+=(G?'- Supabase Edgeは軽量処理のみ（重い処理は別途API）\n':'- Supabase Edge for lightweight tasks only (heavy tasks in separate API)\n');
doc39+=(G?'- Realtime subscriptionsは必要最小限（コスト注意）\n':'- Minimize Realtime subscriptions (cost consideration)\n');
}else if(backend.includes('Firebase')){
doc39+=(G?'- Firestore Security Rulesを厳格に設定\n':'- Strictly configure Firestore Security Rules\n');
doc39+=(G?'- Cloud Functionsは第2世代推奨\n':'- Recommend Cloud Functions Gen 2\n');
doc39+=(G?'- コスト最適化：読み取り回数削減、複合クエリ活用\n':'- Cost optimization: reduce reads, use composite queries\n');
}else if(backend.includes('Node')){
doc39+=(G?'- Express middlewareでバリデーション統一\n':'- Unified validation with Express middleware\n');
doc39+=(G?'- エラーハンドリングは集約ハンドラ\n':'- Centralized error handler\n');
doc39+=(G?'- 環境変数は.envで管理、dotenv-safe推奨\n':'- Manage env vars with .env, recommend dotenv-safe\n');
}
doc39+='\n### '+(G?'データベース：':'Database: ')+db+'\n';
if(db.includes('PostgreSQL')){
doc39+=(G?'- マイグレーションツールはPrisma/Drizzle\n':'- Migration tool: Prisma/Drizzle\n');
doc39+=(G?'- インデックスは外部キー・検索条件カラムに必須\n':'- Indexes required on FKs and search columns\n');
doc39+=(G?'- トランザクション分離レベルはREAD COMMITTED（デフォルト）\n':'- Transaction isolation: READ COMMITTED (default)\n');
}else if(db.includes('MongoDB')){
doc39+=(G?'- スキーマ検証はMongooseで定義\n':'- Schema validation with Mongoose\n');
doc39+=(G?'- インデックスはクエリパフォーマンス分析後に作成\n':'- Create indexes after query performance analysis\n');
doc39+=(G?'- 大規模データはシャーディング検討\n':'- Consider sharding for large-scale data\n');
}
doc39+='\n';
// 3. App Type Best Practices
doc39+='## '+(G?'3. アプリタイプ別ベストプラクティス':'3. App Type Best Practices')+'\n\n';
doc39+='### '+(G?'推奨パターン':'Recommended Patterns')+' ('+appType+')\n';
(G?appTypePattern.patterns_ja:appTypePattern.patterns_en).forEach(p=>{
doc39+='- ✅ '+p+'\n';
});
doc39+='\n### '+(G?'アンチパターン（避けるべき）':'Anti-patterns (Avoid)')+'\n';
(G?appTypePattern.antipatterns_ja:appTypePattern.antipatterns_en).forEach(ap=>{
doc39+='- ⚠️ '+ap+'\n';
});
doc39+='\n';
// 4. Entity-Specific Pseudo-code
doc39+='## '+(G?'4. エンティティ別擬似コード':'4. Entity-Specific Pseudo-code')+'\n\n';
entities.slice(0,3).forEach(ent=>{
const cols=getEntityColumns(ent,G,entities);
if(!cols||cols.length===0){
doc39+='### '+ent+'\n';
doc39+=(G?'※ 未定義エンティティ。ENTITY_COLUMNSに追加してください。\n\n':'※ Undefined entity. Add to ENTITY_COLUMNS.\n\n');
return;
}
const methods=getEntityMethods(ent)||['GET','POST','PUT','DELETE'];
doc39+='### '+ent+'\n';
doc39+='```javascript\n';
if(methods.includes('POST')){
doc39+='// CREATE\n';
doc39+='async function create'+ent+'(data) {\n';
doc39+=' validateInput(data); // '+(G?'入力検証':'Input validation')+'\n';
doc39+=' const result = await db.insert("'+pluralize(ent)+'", data);\n';
doc39+=' logAudit("CREATE_'+ent.toUpperCase()+'", result.id); // '+(G?'監査ログ':'Audit log')+'\n';
doc39+=' return result;\n';
doc39+='}\n\n';
}
if(methods.includes('GET')){
doc39+='// READ\n';
doc39+='async function get'+ent+'(id) {\n';
doc39+=' const result = await db.query("SELECT * FROM '+pluralize(ent)+' WHERE id = ?", [id]);\n';
doc39+=' if (!result) throw new NotFoundError();\n';
doc39+=' return result;\n';
doc39+='}\n\n';
}
if(methods.includes('PUT')){
doc39+='// UPDATE\n';
doc39+='async function update'+ent+'(id, data) {\n';
doc39+=' validateInput(data);\n';
doc39+=' await db.transaction(async () => {\n';
doc39+=' const current = await db.query("SELECT * FROM '+pluralize(ent)+' WHERE id = ? FOR UPDATE", [id]);\n';
doc39+=' await db.execute("UPDATE '+pluralize(ent)+' SET ... WHERE id = ?", [..., id]);\n';
doc39+=' logAudit("UPDATE_'+ent.toUpperCase()+'", id);\n';
doc39+=' });\n';
doc39+='}\n\n';
}
if(methods.includes('DELETE')){
doc39+='// DELETE (Soft delete recommended)\n';
doc39+='async function delete'+ent+'(id) {\n';
doc39+=' await db.execute("UPDATE '+pluralize(ent)+' SET deleted_at = NOW() WHERE id = ?", [id]);\n';
doc39+=' logAudit("DELETE_'+ent.toUpperCase()+'", id);\n';
doc39+='}\n';
}
doc39+='```\n\n';
});
// 5. Cross-Cutting Concerns Checklist
doc39+='## '+(G?'5. 横断的関心事チェックリスト':'5. Cross-Cutting Concerns Checklist')+'\n\n';
Object.entries(CROSS_CUTTING_IMPL).forEach(([key,val])=>{
const title={auth:G?'認証・認可':'Auth',error:G?'エラーハンドリング':'Error Handling',cache:G?'キャッシュ':'Cache',i18n:G?'国際化':'i18n',audit:G?'監査ログ':'Audit Log',upload:G?'ファイルアップロード':'File Upload',rate:G?'レート制限':'Rate Limiting',validation:G?'入力検証':'Validation'}[key]||key;
doc39+='### '+title+'\n';
(G?val.ja:val.en).forEach(item=>{
doc39+='- [ ] '+item+'\n';
});
doc39+='\n';
});
doc39+='---\n';
doc39+=(G?'*このプレイブックはDevForge v9が自動生成しました。プロジェクト固有の要件に応じて調整してください。*\n':'*This playbook was auto-generated by DevForge v9. Adjust according to project-specific requirements.*\n');
S.files['docs/39_implementation_playbook.md']=doc39;
// ── docs/40_ai_dev_runbook.md ──
let doc40='';
doc40+='# '+(G?'AI開発運用手順書':'AI Development Runbook')+'\n\n';
doc40+=(G?'**プロジェクト**：':'**Project**: ')+pn+'\n';
doc40+=(G?'**AIレベル**：':'**AI Level**: ')+aiLevel+'\n';
doc40+=(G?'**生成日**：':'**Generated**: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc40+='---\n\n';
// 1. AI Operation Workflow
doc40+='## '+(G?'1. AI運用ワークフロー':'1. AI Operation Workflow')+'\n\n';
if(aiLevel==='none'||aiLevel==='なし'){
doc40+=(G?'※ AIレベルが「なし」のため、基本的なフローのみ記載します。\n\n':'※ AI level is "none", only basic flow described.\n\n');
doc40+='### '+(G?'基本フロー':'Basic Flow')+'\n';
doc40+='1. '+(G?'仕様書レビュー（手動）':'Manual spec review')+'\n';
doc40+='2. '+(G?'実装（コード記述）':'Implementation (coding)')+'\n';
doc40+='3. '+(G?'テスト実行':'Run tests')+'\n';
doc40+='4. '+(G?'デプロイ':'Deploy')+'\n';
}else{
doc40+='### '+(G?'Write → Select → Compress → Isolate サイクル':'Write → Select → Compress → Isolate Cycle')+'\n\n';
doc40+='#### Phase 1: Write (仕様生成)\n';
doc40+=(G?'- AI Brief (`AI_BRIEF.md`) を読み込み\n':'- Load AI Brief (`AI_BRIEF.md`)\n');
doc40+=(G?'- SDD仕様書 (`.spec/constitution.md`) を確認\n':'- Review SDD specs (`.spec/constitution.md`)\n');
doc40+=(G?'- 実装プレイブック (`docs/39_implementation_playbook.md`) で業種別パターン確認\n':'- Check domain patterns in Implementation Playbook (`docs/39_implementation_playbook.md`)\n');
doc40+=(G?'- タスク分解：`docs/30_goal_decomposition.md` 参照\n':'- Task decomposition: refer to `docs/30_goal_decomposition.md`\n');
doc40+='\n#### Phase 2: Select (ファイル選択)\n';
doc40+=(G?'- **タスク別ファイル選択マトリクス**を使用（下記参照）\n':'- Use **Task-Specific File Selection Matrix** (see below)\n');
doc40+=(G?'- トークン見積もり：1ファイル = 平均500-2000トークン\n':'- Token estimate: 1 file = avg 500-2000 tokens\n');
doc40+=(G?'- 優先度：仕様書 > エンティティ定義 > 実装ガイド > テストケース\n':'- Priority: Specs > Entity definitions > Impl guide > Test cases\n');
doc40+='\n#### Phase 3: Compress (コンテキスト圧縮)\n';
doc40+=(G?'- コンテキスト使用量80%超過時に発動\n':'- Activate when context usage exceeds 80%\n');
doc40+=(G?'- 圧縮対象：過去の会話履歴、参照済みファイルの要約化\n':'- Compress: past conversation history, summarize referenced files\n');
doc40+=(G?'- 保持対象：現在のタスク、直近のエラーログ\n':'- Preserve: current task, recent error logs\n');
doc40+='\n#### Phase 4: Isolate (サブエージェント分離)\n';
doc40+=(G?'- 独立タスクは専用エージェントに委譲\n':'- Delegate independent tasks to specialized agents\n');
doc40+=(G?'- ハンドオフ時はサマリーのみ共有（詳細は不要）\n':'- Share only summary on handoff (details unnecessary)\n');
doc40+=(G?'- エージェント間引継ぎ：YAMLフォーマット（`AGENTS.md`参照）\n':'- Inter-agent handoff: YAML format (see `AGENTS.md`)\n');
doc40+='\n';
}

// 2. File Selection Matrix
doc40+='## '+(G?'2. タスク別ファイル選択マトリクス':'2. Task-Specific File Selection Matrix')+'\n\n';
doc40+='| '+(G?'タスクタイプ':'Task Type')+' | '+(G?'必読ファイル':'Must-Read Files')+' | '+(G?'推奨ファイル':'Recommended Files')+' |\n';
doc40+='|---|---|---|\n';
doc40+='| '+(G?'新機能実装':'New Feature')+' | `.spec/constitution.md`, `docs/04_er_diagram.md`, `docs/39_implementation_playbook.md` | `docs/26_design_system.md`, `docs/06_screen_design.md` |\n';
doc40+='| '+(G?'バグ修正':'Bug Fix')+' | `docs/25_error_logs.md`, `docs/37_bug_prevention.md`, `docs/07_test_cases.md` | `docs/34_incident_response.md`, `docs/33_test_matrix.md` |\n';
doc40+='| '+(G?'テスト追加':'Add Tests')+' | `docs/07_test_cases.md`, `docs/36_test_strategy.md`, `docs/33_test_matrix.md` | `.spec/verification.md`, `docs/28_qa_strategy.md` |\n';
doc40+='| '+(G?'リファクタリング':'Refactoring')+' | `docs/03_architecture.md`, `docs/39_implementation_playbook.md` | `docs/26_design_system.md`, `CLAUDE.md` |\n';
doc40+='| '+(G?'ドキュメント更新':'Doc Update')+' | `.spec/specification.md`, `docs/24_progress.md` | `docs/31_industry_playbook.md`, `AI_BRIEF.md` |\n';
doc40+='| '+(G?'API実装':'API Impl')+' | `docs/05_api_design.md`, `docs/04_er_diagram.md`, `docs/08_security.md` | `docs/39_implementation_playbook.md`, `docs/28_qa_strategy.md` |\n';
doc40+='\n';
// 3. Error Recovery Protocol
doc40+='## '+(G?'3. エラー復旧プロトコル':'3. Error Recovery Protocol')+'\n\n';
doc40+='### '+(G?'業種別典型エラーと対処法':'Domain-Specific Typical Errors & Solutions')+'\n\n';
const domainErrors={
education:{ja:'進捗率100%超過 → イベントソーシングの集計ロジック確認',en:'Progress >100% → Check event sourcing aggregation logic'},
ec:{ja:'在庫マイナス → 楽観的ロックのversion列チェック漏れ',en:'Negative stock → Missing optimistic lock version check'},
fintech:{ja:'残高不一致 → トランザクション境界の見直し',en:'Balance mismatch → Review transaction boundaries'},
health:{ja:'同意なしアクセス → hasConsent()の条件分岐追加',en:'Unauthorized access → Add hasConsent() condition'},
marketplace:{ja:'手数料計算エラー → サーバーサイド検証の強化',en:'Fee calculation error → Strengthen server-side validation'},
_default:{ja:'データ不整合 → トランザクション漏れ確認',en:'Data inconsistency → Check missing transactions'}
};
const errMsg=domainErrors[domain]||domainErrors._default;
doc40+='**'+domain+'**: '+(G?errMsg.ja:errMsg.en)+'\n\n';
doc40+='### '+(G?'一般的エラー対処フロー':'General Error Handling Flow')+'\n';
doc40+='1. '+(G?'`docs/25_error_logs.md` にエラー記録':'Record error in `docs/25_error_logs.md`')+'\n';
doc40+='2. '+(G?'`docs/37_bug_prevention.md` のチェックリスト確認':'Check checklist in `docs/37_bug_prevention.md`')+'\n';
doc40+='3. '+(G?'該当ファイルの修正':'Fix relevant files')+'\n';
doc40+='4. '+(G?'テスト追加（再発防止）':'Add tests (prevent recurrence)')+'\n';
doc40+='5. '+(G?'`docs/24_progress.md` に対応記録':'Record response in `docs/24_progress.md`')+'\n';
doc40+='\n';
// 4. Context Management Strategy
doc40+='## '+(G?'4. コンテキスト管理戦略':'4. Context Management Strategy')+'\n\n';
doc40+='### '+(G?'トークン予算配分':'Token Budget Allocation')+'\n';
doc40+='- '+(G?'タスク指示・会話：40%':'Task instructions & conversation: 40%')+'\n';
doc40+='- '+(G?'仕様書・設計：30%':'Specs & design: 30%')+'\n';
doc40+='- '+(G?'実装ガイド・進捗：20%':'Impl guide & progress: 20%')+'\n';
doc40+='- '+(G?'バッファ（エラーログなど）：10%':'Buffer (error logs, etc.): 10%')+'\n';
doc40+='\n### '+(G?'圧縮タイミング':'Compression Timing')+'\n';
doc40+='- '+(G?'コンテキスト使用量 < 50%：圧縮不要':'Context usage < 50%: No compression needed')+'\n';
doc40+='- '+(G?'50% ~ 80%：過去の会話履歴を要約':'50% ~ 80%: Summarize past conversation')+'\n';
doc40+='- '+(G?'80% ~ 95%：参照ファイルを要約、古いエラーログ削除':'80% ~ 95%: Summarize files, delete old error logs')+'\n';
doc40+='- '+(G?'95%超：サブエージェント分離またはタスク分割':'> 95%: Isolate sub-agent or split task')+'\n';
doc40+='\n';
// 5. Agent Handoff Protocol
if(aiLevel==='multi'||aiLevel==='full'||aiLevel==='orch'){
doc40+='## '+(G?'5. エージェント間ハンドオフ手順':'5. Agent Handoff Protocol')+'\n\n';
doc40+=(G?'詳細は `AGENTS.md` の「Agent Specialization Matrix」参照。\n\n':'See `AGENTS.md` "Agent Specialization Matrix" for details.\n\n');
doc40+='### '+(G?'ハンドオフYAMLフォーマット':'Handoff YAML Format')+'\n';
doc40+='```yaml\n';
doc40+='from_agent: planning\n';
doc40+='to_agent: implementation\n';
doc40+='task: Implement User authentication flow\n';
doc40+='context:\n';
doc40+=' entities: [User, Session]\n';
doc40+=' auth_method: Supabase Auth\n';
doc40+=' files_to_read:\n';
doc40+=' - .spec/constitution.md\n';
doc40+=' - docs/04_er_diagram.md\n';
doc40+=' - docs/39_implementation_playbook.md\n';
doc40+='status: pending\n';
doc40+='```\n\n';
}

doc40+='---\n';
doc40+=(G?'*この運用手順書はDevForge v9が自動生成しました。AIレベルに応じて適宜カスタマイズしてください。*\n':'*This runbook was auto-generated by DevForge v9. Customize according to AI level.*\n');
S.files['docs/40_ai_dev_runbook.md']=doc40;
// ── skills/impl-patterns.md (conditional) ──
if(aiLevel!=='none'&&aiLevel!=='なし'){
let skillDoc='';
skillDoc+='# '+(G?'実装パターンスキルカタログ':'Implementation Patterns Skill Catalog')+'\n\n';
skillDoc+=(G?'> Manus Skills形式の実装スキル定義\n\n':'> Implementation skills in Manus Skills format\n\n');
skillDoc+='**'+(G?'業種':'Domain')+'**: '+domain+'\n';
skillDoc+='**'+(G?'スタック':'Stack')+'**: '+frontend+' + '+backend+'\n\n';
skillDoc+='---\n\n';
// Thinking Axis for Domain
skillDoc+='## '+(G?'思考軸（Thinking Axis）':'Thinking Axis')+'\n\n';
const thinkingAxis={
education:{ja:['学習進捗の可視化','コンテンツの段階的解放','修了判定の厳格性'],en:['Visualize learning progress','Gradual content unlocking','Strict completion criteria']},
ec:{ja:['在庫の正確性','決済の冪等性','カート放棄防止'],en:['Inventory accuracy','Payment idempotency','Cart abandonment prevention']},
fintech:{ja:['トランザクション整合性','監査ログの完全性','コンプライアンス準拠'],en:['Transaction consistency','Audit log completeness','Compliance adherence']},
health:{ja:['患者データ保護','同意管理','アクセス監査'],en:['Patient data protection','Consent management','Access auditing']},
_default:{ja:['データ整合性','セキュリティ','ユーザー体験'],en:['Data integrity','Security','User experience']}
};
const axis=(thinkingAxis[domain]||thinkingAxis._default);
(G?axis.ja:axis.en).forEach((a,i)=>{
skillDoc+=(i+1)+'. '+a+'\n';
});
skillDoc+='\n';
// 4-Layer Skills
skillDoc+='## '+(G?'4層スキル構造':'4-Layer Skill Structure')+'\n\n';
const layers=[
{id:'planning',name_ja:'企画層',name_en:'Planning',skills_ja:['要件定義','技術選定'],skills_en:['Requirement definition','Tech stack selection']},
{id:'design',name_ja:'設計層',name_en:'Design',skills_ja:['ER設計','API設計'],skills_en:['ER design','API design']},
{id:'production',name_ja:'制作層',name_en:'Production',skills_ja:['実装','テスト'],skills_en:['Implementation','Testing']},
{id:'operations',name_ja:'運用層',name_en:'Operations',skills_ja:['モニタリング','インシデント対応'],skills_en:['Monitoring','Incident response']}
];
layers.forEach(layer=>{
skillDoc+='### '+(G?layer.name_ja:layer.name_en)+'\n';
(G?layer.skills_ja:layer.skills_en).forEach(sk=>{
skillDoc+='- '+sk+'\n';
});
skillDoc+='\n';
});
// Detailed Skill: Domain-Specific Implementation
skillDoc+='## '+(G?'詳細スキル：業種別実装':'Detailed Skill: Domain Implementation')+'\n\n';
skillDoc+='### '+(G?'スキル名':'Skill Name')+'\n';
skillDoc+='**'+domain+' Implementation Pattern**\n\n';
skillDoc+='### Input\n';
skillDoc+='- '+(G?'エンティティ定義 (`docs/04_er_diagram.md`)':'Entity definitions (`docs/04_er_diagram.md`)')+'\n';
skillDoc+='- '+(G?'機能要件 (`.spec/constitution.md`)':'Feature requirements (`.spec/constitution.md`)')+'\n';
skillDoc+='- '+(G?'実装プレイブック (`docs/39_implementation_playbook.md`)':'Implementation playbook (`docs/39_implementation_playbook.md`)')+'\n';
skillDoc+='\n### Process\n';
skillDoc+='1. '+(G?'業種別パターンを確認':'Review domain-specific patterns')+'\n';
skillDoc+='2. '+(G?'擬似コードをプロジェクトエンティティに適用':'Apply pseudo-code to project entities')+'\n';
skillDoc+='3. '+(G?'ガードレール（典型バグ）を考慮した実装':'Implement considering guard rails (typical bugs)')+'\n';
skillDoc+='4. '+(G?'横断的関心事チェックリストで検証':'Validate with cross-cutting concerns checklist')+'\n';
skillDoc+='\n### Output\n';
skillDoc+='- '+(G?'実装コード（CRUD + ビジネスロジック）':'Implementation code (CRUD + business logic)')+'\n';
skillDoc+='- '+(G?'テストケース（ガードレール検証含む）':'Test cases (including guard rail validation)')+'\n';
skillDoc+='\n### '+(G?'判断基準':'Judgment Criteria')+'\n';
skillDoc+='- '+(G?'全てのガードレールに対応するテストが存在するか':'Tests exist for all guard rails?')+'\n';
skillDoc+='- '+(G?'横断的関心事チェックリストが全てチェック済みか':'All cross-cutting concerns checked?')+'\n';
skillDoc+='- '+(G?'業種固有の制約（コンプライアンス等）を満たしているか':'Domain-specific constraints (compliance, etc.) satisfied?')+'\n';
skillDoc+='\n### '+(G?'次のスキル':'Next Skill')+'\n';
skillDoc+='- '+(G?'テスト実行 → バグ修正 → デプロイ準備':'Run tests → Fix bugs → Prepare deploy')+'\n';
skillDoc+='\n';
skillDoc+='---\n';
skillDoc+=(G?'*このスキルカタログはDevForge v9が自動生成しました。*\n':'*This skill catalog was auto-generated by DevForge v9.*\n');
S.files['skills/impl-patterns.md']=skillDoc;
}

// ── docs/42_skill_guide.md ──
const skill=S.skill||'intermediate';
const skLabel={beginner:G?'初心者':'Beginner',intermediate:G?'中級者':'Intermediate',pro:G?'上級者':'Professional'};
const skIcon={beginner:'⭐',intermediate:'⭐⭐',pro:'⭐⭐⭐'};
const skMark=G?' **← あなたのレベル**':' **<-- YOUR LEVEL**';
const _lv=(lv,items)=>{
const active=lv===skill?skMark:'';
let s='### '+skIcon[lv]+' '+skLabel[lv]+active+'\n\n';
items.forEach(it=>{s+=it+'\n';});
s+='\n';
return s;
};
let doc42='# '+pn+' — '+(G?'スキルレベル別ガイド':'Skill-Level Guide')+'\n\n';
doc42+=(G?'**あなたのレベル**: ':'**Your Level**: ')+skIcon[skill]+' '+skLabel[skill]+'\n';
doc42+=(G?'**業種**: ':'**Domain**: ')+domain+'\n';
doc42+=(G?'**生成日**: ':'**Generated**: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc42+='---\n\n';
// Sec 1: Getting Started
doc42+='## '+(G?'1. 最初にやること（生成直後の第一歩）':'1. Getting Started (First Steps After Generation)')+'\n\n';
doc42+=_lv('beginner',G?[
'1. `CLAUDE.md` をAIツール（Cursor/Claude Code）にコピペ → AIがプロジェクト全体を理解',
'2. `.spec/constitution.md` を読んでプロジェクトの目的・範囲を確認',
'3. `docs/24_progress.md` を開いてタスク進捗管理を開始',
'4. `.devcontainer/` フォルダがある場合、VS Code/Cursorで「Reopen in Container」で開発環境を即構築'
]:[
'1. Copy `CLAUDE.md` into your AI tool (Cursor/Claude Code) — AI understands your entire project',
'2. Read `.spec/constitution.md` to understand project purpose and scope',
'3. Open `docs/24_progress.md` to start tracking progress',
'4. If `.devcontainer/` exists, use "Reopen in Container" in VS Code/Cursor for instant dev setup'
]);
doc42+=_lv('intermediate',G?[
'1. `AI_BRIEF.md` をAIに投入（~1200トークンで全仕様を圧縮）',
'2. `docs/39_implementation_playbook.md` で業種別実装パターンを確認',
'3. `docs/40_ai_dev_runbook.md` のWSCI（Write/Select/Compress/Isolate）ワークフローに従う',
'4. `.cursorrules` / `.windsurfrules` をプロジェクトルートに配置してAIルールを自動適用'
]:[
'1. Feed `AI_BRIEF.md` to AI (~1200 tokens, compressed full spec)',
'2. Review domain patterns in `docs/39_implementation_playbook.md`',
'3. Follow WSCI (Write/Select/Compress/Isolate) workflow in `docs/40_ai_dev_runbook.md`',
'4. Place `.cursorrules` / `.windsurfrules` in project root for auto AI rules'
]);
doc42+=_lv('pro',G?[
'1. `.devcontainer/` でチーム全員の環境を統一（Docker Compose構成済み）',
'2. `AGENTS.md` の Agent Specialization Matrix でマルチエージェント役割定義',
'3. `mcp-config.json` を設定し、context7/filesystem/playwright等のMCPツールを有効化',
'4. `skills/pipelines.md` のCI/CDパイプラインを `.github/workflows/ci.yml` と統合'
]:[
'1. Deploy `.devcontainer/` to standardize team environments (Docker Compose pre-configured)',
'2. Define multi-agent roles via Agent Specialization Matrix in `AGENTS.md`',
'3. Configure `mcp-config.json` to enable context7/filesystem/playwright MCP tools',
'4. Integrate `skills/pipelines.md` CI/CD pipelines with `.github/workflows/ci.yml`'
]);
// Sec 2: File Usage Map
doc42+='## '+(G?'2. ファイル活用マップ':'2. File Usage Map')+'\n\n';
doc42+='| '+(G?'タスク':'Task')+' | '+(G?'最初に読む':'Read First')+' | '+(G?'次に参照':'Then Refer')+' |\n|------|------------|----------|\n';
const fmap=G?[
['コーディング開始','CLAUDE.md','.spec/constitution.md'],
['DB設計理解','docs/04_er_diagram.md','docs/05_api_design.md'],
['テスト作成','docs/07_test_cases.md','docs/36_test_strategy.md'],
['セキュリティ確認','docs/08_security.md','docs/34_incident_response.md'],
['デプロイ準備','docs/09_release_checklist.md','.github/workflows/ci.yml'],
['成長戦略確認','docs/41_growth_intelligence.md','docs/30_goal_decomposition.md'],
['バグ予防','docs/37_bug_prevention.md','docs/25_error_logs.md']
]:[
['Start coding','CLAUDE.md','.spec/constitution.md'],
['Understand DB','docs/04_er_diagram.md','docs/05_api_design.md'],
['Write tests','docs/07_test_cases.md','docs/36_test_strategy.md'],
['Security review','docs/08_security.md','docs/34_incident_response.md'],
['Deploy prep','docs/09_release_checklist.md','.github/workflows/ci.yml'],
['Growth strategy','docs/41_growth_intelligence.md','docs/30_goal_decomposition.md'],
['Bug prevention','docs/37_bug_prevention.md','docs/25_error_logs.md']
];
fmap.forEach(r=>{doc42+='| '+r[0]+' | `'+r[1]+'` | `'+r[2]+'` |\n';});
doc42+='\n';
// Sec 3: Mistakes & Cautions
doc42+='## '+(G?'3. 注意事項とよくある失敗':'3. Common Mistakes & Cautions')+'\n\n';
doc42+=_lv('beginner',G?[
'- ❌ `.spec/` を読まずにコーディング開始 → ✅ 必ず `constitution.md` を先に読む',
'- ❌ `docs/08_security.md` を無視 → ✅ 認証・RLS・CORS設定を確認してから実装',
'- ❌ 全ファイルを一度に使おうとする → ✅ まず `.spec/tasks.md` の1タスクに集中',
'- ❌ テストを後回し → ✅ `docs/07_test_cases.md` のケースを実装と同時に書く',
'- ❌ エラーログを記録しない → ✅ `docs/25_error_logs.md` のフォーマットで記録'
]:[
'- ❌ Start coding without reading `.spec/` → ✅ Always read `constitution.md` first',
'- ❌ Ignoring `docs/08_security.md` → ✅ Review auth, RLS, CORS before implementation',
'- ❌ Trying to use all files at once → ✅ Focus on one task from `.spec/tasks.md`',
'- ❌ Postponing tests → ✅ Write tests alongside implementation using `docs/07_test_cases.md`',
'- ❌ Not logging errors → ✅ Use `docs/25_error_logs.md` format for tracking'
]);
doc42+=_lv('intermediate',G?[
'- ❌ `docs/39_implementation_playbook.md` のドメインパターンを無視 → ✅ 業種固有のバグパターンを事前確認',
'- ❌ 品質ゲートを省略 → ✅ `docs/32_qa_blueprint.md` のチェックリストを実施',
'- ❌ AIへのモノリシックプロンプト → ✅ `docs/22_prompt_playbook.md` のフェーズ別テンプレート使用',
'- ❌ 生成物をそのまま使う → ✅ プロジェクト固有の要件に合わせてカスタマイズ'
]:[
'- ❌ Ignoring domain patterns in `docs/39_implementation_playbook.md` → ✅ Review domain-specific bugs first',
'- ❌ Skipping quality gates → ✅ Run `docs/32_qa_blueprint.md` checklists',
'- ❌ Monolithic AI prompts → ✅ Use phase-specific templates from `docs/22_prompt_playbook.md`',
'- ❌ Using generated files as-is → ✅ Customize to project-specific requirements'
]);
doc42+=_lv('pro',G?[
'- ❌ MVP段階での過剰設計 → ✅ `docs/30_goal_decomposition.md` の優先度マトリクスに従う',
'- ❌ Agent間のコンテキスト共有不足 → ✅ `AGENTS.md` のハンドオフプロトコル遵守',
'- ❌ パフォーマンス最適化の後回し → ✅ `docs/41_growth_intelligence.md` のCWV目標を初期から意識'
]:[
'- ❌ Over-engineering at MVP stage → ✅ Follow priority matrix in `docs/30_goal_decomposition.md`',
'- ❌ Poor context sharing between agents → ✅ Follow handoff protocol in `AGENTS.md`',
'- ❌ Deferring performance optimization → ✅ Target CWV goals in `docs/41_growth_intelligence.md` from day 1'
]);
// Sec 4: Workflow
doc42+='## '+(G?'4. 開発ワークフロー':'4. Development Workflow')+'\n\n';
doc42+=_lv('beginner',G?[
'```',
'.spec/tasks.md → 1タスク選択 → CLAUDE.mdをAIに渡す → コード実装 → テスト → docs/24_progress.md更新',
'```',
(G?'> **ポイント**: 1タスクずつ順番に。完了したら progress.md にチェック。':'> **Key**: One task at a time. Check off in progress.md when done.')
]:[
'```',
'.spec/tasks.md → Pick 1 task → Feed CLAUDE.md to AI → Implement → Test → Update docs/24_progress.md',
'```',
'> **Key**: One task at a time. Check off in progress.md when done.'
]);
doc42+=_lv('intermediate',G?[
'```',
'AI_BRIEF.md投入 → docs/39パターン確認 → 実装 → docs/32品質チェック → docs/22プロンプトでレビュー依頼',
'```',
'> **ポイント**: AI_BRIEF.md でコンテキスト圧縮、プレイブックでドメインパターン適用。'
]:[
'```',
'Feed AI_BRIEF.md → Check docs/39 patterns → Implement → docs/32 quality check → Review via docs/22 prompts',
'```',
'> **Key**: Compress context with AI_BRIEF.md, apply domain patterns from playbook.'
]);
doc42+=_lv('pro',G?[
'```',
'AGENTS.md役割定義 → skills/pipelines.md自動化 → 並列実装 → CI/CD統合 → docs/34インシデント対応準備',
'```',
'> **ポイント**: Agent Teams で並列開発。verification.md で品質判定を自動化。'
]:[
'```',
'AGENTS.md role setup → skills/pipelines.md automation → Parallel impl → CI/CD → docs/34 incident prep',
'```',
'> **Key**: Parallel dev with Agent Teams. Automate quality judgment via verification.md.'
]);
// Sec 5: AI Tool Usage
doc42+='## '+(G?'5. AIツール活用戦略':'5. AI Tool Usage Strategy')+'\n\n';
doc42+=_lv('beginner',G?[
'1. `CLAUDE.md` 全文をAIにコピペ（Ctrl+Shift+Cで全ファイル一括コピーも可）',
'2. 「`.spec/tasks.md` の○○を実装して」と具体的に指示',
'3. エラーが出たら `docs/25_error_logs.md` のフォーマットで記録してAIに渡す'
]:[
'1. Copy entire `CLAUDE.md` into AI (or use Ctrl+Shift+C for bulk copy)',
'2. Give specific instructions: "Implement XX from `.spec/tasks.md`"',
'3. On errors, log in `docs/25_error_logs.md` format and share with AI'
]);
doc42+=_lv('intermediate',G?[
'1. `AI_BRIEF.md` でコンテキスト圧縮投入（~1200トークン）',
'2. `.cursorrules` / `.windsurfrules` でツール固有ルールを自動適用',
'3. `docs/22_prompt_playbook.md` のフェーズ別プロンプトテンプレート活用',
'4. 複数AIツールを使い分け：設計=Claude Code、実装=Cursor、レビュー=Copilot'
]:[
'1. Feed `AI_BRIEF.md` for compressed context (~1200 tokens)',
'2. Use `.cursorrules` / `.windsurfrules` for tool-specific auto rules',
'3. Use phase-specific prompt templates from `docs/22_prompt_playbook.md`',
'4. Multi-tool strategy: Design=Claude Code, Implement=Cursor, Review=Copilot'
]);
doc42+=_lv('pro',G?[
'1. `AGENTS.md` の Agent Specialization Matrix で役割分担',
'2. `skills/pipelines.md` で自動パイプライン構築（Feature/BugFix/Release）',
'3. `mcp-config.json` でcontext7/filesystem/playwright等を統合',
'4. Claude Code Subagents / Antigravity Manager View で並列実行'
]:[
'1. Define role assignments via Agent Specialization Matrix in `AGENTS.md`',
'2. Build auto pipelines with `skills/pipelines.md` (Feature/BugFix/Release)',
'3. Integrate context7/filesystem/playwright via `mcp-config.json`',
'4. Run parallel with Claude Code Subagents / Antigravity Manager View'
]);
// Sec 6: Quality Checklist
doc42+='## '+(G?'6. 品質チェックリスト':'6. Quality Checklist')+'\n\n';
doc42+=_lv('beginner',G?[
'- [ ] テストが通る（`npm test`）',
'- [ ] `console.log` を本番コードから除去',
'- [ ] `docs/08_security.md` のセキュリティ項目を確認',
'- [ ] `docs/24_progress.md` を更新',
'- [ ] `docs/25_error_logs.md` に未解決エラーがない'
]:[
'- [ ] Tests pass (`npm test`)',
'- [ ] Remove `console.log` from production code',
'- [ ] Review security items in `docs/08_security.md`',
'- [ ] Update `docs/24_progress.md`',
'- [ ] No unresolved errors in `docs/25_error_logs.md`'
]);
doc42+=_lv('intermediate',G?[
'- [ ] テストカバレッジ 80%以上',
'- [ ] `docs/32_qa_blueprint.md` の業種別チェック完了',
'- [ ] `docs/37_bug_prevention.md` のパターン対応済み',
'- [ ] `docs/26_design_system.md` のトークン準拠',
'- [ ] `docs/28_qa_strategy.md` のクロスカッティング項目確認',
'- [ ] APIレスポンスが `docs/05_api_design.md` と一致',
'- [ ] `.spec/verification.md` の検証基準をクリア',
'- [ ] `docs/27_sequence_diagrams.md` のフロー通りに実装'
]:[
'- [ ] Test coverage >= 80%',
'- [ ] Domain checks in `docs/32_qa_blueprint.md` complete',
'- [ ] Bug patterns in `docs/37_bug_prevention.md` addressed',
'- [ ] Design tokens conform to `docs/26_design_system.md`',
'- [ ] Cross-cutting items in `docs/28_qa_strategy.md` verified',
'- [ ] API responses match `docs/05_api_design.md`',
'- [ ] Pass `.spec/verification.md` criteria',
'- [ ] Implementation follows `docs/27_sequence_diagrams.md` flows'
]);
doc42+=_lv('pro',G?[
'- [ ] 中級者チェック全項目 + 以下:',
'- [ ] `docs/41_growth_intelligence.md` のCore Web Vitals目標達成',
'- [ ] `docs/19_performance.md` のパフォーマンス基準クリア',
'- [ ] `docs/34_incident_response.md` のインシデント対応手順テスト済み',
'- [ ] `.spec/verification.md` の全検証項目を自動テストでカバー',
'- [ ] エッジケース: 同時アクセス、大量データ、ネットワーク障害',
'- [ ] `docs/20_a11y.md` のアクセシビリティ基準準拠'
]:[
'- [ ] All intermediate checks PLUS:',
'- [ ] Core Web Vitals targets from `docs/41_growth_intelligence.md` met',
'- [ ] Performance criteria from `docs/19_performance.md` passed',
'- [ ] Incident response in `docs/34_incident_response.md` tested',
'- [ ] All `.spec/verification.md` criteria covered by automated tests',
'- [ ] Edge cases: concurrent access, large datasets, network failures',
'- [ ] Accessibility standards from `docs/20_a11y.md` met'
]);
// Sec 7: Growth Path
doc42+='## '+(G?'7. レベルアップの道筋':'7. Growth Path')+'\n\n';
doc42+=_lv('beginner',G?[
'**⭐→⭐⭐ への道:**',
'1. `.spec/` の全ファイルを理解する（特に `specification.md` と `technical-plan.md`）',
'2. `docs/39_implementation_playbook.md` の業種パターンを1つ実装してみる',
'3. `AI_BRIEF.md` を使ったコンテキスト圧縮技法を習得',
'4. 2つ以上のAIツールを使い分けてみる'
]:[
'**⭐→⭐⭐ Path:**',
'1. Understand all files in `.spec/` (especially `specification.md` and `technical-plan.md`)',
'2. Implement one domain pattern from `docs/39_implementation_playbook.md`',
'3. Learn context compression using `AI_BRIEF.md`',
'4. Try using 2+ AI tools for different tasks'
]);
doc42+=_lv('intermediate',G?[
'**⭐⭐→⭐⭐⭐ への道:**',
'1. `AGENTS.md` を使ったマルチエージェント開発を試す',
'2. `skills/pipelines.md` のパイプラインをCI/CDと統合',
'3. `docs/41_growth_intelligence.md` のグロース方程式を実際のデータで検証',
'4. `mcp-config.json` でMCPツールチェーンを構築'
]:[
'**⭐⭐→⭐⭐⭐ Path:**',
'1. Try multi-agent development with `AGENTS.md`',
'2. Integrate `skills/pipelines.md` pipelines with CI/CD',
'3. Validate growth equations from `docs/41_growth_intelligence.md` with real data',
'4. Build MCP tool chain via `mcp-config.json`'
]);
doc42+=_lv('pro',G?[
'**⭐⭐⭐ マスターへの道:**',
'1. 独自のAIスキル定義（`skills/factory.md` のテンプレート活用）',
'2. チームメンバーへのDevForge導入とメンタリング',
'3. ドメイン固有のカスタムパイプライン構築',
'4. OSSコントリビューション・アーキテクチャレビューのリード'
]:[
'**⭐⭐⭐ Path to Mastery:**',
'1. Define custom AI skills (using `skills/factory.md` templates)',
'2. Introduce DevForge to team and mentor adoption',
'3. Build domain-specific custom pipelines',
'4. Lead OSS contributions and architecture reviews'
]);
// Sec 8: Domain Tips
const dtips={
education:G?['`docs/08_security.md` → FERPA/学生データ保護を必ず確認','進捗トラッキングはゲーミフィケーション要素と連携','コース完了率KPIを `docs/30_goal_decomposition.md` で設定']:['Review FERPA/student data protection in `docs/08_security.md`','Link progress tracking with gamification elements','Set course completion KPIs in `docs/30_goal_decomposition.md`'],
fintech:G?['`docs/08_security.md` → PCI DSS/KYC対応を最優先で確認','トランザクション整合性テストを `docs/07_test_cases.md` に追加','金融規制コンプライアンスを `docs/31_industry_playbook.md` で確認']:['Prioritize PCI DSS/KYC in `docs/08_security.md`','Add transaction integrity tests to `docs/07_test_cases.md`','Check financial compliance in `docs/31_industry_playbook.md`'],
health:G?['`docs/08_security.md` → HIPAA準拠を確認','患者データ暗号化を `.spec/technical-plan.md` で検証','監査ログを `docs/05_api_design.md` に追加']:['Verify HIPAA compliance in `docs/08_security.md`','Validate patient data encryption in `.spec/technical-plan.md`','Add audit logging to `docs/05_api_design.md`'],
ec:G?['決済テストは必ずStripeテストキーで実施','在庫管理の同時アクセス対策を `docs/37_bug_prevention.md` で確認','カート放棄防止策を `docs/41_growth_intelligence.md` で確認']:['Always test payments with Stripe test keys','Check concurrent access for inventory in `docs/37_bug_prevention.md`','Review cart abandonment prevention in `docs/41_growth_intelligence.md`'],
saas:G?['フリーミアム設計は `docs/41_growth_intelligence.md` のファネル参照','マルチテナント設計を `.spec/technical-plan.md` で確認','チャーン防止KPIを `docs/30_goal_decomposition.md` で設定']:['Reference funnel in `docs/41_growth_intelligence.md` for freemium design','Verify multi-tenant design in `.spec/technical-plan.md`','Set churn prevention KPIs in `docs/30_goal_decomposition.md`']
};
const tips=dtips[domain]||( G?['プロジェクト固有の制約を `.spec/constitution.md` で再確認','業種別プレイブックを `docs/31_industry_playbook.md` で確認','品質基準を `docs/32_qa_blueprint.md` で確認']:['Re-check project constraints in `.spec/constitution.md`','Review domain playbook in `docs/31_industry_playbook.md`','Verify quality criteria in `docs/32_qa_blueprint.md`']);
doc42+='## '+(G?'8. 業種別アドバイス（'+domain+'）':'8. Domain-Specific Tips ('+domain+')')+'\n\n';
tips.forEach((t,i)=>{doc42+=(i+1)+'. '+t+'\n';});
doc42+='\n';
// Footer
doc42+='---\n';
doc42+=(G?'*このガイドはDevForge v9が `S.skill='+skill+'` に基づいて自動生成しました。*\n':'*This guide was auto-generated by DevForge v9 based on `S.skill='+skill+'`.*\n');
S.files['docs/42_skill_guide.md']=doc42;
}
/* ═══ PILLAR ⑫: SECURITY INTELLIGENCE ═══ */

// OWASP Top 10 2025 Check Database
const OWASP_2025=[
{id:'A01',ja:'アクセス制御の不備',en:'Broken Access Control',
checks_ja:[
'RLS/Security Rules全テーブル有効化',
'Server Actions内認証チェック必須',
'IDOR防止(owner検証)',
'最小権限原則の適用',
'デフォルト拒否ポリシー'
],
checks_en:[
'Enable RLS/Security Rules for all tables',
'Auth check required in all Server Actions',
'IDOR prevention (owner verification)',
'Apply principle of least privilege',
'Default deny policy'
],
stack:{
supabase:['RLSポリシー全テーブル確認','service_roleキー隔離','anon keyのみクライアント公開'],
firebase:['Firestore Rules全コレクション確認','Admin SDK使用最小化','カスタムクレーム活用'],
express:['認可ミドルウェア全ルート適用','JWTスコープ検証','RBAC実装']
}},
{id:'A02',ja:'セキュリティ設定ミス',en:'Security Misconfiguration',
checks_ja:[
'BaaS管理画面でRLS有効化確認',
'API制限設定(リファラ/IPホワイトリスト)',
'Data API無効化推奨',
'CORS設定の厳格化',
'デフォルトクレデンシャル変更'
],
checks_en:[
'Verify RLS enabled in BaaS console',
'API restrictions (referrer/IP whitelist)',
'Disable Data API (recommended)',
'Strict CORS configuration',
'Change default credentials'
],
stack:{
supabase:['Database settings→RLS確認','API settings→制限設定','PostgREST API評価'],
firebase:['Firebase Console→Rules確認','App Check有効化','API key制限設定'],
vercel:['Environment Variables設定','Preview deployments保護','Edge Config活用']
}},
{id:'A03',ja:'ソフトウェアサプライチェーン',en:'Software Supply Chain',
checks_ja:[
'npm audit自動実行',
'Gitleaksでシークレットスキャン',
'SLSA Build Provenance生成',
'Scorecard評価',
'SBOMエクスポート'
],
checks_en:[
'Automate npm audit',
'Gitleaks secret scanning',
'Generate SLSA Build Provenance',
'Scorecard evaluation',
'Export SBOM'
],
stack:{
github:['Dependabot有効化','Secret scanning有効化','actions/attest-build-provenance使用'],
npm:['package-lock.json必須','npm audit fix定期実行','--ignore-scripts使用'],
docker:['ベースイメージ署名検証','Trivy脆弱性スキャン','multi-stage build']
}},
{id:'A04',ja:'サーバサイドリクエストフォージェリ',en:'Server-Side Request Forgery',
checks_ja:[
'Server Actions内URL検証',
'Edge Functions外部リクエスト制限',
'プライベートIP拒否',
'URLホワイトリスト',
'リダイレクト検証'
],
checks_en:[
'URL validation in Server Actions',
'Restrict external requests in Edge Functions',
'Deny private IPs',
'URL whitelist',
'Redirect validation'
],
stack:{
nextjs:['Server Actions入力検証','fetch制限実装','middleware活用'],
cloudflare:['Workers制限設定','env.ALLOWED_HOSTS定義'],
supabase:['Edge Functions制限','Deno.permissions確認']
}},
{id:'A05',ja:'安全でない設計',en:'Insecure Design',
checks_ja:[
'脅威モデリング実施',
'Security by Design原則',
'フェイルセーフ設計',
'Defense in Depth',
'セキュアデフォルト'
],
checks_en:[
'Conduct threat modeling',
'Security by Design principles',
'Fail-safe design',
'Defense in Depth',
'Secure defaults'
],
stack:{
design:['STRIDE分析実施','Trust Boundary定義','Attack Surface最小化'],
arch:['認証/認可分離','暗号化デフォルト','監査ログ設計']
}},
{id:'A06',ja:'脆弱で古いコンポーネント',en:'Vulnerable and Outdated Components',
checks_ja:[
'依存関係自動更新',
'EOLバージョン回避',
'セキュリティパッチ適用',
'未使用依存関係削除',
'ロックファイル必須'
],
checks_en:[
'Automate dependency updates',
'Avoid EOL versions',
'Apply security patches',
'Remove unused dependencies',
'Require lockfile'
],
stack:{
renovate:['自動PR作成','vulnerabilityAlerts有効'],
npm:['npm outdated定期確認','npx npm-check-updates'],
docker:['ベースイメージ更新','distroless推奨']
}},
{id:'A07',ja:'識別と認証の失敗',en:'Identification and Authentication Failures',
checks_ja:[
'MFA必須化',
'パスワード強度ポリシー',
'セッション管理強化',
'レートリミット実装',
'クレデンシャルスタッフィング防御'
],
checks_en:[
'Enforce MFA',
'Password strength policy',
'Strengthen session management',
'Implement rate limiting',
'Defend against credential stuffing'
],
stack:{
supabase:['Auth policies設定','MFA有効化','Email confirmations強制'],
firebase:['Firebase Auth MFA','reCAPTCHA統合','passwordPolicyOptions設定'],
nextauth:['session strategy設定','maxAge適切化','secret強化']
}},
{id:'A08',ja:'ソフトウェアとデータの整合性の不備',en:'Software and Data Integrity Failures',
checks_ja:[
'CDN SRI設定',
'コード署名検証',
'CI/CDパイプライン保護',
'auto-merge無効化',
'Webhook署名検証'
],
checks_en:[
'Configure CDN SRI',
'Verify code signatures',
'Protect CI/CD pipeline',
'Disable auto-merge',
'Verify webhook signatures'
],
stack:{
cdn:['SRI hashesすべてのCDN','integrity属性必須'],
github:['Branch protection有効','Signed commits推奨','CODEOWNERS設定'],
webhook:['HMAC署名検証','タイムスタンプ検証','replay attack防御']
}},
{id:'A09',ja:'セキュリティログと監視の不備',en:'Security Logging and Monitoring Failures',
checks_ja:[
'全認証イベント記録',
'異常検知アラート',
'ログ改ざん防止',
'インシデント対応手順',
'ログ保持ポリシー'
],
checks_en:[
'Log all auth events',
'Anomaly detection alerts',
'Prevent log tampering',
'Incident response procedures',
'Log retention policy'
],
stack:{
supabase:['pgAudit有効化','Log drains設定','Webhooks活用'],
datadog:['APM統合','Security Monitoring','Anomaly Detection'],
sentry:['Error tracking','Performance monitoring','Session Replay']
}},
{id:'A10',ja:'サーバサイドリクエストフォージェリ',en:'Server-Side Request Forgery',
checks_ja:[
'DNS Rebinding防御',
'メタデータAPI保護',
'ネットワーク分離',
'Egress制限',
'タイムアウト設定'
],
checks_en:[
'Defend against DNS Rebinding',
'Protect metadata APIs',
'Network isolation',
'Egress restrictions',
'Timeout configuration'
],
stack:{
cloud:['VPC設定','Security Groups','Private subnets'],
k8s:['Network Policies','Egress rules','Service mesh'],
serverless:['VPC integration','Outbound allowlist']
}}
];
// Compliance Requirements Database
const COMPLIANCE_DB={
pci:{
name:'PCI DSS 4.0.1',
domains:['fintech','ec'],
reqs_ja:[
{id:'6.4.3',title:'決済ページスクリプトインベントリ',desc:'すべてのJavaScriptをリスト化し、正当性を検証',impl:'CSP report-uri + inventory管理'},
{id:'11.6.1',title:'改ざん検知メカニズム',desc:'HTTPヘッダー/ペイロードの改ざん検知',impl:'Subresource Integrity (SRI) + CSP'},
{id:'8.3.6',title:'パスワード複雑度',desc:'12文字以上、大小英数記号',impl:'Auth provider設定 + クライアント検証'},
{id:'3.5.1',title:'カード情報非保存',desc:'PAN/CVV2保存禁止',impl:'Stripe Tokenization必須'},
{id:'12.10.4',title:'インシデント対応計画',desc:'決済システム侵害時の手順',impl:'docs/34_incident_response.md参照'}
],
reqs_en:[
{id:'6.4.3',title:'Payment Page Script Inventory',desc:'List all JavaScript and verify legitimacy',impl:'CSP report-uri + inventory management'},
{id:'11.6.1',title:'Tampering Detection Mechanism',desc:'Detect HTTP header/payload tampering',impl:'Subresource Integrity (SRI) + CSP'},
{id:'8.3.6',title:'Password Complexity',desc:'12+ chars, upper/lower/digit/symbol',impl:'Auth provider settings + client validation'},
{id:'3.5.1',title:'No Card Data Storage',desc:'Never store PAN/CVV2',impl:'Stripe Tokenization required'},
{id:'12.10.4',title:'Incident Response Plan',desc:'Procedures for payment system breach',impl:'See docs/34_incident_response.md'}
]
},
hipaa:{
name:'HIPAA',
domains:['health'],
reqs_ja:[
{id:'§164.312(a)',title:'アクセス制御',desc:'PHI(Protected Health Information)へのアクセス制限',impl:'RLS + RBAC + MFA必須'},
{id:'§164.312(c)',title:'整合性管理',desc:'PHI改ざん防止・検知',impl:'pgAudit + トリガー監査'},
{id:'§164.312(e)',title:'暗号化',desc:'保管時・転送時暗号化',impl:'AES-256 + TLS 1.3'},
{id:'§164.308(a)(1)',title:'BAA締結',desc:'Business Associate Agreement',impl:'Supabase Enterprise必須'},
{id:'§164.528',title:'開示記録',desc:'PHIアクセスログ3年保管',impl:'CloudWatch Logs + S3 Glacier'}
],
reqs_en:[
{id:'§164.312(a)',title:'Access Control',desc:'Restrict access to PHI (Protected Health Information)',impl:'RLS + RBAC + MFA required'},
{id:'§164.312(c)',title:'Integrity Controls',desc:'Prevent/detect PHI tampering',impl:'pgAudit + trigger audits'},
{id:'§164.312(e)',title:'Encryption',desc:'At-rest and in-transit encryption',impl:'AES-256 + TLS 1.3'},
{id:'§164.308(a)(1)',title:'BAA Execution',desc:'Business Associate Agreement',impl:'Supabase Enterprise required'},
{id:'§164.528',title:'Disclosure Records',desc:'PHI access logs for 3 years',impl:'CloudWatch Logs + S3 Glacier'}
]
},
gdpr:{
name:'GDPR',
domains:['hr','community','content','saas','default'],
reqs_ja:[
{id:'Art.6',title:'処理の適法性',desc:'法的根拠(同意/契約/正当利益)の文書化',impl:'同意管理UI + Privacy Policy'},
{id:'Art.15',title:'アクセス権',desc:'データ主体が自分のデータをダウンロード可能',impl:'Export機能実装'},
{id:'Art.17',title:'忘れられる権利',desc:'削除リクエスト対応',impl:'Delete Account機能 + CASCADE設定'},
{id:'Art.32',title:'セキュリティ対策',desc:'技術的・組織的対策',impl:'暗号化 + アクセス制御 + 監査ログ'},
{id:'Art.33',title:'侵害通知',desc:'72時間以内に監督当局通知',impl:'Incident Response手順書'}
],
reqs_en:[
{id:'Art.6',title:'Lawfulness of Processing',desc:'Document legal basis (consent/contract/legitimate interest)',impl:'Consent management UI + Privacy Policy'},
{id:'Art.15',title:'Right of Access',desc:'Data subjects can download their data',impl:'Implement Export feature'},
{id:'Art.17',title:'Right to be Forgotten',desc:'Respond to deletion requests',impl:'Delete Account feature + CASCADE settings'},
{id:'Art.32',title:'Security Measures',desc:'Technical and organizational measures',impl:'Encryption + Access control + Audit logs'},
{id:'Art.33',title:'Breach Notification',desc:'Notify supervisory authority within 72 hours',impl:'Incident Response procedures'}
]
},
ismap:{
name:'ISMAP (政府情報システムのためのセキュリティ評価制度)',
domains:['government'],
reqs_ja:[
{id:'1441',title:'データローカリティ',desc:'日本国内データセンター必須',impl:'東京/大阪リージョン限定'},
{id:'1442',title:'暗号化強度',desc:'CRYPTREC推奨暗号リスト準拠',impl:'AES-256/SHA-256/RSA-2048'},
{id:'1443',title:'監査ログ保存',desc:'7年間保存',impl:'S3 Glacier Deep Archive'},
{id:'1444',title:'クラウド事業者認証',desc:'ISMAP登録サービス利用推奨',impl:'AWS/Azure/GCP ISMAPサービス'},
{id:'1445',title:'インシデント報告',desc:'重大事象は24時間以内報告',impl:'エスカレーション手順書'}
],
reqs_en:[
{id:'1441',title:'Data Locality',desc:'Japan data center required',impl:'Tokyo/Osaka regions only'},
{id:'1442',title:'Encryption Strength',desc:'CRYPTREC recommended cipher list',impl:'AES-256/SHA-256/RSA-2048'},
{id:'1443',title:'Audit Log Retention',desc:'7 years retention',impl:'S3 Glacier Deep Archive'},
{id:'1444',title:'Cloud Provider Certification',desc:'Use ISMAP registered services',impl:'AWS/Azure/GCP ISMAP services'},
{id:'1445',title:'Incident Reporting',desc:'Report critical incidents within 24 hours',impl:'Escalation procedures'}
]
},
soc2:{
name:'SOC 2 Type II',
domains:['saas'],
reqs_ja:[
{id:'CC6.1',title:'論理アクセス制御',desc:'ロールベースアクセス制御実装',impl:'RBAC + 最小権限原則'},
{id:'CC6.6',title:'暗号化',desc:'保管時・転送時暗号化',impl:'TLS 1.3 + AES-256'},
{id:'CC7.2',title:'変更管理',desc:'本番変更の承認プロセス',impl:'Pull Request + Approval workflow'},
{id:'CC7.3',title:'セキュリティ監視',desc:'異常検知・アラート',impl:'CloudWatch/Datadog監視'},
{id:'CC9.2',title:'ベンダー管理',desc:'サードパーティリスク評価',impl:'Vendor Security Assessment'}
],
reqs_en:[
{id:'CC6.1',title:'Logical Access Control',desc:'Implement role-based access control',impl:'RBAC + least privilege'},
{id:'CC6.6',title:'Encryption',desc:'At-rest and in-transit encryption',impl:'TLS 1.3 + AES-256'},
{id:'CC7.2',title:'Change Management',desc:'Approval process for production changes',impl:'Pull Request + Approval workflow'},
{id:'CC7.3',title:'Security Monitoring',desc:'Anomaly detection and alerting',impl:'CloudWatch/Datadog monitoring'},
{id:'CC9.2',title:'Vendor Management',desc:'Third-party risk assessment',impl:'Vendor Security Assessment'}
]
},
ferpa:{
name:'FERPA (Family Educational Rights and Privacy Act)',
domains:['education'],
reqs_ja:[
{id:'§99.31',title:'同意なし開示制限',desc:'教育記録の第三者提供制限',impl:'保護者同意フロー + 開示記録'},
{id:'§99.32',title:'開示記録保管',desc:'開示履歴の記録・保管',impl:'Audit log + 5年保管'},
{id:'§99.35',title:'アクセス権',desc:'学生・保護者が記録を閲覧可能',impl:'View Records機能'},
{id:'§99.7',title:'セキュリティ対策',desc:'不正アクセス防止',impl:'認証 + 暗号化 + アクセス制御'}
],
reqs_en:[
{id:'§99.31',title:'Disclosure Restrictions',desc:'Limit third-party access to education records',impl:'Parental consent flow + disclosure records'},
{id:'§99.32',title:'Disclosure Record Retention',desc:'Maintain disclosure history',impl:'Audit log + 5-year retention'},
{id:'§99.35',title:'Right of Access',desc:'Students/parents can view records',impl:'View Records feature'},
{id:'§99.7',title:'Security Measures',desc:'Prevent unauthorized access',impl:'Auth + encryption + access control'}
]
},
asvs:{
name:'OWASP ASVS Level 2',
domains:['default'],
reqs_ja:[
{id:'V1.4',title:'アクセス制御設計',desc:'デフォルト拒否原則',impl:'RLS/Security Rules + 認可チェック'},
{id:'V2.1',title:'パスワードセキュリティ',desc:'10文字以上、pwned passwords回避',impl:'Auth provider設定'},
{id:'V3.4',title:'セッション管理',desc:'セッション無効化・タイムアウト',impl:'JWT有効期限 + refresh token'},
{id:'V5.2',title:'入力検証',desc:'ホワイトリスト検証',impl:'Zodスキーマ + サーバー検証'},
{id:'V8.1',title:'データ保護',desc:'機密データ暗号化',impl:'列レベル暗号化 + TLS'}
],
reqs_en:[
{id:'V1.4',title:'Access Control Design',desc:'Default deny principle',impl:'RLS/Security Rules + authz checks'},
{id:'V2.1',title:'Password Security',desc:'10+ chars, avoid pwned passwords',impl:'Auth provider settings'},
{id:'V3.4',title:'Session Management',desc:'Session invalidation and timeout',impl:'JWT expiration + refresh token'},
{id:'V5.2',title:'Input Validation',desc:'Whitelist validation',impl:'Zod schemas + server validation'},
{id:'V8.1',title:'Data Protection',desc:'Encrypt sensitive data',impl:'Column-level encryption + TLS'}
]
}
};
// STRIDE Threat Patterns
const STRIDE_PATTERNS={
hasUserId:{S:'HIGH',T:'MED',R:'MED',I:'HIGH',D:'LOW',E:'HIGH'},
isPayment:{S:'CRITICAL',T:'CRITICAL',R:'HIGH',I:'HIGH',D:'MED',E:'CRITICAL'},
isPublic:{S:'LOW',T:'LOW',R:'LOW',I:'MED',D:'MED',E:'LOW'},
hasFile:{S:'MED',T:'HIGH',I:'HIGH',D:'MED',E:'MED'},
default:{S:'MED',T:'MED',R:'LOW',I:'MED',D:'LOW',E:'MED'}
};
// Helper: Checkbox
function _chk(ja,en){const G=S.genLang==='ja';return'- [ ] '+(G?ja:en)+'\n';}

// Helper: Security level label
function _lvl(lv){
const m={CRITICAL:'🔴 Critical',HIGH:'🟠 High',MED:'🟡 Medium',LOW:'🟢 Low'};
return m[lv]||lv;
}

// Helper: OWASP section
function _owaspSection(item,backend){
const G=S.genLang==='ja';
let out='### '+item.id+': '+(G?item.ja:item.en)+'\n\n';
const checks=G?item.checks_ja:item.checks_en;
checks.forEach(c=>out+=_chk(c,c));
out+='\n';
// Stack-specific checks
if(item.stack){
out+=(G?'**技術スタック別チェック:**\n\n':'**Stack-Specific Checks:**\n\n');
const bk=backend||'express';
const key=bk.toLowerCase().includes('supabase')?'supabase':
bk.toLowerCase().includes('firebase')?'firebase':
bk.toLowerCase().includes('github')?'github':
bk.toLowerCase().includes('npm')?'npm':
bk.toLowerCase().includes('vercel')?'vercel':'express';
if(item.stack[key]){
item.stack[key].forEach(s=>out+='- '+s+'\n');
}
}
return out+'\n';
}

// Helper: Compliance section
function _compSection(comp,G){
const reqs=G?comp.reqs_ja:comp.reqs_en;
let out='## '+comp.name+'\n\n';
out+=(G?'**適用対象ドメイン:** ':'**Applicable Domains:** ')+comp.domains.join(', ')+'\n\n';
out+=(G?'### 必須要件チェックリスト\n\n':'### Required Compliance Checklist\n\n');
reqs.forEach(r=>{
out+='#### '+r.id+': '+r.title+'\n';
out+='- **'+(G?'説明':'Description')+':** '+r.desc+'\n';
out+='- **'+(G?'実装':'Implementation')+':** '+r.impl+'\n';
out+=_chk(r.title,r.title);
out+='\n';
});
return out;
}

// Main Generator
function genPillar12_SecurityIntelligence(a,pn){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose)||'default';
const backend=a.backend||'Supabase';
const frontend=a.frontend||'React + Next.js';
const database=a.database||'PostgreSQL';
const auth=resolveAuth(a);
const entities=(a.data_entities||'').split(/[,、]/).map(e=>e.trim()).filter(e=>e);
const features=(a.mvp_features||'').split(/[,、]/).map(f=>f.trim()).filter(f=>f);
const hasPayment=a.payment&&a.payment!=='none';
const hasAI=a.ai_auto&&a.ai_auto!=='none';
// ═══ DOC 43: Security Intelligence Report ═══
let doc43='';
doc43+='# '+(G?'セキュリティインテリジェンスレポート':'Security Intelligence Report')+'\n\n';
doc43+='> '+(G?'プロジェクト: ':'Project: ')+pn+'\n';
doc43+='> '+(G?'生成日: ':'Generated: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc43+=(G?'## 📋 目次\n\n':'## 📋 Table of Contents\n\n');
doc43+='1. [OWASP Top 10 (2025) Adaptive Audit](#owasp-top-10-2025-adaptive-audit)\n';
doc43+='2. [Security Headers Configuration](#security-headers-configuration)\n';
doc43+='3. [Shared Responsibility Model](#shared-responsibility-model)\n';
doc43+='4. [Secrets Management](#secrets-management)\n';
doc43+='5. [Authentication & Session Security](#authentication--session-security)\n\n';
doc43+='---\n\n';
// OWASP Section
doc43+='## OWASP Top 10 (2025) Adaptive Audit\n\n';
doc43+=(G?'このセクションではOWASP Top 10 2025の各項目について、プロジェクトの技術スタックに適応したチェックリストを提供します。\n\n':'This section provides stack-adaptive checklists for each OWASP Top 10 2025 category.\n\n');
OWASP_2025.forEach(item=>{
doc43+=_owaspSection(item,backend);
});
// Security Headers
doc43+='---\n\n## Security Headers Configuration\n\n';
doc43+=(G?'### Content Security Policy (CSP)\n\n':'### Content Security Policy (CSP)\n\n');
if(frontend.includes('Next.js')){
doc43+=(G?'**Next.js middleware実装例:**\n\n':'**Next.js middleware implementation:**\n\n');
doc43+='```typescript\n';
doc43+='// middleware.ts\n';
doc43+='import { NextResponse } from \'next/server\';\n';
doc43+='export function middleware(request: Request) {\n';
doc43+=' const nonce = Buffer.from(crypto.randomUUID()).toString(\'base64\');\n';
doc43+=' const cspHeader = `\n';
doc43+=' default-src \'self\';\n';
doc43+=' script-src \'self\' \'nonce-${nonce}\' \'strict-dynamic\';\n';
doc43+=' style-src \'self\' \'nonce-${nonce}\';\n';
doc43+=' img-src \'self\' blob: data:;\n';
doc43+=' font-src \'self\';\n';
doc43+=' object-src \'none\';\n';
doc43+=' base-uri \'self\';\n';
doc43+=' form-action \'self\';\n';
doc43+=' frame-ancestors \'none\';\n';
doc43+=' upgrade-insecure-requests;\n';
doc43+=' `.replace(/\\s{2,}/g, \' \').trim();\n';
doc43+=' const response = NextResponse.next();\n';
doc43+=' response.headers.set(\'Content-Security-Policy\', cspHeader);\n';
doc43+=' response.headers.set(\'X-Nonce\', nonce);\n';
doc43+=' return response;\n';
doc43+='}\n';
doc43+='```\n\n';
}else{
doc43+=(G?'**Express helmet実装例:**\n\n':'**Express helmet implementation:**\n\n');
doc43+='```javascript\n';
doc43+='const helmet = require(\'helmet\');\n';
doc43+='app.use(helmet.contentSecurityPolicy({\n';
doc43+=' directives: {\n';
doc43+=' defaultSrc: ["\'self\'"],\n';
doc43+=' scriptSrc: ["\'self\'", "\'unsafe-inline\'"],\n';
doc43+=' styleSrc: ["\'self\'", "\'unsafe-inline\'"],\n';
doc43+=' imgSrc: ["\'self\'", "data:", "blob:"],\n';
doc43+=' connectSrc: ["\'self\'"],\n';
doc43+=' fontSrc: ["\'self\'"],\n';
doc43+=' objectSrc: ["\'none\'"],\n';
doc43+=' upgradeInsecureRequests: []\n';
doc43+=' }\n';
doc43+='}));\n';
doc43+='```\n\n';
}

doc43+=(G?'### その他の必須ヘッダー\n\n':'### Other Essential Headers\n\n');
doc43+='```http\n';
doc43+='Strict-Transport-Security: max-age=63072000; includeSubDomains; preload\n';
doc43+='X-Frame-Options: DENY\n';
doc43+='X-Content-Type-Options: nosniff\n';
doc43+='Referrer-Policy: strict-origin-when-cross-origin\n';
doc43+='Permissions-Policy: geolocation=(), microphone=(), camera=()\n';
doc43+='```\n\n';
// Shared Responsibility Model
doc43+='---\n\n## Shared Responsibility Model\n\n';
const isBaaS=backend.includes('Supabase')||backend.includes('Firebase')||backend.includes('Convex');
if(isBaaS){
doc43+=(G?'### BaaSプロバイダ vs アプリケーション責任分界\n\n':'### BaaS Provider vs Application Responsibility\n\n');
doc43+='| '+(G?'セキュリティ領域':'Security Domain')+' | '+(G?'プロバイダ担当':'Provider')+' | '+(G?'あなたが担当':'Your Responsibility')+' |\n';
doc43+='|---|---|---|\n';
doc43+='| '+(G?'物理インフラ':'Physical Infrastructure')+' | ✅ | |\n';
doc43+='| '+(G?'ネットワーク':'Network Security')+' | ✅ | |\n';
doc43+='| '+(G?'データベース暗号化':'Database Encryption')+' | ✅ | |\n';
doc43+='| '+(G?'パッチ適用':'Patching')+' | ✅ | |\n';
doc43+='| **'+(G?'RLS/Security Rules':'RLS/Security Rules')+'** | | ✅ |\n';
doc43+='| **'+(G?'認証設定':'Auth Configuration')+'** | | ✅ |\n';
doc43+='| **'+(G?'アプリケーションロジック':'Application Logic')+'** | | ✅ |\n';
doc43+='| **'+(G?'入力検証':'Input Validation')+'** | | ✅ |\n';
doc43+='| **'+(G?'APIキー管理':'API Key Management')+'** | | ✅ |\n';
doc43+='| **'+(G?'監査ログ設定':'Audit Log Configuration')+'** | | ✅ |\n';
doc43+='\n';
doc43+=(G?'⚠️ **重要:** プロバイダがインフラを保護しても、RLS/Rulesやアプリロジックの脆弱性はあなたの責任です。\n\n':'⚠️ **Important:** Even if the provider secures infrastructure, RLS/Rules and app logic vulnerabilities are your responsibility.\n\n');
}else{
doc43+=(G?'### 自前サーバー — 完全責任モデル\n\n':'### Self-Hosted — Full Responsibility Model\n\n');
doc43+=(G?'あなたがすべてのレイヤーを担当します:\n\n':'You are responsible for all layers:\n\n');
doc43+='- '+(G?'サーバーOS・パッチ管理':'Server OS & patching')+'\n';
doc43+='- '+(G?'ファイアウォール・ネットワーク設定':'Firewall & network configuration')+'\n';
doc43+='- '+(G?'データベース暗号化設定':'Database encryption settings')+'\n';
doc43+='- '+(G?'TLS証明書管理':'TLS certificate management')+'\n';
doc43+='- '+(G?'アプリケーションセキュリティ':'Application security')+'\n';
doc43+='- '+(G?'監視・ログ収集':'Monitoring & logging')+'\n\n';
}

// Secrets Management
doc43+='---\n\n## Secrets Management\n\n';
doc43+=(G?'### シークレット管理の3段階\n\n':'### 3-Tier Secrets Management\n\n');
doc43+='1. **'+(G?'開発環境':'Development')+' (`.env.local`):** '+(G?'ローカルのみ、Gitignore必須':'Local only, must be in .gitignore')+'\n';
doc43+='2. **'+(G?'CI/CD':'CI/CD')+' (GitHub Secrets):** '+(G?'OIDC推奨、パーソナルトークン非推奨':'Use OIDC, avoid PATs')+'\n';
doc43+='3. **'+(G?'本番環境':'Production')+' (Secrets Manager):** AWS Secrets Manager / GCP Secret Manager / Azure Key Vault\n\n';
doc43+=(G?'### クライアントバンドル漏洩チェック\n\n':'### Client Bundle Leakage Check\n\n');
doc43+='```bash\n';
doc43+='# Next.js build output inspection\n';
doc43+='npm run build\n';
doc43+='grep -r "sk_live" .next/static/ # Stripe secret key should NOT appear\n';
doc43+='grep -r "SERVICE_ROLE" .next/static/ # Supabase service_role should NOT appear\n';
doc43+='```\n\n';
doc43+=_chk('環境変数がクライアントバンドルに含まれていないことを確認','Verify env vars not in client bundle')+'\n';
doc43+=_chk('NEXT_PUBLIC_プレフィックスの使用を最小限に','Minimize NEXT_PUBLIC_ usage')+'\n';
doc43+=_chk('Secrets Managerでローテーション戦略を設定','Set up rotation strategy in Secrets Manager')+'\n\n';
// Authentication & Session Security
doc43+='---\n\n## Authentication & Session Security\n\n';
doc43+=(G?'### 認証方式: ':'### Auth Method: ')+auth.sot+'\n\n';
if(auth.sot.includes('Supabase')){
doc43+='#### Supabase Auth Configuration\n\n';
doc43+=_chk('MFA有効化 (Dashboard → Auth → MFA)','Enable MFA (Dashboard → Auth → MFA)')+'\n';
doc43+=_chk('Email confirmation強制','Enforce email confirmation')+'\n';
doc43+=_chk('JWT有効期限を適切に設定 (デフォルト1時間)','Set appropriate JWT expiry (default 1h)')+'\n';
doc43+=_chk('Refresh token rotation有効化','Enable refresh token rotation')+'\n';
doc43+=_chk('カスタムClaimsでRBAC実装','Implement RBAC with custom claims')+'\n\n';
}else if(auth.sot.includes('Firebase')){
doc43+='#### Firebase Auth Configuration\n\n';
doc43+=_chk('Firebase Auth MFA有効化','Enable Firebase Auth MFA')+'\n';
doc43+=_chk('Email enumeration protection有効','Enable email enumeration protection')+'\n';
doc43+=_chk('passwordPolicyOptions設定','Configure passwordPolicyOptions')+'\n';
doc43+=_chk('reCAPTCHA統合','Integrate reCAPTCHA')+'\n\n';
}else if(auth.sot.includes('NextAuth')||auth.sot.includes('Auth.js')){
doc43+='#### NextAuth Configuration\n\n';
doc43+=_chk('NEXTAUTH_SECRET強化 (32文字以上ランダム)','Strengthen NEXTAUTH_SECRET (32+ random chars)')+'\n';
doc43+=_chk('session.maxAge適切化 (デフォルト30日→短縮検討)','Optimize session.maxAge (default 30d → consider shortening)')+'\n';
doc43+=_chk('session.updateAge設定','Set session.updateAge')+'\n';
doc43+=_chk('CSRFトークン検証有効','Verify CSRF token validation enabled')+'\n\n';
}else{
doc43+='#### Custom JWT Implementation\n\n';
doc43+=_chk('JWT署名アルゴリズムRS256推奨 (HS256非推奨)','Use RS256 for JWT signing (avoid HS256)')+'\n';
doc43+=_chk('Access token有効期限15分以内','Access token expiry ≤15 min')+'\n';
doc43+=_chk('Refresh token rotation実装','Implement refresh token rotation')+'\n';
doc43+=_chk('Token blacklist実装 (Redis推奨)','Implement token blacklist (Redis recommended)')+'\n\n';
}

doc43+=(G?'### セッション管理ベストプラクティス\n\n':'### Session Management Best Practices\n\n');
doc43+=_chk('ログアウト時にサーバー側でセッション無効化','Invalidate session server-side on logout')+'\n';
doc43+=_chk('並行セッション制限検討','Consider concurrent session limits')+'\n';
doc43+=_chk('異常なセッション活動を監視','Monitor abnormal session activity')+'\n';
doc43+=_chk('パスワード変更時に全セッション無効化','Invalidate all sessions on password change')+'\n\n';
doc43+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc43+='- [Threat Model](./44_threat_model.md)\n';
doc43+='- [Compliance Matrix](./45_compliance_matrix.md)\n';
doc43+='- [AI Security Playbook](./46_ai_security.md)\n';
doc43+='- [Security Testing](./47_security_testing.md)\n';
doc43+='- [Incident Response](./34_incident_response.md)\n';
doc43+='- [Security (Overview)](./08_security.md)\n';
S.files['docs/43_security_intelligence.md']=doc43;
// ═══ DOC 44: STRIDE Threat Model ═══
let doc44='';
doc44+='# '+(G?'脅威モデル — STRIDE分析':'Threat Model — STRIDE Analysis')+'\n\n';
doc44+='> '+(G?'プロジェクト: ':'Project: ')+pn+'\n';
doc44+='> '+(G?'生成日: ':'Generated: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc44+='## '+(G?'システム概要':'System Overview')+'\n\n';
doc44+='- **Frontend:** '+frontend+'\n';
doc44+='- **Backend:** '+backend+'\n';
doc44+='- **Database:** '+database+'\n';
doc44+='- **Auth:** '+auth.sot+'\n';
doc44+='- **Domain:** '+domain+'\n\n';
// Trust Boundaries
doc44+='## '+(G?'トラストバウンダリ':'Trust Boundaries')+'\n\n';
doc44+='```mermaid\n';
doc44+='flowchart LR\n';
doc44+=' Client["👤 Client\\n(Browser)"] -->|HTTPS| CDN["🌐 CDN\\n(Vercel/Cloudflare)"]\n';
doc44+=' CDN -->|TLS| API["⚙️ API\\n('+backend+')"]\n';
doc44+=' API -->|Encrypted| DB["🗄️ Database\\n('+database+')"]\n';
doc44+=' API -->|JWT| Auth["🔐 Auth\\n('+auth.provider+')"]\n';
if(hasPayment){
doc44+=' API -->|Tokenized| Payment["💳 Payment\\n(Stripe)"]\n';
}
doc44+=' \n';
doc44+=' style Client fill:#e1f5ff\n';
doc44+=' style CDN fill:#fff4e1\n';
doc44+=' style API fill:#ffe1e1\n';
doc44+=' style DB fill:#e1ffe1\n';
doc44+=' style Auth fill:#f0e1ff\n';
if(hasPayment){
doc44+=' style Payment fill:#ffe1f0\n';
}
doc44+='```\n\n';
doc44+=(G?'**境界:**\n\n':'**Boundaries:**\n\n');
doc44+='1. **'+(G?'パブリックインターネット ↔ CDN':'Public Internet ↔ CDN')+'**\n';
doc44+='2. **CDN ↔ API** '+(G?'(信頼境界)':'(Trust boundary)')+'\n';
doc44+='3. **API ↔ Database** '+(G?'(内部境界)':'(Internal boundary)')+'\n\n';
// STRIDE per Entity
doc44+='## '+(G?'エンティティ別STRIDE脅威分析':'STRIDE Threat Analysis per Entity')+'\n\n';
if(entities.length===0){
doc44+=(G?'> ⚠️ data_entitiesが未定義のため、一般的な脅威のみ記載します。\n\n':'> ⚠️ No entities defined. Showing generic threats only.\n\n');
}else{
doc44+='| Entity | S (Spoofing) | T (Tampering) | R (Repudiation) | I (Info Disclosure) | D (DoS) | E (Elevation) |\n';
doc44+='|--------|--------------|---------------|-----------------|---------------------|---------|---------------|\n';
entities.forEach(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const hasUser=cols.some(c=>c.col==='user_id'||c.col.includes('user_id'));
const isPay=ent.toLowerCase().includes('payment')||ent.toLowerCase().includes('order')||ent.toLowerCase().includes('transaction');
const isPub=ent.toLowerCase().includes('post')||ent.toLowerCase().includes('article')||ent.toLowerCase().includes('blog');
const hasFileCol=cols.some(c=>c.col.includes('file')||c.col.includes('image')||c.col.includes('attachment'));
let pattern=STRIDE_PATTERNS.default;
if(isPay)pattern=STRIDE_PATTERNS.isPayment;
else if(hasUser)pattern=STRIDE_PATTERNS.hasUserId;
else if(isPub)pattern=STRIDE_PATTERNS.isPublic;
else if(hasFileCol)pattern=STRIDE_PATTERNS.hasFile;
doc44+='| '+ent+' | '+_lvl(pattern.S)+' | '+_lvl(pattern.T)+' | '+_lvl(pattern.R)+' | '+_lvl(pattern.I)+' | '+_lvl(pattern.D)+' | '+_lvl(pattern.E)+' |\n';
});
doc44+='\n';
}

// Attack Surface Analysis
doc44+='## '+(G?'攻撃対象領域分析':'Attack Surface Analysis')+'\n\n';
doc44+=(G?'### 外部入力ポイント\n\n':'### External Input Points\n\n');
const inputs=[];
if(features.some(f=>f.toLowerCase().includes('auth')||f.toLowerCase().includes('login')||f.toLowerCase().includes('signup'))){
inputs.push(G?'ログイン/サインアップフォーム':'Login/Signup forms');
}
if(features.some(f=>f.toLowerCase().includes('post')||f.toLowerCase().includes('comment')||f.toLowerCase().includes('review'))){
inputs.push(G?'コンテンツ投稿フォーム':'Content submission forms');
}
if(features.some(f=>f.toLowerCase().includes('search'))){
inputs.push(G?'検索クエリ':'Search queries');
}
if(features.some(f=>f.toLowerCase().includes('upload')||f.toLowerCase().includes('file')||f.toLowerCase().includes('image'))){
inputs.push(G?'ファイルアップロード':'File uploads');
}
if(features.some(f=>f.toLowerCase().includes('api'))){
inputs.push('REST/GraphQL API');
}
if(hasPayment){
inputs.push(G?'決済フォーム':'Payment forms');
}

if(inputs.length>0){
inputs.forEach(inp=>doc44+='- '+inp+'\n');
doc44+='\n';
}else{
doc44+=(G?'> 特定の入力ポイントは検出されませんでした。mvp_featuresを確認してください。\n\n':'> No specific input points detected. Review mvp_features.\n\n');
}

doc44+=(G?'### 高リスクフィーチャー\n\n':'### High-Risk Features\n\n');
const highRisk=[];
if(features.some(f=>f.toLowerCase().includes('auth')))highRisk.push(G?'認証機能 (CRITICAL)':'Authentication (CRITICAL)');
if(hasPayment)highRisk.push(G?'決済処理 (CRITICAL)':'Payment processing (CRITICAL)');
if(features.some(f=>f.toLowerCase().includes('upload')))highRisk.push(G?'ファイルアップロード (HIGH)':'File uploads (HIGH)');
if(hasAI)highRisk.push(G?'AI統合 (HIGH — プロンプトインジェクション)':'AI integration (HIGH — prompt injection)');
if(features.some(f=>f.toLowerCase().includes('admin')))highRisk.push(G?'管理機能 (HIGH)':'Admin features (HIGH)');
if(highRisk.length>0){
highRisk.forEach(hr=>doc44+='- '+hr+'\n');
doc44+='\n';
}

// Threat-Mitigation Matrix
doc44+='## '+(G?'脅威-対策マトリクス':'Threat-Mitigation Matrix')+'\n\n';
doc44+='| '+(G?'脅威':'Threat')+' | '+(G?'リスク':'Risk')+' | '+(G?'対策':'Mitigation')+' | '+(G?'実装':'Implementation')+' | Status |\n';
doc44+='|------|------|-----------|----------------|--------|\n';
// Generic threats
const threats=[
{threat_ja:'SQLインジェクション',threat_en:'SQL Injection',risk:'HIGH',mit_ja:'パラメータ化クエリ',mit_en:'Parameterized queries',impl:'ORM/Supabase RLS'},
{threat_ja:'XSS',threat_en:'XSS',risk:'HIGH',mit_ja:'入力サニタイズ + CSP',mit_en:'Input sanitization + CSP',impl:'DOMPurify + CSP headers'},
{threat_ja:'CSRF',threat_en:'CSRF',risk:'MED',mit_ja:'CSRFトークン',mit_en:'CSRF tokens',impl:'SameSite cookies + tokens'},
{threat_ja:'IDOR',threat_en:'IDOR',risk:'HIGH',mit_ja:'認可チェック',mit_en:'Authorization checks',impl:'RLS policies / owner checks'},
{threat_ja:'認証バイパス',threat_en:'Auth bypass',risk:'CRITICAL',mit_ja:'サーバー側検証',mit_en:'Server-side validation',impl:'Middleware / RLS'},
];
if(hasPayment){
threats.push({threat_ja:'カード情報漏洩',threat_en:'Card data leakage',risk:'CRITICAL',mit_ja:'トークナイゼーション',mit_en:'Tokenization',impl:'Stripe Elements'});
}
if(hasAI){
threats.push({threat_ja:'プロンプトインジェクション',threat_en:'Prompt injection',risk:'HIGH',mit_ja:'入力検証 + コンテキスト分離',mit_en:'Input validation + context isolation',impl:'See docs/46_ai_security.md'});
}

threats.forEach(t=>{
const threat=G?t.threat_ja:t.threat_en;
const mit=G?t.mit_ja:t.mit_en;
doc44+='| '+threat+' | '+_lvl(t.risk)+' | '+mit+' | '+t.impl+' | ⬜ |\n';
});
doc44+='\n';
doc44+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc44+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc44+='- [Security Testing](./47_security_testing.md)\n';
doc44+='- [Incident Response](./34_incident_response.md)\n';
S.files['docs/44_threat_model.md']=doc44;
// ═══ DOC 45: Compliance Matrix ═══
let doc45='';
doc45+='# '+(G?'コンプライアンスマトリクス':'Compliance Matrix')+'\n\n';
doc45+='> '+(G?'プロジェクト: ':'Project: ')+pn+'\n';
doc45+='> '+(G?'ドメイン: ':'Domain: ')+domain+'\n';
doc45+='> '+(G?'生成日: ':'Generated: ')+new Date().toISOString().split('T')[0]+'\n\n';
doc45+=(G?'このドキュメントは、プロジェクトのドメインに基づいて該当するコンプライアンスフレームワークのチェックリストを提供します。\n\n':'This document provides compliance framework checklists based on your project domain.\n\n');
// Determine applicable compliance frameworks
const applicableComp=[];
Object.keys(COMPLIANCE_DB).forEach(key=>{
const comp=COMPLIANCE_DB[key];
if(comp.domains.includes(domain)){
applicableComp.push(comp);
}
});
// Always include ASVS as baseline
if(!applicableComp.some(c=>c.name.includes('ASVS'))){
applicableComp.push(COMPLIANCE_DB.asvs);
}

if(applicableComp.length===0){
applicableComp.push(COMPLIANCE_DB.asvs);
}

doc45+='## '+(G?'適用フレームワーク':'Applicable Frameworks')+'\n\n';
applicableComp.forEach(c=>doc45+='- **'+c.name+'** ('+c.domains.join(', ')+')\n');
doc45+='\n---\n\n';
applicableComp.forEach(comp=>{
doc45+=_compSection(comp,G);
doc45+='---\n\n';
});
doc45+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc45+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc45+='- [Incident Response](./34_incident_response.md)\n';
doc45+='- [QA Strategy](./28_qa_strategy.md)\n';
S.files['docs/45_compliance_matrix.md']=doc45;
// ═══ DOC 46: AI Security Playbook ═══
let doc46='';
doc46+='# '+(G?'AI時代のセキュリティプレイブック':'AI-Era Security Playbook')+'\n\n';
doc46+='> '+(G?'AI生成コード特有のリスクと対策を包括的にカバー':'Comprehensive coverage of AI-generated code risks and mitigations')+'\n\n';
doc46+='## '+(G?'1. Velocity Paradox — 速度のパラドックス':'1. Velocity Paradox')+'\n\n';
doc46+=(G?
'AI支援開発により開発速度は劇的に向上しますが、同時にセキュリティリスクも増大します。\n\n'+
'**統計:**\n'+
'- AI生成コードの45-62%に脆弱性が含まれる (Stanford研究)\n'+
'- 「正しさの幻想」(Illusion of Correctness): AIが生成したコードは人間より信頼されやすい\n'+
'- シャドーコード累積: レビューされないAI生成コードが積み重なるリスク\n\n'
:
'AI-assisted development dramatically increases velocity, but also security risks.\n\n'+
'**Statistics:**\n'+
'- 45-62% of AI-generated code contains vulnerabilities (Stanford study)\n'+
'- Illusion of Correctness: AI code is trusted more than human code\n'+
'- Shadow Code Accumulation: Unreviewed AI code accumulates\n\n'
);
doc46+='## '+(G?'2. Package Hallucination Detection — パッケージ幻覚検知':'2. Package Hallucination Detection')+'\n\n';
doc46+=(G?'AIは存在しないパッケージを「幻覚」として提案することがあります。\n\n':'AI can hallucinate non-existent packages.\n\n');
doc46+=(G?'### 検証ワークフロー\n\n':'### Verification Workflow\n\n');
doc46+='```bash\n';
doc46+='# Step 1: Verify package exists\n';
doc46+='npm view <package-name>\n\n';
doc46+='# Step 2: Check registry\n';
doc46+='curl https://registry.npmjs.org/<package-name>\n\n';
doc46+='# Step 3: Check downloads (low downloads = suspicious)\n';
doc46+='npm view <package-name> dist.tarball\n';
doc46+='```\n\n';
doc46+=(G?'### CI検証ステップ\n\n':'### CI Verification Step\n\n');
doc46+='```yaml\n';
doc46+='# .github/workflows/ci.yml\n';
doc46+='- name: Verify packages exist\n';
doc46+=' run: |\n';
doc46+=' for pkg in $(jq -r \'.dependencies | keys[]\' package.json); do\n';
doc46+=' npm view "$pkg" > /dev/null || (echo "Package $pkg not found" && exit 1)\n';
doc46+=' done\n';
doc46+='```\n\n';
doc46+=_chk('Lockfileを必ず使用 (package-lock.json / yarn.lock)','Always use lockfile (package-lock.json / yarn.lock)')+'\n';
doc46+=_chk('SCA (Software Composition Analysis) ツール導入 (Snyk/Dependabot)','Adopt SCA tools (Snyk/Dependabot)')+'\n\n';
doc46+='## '+(G?'3. AI生成コードレビューチェックリスト':'3. AI-Generated Code Review Checklist')+'\n\n';
doc46+=_chk('認可ロジック(Authorization)の存在確認 — IDORチェック','Verify authorization logic exists — check for IDOR')+'\n';
doc46+=_chk('シークレットのハードコード確認','Check for hardcoded secrets')+'\n';
doc46+=_chk('クライアントバンドルへのシークレット漏洩','Verify secrets not in client bundle')+'\n';
doc46+=_chk('入力バリデーションの網羅性','Verify comprehensive input validation')+'\n';
doc46+=_chk('エラーハンドリングの適切性 (情報漏洩回避)','Proper error handling (avoid info leakage)')+'\n';
doc46+=_chk('論理的欠陥の有無 (ビジネスロジック検証)','Check for logical flaws (business logic)')+'\n';
doc46+=_chk('レースコンディション脆弱性','Race condition vulnerabilities')+'\n';
doc46+=_chk('SQL/NoSQLインジェクション防止','SQL/NoSQL injection prevention')+'\n\n';
doc46+='## '+(G?'4. 敵対的AIレビュープロンプト':'4. Adversarial AI Review Prompts')+'\n\n';
doc46+=(G?'セキュリティ監査用プロンプトテンプレート:\n\n':'Security audit prompt templates:\n\n');
// Entity security classification (reuse pattern from doc44 STRIDE analysis)
const entClasses=entities.map(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const hasU=cols.some(c=>c.col==='user_id'||c.col.includes('user_id'));
const isPay=ent.toLowerCase().match(/payment|order|transaction/);
const hasF=cols.some(c=>c.col.includes('file')||c.col.includes('image'));
return ent+'('+(isPay?'CRITICAL':hasU?'HIGH':hasF?'MED':'STD')+')';
}).join(', ');
const rlsCtx=backend.includes('Supabase')
?(G?'Supabase RLSポリシーを全テーブルで検証':'Verify Supabase RLS policies on all tables')
:backend.includes('Firebase')
?(G?'Firestore Security Rulesを全コレクションで検証':'Verify Firestore Security Rules on all collections')
:(G?'認可ミドルウェアを全ルートで検証':'Verify authorization middleware on all routes');
// Context-aware prompts with project-specific details
const prompts_ja=[
'あなたはセキュリティ監査員です。このコードの認可ロジックの不備を見つけてください。特にIDOR (Insecure Direct Object Reference) 脆弱性に注目してください。\n\n'+
'**プロジェクトコンテキスト:**\n'+
'- エンティティとセキュリティ分類: '+entClasses+'\n'+
'- 認証方式: '+auth.sot+'\n'+
'- 認可検証ポイント: '+rlsCtx+'\n\n'+
'各エンティティのowner検証が適切か、RLS/ミドルウェアがデフォルト拒否原則に従っているかを重点的にチェックしてください。',

'このコードにおけるすべての外部入力ポイントをリストアップし、各入力に対するバリデーション・サニタイゼーションが適切か評価してください。\n\n'+
'**対象エンティティと入力カラム:**\n'+
entities.slice(0,5).map(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const inputCols=cols.filter(c=>!c.col.includes('_id')&&!c.col.includes('created')&&!c.col.includes('updated')).map(c=>c.col).join(', ');
return '- '+ent+': '+inputCols;
}).join('\n')+'\n\n'+
'Zodスキーマによるサーバーサイド検証が全入力に適用されているか確認してください。',

'このコードのエラーハンドリングを分析し、スタックトレースやデバッグ情報が本番環境で漏洩する可能性がないか確認してください。\n\n'+
'**技術スタック別の注意点:**\n'+
(backend.includes('Supabase')?'- Supabase: .error プロパティが詳細すぎないか確認\n':'')+
(backend.includes('Firebase')?'- Firebase: Cloud Functionsのエラーがクライアントに漏洩していないか確認\n':'')+
(frontend.includes('Next.js')?'- Next.js: Server Actionsのエラーが適切にキャッチされているか確認\n':'')+
'\n本番環境では一般的なエラーメッセージのみを返し、詳細はログに記録してください。',

'このコードにハードコードされたシークレット、APIキー、パスワードがないか探してください。環境変数が適切に使用されているか確認してください。\n\n'+
'**チェックすべき環境変数:**\n'+
(backend.includes('Supabase')?'- SUPABASE_SERVICE_ROLE_KEY (サーバーサイドのみ)\n- NEXT_PUBLIC_SUPABASE_ANON_KEY (クライアント公開OK)\n':'')+
(backend.includes('Firebase')?'- FIREBASE_SERVICE_ACCOUNT_KEY (サーバーサイドのみ)\n- NEXT_PUBLIC_FIREBASE_CONFIG (クライアント公開OK)\n':'')+
(hasPayment?'- STRIPE_SECRET_KEY (サーバーサイドのみ)\n- NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY (クライアント公開OK)\n':'')+
'\nクライアントバンドルに機密情報が含まれていないことを `npm run build` 後に検証してください。',

'このコードのセッション管理・トークン管理を分析し、セッション固定攻撃、トークン漏洩、不適切な有効期限設定がないか確認してください。\n\n'+
'**認証実装の詳細:**\n'+
'- Source of Truth: '+auth.sot+'\n'+
'- トークンタイプ: '+(auth.tokenType||'JWT')+'\n'+
'- 検証方式: '+(auth.tokenVerify||'署名検証')+'\n\n'+
(auth.sot.includes('Supabase')?'Supabase Auth: JWT有効期限、refresh token rotation、MFA設定を確認\n':'')+
(auth.sot.includes('Firebase')?'Firebase Auth: セッション有効期限、カスタムクレーム、reCAPTCHA統合を確認\n':'')+
(auth.sot.includes('NextAuth')?'NextAuth: NEXTAUTH_SECRET強度、session.maxAge、CSRF保護を確認\n':'')
];
const prompts_en=[
'You are a security auditor. Find authorization logic flaws in this code. Focus on IDOR (Insecure Direct Object Reference) vulnerabilities.\n\n'+
'**Project Context:**\n'+
'- Entities and Security Classes: '+entClasses+'\n'+
'- Auth Method: '+auth.sot+'\n'+
'- Authorization Verification: '+rlsCtx+'\n\n'+
'Focus on verifying owner checks for each entity and ensuring RLS/middleware follows default-deny principle.',

'List all external input points in this code and evaluate whether validation/sanitization is appropriate for each input.\n\n'+
'**Target Entities and Input Columns:**\n'+
entities.slice(0,5).map(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const inputCols=cols.filter(c=>!c.col.includes('_id')&&!c.col.includes('created')&&!c.col.includes('updated')).map(c=>c.col).join(', ');
return '- '+ent+': '+inputCols;
}).join('\n')+'\n\n'+
'Verify that Zod schema server-side validation is applied to all inputs.',

'Analyze error handling in this code and verify that stack traces or debug information cannot leak in production.\n\n'+
'**Stack-Specific Notes:**\n'+
(backend.includes('Supabase')?'- Supabase: Check if .error property is too detailed\n':'')+
(backend.includes('Firebase')?'- Firebase: Verify Cloud Functions errors do not leak to client\n':'')+
(frontend.includes('Next.js')?'- Next.js: Verify Server Actions errors are properly caught\n':'')+
'\nReturn generic error messages in production and log details server-side.',

'Search for hardcoded secrets, API keys, or passwords in this code. Verify environment variables are used appropriately.\n\n'+
'**Environment Variables to Check:**\n'+
(backend.includes('Supabase')?'- SUPABASE_SERVICE_ROLE_KEY (server-side only)\n- NEXT_PUBLIC_SUPABASE_ANON_KEY (client OK)\n':'')+
(backend.includes('Firebase')?'- FIREBASE_SERVICE_ACCOUNT_KEY (server-side only)\n- NEXT_PUBLIC_FIREBASE_CONFIG (client OK)\n':'')+
(hasPayment?'- STRIPE_SECRET_KEY (server-side only)\n- NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY (client OK)\n':'')+
'\nVerify no secrets in client bundle after `npm run build`.',

'Analyze session/token management in this code and check for session fixation, token leakage, or improper expiration settings.\n\n'+
'**Auth Implementation Details:**\n'+
'- Source of Truth: '+auth.sot+'\n'+
'- Token Type: '+(auth.tokenType||'JWT')+'\n'+
'- Verification: '+(auth.tokenVerify||'Signature verification')+'\n\n'+
(auth.sot.includes('Supabase')?'Supabase Auth: Check JWT expiry, refresh token rotation, MFA settings\n':'')+
(auth.sot.includes('Firebase')?'Firebase Auth: Check session expiry, custom claims, reCAPTCHA integration\n':'')+
(auth.sot.includes('NextAuth')?'NextAuth: Check NEXTAUTH_SECRET strength, session.maxAge, CSRF protection\n':'')
];
const prompts=G?prompts_ja:prompts_en;
// Add stack-specific prompts (conditional)
if(backend.includes('Supabase')){
prompts.push(G?
'Supabase RLSポリシーの網羅性を監査してください。\n\n'+
'**監査対象テーブル:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**チェックポイント:**\n'+
'1. 全テーブルでRLS有効化 (`ALTER TABLE ... ENABLE ROW LEVEL SECURITY`)\n'+
'2. SELECT/INSERT/UPDATE/DELETE 各操作にポリシー定義\n'+
'3. `auth.uid() = user_id` パターンの一貫適用\n'+
'4. `service_role` キーがサーバーサイドのみで使用\n'+
'5. `anon` キーの権限が最小限\n\n'+
'Database settings → Row Level Security でポリシーの有無を確認し、不足があれば具体的なCREATE POLICYステートメントを提案してください。'
:
'Audit Supabase RLS policy coverage.\n\n'+
'**Target Tables:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**Checkpoints:**\n'+
'1. RLS enabled on all tables (`ALTER TABLE ... ENABLE ROW LEVEL SECURITY`)\n'+
'2. Policies defined for SELECT/INSERT/UPDATE/DELETE\n'+
'3. Consistent `auth.uid() = user_id` pattern\n'+
'4. `service_role` key used server-side only\n'+
'5. `anon` key permissions minimized\n\n'+
'Check Database settings → Row Level Security and propose specific CREATE POLICY statements for any gaps.'
);
}

if(backend.includes('Firebase')){
prompts.push(G?
'Firestore Security Rulesの網羅性を監査してください。\n\n'+
'**監査対象コレクション:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**チェックポイント:**\n'+
'1. 全コレクションでルール定義 (デフォルト拒否)\n'+
'2. `request.auth.uid == resource.data.userId` パターンの一貫適用\n'+
'3. カスタムクレームによるロールベースアクセス制御\n'+
'4. サブコレクションへのルール継承\n'+
'5. Admin SDKの使用が最小限\n\n'+
'firestore.rules ファイルを生成し、不足があれば具体的なルール定義を提案してください。'
:
'Audit Firestore Security Rules coverage.\n\n'+
'**Target Collections:**\n'+
entities.map(ent=>'- '+pluralize(ent).toLowerCase()).join('\n')+'\n\n'+
'**Checkpoints:**\n'+
'1. Rules defined for all collections (default deny)\n'+
'2. Consistent `request.auth.uid == resource.data.userId` pattern\n'+
'3. Role-based access control with custom claims\n'+
'4. Rule inheritance for subcollections\n'+
'5. Admin SDK usage minimized\n\n'+
'Generate firestore.rules file and propose specific rule definitions for any gaps.'
);
}

// Add compliance-specific prompts (conditional)
const compFrameworks=[];
Object.keys(COMPLIANCE_DB).forEach(key=>{
if(COMPLIANCE_DB[key].domains.includes(domain)) compFrameworks.push(COMPLIANCE_DB[key]);
});
if(compFrameworks.length>0){
const fwNames=compFrameworks.map(c=>c.name).join(', ');
prompts.push(G?
'コンプライアンス監査: '+fwNames+'\n\n'+
'このプロジェクトのドメイン ('+domain+') では以下のコンプライアンスフレームワークが該当します。\n\n'+
'docs/45_compliance_matrix.md を参照し、各フレームワークの必須要件がコードに実装されているか検証してください。\n\n'+
'**検証方法:**\n'+
'1. docs/45_compliance_matrix.md の要件チェックリストを確認\n'+
'2. 各要件IDに対応する実装箇所をコードから特定\n'+
'3. 未実装または不十分な要件をリストアップ\n'+
'4. 各要件の実装コード例を提示\n\n'+
'出力形式: Markdown表 (要件ID | 要件名 | 実装状況 | 不足事項 | 対策コード)'
:
'Compliance Audit: '+fwNames+'\n\n'+
'The following compliance frameworks apply to this project\'s domain ('+domain+').\n\n'+
'Reference docs/45_compliance_matrix.md and verify that each framework\'s mandatory requirements are implemented in the code.\n\n'+
'**Verification Method:**\n'+
'1. Review requirement checklist in docs/45_compliance_matrix.md\n'+
'2. Identify implementation locations in code for each requirement ID\n'+
'3. List unimplemented or insufficient requirements\n'+
'4. Provide implementation code examples for each requirement\n\n'+
'Output format: Markdown table (Req ID | Requirement | Status | Gaps | Fix Code)'
);
}

prompts.forEach((p,i)=>{
doc46+='### '+(G?'プロンプト':'Prompt')+' '+(i+1)+'\n\n';
doc46+='```\n'+p+'\n```\n\n';
});
doc46+='## '+(G?'5. Agent Security (when ai_auto ≠ None)':'5. Agent Security (when ai_auto ≠ None)')+'\n\n';
if(hasAI){
doc46+=(G?'### Human-in-the-Loop (HITL) ゲートパターン\n\n':'### Human-in-the-Loop (HITL) Gate Pattern\n\n');
doc46+=(G?'**不可逆操作の一覧:**\n\n':'**Irreversible Operations:**\n\n');
doc46+='- '+(G?'本番デプロイ':'Production deployment')+'\n';
doc46+='- '+(G?'データベース削除・マイグレーション':'Database deletion/migration')+'\n';
doc46+='- '+(G?'外部API課金操作':'External API billing operations')+'\n';
doc46+='- '+(G?'本番シークレット変更':'Production secret changes')+'\n';
doc46+='- Git force push / branch削除\n\n';
doc46+='```mermaid\n';
doc46+='flowchart TD\n';
doc46+=' A[Agent Action Request] --> B{Reversible?}\n';
doc46+=' B -->|Yes| C[Execute]\n';
doc46+=' B -->|No| D[HITL Gate]\n';
doc46+=' D --> E{Human Approval?}\n';
doc46+=' E -->|Yes| C\n';
doc46+=' E -->|No| F[Abort]\n';
doc46+='```\n\n';
doc46+=(G?'### サンドボックス設定\n\n':'### Sandbox Configuration\n\n');
doc46+=_chk('Docker/gVisor隔離環境でAgent実行','Run agents in Docker/gVisor isolation')+'\n';
doc46+=_chk('ネットワークホワイトリスト設定','Configure network whitelist')+'\n';
doc46+=_chk('最小権限APIキー使用','Use least-privilege API keys')+'\n';
doc46+=_chk('ファイルシステムアクセス制限','Restrict filesystem access')+'\n\n';
doc46+=(G?'### 間接プロンプトインジェクション防御\n\n':'### Indirect Prompt Injection Defense\n\n');
doc46+=(G?
'外部コンテンツ(Web、PDF、ユーザー投稿)をAIに処理させる際、悪意のある指示が埋め込まれている可能性があります。\n\n'+
'**対策:**\n\n'
:
'When processing external content (Web, PDF, user submissions), malicious instructions may be embedded.\n\n'+
'**Mitigations:**\n\n'
);
doc46+=_chk('外部コンテンツとシステムプロンプトを明確に分離','Clearly separate external content from system prompts')+'\n';
doc46+=_chk('コンテンツ取得時にメタデータ検証','Validate metadata when fetching content')+'\n';
doc46+=_chk('出力の検証・サニタイゼーション','Validate and sanitize outputs')+'\n';
doc46+=_chk('ユーザー入力にプレフィックス付与 (例: "User input: ...")','Prefix user input (e.g., "User input: ...")')+'\n\n';
}else{
doc46+=(G?'> ai_auto=noneのため、このセクションはスキップされます。\n\n':'> ai_auto=none, this section is skipped.\n\n');
}

doc46+='## '+(G?'6. Privacy Mode & Data Protection':'6. Privacy Mode & Data Protection')+'\n\n';
doc46+=(G?'### AI開発ツールのプライバシーモード設定\n\n':'### AI Development Tool Privacy Mode\n\n');
doc46+='- **GitHub Copilot:** Settings → Suggestions matching public code: Block\n';
doc46+='- **Cursor:** Settings → Privacy Mode: Enabled\n';
doc46+='- **Cline:** Privacy settings確認\n\n';
doc46+=_chk('コード学習データ除外設定を有効化','Enable code training data exclusion')+'\n';
doc46+=_chk('機密リポジトリでAI機能を無効化検討','Consider disabling AI features for sensitive repos')+'\n';
doc46+=_chk('.aiignoreファイルで機密ファイル除外','Exclude sensitive files with .aiignore')+'\n\n';
doc46+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc46+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc46+='- [Security Testing](./47_security_testing.md)\n';
doc46+='- [AI Dev Runbook](./40_ai_dev_runbook.md)\n';
if(hasAI){
doc46+='- [Skills Catalog](../skills/catalog.md)\n';
}

S.files['docs/46_ai_security.md']=doc46;
// ═══ DOC 47: Security Testing Templates ═══
let doc47='';
doc47+='# '+(G?'セキュリティテストテンプレート集':'Security Test Templates')+'\n\n';
doc47+='> '+(G?'実行可能なセキュリティテストコード':'Executable security test code')+'\n\n';
// RLS Tests (Supabase only)
if(backend.includes('Supabase')&&entities.length>0){
doc47+='## '+(G?'1. RLS Policy Tests (pgTAP)':'1. RLS Policy Tests (pgTAP)')+'\n\n';
doc47+=(G?'Supabaseのpostgresデータベースで直接実行するテストです。\n\n':'Tests to run directly on Supabase postgres database.\n\n');
entities.slice(0,3).forEach(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
const hasUser=cols.some(c=>c.col==='user_id'||c.col.includes('user_id'));
if(!hasUser)return;
const tbl=pluralize(ent).toLowerCase();
doc47+='### '+ent+' RLS Test\n\n';
doc47+='```sql\n';
doc47+='BEGIN;\n';
doc47+='SELECT plan(3);\n\n';
doc47+='-- Setup: Insert test data as user-123\n';
doc47+='SET LOCAL ROLE authenticated;\n';
doc47+='SET LOCAL "request.jwt.claim.sub" TO \'user-123\';\n';
doc47+='INSERT INTO '+tbl+' (user_id, ...) VALUES (\'user-123\', ...);\n\n';
doc47+='-- Test 1: User sees own '+ent+'\n';
doc47+='SELECT results_eq(\n';
doc47+=' \'SELECT count(*)::int FROM '+tbl+' WHERE user_id = \'\'user-123\'\'\',\n';
doc47+=' ARRAY[1],\n';
doc47+=' \'User sees own '+ent+'\'\n';
doc47+=');\n\n';
doc47+='-- Test 2: User cannot see other user\'s '+ent+'\n';
doc47+='SELECT is_empty(\n';
doc47+=' \'SELECT * FROM '+tbl+' WHERE user_id = \'\'user-456\'\'\',\n';
doc47+=' \'User cannot see other user\\\'s '+ent+'\'\n';
doc47+=');\n\n';
doc47+='-- Test 3: Anon cannot insert\n';
doc47+='SET LOCAL ROLE anon;\n';
doc47+='SELECT throws_ok(\n';
doc47+=' \'INSERT INTO '+tbl+' (user_id, ...) VALUES (\'\'user-123\'\', ...)\',\n';
doc47+=' \'Anon cannot insert '+ent+'\'\n';
doc47+=');\n\n';
doc47+='ROLLBACK;\n';
doc47+='```\n\n';
});
}

// Input Validation Schemas (Next.js/Zod)
if(frontend.includes('Next.js')&&entities.length>0){
doc47+='## '+(G?'2. Input Validation Schemas (Zod)':'2. Input Validation Schemas (Zod)')+'\n\n';
entities.slice(0,3).forEach(ent=>{
const cols=getEntityColumns(ent,G,entities)||[];
doc47+='### '+ent+' Schema\n\n';
doc47+='```typescript\n';
doc47+='import { z } from \'zod\';\n\n';
doc47+='export const '+ent.toLowerCase()+'Schema = z.object({\n';
cols.slice(0,5).forEach(c=>{
const name=c.col;
const type=c.type||'VARCHAR';
const constraints=c.constraint||'';
if(name.includes('_id'))return; // Skip IDs

let zodType='z.string()';
if(type.includes('INT'))zodType='z.number().int()';
else if(type.includes('BOOL'))zodType='z.boolean()';
else if(type.includes('TEXT'))zodType='z.string()';
else if(type.includes('VARCHAR')){
const maxMatch=type.match(/VARCHAR\((\d+)\)/);
if(maxMatch)zodType='z.string().max('+maxMatch[1]+')';
}

if(constraints.includes('NOT NULL'))zodType+='.min(1)';
doc47+=' '+name+': '+zodType+',\n';
});
doc47+='});\n\n';
doc47+='export type '+ent+' = z.infer<typeof '+ent.toLowerCase()+'Schema>;\n';
doc47+='```\n\n';
});
}

// API Security Tests
doc47+='## '+(G?'3. API セキュリティテスト':'3. API Security Tests')+'\n\n';
doc47+=(G?'### 認証バイパステスト\n\n':'### Auth Bypass Test\n\n');
doc47+='```javascript\n';
doc47+='// Using Jest + Supertest\n';
doc47+='test(\'should reject unauthenticated requests\', async () => {\n';
doc47+=' const res = await request(app)\n';
doc47+=' .get(\'/api/protected\')\n';
doc47+=' .expect(401);\n';
doc47+=' expect(res.body.error).toMatch(/unauthorized/i);\n';
doc47+='});\n';
doc47+='```\n\n';
doc47+=(G?'### IDORテスト\n\n':'### IDOR Test\n\n');
doc47+='```javascript\n';
doc47+='test(\'should prevent IDOR attacks\', async () => {\n';
doc47+=' const user1Token = await getTokenForUser(\'user-1\');\n';
doc47+=' const user2Token = await getTokenForUser(\'user-2\');\n\n';
doc47+=' // User 2 tries to access User 1\'s resource\n';
doc47+=' const res = await request(app)\n';
doc47+=' .get(\'/api/posts/user-1-post-id\')\n';
doc47+=' .set(\'Authorization\', `Bearer ${user2Token}`)\n';
doc47+=' .expect(403);\n';
doc47+='});\n';
doc47+='```\n\n';
doc47+=(G?'### Rate Limitingテスト\n\n':'### Rate Limiting Test\n\n');
doc47+='```javascript\n';
doc47+='test(\'should enforce rate limits\', async () => {\n';
doc47+=' const requests = Array(101).fill(null).map(() =>\n';
doc47+=' request(app).get(\'/api/public\')\n';
doc47+=' );\n';
doc47+=' const results = await Promise.all(requests);\n';
doc47+=' const rateLimited = results.filter(r => r.status === 429);\n';
doc47+=' expect(rateLimited.length).toBeGreaterThan(0);\n';
doc47+='});\n';
doc47+='```\n\n';
// OWASP ZAP
doc47+='## '+(G?'4. OWASP ZAP Configuration':'4. OWASP ZAP Configuration')+'\n\n';
doc47+='```yaml\n';
doc47+='# .github/workflows/zap-scan.yml\n';
doc47+='name: OWASP ZAP Scan\n';
doc47+='on: [pull_request]\n\n';
doc47+='jobs:\n';
doc47+=' zap_scan:\n';
doc47+=' runs-on: ubuntu-latest\n';
doc47+=' steps:\n';
doc47+=' - uses: actions/checkout@v4\n';
doc47+=' - name: ZAP Scan\n';
doc47+=' uses: zaproxy/action-baseline@v0.7.0\n';
doc47+=' with:\n';
doc47+=' target: \'https://your-preview-url.vercel.app\'\n';
doc47+=' rules_file_name: \'.zap/rules.tsv\'\n';
doc47+=' cmd_options: \'-a\'\n';
doc47+='```\n\n';
// Penetration Testing Checklist
doc47+='## '+(G?'5. ペネトレーションテストチェックリスト':'5. Penetration Testing Checklist')+'\n\n';
doc47+=(G?'### 事前準備\n\n':'### Pre-Test Preparation\n\n');
doc47+=_chk('テスト環境準備 (本番データ使用禁止)','Prepare test environment (no production data)')+'\n';
doc47+=_chk('テストスコープ定義','Define test scope')+'\n';
doc47+=_chk('関係者への通知','Notify stakeholders')+'\n\n';
doc47+=(G?'### テスト実施項目\n\n':'### Test Execution Items\n\n');
doc47+='#### Authentication & Session\n';
doc47+=_chk('Brute force攻撃耐性','Brute force resistance')+'\n';
doc47+=_chk('パスワードリセット脆弱性','Password reset vulnerabilities')+'\n';
doc47+=_chk('セッション固定攻撃','Session fixation')+'\n';
doc47+=_chk('Remember me機能の安全性','Remember me security')+'\n\n';
doc47+='#### Input Validation\n';
doc47+=_chk('SQLインジェクション','SQL injection')+'\n';
doc47+=_chk('XSS (Reflected/Stored/DOM-based)','XSS (Reflected/Stored/DOM-based)')+'\n';
doc47+=_chk('コマンドインジェクション','Command injection')+'\n';
doc47+=_chk('パストラバーサル','Path traversal')+'\n\n';
doc47+='#### API Security\n';
doc47+=_chk('認証・認可バイパス','Auth/authz bypass')+'\n';
doc47+=_chk('IDOR (Insecure Direct Object Reference)','IDOR')+'\n';
doc47+=_chk('Mass Assignment','Mass Assignment')+'\n';
doc47+=_chk('Rate Limiting','Rate Limiting')+'\n\n';
doc47+='#### File Upload\n';
doc47+=_chk('悪意のあるファイルアップロード','Malicious file upload')+'\n';
doc47+=_chk('ファイル拡張子検証','File extension validation')+'\n';
doc47+=_chk('ファイルサイズ制限','File size limits')+'\n\n';
doc47+=(G?'## 📚 関連ドキュメント\n\n':'## 📚 Related Documents\n\n');
doc47+='- [Security Intelligence](./43_security_intelligence.md)\n';
doc47+='- [Threat Model](./44_threat_model.md)\n';
doc47+='- [Test Strategy](./36_test_strategy.md)\n';
doc47+='- [QA Strategy](./28_qa_strategy.md)\n';
S.files['docs/47_security_testing.md']=doc47;
}
/* ═══ PILLAR ⑬: STRATEGIC INTELLIGENCE ═══ */

// Strategic Intelligence helper (10 args → 10 bilingual properties)
const _si = (reg_ja,reg_en, arch_ja,arch_en, fail_ja,fail_en, trend_ja,trend_en, bm_ja,bm_en) => ({
reg_ja, reg_en, // 業種別規制・コンプライアンス (string[], 3-4 items)
arch_ja, arch_en, // アーキテクチャパターン (string[], 2-3 items)
fail_ja, fail_en, // 失敗要因 (string[], 3 items)
trend_ja, trend_en, // 2026-2030トレンド (string[], 3-4 items)
bm_ja, bm_en // ビジネスモデル (string[], 2-3 items, format: "model|revenue|target")
});
// Industry Intelligence Database (24 domains + default)
const INDUSTRY_INTEL = {
education: _si(
['FERPA準拠(学生記録保護)','COPPA準拠(13歳未満ユーザー)','アクセシビリティ(WCAG 2.1 AA以上)'],
['FERPA compliance (student record protection)','COPPA compliance (users under 13)','Accessibility (WCAG 2.1 AA minimum)'],
['適応学習システム(AI活用)','マイクロラーニング設計','xAPI/SCORM標準対応'],
['Adaptive learning (AI-powered)','Microlearning architecture','xAPI/SCORM standards compliance'],
['進捗追跡の不備→離脱率増加','動画配信コスト過小見積もり','証明書偽造防止不足'],
['Poor progress tracking → high dropout','Video streaming cost underestimation','Insufficient certificate anti-fraud measures'],
['生成AI統合(パーソナライズ学習)','VR/AR実習コンテンツ','ブロックチェーン証明書'],
['Generative AI integration (personalized learning)','VR/AR practical training','Blockchain certificates'],
['サブスク|月額課金|個人・企業研修','マーケットプレイス|手数料15-30%|講師・受講者','フリーミアム|プレミアム機能課金|個人学習者'],
['Subscription|Monthly fee|Individuals & corporate training','Marketplace|15-30% commission|Instructors & learners','Freemium|Premium features|Individual learners']
),
ec: _si(
['PCI DSS 4.0.1(カード情報)','景品表示法(誇大広告規制)','特定商取引法(返品・キャンセルポリシー)'],
['PCI DSS 4.0.1 (card data)','Consumer protection laws','Refund & cancellation policy compliance'],
['ヘッドレスコマース(Shopify Storefront API)','在庫最適化(需要予測AI)','Jamstack構成(Next.js + Stripe)'],
['Headless commerce (Shopify Storefront API)','Inventory optimization (demand forecasting AI)','Jamstack architecture (Next.js + Stripe)'],
['カゴ落ち率70%超え(決済UX不備)','在庫切れ表示遅延→信用失墜','SEO対策不足→集客失敗'],
['Cart abandonment >70% (poor checkout UX)','Stock-out display delay → loss of trust','Insufficient SEO → customer acquisition failure'],
['ライブコマース統合','音声検索対応','AR試着機能','サステナビリティ表示(CO2排出量)'],
['Live commerce integration','Voice search optimization','AR try-on features','Sustainability labels (CO2 emissions)'],
['直販|商品販売|消費者','マーケットプレイス|手数料10-20%|出品者・購入者','D2C|定期購入|ブランドファン'],
['Direct sales|Product revenue|Consumers','Marketplace|10-20% commission|Sellers & buyers','D2C|Subscription box|Brand fans']
),
marketplace: _si(
['エスクロー決済必須(消費者保護)','出品者KYC(本人確認)','レビュー操作防止'],
['Escrow payment (consumer protection)','Seller KYC verification','Review manipulation prevention'],
['二面市場設計(supply/demand balance)','レビュー・評価システム(信頼構築)','検索ランキングアルゴリズム'],
['Two-sided marketplace design (supply/demand balance)','Review & rating system (trust building)','Search ranking algorithm'],
['供給側不足→品質低下悪循環','手数料高すぎ→競合流出','不正出品者排除遅延'],
['Supply shortage → quality decline spiral','Excessive fees → seller churn','Delayed fraud seller removal'],
['ギグエコノミー拡大','Stripe Connect進化(即時決済)','AIマッチング精度向上'],
['Gig economy expansion','Stripe Connect evolution (instant payouts)','AI-powered matching accuracy'],
['手数料|取引額の15-25%|出品者・購入者','広告収益|スポンサー枠|出品者','サブスク|プレミアム機能|パワーセラー'],
['Commission|15-25% of transaction|Sellers & buyers','Advertising|Sponsored listings|Sellers','Subscription|Premium features|Power sellers']
),
community: _si(
['GDPR準拠(ユーザーデータ保護)','コンテンツモデレーション(違法コンテンツ対策)','未成年保護(年齢確認)'],
['GDPR compliance (user data protection)','Content moderation (illegal content removal)','Minor protection (age verification)'],
['WebSocket/SSE(リアルタイム通信)','スレッド型ディスカッション設計','ユーザーレピュテーションシステム'],
['WebSocket/SSE (real-time communication)','Threaded discussion architecture','User reputation system'],
['スパム・荒らし対策不足→品質低下','モデレーション負荷過多','エンゲージメント低下→過疎化'],
['Insufficient spam prevention → quality degradation','Moderation overload','Low engagement → ghost town effect'],
['AI自動モデレーション','分散型SNS(ActivityPub)','音声・動画コミュニティ拡大'],
['AI-powered auto-moderation','Decentralized social (ActivityPub)','Voice & video community expansion'],
['広告|インプレッション課金|企業広告主','プレミアム会員|月額・年額|コアユーザー','投げ銭|手数料10%|クリエイター'],
['Advertising|CPM/CPC|Corporate advertisers','Premium membership|Monthly/annual|Core users','Tipping|10% fee|Creators']
),
content: _si(
['著作権管理(DMCA対応)','アクセシビリティ(字幕・音声説明)','広告表示規制'],
['Copyright management (DMCA compliance)','Accessibility (captions & audio description)','Advertising regulations'],
['ヘッドレスCMS(Strapi/Contentful)','CDN配信最適化(画像WebP化)','検索エンジン最適化(構造化データ)'],
['Headless CMS (Strapi/Contentful)','CDN optimization (WebP images)','SEO (structured data)'],
['コンテンツ重複(SEOペナルティ)','画像最適化不足→読込遅延','更新頻度低下→検索順位下落'],
['Content duplication (SEO penalty)','Insufficient image optimization → slow loading','Low update frequency → ranking drop'],
['生成AI記事作成支援','動画要約AI','パーソナライズドコンテンツ配信'],
['Generative AI writing assistance','Video summarization AI','Personalized content delivery'],
['広告|PV・広告枠|読者','サブスク|有料記事・会員限定|コアファン','アフィリエイト|成果報酬|読者→購入'],
['Advertising|PV & ad slots|Readers','Subscription|Paywalled articles|Core fans','Affiliate|Performance fee|Reader purchases']
),
analytics: _si(
['データローカリティ(GDPR/CCPA)','匿名化処理(個人特定防止)','監査ログ保存'],
['Data locality (GDPR/CCPA)','Anonymization (PII removal)','Audit log retention'],
['リアルタイムストリーム処理(Apache Kafka/Flink)','列指向DB(ClickHouse/BigQuery)','埋め込み分析SDK'],
['Real-time stream processing (Kafka/Flink)','Columnar DB (ClickHouse/BigQuery)','Embedded analytics SDK'],
['データパイプライン障害→分析停止','可視化複雑すぎ→ユーザー混乱','コスト爆発(クエリ最適化不足)'],
['Data pipeline failure → analysis halt','Overly complex dashboards → user confusion','Cost explosion (poor query optimization)'],
['自然言語クエリ(生成AI)','予測分析精度向上(ML)','リアルタイム異常検知'],
['Natural language queries (generative AI)','Predictive analytics accuracy (ML)','Real-time anomaly detection'],
['SaaS|ユーザー数・データ量課金|企業分析チーム','埋め込み|導入企業課金|SaaS提供者','コンサル|導入・カスタマイズ支援|エンタープライズ'],
['SaaS|Users & data volume|Enterprise analytics teams','Embedded|Per-deployment|SaaS providers','Consulting|Implementation & customization|Enterprise']
),
booking: _si(
['個人情報保護(予約者情報)','キャンセルポリシー明示','決済代行業者登録(必要に応じ)'],
['Personal data protection (reservation info)','Clear cancellation policy','Payment facilitator registration (if applicable)'],
['カレンダー同期(Google/Outlook)','タイムゾーン自動変換','空き枠リアルタイム更新'],
['Calendar sync (Google/Outlook)','Automatic timezone conversion','Real-time availability updates'],
['ダブルブッキング発生(排他制御不足)','キャンセル処理遅延→返金トラブル','リマインド通知漏れ→ノーショー増加'],
['Double booking (insufficient locking)','Delayed cancellation → refund issues','Missed reminders → no-show increase'],
['AIスケジュール最適化','動的価格設定(需要予測)','ビデオ会議統合(Zoom/Teams)'],
['AI schedule optimization','Dynamic pricing (demand forecasting)','Video conferencing integration (Zoom/Teams)'],
['手数料|予約額の10-15%|サービス提供者・顧客','SaaS|月額固定・予約数課金|店舗・施設','フリーミアム|基本無料・上位機能課金|個人事業主'],
['Commission|10-15% of booking|Service providers & customers','SaaS|Monthly fee + per-booking|Stores & facilities','Freemium|Basic free + premium features|Solopreneurs']
),
saas: _si(
['SOC 2 Type II認証','GDPR/CCPA準拠','SLA保証(稼働率99.9%以上)'],
['SOC 2 Type II certification','GDPR/CCPA compliance','SLA guarantee (99.9%+ uptime)'],
['マルチテナント設計(tenant isolation)','API-first設計(拡張性)','使用量ベース課金システム'],
['Multi-tenant architecture (tenant isolation)','API-first design (extensibility)','Usage-based billing system'],
['チャーン率高い(オンボーディング不足)','スケーラビリティ不足→障害頻発','セキュリティ事故→信用失墜'],
['High churn (poor onboarding)','Scalability issues → frequent outages','Security breach → trust collapse'],
['PLG(Product-Led Growth)戦略','AI Copilot機能標準化','Vertical SaaS台頭'],
['PLG (Product-Led Growth) strategy','AI Copilot features standardization','Vertical SaaS rise'],
['サブスク|月額・年額・ユーザー数課金|企業・チーム','フリーミアム|基本無料・上位機能課金|個人・中小企業','使用量課金|API呼び出し・ストレージ従量|開発者'],
['Subscription|Monthly/annual/per-user|Enterprises & teams','Freemium|Basic free + premium|Individuals & SMBs','Usage-based|API calls & storage|Developers']
),
portfolio: _si(
['著作権表示(作品保護)','プライバシーポリシー(問い合わせフォーム)','アクセシビリティ(WCAG準拠)'],
['Copyright notice (work protection)','Privacy policy (contact forms)','Accessibility (WCAG compliance)'],
['静的サイト生成(Next.js/Astro)','CMS統合(Notion/Contentful)','高速CDN配信(Vercel/Cloudflare)'],
['Static site generation (Next.js/Astro)','CMS integration (Notion/Contentful)','Fast CDN delivery (Vercel/Cloudflare)'],
['読込速度遅い(画像最適化不足)','更新頻度低い→陳腐化','SEO対策不足→発見されない'],
['Slow loading (insufficient image optimization)','Low update frequency → outdated','Insufficient SEO → not discoverable'],
['Bento Grid UIトレンド','3Dインタラクション(Three.js)','ダークモードデフォルト'],
['Bento Grid UI trend','3D interactions (Three.js)','Dark mode by default'],
['直接受注|プロジェクト単価|クライアント企業','コンテンツ販売|有料note・教材|個人学習者','コンサル|時間単価|企業・個人'],
['Direct orders|Project fee|Client companies','Content sales|Paid articles & courses|Individual learners','Consulting|Hourly rate|Companies & individuals']
),
tool: _si(
['GDPR準拠(ユーザーデータ)','APIキー管理(セキュリティ)','利用規約明示'],
['GDPR compliance (user data)','API key management (security)','Clear terms of service'],
['PWA対応(オフライン動作)','クライアントサイド処理優先(プライバシー)','拡張機能提供(Browser Extension)'],
['PWA support (offline functionality)','Client-side processing (privacy)','Browser extension availability'],
['複雑すぎて使われない','ブラウザ依存機能(互換性問題)','競合ツールに埋もれる'],
['Too complex to use','Browser-dependent features (compatibility issues)','Lost in competitive landscape'],
['ローカルファーストツール','WebAssembly活用(高速化)','プライバシー重視設計'],
['Local-first tools','WebAssembly adoption (performance)','Privacy-focused design'],
['フリーミアム|基本無料・上位機能課金|個人・開発者','買い切り|一括購入|プロユーザー','オープンソース|寄付・スポンサー|コミュニティ'],
['Freemium|Basic free + premium|Individuals & developers','One-time purchase|Upfront payment|Pro users','Open source|Donations & sponsors|Community']
),
iot: _si(
['データプライバシー(センサーデータ)','セキュリティ認証(デバイス接続)','電波法準拠(無線デバイス)'],
['Data privacy (sensor data)','Security certification (device connection)','Radio law compliance (wireless devices)'],
['MQTT/CoAP(軽量プロトコル)','時系列DB(InfluxDB/TimescaleDB)','エッジコンピューティング(遅延削減)'],
['MQTT/CoAP (lightweight protocols)','Time-series DB (InfluxDB/TimescaleDB)','Edge computing (latency reduction)'],
['デバイスファームウェア脆弱性','通信途絶時のデータロスト','スケーラビリティ不足(デバイス急増時)'],
['Device firmware vulnerabilities','Data loss during communication outages','Scalability issues (rapid device growth)'],
['5G活用(低遅延通信)','AIエッジ推論(リアルタイム処理)','デジタルツイン統合'],
['5G utilization (low-latency communication)','AI edge inference (real-time processing)','Digital twin integration'],
['SaaS|デバイス数・データ量課金|企業IoT管理','ハードウェア販売|デバイス販売・保守|製造業・施設','データ販売|分析データ提供|データ活用企業'],
['SaaS|Per-device & data volume|Enterprise IoT management','Hardware sales|Device sales & maintenance|Manufacturers & facilities','Data monetization|Analytics data|Data-driven companies']
),
realestate: _si(
['宅建業法準拠(物件情報正確性)','個人情報保護(内覧者情報)','電子契約法対応'],
['Real estate transaction law compliance','Personal data protection (viewing applicants)','Electronic contract law compliance'],
['地図統合(Google Maps API)','VRツアー(360度動画)','AI物件レコメンド'],
['Map integration (Google Maps API)','VR tours (360° video)','AI property recommendations'],
['物件情報更新遅延→トラブル','内覧スケジュール重複','契約書電子化対応遅れ'],
['Delayed property info updates → disputes','Double-booked viewings','Slow adoption of electronic contracts'],
['AIバーチャル内覧','ブロックチェーン登記','スマートコントラクト契約'],
['AI virtual viewings','Blockchain property registry','Smart contract agreements'],
['仲介手数料|物件価格の3-6%|売主・買主','広告収益|物件掲載料|不動産会社','SaaS|月額・物件数課金|不動産会社'],
['Brokerage fee|3-6% of property price|Sellers & buyers','Advertising|Listing fees|Real estate agencies','SaaS|Monthly + per-property|Real estate agencies']
),
legal: _si(
['弁護士法準拠(非弁行為禁止)','秘匿特権保護(クライアント情報)','電子契約法対応'],
['Attorney law compliance (unauthorized practice prohibition)','Attorney-client privilege protection','Electronic signature law compliance'],
['ドキュメント管理(バージョン管理)','検索精度(全文検索・タグ)','暗号化保存(機密文書)'],
['Document management (version control)','Search accuracy (full-text & tags)','Encrypted storage (confidential documents)'],
['検索機能貧弱→文書発見困難','バージョン管理不備→差分不明','アクセス制御不足→情報漏洩'],
['Poor search → document discovery difficulty','Inadequate version control → diff tracking issues','Insufficient access control → data leakage'],
['契約レビューAI(リスク検出)','自動契約書生成','eディスカバリー対応'],
['AI contract review (risk detection)','Automated contract generation','eDiscovery support'],
['SaaS|ユーザー数・ストレージ課金|法律事務所','コンサル|導入支援・カスタマイズ|大手事務所','テンプレート販売|契約書雛形販売|中小企業'],
['SaaS|Per-user & storage|Law firms','Consulting|Implementation & customization|Large firms','Template sales|Contract template sales|SMBs']
),
hr: _si(
['労働基準法準拠(勤怠管理)','個人情報保護(応募者情報)','差別禁止(公平採用)'],
['Labor standards law compliance','Personal data protection (applicant info)','Non-discrimination (fair hiring)'],
['ATS(応募者追跡システム)','評価管理(360度評価)','勤怠管理統合'],
['ATS (Applicant Tracking System)','Performance management (360° reviews)','Attendance management integration'],
['応募者体験悪い→優秀人材逃す','評価基準曖昧→不満増加','システム複雑→利用率低下'],
['Poor candidate experience → talent loss','Vague evaluation criteria → dissatisfaction','System complexity → low adoption'],
['AIスクリーニング(応募書類)','スキルベース採用拡大','リモートワーク管理統合'],
['AI screening (applications)','Skills-based hiring expansion','Remote work management integration'],
['SaaS|従業員数課金|企業人事部','採用代行|手数料・成功報酬|企業','評価コンサル|導入・運用支援|大手企業'],
['SaaS|Per-employee|Corporate HR departments','Recruitment agency|Fee & success fee|Companies','Evaluation consulting|Implementation & support|Large enterprises']
),
fintech: _si(
['金融商品取引法準拠','資金決済法(資金移動業)','マネーロンダリング対策(KYC/AML)'],
['Financial instruments law compliance','Payment services law','Anti-money laundering (KYC/AML)'],
['リアルタイム残高更新(イベントソーシング)','二要素認証必須(セキュリティ)','監査ログ(全取引記録)'],
['Real-time balance updates (event sourcing)','Mandatory 2FA (security)','Audit logs (all transactions)'],
['セキュリティ事故→信用失墜','規制対応遅延→サービス停止','UX複雑→離脱率高'],
['Security breach → trust collapse','Regulatory delay → service suspension','Complex UX → high churn'],
['埋め込み金融(Embedded Finance)','即時決済拡大(リアルタイムグロス決済)','CBDC(中央銀行デジタル通貨)対応'],
['Embedded finance','Instant payment expansion (real-time gross settlement)','CBDC (Central Bank Digital Currency) readiness'],
['手数料|送金・為替手数料|個人・企業','金利収益|預金・融資金利差|個人・企業','SaaS|API利用・取引量課金|フィンテック企業'],
['Transaction fees|Transfer & FX fees|Individuals & companies','Interest income|Deposit-loan spread|Individuals & companies','SaaS|API usage & transaction volume|Fintech companies']
),
health: _si(
['HIPAA準拠(米国・患者情報保護)','医療法準拠(日本)','電子カルテ標準規格(HL7 FHIR)'],
['HIPAA compliance (US patient data protection)','Medical law compliance','Electronic health records standard (HL7 FHIR)'],
['暗号化必須(保管・転送時)','アクセス制御厳格(最小権限)','監査ログ(全アクセス記録)'],
['Encryption required (at-rest & in-transit)','Strict access control (least privilege)','Audit logs (all access records)'],
['情報漏洩→巨額罰金','システム障害→診療停止','連携不備→データ分断'],
['Data breach → massive fines','System outage → treatment halt','Integration issues → data silos'],
['遠隔診療拡大(オンライン診療)','AIドクター支援(診断補助)','ウェアラブル統合(健康データ)'],
['Telemedicine expansion','AI doctor assistance (diagnosis support)','Wearable integration (health data)'],
['診療報酬|保険請求|患者・保険者','SaaS|月額・施設数課金|クリニック・病院','データ活用|匿名化データ販売|製薬・研究機関'],
['Medical fees|Insurance claims|Patients & insurers','SaaS|Monthly + per-facility|Clinics & hospitals','Data monetization|Anonymized data sales|Pharma & research']
),
ai: _si(
['AI倫理ガイドライン準拠','個人データ学習制限(GDPR)','生成物著作権明示'],
['AI ethics guidelines compliance','Personal data training restrictions (GDPR)','Generated content copyright disclosure'],
['プロンプト管理(バージョン管理)','RAG(Retrieval-Augmented Generation)','コンテキスト圧縮(トークン節約)'],
['Prompt management (version control)','RAG (Retrieval-Augmented Generation)','Context compression (token optimization)'],
['幻覚(Hallucination)→誤情報提供','コスト爆発(API呼び出し過多)','プロンプトインジェクション攻撃'],
['Hallucinations → misinformation','Cost explosion (excessive API calls)','Prompt injection attacks'],
['マルチモーダルAI(画像・動画・音声)','ローカルLLM活用(プライバシー)','AI Agent自律化'],
['Multimodal AI (image/video/audio)','Local LLM adoption (privacy)','Autonomous AI agents'],
['API課金|トークン・リクエスト従量|開発者・企業','SaaS|月額・ユーザー数課金|企業チーム','コンサル|導入・カスタマイズ支援|エンタープライズ'],
['API billing|Tokens & requests|Developers & companies','SaaS|Monthly + per-user|Enterprise teams','Consulting|Implementation & customization|Enterprise']
),
automation: _si(
['データプライバシー(自動処理データ)','API利用規約準拠(連携サービス)','監査ログ保存'],
['Data privacy (automated processing)','API terms compliance (integrated services)','Audit log retention'],
['ワークフロー設計(DAG管理)','エラーハンドリング(リトライ戦略)','WebHook受信(イベント駆動)'],
['Workflow design (DAG management)','Error handling (retry strategies)','WebHook reception (event-driven)'],
['ワークフロー複雑化→保守困難','エラー通知不足→障害気づかず','連携サービス変更→動作停止'],
['Workflow complexity → maintenance difficulty','Insufficient error notifications → undetected failures','Service API changes → workflow breakage'],
['AI Agentワークフロー','ノーコード自動化拡大','リアルタイムトリガー精度向上'],
['AI agent workflows','No-code automation expansion','Real-time trigger accuracy improvement'],
['SaaS|ワークフロー数・実行回数課金|企業・個人','フリーミアム|基本無料・上位機能課金|中小企業','コンサル|業務自動化設計支援|エンタープライズ'],
['SaaS|Workflows & executions|Companies & individuals','Freemium|Basic free + premium|SMBs','Consulting|Business automation design|Enterprise']
),
event: _si(
['個人情報保護(参加者情報)','チケット転売防止(規制準拠)','払い戻しポリシー明示'],
['Personal data protection (attendee info)','Ticket resale prevention (regulation compliance)','Clear refund policy'],
['チケット販売(Stripe決済)','QRコードチェックイン','参加者管理(バッジ印刷)'],
['Ticket sales (Stripe payment)','QR code check-in','Attendee management (badge printing)'],
['チケット偽造対策不足','当日混雑→チェックイン遅延','キャンセル処理トラブル'],
['Insufficient anti-counterfeit measures','Check-in delays on event day','Cancellation processing issues'],
['ハイブリッドイベント拡大(オンライン配信)','NFTチケット','AIネットワーキング支援'],
['Hybrid event expansion (online streaming)','NFT tickets','AI networking assistance'],
['チケット販売|手数料10-20%|主催者・参加者','スポンサー収益|広告・ブース販売|企業スポンサー','SaaS|月額・イベント数課金|イベント運営会社'],
['Ticket sales|10-20% commission|Organizers & attendees','Sponsor revenue|Ads & booth sales|Corporate sponsors','SaaS|Monthly + per-event|Event management companies']
),
gamify: _si(
['個人情報保護(ユーザー行動データ)','景品規制(高額報酬制限)','ギャンブル性回避'],
['Personal data protection (user behavior data)','Prize regulations (high-value reward limits)','Gambling avoidance'],
['ポイント管理(残高・履歴)','バッジシステム(達成トリガー)','リーダーボード(ランキング更新)'],
['Point management (balance & history)','Badge system (achievement triggers)','Leaderboard (ranking updates)'],
['報酬インフレ→モチベーション低下','不正獲得対策不足','ゲーミフィケーション設計失敗→飽きられる'],
['Reward inflation → motivation decline','Insufficient fraud prevention','Poor gamification design → user boredom'],
['NFTバッジ(ブロックチェーン)','AIパーソナライズチャレンジ','ソーシャルゲーミフィケーション'],
['NFT badges (blockchain)','AI personalized challenges','Social gamification'],
['広告|インプレッション課金|企業広告主','アプリ内課金|ポイント・アイテム購入|ユーザー','SaaS|月額・ユーザー数課金|企業導入'],
['Advertising|CPM/CPC|Corporate advertisers','In-app purchases|Points & items|Users','SaaS|Monthly + per-user|Enterprise adoption']
),
collab: _si(
['データプライバシー(共同編集データ)','GDPR準拠(ユーザーデータ)','アクセス制御(権限管理)'],
['Data privacy (collaborative data)','GDPR compliance (user data)','Access control (permission management)'],
['CRDT(衝突解決アルゴリズム)','WebSocket(リアルタイム同期)','バージョン履歴(変更追跡)'],
['CRDT (conflict resolution)','WebSocket (real-time sync)','Version history (change tracking)'],
['同期ラグ→編集衝突頻発','権限管理複雑→誤操作','オフライン対応不足→データロスト'],
['Sync lag → frequent edit conflicts','Complex permissions → user errors','Insufficient offline support → data loss'],
['AIコラボ支援(要約・提案)','音声・動画コラボ拡大','ブロックチェーン所有権証明'],
['AI collaboration assistance (summaries & suggestions)','Voice & video collaboration expansion','Blockchain ownership proof'],
['SaaS|月額・ユーザー数課金|企業・チーム','フリーミアム|基本無料・上位機能課金|個人・中小企業','エンタープライズ|カスタマイズ・専用環境|大手企業'],
['SaaS|Monthly + per-user|Companies & teams','Freemium|Basic free + premium|Individuals & SMBs','Enterprise|Customization & dedicated env|Large enterprises']
),
devtool: _si(
['APIキー管理(セキュリティ)','利用規約明示(レート制限・SLA)','オープンソースライセンス'],
['API key management (security)','Clear terms (rate limits & SLA)','Open source licensing'],
['APIファースト設計','SDK提供(多言語)','WebHook配信(イベント通知)'],
['API-first design','SDK provision (multi-language)','WebHook delivery (event notifications)'],
['ドキュメント不足→導入障壁','レート制限厳しすぎ→離脱','障害通知遅延→信頼低下'],
['Insufficient documentation → adoption barrier','Overly strict rate limits → churn','Delayed outage notifications → trust decline'],
['OpenAPI 3.1標準化','GraphQL採用拡大','開発者体験(DX)重視設計'],
['OpenAPI 3.1 standardization','GraphQL adoption expansion','Developer experience (DX) focused design'],
['API課金|リクエスト従量|開発者・企業','SaaS|月額・機能課金|企業','オープンソース|エンタープライズサポート有償|大手企業'],
['API billing|Per-request|Developers & companies','SaaS|Monthly + features|Companies','Open source|Paid enterprise support|Large enterprises']
),
creator: _si(
['著作権保護(コンテンツ)','決済代行業者登録(手数料収受)','税務対応(クリエイター収益)'],
['Copyright protection (content)','Payment facilitator registration (fee collection)','Tax compliance (creator revenue)'],
['サブスク管理(Stripe Billing)','投げ銭決済(少額決済)','コンテンツ配信(DRM保護)'],
['Subscription management (Stripe Billing)','Tipping payment (micro-transactions)','Content delivery (DRM protection)'],
['手数料高すぎ→クリエイター不満','コンテンツ海賊版対策不足','収益化ハードル高い→離脱'],
['Excessive fees → creator dissatisfaction','Insufficient piracy prevention','High monetization barrier → churn'],
['AI生成コンテンツ統合','NFTコンテンツ販売','ライブストリーミング収益化'],
['AI-generated content integration','NFT content sales','Live streaming monetization'],
['手数料|クリエイター収益の10-20%|クリエイター・ファン','サブスク|月額会員費|ファン','投げ銭|少額課金・手数料|ファン'],
['Commission|10-20% of creator revenue|Creators & fans','Subscription|Monthly membership|Fans','Tipping|Micro-transactions + fee|Fans']
),
newsletter: _si(
['GDPR準拠(購読者データ)','CAN-SPAM法準拠(米国・配信規制)','オプトイン必須(同意取得)'],
['GDPR compliance (subscriber data)','CAN-SPAM Act compliance (US anti-spam)','Opt-in required (consent acquisition)'],
['配信管理(SendGrid/Resend)','購読者セグメント(タグ付け)','A/Bテスト(件名・本文)'],
['Delivery management (SendGrid/Resend)','Subscriber segmentation (tagging)','A/B testing (subject & body)'],
['スパム判定→到達率低下','配信停止処理遅延→苦情','コンテンツ単調→開封率低下'],
['Spam flagging → low deliverability','Delayed unsubscribe → complaints','Monotonous content → low open rate'],
['AI記事生成支援','パーソナライズド配信(行動ベース)','音声ニュースレター'],
['AI article generation assistance','Personalized delivery (behavior-based)','Audio newsletters'],
['サブスク|有料ニュースレター月額|読者','広告|スポンサード記事|企業広告主','アフィリエイト|紹介手数料|読者→購入'],
['Subscription|Paid newsletter monthly|Readers','Advertising|Sponsored articles|Corporate advertisers','Affiliate|Referral commission|Reader purchases']
),
manufacturing: _si(
['ISO 9001品質','IEC 62443産業制御セキュリティ','製造物責任法(PL法)トレーサビリティ'],
['ISO 9001 quality management','IEC 62443 industrial control security','Product liability law traceability'],
['Digital Twin(工場シミュレーション)','Edge AI(予知保全)','OPC UA(設備連携標準)'],
['Digital Twin (factory simulation)','Edge AI (predictive maintenance)','OPC UA (equipment interoperability)'],
['予知保全未導入→突発停止','品質データ分断→原因追跡困難','OTセキュリティ脆弱性'],
['No predictive maintenance → sudden downtime','Quality data silos → root cause tracking difficulty','OT security vulnerabilities'],
['予知保全AI拡大','協働ロボット(cobot)統合','Scope1-3カーボン管理'],
['Predictive maintenance AI expansion','Collaborative robot (cobot) integration','Scope 1-3 carbon management'],
['ライセンス|工場・デバイス数課金|製造業','SaaS|月額・機能課金|製造業','SI|導入・カスタマイズ|大手製造業'],
['License|Per-factory/device|Manufacturers','SaaS|Monthly + features|Manufacturers','SI|Implementation & customization|Large manufacturers']
),
logistics: _si(
['貨物運送事業法','2024年問題(労働時間規制)','倉庫業法','関税法(NACCS連携)'],
['Freight carrier business law','2024 problem (driver hour limits)','Warehouse business law','Customs law (NACCS integration)'],
['ルート最適化(OR-Tools)','WMS(倉庫管理)','GPS+5G追跡','ブロックチェーン(トレーサビリティ)'],
['Route optimization (OR-Tools)','WMS (warehouse management)','GPS + 5G tracking','Blockchain traceability'],
['配送遅延→顧客不満','在庫不足・過剰→コスト増','ドライバー不足→需要対応困難'],
['Delivery delays → customer dissatisfaction','Stock shortage/excess → cost increase','Driver shortage → demand response difficulty'],
['自動配送ロボット・ドローン','ブロックチェーン透明化','AGV(無人搬送車)','リアルタイム需給マッチ'],
['Autonomous delivery robots/drones','Blockchain transparency','AGV (automated guided vehicles)','Real-time supply-demand matching'],
['SaaS|配送・在庫管理|物流企業','手数料|配送マッチング|荷主・配送業者','SI|導入・カスタマイズ|大手物流'],
['SaaS|Delivery & inventory mgmt|Logistics companies','Commission|Delivery matching|Shippers & carriers','SI|Implementation & customization|Large logistics']
),
agriculture: _si(
['農薬取締法','種苗法(品種保護)','GAP(農業生産工程管理)','ドローン規制(航空法)'],
['Agricultural chemicals control law','Plant variety protection law','GAP (Good Agricultural Practice)','Drone regulations (aviation law)'],
['LoRaWAN(センサー通信)','衛星画像分析(Sentinel-2)','AI病害虫診断','需給マッチングプラットフォーム'],
['LoRaWAN (sensor communication)','Satellite imagery analysis (Sentinel-2)','AI pest/disease diagnosis','Supply-demand matching platform'],
['センサー故障→データ欠損','天候依存リスク高い','IT習熟度低い→導入困難'],
['Sensor failures → data loss','High weather dependency risk','Low IT literacy → adoption difficulty'],
['精密農業(変量施肥)','ドローン散布','需給マッチング拡大','カーボンクレジット取引'],
['Precision agriculture (variable rate application)','Drone spraying','Supply-demand matching expansion','Carbon credit trading'],
['SaaS|センサー・データ分析|農家','ハードウェア販売|デバイス販売|農家','データ販売|気象・需給データ|JA・食品メーカー'],
['SaaS|Sensors & data analytics|Farmers','Hardware sales|Device sales|Farmers','Data monetization|Weather & supply data|Co-ops & food manufacturers']
),
energy: _si(
['電気事業法(保安・需給調整)','再エネ特措法(FIT/FIP)','省エネ法・温対法','GHGプロトコル(Scope1-3)'],
['Electricity business law (safety & supply-demand)','Renewable energy law (FIT/FIP)','Energy conservation & climate laws','GHG Protocol (Scope 1-3)'],
['DERMS(分散電源管理)','スマートメーター連携','発電予測AI(気象データ)','P2P電力取引プラットフォーム'],
['DERMS (distributed energy resource mgmt)','Smart meter integration','Generation forecasting AI (weather data)','P2P electricity trading platform'],
['系統不安定(再エネ変動)','蓄電池劣化管理不足','出力制御→収益減'],
['Grid instability (renewable fluctuations)','Insufficient battery degradation mgmt','Output curtailment → revenue loss'],
['P2P電力取引拡大','VPP(仮想発電所)','カーボンNFT','AI需要予測高度化'],
['P2P electricity trading expansion','VPP (virtual power plant)','Carbon NFT','Advanced AI demand forecasting'],
['SaaS|発電・需給管理|発電事業者','PPA(電力購入契約)|長期契約|企業','データ販売|需給・カーボンデータ|エネルギー企業'],
['SaaS|Generation & demand mgmt|Power producers','PPA (power purchase agreement)|Long-term contract|Corporations','Data monetization|Supply & carbon data|Energy companies']
),
media: _si(
['著作権法(権利処理・DRM)','放送法(番組基準)','青少年保護育成条例','景品表示法(ガチャ確率)'],
['Copyright law (rights & DRM)','Broadcasting law (program standards)','Youth protection ordinances','Prize labeling law (gacha rates)'],
['HLS/DASH/CMAF配信(低遅延)','DRM(Widevine/FairPlay)','AI生成コンテンツ補助','インタラクティブ配信'],
['HLS/DASH/CMAF streaming (low latency)','DRM (Widevine/FairPlay)','AI-generated content assistance','Interactive streaming'],
['海賊版対策不足','審査遅延→配信開始遅れ','配信コスト過大'],
['Insufficient anti-piracy measures','Review delays → delayed launch','Excessive streaming costs'],
['インタラクティブストリーミング','空間Computing(VR/AR)','AI制作支援拡大','UGC収益化'],
['Interactive streaming','Spatial computing (VR/AR)','AI production assistance expansion','UGC monetization'],
['サブスク|月額課金|視聴者','広告|インプレッション課金|企業広告主','ライセンス|コンテンツ販売|配信プラットフォーム'],
['Subscription|Monthly fee|Viewers','Advertising|CPM/CPC|Corporate advertisers','Licensing|Content sales|Streaming platforms']
),
government: _si(
['公的個人認証法(JPKI)','行政機関個人情報保護法','デジタル手続法(オンライン化原則)','ISMAP(政府調達基準)'],
['JPKI (public key infrastructure)','Administrative personal data protection law','Digital procedure law (online-first)','ISMAP (government procurement standards)'],
['Gov Cloud(AWS/Azure/GCP)','LGWAN接続','FIDO2(パスワードレス)','オープンデータプラットフォーム'],
['Gov Cloud (AWS/Azure/GCP)','LGWAN (government network) integration','FIDO2 (passwordless)','Open data platform'],
['レガシー移行失敗','アクセシビリティ不足(a11y)','セキュリティインシデント→信用失墜'],
['Legacy migration failure','Insufficient accessibility (a11y)','Security incidents → trust collapse'],
['オープンデータ拡大','AIチャットボット(行政手続き)','ブロックチェーン公証','マイナンバー連携拡大'],
['Open data expansion','AI chatbot (administrative procedures)','Blockchain notarization','My Number integration expansion'],
['受託|システム開発|政府機関','SaaS|Gov Cloud・行政サービス|地方自治体','保守|運用・サポート|政府機関'],
['Contract|System development|Government agencies','SaaS|Gov Cloud & admin services|Local governments','Maintenance|Operations & support|Government agencies']
),
travel: _si(
['旅行業法(登録・約款)','旅館業法・民泊新法','PCI DSS(予約決済)','GDPR(訪日客データ)'],
['Travel agency law (registration & terms)','Hotel business law & vacation rental law','PCI DSS (reservation payment)','GDPR (international visitor data)'],
['PMS統合(Oracle/Cloudbeds)','チャネルマネージャー(OTA在庫統合)','動的価格設定(需要予測AI)','多言語対応(DeepL API)'],
['PMS integration (Oracle/Cloudbeds)','Channel manager (OTA inventory integration)','Dynamic pricing (demand forecasting AI)','Multi-language support (DeepL API)'],
['OTA依存度高い→手数料負担','シーズン変動大きい→稼働率低下','口コミ管理不足→評価低下'],
['High OTA dependency → commission burden','Large seasonal fluctuations → low occupancy','Insufficient review mgmt → rating decline'],
['AIコンシェルジュ(24h対応)','VRプレビュー(予約前内見)','サステナブルツーリズム','非接触チェックイン拡大'],
['AI concierge (24h support)','VR preview (pre-booking tours)','Sustainable tourism','Contactless check-in expansion'],
['手数料|予約手数料10-20%|宿泊施設・OTA','SaaS|月額・施設数課金|宿泊施設','広告|スポンサー枠|観光施設'],
['Commission|10-20% booking fee|Accommodations & OTAs','SaaS|Monthly + per-facility|Accommodations','Advertising|Sponsored listings|Tourist facilities']
),
insurance: _si(
['保険業法(募集・引受・ソルベンシー)','保険法(告知義務)','IFRS 17(国際会計基準)','金融ADR(紛争解決)'],
['Insurance business law (solicitation/underwriting/solvency)','Insurance law (duty of disclosure)','IFRS 17 (accounting standards)','Financial ADR (dispute resolution)'],
['Guidewire/Duck Creek(基幹)','テレマティクス(運転スコア分析)','Wearable統合(健康保険)','パラメトリック保険(スマートコントラクト)'],
['Guidewire/Duck Creek (core systems)','Telematics (driving score analysis)','Wearable integration (health insurance)','Parametric insurance (smart contracts)'],
['引受プロセス遅延','不正請求検知不足','商品設計複雑→顧客理解困難'],
['Underwriting process delays','Insufficient fraud detection','Complex product design → customer confusion'],
['組み込み保険(Embedded)拡大','AIリスク評価高度化','オンデマンド保険(短期・細分化)','健康増進型保険'],
['Embedded insurance expansion','Advanced AI risk assessment','On-demand insurance (short-term/micro)','Wellness-linked insurance'],
['保険料|契約保険料|契約者','代理店手数料|販売手数料|代理店','SaaS|保険業務効率化|保険会社'],
['Premium|Contract premium|Policyholders','Agent commission|Sales commission|Agents','SaaS|Insurance operations efficiency|Insurance companies']
),
_default: _si(
['GDPR/CCPA準拠(一般データ保護)','利用規約・プライバシーポリシー必須','アクセシビリティ(WCAG 2.1)'],
['GDPR/CCPA compliance (general data protection)','Terms & privacy policy required','Accessibility (WCAG 2.1)'],
['3層アーキテクチャ(UI/API/DB)','認証・認可分離','RESTful API設計'],
['3-tier architecture (UI/API/DB)','Auth/authz separation','RESTful API design'],
['セキュリティ対策不足→情報漏洩','スケーラビリティ不足→障害','UX設計不備→離脱率高'],
['Insufficient security → data breach','Scalability issues → outages','Poor UX design → high churn'],
['AI統合加速','リアルタイム機能拡大','プライバシー重視設計'],
['Accelerated AI integration','Real-time feature expansion','Privacy-focused design'],
['SaaS|月額課金|企業・個人','フリーミアム|基本無料・上位機能課金|個人・中小企業','広告|インプレッション課金|企業広告主'],
['SaaS|Monthly fee|Companies & individuals','Freemium|Basic free + premium|Individuals & SMBs','Advertising|CPM/CPC|Corporate advertisers']
)
};
// Stakeholder Strategy Database (4 types)
const STAKEHOLDER_STRATEGY = {
startup: {
name_ja: 'スタートアップ',
name_en: 'Startup',
phases_ja: ['MVP構築(2-4週)','PMF検証(1-3ヶ月)','スケール準備(3-6ヶ月)','成長フェーズ(6ヶ月〜)'],
phases_en: ['MVP Build (2-4 weeks)','PMF Validation (1-3 months)','Scale Prep (3-6 months)','Growth Phase (6+ months)'],
tech_debt_ja: 'MVP期は技術的負債許容。PMF後にリファクタリング集中投資。スケール前に負債返済80%目標。',
tech_debt_en: 'Tolerate tech debt during MVP. Invest in refactoring post-PMF. Target 80% debt repayment before scaling.',
team_ja: 'フルスタック1-2名 → フロント/バック分離(3-5名) → 専門化(10名〜)',
team_en: 'Full-stack 1-2 → Front/Back split (3-5) → Specialization (10+)',
budget_ja: '開発70% / インフラ10% / マーケ15% / セキュリティ5%',
budget_en: 'Dev 70% / Infra 10% / Marketing 15% / Security 5%'
},
enterprise: {
name_ja: 'エンタープライズ',
name_en: 'Enterprise',
phases_ja: ['PoC実施(1-2ヶ月)','パイロット導入(3-6ヶ月)','段階的展開(6-12ヶ月)','最適化(継続)'],
phases_en: ['PoC (1-2 months)','Pilot Deployment (3-6 months)','Phased Rollout (6-12 months)','Optimization (ongoing)'],
tech_debt_ja: 'レガシー移行計画必須。Strangler Figパターン推奨。技術的負債管理をKPI化(SQALE Rating)。',
tech_debt_en: 'Legacy migration plan required. Strangler Fig pattern recommended. Manage tech debt as KPI (SQALE Rating).',
team_ja: 'アーキテクト主導 → 複数チーム(機能別) → Platform Engineering組織',
team_en: 'Architect-led → Multi-teams (feature-based) → Platform Engineering org',
budget_ja: '開発50% / インフラ20% / セキュリティ20% / コンプライアンス10%',
budget_en: 'Dev 50% / Infra 20% / Security 20% / Compliance 10%'
},
developer: {
name_ja: '開発者(個人・少人数)',
name_en: 'Developer (Solo/Small Team)',
phases_ja: ['週末プロジェクト(1-2週)','サイドプロジェクト(1-3ヶ月)','プロダクト化(3-6ヶ月)','運用・成長'],
phases_en: ['Weekend Project (1-2 weeks)','Side Project (1-3 months)','Productization (3-6 months)','Operations & Growth'],
tech_debt_ja: '初期はスピード優先。ユーザー獲得後にリファクタリング。自動化ツール積極活用。',
tech_debt_en: 'Prioritize speed initially. Refactor after user acquisition. Leverage automation tools.',
team_ja: 'ソロ → デュアル(フロント/バック分担) → 小規模チーム(3-5名)',
team_en: 'Solo → Duo (front/back split) → Small team (3-5)',
budget_ja: '開発80%(時間投資) / インフラ15% / マーケ5%(オーガニック重視)',
budget_en: 'Dev 80% (time investment) / Infra 15% / Marketing 5% (organic focus)'
},
team: {
name_ja: '標準チーム',
name_en: 'Standard Team',
phases_ja: ['Sprint 0(環境構築)','MVP開発(2-4週)','v1.0リリース(2-3ヶ月)','成長フェーズ'],
phases_en: ['Sprint 0 (Setup)','MVP Dev (2-4 weeks)','v1.0 Release (2-3 months)','Growth Phase'],
tech_debt_ja: '20%ルール適用(Sprint時間の20%を負債返済)。四半期ごとにリファクタリングSprint実施。',
tech_debt_en: '20% rule (dedicate 20% of sprint to debt repayment). Quarterly refactoring sprints.',
team_ja: 'クロスファンクショナルチーム(5-9名) → Two-Pizza Team原則',
team_en: 'Cross-functional team (5-9) → Two-Pizza Team principle',
budget_ja: '開発60% / インフラ15% / マーケ15% / セキュリティ10%',
budget_en: 'Dev 60% / Infra 15% / Marketing 15% / Security 10%'
}
};
// Operational Excellence Frameworks
const OPERATIONAL_FRAMEWORKS = {
tech_debt: {
title_ja: '技術的負債管理フレームワーク',
title_en: 'Technical Debt Management Framework',
quadrant_ja: ['意図的・戦略的(MVP速度優先)','意図的・戦術的(一時的回避)','非意図的・戦略的(設計誤認識)','非意図的・戦術的(スキル不足)'],
quadrant_en: ['Deliberate-Strategic (MVP speed)','Deliberate-Tactical (temporary workaround)','Inadvertent-Strategic (design misunderstanding)','Inadvertent-Tactical (skill gap)'],
sqale_ja: 'SQALE金額換算: 負債1時間 = エンジニア時給 × 1.5倍(遅延コスト込)',
sqale_en: 'SQALE monetization: 1hr debt = Engineer hourly rate × 1.5 (delay cost included)',
rule_ja: '20%ルール: Sprint時間の20%を負債返済に割り当て',
rule_en: '20% Rule: Dedicate 20% of sprint time to debt repayment'
},
dr_bcp: {
title_ja: '災害復旧・BCP',
title_en: 'Disaster Recovery & BCP',
rto_rpo_ja: 'RTO(Recovery Time Objective): 目標復旧時間 / RPO(Recovery Point Objective): 目標復旧時点',
rto_rpo_en: 'RTO (Recovery Time Objective) / RPO (Recovery Point Objective)',
tier_ja: ['Tier 1: RTO<1h, RPO<15min (Critical)','Tier 2: RTO<4h, RPO<1h (High)','Tier 3: RTO<24h, RPO<4h (Medium)'],
tier_en: ['Tier 1: RTO<1h, RPO<15min (Critical)','Tier 2: RTO<4h, RPO<1h (High)','Tier 3: RTO<24h, RPO<4h (Medium)'],
backup_ja: '3-2-1ルール: 3コピー・2種類メディア・1オフサイト',
backup_en: '3-2-1 Rule: 3 copies, 2 media types, 1 offsite',
incident_ja: '検知 → トリアージ → 対応 → 復旧 → 事後レビュー(Postmortem)',
incident_en: 'Detection → Triage → Response → Recovery → Postmortem'
},
green_it: {
title_ja: 'Green IT・カーボンニュートラル',
title_en: 'Green IT & Carbon Neutrality',
framework_ja: ['Serverless優先(アイドル時間削減)','CDN活用(ネットワーク排出削減)','画像最適化(WebP/AVIF)','不要リソース削除(Zombie resources)'],
framework_en: ['Serverless-first (reduce idle time)','CDN utilization (reduce network emissions)','Image optimization (WebP/AVIF)','Remove zombie resources'],
carbon_ja: 'Cloud Carbon Footprint計測(AWS/Azure/GCP)',
carbon_en: 'Cloud Carbon Footprint measurement (AWS/Azure/GCP)',
sla_ja: '再エネ100%データセンター選択(Google Cloud/AWS Graviton)',
sla_en: 'Choose 100% renewable energy data centers (Google Cloud/AWS Graviton)'
},
team_design: {
title_ja: 'チーム設計・Conway\'s Law対応',
title_en: 'Team Design & Conway\'s Law',
conway_ja: 'アーキテクチャと組織構造を一致させる(マイクロサービス → 機能別チーム)',
conway_en: 'Align architecture with org structure (Microservices → Feature teams)',
two_pizza_ja: 'Two-Pizza Team: 1チーム5-9名(ピザ2枚で足りる人数)',
two_pizza_en: 'Two-Pizza Team: 5-9 members per team',
dora_ja: 'DORA metrics計測(デプロイ頻度・変更リードタイム・MTTR・変更失敗率)',
dora_en: 'DORA metrics (Deployment frequency, Lead time, MTTR, Change failure rate)'
}
};
// Extended Operational Frameworks (4 new topics)
const OPERATIONAL_FRAMEWORKS_EXT = {
ai_ethics: {
title_ja: 'AI倫理・ガバナンス',
title_en: 'AI Ethics & Governance',
principles_ja: ['公平性(Fairness)','説明可能性(Explainability)','透明性(Transparency)','プライバシー','セキュリティ'],
principles_en: ['Fairness','Explainability','Transparency','Privacy','Security'],
impl_ja: 'Fairlearn/AIF360でバイアス検知、SHAP/LIMEで説明可能性、Human-in-the-loop(低信頼度時)',
impl_en: 'Bias detection (Fairlearn/AIF360), Explainability (SHAP/LIME), Human-in-the-loop (low confidence)',
compliance_ja: 'EU AI Act準拠、AIリスク分類(高/限定/最小/禁止)',
compliance_en: 'EU AI Act compliance, AI risk classification (High/Limited/Minimal/Prohibited)'
},
zero_trust: {
title_ja: 'ゼロトラストセキュリティ',
title_en: 'Zero Trust Security',
principles_ja: '境界防御撤廃、常に検証、最小特権、セグメンテーション、暗号化、監視',
principles_en: 'No perimeter, Always verify, Least privilege, Segmentation, Encryption, Monitoring',
impl_ja: 'IAM(Azure AD/Okta)+FIDO2、マイクロセグメンテーション(Kubernetes NetworkPolicy)、EDR/XDR',
impl_en: 'IAM (Azure AD/Okta) + FIDO2, Micro-segmentation (Kubernetes NetworkPolicy), EDR/XDR',
beyondcorp_ja: 'BeyondCorp 7原則: デバイス信頼、ユーザー検証、コンテキスト認識',
beyondcorp_en: 'BeyondCorp 7 principles: Device trust, User verification, Context awareness'
},
data_governance: {
title_ja: 'データガバナンス',
title_en: 'Data Governance',
elements_ja: ['データカタログ','品質管理(DQ)','リネージ(系譜)','セキュリティ','データメッシュ'],
elements_en: ['Data Catalog','Data Quality (DQ)','Lineage','Security','Data Mesh'],
stack_ja: 'DataHub/Amundsen(カタログ)、Great Expectations(品質)、動的マスキング(Snowflake/BigQuery)',
stack_en: 'DataHub/Amundsen (catalog), Great Expectations (quality), Dynamic masking (Snowflake/BigQuery)',
mesh_ja: 'データメッシュ原則: ドメイン所有、データプロダクト思考、セルフサービスインフラ',
mesh_en: 'Data Mesh principles: Domain ownership, Data as product, Self-serve infrastructure'
},
globalization: {
title_ja: 'グローバル展開(i18n/l10n)',
title_en: 'Globalization (i18n/l10n)',
i18n_ja: 'Unicode対応、RTL(右→左)対応、ハードコード排除、pluralization',
i18n_en: 'Unicode support, RTL (right-to-left), No hardcoded strings, Pluralization',
l10n_ja: '言語リソース管理(Locize/Phrase)、地域別フォーマット(日付・通貨・住所)',
l10n_en: 'Language resource mgmt (Locize/Phrase), Regional formats (date/currency/address)',
infra_ja: 'エッジロケーション(CDN)活用、データレジデンシー(GDPR/各国法令)',
infra_en: 'Edge locations (CDN), Data residency (GDPR/local regulations)'
}
};
// Extreme Implementation Scenarios (6 advanced patterns)
const EXTREME_SCENARIOS = {
break_glass: {
title_ja: 'Break-glass緊急アクセス(Healthcare/Gov)',
title_en: 'Break-glass Emergency Access (Healthcare/Gov)',
desc_ja: '通常はアクセス不可、緊急時のみ理由入力で全医師許可。監査ログ必須。',
desc_en: 'Normally denied, emergency mode allows all doctors with reason input. Audit log required.',
tech: 'OPA/Rego, ABAC (Attribute-Based Access Control)',
domains: ['health', 'government']
},
k_anonymity: {
title_ja: 'k-匿名化パイプライン(個人特定防止)',
title_en: 'k-Anonymity Pipeline (De-identification)',
desc_ja: '準識別子(年齢・郵便番号・性別)の組み合わせでk人以上のグループを形成。',
desc_en: 'Form groups of k+ individuals using quasi-identifiers (age/zip/gender).',
tech: 'Pandas (generalization), k≥3 enforcement',
domains: ['health', 'hr', 'fintech']
},
geo_partition: {
title_ja: 'ジオパーティショニング(データレジデンシー)',
title_en: 'Geo-Partitioning (Data Residency)',
desc_ja: 'SQLレベルでデータ配置リージョンを制御。GDPR/各国法令対応。',
desc_en: 'Control physical data placement at SQL level. GDPR/local law compliance.',
tech: 'CockroachDB / YugabyteDB (geo-partitioning)',
domains: ['fintech', 'ec', 'saas', 'health', 'government']
},
carbon_aware: {
title_ja: 'カーボンアウェアスケーリング(Green IT)',
title_en: 'Carbon-Aware Scaling (Green IT)',
desc_ja: '電力CO2排出係数に基づき、非必須処理を抑制。KEDA外部トリガー。',
desc_en: 'Scale down non-critical workloads based on carbon intensity. KEDA external trigger.',
tech: 'KEDA, Carbon Intensity API',
domains: ['manufacturing', 'energy', 'ec', 'analytics']
},
post_quantum: {
title_ja: 'ポスト量子暗号+DID(未来対応)',
title_en: 'Post-Quantum Cryptography + DID (Future-Ready)',
desc_ja: 'NIST標準ML-KEM(Kyber)ハイブリッド鍵交換、Verifiable Credentials。',
desc_en: 'NIST-standardized ML-KEM (Kyber) hybrid key exchange, Verifiable Credentials.',
tech: 'ML-KEM (Kyber), DID (Decentralized Identifiers)',
domains: ['fintech', 'government', 'legal']
},
strangler_fig: {
title_ja: 'Strangler Figパターン(段階的移行)',
title_en: 'Strangler Fig Pattern (Gradual Migration)',
desc_ja: 'Nginxでトラフィック分割。レガシー→新システムへ徐々に移行。',
desc_en: 'Traffic splitting via Nginx. Gradual migration from legacy to new system.',
tech: 'Nginx split_clients, Canary release',
domains: ['_all']
}
};
// Pragmatic Implementation Scenarios (5 high-impact patterns)
const PRAGMATIC_SCENARIOS = {
disposable_arch: {
title_ja: '使い捨てアーキテクチャ(PMF前スピード特化)',
title_en: 'Disposable Architecture (Pre-PMF Speed)',
desc_ja: 'BaaS極限活用(Supabase RLS)、API開発スキップ。PMF後に再設計。',
desc_en: 'Extreme BaaS usage (Supabase RLS), Skip API development. Redesign post-PMF.',
stakeholder: 'startup',
tech: 'Supabase / Firebase + Next.js (Vercel)'
},
ai_hitl: {
title_ja: 'AI協働型(Human-in-the-loop)',
title_en: 'AI Collaboration (Human-in-the-loop)',
desc_ja: 'AI回答を人間が修正→修正データを学習サイクルへ即座に還元。',
desc_en: 'Humans correct AI responses → Corrections fed back to learning cycle.',
stakeholder: 'team',
tech: 'LangChain, Streamlit, Feedback DB'
},
small_data_stack: {
title_ja: 'スモールデータ基盤(中堅企業DX)',
title_en: 'Small Data Stack (Mid-size Enterprise DX)',
desc_ja: '高価なデータ基盤不要。dbt+Great Expectationsで品質担保。',
desc_en: 'No expensive data platform. dbt + Great Expectations for quality.',
stakeholder: 'enterprise',
tech: 'Fivetran (Extract) → Snowflake → dbt (Transform)'
},
silver_tech: {
title_ja: 'シルバーテック(高齢者対応)',
title_en: 'Silver Tech (Elderly-Friendly)',
desc_ja: '脱パスワード、LINE完結、音声UI優先。日本市場必須対応。',
desc_en: 'Passwordless, LINE-first, Voice UI priority. Essential for Japanese market.',
stakeholder: 'team',
tech: 'FIDO2, LINE Login, Web Speech API'
},
dora_platform: {
title_ja: 'DORA指標+Platform Engineering',
title_en: 'DORA Metrics + Platform Engineering',
desc_ja: 'Backstageで"Golden Path"提供。開発者の認知負荷削減。',
desc_en: 'Backstage provides "Golden Path". Reduce developer cognitive load.',
stakeholder: 'enterprise',
tech: 'Backstage, GitHub Actions, DORA metrics dashboard'
}
};
// Tech Radar Base Data (Adopt/Trial/Assess/Hold)
const TECH_RADAR_BASE = {
frontend: {
adopt: ['React 19','Next.js 15','Tailwind CSS','TypeScript','Zod'],
trial: ['Astro','Qwik','htmx','React Server Components'],
assess: ['Svelte 5','Solid.js','Web Components'],
hold: ['jQuery','Angular.js','Backbone.js']
},
backend: {
adopt: ['Node.js 22 LTS','Hono','Fastify','PostgreSQL','Redis'],
trial: ['Bun','Deno 2','Cloudflare Workers','Edge Runtime'],
assess: ['Rust (Actix/Axum)','Go (Gin/Echo)','Zig'],
hold: ['PHP 7.x','Python 2.x','MongoDB (as primary DB)']
},
infrastructure: {
adopt: ['Docker','Vercel','Railway','Supabase','Stripe'],
trial: ['SST (Serverless Stack)','Terraform','Pulumi','Cloudflare Pages'],
assess: ['Kubernetes (for scale)','Fly.io','Render'],
hold: ['Heroku','AWS Elastic Beanstalk','Self-hosted without automation']
},
ai: {
adopt: ['Claude 3.5/4','GPT-4o','Vercel AI SDK','OpenAI SDK'],
trial: ['Claude Code','Cursor','Anthropic MCP','AI Agents'],
assess: ['Local LLMs (Ollama)','Fine-tuning','Vector DBs (Pinecone/Weaviate)'],
hold: ['GPT-3.5 (outdated)','Non-streaming responses','Prompt without streaming']
}
};
/// Helper: Extended industry detection (32 industries)
function detectIndustry(purpose) {
if (!purpose) return '_default';
const p = purpose.toLowerCase();
// Check extended industries first (8 new ones) - more specific patterns to avoid conflicts
const ext = [
[/(製造|工場|factory|manufacturing|industry.?4|smart.*factory|ファクトリー|生産管理)/i, 'manufacturing'],
[/(物流|配送|logistics|supply.?chain|倉庫|warehouse|ルート最適)/i, 'logistics'],
[/(農業|agri|farming|農場|crop|livestock|スマート農業)/i, 'agriculture'],
[/(エネルギー|energy|発電|電力|solar|grid|スマートメーター)/i, 'energy'],
[/(メディア|放送|streaming|ストリーミング|gaming|ゲーム|DRM|entertainment|配信.*platform)/i, 'media'],
[/(行政|government|gov.?tech|自治体|LGWAN|マイナンバー|公共|手続き.*online)/i, 'government'],
[/(旅行|観光|travel|hospitality|PMS|hotel.*予約|宿泊|民泊)/i, 'travel'],
[/(保険|insurance|insur.?tech|引受|telematics|パラメトリック)/i, 'insurance'],
];
for (const [rx, key] of ext) { if (rx.test(p)) return key; }

// Fall back to original detectDomain for 24 original domains
const d = detectDomain(purpose);
return d || '_default';
}

// Helper: Detect stakeholder type from target
function detectStakeholder(target) {
if (!target) return 'team';
const t = target.toLowerCase();
if (t.includes('startup') || t.includes('スタートアップ') || t.includes('起業') || t.includes('freelancer') || t.includes('フリーランス')) return 'startup';
if (t.includes('executive') || t.includes('役員') || t.includes('enterprise') || t.includes('大企業') || t.includes('admin') || t.includes('管理者')) return 'enterprise';
if (t.includes('engineer') && !t.includes('startup') || t.includes('エンジニア') || t.includes('developer') || t.includes('開発者')) return 'developer';
return 'team';
}

// Main Generator Function
function genPillar13_StrategicIntelligence(a, pn) {
const G = S.genLang === 'ja';
const domain = detectIndustry(a.purpose) || '_default';
const intel = INDUSTRY_INTEL[domain] || INDUSTRY_INTEL._default;
const target = a.target || '';
const stakeholderType = detectStakeholder(target);
const stakeholder = STAKEHOLDER_STRATEGY[stakeholderType];
const frontend = a.frontend || 'React + Next.js';
const backend = a.backend || 'Supabase';
const database = a.database || 'PostgreSQL';
const deploy = a.deploy || 'Vercel';
// ═══ DOC 48: Industry Blueprint ═══
let doc48 = '';
doc48 += '# ' + (G ? '業種別設計図: ' : 'Industry Blueprint: ') + (G ? domain : domain) + '\n\n';
doc48 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc48 += '> ' + (G ? 'ドメイン: ' : 'Domain: ') + domain + '\n';
doc48 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc48 += '## ' + (G ? '1. 規制・コンプライアンス要件' : '1. Regulatory & Compliance Requirements') + '\n\n';
const regs = G ? intel.reg_ja : intel.reg_en;
regs.forEach(r => doc48 += '- ' + r + '\n');
doc48 += '\n' + (G ? '**関連ドキュメント:** ' : '**Related Documents:** ') + '[Compliance Matrix](./45_compliance_matrix.md) | [Security Intelligence](./43_security_intelligence.md)\n\n';
doc48 += '## ' + (G ? '2. 推奨アーキテクチャパターン' : '2. Recommended Architecture Patterns') + '\n\n';
const archs = G ? intel.arch_ja : intel.arch_en;
archs.forEach(ar => doc48 += '- **' + ar + '**\n');
doc48 += '\n### ' + (G ? '現在のスタック適合度' : 'Current Stack Compatibility') + '\n\n';
doc48 += '| ' + (G ? 'レイヤー' : 'Layer') + ' | ' + (G ? '選択技術' : 'Selected Tech') + ' | ' + (G ? '業種推奨' : 'Industry Rec') + ' | ' + (G ? '適合度' : 'Fit') + ' |\n';
doc48 += '|---|---|---|---|\n';
// Frontend compatibility
const isFrontendGood = frontend.includes('Next.js') || frontend.includes('React') || frontend.includes('Vue');
doc48 += '| Frontend | ' + frontend + ' | React/Next.js/Vue | ' + (isFrontendGood ? '✅ ' + (G ? '良好' : 'Good') : '⚠️ ' + (G ? '要検討' : 'Review')) + ' |\n';
// Backend compatibility
const isBackendGood = backend.includes('Supabase') || backend.includes('Firebase') || backend.includes('Express') || backend.includes('Fastify') || backend.includes('Hono');
doc48 += '| Backend | ' + backend + ' | BaaS/Node.js | ' + (isBackendGood ? '✅ ' + (G ? '良好' : 'Good') : '⚠️ ' + (G ? '要検討' : 'Review')) + ' |\n';
// Database compatibility
const isDbGood = database.includes('PostgreSQL') || database.includes('Supabase') || database.includes('Firebase');
doc48 += '| Database | ' + database + ' | PostgreSQL/Firebase | ' + (isDbGood ? '✅ ' + (G ? '良好' : 'Good') : '⚠️ ' + (G ? '要検討' : 'Review')) + ' |\n\n';
doc48 += '## ' + (G ? '3. 失敗要因 Top 3' : '3. Top 3 Failure Factors') + '\n\n';
const fails = G ? intel.fail_ja : intel.fail_en;
fails.forEach((f, i) => {
doc48 += '### ' + (G ? '失敗要因' : 'Failure Factor') + ' ' + (i + 1) + ': ' + f + '\n\n';
doc48 += (G ? '**回避策:**\n' : '**Mitigation:**\n');
doc48 += '- [ ] ' + (G ? 'チェックリスト項目を追加' : 'Add checklist item') + '\n';
doc48 += '- [ ] ' + (G ? 'モニタリング設定' : 'Set up monitoring') + '\n';
doc48 += '- [ ] ' + (G ? 'テスト戦略に組み込み' : 'Incorporate into test strategy') + '\n\n';
});
doc48 += '## ' + (G ? '4. ビジネスモデル比較' : '4. Business Model Comparison') + '\n\n';
const bms = G ? intel.bm_ja : intel.bm_en;
doc48 += '| ' + (G ? 'モデル' : 'Model') + ' | ' + (G ? '収益源' : 'Revenue') + ' | ' + (G ? 'ターゲット' : 'Target') + ' |\n';
doc48 += '|---|---|---|\n';
bms.forEach(bm => {
const parts = bm.split('|');
if (parts.length === 3) {
doc48 += '| ' + parts[0] + ' | ' + parts[1] + ' | ' + parts[2] + ' |\n';
}
});
doc48 += '\n';
doc48 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc48 += '- [Tech Radar](./49_tech_radar.md)\n';
doc48 += '- [Stakeholder Strategy](./50_stakeholder_strategy.md)\n';
doc48 += '- [Operational Excellence](./51_operational_excellence.md)\n';
doc48 += '- [Architecture](./03_architecture.md)\n';
doc48 += '- [Business Model](./38_business_model.md)\n';
S.files['docs/48_industry_blueprint.md'] = doc48;
// ═══ DOC 49: Tech Radar ═══
let doc49 = '';
doc49 += '# ' + (G ? '技術トレンドレーダー 2026-2030' : 'Technology Radar 2026-2030') + '\n\n';
doc49 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc49 += '> ' + (G ? '基準日: ' : 'As of: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc49 += '## ' + (G ? '1. 技術分類マトリクス' : '1. Technology Classification Matrix') + '\n\n';
['frontend', 'backend', 'infrastructure', 'ai'].forEach(cat => {
const radar = TECH_RADAR_BASE[cat];
doc49 += '### ' + cat.charAt(0).toUpperCase() + cat.slice(1) + '\n\n';
doc49 += '| ' + (G ? 'カテゴリ' : 'Category') + ' | ' + (G ? '技術' : 'Technologies') + ' |\n';
doc49 += '|---|---|\n';
doc49 += '| 🟢 **Adopt** ' + (G ? '(即採用)' : '(Adopt Now)') + ' | ' + radar.adopt.join(', ') + ' |\n';
doc49 += '| 🔵 **Trial** ' + (G ? '(試験導入)' : '(Trial)') + ' | ' + radar.trial.join(', ') + ' |\n';
doc49 += '| 🟡 **Assess** ' + (G ? '(評価中)' : '(Assess)') + ' | ' + radar.assess.join(', ') + ' |\n';
doc49 += '| 🔴 **Hold** ' + (G ? '(保留・非推奨)' : '(Hold/Avoid)') + ' | ' + radar.hold.join(', ') + ' |\n\n';
});
doc49 += '## ' + (G ? '2. 業種別注目技術(2026-2030)' : '2. Domain-Specific Trends (2026-2030)') + '\n\n';
const trends = G ? intel.trend_ja : intel.trend_en;
trends.forEach((tr, i) => {
doc49 += '### ' + (G ? 'トレンド' : 'Trend') + ' ' + (i + 1) + ': ' + tr + '\n\n';
doc49 += (G ? '**採用タイムライン:**\n' : '**Adoption Timeline:**\n');
doc49 += '- ' + (G ? '即時(2026 Q1-Q2): 技術検証・PoC実施' : 'Immediate (2026 Q1-Q2): Tech validation & PoC') + '\n';
doc49 += '- ' + (G ? '中期(2026 Q3-Q4): パイロット導入' : 'Mid-term (2026 Q3-Q4): Pilot deployment') + '\n';
doc49 += '- ' + (G ? '長期(2027-2030): 本格展開' : 'Long-term (2027-2030): Full rollout') + '\n\n';
});
doc49 += '## ' + (G ? '3. スタック進化ロードマップ' : '3. Stack Evolution Roadmap') + '\n\n';
doc49 += '```mermaid\n';
doc49 += 'timeline\n';
doc49 += ' title ' + (G ? 'スタック進化ロードマップ' : 'Stack Evolution Roadmap') + '\n';
doc49 += ' ' + (G ? '現在(2026 Q1)' : 'Current (2026 Q1)') + ' : ' + frontend + ' : ' + backend + ' : ' + database + '\n';
doc49 += ' ' + (G ? '6ヶ月後(2026 Q3)' : '6 Months (2026 Q3)') + ' : ' + (G ? 'パフォーマンス最適化' : 'Performance optimization') + ' : ' + (G ? 'AI機能統合' : 'AI feature integration') + '\n';
doc49 += ' ' + (G ? '1年後(2027 Q1)' : '1 Year (2027 Q1)') + ' : ' + (G ? 'スケーラビリティ強化' : 'Scalability enhancement') + ' : ' + (G ? 'リアルタイム機能拡充' : 'Real-time features expansion') + '\n';
doc49 += ' ' + (G ? '3年後(2029 Q1)' : '3 Years (2029 Q1)') + ' : ' + (G ? '次世代アーキテクチャ移行' : 'Next-gen architecture migration') + ' : ' + (G ? '完全AI統合' : 'Full AI integration') + '\n';
doc49 += '```\n\n';
doc49 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc49 += '- [Industry Blueprint](./48_industry_blueprint.md)\n';
doc49 += '- [Roadmap](./10_gantt.md)\n';
doc49 += '- [Architecture](./03_architecture.md)\n';
S.files['docs/49_tech_radar.md'] = doc49;
// ═══ DOC 50: Stakeholder Strategy ═══
let doc50 = '';
doc50 += '# ' + (G ? 'ステークホルダー別開発戦略: ' : 'Stakeholder Strategy: ') + (G ? stakeholder.name_ja : stakeholder.name_en) + '\n\n';
doc50 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc50 += '> ' + (G ? 'タイプ: ' : 'Type: ') + stakeholderType + '\n';
doc50 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc50 += '## ' + (G ? '1. 開発フェーズ戦略' : '1. Development Phase Strategy') + '\n\n';
const phases = G ? stakeholder.phases_ja : stakeholder.phases_en;
phases.forEach((ph, i) => {
doc50 += '### ' + (G ? 'フェーズ' : 'Phase') + ' ' + (i + 1) + ': ' + ph + '\n\n';
doc50 += (G ? '**主要タスク:**\n' : '**Key Tasks:**\n');
doc50 += '- [ ] ' + (G ? 'タスク1' : 'Task 1') + '\n';
doc50 += '- [ ] ' + (G ? 'タスク2' : 'Task 2') + '\n';
doc50 += '- [ ] ' + (G ? 'タスク3' : 'Task 3') + '\n\n';
});
doc50 += '## ' + (G ? '2. 技術的負債管理戦略' : '2. Technical Debt Management Strategy') + '\n\n';
doc50 += (G ? stakeholder.tech_debt_ja : stakeholder.tech_debt_en) + '\n\n';
doc50 += (G ? '**具体的アクション:**\n' : '**Concrete Actions:**\n');
doc50 += '- [ ] ' + (G ? '負債リストを作成(Issue tracking)' : 'Create debt list (Issue tracking)') + '\n';
doc50 += '- [ ] ' + (G ? 'SQALE Rating計測ツール導入(SonarQube)' : 'Implement SQALE Rating tool (SonarQube)') + '\n';
doc50 += '- [ ] ' + (G ? '四半期ごとにリファクタリングSprint実施' : 'Conduct quarterly refactoring sprints') + '\n\n';
doc50 += '## ' + (G ? '3. チーム構成推奨' : '3. Team Composition Recommendations') + '\n\n';
doc50 += (G ? stakeholder.team_ja : stakeholder.team_en) + '\n\n';
doc50 += '```mermaid\n';
doc50 += 'graph LR\n';
if (stakeholderType === 'startup') {
doc50 += ' A[Full-stack 1-2] --> B[Front/Back 3-5]\n';
doc50 += ' B --> C[Specialized 10+]\n';
} else if (stakeholderType === 'enterprise') {
doc50 += ' A[Architect] --> B[Team 1]\n';
doc50 += ' A --> C[Team 2]\n';
doc50 += ' A --> D[Platform Eng]\n';
} else if (stakeholderType === 'developer') {
doc50 += ' A[Solo] --> B[Duo]\n';
doc50 += ' B --> C[Small Team 3-5]\n';
} else {
doc50 += ' A[Cross-functional 5-9] --> B[Two-Pizza Team]\n';
}
doc50 += '```\n\n';
doc50 += '## ' + (G ? '4. 予算配分ガイド' : '4. Budget Allocation Guide') + '\n\n';
doc50 += '**' + (G ? '推奨配分:' : 'Recommended allocation:') + '**\n\n';
doc50 += (G ? stakeholder.budget_ja : stakeholder.budget_en) + '\n\n';
doc50 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc50 += '- [Operational Excellence](./51_operational_excellence.md)\n';
doc50 += '- [WBS](./11_wbs.md)\n';
doc50 += '- [Roadmap](./10_gantt.md)\n';
S.files['docs/50_stakeholder_strategy.md'] = doc50;
// ═══ DOC 51: Operational Excellence ═══
let doc51 = '';
doc51 += '# ' + (G ? '運用卓越性' : 'Operational Excellence') + '\n\n';
doc51 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc51 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
// Tech Debt
const td = OPERATIONAL_FRAMEWORKS.tech_debt;
doc51 += '## ' + (G ? '1. 技術的負債管理' : '1. Technical Debt Management') + '\n\n';
doc51 += '### ' + (G ? td.title_ja : td.title_en) + '\n\n';
doc51 += (G ? '**4象限分類:**\n' : '**4-Quadrant Classification:**\n');
const quadrants = G ? td.quadrant_ja : td.quadrant_en;
quadrants.forEach((q, i) => doc51 += (i + 1) + '. ' + q + '\n');
doc51 += '\n**SQALE:** ' + (G ? td.sqale_ja : td.sqale_en) + '\n\n';
doc51 += '**' + (G ? td.rule_ja : td.rule_en) + '**\n\n';
// DR/BCP
const dr = OPERATIONAL_FRAMEWORKS.dr_bcp;
doc51 += '## ' + (G ? '2. 災害復旧・BCP' : '2. Disaster Recovery & BCP') + '\n\n';
doc51 += '### ' + (G ? dr.title_ja : dr.title_en) + '\n\n';
doc51 += (G ? dr.rto_rpo_ja : dr.rto_rpo_en) + '\n\n';
const tiers = G ? dr.tier_ja : dr.tier_en;
tiers.forEach(t => doc51 += '- ' + t + '\n');
doc51 += '\n**' + (G ? 'バックアップ戦略:' : 'Backup Strategy:') + '** ' + (G ? dr.backup_ja : dr.backup_en) + '\n\n';
doc51 += '**' + (G ? 'インシデント対応フロー:' : 'Incident Response Flow:') + '** ' + (G ? dr.incident_ja : dr.incident_en) + '\n\n';
// Green IT
const green = OPERATIONAL_FRAMEWORKS.green_it;
doc51 += '## ' + (G ? '3. Green IT・カーボンニュートラル' : '3. Green IT & Carbon Neutrality') + '\n\n';
const frameworks = G ? green.framework_ja : green.framework_en;
frameworks.forEach(f => doc51 += '- ' + f + '\n');
doc51 += '\n**' + (G ? '計測:' : 'Measurement:') + '** ' + (G ? green.carbon_ja : green.carbon_en) + '\n\n';
doc51 += '**' + (G ? 'インフラ選択:' : 'Infrastructure:') + '** ' + (G ? green.sla_ja : green.sla_en) + '\n\n';
// Team Design
const team = OPERATIONAL_FRAMEWORKS.team_design;
doc51 += '## ' + (G ? '4. チーム設計・Conway\'s Law対応' : '4. Team Design & Conway\'s Law') + '\n\n';
doc51 += '**' + (G ? 'Conway\'s Law:' : 'Conway\'s Law:') + '** ' + (G ? team.conway_ja : team.conway_en) + '\n\n';
doc51 += '**' + (G ? team.two_pizza_ja : team.two_pizza_en) + '**\n\n';
doc51 += '**DORA Metrics:** ' + (G ? team.dora_ja : team.dora_en) + '\n\n';
doc51 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc51 += '- [Stakeholder Strategy](./50_stakeholder_strategy.md)\n';
doc51 += '- [Incident Response](./34_incident_response.md)\n';
doc51 += '- [QA Strategy](./28_qa_strategy.md)\n';
doc51 += '- [Test Strategy](./36_test_strategy.md)\n';
S.files['docs/51_operational_excellence.md'] = doc51;
// ═══ DOC 52: Advanced Scenarios ═══
let doc52 = '';
doc52 += '# ' + (G ? '先端実装シナリオ集' : 'Advanced Implementation Scenarios') + '\n\n';
doc52 += '> ' + (G ? 'プロジェクト: ' : 'Project: ') + pn + '\n';
doc52 += '> ' + (G ? 'ドメイン: ' : 'Domain: ') + domain + '\n';
doc52 += '> ' + (G ? 'ステークホルダー: ' : 'Stakeholder: ') + stakeholderType + '\n';
doc52 += '> ' + (G ? '生成日: ' : 'Generated: ') + new Date().toISOString().split('T')[0] + '\n\n';
doc52 += '## ' + (G ? '1. 拡張運用フレームワーク' : '1. Extended Operational Frameworks') + '\n\n';
// AI Ethics
const ai_eth = OPERATIONAL_FRAMEWORKS_EXT.ai_ethics;
doc52 += '### ' + (G ? ai_eth.title_ja : ai_eth.title_en) + '\n\n';
doc52 += (G ? '**5原則:** ' : '**5 Principles:** ');
const principles = G ? ai_eth.principles_ja : ai_eth.principles_en;
doc52 += principles.join(', ') + '\n\n';
doc52 += (G ? '**実装:** ' : '**Implementation:** ') + (G ? ai_eth.impl_ja : ai_eth.impl_en) + '\n\n';
doc52 += (G ? '**コンプライアンス:** ' : '**Compliance:** ') + (G ? ai_eth.compliance_ja : ai_eth.compliance_en) + '\n\n';
// Zero Trust
const zt = OPERATIONAL_FRAMEWORKS_EXT.zero_trust;
doc52 += '### ' + (G ? zt.title_ja : zt.title_en) + '\n\n';
doc52 += (G ? '**原則:** ' : '**Principles:** ') + (G ? zt.principles_ja : zt.principles_en) + '\n\n';
doc52 += (G ? '**実装:** ' : '**Implementation:** ') + (G ? zt.impl_ja : zt.impl_en) + '\n\n';
doc52 += (G ? '**BeyondCorp:** ' : '**BeyondCorp:** ') + (G ? zt.beyondcorp_ja : zt.beyondcorp_en) + '\n\n';
// Data Governance
const dg = OPERATIONAL_FRAMEWORKS_EXT.data_governance;
doc52 += '### ' + (G ? dg.title_ja : dg.title_en) + '\n\n';
doc52 += (G ? '**要素:** ' : '**Elements:** ');
const elements = G ? dg.elements_ja : dg.elements_en;
doc52 += elements.join(', ') + '\n\n';
doc52 += (G ? '**スタック:** ' : '**Stack:** ') + (G ? dg.stack_ja : dg.stack_en) + '\n\n';
doc52 += (G ? '**データメッシュ:** ' : '**Data Mesh:** ') + (G ? dg.mesh_ja : dg.mesh_en) + '\n\n';
// Globalization
const glob = OPERATIONAL_FRAMEWORKS_EXT.globalization;
doc52 += '### ' + (G ? glob.title_ja : glob.title_en) + '\n\n';
doc52 += (G ? '**i18n:** ' : '**i18n:** ') + (G ? glob.i18n_ja : glob.i18n_en) + '\n\n';
doc52 += (G ? '**l10n:** ' : '**l10n:** ') + (G ? glob.l10n_ja : glob.l10n_en) + '\n\n';
doc52 += (G ? '**インフラ:** ' : '**Infrastructure:** ') + (G ? glob.infra_ja : glob.infra_en) + '\n\n';
doc52 += '## ' + (G ? '2. 極限実装シナリオ' : '2. Extreme Implementation Scenarios') + '\n\n';
doc52 += (G ? '**対象:** このドメインに関連する先端実装パターン\n\n' : '**Scope:** Advanced patterns relevant to this domain\n\n');
// Filter extreme scenarios by domain
Object.keys(EXTREME_SCENARIOS).forEach(key => {
const sc = EXTREME_SCENARIOS[key];
if (sc.domains.includes('_all') || sc.domains.includes(domain)) {
doc52 += '### ' + (G ? sc.title_ja : sc.title_en) + '\n\n';
doc52 += (G ? sc.desc_ja : sc.desc_en) + '\n\n';
doc52 += '**' + (G ? '技術:' : 'Technology:') + '** ' + sc.tech + '\n\n';
}
});
doc52 += '## ' + (G ? '3. 実利シナリオ' : '3. Pragmatic Scenarios') + '\n\n';
doc52 += (G ? '**対象:** このステークホルダータイプに推奨される高効率パターン\n\n' : '**Scope:** High-impact patterns for this stakeholder type\n\n');
// Filter pragmatic scenarios by stakeholder
Object.keys(PRAGMATIC_SCENARIOS).forEach(key => {
const sc = PRAGMATIC_SCENARIOS[key];
if (sc.stakeholder === stakeholderType || sc.stakeholder === 'team') {
doc52 += '### ' + (G ? sc.title_ja : sc.title_en) + '\n\n';
doc52 += (G ? sc.desc_ja : sc.desc_en) + '\n\n';
doc52 += '**' + (G ? '技術:' : 'Technology:') + '** ' + sc.tech + '\n\n';
}
});
doc52 += (G ? '## 📚 関連ドキュメント\n\n' : '## 📚 Related Documents\n\n');
doc52 += '- [Industry Blueprint](./48_industry_blueprint.md)\n';
doc52 += '- [Tech Radar](./49_tech_radar.md)\n';
doc52 += '- [Stakeholder Strategy](./50_stakeholder_strategy.md)\n';
doc52 += '- [Operational Excellence](./51_operational_excellence.md)\n';
doc52 += '- [Security Intelligence](./43_security_intelligence.md)\n';
doc52 += '- [Compliance Matrix](./45_compliance_matrix.md)\n';
S.files['docs/52_advanced_scenarios.md'] = doc52;
}
function genDocs21(a,pn){
const G=S.genLang==='ja';
const date=new Date().toISOString().split('T')[0];
const ganttStart=new Date().toISOString().split('T')[0];
const fe=a.frontend||'React';const be=a.backend||'Node.js';
const auth=resolveAuth(a);
const arch=resolveArch(a);
const orm=arch.isBaaS?(be.includes('Supabase')?'Supabase Client':be.includes('Firebase')?'Firebase SDK':'Convex'):(a.orm&&a.orm.includes('Drizzle')?'Drizzle':'Prisma');
const stripPri=s=>(s||'').replace(/\[P[0-2]\]\s*/g,'');
const entities=(stripPri(a.data_entities)||'users, items').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const features=(stripPri(a.mvp_features)||(G?'CRUD操作':'CRUD')).split(', ').filter(Boolean);
const screens=(stripPri(a.screens)||(G?'ダッシュボード, ログイン':'Dashboard, Login')).split(', ').filter(Boolean);
const methods=(stripPri(a.dev_methods)||'TDD').split(', ').filter(Boolean);
const target=(a.target||'').toLowerCase();
const hasAdmin=/管理者|admin|管理/i.test(target)||features.some(f=>/管理ダッシュボード|admin/i.test(f));
const hasInstructor=/講師|instructor|teacher/i.test(target);
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
// 1. Project Overview
S.files['docs/01_project_overview.md']=`# ${pn} — ${G?'プロジェクト概要書':'Project Overview'}\n> ${date}\n\n${G?'## 目的':'## Purpose'}\n${a.purpose||'N/A'}\n\n${G?'## ターゲット':'## Target'}\n${a.target||'N/A'}\n\n${G?'## 成功指標':'## Success Metrics'}\n${a.success||'N/A'}\n\n${G?'## スケジュール':'## Schedule'}\n${a.deadline||(G?'6ヶ月':'6 months')}\n\n## ${G?'技術スタック':'Tech Stack'}\n- Frontend: ${fe}\n- Backend: ${be}\n- DB: ${a.database||'PostgreSQL'}\n- Deploy: ${a.deploy||'Vercel'}`;
// 2. Requirements
S.files['docs/02_requirements.md']=`# ${pn} — ${G?'要件定義書':'Requirements'}\n> ${date}\n\n${G?'## 機能要件':'## Functional Requirements'}\n${features.map(f=>'- '+f).join('\n')}\n\n${G?'## 非機能要件':'## Non-functional'}\n- ${G?'レスポンス':'Response'}: ${S.skill==='pro'?'<200ms (p95)':S.skill==='intermediate'?'<500ms (p95)':'<1000ms (p95)'}\n- ${G?'可用性':'Availability'}: ${S.skill==='pro'?'99.9%':S.skill==='intermediate'?'99%':(G?'ベストエフォート':'Best effort')}\n- ${G?'セキュリティ':'Security'}: OWASP Top 10`;
// 3. Architecture
const archLabelD=G?{baas:'BaaS統合型',bff:'BFF（API Routes統合）',split:'FE/BE分離型',traditional:'従来型クライアント-サーバー'}[arch.pattern]:{baas:'BaaS Integration',bff:'BFF (API Routes)',split:'FE/BE Split',traditional:'Traditional Client-Server'}[arch.pattern];
const layersD=arch.isBaaS?'1. Presentation Layer ('+fe+')\\n2. BaaS SDK Layer ('+be+')\\n3. Functions Layer (Edge/Cloud Functions)\\n4. Data Layer ('+(a.database||'PostgreSQL')+')':arch.pattern==='bff'?'1. Presentation Layer ('+fe+')\\n2. API Routes Layer (Next.js Route Handlers)\\n3. Domain Layer (Business Logic)\\n4. Data Layer ('+(a.database||'PostgreSQL')+')':'1. Presentation Layer ('+fe+')\\n2. Application Layer (API Routes)\\n3. Domain Layer (Business Logic)\\n4. Infrastructure Layer ('+(a.database||'PostgreSQL')+')';
S.files['docs/03_architecture.md']=`# ${pn} — ${G?'アーキテクチャ設計書':'Architecture Design'}\n> ${date}\n\n${G?'## アーキテクチャパターン':'## Architecture Pattern'}\n${archLabelD}\n\n${G?'## システム構成図':'## System Diagram'}\n\n\`\`\`\n${arch.diagram}\n\`\`\`\n${arch.note?'\n> '+arch.note+'\n':''}\n${G?'## レイヤー構造':'## Layer Structure'}\n${layersD}`;
// 4. ER Diagram (Mermaid erDiagram) — with rich columns from ENTITY_COLUMNS
const erLines=[];
entities.forEach(e=>{
const cols=getEntityColumns(e,G,entities);
const colLines=[' uuid id PK'];
cols.forEach(c=>{
const mT=c.type.includes('VARCHAR')?'string':c.type.includes('INT')||c.type.includes('DECIMAL')?'int':c.type.includes('BOOLEAN')?'boolean':c.type.includes('TIMESTAMP')||c.type.includes('DATE')||c.type.includes('TIME')?'timestamp':c.type.includes('JSONB')?'json':'string';
const mC=c.constraint.includes('FK')?'FK':c.constraint.includes('UNIQUE')?'UK':'';
colLines.push(` ${mT} ${c.col} ${mC}`.trimEnd());
});
if(!cols.length) colLines.push(' string name');
colLines.push(' timestamp created_at',' timestamp updated_at');
erLines.push(` ${e.replace(/\s/g,'_')} {\n${colLines.join('\n')}\n }`);
});
const erRels=[];
const erInf=inferER(a);
erInf.relationships.forEach(r=>{
const clean=r.replace(/\s*\(.*\)\s*$/,'');
const words=clean.split(/\s+/);
if(words.length>=3){
const from=words[0].replace(/\s/g,'_');
const to=words[words.length-1].replace(/\s/g,'_');
const mid=words.slice(1,-1).join(' ');
if(mid.includes('N')&&mid.includes('M')) erRels.push(` ${from} }o--o{ ${to} : "many-to-many"`);
else if(mid.includes('0')) erRels.push(` ${from} o|--o{ ${to} : "self-ref"`);
else erRels.push(` ${from} ||--o{ ${to} : "has"`);
}
});
if(!erRels.length){
const hasUser=entities.some(e=>e.toLowerCase()==='user');
if(hasUser) entities.forEach(e=>{
if(e.toLowerCase()!=='user') erRels.push(` User ||--o{ ${e.replace(/\s/g,'_')} : "has"`);
});
}
// FK map — merge inferER relationships + ENTITY_COLUMNS FK annotations
const fkMap={};
erInf.relationships.forEach(r=>{
const clean=r.replace(/\s*\(.*\)\s*$/,'');
const words=clean.split(/\s+/);
if(words.length>=3){
const parent=words[0],to=words[words.length-1],mid=words.slice(1,-1).join(' ');
if(!mid.includes('M')&&!mid.includes('0')){
if(!fkMap[to])fkMap[to]=[];
const fk=parent.toLowerCase()+'_id';
if(!fkMap[to].includes(fk))fkMap[to].push(fk);
}
}
});
entities.forEach(e=>{
getEntityColumns(e,G,entities).forEach(c=>{
if(c.constraint.includes('FK')){if(!fkMap[e])fkMap[e]=[];if(!fkMap[e].includes(c.col))fkMap[e].push(c.col);}
});
});
if(!Object.keys(fkMap).length) erRels.forEach(rel=>{
const m2=rel.match(/(\w+)\s+\|\|--o\{\s+(\w+)/);
if(m2){if(!fkMap[m2[2]])fkMap[m2[2]]=[];const fk=m2[1].toLowerCase()+'_id';if(!fkMap[m2[2]].includes(fk))fkMap[m2[2]].push(fk);}
});
S.files['docs/04_er_diagram.md']=`# ${pn} — ${G?'ER図':'ER Diagram'}\n> ${date}\n\n${G?'## エンティティ関連図':'## Entity Relationship Diagram'}\n\n\`\`\`mermaid\nerDiagram\n${erLines.join('\n')}\n${erRels.join('\n')}\n\`\`\`\n\n${G?'## エンティティ詳細':'## Entity Details'}\n${entities.map(e=>{
const cols=getEntityColumns(e,G,entities);
const colRows=cols.map(c=>`| ${c.col} | ${c.type} | ${c.constraint.includes('FK')?'FK':c.constraint||''} | ${c.desc} |`).join('\n');
const nameRow=cols.length?'':(`| name | VARCHAR(255) | NOT NULL | ${e} ${G?'名':'name'} |\n`);
return `\n### ${e}\n| ${G?'カラム':'Column'} | ${G?'型':'Type'} | ${G?'制約':'Constraint'} | ${G?'説明':'Desc'} |\n|--------|------|------|------|\n| id | UUID | PK | ${G?'一意識別子':'Unique ID'} |\n${colRows?colRows+'\n':''}${nameRow}| created_at | TIMESTAMP | DEFAULT NOW | ${G?'作成日時':'Created at'} |\n| updated_at | TIMESTAMP | DEFAULT NOW | ${G?'更新日時':'Updated at'} |`;
}).join('\n')}`;
// 5. API Design (BaaS-aware)
let apiEndpoints;
if(arch.isBaaS){
const sdkName=be.includes('Supabase')?'Supabase Client SDK':be.includes('Firebase')?'Firebase SDK':'BaaS SDK';
apiEndpoints=entities.map(e=>{
const tbl=pluralize(e);
const cols=getEntityColumns(e,G,entities);
// Build insert/update field examples from real columns
const insertFields=cols.filter(c=>!c.col.endsWith('_at')&&!c.constraint.includes('DEFAULT NOW')&&!c.constraint.includes('FK')).slice(0,4);
const insertObj=insertFields.length?insertFields.map(c=>c.col+': '+(c.type.includes('INT')||c.type.includes('DECIMAL')?'0':c.type.includes('BOOLEAN')?'false':`'...'`)).join(', '):'name: \'...\'';
const fkFields=cols.filter(c=>c.constraint.includes('FK'));
const fkInsert=fkFields.map(c=>{
const varName=c.col.replace(/_([a-z])/g,(_,l)=>l.toUpperCase()).replace(/Id$/,'Id');
return c.col+': '+varName;
}).join(', ');
const allInsert=[fkInsert,insertObj].filter(Boolean).join(', ');
if(be.includes('Supabase')){
return `\n### ${e} (${G?'テーブル':'table'}: ${tbl})\n\n#### ${G?'一覧取得':'List'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').select('*').range(0, 19).order('created_at', { ascending: false })\n\`\`\`\n\n#### ${G?'詳細取得':'Get by ID'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').select('*').eq('id', id).single()\n\`\`\`\n\n#### ${G?'作成':'Create'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').insert({ ${allInsert} }).select()\n\`\`\`\n\n#### ${G?'更新':'Update'}\n\`\`\`ts\nconst { data } = await supabase.from('${tbl}').update({ ${insertObj} }).eq('id', id).select()\n\`\`\`\n\n#### ${G?'削除':'Delete'}\n\`\`\`ts\nawait supabase.from('${tbl}').delete().eq('id', id)\n\`\`\``;
}
return `\n### ${e}\n- SDK: \`${sdkName}\`\n- ${G?'CRUD操作はSDK経由で実行':'CRUD via SDK calls'}`;
}).join('\n');
} else {
apiEndpoints=entities.map(e=>{
const lower=e.toLowerCase().replace(/\s/g,'_');
const cols=getEntityColumns(e,G,entities);
const bodyFields=cols.filter(c=>!c.col.endsWith('_at')&&!c.constraint.includes('DEFAULT NOW')).slice(0,5);
const bodyObj=bodyFields.length?bodyFields.map(c=>`"${c.col}": "${c.type.includes('INT')?'number':c.type.includes('BOOLEAN')?'boolean':'string'}"`).join(', '):`"name": "string"`;
const methods=getEntityMethods(e);
const parts=[`\n### /api/v1/${lower}`];
if(methods.includes('GET')) parts.push(`\n#### GET /api/v1/${lower}\n- ${G?'説明':'Desc'}: ${G?e+'一覧取得 (ページネーション対応)':'List '+e+' (paginated)'}\n- クエリ: \`?page=1&limit=20&sort=created_at&order=desc\`\n- レスポンス:\n\`\`\`json\n{ "data": [{ "id": "uuid", ${bodyObj} }], "meta": { "total": 100, "page": 1 } }\n\`\`\`\n- ${G?'ステータス':'Status'}: 200 / 401 / 500`);
if(methods.includes('GET/:id')) parts.push(`\n#### GET /api/v1/${lower}/:id\n- ${G?'説明':'Desc'}: ${G?e+'詳細取得':'Get '+e+' detail'}\n- ${G?'ステータス':'Status'}: 200 / 404`);
if(methods.includes('POST')) parts.push(`\n#### POST /api/v1/${lower}\n- ${G?'リクエスト':'Request'}: \`{ ${bodyObj} }\`\n- ${G?'ステータス':'Status'}: 201 / 400 / 422`);
if(methods.includes('PUT/:id')) parts.push(`\n#### PUT /api/v1/${lower}/:id\n- ${G?'リクエスト':'Request'}: \`{ ${bodyObj} }\`\n- ${G?'ステータス':'Status'}: 200 / 404 / 422`);
if(methods.includes('PATCH/:id')||methods.includes('PATCH')) parts.push(`\n#### PATCH /api/v1/${lower}${methods.includes('PATCH/:id')?'/:id':''}\n- ${G?'リクエスト':'Request'}: \`{ ${bodyObj} }\`\n- ${G?'ステータス':'Status'}: 200 / 404 / 422`);
if(methods.includes('DELETE/:id')) parts.push(`\n#### DELETE /api/v1/${lower}/:id\n- ${G?'ステータス':'Status'}: 204 / 404`);
return parts.join('');
}).join('\n');
}
// 6. Screen Design (intelligent flow + component details)
const sNodes=screens.map((s,i)=>` S${i}["${s}"]`).join('\n');
// Build intelligent screen flow based on screen types
const sLinks=[];
const sIdx={};screens.forEach((s,i)=>sIdx[s]=i);
const findScreen=(pattern)=>screens.findIndex(s=>new RegExp(pattern,'i').test(s));
const landingIdx=findScreen('ランディング|landing|LP|トップ|home');
const loginIdx=findScreen('ログイン|login|サインイン');
const registerIdx=findScreen('新規登録|register|signup');
const dashIdx=findScreen('ダッシュボード|dashboard');
const settingsIdx=findScreen('設定|setting|プロフィール|profile');
const adminIdx=findScreen('管理|admin');
const paymentIdx=findScreen('決済|payment|billing|checkout|課金');
const detailIdx=findScreen('詳細|detail|コース|course|商品|product');
// Auth flow: landing → login → dashboard
if(landingIdx>=0&&dashIdx>=0) sLinks.push(` S${landingIdx} --> S${dashIdx}`);
// Dashboard as hub
screens.forEach((s,i)=>{
if(i===landingIdx||i===dashIdx) return;
const isPublic=/ランディング|landing|LP|ログイン|login|register|登録|料金|pricing|about|概要|terms|利用規約|contact|お問い合わせ/i.test(s);
const isAdmin=/管理|admin/i.test(s);
if(!isPublic&&dashIdx>=0){
if(isAdmin){
sLinks.push(` S${dashIdx} -->|${G?'管理者のみ':'admin only'}| S${i}`);
} else {
sLinks.push(` S${dashIdx} --> S${i}`);
}
// Bidirectional for main sections
if(/設定|setting|プロフィール|profile|詳細|detail|コース|course/i.test(s)) sLinks.push(` S${i} --> S${dashIdx}`);
}
});
// Purchase flow: detail → payment
if(detailIdx>=0&&paymentIdx>=0) sLinks.push(` S${detailIdx} --> S${paymentIdx}`);
// Fallback: if no links generated, use simple chain
if(!sLinks.length){
screens.forEach((s,i)=>{if(i<screens.length-1) sLinks.push(` S${i} --> S${i+1}`);});
}
// 7. Test Cases (feature-specific when available)
const testMatrix=features.map(f=>{
const fd=getFeatureDetail(f);
const header=`\n### ${f}\n| # | ${G?'ケース':'Case'} | ${G?'種別':'Type'} | ${G?'期待結果':'Expected'} | ${G?'優先度':'Priority'} |\n|---|--------|------|----------|--------|`;
if(fd){
const tests=G?fd.tests_ja:fd.tests_en;
return header+'\n'+tests.map((t,i)=>{
const isErr=t[0].includes('異常')||t[0].includes('Error');
const type=isErr?'Error':'Normal';
const pri=i<2?'P0':'P1';
return `| ${i+1} | ${t[0]} | ${type} | ${t[1]} | ${pri} |`;
}).join('\n');
}
return header+`\n| 1 | ${G?'正常系: 基本操作':'Normal: Basic op'} | Normal | 200/201 ${G?'成功':'OK'} | P0 |\n| 2 | ${G?'正常系: 境界値':'Normal: Boundary'} | Boundary | ${G?'正常処理':'OK'} | P1 |\n| 3 | ${G?'異常系: 必須項目欠落':'Error: Missing field'} | Error | 422 ${G?'バリデーションエラー':'Validation Error'} | P0 |\n| 4 | ${G?'異常系: 権限不足':'Error: No permission'} | Auth | 401/403 | P0 |\n| 5 | ${G?'異常系: 不正フォーマット':'Error: Bad format'} | Error | 400 Bad Request | P1 |\n| 6 | ${G?'異常系: 存在しないID':'Error: ID not found'} | Error | 404 Not Found | P1 |`;
}).join('\n');
// 9. Release Checklist (dynamic per deploy target)
const deployTarget=a.deploy||'Vercel';
const dChecks=G?{'Vercel':['Vercel環境変数設定','プレビューデプロイ動作確認','カスタムドメインDNS設定','Edge Functions設定'],'AWS':['IAMロール・ポリシー確認','RDSセキュリティグループ設定','CloudFront設定','Route53 DNS設定'],'Railway':['Railway環境変数設定','PostgresDB接続確認','カスタムドメイン設定','自動デプロイ有効化'],'Netlify':['Netlify環境変数設定','ビルドコマンド確認','カスタムドメインDNS設定','Netlify Functions設定'],'Fly.io':['Fly.io環境変数(fly secrets)','fly.toml設定確認','ヘルスチェック設定','カスタムドメインCERT設定'],'Cloudflare':['Cloudflare環境変数設定','Pages/Workers設定','カスタムドメインDNS設定','KV/D1接続確認']}:{'Vercel':['Vercel env vars','Preview deploy check','Custom domain DNS','Edge Functions config'],'AWS':['IAM roles/policies','RDS security groups','CloudFront config','Route53 DNS'],'Railway':['Railway env vars','Postgres connection','Custom domain','Auto-deploy enabled'],'Netlify':['Netlify env vars','Build command check','Custom domain DNS','Netlify Functions config'],'Fly.io':['Fly.io secrets','fly.toml config','Health check setup','Custom domain CERT'],'Cloudflare':['Cloudflare env vars','Pages/Workers config','Custom domain DNS','KV/D1 connection']};
const deployChecks=dChecks[deployTarget]||dChecks[Object.keys(dChecks).find(k=>deployTarget.includes(k))]||dChecks['Vercel'];
const dbName=a.database||'PostgreSQL';
const dbChecks=dbName.includes('Supa')?(G?['Supabase RLS有効化','API Key設定','接続プール設定']:['Supabase RLS enabled','API Key configured','Connection pool']):G?['マイグレーション実行確認','接続プール設定','バックアップ設定']:['Migration verified','Connection pool','Backup configured'];
// 10. Gantt (Mermaid)
const ganttTasks=features.map((f,i)=>{
const days=f.match(/Auth|認証/i)?5:f.match(/Admin|管理/i)?4:f.match(/Upload|ファイル/i)?3:3;
return ` ${f.replace(/[^a-zA-Z0-9ぁ-んァ-ヶー一-龠\s]/g,'')} :s${i}, ${i===0?'after ci':('after s'+(i-1))}, ${days}d`;
}).join('\n');
// 11. WBS (3-level + hours)
const wbsTasks=features.map((f,i)=>{
const h=f.match(/Auth|認証/i)?16:f.match(/Admin|管理/i)?12:f.match(/Upload|ファイル/i)?8:f.match(/CRUD|一覧/i)?6:8;
return `### 2.${i+1} ${f} (${h}h)\n- 2.${i+1}.1 ${G?'データモデル定義':'Data model'} (${Math.ceil(h*0.2)}h)\n- 2.${i+1}.2 ${G?'API実装':'API implementation'} (${Math.ceil(h*0.3)}h)\n- 2.${i+1}.3 ${G?'UI実装':'UI implementation'} (${Math.ceil(h*0.3)}h)\n- 2.${i+1}.4 ${G?'テスト':'Testing'} (${Math.ceil(h*0.2)}h)`;
}).join('\n\n');
const totalH=features.reduce((s,f)=>{const h=f.match(/Auth|認証/i)?16:f.match(/Admin|管理/i)?12:f.match(/Upload|ファイル/i)?8:f.match(/CRUD|一覧/i)?6:8;return s+h;},0);
// Prompt Playbook (C3: new)
S.files['docs/22_prompt_playbook.md']=`# ${pn} — ${G?'プロンプトプレイブック':'Prompt Playbook'}\n> ${date}\n\n${G?'## 使い方\n開発フェーズごとに、以下のプロンプトを順番にAI (Claude / Cursor) に投入してください。':'## Usage\nFeed these prompts to AI (Claude / Cursor) in order for each dev phase.'}\n\n${G?'## Phase 0: 戦略レビュー\n\n### 0-1. 業界ブループリント確認\n```\ndocs/48_industry_blueprint.md を読み、以下を確認してください:\n- 規制要件とコンプライアンス対応\n- 業界固有のアーキテクチャパターン\n- 主要失敗要因と予防策\n```\n\n### 0-2. ステークホルダー戦略\n```\ndocs/50_stakeholder_strategy.md を読み、以下を確認してください:\n- 開発フェーズ戦略（MVP→Growth→Scale）\n- チーム構成と役割分担\n- 技術的負債の管理方針\n```\n\n':'## Phase 0: Strategic Review\n\n### 0-1. Industry Blueprint Review\n```\nRead docs/48_industry_blueprint.md and confirm:\n- Regulatory requirements and compliance needs\n- Industry-specific architecture patterns\n- Key failure factors and prevention strategies\n```\n\n### 0-2. Stakeholder Strategy\n```\nRead docs/50_stakeholder_strategy.md and confirm:\n- Development phase strategy (MVP→Growth→Scale)\n- Team composition and roles\n- Technical debt management policy\n```\n\n'}## Phase 1: ${G?'プロジェクトセットアップ':'Project Setup'}\n\n### 1-1. ${G?'初期環境構築':'Initial Setup'}\n\`\`\`\n${G?'以下の技術スタックでプロジェクトの初期セットアップを行ってください。':'Set up the project with the following tech stack.'}\n- Frontend: ${fe}\n- Backend: ${be}\n
- DB: ${dbName}\n- Deploy: ${deployTarget}\n${G?'package.json, tsconfig.json, .env.example を生成してください。':'Generate package.json, tsconfig.json, .env.example.'}\n\`\`\`\n\n### 1-2. ${G?'データモデル定義':'Data Model'}\n\`\`\`\n${G?'以下のエンティティの'+orm+'スキーマを生成してください:':'Generate '+orm+' schema for these entities:'} ${entities.join(', ')}\n${entities.map(e=>{const cols=getEntityColumns(e,G,entities);if(!cols.length) return '';return e+': '+cols.map(c=>c.col+'('+c.type+')').join(', ');}).filter(Boolean).join('\n')}\n${G?'各エンティティにはid, created_at, updated_atを含め、リレーションも定義してください。':'Include id, created_at, updated_at for each entity with relations.'}\n
\`\`\`\n\n## Phase 2: ${G?'コア機能開発':'Core Development'}\n\n${features.map((f,i)=>{const fd=getFeatureDetail(f);const criteriaLines=fd?(G?fd.criteria_ja:fd.criteria_en).map(c=>' - '+c.replace(/\{auth\}/g,a.auth||'OAuth')).join('\n'):'';return `### 2-${i+1}. ${f}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'フルスタック開発者 (Frontend + Backend)':'Full-stack developer (Frontend + Backend)'}\n\n${G?f+'機能を実装してください。':'Implement '+f+'.'}\n- ${arch.isBaaS?(G?'データアクセス: '+orm+'でCRUDを実装':'Data access: Implement CRUD with '+orm):(G?'APIエンドポイント: /api/v1/ にCRUDを作成':'API endpoint: Create CRUD at /api/v1/')}\n- ${G?'UIコンポーネント: '+fe+'で画面を実装':'UI component: Build screen with '+fe}\n- ${G?'バリデーション: zodスキーマで入力検証':'Validation: zod schema for input'}\n- ${G?'テスト: Vitestでユニットテスト作成':'Test: Write unit tests with Vitest'}${criteriaLines?'\n\n'+(G?'受入条件:':'Acceptance Criteria:')+'\n'+criteriaLines:''}\n\n${G?'docs/39_implementation_playbook.mdのドメインパターンを参照してください。':'Reference domain patterns in docs/39_implementation_playbook.md.'}\n\n**${G?'出力形式':'Output Format'}**: ${G?'ファイルパス付きコードブロック。テストを含めること。':'Code blocks with file paths. Include tests.'}\n\`\`\``}).join('\n\n')}\n\n
## Phase 3: ${G?'テスト・デプロイ':'Test & Deploy'}\n\n### 3-1. ${G?'E2Eテスト':'E2E Tests'}\n\`\`\`\n${G?'Playwrightで以下の画面のE2Eテストを作成してください:':'Create Playwright E2E tests for these screens:'} ${screens.join(', ')}\n${G?'正常系・異常系の両方をカバーしてください。':'Cover both happy and error paths.'}\n\`\`\`\n\n### 3-2. ${G?'デプロイ設定':'Deploy Config'}\n\`\`\`\n${G?deployTarget+'へのデプロイ設定を行ってください。':'Configure deployment to '+deployTarget+'.'}\n- CI/CD: GitHub Actions\n
- ${G?'環境変数: .env.exampleに基づいて設定':'Env vars: Based on .env.example'}\n- ${G?'プレビューデプロイの設定も含めてください。':'Include preview deploy config.'}\n\`\`\`\n\n### 3-3. ${G?'セキュリティ監査':'Security Audit'}\n\`\`\`\n**Role**: ${G?'セキュリティエンジニア':'Security Engineer'}\n\n${G?'以下のセキュリティドキュメントを参照し、プロジェクトのセキュリティ監査を実施してください:':'Reference these security documents and audit the project:'}\n- docs/43_security_intelligence.md (OWASP Top 10)\n- docs/44_threat_model.md (STRIDE)\n- docs/45_compliance_matrix.md\n- docs/46_ai_security.md (${G?'敵対的プロンプト使用':'Use adversarial prompts'})\n- docs/47_security_testing.md (${G?'テスト実行':'Execute tests'})\n\n${G?'重点チェック:':'Focus areas:'}\n1. ${G?'認可ロジック (RLS/ミドルウェア)':'Authorization logic (RLS/middleware)'}\n2. ${G?'入力バリデーション':'Input validation'}\n3. ${G?'シークレット管理':'Secrets management'}\n\`\`\`\n\n## Phase 4: ${G?'イテレーション':'Iteration'}\n\n### 4-1. ${G?'バグ修正':'Bug Fix'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'デバッガー兼フルスタック開発者':'Debugger & Full-stack developer'}\n\n${G?'以下のエラーを修正してください。':'Fix the following error.'}\n\n[${G?'エラー内容を貼り付け':'Paste error here'}]\n\n${G?'手順':'Steps'}:\n1. docs/25_error_logs.md ${G?'を参照し、既知の問題か確認':'to check if it is a known issue'}\n2. ${G?'根本原因を特定':'Identify root cause'}\n3. ${G?'修正とテストを実装':'Implement fix and tests'}\n4. docs/25_error_logs.md ${G?'にエラーを記録':'to log the error'}\n\n**${G?'出力形式':'Output Format'}**: ${G?'修正パッチ (diff形式) + テスト + ログエントリ':'Fix patch (diff) + tests + log entry'}\n\`\`\`\n\n### 4-2. ${G?'機能追加':'Feature Addition'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'フルスタック開発者':'Full-stack developer'}\n\n${G?'以下の機能を追加してください。':'Add the following feature.'}\n\n[${G?'機能説明を記載':'Describe feature here'}]\n\n${G?'手順':'Steps'}:\n1. docs/23_tasks.md ${G?'を参照し、タスクを追加':'to add task'}\n2. .spec/constitution.md ${G?'の原則に準拠':'principles'}\n3. ${G?'コード + テストを実装':'Implement code + tests'}\n4. docs/24_progress.md ${G?'を更新':'to update progress'}\n\n**${G?'出力形式':'Output Format'}**: ${G?'ファイルパス付きコードブロック + タスクエントリ + 進捗更新':'Code blocks with file paths + task entry + progress update'}\n\`\`\`\n\n### 4-3. ${G?'品質チェック':'Quality Check'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'QAエンジニア':'QA Engineer'}\n\n${G?'品質チェック:':'Quality check:'}\n- docs/32_qa_blueprint.md ${G?'の品質ゲートを実施':'quality gates'}\n- docs/28_qa_strategy.md ${G?'のドメイン別バグパターンを確認':'domain-specific bug patterns'}\n\`\`\`\n\n### 4-4. ${G?'パフォーマンス検証':'Performance Check'}\n\`\`\`\n**${G?'Role':'Role'}**: ${G?'パフォーマンスエンジニア':'Performance Engineer'}\n\n${G?'パフォーマンス検証:':'Performance check:'}\n- docs/41_growth_intelligence.md ${G?'のCWV目標値と照合':'CWV targets'}\n- docs/19_performance.md ${G?'の最適化施策を適用':'optimization strategies'}\n\`\`\``;
// Task decomposition (D1: GitHub Issues style)
const taskList=[];
taskList.push({title:G?'環境構築':'Environment Setup',label:'setup',hours:3,desc:G?`${fe} + ${be} + ${dbName} のプロジェクト初期セットアップ`:`${fe} + ${be} + ${dbName} initial project setup`});
taskList.push({title:G?'DevContainer設定':'DevContainer Config',label:'infra',hours:2,desc:G?'開発環境のコンテナ化':'Containerize dev environment'});
features.forEach(f=>{
const h=f.match(/Auth|認証/i)?16:f.match(/Admin|管理/i)?12:f.match(/Upload|ファイル/i)?8:f.match(/CRUD|一覧/i)?6:8;
taskList.push({title:G?f+'の実装':f+' Implementation',label:'feature',hours:h,desc:G?`${f}のAPI・UI・テストを実装`:`Implement API, UI, and tests for ${f}`});
});
taskList.push({title:G?'E2Eテスト':'E2E Tests',label:'test',hours:6,desc:G?'Playwrightでの統合テスト':'Integration tests with Playwright'});
taskList.push({title:G?'パフォーマンス最適化':'Performance Optimization',label:'perf',hours:4,desc:G?'Lighthouse 90+目標':'Lighthouse 90+ target'});
taskList.push({title:G?'リリース準備':'Release Prep',label:'release',hours:3,desc:G?`${deployTarget}へのデプロイ・モニタリング設定`:`Deploy to ${deployTarget} & monitoring setup`});
S.files['docs/23_tasks.md']=`# ${pn} — ${G?'タスク一覧 (GitHub Issues形式)':'Task List (GitHub Issues)'}\n> ${date}\n\n${taskList.map((t,i)=>{
// Feature tasks: use domain-specific acceptance criteria from FEATURE_DETAILS
let acLines;
if(t.label==='feature'){
const featureName=t.title.replace(/(の実装| Implementation)/g,'');
const fd=getFeatureDetail(featureName);
if(fd){
const criteria=(G?fd.criteria_ja:fd.criteria_en).map(c=>c.replace(/\{auth\}/g,a.auth||'OAuth'));
acLines=criteria.map(c=>' - [ ] '+c).join('\n');
}
}
if(!acLines){
acLines=` - [ ] ${G?'実装完了':'Implementation done'}\n - [ ] ${G?'テスト通過':'Tests passing'}\n - [ ] ${G?'コードレビュー完了':'Code review done'}`;
}
return `## Issue #${i+1}: ${t.title}\n- **${G?'ラベル':'Label'}**: \`${t.label}\`\n- **${G?'見積り':'Estimate'}**: ${t.hours}h\n- **${G?'説明':'Description'}**: ${t.desc}\n- **Acceptance Criteria**:\n${acLines}`;
}).join('\n\n')}\n\n---\n
**${G?'合計タスク数':'Total Tasks'}**: ${taskList.length} | **${G?'総見積り':'Total Est.'}**: ${taskList.reduce((s,t)=>s+t.hours,0)}h`;
const cspExamples=fe.includes('Next')?`**Next.js** (next.config.js):
\`\`\`js
module.exports = {
async headers() {
return [{
source: '/(.*)',
headers: [{
key: 'Content-Security-Policy',
value: "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https:; connect-src 'self' https://*.supabase.co; object-src 'none'; base-uri 'self';"
}]
}];
}
};
\`\`\``:`**Express.js** (helmet):
\`\`\`js
const helmet = require('helmet');
app.use(helmet.contentSecurityPolicy({
directives: {
defaultSrc: ["'self'"],
scriptSrc: ["'self'"],
styleSrc: ["'self'", "'unsafe-inline'"],
imgSrc: ["'self'", "data:", "https:"],
connectSrc: ["'self'"],
objectSrc: ["'none'"],
baseUri: ["'self'"]
}
}));
\`\`\``;
const corsExamples=fe.includes('Next')?`**Next.js API Routes**:
\`\`\`js
export default function handler(req, res) {
res.setHeader('Access-Control-Allow-Origin', process.env.ALLOWED_ORIGINS || '*');
res.setHeader('Access-Control-Allow-Methods', 'GET,POST,PUT,PATCH,DELETE');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type,Authorization');
if (req.method === 'OPTIONS') return res.status(200).end();
// ... handler logic
}
\`\`\``:`**Express.js** (cors):
\`\`\`js
const cors = require('cors');
const corsOptions = {
origin: process.env.ALLOWED_ORIGINS?.split(',') || '*',
credentials: true,
optionsSuccessStatus: 200
};
app.use(cors(corsOptions));
\`\`\``;
const rateLimitExamples=fe.includes('Next')?`**Next.js** (upstash/ratelimit):
\`\`\`js
import { Ratelimit } from '@upstash/ratelimit';
import { Redis } from '@upstash/redis';
const ratelimit = new Ratelimit({
redis: Redis.fromEnv(),
limiter: Ratelimit.slidingWindow(10, '10 s')
});
export default async function handler(req, res) {
const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress;
const { success } = await ratelimit.limit(ip);
if (!success) return res.status(429).json({ error: 'Too many requests' });
// ... handler logic
}
\`\`\``:`**Express.js** (express-rate-limit):
\`\`\`js
const rateLimit = require('express-rate-limit');
const limiter = rateLimit({
windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS) || 60000,
max: parseInt(process.env.RATE_LIMIT_MAX) || 100,
message: 'Too many requests from this IP',
standardHeaders: true,
legacyHeaders: false
});
app.use('/api/', limiter);
\`\`\``;
const docTemplates=[
['05_api_design',G?(arch.isBaaS?'データアクセス設計書 (SDK)':'API設計書 (OpenAPI準拠)'):(arch.isBaaS?'Data Access Design (SDK)':'API Design (OpenAPI)'),`${G?'## 認証':'## Authentication'}\n- ${G?'方式':'Method'}: ${auth.tokenType}\n- ${arch.isBaaS?(G?'アクセス方式: '+orm+' SDK':'Access: '+orm+' SDK'):'ヘッダー: \\`Authorization: Bearer <token>\\`'}\n\n${arch.isBaaS?'':(G?'## 共通レスポンス':'## Common Responses')+'\\n| '+(G?'ステータス':'Status')+' | '+(G?'意味':'Meaning')+' |\\n|-----------|------|\\n| 200 | OK |\\n| 201 | Created |\\n| 400 | Bad Request |\\n| 401 | Unauthorized |\\n| 403 | Forbidden |\\n| 404 | Not Found |\\n| 422 | Validation Error |\\n| 500 | Internal Error |\\n\\n'}\n${G?(arch.isBaaS?'## データアクセスパターン':'## エンドポイント一覧'):(arch.isBaaS?'## Data Access Patterns':'## Endpoints')}\n${apiEndpoints}`],
['06_screen_design',G?'画面設計書 & 画面遷移図':'Screen Design & Flow',`${G?'## 画面遷移図':'## Screen Flow'}\n\n\`\`\`mermaid\nflowchart LR\n${sNodes}\n${sLinks.join('\n')}\n\`\`\`\n\n${G?'## 画面一覧':'## Screen List'}\n${screens.map((s,i)=>{const isPublic=s.match(/ログイン|Login|Register|登録|ランディング|Landing|LP|トップ|Top|ホーム|Home|About|概要|利用規約|Terms|料金|Pricing|お問い合わせ|Contact/i);const comps=getScreenComponents(s,G);const compList=comps?'\n- '+(G?'主要コンポーネント':'Key Components')+':\n'+comps.map(c=>' - '+c).join('\n'):'\n- '+(G?'コンポーネント':'Components')+': Header, '+(isPublic?'':'Sidebar, ')+'Content, Footer';return `\n### ${i+1}. ${s}\n- URL: \`${(genRoutes(a).find(r=>r.name===s.replace(/\(P[0-2]\)/gi,'').trim())||{path:'/'+(s.toLowerCase().replace(/[^a-z0-9]/g,'-'))}).path}\`\n- ${G?'認証':'Auth'}: ${isPublic?(G?'不要':'Not required'):(G?'必要':'Required')}${compList}`;}).join('\n')}`],
['07_test_cases',G?'テストケース定義書':'Test Cases',`${G?'## テスト戦略':'## Test Strategy'}\n- ${G?'ユニット':'Unit'}: Vitest (80%+)\n- E2E: Playwright\n- ${G?'コンポーネント':'Component'}: Testing Library\n\n${G?'## テストケースマトリクス':'## Test Case Matrix'}\n${testMatrix}\n\n${G?'## 実行コマンド':'## Run Commands'}\n\`\`\`bash\nnpm run test\nnpm run test:e2e\nnpm run test:coverage\n\`\`\``],
['08_security',G?'セキュリティ設計書':'Security Design',`${G?'## セキュリティ対策':'## Security Measures'}\n- ${G?'認証':'Auth'}: ${auth.sot}\n- HTTPS${G?'必須':' required'}\n- CSP (Content Security Policy)\n- CORS (Cross-Origin Resource Sharing)\n- Rate Limiting\n- Input Validation${hasAdmin?'\n\n'+(G?'## RBAC（ロールベースアクセス制御）':'## RBAC (Role-Based Access Control)')+'\n\n| '+(G?'ロール':'Role')+' | '+(G?'権限':'Permissions')+' |\n|--------|----------|\n| user | '+(G?'自分のデータの読取・更新':'Read/update own data')+' |\n'+(hasInstructor?'| instructor | '+(G?'コンテンツ作成・編集・自分の受講者管理':'Create/edit content, manage own students')+' |\n':'')+'| admin | '+(G?'全データの読取・更新・削除、ユーザー管理、システム設定':'Full CRUD, user management, system settings')+' |\n\n'+(G?'### RBACポリシー実装':'### RBAC Policy Implementation')+'\n- profiles.role '+(G?'カラムでロール管理':'column for role management')+'\n- '+(arch.isBaaS&&be.includes('Supabase')?'RLS: auth.uid() = user_id AND role check via profiles':'Middleware: role check before protected routes')+'\n- '+(G?'管理画面ルート':'Admin routes')+': /admin/ → role=admin '+(G?'チェック必須':'check required'):''}${hasPay&&(a.payment||'').includes('Stripe')?'\n\n'+(G?'## 決済セキュリティ':'## Payment Security')+'\n- Stripe Webhook '+(G?'署名検証':'signature verification')+' (STRIPE_WEBHOOK_SECRET)\n- '+(G?'冪等キーによる重複処理防止':'Idempotency key for duplicate prevention')+'\n- PCI DSS '+(G?'準拠':'compliance')+' (Stripe Elements '+(G?'使用で対応':'handles this')+')\n- '+(G?'サーバーサイドのみで':'Server-side only for')+' stripe.customers / stripe.subscriptions '+(G?'操作':'operations'):''}\n\n${G?'## CSPヘッダー設定例':'## CSP Header Examples'}\n\n${cspExamples}\n\n${G?'## CORS設定例':'## CORS Configuration Examples'}\n\n${corsExamples}\n\n${G?'## レート制限実装例':'## Rate Limiting Implementation'}\n\n${rateLimitExamples}`],
['09_release_checklist',G?'リリースチェックリスト':'Release Checklist',`## ${G?'デプロイ先':'Deploy Target'}: ${deployTarget}\n\n### 1. ${G?'コード品質':'Code Quality'}\n${(G?['TypeScript 型エラー 0件','ESLint エラー 0件','全テストパス','カバレッジ 80%+']:['TypeScript: 0 type errors','ESLint: 0 errors','All tests pass','Coverage 80%+']).map(c=>'- [ ] '+c).join('\n')}\n\n### 2. ${G?'セキュリティ':'Security'}\n
${(G?['環境変数にシークレット未ハードコード','CORS設定','CSP設定','認証・認可テスト完了']:['No hardcoded secrets in env vars','CORS config','CSP config','Auth/authz tests done']).map(c=>'- [ ] '+c).join('\n')}\n\n### 3. ${G?'インフラ':'Infrastructure'} (${deployTarget})\n${deployChecks.map(c=>'- [ ] '+c).join('\n')}\n\n### 4. ${G?'データベース':'Database'} (${dbName})\n${dbChecks.map(c=>'- [ ] '+c).join('\n')}\n\n### 5. ${G?'パフォーマンス':'Performance'}\n
${(G?['Lighthouse 90+','LCP < 2.5s','画像最適化','バンドルサイズ確認']:['Lighthouse 90+','LCP < 2.5s','Image optimization','Bundle size check']).map(c=>'- [ ] '+c).join('\n')}\n\n### 6. ${G?'モニタリング':'Monitoring'}\n${(G?['Sentry設定','アクセスログ','アラート閾値']:['Sentry setup','Access logs','Alert thresholds']).map(c=>'- [ ] '+c).join('\n')}`],
['10_gantt',G?'ガントチャート':'Gantt Chart',`${G?'## プロジェクトスケジュール':'## Project Schedule'}\n\n\`\`\`mermaid\ngantt\n title ${pn} ${G?'開発スケジュール':'Development Schedule'}\n dateFormat YYYY-MM-DD\n axisFormat %m/%d\n section Sprint 0\n ${G?'プロジェクトセットアップ':'Project Setup'} :env, ${ganttStart}, 2d\n ${G?'DevContainer構築':'DevContainer Setup'} :dc, after env, 1d\n ${G?'CI/CD設定':'CI/CD Setup'} :ci, after dc, 1d\n section Sprint 1-2\n${ganttTasks}\n section Sprint 3\n
${G?'E2Eテスト':'E2E Tests'} :test, after s${features.length-1}, 3d\n ${G?'パフォーマンス最適化':'Perf Optimization'} :perf, after test, 2d\n ${G?'リリース':'Release'} :rel, after perf, 1d\n\`\`\`\n\n${G?'## マイルストーン':'## Milestones'}\n| MS | ${G?'目標':'Goal'} | ${G?'成果物':'Deliverable'} |\n|----|------|--------|\n| Alpha | Sprint 1 ${G?'完了':'done'} | ${G?'コア機能動作':'Core features working'} |\n| Beta | Sprint 2 ${G?'完了':'done'} | ${G?'全機能実装':'All features implemented'} |\n
| RC | Sprint 3 ${G?'中盤':'mid'} | ${G?'テスト完了':'Tests complete'} |\n| GA | Sprint 3 ${G?'末':'end'} | ${G?'本番リリース':'Production release'} |`],
['11_wbs',G?'WBS (作業分解構造)':'WBS (Work Breakdown)',`${G?'## WBS — 総工数:':'## WBS — Total Hours:'} 約${totalH+26}h\n\n### 1. ${G?'プロジェクト管理':'Project Management'} (8h)\n- 1.1 ${G?'要件定義・SDD作成':'Requirements & SDD'} (3h)\n- 1.2 ${G?'技術選定・環境構築':'Tech selection & setup'} (3h)\n- 1.3 ${G?'進捗管理・レビュー':'Progress mgmt & review'} (2h)\n\n## 2. ${G?'機能開発':'Feature Development'} (${totalH}h)\n\n${wbsTasks}\n\n### 3. ${G?'テスト':'Testing'} (12h)\n- 3.1 ${G?'ユニットテスト':'Unit tests'} (4h)\n
- 3.2 ${G?'E2Eテスト':'E2E tests'} (4h)\n- 3.3 ${G?'バグ修正':'Bug fixes'} (4h)\n\n### 4. ${G?'デプロイ':'Deploy'} (6h)\n- 4.1 ${G?'ステージング構築':'Staging setup'} (2h)\n- 4.2 ${G?'本番デプロイ':'Production deploy'} (2h)\n- 4.3 ${G?'モニタリング設定':'Monitoring setup'} (2h)`],
['12_driven_dev',G?'駆動開発ガイド':'Dev Methods Guide',`${G?'## 採用手法':'## Methods Used'}\n${methods.map(m=>`\n### ${m}\n- ${G?'適用範囲: 全Sprint':'Scope: All sprints'}\n- ${G?'実践ルール: .spec/ に準拠':'Rule: Follow .spec/'}`).join('\n')}`],
['13_glossary',G?'用語集':'Glossary',`${G?'## 用語定義':'## Terms'}\n${entities.map(e=>`| ${e} | ${G?pn+'における'+e+'データ':e+' data in '+pn} |`).join('\n')}`],
['14_risk',G?'リスク管理表':'Risk Management',`${G?'## リスク一覧':'## Risk List'}\n| ${G?'リスク':'Risk'} | ${G?'影響度':'Impact'} | ${G?'対策':'Mitigation'} |\n|--------|--------|------|\n| ${G?'技術的負債':'Tech debt'} | ${G?'高':'High'} | ${G?'コードレビュー必須':'Mandatory code review'} |\n| ${G?'スケジュール遅延':'Schedule delay'} | ${G?'中':'Mid'} | ${G?'バッファ設定':'Buffer planning'} |\n| ${G?'セキュリティ':'Security'} | ${G?'高':'High'} | ${G?'定期監査':'Regular audit'} |`],
['15_meeting',G?'議事録テンプレート':'Meeting Notes Template',`${G?'## 議事録':'## Meeting Notes'}\n- ${G?'日時':'Date'}:\n- ${G?'参加者':'Attendees'}:\n- ${G?'アジェンダ':'Agenda'}:\n- ${G?'決定事項':'Decisions'}:\n- ${G?'次回アクション':'Next Actions'}:`],
['16_review',G?'コードレビューガイド':'Code Review Guide',`${G?'## レビュー基準':'## Review Criteria'}\n1. TypeScript strict ${G?'モード準拠':'mode'}\n2. ${G?'テスト付き':'With tests'}\n3. ${G?'.spec/ との整合性':'.spec/ alignment'}\n4. ${G?'パフォーマンス考慮':'Performance'}\n5. ${G?'セキュリティチェック':'Security check'}`],
['17_monitoring',G?'監視設計書':'Monitoring Design',`${G?'## 監視項目':'## Monitoring Items'}\n- ${G?'アプリケーションログ':'Application logs'}\n- ${G?'エラーレート':'Error rate'}\n- ${G?'レスポンスタイム':'Response time'}\n- CPU/${G?'メモリ使用率':'Memory usage'}\n\n${G?'## ツール':'## Tools'}\n- ${deployTarget.includes('Vercel')?'Vercel Analytics':deployTarget.includes('Netlify')?'Netlify Analytics':'PostHog / Plausible Analytics'}\n- Sentry (${G?'エラー追跡':'Error tracking'})${arch.isBaaS&&be.includes('Supabase')?'\n- Supabase Dashboard ('+( G?'DB監視・RLS監査':'DB monitoring & RLS audit')+')':''}`],
['18_data_migration',G?'データ移行計画書':'Data Migration Plan',`${G?'## 移行戦略':'## Migration Strategy'}\n- ${G?'段階的移行':'Phased migration'}\n- ${G?'ロールバック計画':'Rollback plan'}\n- ${G?'データ検証手順':'Data validation'}`],
['19_performance',G?'パフォーマンス設計書':'Performance Design',`${G?'## 目標値':'## Targets'}\n- LCP: < 2.5s\n- FID: < 100ms\n- CLS: < 0.1\n\n${G?'## 最適化施策':'## Optimizations'}\n- ${G?'画像最適化':'Image optimization'} (${fe.includes('Next')?'next/image':fe.includes('Vite')||fe.includes('SPA')?'vite-imagetools / sharp':'sharp / imagemin'})\n- Code Splitting${fe.includes('Vite')||fe.includes('SPA')?' (Vite dynamic import)':fe.includes('Next')?' (Next.js dynamic)':''}\n- ${deployTarget.includes('Vercel')||deployTarget.includes('Netlify')?'Edge Caching (CDN)':'CDN Caching'}`],
['20_a11y',G?'アクセシビリティ設計書':'Accessibility Design',`## WCAG 2.1 AA\n- ${G?'キーボードナビゲーション':'Keyboard navigation'}\n- ${G?'スクリーンリーダー対応':'Screen reader support'}\n- ${G?'カラーコントラスト比':'Color contrast ratio'} 4.5:1+\n- ${G?'フォーカス管理':'Focus management'}`],
['21_changelog',G?'変更履歴':'Changelog',`## v1.0.0 (${date})\n- ${G?'初期リリース':'Initial release'}\n- ${features.slice(0,3).join(', ')} 実装\n\n## ${G?'DevForge v9による自動生成':'Auto-generated by DevForge v9'}\n- ${G?'88+ファイル生成':'88+ files generated'}\n- ${G?'11の柱対応':'11 pillars support'}\n- ${G?'Mermaid図・プロンプトプレイブック・タスク分解対応':'Mermaid diagrams, Prompt Playbook, Task decomposition'}`],
['24_progress',G?'進捗管理表':'Progress Tracker',
`${G?'> AIエージェントはタスク完了後にこのファイルを更新してください。':
'> AI agents should update this file after completing each task.'}
## ${G?'凡例':'Legend'}
- [ ] ${G?'未着手':'Not started'} / [x] ${G?'完了':'Done'}
## Sprint 0: ${G?'環境構築':'Setup'}
- [ ] ${G?'リポジトリ初期化':'Repo init'}
- [ ] DevContainer ${G?'構築':'setup'}
- [ ] CI/CD
- [ ] ${G?'DBスキーマ':'DB schema'}
- [ ] ${G?'認証基盤':'Auth'} (${auth.sot})
## Sprint 1-2: ${G?'機能開発':'Features'}
${features.map(f=>'- [ ] '+f).join('\n')}
## Sprint 3: ${G?'テスト・リリース':'Test & Release'}
- [ ] ${G?'テスト 80%+':'Tests 80%+'}
- [ ] E2E
- [ ] ${G?'パフォーマンス最適化':'Perf optimization'}
- [ ] ${G?'本番デプロイ':'Production deploy'}
## ${G?'サマリー':'Summary'}
| ${G?'フェーズ':'Phase'} | ${G?'完了':'Done'} | ${G?'合計':'Total'} |
|---|---|---|
| Sprint 0 | 0 | 5 |
| Sprint 1-2 | 0 | ${features.length} |
| Sprint 3 | 0 | 4 |
## ${G?'更新履歴':'Log'}
| ${G?'日付':'Date'} | ${G?'内容':'Update'} | ${G?'更新者':'By'} |
|---|---|---|
| ${date} | ${G?'初期生成':'Initial'} | DevForge |`],
['25_error_logs',G?'エラーログ':'Error Logs',
`${G?'> 解決済みエラーをここに記録し、再発を防いでください。':
'> Log resolved errors here to prevent recurrence.'}
## ${G?'記録フォーマット':'Format'}
### [${G?'日付':'Date'}] ${G?'エラー概要':'Summary'}
- **${G?'症状':'Symptom'}**:
- **${G?'原因':'Cause'}**:
- **${G?'解決策':'Fix'}**:
- **${G?'防止策':'Prevention'}**:
- **${G?'ファイル':'Files'}**: \`path/to/file\`
---
## ${G?'記録例':'Example'}
### [${date}] ${arch.isBaaS?(G?'RLSポリシーエラー':'RLS Policy Error'):(G?'API認証エラー':'API Auth Error')}
- **${G?'症状':'Symptom'}**: ${arch.isBaaS?(G?'INSERT時に403':'403 on INSERT'):(G?'401 Unauthorized':'401 Unauthorized')}
- **${G?'原因':'Cause'}**: ${arch.isBaaS?(G?'auth.uid()チェック不足':'Missing auth.uid() check'):(G?'トークン検証ミドルウェア未適用':'Missing auth middleware')}
- **${G?'解決策':'Fix'}**: ${arch.isBaaS?'\\`WITH CHECK (auth.uid() = user_id)\\`':'\\`app.use(authMiddleware)\\`'}
- **${G?'防止策':'Prevention'}**: ${arch.isBaaS?(G?'新テーブルには必ずRLSテンプレート適用':'Always apply RLS template for new tables'):(G?'新ルートには必ずauthMiddleware適用':'Always apply authMiddleware to new routes')}
---
## ${G?'パターン別':'By Pattern'}
### ${G?'認証・認可':'Auth'}
_(${G?'追記してください':'Add entries here'})_
### ${G?'データベース':'Database'}
_(${G?'追記してください':'Add entries here'})_
### ${G?'デプロイ':'Deploy'}
_(${G?'追記してください':'Add entries here'})_`],
['28_qa_strategy',G?'QA戦略・バグ検出ガイド':'QA Strategy & Bug Detection Guide',(()=>{
const domain=detectDomain(a.purpose);
const qa=domain?getDomainQA(domain,G):null;
if(qa){
const priObj={};qa.priority.split('|').forEach(p=>{const[k,v]=p.split(':');priObj[k]=v;});
return `${G?'## 対象ドメイン':'## Target Domain'}\n**${domain}**\n\n${G?'💡 **詳細なQA戦略は `docs/32_qa_blueprint.md` と `docs/33_test_matrix.md` を参照**':'💡 **See `docs/32_qa_blueprint.md` and `docs/33_test_matrix.md` for detailed QA strategies**'}\n\n${G?'## QA重点領域':'## QA Focus Areas'}\n${qa.focus.map((f,i)=>`${i+1}. ${f}`).join('\n')}\n\n${G?'## よくあるバグパターン':'## Common Bug Patterns'}\n${qa.bugs.map((b,i)=>`- **${G?'パターン':'Pattern'} ${i+1}**: ${b}`).join('\n')}\n\n${G?'## 業界横断チェックリスト':'## Cross-Cutting Checklist'}\n${qa.crossCutting.length>0?qa.crossCutting.map((c,i)=>`${i+1}. ${c}`).join('\n'):(G?'該当なし':'None applicable')}\n\n${G?'## 優先度マトリクス':'## Priority Matrix'}\n| ${G?'カテゴリ':'Category'} | ${G?'優先度':'Priority'} |\n|----------|----------|\n| ${G?'セキュリティ':'Security'} | ${priObj.Security||'MED'} |\n| ${G?'パフォーマンス':'Performance'} | ${priObj.Performance||'MED'} |\n| ${G?'データ整合性':'Data Integrity'} | ${priObj.DataIntegrity||'MED'} |\n| UX | ${priObj.UX||'MED'} |\n| ${G?'コンプライアンス':'Compliance'} | ${priObj.Compliance||'LOW'} |\n\n${G?'## テスト実行順序':'## Test Execution Order'}\n${G?'優先度に基づいた推奨実行順序:':'Recommended execution order by priority:'}\n1. ${priObj.Security==='CRITICAL'||priObj.DataIntegrity==='CRITICAL'?(G?'セキュリティ・データ整合性テスト':'Security & Data Integrity tests'):priObj.UX==='CRITICAL'?(G?'UXテスト':'UX tests'):(G?'パフォーマンステスト':'Performance tests')}\n2. ${priObj.Performance==='HIGH'||priObj.Security==='HIGH'?(G?'パフォーマンス・セキュリティテスト':'Performance & Security tests'):(G?'機能テスト':'Functional tests')}\n3. ${G?'統合テスト':'Integration tests'}\n4. ${G?'回帰テスト':'Regression tests'}\n\n${G?'## 参考リソース':'## References'}\n- ${G?'詳細QAブループリント':'Detailed QA Blueprint'}: docs/32_qa_blueprint.md\n- ${G?'具体的テストマトリクス':'Concrete Test Matrix'}: docs/33_test_matrix.md\n- OWASP Top 10: https://owasp.org/www-project-top-ten/\n- ${domain==='education'?'FERPA Compliance':domain==='health'?'HIPAA Compliance':domain==='fintech'?'PCI DSS Compliance':domain==='hr'?'GDPR/CCPA Compliance':domain==='saas'?'SOC 2 Compliance':'Industry Best Practices'}`;
}
return `${G?'## 汎用QAチェックリスト':'## Generic QA Checklist'}\n\n${G?'ドメイン未検出のため、汎用的なQA項目を記載します。':'Domain not detected. Generic QA items listed below.'}\n\n### ${G?'機能テスト':'Functional Testing'}\n- [ ] ${G?'全機能の正常系動作確認':'Verify all features work (happy path)'}\n- [ ] ${G?'エラーハンドリング検証':'Error handling validation'}\n- [ ] ${G?'境界値テスト':'Boundary value testing'}\n\n### ${G?'セキュリティ':'Security'}\n- [ ] ${G?'認証・認可テスト':'Auth/authz testing'}\n- [ ] ${G?'入力バリデーション':'Input validation'}\n- [ ] XSS/CSRF ${G?'対策確認':'prevention check'}\n- [ ] ${G?'機密情報の漏洩チェック':'Sensitive data leakage check'}\n\n### ${G?'パフォーマンス':'Performance'}\n- [ ] ${G?'レスポンスタイム測定':'Response time measurement'}\n- [ ] ${G?'高負荷テスト':'Load testing'}\n- [ ] ${G?'メモリリーク検出':'Memory leak detection'}\n\n### ${G?'互換性':'Compatibility'}\n- [ ] ${G?'ブラウザ別動作確認':'Cross-browser testing'}\n- [ ] ${G?'モバイル対応確認':'Mobile responsiveness'}\n- [ ] ${G?'アクセシビリティ (WCAG)':'Accessibility (WCAG)'}\n\n### ${G?'データ整合性':'Data Integrity'}\n- [ ] ${G?'トランザクション完全性':'Transaction integrity'}\n- [ ] ${G?'データ同期確認':'Data sync validation'}\n- [ ] ${G?'バックアップ・リストア検証':'Backup/restore verification'}`;
})()],
['31_industry_playbook',G?'業種別実装プレイブック':'Industry Implementation Playbook',(()=>{
const domain=detectDomain(a.purpose)||'_default';
const pb=DOMAIN_PLAYBOOK[domain]||DOMAIN_PLAYBOOK._default;
const qa=domain!=='_default'?getDomainQA(domain,G):null;
const rf=REVERSE_FLOW_MAP[domain]||REVERSE_FLOW_MAP._default;
let s=`${G?'## 🎯 対象ドメイン':'## 🎯 Target Domain'}\n**${domain}**${domain==='_default'?(G?' (汎用)':' (generic)'):''}\n\n${G?'## 📐 実装レベル・リバースフロー':'## 📐 Implementation-Level Reverse Flow'}\n${G?'ゴールから逆算した具体的な実装パターン:':'Concrete implementation patterns reverse-engineered from goals:'}\n\n${(G?pb.impl_ja:pb.impl_en).map((p,i)=>`${i+1}. ${p}`).join('\n\n')}\n\n`;
if(qa){
const priObj={};qa.priority.split('|').forEach(p=>{const[k,v]=p.split(':');priObj[k]=v;});
s+=`${G?'## 🧪 QA優先度マトリクス':'## 🧪 QA Priority Matrix'}\n| ${G?'カテゴリ':'Category'} | ${G?'優先度':'Priority'} |\n|----------|----------|\n| ${G?'セキュリティ':'Security'} | ${priObj.Security||'MED'} |\n| ${G?'パフォーマンス':'Performance'} | ${priObj.Performance||'MED'} |\n| ${G?'データ整合性':'Data Integrity'} | ${priObj.DataIntegrity||'MED'} |\n| UX | ${priObj.UX||'MED'} |\n| ${G?'コンプライアンス':'Compliance'} | ${priObj.Compliance||'LOW'} |\n\n${G?'**重点領域**:':'**Focus Areas**:'}\n${qa.focus.map((f,i)=>`- ${f}`).join('\n')}\n\n`;
}
s+=`${G?'## 🐛 予測バグTOP3と予防策':'## 🐛 Top 3 Predicted Bugs & Prevention'}\n${G?'この業種で最も発生しやすいバグと対策:':'Most common bugs in this industry and countermeasures:'}\n\n${(G?pb.prevent_ja:pb.prevent_en).map((p,i)=>{const[bug,fix]=p.split('|');return `### ${i+1}. ${bug}\n${fix}`;}).join('\n\n')}\n\n${G?'## 📜 コンプライアンス・チェックリスト':'## 📜 Compliance Checklist'}\n${(G?pb.compliance_ja:pb.compliance_en).map((c,i)=>`- [ ] ${c}`).join('\n')}\n\n${G?'## 🧠 コンテキスト・エンジニアリング・プロトコル':'## 🧠 Context Engineering Protocol'}\n${G?'タスクごとに読むべきドキュメント:':'Documents to read per task type:'}\n\n| ${G?'タスク種別':'Task Type'} | ${G?'参照ドキュメント':'Reference Documents'} |\n|----------|----------|\n${(G?pb.ctx_ja:pb.ctx_en).map(c=>{const[task,docs]=c.split('→');return `| ${task} | ${docs} |`;}).join('\n')}\n\n${G?'## 🎨 カスタムスキル設計図':'## 🎨 Custom Skill Blueprint'}\n${G?'この業種に特化したAIスキル定義:':'Domain-specific AI skill definition:'}\n\n`;
const skillStr=G?pb.skill_ja:pb.skill_en;
if(skillStr&&typeof skillStr==='string'&&skillStr!==''){
const skill=skillStr.split('|');
s+=`**${G?'役割':'Role'}**: ${skill[0]}\n\n**${G?'目的':'Purpose'}**: ${skill[1]}\n\n**${G?'入力':'Input'}**: ${skill[2]}\n\n**${G?'判断基準':'Judgment Criteria'}**: ${skill[3]}\n\n**${G?'出力':'Output'}**: ${skill[4]}\n\n`;
}
s+=`${G?'## 🔄 コンテキスト・ローテーション戦略':'## 🔄 Context Rotation Strategy'}\n\n${G?'**4原則** (コンテキストウィンドウを溢れさせない方法):':'**4 Principles** (how to prevent context window overflow):'}\n\n1. **Write (${G?'記述':'Documentation'})**: ${G?'脳内の仕様を `docs/` に書き出す。AIの外部記憶として機能。':'Write specifications from your mind into `docs/`. Functions as AI external memory.'}\n2. **Select (${G?'選択':'Selection'})**: ${G?'必要なファイルだけ読み込ませる。上記の「タスク別参照ドキュメント」を活用。':'Load only necessary files. Use "Documents per Task Type" table above.'}\n3. **Compress (${G?'圧縮':'Compression'})**: ${G?'履歴が肥大化したら要約し、エッセンスだけ残す。長い会話は定期的に圧縮。':'When history bloats, summarize and keep essence only. Compress long conversations periodically.'}\n4. **Isolate (${G?'分離':'Isolation'})**: ${G?'調査・実験はサブエージェント (Task tool) で実行。結論だけメインコンテキストに持ち帰る。':'Run research/experiments in sub-agents (Task tool). Bring back only conclusions to main context.'}\n\n${G?'## 📊 KPI参考値':'## 📊 KPI Reference Values'}\n${G?'この業種の典型的なKPI目標値:':'Typical KPI targets for this domain:'}\n\n${(G?rf.kpi_ja:rf.kpi_en).map((k,i)=>`- ${k}`).join('\n')}\n\n${G?'## 💡 推奨事項':'## 💡 Recommendations'}\n${G?'- 実装前に `docs/architecture.md` と `docs/design_system.md` を必ず読み、既存パターンに従う':'- Read `docs/architecture.md` and `docs/design_system.md` before implementation, follow existing patterns'}\n${G?'- バグ発生時は `docs/error_logs.md` に記録し、再発防止策を明記':'- When bugs occur, record in `docs/error_logs.md` with prevention strategies'}\n${G?'- 進捗は `docs/progress.md` を随時更新し、プロジェクトの現在地を明確化':'- Update `docs/progress.md` frequently to clarify project status'}\n${G?'- コンプライアンス要件は設計段階から考慮し、後付け対応を避ける':'- Consider compliance requirements from design phase, avoid retrofitting'}`;
return s;
})()],
];
docTemplates.forEach(([file,title,content])=>{
S.files[`docs/${file}.md`]=`# ${pn} — ${title}\n> ${date}\n\n${content}`;
});
// ═══ B2: docs/35_sitemap.md (~8KB) ═══
let doc35='# '+pn+' — '+(G?'サイトマップ・情報設計':'Sitemap & Information Architecture')+'\n\n';
doc35+=G?'**重要**: このドキュメントはアプリケーション全体のURL構造とナビゲーションパターンを定義します。新規ページ追加時は必ずこのサイトマップを更新してください。\n\n':'**IMPORTANT**: This document defines the URL structure and navigation patterns for the entire application. MUST update this sitemap when adding new pages.\n\n';
// Generate routes (reuse existing genRoutes function)
const allRoutes=genRoutes(a);
// URL Tree (Mermaid graph)
doc35+=(G?'## URLツリー':'## URL Tree')+'\n\n';
doc35+=(G?'**ルーティング構造の可視化**':'**Routing structure visualization**')+'\n\n';
doc35+='```mermaid\ngraph TD\n';
doc35+=' Root[/]\n';
// Build tree nodes
const addedPaths=new Set(['Root']);
allRoutes.forEach((route,i)=>{
const path=route.path;
const parts=path.split('/').filter(Boolean);
let currentPath='Root';
parts.forEach((part,idx)=>{
const nodeName=part.replace(/[:\[\]]/g,'').replace(/-/g,'_')||'index';
const fullPath=currentPath+'_'+nodeName;
if(!addedPaths.has(fullPath)){
const label=part.includes(':')||part.includes('[')?'['+part+']':part;
const style=route.auth?' --> |🔒|':' --> ';
doc35+=' '+currentPath+style+fullPath+'['+label+']\n';
addedPaths.add(fullPath);
}
currentPath=fullPath;
});
});
doc35+='```\n\n';
// Route-Screen-Component Mapping Table
doc35+=(G?'## Route-Screen-Component マッピング':'## Route-Screen-Component Mapping')+'\n\n';
doc35+='| '+(G?'ルート':'Route')+' | '+(G?'画面名':'Screen')+' | '+(G?'主要コンポーネント':'Key Components')+' | '+(G?'認証':'Auth')+' |\n';
doc35+='|------|------|------|------|\n';
allRoutes.forEach(route=>{
const screenName=route.name||route.path.split('/').pop()||'Index';
const components=getScreenComponents(screenName,G);
const componentList=components?components.slice(0,3).join(', '):(G?'（未定義）':'(Undefined)');
const authIcon=route.auth?'🔒':'🌐';
doc35+='| `'+route.path+'` | '+screenName+' | '+componentList+' | '+authIcon+' |\n';
});
doc35+='\n';
doc35+=(G?'**凡例**: 🔒 認証必須 | 🌐 公開':'**Legend**: 🔒 Auth required | 🌐 Public')+'\n\n';
// Navigation Patterns
doc35+=(G?'## ナビゲーションパターン':'## Navigation Patterns')+'\n\n';
// Primary Navigation
doc35+='### 1. '+(G?'プライマリナビゲーション':'Primary Navigation')+'\n\n';
doc35+=(G?'**位置**: ヘッダー or サイドバー':'**Location**: Header or Sidebar')+'\n\n';
const primaryRoutes=allRoutes.filter(r=>
!r.path.includes('[')&&!r.path.includes(':')&&r.path.split('/').filter(Boolean).length<=2
);
doc35+=(G?'推奨リンク:':'Recommended links:')+'\n';
primaryRoutes.slice(0,8).forEach(r=>{
doc35+='- `'+r.path+'` — '+r.name+(r.auth?' 🔒':'')+'\n';
});
doc35+='\n';
// Secondary Navigation
doc35+='### 2. '+(G?'セカンダリナビゲーション':'Secondary Navigation')+'\n\n';
doc35+=(G?'**位置**: サブメニュー or タブ':'**Location**: Submenu or Tabs')+'\n\n';
const secondaryRoutes=allRoutes.filter(r=>
r.path.split('/').filter(Boolean).length>=3&&!r.path.includes('[')&&!r.path.includes(':')
);
if(secondaryRoutes.length>0){
doc35+=(G?'サブセクション:':'Sub-sections:')+'\n';
secondaryRoutes.slice(0,5).forEach(r=>{
doc35+='- `'+r.path+'` — '+r.name+(r.auth?' 🔒':'')+'\n';
});
doc35+='\n';
}else{
doc35+=G?'（該当なし）\n\n':'(None)\n\n';
}
// Breadcrumb Navigation
doc35+='### 3. '+(G?'パンくずナビゲーション':'Breadcrumb Navigation')+'\n\n';
doc35+=(G?'**推奨実装**: 3階層以上のページで表示':'**Recommended**: Display for pages with ≥3 levels')+'\n\n';
const deepRoutes=allRoutes.filter(r=>r.path.split('/').filter(Boolean).length>=3);
if(deepRoutes.length>0){
const exampleRoute=deepRoutes[0];
const parts=exampleRoute.path.split('/').filter(Boolean);
let breadcrumb='Home';
parts.forEach((part,i)=>{
if(i<parts.length-1){
breadcrumb+=' > '+part.replace(/[:\[\]]/g,'');
}
});
breadcrumb+=' > '+exampleRoute.name;
doc35+=(G?'例: ':'Example: ')+'`'+breadcrumb+'`\n\n';
}else{
doc35+=G?'（該当ルートなし）\n\n':'(No applicable routes)\n\n';
}
// SEO Metadata Map
doc35+=(G?'## SEOメタデータマップ':'## SEO Metadata Map')+'\n\n';
doc35+='| '+(G?'ルート':'Route')+' | Title | Description | OG Image |\n';
doc35+='|------|------|------|------|\n';
allRoutes.slice(0,10).forEach(route=>{
const routeName=route.name||'Page';
const title=pn+' | '+routeName;
const desc=(a.purpose||'').substring(0,80)+'...';
const ogImage='/og-image.png';
doc35+='| `'+route.path+'` | '+title+' | '+desc+' | '+ogImage+' |\n';
});
doc35+='\n';
// URL Best Practices
doc35+=(G?'## URLベストプラクティス':'## URL Best Practices')+'\n\n';
doc35+='1. **'+(G?'小文字+ハイフン':'Lowercase + hyphens')+'**: `/user-profile` '+(G?'ではなく':'not')+' `/userProfile`\n';
doc35+='2. **'+(G?'複数形の一貫性':'Plural consistency')+'**: `/users/:id` '+(G?'（コレクションは複数形）':'(collections are plural)')+'\n';
doc35+='3. **'+(G?'RESTful命名':'RESTful naming')+'**: `/api/posts/:id/comments` '+(G?'（ネストでリソース関係を表現）':'(nested to show resource relationship)')+'\n';
doc35+='4. **'+(G?'クエリパラメータ':'Query params')+'**: `/search?q=keyword&sort=date` '+(G?'（フィルタ・ソートはクエリで）':'(filters/sorting in query)')+'\n\n';
// Related Documents
doc35+=(G?'## 関連ドキュメント':'## Related Documents')+'\n\n';
doc35+='- **docs/05_api_design.md** — '+(G?'APIエンドポイント詳細':'API endpoints detail')+'\n';
doc35+='- **docs/06_screen_design.md** — '+(G?'画面設計書':'Screen design')+'\n';
doc35+='- **docs/26_design_system.md** — '+(G?'デザインシステム':'Design system')+'\n';
doc35+='- **.spec/technical-plan.md** — '+(G?'技術計画':'Technical plan')+'\n\n';
S.files['docs/35_sitemap.md']=doc35;
// CI/CD Workflow YAML
const buildCmd=fe.includes('Next')?'next build':fe.includes('Vite')||fe.includes('SPA')?'vite build':'npm run build';
const buildPrefix=buildCmd.startsWith('npm')?'':'npx ';
const nodeV='22';
S.files['.github/workflows/ci.yml']=[
'name: CI',
'on:',
' push:',
' branches: [main, develop]',
' pull_request:',
' branches: [main]',
'',
'jobs:',
' ci:',
' runs-on: ubuntu-latest',
' steps:',
' - uses: actions/checkout@v4',
' - uses: actions/setup-node@v4',
' with:',
' node-version: '+nodeV,
' cache: npm',
' - run: npm ci',
' - run: npm audit --audit-level=high',
' - run: npm run lint',
' - run: npm run test',
' - run: '+buildPrefix+buildCmd,
'',
' security:',
' runs-on: ubuntu-latest',
' steps:',
' - uses: actions/checkout@v4',
' with:',
' fetch-depth: 0',
' # Secret Scanning',
' - uses: gitleaks/gitleaks-action@v2',
' env:',
' GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}',
' # Dependency Review',
' - uses: actions/dependency-review-action@v4',
' if: github.event_name == \'pull_request\'',
' # SLSA Build Provenance',
' - uses: actions/attest-build-provenance@v2',
' with:',
' subject-path: \'dist/**\'',
''
].join('\n');
}
/* ═══ Common Helpers for Cross-Generator Consistency ═══ */
// ── Smart Table Pluralization ──
function pluralize(name){
const lower=name.toLowerCase();
// Uncountable
if(/^(progress|media|data|feedback|equipment|information|news|analytics|metadata|settings)$/i.test(name)) return lower;
// Irregular
const irreg={person:'people',child:'children',quiz:'quizzes',status:'statuses',category:'categories',entry:'entries'};
if(irreg[lower]) return irreg[lower];
// Standard rules
if(lower.endsWith('s')||lower.endsWith('x')||lower.endsWith('ch')||lower.endsWith('sh')) return lower+'es';
if(lower.endsWith('y')&&!/[aeiou]y$/i.test(lower)) return lower.slice(0,-1)+'ies';
return lower+'s';
}
// ── Check if value is "none" in any language ──
function isNone(v){
return !v||v==='none'||v==='None'||v==='なし';
}
// ── Screen Component Dictionary ──
const SCREEN_COMPONENTS={
'ランディング|landing|LP|トップ|home':{
components_ja:['ヒーローセクション(CTA)','特徴/メリット一覧','料金プラン比較表','ユーザーレビュー/実績','FAQ アコーディオン','フッター(リンク集)'],
components_en:['Hero section with CTA','Features / benefits list','Pricing comparison table','Testimonials / social proof','FAQ accordion','Footer with links'],
},
'ダッシュボード|dashboard':{
components_ja:['統計カード(KPI数値)','アクティビティグラフ(recharts)','最近のアクティビティ一覧','クイックアクションボタン','サイドバーナビゲーション'],
components_en:['Stats cards (KPI metrics)','Activity chart (recharts)','Recent activity feed','Quick action buttons','Sidebar navigation'],
},
'設定|settings|プロフィール|profile':{
components_ja:['プロフィール編集フォーム','パスワード変更','通知設定トグル','テーマ切替(ダーク/ライト)','アカウント削除'],
components_en:['Profile edit form','Password change','Notification toggles','Theme switch (dark/light)','Account deletion'],
},
'管理|admin':{
components_ja:['ユーザー管理テーブル(検索/フィルタ/ページネーション)','コンテンツ承認キュー','売上/統計グラフ','監査ログビューア','システム設定'],
components_en:['User management table (search/filter/pagination)','Content approval queue','Revenue / stats charts','Audit log viewer','System settings'],
},
'一覧|list|検索|search|コース|course|商品|product':{
components_ja:['検索バー + フィルタサイドバー','カード/リスト切替','ページネーション/無限スクロール','ソート(新着/人気/価格)','空状態メッセージ'],
components_en:['Search bar + filter sidebar','Card / list toggle','Pagination / infinite scroll','Sort (newest/popular/price)','Empty state message'],
},
'詳細|detail':{
components_ja:['メインコンテンツ表示','メタ情報サイドバー','関連コンテンツ','レビュー/コメントセクション','シェアボタン','CTAボタン(購入/受講開始)'],
components_en:['Main content display','Meta info sidebar','Related content','Reviews / comments section','Share buttons','CTA button (buy/enroll)'],
},
'決済|payment|billing|checkout':{
components_ja:['プラン比較カード','Stripe Elements決済フォーム','注文サマリー','クーポン入力','決済完了/エラー表示'],
components_en:['Plan comparison cards','Stripe Elements payment form','Order summary','Coupon input','Payment success / error display'],
},
'ログイン|login|サインイン|signin':{
components_ja:['メール/パスワードフォーム','ソーシャルログインボタン','パスワードリセットリンク','新規登録リンク','バリデーションメッセージ'],
components_en:['Email / password form','Social login buttons','Password reset link','Register link','Validation messages'],
},
'新規登録|register|signup':{
components_ja:['ステップフォーム(基本情報→確認)','利用規約同意チェック','ソーシャル登録ボタン','パスワード強度メーター','ログインリンク'],
components_en:['Step form (info → confirm)','Terms agreement checkbox','Social signup buttons','Password strength meter','Login link'],
},
};
function getScreenComponents(screenName,G){
for(const[pattern,detail]of Object.entries(SCREEN_COMPONENTS)){
if(new RegExp(pattern,'i').test(screenName)){return G?detail.components_ja:detail.components_en;}
}
return null;
}
// ── B3: Auth Source of Truth Resolution ──
function resolveAuth(a){
const be=a.backend||'';const fe=a.frontend||'';const auth=a.auth||'';
let sot,tokenType,tokenVerify,provider;
if(be.includes('Supabase')){
const isSPA=fe.includes('Vite')||fe.includes('SPA')||(!fe.includes('Next')&&!fe.includes('Nuxt')&&!fe.includes('Remix'));
sot='Supabase Auth';tokenType='Supabase JWT (access_token)';
tokenVerify=isSPA?'Supabase client library (client-side: supabase.auth.getUser()) + RLS':'Supabase client library (server-side: supabase.auth.getUser())';
provider='supabase';
} else if(be.includes('Firebase')){
sot='Firebase Auth';tokenType='Firebase ID Token';
tokenVerify='Firebase Admin SDK (admin.auth().verifyIdToken())';
provider='firebase';
} else if(fe.includes('Next.js')&&(auth.includes('NextAuth')||auth.includes('Auth.js'))){
sot='Auth.js (NextAuth v5)';tokenType='Session Token (server-side session)';
tokenVerify='Auth.js getServerSession() / auth() middleware';
provider='authjs';
} else if(auth.includes('Supabase Auth')){
sot='Supabase Auth (standalone)';tokenType='Supabase JWT';
tokenVerify='Supabase client library';
provider='supabase';
} else {
// Fallback: use user's auth answer or JWT default
sot=auth||'JWT + OAuth 2.0';tokenType='Bearer Token (JWT)';
tokenVerify='jsonwebtoken verify() / jose jwtVerify()';
provider='jwt';
}
// Social providers from auth chip
const social=[];
if(auth.includes('Google'))social.push('Google OAuth');
if(auth.includes('GitHub'))social.push('GitHub OAuth');
if(auth.includes('Apple'))social.push('Apple Sign In');
if(auth.includes('メール')||auth.includes('Email'))social.push('Email/Password');
if(auth.includes('Magic')||auth.includes('マジック'))social.push('Magic Link');
return {sot,tokenType,tokenVerify,provider,social};
}
// ── B1: Architecture Pattern Resolution ──
function resolveArch(a){
const fe=a.frontend||'React + Next.js';const be=a.backend||'Node.js + Express';
const db=a.database||'PostgreSQL';const deploy=a.deploy||'Vercel';
const mob=a.mobile||'';
const isBaaS=/Supabase|Firebase|Convex/.test(be);
const isNextJS=fe.includes('Next.js');
const isServerBE=/Express|Fastify|NestJS|Hono|Django|FastAPI|Spring|Go/.test(be);
const isVercel=deploy.includes('Vercel');
let pattern,diagram,note='';
if(isBaaS){
pattern='baas';
const baasName=be.includes('Supabase')?'Supabase':be.includes('Firebase')?'Firebase':'Convex';
diagram=`[Client] → [${fe}] → [${baasName} (Auth + DB + Functions)]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [${baasName} (Auth + DB + Functions)]`;
note=`${baasName} handles auth, database, and serverless functions as a unified backend.`;
} else if(isVercel&&isNextJS&&isServerBE){
pattern='bff';
diagram=`[Client] → [Next.js (SSR + API Routes)] → [${db}]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [Next.js API Routes] → [${db}]`;
note=`Express logic is integrated into Next.js API Routes for Vercel deployment. No separate backend server needed.`;
} else if(isVercel&&isServerBE&&!isNextJS){
pattern='split';
diagram=`[Client] → [${fe} (Vercel)]\n → [${be} (Railway/Render)] → [${db}]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [${be} (Railway/Render)] → [${db}]`;
note=`${be} requires a separate server host (Railway/Render/Fly.io). Vercel serves frontend only.`;
} else {
pattern='traditional';
diagram=`[Client] → [${fe}] → [${be}] → [${db}]`;
if(mob&&!isNone(mob)&&!mob.includes('PWA'))
diagram+=`\n[Mobile - ${mob}] → [${be}] → [${db}]`;
}
return {pattern,diagram,note,isBaaS,isNextJS};
}
// ── B7: Schedule Single Source ──
function buildSchedule(a){
const hasMobile=a.mobile&&!isNone(a.mobile)&&!a.mobile.includes('PWA');
const startDate=new Date().toISOString().split('T')[0];
const sprints=[
{name:'Sprint 0',weeks:'Week 1',focus_ja:'環境構築',focus_en:'Setup'},
{name:'Sprint 1',weeks:'Week 2-3',focus_ja:'コア機能',focus_en:'Core Features'},
{name:'Sprint 2',weeks:'Week 3-4',focus_ja:'UI/UX',focus_en:'UI/UX'},
{name:'Sprint 3',weeks:'Week 4-5',focus_ja:'テスト・デプロイ',focus_en:'Test & Deploy'},
];
if(hasMobile) sprints.push({name:'Sprint 4',weeks:'Week 5-6',focus_ja:'モバイル対応',focus_en:'Mobile'});
const totalWeeks=hasMobile?6:5;
return {startDate,totalWeeks,sprints,hasMobile};
}
// ── B8: Package.json Real Dependencies ──
function buildDeps(a){
const fe=a.frontend||'';const be=a.backend||'';const db=a.database||'';
const orm=a.orm||'';const deploy=a.deploy||'';const auth=resolveAuth(a);
const deps={};const devDeps={};const scripts={};
// Frontend
if(fe.includes('Next.js')){
deps['next']='^15';deps['react']='^19';deps['react-dom']='^19';
scripts.dev='next dev';scripts.build='next build';scripts.start='next start';scripts.lint='next lint';
} else if(fe.includes('Vite')||fe.includes('Vue')||fe.includes('Svelte')){
deps['vite']='^6';
scripts.dev='vite';scripts.build='vite build';scripts.preview='vite preview';
}
if(fe.includes('Vue')){deps['vue']='^3';}
if(fe.includes('Svelte')){deps['svelte']='^5';}
if(fe.includes('Angular')){scripts.dev='ng serve';scripts.build='ng build';}
// Backend
if(be.includes('Express')){deps['express']='^5';}
if(be.includes('Fastify')){deps['fastify']='^5';}
if(be.includes('Hono')){deps['hono']='^4';}
if(be.includes('Supabase')){deps['@supabase/supabase-js']='^2';deps['@supabase/ssr']='^0.5';}
if(be.includes('Firebase')){deps['firebase']='^11';devDeps['firebase-tools']='^13';}
if(be.includes('Convex')){deps['convex']='^1';}
// ORM / DB — skip for BaaS (user orm input irrelevant)
const isBaaS=/Supabase|Firebase|Convex/.test(be);
if(!isBaaS){
if(orm.includes('Prisma')){devDeps['prisma']='^6';deps['@prisma/client']='^6';
scripts['db:push']='prisma db push';scripts['db:studio']='prisma studio';scripts['db:generate']='prisma generate';}
if(orm.includes('Drizzle')){deps['drizzle-orm']='^0.38';devDeps['drizzle-kit']='^0.30';
scripts['db:push']='drizzle-kit push';scripts['db:studio']='drizzle-kit studio';}
}
// Auth
if(auth.provider==='authjs'){deps['next-auth']='^5';}
// Payment
const hasPay=a.payment&&!/なし|None|none/.test(a.payment);
if(hasPay&&(a.payment||'').includes('Stripe')){deps['stripe']='^17';}
// Common devDeps
devDeps['typescript']='^5.7';devDeps['@types/node']='^22';
devDeps['vitest']='^3';devDeps['@playwright/test']='^1.50';
devDeps['eslint']='^9';devDeps['prettier']='^3';
scripts.test='vitest';scripts['test:e2e']='playwright test';
scripts.lint=scripts.lint||'eslint .';
return {deps,devDeps,scripts};
}
// ── B5: Domain Entity Validation & ER Inference ──
const DOMAIN_ENTITIES={
education:{core:['User','Course','Lesson','Progress','Quiz','Enrollment'],warn:['Product','Order','Cart'],suggest:{Product:'Course',Order:'Enrollment',Cart:'Wishlist'}},
ec:{core:['User','Product','Category','Order','Cart','Payment','Review'],warn:['Course','Lesson','Progress'],suggest:{}},
marketplace:{core:['User','Listing','Order','Review','Message','Category'],warn:['Course','Lesson'],suggest:{}},
community:{core:['User','Post','Comment','Tag','Like','Follow'],warn:['Product','Order','Cart','Payment'],suggest:{Product:'Resource',Order:'Invitation'}},
content:{core:['User','Post','Category','Tag','Comment','Media'],warn:['Product','Order','Cart'],suggest:{Product:'Content',Order:'Subscription'}},
analytics:{core:['User','Dashboard','DataSource','Widget','Report','Chart'],warn:['Post','Comment','Product'],suggest:{}},
booking:{core:['User','Service','Booking','TimeSlot','Review','Payment'],warn:['Post','Cart','Lesson'],suggest:{Product:'Service',Order:'Booking'}},
saas:{core:['User','Workspace','Project','Task','Subscription','Invoice'],warn:[],suggest:{Product:'Plan',Order:'Subscription'}},
portfolio:{core:['User','Project','Skill','Experience','ContactMessage'],warn:['Product','Order','Cart','Payment'],suggest:{}},
tool:{core:['User','Workspace','Task','Setting','Log'],warn:['Product','Order','Cart'],suggest:{}},
iot:{core:['User','Device','Sensor','SensorData','Alert','Dashboard'],warn:['Product','Order','Cart'],suggest:{}},
realestate:{core:['User','Property','Category','Viewing','Contract','RealEstateAgent'],warn:['Product','Order','Cart'],suggest:{Product:'Property',Order:'Viewing'}},
legal:{core:['User','Contract','Template','Review','Client','Document'],warn:['Product','Order','Cart'],suggest:{}},
hr:{core:['User','JobPosting','Applicant','Interview','Evaluation','Department'],warn:['Product','Order','Cart'],suggest:{}},
fintech:{core:['User','Account','Transaction','Transfer','Card','Statement'],warn:['Post','Comment','Course'],suggest:{}},
health:{core:['User','Patient','Doctor','Appointment','MedicalRecord','Prescription'],warn:['Product','Order','Cart'],suggest:{Product:'Service',Order:'Appointment'}},
ai:{core:['User','Conversation','Message','Prompt','Agent','Tool','ApiUsage'],warn:['Product','Order','Cart'],suggest:{}},
automation:{core:['User','Workflow','Trigger','Action','Execution','Connection','Log'],warn:['Product','Order'],suggest:{}},
event:{core:['User','Event','Ticket','Attendee','Venue','Session','Survey'],warn:['Product','Order'],suggest:{Product:'Ticket',Order:'Booking'}},
gamify:{core:['User','Badge','Challenge','Reward','Leaderboard','PointLog','Achievement'],warn:['Product','Order','Cart'],suggest:{}},
collab:{core:['User','Document','Workspace','Comment','Version','Permission','Activity'],warn:['Product','Order','Cart'],suggest:{}},
devtool:{core:['User','ApiKey','Project','RequestLog','Webhook','Documentation'],warn:['Product','Order','Cart'],suggest:{}},
creator:{core:['User','Content','Subscription','Payment','Tier','Comment','Tip'],warn:['Order','Cart'],suggest:{}},
newsletter:{core:['User','Post','Subscriber','Campaign','Analytics','Plan'],warn:['Product','Order','Cart'],suggest:{Product:'Plan',Order:'Subscription'}},
};
// ── Entity Column Dictionary ──
// Format: 'column_name:TYPE:CONSTRAINT:DESC_JA:DESC_EN'
// Common column patterns (for compression)
const _U='user_id:UUID:FK(User) NOT NULL:ユーザーID:User ID';
const _SA="status:VARCHAR(20):DEFAULT 'active':ステータス:Status";
const _SD="status:VARCHAR(20):DEFAULT 'draft':ステータス:Status";
const _SP="status:VARCHAR(20):DEFAULT 'pending':ステータス:Status";
const _T='title:VARCHAR(255):NOT NULL:タイトル:Title';
const _D='description:TEXT::説明:Description';
const _CN='config:JSONB::設定:Config';
const _M='metadata:JSONB::メタデータ:Metadata';
const _B='body:TEXT::本文:Body';
const _BN='body:TEXT:NOT NULL:本文:Body';
const _TS='created_at:TIMESTAMP:DEFAULT NOW:作成日時:Created at';
const _SO='sort_order:INT:DEFAULT 0:表示順:Display order';
const _IA='is_active:BOOLEAN:DEFAULT true:有効:Active';
const _PR='price:DECIMAL(10,2):NOT NULL:価格:Price';
const _CAT='category:VARCHAR(100)::カテゴリ:Category';
const _DUR='duration_min:INT::所要時間(分):Duration(min)';
const _N='notes:TEXT::メモ:Notes';
const _C='content:TEXT::コンテンツ:Content';
const _ADDR='address:TEXT::住所:Address';
const _SUBJ='subject:VARCHAR(255)::件名:Subject';
const _URL='url:TEXT::URL:URL';
const _REASON='reason:TEXT::理由:Reason';
const _MSG='message:TEXT::メッセージ:Message';
const _COMPANY='company:VARCHAR(255)::会社名:Company';
const ENTITY_COLUMNS={
User:['email:VARCHAR(255):UNIQUE NOT NULL:メールアドレス:Email','avatar_url:TEXT::アバターURL:Avatar URL','role:VARCHAR(20):DEFAULT \'user\':ユーザー権限:User role'],
Course:['description:TEXT::コース説明:Course description','price:DECIMAL(10,2):DEFAULT 0:価格:Price','status:VARCHAR(20):DEFAULT \'draft\':公開状態:Publish status','thumbnail_url:TEXT::サムネイル:Thumbnail','instructor_id:UUID:FK(User):講師ID:Instructor ID'],
Lesson:[_SO,'content_type:VARCHAR(20):DEFAULT \'text\':コンテンツ種別:Content type',_DUR,'video_url:TEXT::動画URL:Video URL','is_free:BOOLEAN:DEFAULT false:無料公開:Free access'],
Progress:[_U,'lesson_id:UUID:FK(Lesson) NOT NULL:レッスンID:Lesson ID','status:VARCHAR(20):DEFAULT \'not_started\':進捗状態:Progress status','completed_at:TIMESTAMP::完了日時:Completed at','score:INT::スコア:Score'],
Quiz:['lesson_id:UUID:FK(Lesson) NOT NULL:レッスンID:Lesson ID','question:TEXT:NOT NULL:問題文:Question text','options:JSONB::選択肢:Options','correct_answer:TEXT:NOT NULL:正解:Correct answer','order:INT:DEFAULT 0:表示順:Display order'],
Enrollment:[_U,'course_id:UUID:FK(Course) NOT NULL:コースID:Course ID','enrolled_at:TIMESTAMP:DEFAULT NOW:受講開始日:Enrolled at','expires_at:TIMESTAMP::有効期限:Expires at',_SA],
Certificate:[_U,'course_id:UUID:FK(Course) NOT NULL:コースID:Course ID','issued_at:TIMESTAMP:DEFAULT NOW:発行日:Issued at','certificate_url:TEXT::証明書URL:Certificate URL'],
Product:[_D,_PR,'stock:INT:DEFAULT 0:在庫数:Stock','sku:VARCHAR(100):UNIQUE:SKU:SKU','image_url:TEXT::商品画像:Product image','category_id:UUID:FK(Category):カテゴリID:Category ID',_SA],
Category:['slug:VARCHAR(100):UNIQUE:スラグ:Slug',_D,'parent_id:UUID:FK(Category):親カテゴリ:Parent category',_SO],
Order:[_U,'total:DECIMAL(10,2):NOT NULL:合計金額:Total',_SP,'stripe_session_id:TEXT::Stripe Session ID:Stripe Session ID','shipping_address:JSONB::配送先:Shipping address'],
Cart:[_U,'product_id:UUID:FK(Product) NOT NULL:商品ID:Product ID','quantity:INT:DEFAULT 1:数量:Quantity'],
Review:[_U,'rating:INT:NOT NULL:評価(1-5):Rating(1-5)',_B],
Post:[_U,_T,_B,_SD,'published_at:TIMESTAMP::公開日時:Published at','slug:VARCHAR(255):UNIQUE:スラグ:Slug'],
Comment:[_U,'post_id:UUID:FK(Post) NOT NULL:投稿ID:Post ID',_BN],
Tag:['slug:VARCHAR(100):UNIQUE NOT NULL:スラグ:Slug'],
Media:[_U,'url:TEXT:NOT NULL:ファイルURL:File URL','mime_type:VARCHAR(50)::MIMEタイプ:MIME type','size_bytes:BIGINT::ファイルサイズ:File size'],
Like:[_U,'post_id:UUID:FK(Post) NOT NULL:投稿ID:Post ID'],
Follow:['follower_id:UUID:FK(User) NOT NULL:フォロワーID:Follower ID','following_id:UUID:FK(User) NOT NULL:フォロー対象ID:Following ID'],
Message:['sender_id:UUID:FK(User) NOT NULL:送信者ID:Sender ID','receiver_id:UUID:FK(User) NOT NULL:受信者ID:Receiver ID',_BN,'read_at:TIMESTAMP::既読日時:Read at'],
Listing:[_U,_T,_D,_PR,_SA,'category_id:UUID:FK(Category):カテゴリID:Category ID'],
Service:['provider_id:UUID:FK(User) NOT NULL:提供者ID:Provider ID',_D,'price:DECIMAL(10,2)::料金:Price',_DUR],
Booking:[_U,'service_id:UUID:FK(Service) NOT NULL:サービスID:Service ID','starts_at:TIMESTAMP:NOT NULL:開始日時:Starts at','ends_at:TIMESTAMP:NOT NULL:終了日時:Ends at',_SP],
TimeSlot:['service_id:UUID:FK(Service) NOT NULL:サービスID:Service ID','day_of_week:INT:NOT NULL:曜日(0-6):Day of week','start_time:TIME:NOT NULL:開始時刻:Start time','end_time:TIME:NOT NULL:終了時刻:End time','is_available:BOOLEAN:DEFAULT true:利用可能:Available'],
Workspace:['owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID','slug:VARCHAR(100):UNIQUE:スラグ:Slug','plan:VARCHAR(20):DEFAULT \'free\':プラン:Plan'],
Project:['workspace_id:UUID:FK(Workspace):ワークスペースID:Workspace ID',_SA,_D],
Task:['project_id:UUID:FK(Project):プロジェクトID:Project ID','assignee_id:UUID:FK(User):担当者ID:Assignee ID','status:VARCHAR(20):DEFAULT \'todo\':タスク状態:Status','priority:INT:DEFAULT 0:優先度:Priority','due_date:DATE::期日:Due date'],
Subscription:[_U,'stripe_subscription_id:TEXT:UNIQUE:StripeサブスクID:Stripe Sub ID','stripe_customer_id:TEXT::Stripe顧客ID:Stripe Customer ID',_SA,'plan:VARCHAR(20):NOT NULL:プラン名:Plan name','current_period_end:TIMESTAMP::現在期間終了:Current period end'],
Invoice:[_U,'amount:DECIMAL(10,2):NOT NULL:金額:Amount',_SP,'stripe_invoice_id:TEXT::Stripe請求ID:Stripe Invoice ID','paid_at:TIMESTAMP::支払日:Paid at'],
Payment:[_U,'amount:DECIMAL(10,2):NOT NULL:金額:Amount','method:VARCHAR(20)::支払方法:Payment method',_SP,'stripe_payment_id:TEXT::Stripe決済ID:Stripe Payment ID'],
Dashboard:[_U,'layout:JSONB::レイアウト設定:Layout config'],
Widget:['dashboard_id:UUID:FK(Dashboard) NOT NULL:ダッシュボードID:Dashboard ID','type:VARCHAR(50):NOT NULL:ウィジェット種別:Widget type',_CN,'position:INT:DEFAULT 0:表示位置:Position'],
DataSource:['workspace_id:UUID:FK(Workspace):ワークスペースID:Workspace ID','type:VARCHAR(50):NOT NULL:データソース種別:Source type','connection_config:JSONB::接続設定:Connection config'],
Device:[_U,'device_name:VARCHAR(255):NOT NULL:デバイス名:Device name','device_type:VARCHAR(50)::デバイス種別:Device type',_SA],
Sensor:['device_id:UUID:FK(Device) NOT NULL:デバイスID:Device ID','sensor_type:VARCHAR(50):NOT NULL:センサー種別:Sensor type','unit:VARCHAR(20)::単位:Unit'],
Alert:[_U,'severity:VARCHAR(20):DEFAULT \'info\':重要度:Severity','message:TEXT:NOT NULL:メッセージ:Message','acknowledged_at:TIMESTAMP::確認日時:Acknowledged at'],
Notification:[_U,_T,_B,'read_at:TIMESTAMP::既読日時:Read at','type:VARCHAR(50):DEFAULT \'general\':通知種別:Type'],
AuditLog:[_U,'action:VARCHAR(100):NOT NULL:操作:Action','resource_type:VARCHAR(50)::対象リソース:Resource type','resource_id:UUID::対象ID:Resource ID',_M],
Skill:[_CAT,'level:INT:DEFAULT 0:レベル:Level'],
Experience:['user_id:UUID:FK(User) NOT NULL:ユーザーID:User ID','company:VARCHAR(255)::企業名:Company','title:VARCHAR(255)::役職:Title','start_date:DATE::開始日:Start date','end_date:DATE::終了日:End date','description:TEXT::説明:Description'],
ContactMessage:['email:VARCHAR(255):NOT NULL:メールアドレス:Email','subject:VARCHAR(255)::件名:Subject','body:TEXT:NOT NULL:本文:Body','status:VARCHAR(20):DEFAULT \'unread\':対応状態:Status'],
// ── SaaS/Workspace ──
Team:['workspace_id:UUID:FK(Workspace) NOT NULL:ワークスペースID:Workspace ID','role:VARCHAR(20):DEFAULT \'member\':チーム権限:Team role'],
Activity:[_U,'action:VARCHAR(100):NOT NULL:操作種別:Action type','resource_type:VARCHAR(50)::対象リソース:Resource type','resource_id:UUID::対象ID:Resource ID',_M],
// ── AI/Chat ──
Conversation:[_U,_T,'model:VARCHAR(50)::使用モデル:Model used','token_count:INT:DEFAULT 0:トークン数:Token count',_SA],
Prompt:[_U,_T,'content:TEXT:NOT NULL:プロンプト内容:Prompt content','category:VARCHAR(50)::カテゴリ:Category','is_public:BOOLEAN:DEFAULT false:公開設定:Public'],
ApiUsage:[_U,'endpoint:VARCHAR(255):NOT NULL:エンドポイント:Endpoint','tokens_used:INT:NOT NULL:使用トークン:Tokens used','cost:DECIMAL(10,4)::コスト:Cost','request_at:TIMESTAMP:DEFAULT NOW:リクエスト日時:Request at'],
Agent:[_U,'agent_name:VARCHAR(255):NOT NULL:エージェント名:Agent name','system_prompt:TEXT::システムプロンプト:System prompt','model:VARCHAR(50)::使用モデル:Model',_SA,_CN],
Tool:['agent_id:UUID:FK(Agent) NOT NULL:エージェントID:Agent ID','tool_name:VARCHAR(100):NOT NULL:ツール名:Tool name','tool_type:VARCHAR(50)::ツール種別:Tool type',_CN,'is_enabled:BOOLEAN:DEFAULT true:有効:Enabled'],
Template:[_U,_T,'content:TEXT:NOT NULL:テンプレート内容:Content','category:VARCHAR(50)::カテゴリ:Category','usage_count:INT:DEFAULT 0:使用回数:Usage count'],
Generation:[_U,'template_id:UUID:FK(Template):テンプレートID:Template ID','input:TEXT::入力:Input','output:TEXT::出力:Output','model:VARCHAR(50)::使用モデル:Model','tokens_used:INT::使用トークン:Tokens used','status:VARCHAR(20):DEFAULT \'completed\':ステータス:Status'],
Content:[_U,_T,_B,'content_type:VARCHAR(50)::コンテンツ種別:Content type',_SD,'published_at:TIMESTAMP::公開日時:Published at'],
CreditUsage:[_U,'credits_used:INT:NOT NULL:使用クレジット:Credits used','action:VARCHAR(100)::操作:Action','balance_after:INT::残高:Balance after'],
// ── Automation/Workflow ──
Workflow:[_U,_T,_D,_SD,'is_active:BOOLEAN:DEFAULT false:有効:Active',_CN],
Trigger:['workflow_id:UUID:FK(Workflow) NOT NULL:ワークフローID:Workflow ID','trigger_type:VARCHAR(50):NOT NULL:トリガー種別:Trigger type',_CN,'is_enabled:BOOLEAN:DEFAULT true:有効:Enabled'],
Action:['workflow_id:UUID:FK(Workflow) NOT NULL:ワークフローID:Workflow ID','action_type:VARCHAR(50):NOT NULL:アクション種別:Action type',_SO,_CN],
Execution:['workflow_id:UUID:FK(Workflow) NOT NULL:ワークフローID:Workflow ID','status:VARCHAR(20):DEFAULT \'running\':実行状態:Status','started_at:TIMESTAMP:DEFAULT NOW:開始日時:Started at','completed_at:TIMESTAMP::完了日時:Completed at','error:TEXT::エラー:Error','output:JSONB::出力:Output'],
Connection:[_U,'service:VARCHAR(100):NOT NULL:サービス名:Service','credentials:JSONB::認証情報:Credentials',_SA],
Log:[_U,'level:VARCHAR(20):DEFAULT \'info\':レベル:Level','message:TEXT:NOT NULL:メッセージ:Message',_M],
// ── Marketplace ──
Transaction:['buyer_id:UUID:FK(User) NOT NULL:購入者ID:Buyer ID','seller_id:UUID:FK(User) NOT NULL:販売者ID:Seller ID','amount:DECIMAL(10,2):NOT NULL:金額:Amount','fee:DECIMAL(10,2):DEFAULT 0:手数料:Fee',_SP,'stripe_transfer_id:TEXT::Stripe送金ID:Stripe transfer ID'],
// ── Chatbot ──
Bot:[_U,'bot_name:VARCHAR(255):NOT NULL:ボット名:Bot name','welcome_message:TEXT::ウェルカムメッセージ:Welcome message','model:VARCHAR(50)::使用モデル:Model',_SA],
Intent:['bot_id:UUID:FK(Bot) NOT NULL:ボットID:Bot ID','intent_name:VARCHAR(100):NOT NULL:インテント名:Intent name','examples:JSONB::例文:Examples','response_template:TEXT::応答テンプレート:Response template'],
KnowledgeBase:['bot_id:UUID:FK(Bot) NOT NULL:ボットID:Bot ID',_T,'content:TEXT:NOT NULL:内容:Content','embedding:JSONB::埋め込みベクトル:Embedding vector','source_url:TEXT::ソースURL:Source URL'],
Handoff:['conversation_id:UUID:FK(Conversation) NOT NULL:会話ID:Conversation ID','agent_id:UUID:FK(User):担当者ID:Agent ID','reason:TEXT::理由:Reason',_SP,'resolved_at:TIMESTAMP::解決日時:Resolved at'],
// ── Fintech ──
Account:[_U,'account_name:VARCHAR(255):NOT NULL:口座名:Account name','account_type:VARCHAR(50)::口座種別:Account type','balance:DECIMAL(12,2):DEFAULT 0:残高:Balance','currency:VARCHAR(3):DEFAULT \'JPY\':通貨:Currency','institution:VARCHAR(255)::金融機関:Institution'],
Budget:[_U,'category:VARCHAR(100):NOT NULL:カテゴリ:Category','amount:DECIMAL(10,2):NOT NULL:予算額:Budget amount','period:VARCHAR(20):DEFAULT \'monthly\':期間:Period','spent:DECIMAL(10,2):DEFAULT 0:使用額:Spent'],
Report:[_U,_T,'report_type:VARCHAR(50)::レポート種別:Report type',_CN,'generated_at:TIMESTAMP::生成日時:Generated at','data:JSONB::データ:Data'],
// ── DevTool ──
ApiKey:[_U,'key_prefix:VARCHAR(20):NOT NULL:キー接頭辞:Key prefix','key_hash:TEXT:NOT NULL:キーハッシュ:Key hash','label:VARCHAR(100)::ラベル:Label','permissions:JSONB::権限:Permissions','last_used_at:TIMESTAMP::最終使用日:Last used','expires_at:TIMESTAMP::有効期限:Expires at'],
RequestLog:['api_key_id:UUID:FK(ApiKey):APIキーID:API Key ID','method:VARCHAR(10):NOT NULL:HTTPメソッド:HTTP method','path:VARCHAR(500):NOT NULL:パス:Path','status_code:INT::ステータスコード:Status code','latency_ms:INT::レイテンシ(ms):Latency(ms)','ip_address:VARCHAR(45)::IPアドレス:IP address'],
Documentation:[_T,'slug:VARCHAR(255):UNIQUE:スラグ:Slug','content:TEXT:NOT NULL:内容:Content',_CAT,_SO,'version:VARCHAR(20)::バージョン:Version'],
// ── Creator ──
Tip:['sender_id:UUID:FK(User) NOT NULL:送信者ID:Sender ID','receiver_id:UUID:FK(User) NOT NULL:受信者ID:Receiver ID','amount:DECIMAL(10,2):NOT NULL:金額:Amount','message:TEXT::メッセージ:Message','status:VARCHAR(20):DEFAULT \'completed\':ステータス:Status'],
Tier:[_U,'tier_name:VARCHAR(100):NOT NULL:ティア名:Tier name',_PR,_D,'benefits:JSONB::特典:Benefits'],
// ── Newsletter ──
Subscriber:['email:VARCHAR(255):UNIQUE NOT NULL:メールアドレス:Email',_U,_SA,'subscribed_at:TIMESTAMP:DEFAULT NOW:購読開始日:Subscribed at','tags:JSONB::タグ:Tags'],
Campaign:[_U,_T,'subject:VARCHAR(255)::件名:Subject',_B,_SD,'scheduled_at:TIMESTAMP::配信予定:Scheduled at','sent_at:TIMESTAMP::配信日時:Sent at'],
Analytics:['campaign_id:UUID:FK(Campaign):キャンペーンID:Campaign ID','metric:VARCHAR(50):NOT NULL:指標:Metric','value:DECIMAL(12,2):NOT NULL:値:Value','recorded_at:TIMESTAMP:DEFAULT NOW:記録日時:Recorded at'],
Plan:['plan_name:VARCHAR(100):NOT NULL:プラン名:Plan name',_PR,'interval:VARCHAR(20):DEFAULT \'monthly\':課金間隔:Billing interval','features:JSONB::機能:Features','stripe_price_id:TEXT::Stripe価格ID:Stripe price ID',_IA],
// ── PWA ──
SyncQueue:[_U,'action:VARCHAR(50):NOT NULL:操作:Action','payload:JSONB:NOT NULL:データ:Payload',_SP,'retry_count:INT:DEFAULT 0:リトライ数:Retry count'],
Setting:[_U,'key:VARCHAR(100):NOT NULL:設定キー:Setting key','value:JSONB::設定値:Value'],
// ── Booking ──
Staff:[_U,'specialty:VARCHAR(100)::専門分野:Specialty','is_available:BOOLEAN:DEFAULT true:利用可能:Available','calendar_config:JSONB::カレンダー設定:Calendar config'],
Reminder:['booking_id:UUID:FK(Booking):予約ID:Booking ID','remind_at:TIMESTAMP:NOT NULL:リマインド日時:Remind at','method:VARCHAR(20):DEFAULT \'email\':通知方法:Method','sent:BOOLEAN:DEFAULT false:送信済:Sent'],
// ── Event ──
Event:[_U,_T,_D,'venue_id:UUID:FK(Venue):会場ID:Venue ID','starts_at:TIMESTAMP:NOT NULL:開始日時:Starts at','ends_at:TIMESTAMP:NOT NULL:終了日時:Ends at','capacity:INT::定員:Capacity',_SD,'is_online:BOOLEAN:DEFAULT false:オンライン:Online'],
Ticket:['event_id:UUID:FK(Event) NOT NULL:イベントID:Event ID','ticket_type:VARCHAR(50):NOT NULL:チケット種別:Ticket type','price:DECIMAL(10,2):DEFAULT 0:価格:Price','quantity:INT:NOT NULL:枚数:Quantity','sold:INT:DEFAULT 0:販売済:Sold'],
Attendee:['event_id:UUID:FK(Event) NOT NULL:イベントID:Event ID',_U,'ticket_id:UUID:FK(Ticket):チケットID:Ticket ID','status:VARCHAR(20):DEFAULT \'registered\':参加状態:Status','checked_in_at:TIMESTAMP::チェックイン日時:Checked in at'],
Venue:['venue_name:VARCHAR(255):NOT NULL:会場名:Venue name','address:TEXT::住所:Address','capacity:INT::収容人数:Capacity','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude'],
Session:['event_id:UUID:FK(Event) NOT NULL:イベントID:Event ID',_T,'speaker:VARCHAR(255)::登壇者:Speaker','starts_at:TIMESTAMP:NOT NULL:開始:Starts at','ends_at:TIMESTAMP:NOT NULL:終了:Ends at','room:VARCHAR(100)::部屋:Room'],
Survey:['event_id:UUID:FK(Event):イベントID:Event ID',_T,'questions:JSONB:NOT NULL:質問:Questions',_IA],
// ── Health ──
HealthLog:[_U,'log_type:VARCHAR(50):NOT NULL:記録種別:Log type','value:DECIMAL(10,2):NOT NULL:値:Value','unit:VARCHAR(20)::単位:Unit','logged_at:TIMESTAMP:DEFAULT NOW:記録日時:Logged at',_N],
Workout:[_U,'workout_type:VARCHAR(50):NOT NULL:運動種別:Workout type',_DUR,'calories:INT::消費カロリー:Calories','intensity:VARCHAR(20)::強度:Intensity',_N],
Meal:[_U,'meal_type:VARCHAR(20):NOT NULL:食事種別:Meal type','food_items:JSONB::食品:Food items','calories:INT::カロリー:Calories','photo_url:TEXT::写真URL:Photo URL','logged_at:TIMESTAMP:DEFAULT NOW:記録日時:Logged at'],
Goal:[_U,'goal_type:VARCHAR(50):NOT NULL:目標種別:Goal type','target_value:DECIMAL(10,2):NOT NULL:目標値:Target value','current_value:DECIMAL(10,2):DEFAULT 0:現在値:Current value','unit:VARCHAR(20)::単位:Unit','deadline:DATE::期限:Deadline',_SA],
// ── HR ──
JobPosting:['department_id:UUID:FK(Department):部署ID:Department ID',_T,_D,'employment_type:VARCHAR(50)::雇用形態:Employment type','salary_range:VARCHAR(100)::給与レンジ:Salary range','status:VARCHAR(20):DEFAULT \'open\':募集状態:Status','closes_at:DATE::締切日:Closes at'],
Applicant:['job_id:UUID:FK(JobPosting) NOT NULL:求人ID:Job ID',_U,'applicant_name:VARCHAR(255):NOT NULL:氏名:Name','email:VARCHAR(255):NOT NULL:メール:Email','resume_url:TEXT::履歴書URL:Resume URL','status:VARCHAR(20):DEFAULT \'applied\':選考状態:Status','applied_at:TIMESTAMP:DEFAULT NOW:応募日:Applied at'],
Interview:['applicant_id:UUID:FK(Applicant) NOT NULL:応募者ID:Applicant ID','interviewer_id:UUID:FK(User) NOT NULL:面接官ID:Interviewer ID','scheduled_at:TIMESTAMP:NOT NULL:予定日時:Scheduled at','duration_min:INT:DEFAULT 60:所要時間(分):Duration(min)','interview_type:VARCHAR(50)::面接種別:Type','status:VARCHAR(20):DEFAULT \'scheduled\':ステータス:Status',_N],
Evaluation:['applicant_id:UUID:FK(Applicant) NOT NULL:応募者ID:Applicant ID','evaluator_id:UUID:FK(User) NOT NULL:評価者ID:Evaluator ID','score:INT:NOT NULL:スコア:Score','criteria:JSONB::評価基準:Criteria','comments:TEXT::コメント:Comments'],
Department:['department_name:VARCHAR(255):NOT NULL:部署名:Department name','parent_id:UUID:FK(Department):親部署ID:Parent ID','head_id:UUID:FK(User):部長ID:Head ID'],
Onboarding:[_U,'checklist:JSONB::チェックリスト:Checklist','progress:INT:DEFAULT 0:進捗(%):Progress(%)','mentor_id:UUID:FK(User):メンターID:Mentor ID','start_date:DATE::開始日:Start date','status:VARCHAR(20):DEFAULT \'in_progress\':ステータス:Status'],
// ── Link in Bio ──
Page:[_U,'slug:VARCHAR(100):UNIQUE NOT NULL:スラグ:Slug',_T,'bio:TEXT::自己紹介:Bio','theme_id:UUID:FK(Theme):テーマID:Theme ID','is_published:BOOLEAN:DEFAULT true:公開:Published'],
Link:['page_id:UUID:FK(Page) NOT NULL:ページID:Page ID',_T,'url:TEXT:NOT NULL:URL:URL',_SO,_IA,'click_count:INT:DEFAULT 0:クリック数:Clicks'],
Theme:['theme_name:VARCHAR(100):NOT NULL:テーマ名:Theme name','css_config:JSONB::CSSスタイル:CSS config','preview_url:TEXT::プレビューURL:Preview URL','is_premium:BOOLEAN:DEFAULT false:プレミアム:Premium'],
ClickLog:['link_id:UUID:FK(Link) NOT NULL:リンクID:Link ID','referrer:TEXT::リファラー:Referrer','user_agent:TEXT::ユーザーエージェント:User agent','ip_hash:VARCHAR(64)::IPハッシュ:IP hash','country:VARCHAR(2)::国コード:Country code'],
Integration:[_U,'service:VARCHAR(100):NOT NULL:サービス名:Service','access_token:TEXT::アクセストークン:Access token',_CN,_SA],
// ── Gamification ──
Badge:['badge_name:VARCHAR(100):NOT NULL:バッジ名:Badge name',_D,'icon_url:TEXT::アイコンURL:Icon URL','criteria:JSONB::獲得条件:Criteria','points:INT:DEFAULT 0:ポイント:Points'],
Challenge:[_T,_D,'challenge_type:VARCHAR(50)::種別:Type','reward_points:INT:DEFAULT 0:報酬ポイント:Reward points','starts_at:TIMESTAMP::開始日:Starts at','ends_at:TIMESTAMP::終了日:Ends at',_SA],
Reward:['reward_name:VARCHAR(255):NOT NULL:報酬名:Reward name',_D,'cost_points:INT:NOT NULL:必要ポイント:Cost points','stock:INT:DEFAULT -1:在庫(-1=無制限):Stock','reward_type:VARCHAR(50)::報酬種別:Type'],
Leaderboard:[_U,'score:INT:DEFAULT 0:スコア:Score','rank:INT::順位:Rank','period:VARCHAR(20):DEFAULT \'all_time\':期間:Period'],
PointLog:[_U,'points:INT:NOT NULL:ポイント:Points','action:VARCHAR(100):NOT NULL:操作:Action','balance_after:INT::残高:Balance after'],
Achievement:[_U,'badge_id:UUID:FK(Badge) NOT NULL:バッジID:Badge ID','earned_at:TIMESTAMP:DEFAULT NOW:獲得日時:Earned at'],
// ── Collab ──
Document:['workspace_id:UUID:FK(Workspace):ワークスペースID:Workspace ID','owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID',_T,'content:TEXT::内容:Content','doc_type:VARCHAR(50):DEFAULT \'text\':ドキュメント種別:Document type','is_public:BOOLEAN:DEFAULT false:公開:Public'],
Version:['document_id:UUID:FK(Document) NOT NULL:ドキュメントID:Document ID','author_id:UUID:FK(User) NOT NULL:著者ID:Author ID','content:TEXT:NOT NULL:内容:Content','version_number:INT:NOT NULL:バージョン:Version number','change_summary:TEXT::変更概要:Change summary'],
Permission:['document_id:UUID:FK(Document) NOT NULL:ドキュメントID:Document ID',_U,'role:VARCHAR(20):DEFAULT \'viewer\':権限:Role','granted_at:TIMESTAMP:DEFAULT NOW:付与日時:Granted at'],
// ── IoT ──
SensorData:['sensor_id:UUID:FK(Sensor) NOT NULL:センサーID:Sensor ID','value:DECIMAL(15,5):NOT NULL:測定値:Value','recorded_at:TIMESTAMP:DEFAULT NOW:記録日時:Recorded at','quality:VARCHAR(20):DEFAULT \'good\':品質:Quality'],
Command:['device_id:UUID:FK(Device) NOT NULL:デバイスID:Device ID','command_type:VARCHAR(50):NOT NULL:コマンド種別:Command type','payload:JSONB::ペイロード:Payload',_SP,'executed_at:TIMESTAMP::実行日時:Executed at'],
DeviceGroup:['group_name:VARCHAR(255):NOT NULL:グループ名:Group name',_D,_U],
// ── Community ──
Group:['owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID','group_name:VARCHAR(255):NOT NULL:グループ名:Group name',_D,'is_private:BOOLEAN:DEFAULT false:非公開:Private','member_count:INT:DEFAULT 0:メンバー数:Member count'],
// Webhook (devtool)
Webhook:[_U,'url:TEXT:NOT NULL:Webhook URL:Webhook URL','events:JSONB:NOT NULL:イベント:Events','secret:TEXT::シークレット:Secret',_IA,'last_triggered_at:TIMESTAMP::最終実行:Last triggered'],
// ── Medical/Clinic ──
Patient:[_U,'patient_name:VARCHAR(255):NOT NULL:患者名:Patient name','date_of_birth:DATE::生年月日:Date of birth','gender:VARCHAR(20)::性別:Gender','blood_type:VARCHAR(10)::血液型:Blood type','allergies:TEXT::アレルギー:Allergies','emergency_contact:VARCHAR(255)::緊急連絡先:Emergency contact'],
Doctor:[_U,'doctor_name:VARCHAR(255):NOT NULL:医師名:Doctor name','specialty:VARCHAR(100)::専門分野:Specialty','license_number:VARCHAR(100)::医師免許番号:License number','is_available:BOOLEAN:DEFAULT true:対応可能:Available'],
MedicalRecord:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','doctor_id:UUID:FK(Doctor) NOT NULL:医師ID:Doctor ID','visit_date:TIMESTAMP:DEFAULT NOW:受診日:Visit date','diagnosis:TEXT::診断:Diagnosis','treatment:TEXT::治療:Treatment','symptoms:TEXT::症状:Symptoms',_N],
Prescription:['medical_record_id:UUID:FK(MedicalRecord) NOT NULL:診療記録ID:Medical record ID','medication_name:VARCHAR(255):NOT NULL:薬剤名:Medication name','dosage:VARCHAR(100):NOT NULL:用量:Dosage','frequency:VARCHAR(100)::頻度:Frequency','duration_days:INT::処方日数:Duration(days)',_N],
Appointment:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','doctor_id:UUID:FK(Doctor) NOT NULL:医師ID:Doctor ID','scheduled_at:TIMESTAMP:NOT NULL:予約日時:Scheduled at',_DUR,'reason:TEXT::受診理由:Reason',_SP,_N],
Pet:['owner_id:UUID:FK(User) NOT NULL:飼い主ID:Owner ID','pet_name:VARCHAR(255):NOT NULL:ペット名:Pet name','species:VARCHAR(50):NOT NULL:種別:Species','breed:VARCHAR(100)::品種:Breed','date_of_birth:DATE::生年月日:Date of birth','weight_kg:DECIMAL(5,2)::体重(kg):Weight(kg)','medical_notes:TEXT::医療メモ:Medical notes'],
Vaccination:['pet_id:UUID:FK(Pet) NOT NULL:ペットID:Pet ID','vaccine_name:VARCHAR(255):NOT NULL:ワクチン名:Vaccine name','administered_at:TIMESTAMP:NOT NULL:接種日:Administered at','next_due:DATE::次回予定:Next due','veterinarian_id:UUID:FK(Doctor):獣医ID:Veterinarian ID',_N],
Veterinarian:[_U,'vet_name:VARCHAR(255):NOT NULL:獣医名:Vet name','specialty:VARCHAR(100)::専門分野:Specialty','license_number:VARCHAR(100)::免許番号:License number','is_available:BOOLEAN:DEFAULT true:対応可能:Available'],
// ── Property Management ──
Property:['owner_id:UUID:FK(User) NOT NULL:オーナーID:Owner ID','property_name:VARCHAR(255):NOT NULL:物件名:Property name','address:TEXT:NOT NULL:住所:Address','property_type:VARCHAR(50)::物件種別:Property type','units:INT:DEFAULT 1:ユニット数:Units',_SA],
Unit:['property_id:UUID:FK(Property) NOT NULL:物件ID:Property ID','unit_number:VARCHAR(50):NOT NULL:ユニット番号:Unit number','bedrooms:INT::寝室数:Bedrooms','bathrooms:INT::浴室数:Bathrooms','area_sqm:DECIMAL(8,2)::面積(m²):Area(sqm)','monthly_rent:DECIMAL(10,2)::月額家賃:Monthly rent','status:VARCHAR(20):DEFAULT \'available\':状態:Status'],
Tenant:[_U,'tenant_name:VARCHAR(255):NOT NULL:入居者名:Tenant name','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone',_N],
Lease:['unit_id:UUID:FK(Unit) NOT NULL:ユニットID:Unit ID','tenant_id:UUID:FK(Tenant) NOT NULL:入居者ID:Tenant ID','start_date:DATE:NOT NULL:開始日:Start date','end_date:DATE:NOT NULL:終了日:End date','monthly_rent:DECIMAL(10,2):NOT NULL:月額家賃:Monthly rent','deposit:DECIMAL(10,2)::敷金:Deposit','status:VARCHAR(20):DEFAULT \'active\':状態:Status'],
MaintenanceRequest:['unit_id:UUID:FK(Unit) NOT NULL:ユニットID:Unit ID','tenant_id:UUID:FK(Tenant) NOT NULL:入居者ID:Tenant ID',_T,_D,'category:VARCHAR(50)::カテゴリ:Category',_SP,'assigned_to:UUID:FK(User):担当者ID:Assigned to','completed_at:TIMESTAMP::完了日時:Completed at'],
Owner:[_U,'owner_name:VARCHAR(255):NOT NULL:オーナー名:Owner name','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','properties_count:INT:DEFAULT 0:所有物件数:Properties count'],
// ── Contract Management ──
Contract:['contract_name:VARCHAR(255):NOT NULL:契約名:Contract name','contract_type:VARCHAR(50)::契約種別:Contract type','start_date:DATE::開始日:Start date','end_date:DATE::終了日:End date','auto_renew:BOOLEAN:DEFAULT false:自動更新:Auto renew','status:VARCHAR(20):DEFAULT \'draft\':ステータス:Status','document_url:TEXT::契約書URL:Document URL','value:DECIMAL(12,2)::契約額:Contract value'],
Party:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','party_name:VARCHAR(255):NOT NULL:当事者名:Party name','party_type:VARCHAR(50):NOT NULL:当事者種別:Party type','contact_email:VARCHAR(255)::連絡先メール:Contact email','signatory:VARCHAR(255)::署名者:Signatory'],
Approval:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','approver_id:UUID:FK(User) NOT NULL:承認者ID:Approver ID','status:VARCHAR(20):DEFAULT \'pending\':ステータス:Status','approved_at:TIMESTAMP::承認日時:Approved at','comments:TEXT::コメント:Comments'],
Signature:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','signer_id:UUID:FK(User) NOT NULL:署名者ID:Signer ID','signed_at:TIMESTAMP:DEFAULT NOW:署名日時:Signed at','signature_hash:TEXT::署名ハッシュ:Signature hash','ip_address:VARCHAR(45)::IPアドレス:IP address'],
Clause:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID','clause_number:VARCHAR(20)::条項番号:Clause number',_T,'content:TEXT:NOT NULL:内容:Content',_SO],
// ── Helpdesk ──
KnowledgeArticle:[_T,'slug:VARCHAR(255):UNIQUE:スラグ:Slug','content:TEXT:NOT NULL:内容:Content',_CAT,_SA,'view_count:INT:DEFAULT 0:閲覧数:View count','helpful_count:INT:DEFAULT 0:役立った数:Helpful count'],
Response:['ticket_id:UUID:FK(Task) NOT NULL:チケットID:Ticket ID','responder_id:UUID:FK(User) NOT NULL:回答者ID:Responder ID','content:TEXT:NOT NULL:内容:Content','is_public:BOOLEAN:DEFAULT true:公開:Public'],
SLA:['name:VARCHAR(100):NOT NULL:SLA名:SLA name','priority:VARCHAR(20):NOT NULL:優先度:Priority','response_time_hours:INT:NOT NULL:応答時間(時):Response time(hours)','resolution_time_hours:INT:NOT NULL:解決時間(時):Resolution time(hours)',_IA],
Priority:[_U,'priority_level:VARCHAR(20):NOT NULL:優先度:Priority level','color:VARCHAR(7)::色:Color',_SO],
// ── Tutoring ──
Tutor:[_U,'tutor_name:VARCHAR(255):NOT NULL:講師名:Tutor name','bio:TEXT::自己紹介:Bio','hourly_rate:DECIMAL(8,2)::時給:Hourly rate','is_verified:BOOLEAN:DEFAULT false:認証済:Verified','rating:DECIMAL(3,2)::評価:Rating'],
Student:[_U,'student_name:VARCHAR(255):NOT NULL:生徒名:Student name','grade_level:VARCHAR(50)::学年:Grade level','parent_email:VARCHAR(255)::保護者メール:Parent email',_N],
Subject:['subject_name:VARCHAR(100):NOT NULL:科目名:Subject name',_D,_CAT],
Availability:['tutor_id:UUID:FK(Tutor) NOT NULL:講師ID:Tutor ID','day_of_week:INT:NOT NULL:曜日(0-6):Day of week','start_time:TIME:NOT NULL:開始時刻:Start time','end_time:TIME:NOT NULL:終了時刻:End time','is_available:BOOLEAN:DEFAULT true:利用可能:Available'],
// ── Restaurant ──
Table:['table_number:VARCHAR(20):NOT NULL:テーブル番号:Table number','capacity:INT:NOT NULL:定員:Capacity','location:VARCHAR(50)::場所:Location',_SA],
Reservation:['table_id:UUID:FK(Table) NOT NULL:テーブルID:Table ID',_U,'guest_name:VARCHAR(255):NOT NULL:予約者名:Guest name','guest_count:INT:NOT NULL:人数:Guest count','reserved_at:TIMESTAMP:NOT NULL:予約日時:Reserved at',_SP,'special_requests:TEXT::特別リクエスト:Special requests'],
MenuItem:[_T,_D,'category:VARCHAR(50)::カテゴリ:Category',_PR,'image_url:TEXT::画像URL:Image URL','is_available:BOOLEAN:DEFAULT true:提供可能:Available','allergens:JSONB::アレルゲン:Allergens'],
Shift:['staff_id:UUID:FK(User) NOT NULL:スタッフID:Staff ID','shift_date:DATE:NOT NULL:勤務日:Shift date','start_time:TIME:NOT NULL:開始時刻:Start time','end_time:TIME:NOT NULL:終了時刻:End time','role:VARCHAR(50)::役割:Role',_SA],
// ── Construction Payment ──
Contractor:['contractor_name:VARCHAR(255):NOT NULL:業者名:Contractor name','contact_person:VARCHAR(255)::担当者:Contact person','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','license_number:VARCHAR(100)::免許番号:License number',_SA],
ProgressReport:['project_id:UUID:FK(Project) NOT NULL:プロジェクトID:Project ID','contractor_id:UUID:FK(Contractor) NOT NULL:業者ID:Contractor ID','report_date:DATE:NOT NULL:報告日:Report date','completion_percentage:INT:NOT NULL:完了率(%):Completion(%)','work_summary:TEXT::作業概要:Work summary','photo_urls:JSONB::写真URL:Photo URLs',_SP],
Estimate:['project_id:UUID:FK(Project) NOT NULL:プロジェクトID:Project ID','contractor_id:UUID:FK(Contractor) NOT NULL:業者ID:Contractor ID','estimate_number:VARCHAR(50)::見積番号:Estimate number','total_amount:DECIMAL(12,2):NOT NULL:総額:Total amount','line_items:JSONB::明細:Line items',_SP,'valid_until:DATE::有効期限:Valid until'],
// ── Knowledge Base (Advanced) ──
Article:[_U,_T,'slug:VARCHAR(255):UNIQUE:スラグ:Slug','content:TEXT:NOT NULL:内容:Content',_CAT,_SD,'view_count:INT:DEFAULT 0:閲覧数:View count','version:INT:DEFAULT 1:バージョン:Version'],
AccessControl:['article_id:UUID:FK(Article) NOT NULL:記事ID:Article ID',_U,'role:VARCHAR(20):DEFAULT \'viewer\':権限:Role','granted_at:TIMESTAMP:DEFAULT NOW:付与日時:Granted at'],
SearchLog:['query:VARCHAR(500):NOT NULL:検索クエリ:Search query',_U,'results_count:INT::結果数:Results count','clicked_article_id:UUID:FK(Article):クリック記事ID:Clicked article ID','searched_at:TIMESTAMP:DEFAULT NOW:検索日時:Searched at'],
// ── Field Service ──
WorkOrder:['customer_id:UUID:FK(User) NOT NULL:顧客ID:Customer ID','technician_id:UUID:FK(User):技術者ID:Technician ID',_T,_D,'location:TEXT:NOT NULL:場所:Location','scheduled_at:TIMESTAMP::予定日時:Scheduled at',_SP,'priority:VARCHAR(20):DEFAULT \'medium\':優先度:Priority','completed_at:TIMESTAMP::完了日時:Completed at'],
Technician:[_U,'technician_name:VARCHAR(255):NOT NULL:技術者名:Technician name','skills:JSONB::スキル:Skills','certification:TEXT::資格:Certification','is_available:BOOLEAN:DEFAULT true:対応可能:Available','current_location:TEXT::現在地:Current location'],
Location:['location_name:VARCHAR(255):NOT NULL:場所名:Location name','address:TEXT:NOT NULL:住所:Address','latitude:DECIMAL(10,7)::緯度:Latitude','longitude:DECIMAL(10,7)::経度:Longitude','contact_name:VARCHAR(255)::担当者名:Contact name','contact_phone:VARCHAR(50)::電話番号:Contact phone'],
Customer:[_U,'customer_name:VARCHAR(255):NOT NULL:顧客名:Customer name','company:VARCHAR(255)::会社名:Company','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','billing_address:TEXT::請求先住所:Billing address',_N],
// ── Missing entities (A1) ──
Examination:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','doctor_id:UUID:FK(Doctor) NOT NULL:医師ID:Doctor ID','exam_date:TIMESTAMP:DEFAULT NOW:検査日:Exam date','exam_type:VARCHAR(100)::検査種別:Exam type','findings:TEXT::所見:Findings','diagnosis_code:VARCHAR(50)::診断コード:Diagnosis code',_N,_SA],
Claim:['patient_id:UUID:FK(Patient) NOT NULL:患者ID:Patient ID','invoice_id:UUID:FK(Invoice):請求書ID:Invoice ID','claim_number:VARCHAR(100):UNIQUE:請求番号:Claim number','claim_date:DATE:NOT NULL:請求日:Claim date','amount:DECIMAL(10,2):NOT NULL:金額:Amount','insurance_provider:VARCHAR(255)::保険者:Insurance provider',_SP,'paid_at:TIMESTAMP::支払日:Paid at'],
Milestone:['contract_id:UUID:FK(Contract) NOT NULL:契約ID:Contract ID',_T,_D,'due_date:DATE::期限:Due date','completion_percentage:INT:DEFAULT 0:完了率(%):Completion(%)','payment_amount:DECIMAL(12,2)::支払額:Payment amount',_SP,'completed_at:TIMESTAMP::完了日時:Completed at'],
Inventory:['item_name:VARCHAR(255):NOT NULL:品目名:Item name','sku:VARCHAR(100):UNIQUE:SKU:SKU','quantity:INT:DEFAULT 0:在庫数:Quantity','unit:VARCHAR(20)::単位:Unit','location:VARCHAR(255)::保管場所:Location','reorder_level:INT:DEFAULT 0:発注点:Reorder level',_SA],
// ── New preset entities (C1) ──
Contact:[_U,'contact_name:VARCHAR(255):NOT NULL:連絡先名:Contact name','company_id:UUID:FK(Company):企業ID:Company ID','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone','position:VARCHAR(100)::役職:Position',_N,_SA],
Deal:[_U,'deal_name:VARCHAR(255):NOT NULL:案件名:Deal name','contact_id:UUID:FK(Contact):連絡先ID:Contact ID','company_id:UUID:FK(Company):企業ID:Company ID','amount:DECIMAL(12,2)::金額:Amount','stage:VARCHAR(50):DEFAULT \'lead\':ステージ:Stage','probability:INT:DEFAULT 0:確度(%):Probability(%)','expected_close_date:DATE::成約予定日:Expected close',_N],
Company:['company_name:VARCHAR(255):NOT NULL:企業名:Company name','industry:VARCHAR(100)::業種:Industry','website:TEXT::ウェブサイト:Website','employee_count:INT::従業員数:Employee count','annual_revenue:DECIMAL(15,2)::年間売上:Annual revenue',_N,_SA],
Pipeline:['pipeline_name:VARCHAR(255):NOT NULL:パイプライン名:Pipeline name','stages:JSONB:NOT NULL:ステージ:Stages',_SO,_IA],
Shipment:['tracking_number:VARCHAR(100):UNIQUE NOT NULL:追跡番号:Tracking number','origin:TEXT:NOT NULL:出発地:Origin','destination:TEXT:NOT NULL:目的地:Destination','route_id:UUID:FK(Route):ルートID:Route ID','driver_id:UUID:FK(Driver):ドライバーID:Driver ID',_SP,'shipped_at:TIMESTAMP::出荷日時:Shipped at','delivered_at:TIMESTAMP::配達日時:Delivered at','weight_kg:DECIMAL(8,2)::重量(kg):Weight(kg)'],
Route:['route_name:VARCHAR(255):NOT NULL:ルート名:Route name','waypoints:JSONB:NOT NULL:経由地:Waypoints','distance_km:DECIMAL(10,2)::距離(km):Distance(km)','estimated_duration_min:INT::所要時間(分):Duration(min)',_IA],
Warehouse:['warehouse_name:VARCHAR(255):NOT NULL:倉庫名:Warehouse name','address:TEXT:NOT NULL:住所:Address','capacity:INT::容量:Capacity','current_stock_count:INT:DEFAULT 0:現在庫数:Current stock',_SA],
Driver:[_U,'driver_name:VARCHAR(255):NOT NULL:ドライバー名:Driver name','license_number:VARCHAR(100)::免許番号:License number','vehicle_type:VARCHAR(50)::車両種別:Vehicle type','is_available:BOOLEAN:DEFAULT true:稼働可能:Available','current_location:TEXT::現在地:Current location'],
Form:[_U,_T,_D,_SA,'is_template:BOOLEAN:DEFAULT false:テンプレート:Template','response_count:INT:DEFAULT 0:回答数:Response count'],
Question:['form_id:UUID:FK(Form) NOT NULL:フォームID:Form ID','question_text:TEXT:NOT NULL:質問文:Question text','question_type:VARCHAR(50):NOT NULL:質問種別:Question type','options:JSONB::選択肢:Options','is_required:BOOLEAN:DEFAULT false:必須:Required',_SO],
Answer:['form_id:UUID:FK(Form) NOT NULL:フォームID:Form ID','question_id:UUID:FK(Question) NOT NULL:質問ID:Question ID',_U,'answer_value:TEXT::回答値:Answer value','submitted_at:TIMESTAMP:DEFAULT NOW:回答日時:Submitted at'],
Job:['job_title:VARCHAR(255):NOT NULL:職種:Job title','company:VARCHAR(255):NOT NULL:企業名:Company','location:VARCHAR(255)::勤務地:Location','salary_range:VARCHAR(100)::給与レンジ:Salary range','job_type:VARCHAR(50)::雇用形態:Job type',_D,'status:VARCHAR(20):DEFAULT \'open\':募集状態:Status','posted_at:TIMESTAMP:DEFAULT NOW:掲載日:Posted at'],
SavedJob:[_U,'job_id:UUID:FK(Job) NOT NULL:求人ID:Job ID','saved_at:TIMESTAMP:DEFAULT NOW:保存日時:Saved at',_N],
// Reverse Engineering & Goal Management
UserGoal:[_U,'goal_title:VARCHAR(255):NOT NULL:目標タイトル:Goal title','target_value:VARCHAR(100)::目標値:Target value','current_value:VARCHAR(100)::現在値:Current value','deadline:DATE::期限:Deadline','priority:VARCHAR(20):DEFAULT \'medium\':優先度:Priority',_SA,'achieved_at:TIMESTAMP::達成日時:Achieved at'],
ReversePlan:[_U,'plan_title:VARCHAR(255):NOT NULL:計画タイトル:Plan title','goal_id:UUID:FK(UserGoal):目標ID:Goal ID','strategy:TEXT::戦略:Strategy','total_steps:INT:DEFAULT 0:総ステップ数:Total steps','completed_steps:INT:DEFAULT 0:完了ステップ数:Completed steps',_SA],
PlanStep:['plan_id:UUID:FK(ReversePlan) NOT NULL:計画ID:Plan ID','step_order:INT:NOT NULL:ステップ順序:Step order','step_title:VARCHAR(255):NOT NULL:ステップタイトル:Step title',_D,'estimated_hours:DECIMAL(5,1)::推定時間:Estimated hours',_SA,'completed_at:TIMESTAMP::完了日時:Completed at'],
ProgressTracking:['plan_id:UUID:FK(ReversePlan) NOT NULL:計画ID:Plan ID','tracked_at:TIMESTAMP:DEFAULT NOW:記録日時:Tracked at','progress_pct:DECIMAL(5,2)::進捗率:Progress pct','velocity:DECIMAL(5,2)::ベロシティ:Velocity','blockers:TEXT::障害:Blockers',_N],
PlanAdjustment:['plan_id:UUID:FK(ReversePlan) NOT NULL:計画ID:Plan ID','adjusted_at:TIMESTAMP:DEFAULT NOW:調整日時:Adjusted at','reason:TEXT:NOT NULL:調整理由:Reason','old_value:TEXT::旧値:Old value','new_value:TEXT::新値:New value',_N],
// ── Missing domain entities (M1 fix) ──
Chart:[_U,'chart_type:VARCHAR(50):NOT NULL:チャート種別:Chart type','data_source:VARCHAR(100)::データソース:Data source',_CN,'query_config:JSONB::クエリ設定:Query config',_T],
Viewing:['property_id:UUID:FK(Property) NOT NULL:物件ID:Property ID',_U,'scheduled_at:TIMESTAMP:NOT NULL:見学予定日時:Scheduled at',_SP,'feedback:TEXT::感想:Feedback','attended:BOOLEAN:DEFAULT false:出席:Attended'],
Client:['client_name:VARCHAR(255):NOT NULL:依頼者名:Client name','company:VARCHAR(255)::企業名:Company','email:VARCHAR(255)::メール:Email','phone:VARCHAR(50)::電話番号:Phone',_SA,_N],
Transfer:['from_account:UUID:FK(Account) NOT NULL:送金元口座:From account','to_account:UUID:FK(Account) NOT NULL:送金先口座:To account','amount:DECIMAL(12,2):NOT NULL:金額:Amount','currency:VARCHAR(3):DEFAULT \'JPY\':通貨:Currency','reference:VARCHAR(255)::参照番号:Reference',_SP],
Card:['account_id:UUID:FK(Account) NOT NULL:口座ID:Account ID','card_number:VARCHAR(20):NOT NULL:カード番号:Card number','card_type:VARCHAR(20)::カード種別:Card type','expiry_date:VARCHAR(7)::有効期限:Expiry date',_SA,'credit_limit:DECIMAL(10,2)::限度額:Credit limit'],
Statement:['account_id:UUID:FK(Account) NOT NULL:口座ID:Account ID','period_start:DATE:NOT NULL:期間開始:Period start','period_end:DATE:NOT NULL:期間終了:Period end','opening_balance:DECIMAL(12,2):NOT NULL:期首残高:Opening balance','closing_balance:DECIMAL(12,2):NOT NULL:期末残高:Closing balance','statement_url:TEXT::明細書URL:Statement URL'],
// ── B-1 fix: Missing entities ──
Schedule:[_U,'technician_id:UUID:FK(User) NOT NULL:技術者ID:Technician ID','work_order_id:UUID:FK(WorkOrder) NOT NULL:作業指示ID:Work Order ID','scheduled_date:DATE:NOT NULL:予定日:Scheduled Date','start_time:TIME::開始時刻:Start Time','end_time:TIME::終了時刻:End Time',_SA],
Feedback:[_U,'article_id:UUID:FK(Article) NOT NULL:記事ID:Article ID','rating:INTEGER:CHECK(rating BETWEEN 1 AND 5):評価:Rating','comment:TEXT::コメント:Comment',_SA],
// ── B-2 fix: Entity name collision resolution ──
SupportTicket:[_U,'subject:VARCHAR(255):NOT NULL:件名:Subject',_D,'priority_id:UUID:FK(Priority) NOT NULL:優先度ID:Priority ID','category_id:UUID:FK(Category):カテゴリID:Category ID','assigned_agent_id:UUID:FK(User):担当者ID:Assigned Agent ID',_SP,'sla_id:UUID:FK(SLA):SLA ID:SLA ID'],
RealEstateAgent:[_U,'agent_name:VARCHAR(255):NOT NULL:エージェント名:Agent name','license_number:VARCHAR(100)::免許番号:License number','company:VARCHAR(255)::所属会社:Company','phone:VARCHAR(50)::電話:Phone',_SA,'rating:DECIMAL(3,2)::評価:Rating'],
};
// ═══ Entity REST method restrictions ═══
// Entities not listed get full CRUD: GET, GET/:id, POST, PUT/:id, DELETE/:id
const ENTITY_METHODS={
// Immutable records: create + read only (no update/delete)
Payment:['GET','GET/:id','POST'],
Transaction:['GET','GET/:id','POST'],
Invoice:['GET','GET/:id','POST'],
// Audit/log: read only
Log:['GET','GET/:id'],
RequestLog:['GET','GET/:id'],
Activity:['GET','GET/:id'],
Execution:['GET','GET/:id'],
Handoff:['GET','GET/:id'],
// User-owned singletons: no GET/:id (use auth context)
Cart:['GET','POST','PATCH/:id','DELETE/:id'],
Setting:['GET','PATCH'],
// User: PATCH preferred over PUT
User:['GET','GET/:id','POST','PATCH/:id'],
// Enrollment/subscription: create + read + cancel (soft delete)
Enrollment:['GET','GET/:id','POST','PATCH/:id'],
Subscription:['GET','GET/:id','POST','PATCH/:id'],
Attendee:['GET','GET/:id','POST','PATCH/:id','DELETE/:id'],
// Certificate: issue only
Certificate:['GET','GET/:id','POST'],
// Medical records: create + read only (no modification for compliance)
MedicalRecord:['GET','GET/:id','POST'],
Vaccination:['GET','GET/:id','POST'],
Prescription:['GET','GET/:id','POST'],
// SLA: read-only (managed by admin)
SLA:['GET','GET/:id'],
// Contracts & Leases: limited modification (status updates only via PATCH)
Lease:['GET','GET/:id','POST','PATCH/:id'],
Contract:['GET','GET/:id','POST','PATCH/:id'],
// Append-only/Read-only (A3)
AuditLog:['GET','GET/:id'],
PointLog:['GET','GET/:id'],
Achievement:['GET','GET/:id','POST'],
ClickLog:['GET','GET/:id','POST'],
SensorData:['GET','GET/:id','POST'],
};
function getEntityMethods(entityName){
return ENTITY_METHODS[entityName]||['GET','GET/:id','POST','PUT/:id','DELETE/:id'];
}
// Parse entity column definition string
function getEntityColumns(entityName,G,knownEntities){
const cols=ENTITY_COLUMNS[entityName];
if(!cols) return [];
return cols.map(c=>{
const [col,type,constraint,descJa,descEn]=c.split(':');
return {col,type:type||'TEXT',constraint:constraint||'',desc:G?(descJa||col):(descEn||col)};
}).filter(c=>{
// If knownEntities provided, filter out FK references to undefined entities
if(!knownEntities) return true;
const fkMatch=c.constraint.match(/FK\((\w+)\)/);
if(!fkMatch) return true;
return knownEntities.includes(fkMatch[1]);
});
}
function detectDomain(purpose){
const p=(purpose||'').toLowerCase();
const detect=[
// Specific patterns first (higher priority)
[/教育|学習|education|learning|lms|コース|course|tutoring|家庭教師/i,'education'],
[/\bEC\b|eコマース|e-commerce|ショップ|\bshop\b|\bcommerce\b/i,'ec'],
[/マーケットプレイス|marketplace/i,'marketplace'],
[/ゲーミ|gamification|gamify|バッジ|ポイント|リーダーボード/i,'gamify'],
[/saas|サブスク|subscription|helpdesk|ヘルプデスク|チケット管理/i,'saas'],
[/イベント|event.?management|カンファレンス|セミナー|チケット販売/i,'event'],
[/ニュースレター|newsletter|メール配信|メルマガ|購読/i,'newsletter'],
[/クリエイター|creator|ファン|コンテンツ販売|投げ銭/i,'creator'],
[/コミュニティ|community|フォーラム|forum/i,'community'],
[/コンテンツ|content|メディア|media|ブログ|blog|knowledge.?base|ナレッジベース/i,'content'],
[/分析|analytics|可視化|ダッシュボード/i,'analytics'],
[/予約|booking|スケジュール|restaurant|レストラン|飲食店/i,'booking'],
[/AIエージェント|ai.?agent|chatbot|チャットボット|対話型|FAQ/i,'ai'],
[/自動化|automation|workflow|ワークフロー|RPA|ノーコード/i,'automation'],
[/共同編集|collaboration|collab|リアルタイム編集/i,'collab'],
[/開発者ツール|dev.?tool|API管理|APIキー/i,'devtool'],
[/IoT|デバイス|device|sensor|センサー|field.?service|フィールドサービス/i,'iot'],
[/不動産|物件|real.?estate|property.?mgmt|property.?management/i,'realestate'],
[/法務|契約|legal|contract.?mgmt|contract.?management|コンプライアンス/i,'legal'],
[/人事|HR|採用|recruit|hiring/i,'hr'],
[/金融|fintech|銀行|bank|決済管理|construction.?pay|工事代金/i,'fintech'],
[/医療|ヘルスケア|health|medical|clinic|病院|patient|患者|veterinary|動物病院|ペット/i,'health'],
[/ポートフォリオ|portfolio|link.?in.?bio|linkbio/i,'portfolio'],
[/pwa|progressive.?web|オフライン|offline/i,'tool'],
// Generic patterns last (lower priority)
[/業務|business|効率化|ツール|tool/i,'tool'],
];
for(const[rx,key]of detect){if(rx.test(p))return key;}
return null;
}
function inferER(a){
const G=S.genLang==='ja';
const domain=detectDomain(a.purpose);
const entities=(a.data_entities||'').split(/[,、]\s*/).map(e=>e.trim()).filter(Boolean);
const warnings=[];
const suggestions=[];
if(domain&&DOMAIN_ENTITIES[domain]){
const d=DOMAIN_ENTITIES[domain];
entities.forEach(e=>{
if(d.warn.includes(e)){
const alt=d.suggest[e];
if(alt){
warnings.push(G?`⚠️ ${e} は${domain}ドメインでは ${alt} に置き換えることを推奨`:`⚠️ Consider replacing ${e} with ${alt} for ${domain} domain`);
suggestions.push({from:e,to:alt});
} else {
warnings.push(G?`ℹ️ ${e} は${domain}ドメインでは一般的ではありません`:`ℹ️ ${e} is uncommon in ${domain} domain`);
}
}
});
}
// ER relationships — returns simple pairs only (no chain format)
const rels=[];
const has=(n)=>entities.some(e=>e.toLowerCase()===n.toLowerCase());
// User → various
if(has('User')&&has('Post')) rels.push('User 1 ──N Post');
if(has('User')&&has('Comment')) rels.push('User 1 ──N Comment');
if(has('User')&&has('Order')) rels.push('User 1 ──N Order');
if(has('User')&&has('Booking')) rels.push('User 1 ──N Booking');
if(has('User')&&has('Review')) rels.push('User 1 ──N Review');
if(has('User')&&has('Progress')) rels.push('User 1 ──N Progress');
if(has('User')&&has('Enrollment')) rels.push('User 1 ──N Enrollment');
if(has('User')&&has('Message')) rels.push('User 1 ──N Message');
if(has('User')&&has('Notification')) rels.push('User 1 ──N Notification');
if(has('User')&&has('Subscription')) rels.push('User 1 ──N Subscription');
if(has('User')&&has('Listing')) rels.push('User 1 ──N Listing');
if(has('User')&&has('Workspace')) rels.push('User N ──M Workspace (via Member)');
// Content
if(has('Post')&&has('Comment')) rels.push('Post 1 ──N Comment');
if(has('Post')&&has('Tag')) rels.push('Post N ──M Tag');
if(has('Post')&&has('Like')) rels.push('Post 1 ──N Like');
if(has('Post')&&has('Media')) rels.push('Post 1 ──N Media');
// EC
if(has('Product')&&has('Category')) rels.push('Product N ──1 Category');
if(has('Product')&&has('Order')) rels.push('Order N ──M Product (via OrderItem)');
if(has('Product')&&has('Review')) rels.push('Product 1 ──N Review');
if(has('Product')&&has('Cart')) rels.push('Product 1 ──N Cart');
if(has('Order')&&has('Payment')) rels.push('Order 1 ──1 Payment');
// Education
if(has('Course')&&has('Lesson')) rels.push('Course 1 ──N Lesson');
if(has('Course')&&has('Enrollment')) rels.push('Course 1 ──N Enrollment');
if(has('Course')&&has('Review')) rels.push('Course 1 ──N Review');
if(has('Course')&&has('Quiz')) rels.push('Course 1 ──N Quiz');
if(has('Lesson')&&has('Quiz')) rels.push('Lesson 1 ──N Quiz');
if(has('Lesson')&&has('Progress')) rels.push('Lesson 1 ──N Progress');
// Booking
if(has('Service')&&has('Booking')) rels.push('Service 1 ──N Booking');
if(has('Service')&&has('TimeSlot')) rels.push('Service 1 ──N TimeSlot');
// SaaS/Project
if(has('Workspace')&&has('Project')) rels.push('Workspace 1 ──N Project');
if(has('Project')&&has('Task')) rels.push('Project 1 ──N Task');
if(has('Dashboard')&&has('Widget')) rels.push('Dashboard 1 ──N Widget');
// Listing
if(has('Listing')&&has('Category')) rels.push('Listing N ──1 Category');
// IoT
if(has('Device')&&has('Sensor')) rels.push('Device 1 ──N Sensor');
// Category self-ref
if(has('Category')) rels.push('Category 0 ──N Category');
// Medical/Clinic
if(has('Patient')&&has('MedicalRecord')) rels.push('Patient 1 ──N MedicalRecord');
if(has('Doctor')&&has('MedicalRecord')) rels.push('Doctor 1 ──N MedicalRecord');
if(has('MedicalRecord')&&has('Prescription')) rels.push('MedicalRecord 1 ──N Prescription');
if(has('Patient')&&has('Appointment')) rels.push('Patient 1 ──N Appointment');
if(has('Doctor')&&has('Appointment')) rels.push('Doctor 1 ──N Appointment');
if(has('Pet')&&has('Vaccination')) rels.push('Pet 1 ──N Vaccination');
// Property Management
if(has('Property')&&has('Unit')) rels.push('Property 1 ──N Unit');
if(has('Unit')&&has('Lease')) rels.push('Unit 1 ──N Lease');
if(has('Tenant')&&has('Lease')) rels.push('Tenant 1 ──N Lease');
if(has('Unit')&&has('MaintenanceRequest')) rels.push('Unit 1 ──N MaintenanceRequest');
// Contract Management
if(has('Contract')&&has('Party')) rels.push('Contract 1 ──N Party');
if(has('Contract')&&has('Approval')) rels.push('Contract 1 ──N Approval');
if(has('Contract')&&has('Signature')) rels.push('Contract 1 ──N Signature');
if(has('Contract')&&has('Milestone')) rels.push('Contract 1 ──N Milestone');
// Restaurant
if(has('Table')&&has('Reservation')) rels.push('Table 1 ──N Reservation');
if(has('Order')&&has('MenuItem')) rels.push('Order N ──M MenuItem (via OrderItem)');
if(has('Table')&&has('Order')) rels.push('Table 1 ──N Order');
// HR
if(has('JobPosting')&&has('Applicant')) rels.push('JobPosting 1 ──N Applicant');
if(has('Applicant')&&has('Interview')) rels.push('Applicant 1 ──N Interview');
if(has('Applicant')&&has('Evaluation')) rels.push('Applicant 1 ──N Evaluation');
if(has('Department')&&has('JobPosting')) rels.push('Department 1 ──N JobPosting');
// Construction
if(has('Project')&&has('Contractor')) rels.push('Project N ──M Contractor');
if(has('Project')&&has('ProgressReport')) rels.push('Project 1 ──N ProgressReport');
if(has('Project')&&has('Estimate')) rels.push('Project 1 ──N Estimate');
// Knowledge Base
if(has('Article')&&has('SearchLog')) rels.push('Article 1 ──N SearchLog');
if(has('Article')&&has('AccessControl')) rels.push('Article 1 ──N AccessControl');
// Field Service
if(has('WorkOrder')&&has('Technician')) rels.push('WorkOrder N ──1 Technician');
if(has('WorkOrder')&&has('Location')) rels.push('WorkOrder N ──1 Location');
if(has('Customer')&&has('WorkOrder')) rels.push('Customer 1 ──N WorkOrder');
if(has('WorkOrder')&&has('Inventory')) rels.push('WorkOrder N ──M Inventory (via WorkOrderItem)');
// Gaming
if(has('User')&&has('Badge')) rels.push('User N ──M Badge (via Achievement)');
if(has('User')&&has('Challenge')) rels.push('User N ──M Challenge');
if(has('User')&&has('PointLog')) rels.push('User 1 ──N PointLog');
if(has('Badge')&&has('Achievement')) rels.push('Badge 1 ──N Achievement');
// Medical (Examination & Claim)
if(has('Patient')&&has('Examination')) rels.push('Patient 1 ──N Examination');
if(has('Doctor')&&has('Examination')) rels.push('Doctor 1 ──N Examination');
if(has('Patient')&&has('Claim')) rels.push('Patient 1 ──N Claim');
if(has('Invoice')&&has('Claim')) rels.push('Invoice 1 ──1 Claim');
return {domain,warnings,suggestions,relationships:rels};
}
// ── Feature Detail Dictionary ──
// Provides acceptance criteria and test cases per feature pattern
const FEATURE_DETAILS={
'ユーザー認証|認証|Auth|ログイン|Login|SignUp':{
criteria_ja:['メール+パスワードでの新規登録','ソーシャルログイン({auth})','パスワードリセットメール送信','セッション管理・自動トークンリフレッシュ','ログアウト後のトークン無効化','プロフィール表示・編集'],
criteria_en:['Email + password registration','Social login ({auth})','Password reset email','Session management / auto token refresh','Token invalidation on logout','Profile view & edit'],
tests_ja:[['正常系: メール+パスワードで登録','201, ユーザー作成・セッション開始'],['正常系: ソーシャルログイン','302, OAuth認証→コールバック→セッション'],['正常系: パスワードリセット','200, リセットメール送信'],['異常系: 重複メールで登録','409/422, メール重複エラー'],['異常系: 不正パスワード(8文字未満)','422, バリデーションエラー'],['異常系: 無効トークンでアクセス','401, Unauthorized']],
tests_en:[['Normal: Register with email+password','201, user created + session start'],['Normal: Social login','302, OAuth → callback → session'],['Normal: Password reset','200, reset email sent'],['Error: Duplicate email','409/422, email already exists'],['Error: Weak password(<8 chars)','422, validation error'],['Error: Invalid token','401, Unauthorized']],
},
'コース管理|コース|Course|講座':{
criteria_ja:['コース作成(タイトル/説明/サムネイル/価格)','コース一覧(検索/フィルタ/ページネーション)','コース詳細表示','下書き↔公開のステータス管理','講師のみ編集可能(RLS)','カテゴリ/タグによる分類'],
criteria_en:['Create course (title/desc/thumbnail/price)','List courses (search/filter/pagination)','Course detail view','Draft ↔ published status toggle','Instructor-only edit (RLS)','Category/tag classification'],
tests_ja:[['正常系: コース作成(全フィールド)','201, DBにコース保存'],['正常系: ステータス変更(draft→published)','200, 公開日時記録'],['正常系: 一覧検索+フィルタ','200, フィルタ結果返却'],['異常系: 未認証でコース作成','401'],['異常系: 他講師のコースを編集','403 (RLS拒否)'],['異常系: タイトル空で作成','422, バリデーション']],
tests_en:[['Normal: Create course (all fields)','201, course saved'],['Normal: Status change (draft→published)','200, publish date recorded'],['Normal: List with search+filter','200, filtered results'],['Error: Create without auth','401'],['Error: Edit other instructor\'s course','403 (RLS denied)'],['Error: Create with empty title','422, validation']],
},
'進捗管理|進捗|Progress|学習進捗':{
criteria_ja:['レッスン完了の記録','コース全体の進捗率算出','学習履歴の一覧表示','完了条件: レッスンページ閲覧完了','進捗ダッシュボード(統計/グラフ)'],
criteria_en:['Record lesson completion','Calculate overall course progress','Learning history list','Completion: lesson page viewed','Progress dashboard (stats/charts)'],
tests_ja:[['正常系: レッスン完了を記録','200, progress.status=completed'],['正常系: コース進捗率取得','200, {progress_pct: 60}'],['正常系: 全完了でコース修了','200, enrollment.status=completed'],['異常系: 未受講コースの進捗記録','403/404'],['異常系: 同レッスン二重完了','200, 冪等(既存更新)']],
tests_en:[['Normal: Mark lesson complete','200, progress.status=completed'],['Normal: Get course progress','200, {progress_pct: 60}'],['Normal: All done = course complete','200, enrollment.status=completed'],['Error: Progress on unenrolled course','403/404'],['Error: Double complete same lesson','200, idempotent']],
},
'サブスクリプション|課金|Billing|Stripe|決済|Payment|サブスク':{
criteria_ja:['プラン選択画面(Free/Pro/Enterprise)','Stripe Checkout セッション作成','Webhook処理(invoice.paid, customer.subscription.deleted)','課金状態表示(アクティブ/期限切れ/解約済)','プラン変更/解約フロー','無料トライアル期間設定'],
criteria_en:['Plan selection (Free/Pro/Enterprise)','Create Stripe Checkout session','Webhook (invoice.paid, subscription.deleted)','Billing status display (active/expired/canceled)','Plan change / cancel flow','Free trial period config'],
tests_ja:[['正常系: Checkout セッション作成','200, checkout URL返却'],['正常系: Webhook invoice.paid 受信','200, subscription.status=active'],['正常系: プラン変更(Pro→Enterprise)','200, 次期間から適用'],['正常系: サブスク解約','200, 期間末まで有効'],['異常系: 無効Webhook署名','400, 署名検証失敗'],['異常系: 未認証でCheckout作成','401']],
tests_en:[['Normal: Create checkout session','200, checkout URL returned'],['Normal: Webhook invoice.paid','200, subscription.status=active'],['Normal: Plan change (Pro→Enterprise)','200, applied next period'],['Normal: Cancel subscription','200, valid until period end'],['Error: Invalid webhook signature','400, sig verification failed'],['Error: Checkout without auth','401']],
},
'管理(ダッシュボード|画面)|Admin|管理者|ダッシュボード管理':{
criteria_ja:['管理者ログイン(role=adminチェック)','ユーザー一覧/検索/停止','コンテンツ管理(一覧/承認/削除)','売上/統計ダッシュボード','監査ログ閲覧'],
criteria_en:['Admin login (role=admin check)','User list/search/suspend','Content management (list/approve/delete)','Revenue/stats dashboard','Audit log viewer'],
tests_ja:[['正常系: 管理者でアクセス','200, 管理画面表示'],['正常系: ユーザー停止','200, user.status=suspended'],['正常系: コンテンツ承認','200, content.status=approved'],['異常系: 一般ユーザーで管理画面アクセス','403'],['異常系: 管理者が自分を停止','422/403']],
tests_en:[['Normal: Admin access','200, admin panel displayed'],['Normal: Suspend user','200, user.status=suspended'],['Normal: Approve content','200, content.status=approved'],['Error: Non-admin access','403'],['Error: Admin suspend self','422/403']],
},
'商品管理|商品|Product|商品一覧':{
criteria_ja:['商品登録(名前/説明/価格/画像/SKU)','商品一覧(検索/カテゴリフィルタ/ページネーション)','在庫管理(入荷/出荷)','商品詳細表示','カテゴリ管理(CRUD/階層構造)'],
criteria_en:['Register product (name/desc/price/image/SKU)','Product list (search/filter/pagination)','Inventory management','Product detail view','Category management (CRUD/hierarchy)'],
tests_ja:[['正常系: 商品登録','201, 商品DBに保存'],['正常系: 在庫更新','200, stock数更新'],['正常系: カテゴリフィルタ','200, フィルタ結果'],['異常系: 価格が負数','422'],['異常系: SKU重複','409/422'],['異常系: 在庫0で購入','422, 在庫不足']],
tests_en:[['Normal: Register product','201, saved to DB'],['Normal: Update stock','200, stock updated'],['Normal: Category filter','200, filtered results'],['Error: Negative price','422'],['Error: Duplicate SKU','409/422'],['Error: Buy with 0 stock','422, out of stock']],
},
'注文|Order|カート|Cart|購入':{
criteria_ja:['カートに商品追加/数量変更/削除','カートから注文作成','注文履歴一覧','注文ステータス管理(pending→paid→shipped→delivered)','注文キャンセル(条件付き)'],
criteria_en:['Add/update/remove cart items','Create order from cart','Order history list','Order status flow (pending→paid→shipped→delivered)','Conditional order cancel'],
tests_ja:[['正常系: カート追加→注文作成','201, order作成+cart空に'],['正常系: 注文ステータス更新','200, status遷移'],['正常系: 注文キャンセル(pending)','200, status=cancelled'],['異常系: 空カートで注文','422'],['異常系: shipped後キャンセル','422, キャンセル不可']],
tests_en:[['Normal: Cart add → create order','201, order created + cart cleared'],['Normal: Update order status','200, status transition'],['Normal: Cancel (pending)','200, status=cancelled'],['Error: Order from empty cart','422'],['Error: Cancel after shipped','422, not cancellable']],
},
'コメント|Comment|レビュー|Review':{
criteria_ja:['コメント/レビュー投稿(本文+評価)','一覧表示(ページネーション)','投稿者のみ編集/削除可能','不適切コンテンツの報告機能'],
criteria_en:['Post comment/review (body+rating)','List with pagination','Author-only edit/delete','Report inappropriate content'],
tests_ja:[['正常系: レビュー投稿(rating=5)','201, レビュー保存'],['正常系: 自分のレビュー削除','204'],['異常系: 未認証で投稿','401'],['異常系: 他人のレビュー削除','403'],['異常系: rating範囲外(0 or 6)','422']],
tests_en:[['Normal: Post review (rating=5)','201, review saved'],['Normal: Delete own review','204'],['Error: Post without auth','401'],['Error: Delete other\'s review','403'],['Error: Rating out of range','422']],
},
'投稿|Post|記事|Article|ブログ|Blog|コンテンツ投稿':{
criteria_ja:['記事作成(タイトル/本文/スラグ/サムネイル)','下書き↔公開のステータス管理','一覧表示(検索/タグフィルタ/ページネーション)','Markdown/リッチテキストエディタ','OGP/SEOメタデータ設定'],
criteria_en:['Create post (title/body/slug/thumbnail)','Draft ↔ published status','List (search/tag filter/pagination)','Markdown/rich text editor','OGP/SEO metadata'],
tests_ja:[['正常系: 記事作成(下書き)','201, status=draft'],['正常系: 公開','200, published_at記録'],['正常系: スラグ検索','200, 記事返却'],['異常系: スラグ重複','409/422'],['異常系: 未認証で作成','401']],
tests_en:[['Normal: Create draft post','201, status=draft'],['Normal: Publish','200, published_at set'],['Normal: Slug search','200, post returned'],['Error: Duplicate slug','409/422'],['Error: Create without auth','401']],
},
'予約|Booking|スケジュール|Appointment':{
criteria_ja:['空き枠表示(カレンダービュー)','予約作成(日時/サービス選択)','予約確認メール送信','予約キャンセル/変更','リマインダー通知'],
criteria_en:['Available slots (calendar view)','Create booking (date/service)','Booking confirmation email','Cancel/reschedule booking','Reminder notification'],
tests_ja:[['正常系: 空き枠から予約作成','201, booking作成'],['正常系: 予約キャンセル','200, status=cancelled'],['異常系: 過去日時で予約','422'],['異常系: 同時刻に二重予約','409, 枠なし'],['異常系: 未認証で予約','401']],
tests_en:[['Normal: Book from available slot','201, booking created'],['Normal: Cancel booking','200, status=cancelled'],['Error: Book past datetime','422'],['Error: Double book same slot','409, no availability'],['Error: Book without auth','401']],
},
'タスク管理|タスク|Task|Todo|プロジェクト管理':{
criteria_ja:['タスク作成(タイトル/担当者/期日/優先度)','カンバンボード表示(todo/in_progress/done)','ドラッグ&ドロップでステータス変更','フィルタ(担当者/優先度/期日)','期日リマインダー通知'],
criteria_en:['Create task (title/assignee/due/priority)','Kanban board (todo/in_progress/done)','D&D status change','Filter (assignee/priority/due)','Due date reminder'],
tests_ja:[['正常系: タスク作成','201, task保存'],['正常系: ステータス変更(todo→done)','200, status更新'],['正常系: 担当者フィルタ','200, フィルタ結果'],['異常系: 他ワークスペースのタスク編集','403'],['異常系: タイトル空で作成','422']],
tests_en:[['Normal: Create task','201, task saved'],['Normal: Status change (todo→done)','200, status updated'],['Normal: Filter by assignee','200, filtered'],['Error: Edit other workspace task','403'],['Error: Create with empty title','422']],
},
'ファイルアップロード|Upload|メディア|Media|画像':{
criteria_ja:['ファイルアップロード(ドラッグ&ドロップ対応)','アップロード制限(10MB/画像・PDF)','プレビュー表示','ストレージ管理(Supabase Storage/S3)'],
criteria_en:['File upload (drag & drop)','Upload limit (10MB/image/PDF)','Preview display','Storage (Supabase Storage/S3)'],
tests_ja:[['正常系: 画像アップロード','201, URL返却'],['正常系: プレビュー表示','200, 画像取得'],['異常系: 10MB超ファイル','413/422, サイズ制限'],['異常系: 非対応形式(.exe)','422, 形式エラー'],['異常系: 未認証アップロード','401']],
tests_en:[['Normal: Image upload','201, URL returned'],['Normal: Preview','200, image fetched'],['Error: >10MB file','413/422, size limit'],['Error: Unsupported format(.exe)','422'],['Error: Upload without auth','401']],
},
'検索|フィルタ|Search|Filter|絞り込み':{
criteria_ja:['全文検索(タイトル/本文)','複合フィルタ(カテゴリ/タグ/日付範囲)','ソート(新着/人気/価格)','ページネーション(無限スクロール対応)','検索履歴保存'],
criteria_en:['Full-text search (title/body)','Multi-filter (category/tag/date range)','Sort (newest/popular/price)','Pagination (infinite scroll)','Search history'],
tests_ja:[['正常系: キーワード検索','200, マッチ結果返却'],['正常系: フィルタ+ソート組合せ','200, 複合条件適用'],['正常系: ページネーション','200, offset/limit適用'],['異常系: 不正なソート値','422, バリデーション'],['異常系: 空クエリ','200, 全件返却']],
tests_en:[['Normal: Keyword search','200, matched results'],['Normal: Filter + sort combo','200, multi-condition applied'],['Normal: Pagination','200, offset/limit applied'],['Error: Invalid sort value','422, validation'],['Error: Empty query','200, all results']],
},
'通知|リマインダー|Notification|Reminder|アラート':{
criteria_ja:['プッシュ通知(ブラウザ/モバイル)','メール通知(Resend/SendGrid)','通知一覧表示','既読/未読管理','通知設定(ON/OFF切替)','リマインダー自動送信'],
criteria_en:['Push notifications (browser/mobile)','Email notifications (Resend/SendGrid)','Notification list','Read/unread management','Notification settings toggle','Auto reminder send'],
tests_ja:[['正常系: 通知作成+送信','201, 通知DB保存+送信'],['正常系: 既読更新','200, read_at記録'],['正常系: 通知設定OFF','200, 送信スキップ'],['異常系: 未認証で通知一覧','401'],['異常系: 他ユーザーの通知既読','403']],
tests_en:[['Normal: Create + send notification','201, saved + sent'],['Normal: Mark as read','200, read_at set'],['Normal: Notifications OFF','200, sending skipped'],['Error: List without auth','401'],['Error: Mark other\'s notification','403']],
},
'分析|レポート|Analytics|Report|統計|集計':{
criteria_ja:['KPI集計(日次/週次/月次)','グラフ表示(recharts/Chart.js)','CSV/PDFエクスポート','カスタムレポート作成','リアルタイム更新(WebSocket/SSE)'],
criteria_en:['KPI aggregation (daily/weekly/monthly)','Chart display (recharts/Chart.js)','CSV/PDF export','Custom report builder','Real-time updates (WebSocket/SSE)'],
tests_ja:[['正常系: 期間指定集計','200, 集計結果返却'],['正常系: CSVエクスポート','200, CSV生成'],['正常系: グラフデータ取得','200, データポイント配列'],['異常系: 未来日で集計','422, 日付バリデーション'],['異常系: 大量データでタイムアウト','503/504, クエリ最適化必要']],
tests_en:[['Normal: Aggregate by period','200, aggregated results'],['Normal: CSV export','200, CSV generated'],['Normal: Get chart data','200, data points array'],['Error: Aggregate future dates','422, date validation'],['Error: Large data timeout','503/504, query optimization needed']],
},
'チーム|権限|Team|Permission|RBAC|招待':{
criteria_ja:['チーム作成・メンバー招待','ロール管理(owner/admin/member/viewer)','招待メール送信','権限チェック(RLS/middleware)','チームメンバー一覧表示'],
criteria_en:['Create team & invite members','Role management (owner/admin/member/viewer)','Send invitation email','Permission check (RLS/middleware)','Team member list'],
tests_ja:[['正常系: メンバー招待','201, 招待メール送信'],['正常系: ロール変更(member→admin)','200, 権限更新'],['正常系: メンバー削除','204'],['異常系: viewer権限でメンバー招待','403, 権限不足'],['異常系: 重複招待','409, 既存メンバー']],
tests_en:[['Normal: Invite member','201, invitation sent'],['Normal: Change role (member→admin)','200, permission updated'],['Normal: Remove member','204'],['Error: Viewer invites member','403, insufficient permissions'],['Error: Duplicate invitation','409, already member']],
},
'チャット|メッセージ|Chat|Message|DM|リアルタイム':{
criteria_ja:['リアルタイムメッセージ送受信(WebSocket/Supabase Realtime)','メッセージ一覧(ページネーション)','未読件数表示','既読管理','ファイル添付','メッセージ削除(24時間以内)'],
criteria_en:['Real-time messaging (WebSocket/Supabase Realtime)','Message list (pagination)','Unread count','Read receipts','File attachment','Delete message (within 24h)'],
tests_ja:[['正常系: メッセージ送信','201, 送受信者に配信'],['正常系: 既読更新','200, read_at記録'],['正常系: 未読件数取得','200, {unread: 5}'],['異常系: 未認証で送信','401'],['異常系: 24時間後に削除','422, 削除不可']],
tests_en:[['Normal: Send message','201, delivered to sender/receiver'],['Normal: Mark as read','200, read_at set'],['Normal: Get unread count','200, {unread: 5}'],['Error: Send without auth','401'],['Error: Delete after 24h','422, cannot delete']],
},
'エクスポート|Export|PDF|CSV|ダウンロード':{
criteria_ja:['CSV一括エクスポート','PDF生成(請求書/契約書/レポート)','エクスポート履歴保存','バックグラウンド処理(大量データ)','ZIP圧縮(複数ファイル)'],
criteria_en:['Bulk CSV export','PDF generation (invoices/contracts/reports)','Export history','Background processing (large data)','ZIP compression (multi-file)'],
tests_ja:[['正常系: CSV一括エクスポート','200, CSV生成+ダウンロード'],['正常系: PDF請求書生成','200, PDF URL返却'],['正常系: 複数ファイルZIP','200, ZIP生成'],['異常系: 大量データでメモリ不足','500, バッチ処理推奨'],['異常系: 未認証でエクスポート','401']],
tests_en:[['Normal: Bulk CSV export','200, CSV generated + download'],['Normal: Generate PDF invoice','200, PDF URL returned'],['Normal: Multi-file ZIP','200, ZIP created'],['Error: Large data OOM','500, recommend batch'],['Error: Export without auth','401']],
},
'カレンダー|スケジュール|Calendar|Schedule|日程調整':{
criteria_ja:['カレンダー表示(日/週/月ビュー)','予定作成・編集・削除','ドラッグ&ドロップで日時変更','Googleカレンダー連携','定期予定設定(毎週/毎月)'],
criteria_en:['Calendar view (day/week/month)','Create/edit/delete events','D&D reschedule','Google Calendar sync','Recurring events (weekly/monthly)'],
tests_ja:[['正常系: 予定作成','201, カレンダーに表示'],['正常系: D&Dで日時変更','200, starts_at更新'],['正常系: 定期予定作成','201, 繰り返し設定保存'],['異常系: 過去日時で作成','422, 日付バリデーション'],['異常系: 重複予定作成','409, 枠なし']],
tests_en:[['Normal: Create event','201, shown on calendar'],['Normal: D&D reschedule','200, starts_at updated'],['Normal: Create recurring event','201, recurrence saved'],['Error: Create in past','422, date validation'],['Error: Double-book slot','409, conflict']],
},
'在庫管理|Inventory|在庫|Stock|入出庫':{
criteria_ja:['在庫数リアルタイム表示','入庫/出庫記録','在庫アラート(低在庫/過剰在庫)','ロット管理(賞味期限/シリアル番号)','棚卸し機能'],
criteria_en:['Real-time stock display','Inbound/outbound records','Stock alerts (low/excess)','Lot management (expiry/serial)','Inventory count'],
tests_ja:[['正常系: 入庫記録','201, 在庫数増加'],['正常系: 出庫記録','200, 在庫数減少'],['正常系: 低在庫アラート','200, stock<10で通知'],['異常系: 在庫0で出庫','422, 在庫不足'],['異常系: 負数で入庫','422, 数量バリデーション']],
tests_en:[['Normal: Inbound record','201, stock increased'],['Normal: Outbound record','200, stock decreased'],['Normal: Low stock alert','200, notify when stock<10'],['Error: Outbound with 0 stock','422, out of stock'],['Error: Negative inbound','422, quantity validation']],
},
'ソーシャル|フォロー|いいね|Social|Follow|Like|Share':{
criteria_ja:['ユーザーフォロー/アンフォロー','フォロワー/フォロー中一覧','いいね機能','シェア機能','フィードタイムライン(フォロー中のみ)','ブロック機能'],
criteria_en:['User follow/unfollow','Followers/following list','Like feature','Share feature','Feed timeline (following only)','Block feature'],
tests_ja:[['正常系: ユーザーフォロー','201, フォロー記録'],['正常系: いいね追加','201, Like記録'],['正常系: フィード取得','200, フォロー中の投稿のみ'],['異常系: 自分をフォロー','422, 自己フォロー不可'],['異常系: 重複いいね','409, 既存いいね']],
tests_en:[['Normal: Follow user','201, follow recorded'],['Normal: Add like','201, Like saved'],['Normal: Get feed','200, following posts only'],['Error: Self-follow','422, cannot follow self'],['Error: Duplicate like','409, already liked']],
},
'設定|環境設定|Settings|Preferences|Config':{
criteria_ja:['プロフィール編集','パスワード変更','メール通知設定','プライバシー設定','テーマ切替(ダーク/ライト)','言語設定','アカウント削除'],
criteria_en:['Profile edit','Password change','Email notification settings','Privacy settings','Theme toggle (dark/light)','Language settings','Account deletion'],
tests_ja:[['正常系: プロフィール更新','200, 変更反映'],['正常系: パスワード変更','200, パスワードハッシュ更新'],['正常系: 通知OFF','200, 設定保存'],['異常系: 弱いパスワード','422, バリデーション'],['異常系: アカウント削除(確認なし)','400, 確認必須']],
tests_en:[['Normal: Update profile','200, changes applied'],['Normal: Change password','200, hash updated'],['Normal: Notifications OFF','200, setting saved'],['Error: Weak password','422, validation'],['Error: Delete account (no confirm)','400, confirmation required']],
},
'MFA|2FA|二段階認証|多要素認証|TOTP':{
criteria_ja:['TOTPセットアップ(QRコード表示)','バックアップコード生成','ログイン時のOTP検証','信頼済みデバイス登録','MFA無効化(パスワード確認)'],
criteria_en:['TOTP setup (QR code)','Backup code generation','OTP verification on login','Trusted device registration','Disable MFA (password confirm)'],
tests_ja:[['正常系: TOTP有効化','200, QRコード+秘密鍵返却'],['正常系: OTP検証','200, ログイン成功'],['正常系: バックアップコード使用','200, コード無効化'],['異常系: 不正OTP','401, 認証失敗'],['異常系: 期限切れOTP','401, タイムアウト']],
tests_en:[['Normal: Enable TOTP','200, QR code + secret returned'],['Normal: Verify OTP','200, login success'],['Normal: Use backup code','200, code invalidated'],['Error: Invalid OTP','401, auth failed'],['Error: Expired OTP','401, timeout']],
},
'Webhook|連携|Integration|API連携':{
criteria_ja:['Webhook URL登録','イベント選択(作成/更新/削除)','署名検証(HMAC)','リトライ設定(最大3回)','Webhook履歴・ログ','テストペイロード送信'],
criteria_en:['Webhook URL registration','Event selection (create/update/delete)','Signature verification (HMAC)','Retry settings (max 3)','Webhook history & logs','Test payload send'],
tests_ja:[['正常系: Webhook登録','201, URL保存+シークレット生成'],['正常系: イベントトリガー','200, Webhook送信'],['正常系: 署名検証','200, HMACマッチ'],['異常系: 不正署名','401, 検証失敗'],['異常系: 3回リトライ失敗','500, Webhook無効化']],
tests_en:[['Normal: Register webhook','201, URL saved + secret generated'],['Normal: Event trigger','200, webhook sent'],['Normal: Verify signature','200, HMAC match'],['Error: Invalid signature','401, verification failed'],['Error: 3 retries failed','500, webhook disabled']],
},
'オンボーディング|チュートリアル|Onboarding|Tutorial|ガイド':{
criteria_ja:['初回ログイン時のステップ表示','チェックリスト進捗管理','ツールチップガイド','スキップ機能','完了時のバッジ/報酬'],
criteria_en:['Step display on first login','Checklist progress tracking','Tooltip guides','Skip feature','Badge/reward on completion'],
tests_ja:[['正常系: チェックリスト表示','200, 未完了ステップ返却'],['正常系: ステップ完了','200, 進捗更新'],['正常系: スキップ','200, オンボーディング終了'],['異常系: 完了済みステップを再度完了','200, 冪等'],['正常系: 全ステップ完了','200, バッジ付与']],
tests_en:[['Normal: Show checklist','200, incomplete steps returned'],['Normal: Complete step','200, progress updated'],['Normal: Skip','200, onboarding ended'],['Error: Re-complete finished step','200, idempotent'],['Normal: All steps done','200, badge granted']],
},
'APIキー|開発者|API Key|Developer|トークン管理':{
criteria_ja:['APIキー発行(プレフィックス表示)','権限スコープ設定(read/write)','有効期限設定','キー無効化/削除','使用状況ダッシュボード','レート制限設定'],
criteria_en:['API key issuance (prefix display)','Permission scope (read/write)','Expiration date setting','Key revocation/deletion','Usage dashboard','Rate limit config'],
tests_ja:[['正常系: APIキー発行','201, キー返却(1回のみ)'],['正常系: スコープ制限でアクセス','200, read権限OK'],['正常系: キー無効化','204, 以降401'],['異常系: 有効期限切れキー','401, Expired'],['異常系: レート制限超過','429, Too Many Requests']],
tests_en:[['Normal: Issue API key','201, key returned (once)'],['Normal: Scoped access','200, read permission OK'],['Normal: Revoke key','204, 401 after'],['Error: Expired key','401, Expired'],['Error: Rate limit exceeded','429, Too Many Requests']],
},
'監査ログ|履歴|Audit|Log|History|アクティビティ':{
criteria_ja:['全操作の記録(作成/更新/削除)','ユーザー・IPアドレス記録','タイムスタンプ','フィルタ・検索機能','エクスポート(CSV/JSON)','保持期間設定(90日)'],
criteria_en:['Record all operations (create/update/delete)','User & IP address logging','Timestamp','Filter & search','Export (CSV/JSON)','Retention period (90 days)'],
tests_ja:[['正常系: ログ記録','201, AuditLog保存'],['正常系: ログ検索','200, フィルタ結果返却'],['正常系: CSV エクスポート','200, CSV生成'],['異常系: 管理者以外がアクセス','403, 権限不足'],['正常系: 90日以前のログ削除','200, 自動削除']],
tests_en:[['Normal: Log record','201, AuditLog saved'],['Normal: Log search','200, filtered results'],['Normal: CSV export','200, CSV generated'],['Error: Non-admin access','403, insufficient permissions'],['Normal: Delete logs >90 days','200, auto-deleted']],
},
'地図|位置情報|Map|Location|Geo|GPS':{
criteria_ja:['地図表示(Google Maps/Mapbox)','位置情報取得(Geolocation API)','住所→座標変換(Geocoding)','近隣検索(半径N km以内)','ルート案内','マーカー/ピン表示'],
criteria_en:['Map display (Google Maps/Mapbox)','Location acquisition (Geolocation API)','Address→coordinate (Geocoding)','Nearby search (within N km)','Route guidance','Marker/pin display'],
tests_ja:[['正常系: 位置情報取得','200, 緯度経度返却'],['正常系: 住所→座標変換','200, ジオコーディング成功'],['正常系: 近隣検索','200, 半径5km以内の結果'],['異常系: 位置情報拒否','403, Geolocation denied'],['異常系: 不正な住所','422, ジオコーディング失敗']],
tests_en:[['Normal: Get location','200, lat/lng returned'],['Normal: Address→coordinate','200, geocoding success'],['Normal: Nearby search','200, results within 5km'],['Error: Location denied','403, Geolocation denied'],['Error: Invalid address','422, geocoding failed']],
},
'インポート|移行|Import|Migration|データ取込':{
criteria_ja:['CSVインポート','Excel(XLSX)インポート','データバリデーション','重複チェック','エラーレポート','バックグラウンド処理(大量データ)','ロールバック機能'],
criteria_en:['CSV import','Excel (XLSX) import','Data validation','Duplicate check','Error report','Background processing (large data)','Rollback feature'],
tests_ja:[['正常系: CSVインポート(100件)','201, 100件登録'],['正常系: バリデーションエラー','422, エラー行リスト返却'],['正常系: 重複スキップ','200, 重複行除外'],['異常系: 不正フォーマット','422, CSVパース失敗'],['正常系: 大量データ(10万件)','202, バックグラウンド処理']],
tests_en:[['Normal: Import CSV (100 rows)','201, 100 rows inserted'],['Normal: Validation error','422, error row list returned'],['Normal: Skip duplicates','200, duplicate rows excluded'],['Error: Invalid format','422, CSV parse failed'],['Normal: Large data (100k rows)','202, background processing']],
},
'テンプレート|ワークフロー|Template|Workflow|自動化':{
criteria_ja:['テンプレート作成・保存','変数/プレースホルダー','条件分岐','承認フロー','スケジュール実行','実行履歴・ログ'],
criteria_en:['Template creation & save','Variables/placeholders','Conditional branching','Approval flow','Scheduled execution','Execution history & logs'],
tests_ja:[['正常系: テンプレート作成','201, テンプレート保存'],['正常系: 変数展開','200, プレースホルダー置換'],['正常系: 条件分岐実行','200, 条件マッチで分岐'],['異常系: 不正な変数名','422, バリデーション'],['正常系: スケジュール実行','200, 毎日9時に自動実行']],
tests_en:[['Normal: Create template','201, template saved'],['Normal: Variable expansion','200, placeholders replaced'],['Normal: Conditional execution','200, branched on condition'],['Error: Invalid variable name','422, validation'],['Normal: Scheduled execution','200, auto-run daily at 9am']],
},
'リバースエンジニアリング|逆算|Reverse|Goal|目標分解':{
criteria_ja:['目標設定(KPI+期限)','逆算プラン生成','ステップ分割(工数見積)','進捗トラッキング','計画調整履歴','ベロシティ測定'],
criteria_en:['Goal setting (KPI + deadline)','Reverse plan generation','Step breakdown (effort estimation)','Progress tracking','Plan adjustment history','Velocity measurement'],
tests_ja:[['正常系: 目標作成','201, UserGoal保存'],['正常系: 逆算プラン生成','201, ReversePlan+PlanStep'],['正常系: 進捗記録','200, ProgressTracking追加'],['正常系: 計画調整','200, PlanAdjustment記録'],['正常系: ベロシティ算出','200, {velocity: 1.2}']],
tests_en:[['Normal: Create goal','201, UserGoal saved'],['Normal: Generate reverse plan','201, ReversePlan+PlanStep'],['Normal: Record progress','200, ProgressTracking added'],['Normal: Adjust plan','200, PlanAdjustment recorded'],['Normal: Calculate velocity','200, {velocity: 1.2}']],
},
'スキル自動化|Skill|Manus|タスク分解':{
criteria_ja:['スキル定義(Input/Process/Output)','スキルカタログ','パイプライン設計','エージェント連携','実行履歴'],
criteria_en:['Skill definition (Input/Process/Output)','Skill catalog','Pipeline design','Agent coordination','Execution history'],
tests_ja:[['正常系: スキル登録','201, スキル保存'],['正常系: パイプライン実行','200, 全ステップ完了'],['異常系: 無限ループ検出','500, タイムアウト'],['正常系: 並列実行','200, 3スキル同時実行']],
tests_en:[['Normal: Register skill','201, skill saved'],['Normal: Execute pipeline','200, all steps completed'],['Error: Infinite loop detection','500, timeout'],['Normal: Parallel execution','200, 3 skills concurrent']],
},
'品質インテリジェンス|QA|Quality|テスト戦略':{
criteria_ja:['業種別テストマトリクス','リスク優先度評価','典型バグパターン','ツール推奨','カバレッジ可視化'],
criteria_en:['Industry test matrix','Risk priority assessment','Common bug patterns','Tool recommendations','Coverage visualization'],
tests_ja:[['正常系: テストマトリクス生成','200, 15業種対応'],['正常系: リスク評価','200, Security:HIGH検出'],['正常系: バグパターンマッチ','200, 既知パターン3件']],
tests_en:[['Normal: Generate test matrix','200, 15 industries supported'],['Normal: Risk assessment','200, Security:HIGH detected'],['Normal: Bug pattern match','200, 3 known patterns']],
},
'チケット管理|Issue|Bug|タスク':{
criteria_ja:['チケット作成(タイトル/説明/優先度)','ステータス管理(Open/InProgress/Done)','担当者割当','コメント/履歴','ラベル/タグ','検索/フィルタ'],
criteria_en:['Create ticket (title/desc/priority)','Status management (Open/InProgress/Done)','Assignee assignment','Comments/history','Labels/tags','Search/filter'],
tests_ja:[['正常系: チケット作成','201, チケット保存'],['正常系: ステータス変更','200, Open→InProgress'],['正常系: コメント追加','201, コメント保存'],['異常系: 未認証でアクセス','401'],['正常系: フィルタ検索','200, priority=high結果']],
tests_en:[['Normal: Create ticket','201, ticket saved'],['Normal: Change status','200, Open→InProgress'],['Normal: Add comment','201, comment saved'],['Error: Unauthorized access','401'],['Normal: Filter search','200, priority=high results']],
},
'ゲーミフィケーション|Gamification|ポイント|バッジ':{
criteria_ja:['ポイント付与ルール','バッジ獲得条件','リーダーボード','レベルシステム','実績解除','進捗可視化'],
criteria_en:['Point reward rules','Badge unlock conditions','Leaderboard','Level system','Achievement unlock','Progress visualization'],
tests_ja:[['正常系: ポイント付与','200, +10pt記録'],['正常系: バッジ獲得','201, Achievement追加'],['正常系: リーダーボード','200, Top10返却'],['異常系: 二重付与','422, 冪等性エラー'],['正常系: レベルアップ','200, Lv2達成']],
tests_en:[['Normal: Award points','200, +10pt recorded'],['Normal: Unlock badge','201, Achievement added'],['Normal: Leaderboard','200, Top10 returned'],['Error: Double award','422, idempotency error'],['Normal: Level up','200, Lv2 reached']],
},
};
// Match feature name to FEATURE_DETAILS entry
function getFeatureDetail(featureName){
for(const[pattern,detail]of Object.entries(FEATURE_DETAILS)){
if(new RegExp(pattern,'i').test(featureName)) return detail;
}
return null;
}
// ── Domain-specific QA Strategy Map ──
const DOMAIN_QA_MAP={
education:{
focus_ja:['学習進捗のバックエンド同期','WCAG 2.1 AA準拠','未成年データ保護(FERPA)','コンテンツ配信安定性'],
focus_en:['Backend sync for progress','WCAG 2.1 AA compliance','Minor data protection (FERPA)','Content delivery stability'],
bugs_ja:['localStorage依存による進捗消失','クイズ正誤判定ミス','ブラウザ別音声再生不具合'],
bugs_en:['Progress lost on localStorage clear','Quiz scoring errors','Audio playback failures per browser'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:CRITICAL|Compliance:HIGH'
},
ec:{
focus_ja:['同時購入の在庫競合','決済フロー完全性','カート操作の冪等性','スパイクトラフィック耐性'],
focus_en:['Concurrent inventory conflicts','Payment flow integrity','Cart operation idempotency','Spike traffic resilience'],
bugs_ja:['同一商品を複数ユーザーが同時購入','カート追加ボタン連打で数量倍増','決済中断時の在庫戻し漏れ'],
bugs_en:['Same item bought by multiple users simultaneously','Rapid cart add button clicks double quantity','Inventory not returned on payment cancellation'],
priority:'Security:CRITICAL|Performance:HIGH|DataIntegrity:CRITICAL|UX:HIGH|Compliance:MED'
},
saas:{
focus_ja:['マルチテナント分離(RLS)','プラン別機能制限','サブスク更新・解約処理','API rate limiting'],
focus_en:['Multi-tenant isolation (RLS)','Plan-based feature restrictions','Subscription renewal/cancellation','API rate limiting'],
bugs_ja:['テナント間データ漏洩','プラン変更時の機能アクセス制御不備','サブスク解約後も課金継続'],
bugs_en:['Data leakage between tenants','Feature access control failure on plan change','Billing continues after cancellation'],
priority:'Security:CRITICAL|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'
},
community:{
focus_ja:['投稿フィルタリング(不適切コンテンツ)','通報・モデレーション','スパム対策','リアルタイム同期'],
focus_en:['Content filtering (inappropriate)','Reporting & moderation','Spam prevention','Real-time sync'],
bugs_ja:['XSS脆弱性(投稿にスクリプト注入)','通報機能の不正利用','スパムボットによる大量投稿'],
bugs_en:['XSS vulnerability (script injection in posts)','Report feature abuse','Mass posting by spam bots'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:MED|UX:HIGH|Compliance:MED'
},
booking:{
focus_ja:['同時予約競合','キャンセル・変更処理','タイムゾーン処理','外部カレンダー連携'],
focus_en:['Concurrent booking conflicts','Cancellation/modification handling','Timezone handling','External calendar integration'],
bugs_ja:['同一枠を複数ユーザーが予約','タイムゾーン計算ミスで時刻ずれ','キャンセル時の返金処理漏れ'],
bugs_en:['Same slot booked by multiple users','Timezone calculation errors cause time mismatches','Refund process omitted on cancellation'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:CRITICAL|UX:CRITICAL|Compliance:MED'
},
fintech:{
focus_ja:['トランザクション完全性(ACID)','二重処理防止','監査ログ完全性','PCI DSS準拠'],
focus_en:['Transaction integrity (ACID)','Double-processing prevention','Audit log completeness','PCI DSS compliance'],
bugs_ja:['送金ボタン連打で二重送金','残高計算の浮動小数点誤差','監査ログの欠損'],
bugs_en:['Double transfer on rapid send button clicks','Floating-point errors in balance calculations','Missing audit log entries'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:CRITICAL|UX:MED|Compliance:CRITICAL'
},
iot:{
focus_ja:['デバイス認証・認可','オフライン動作','ファームウェア更新','デバイス間同期'],
focus_en:['Device authentication & authorization','Offline operation','Firmware updates','Device-to-device sync'],
bugs_ja:['不正デバイスのAPI接続','オフライン時のデータ消失','ファームウェア更新失敗で文鎮化'],
bugs_en:['Unauthorized device API access','Data loss in offline mode','Bricked devices from failed firmware updates'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'
},
realestate:{
focus_ja:['物件検索パフォーマンス','地図連携精度','内見予約管理','物件状態同期'],
focus_en:['Property search performance','Map integration accuracy','Viewing appointment management','Property status sync'],
bugs_ja:['成約済み物件が検索表示','地図ピン位置のずれ','内見予約の重複'],
bugs_en:['Sold properties shown in search','Map pin location misalignment','Duplicate viewing appointments'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:CRITICAL|Compliance:MED'
},
content:{
focus_ja:['CDN配信最適化','画像・動画エンコード','オフライン閲覧','コンテンツ推薦精度'],
focus_en:['CDN delivery optimization','Image/video encoding','Offline viewing','Content recommendation accuracy'],
bugs_ja:['高負荷時の動画再生停止','画像遅延読み込み失敗','オフラインキャッシュ容量超過'],
bugs_en:['Video playback stops under high load','Image lazy loading failures','Offline cache quota exceeded'],
priority:'Security:LOW|Performance:CRITICAL|DataIntegrity:MED|UX:CRITICAL|Compliance:LOW'
},
hr:{
focus_ja:['個人情報保護(GDPR/CCPA)','採用プロセス公平性','評価データ整合性','権限管理'],
focus_en:['Personal data protection (GDPR/CCPA)','Hiring process fairness','Evaluation data integrity','Permission management'],
bugs_ja:['退職者のデータアクセス残存','評価スコア計算ミス','応募者情報の漏洩'],
bugs_en:['Former employee retains data access','Evaluation score calculation errors','Applicant info leakage'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:CRITICAL'
},
analytics:{
focus_ja:['集計パフォーマンス','データパイプライン信頼性','リアルタイム更新','可視化精度'],
focus_en:['Aggregation performance','Data pipeline reliability','Real-time updates','Visualization accuracy'],
bugs_ja:['大量データ集計でタイムアウト','ETL処理の部分失敗','グラフ表示の数値ずれ'],
bugs_en:['Timeout on large data aggregation','Partial ETL process failures','Graph display value discrepancies'],
priority:'Security:MED|Performance:CRITICAL|DataIntegrity:CRITICAL|UX:HIGH|Compliance:MED'
},
health:{
focus_ja:['患者データ保護(HIPAA)','処方・診断記録の正確性','医療機器連携','緊急時可用性'],
focus_en:['Patient data protection (HIPAA)','Prescription/diagnosis record accuracy','Medical device integration','Emergency availability'],
bugs_ja:['患者間データ混在','処方箋の記録ミス','医療機器データ取得失敗'],
bugs_en:['Patient data cross-contamination','Prescription record errors','Medical device data acquisition failures'],
priority:'Security:CRITICAL|Performance:HIGH|DataIntegrity:CRITICAL|UX:CRITICAL|Compliance:CRITICAL'
},
marketplace:{
focus_ja:['出品者・購入者間トラスト','エスクロー処理','レビュー信頼性','手数料計算'],
focus_en:['Seller-buyer trust','Escrow processing','Review authenticity','Fee calculation'],
bugs_ja:['評価の不正操作','エスクロー解放タイミングミス','手数料計算エラー'],
bugs_en:['Review manipulation','Escrow release timing errors','Fee calculation mistakes'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'
},
legal:{
focus_ja:['契約ドキュメント完全性','電子署名有効性','バージョン管理','監査証跡'],
focus_en:['Contract document integrity','Electronic signature validity','Version control','Audit trail'],
bugs_ja:['契約書の改ざん','署名検証失敗','バージョン履歴消失'],
bugs_en:['Contract document tampering','Signature verification failures','Version history loss'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:CRITICAL|UX:MED|Compliance:CRITICAL'
},
tool:{
focus_ja:['操作レスポンス速度','データエクスポート完全性','ショートカット動作','エラー復旧'],
focus_en:['Operation response speed','Data export completeness','Shortcut functionality','Error recovery'],
bugs_ja:['大量データ操作で固まる','エクスポート時の文字化け','ショートカットキー競合'],
bugs_en:['Freezes on large data operations','Character encoding issues in exports','Shortcut key conflicts'],
priority:'Security:LOW|Performance:HIGH|DataIntegrity:MED|UX:CRITICAL|Compliance:LOW'
},
portfolio:{
focus_ja:['SEO最適化','レスポンシブ対応','画像最適化(WebP)','表示速度(Core Web Vitals)'],
focus_en:['SEO optimization','Responsive design','Image optimization (WebP)','Display speed (Core Web Vitals)'],
bugs_ja:['モバイル表示崩れ','画像遅延読み込み失敗','SNS OGP未設定'],
bugs_en:['Mobile layout breaks','Image lazy loading failures','Missing SNS OGP tags'],
priority:'Security:LOW|Performance:HIGH|DataIntegrity:LOW|UX:CRITICAL|Compliance:LOW'
},
ai:{
focus_ja:['プロンプトインジェクション対策','トークン使用量管理','レスポンス速度','会話履歴保存'],
focus_en:['Prompt injection prevention','Token usage management','Response speed','Conversation history persistence'],
bugs_ja:['プロンプト漏洩','トークン超過課金','会話履歴消失','レート制限超過'],
bugs_en:['Prompt leakage','Token overcharge','Conversation loss','Rate limit exceeded'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'
},
automation:{
focus_ja:['ワークフロー実行信頼性','エラーハンドリング','リトライ設定','実行履歴保存'],
focus_en:['Workflow execution reliability','Error handling','Retry configuration','Execution history logging'],
bugs_ja:['無限ループ','エラー時の通知漏れ','リトライ回数制限なし','実行ログ欠損'],
bugs_en:['Infinite loops','Missing error notifications','Unlimited retries','Missing execution logs'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:LOW'
},
event:{
focus_ja:['チケット在庫管理','QRコード検証','キャンセルポリシー','タイムゾーン処理'],
focus_en:['Ticket inventory management','QR code verification','Cancellation policy','Timezone handling'],
bugs_ja:['定員超過販売','QRコード重複','返金処理漏れ','時刻ずれ'],
bugs_en:['Overselling capacity','Duplicate QR codes','Missing refunds','Time mismatches'],
priority:'Security:MED|Performance:HIGH|DataIntegrity:CRITICAL|UX:HIGH|Compliance:MED'
},
gamify:{
focus_ja:['ポイント計算正確性','バッジ獲得条件','ランキング公平性','不正防止'],
focus_en:['Point calculation accuracy','Badge criteria enforcement','Ranking fairness','Fraud prevention'],
bugs_ja:['ポイント重複付与','バッジ不正獲得','ランキング操作','負数ポイント'],
bugs_en:['Duplicate point grants','Badge exploitation','Ranking manipulation','Negative points'],
priority:'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:LOW'
},
collab:{
focus_ja:['同時編集競合解決','バージョン管理','権限管理','リアルタイム同期'],
focus_en:['Concurrent edit conflict resolution','Version control','Permission management','Real-time sync'],
bugs_ja:['編集内容消失','バージョン履歴欠損','権限チェック漏れ','同期遅延'],
bugs_en:['Edit loss','Missing version history','Permission bypass','Sync delays'],
priority:'Security:HIGH|Performance:HIGH|DataIntegrity:CRITICAL|UX:CRITICAL|Compliance:MED'
},
devtool:{
focus_ja:['APIキー管理','レート制限','使用量追跡','Webhook信頼性'],
focus_en:['API key management','Rate limiting','Usage tracking','Webhook reliability'],
bugs_ja:['キー漏洩','レート制限バイパス','使用量カウント漏れ','Webhook失敗'],
bugs_en:['Key leakage','Rate limit bypass','Usage count miss','Webhook failures'],
priority:'Security:CRITICAL|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'
},
creator:{
focus_ja:['サブスク課金管理','コンテンツ配信','投げ銭処理','ファン管理'],
focus_en:['Subscription billing','Content delivery','Tip processing','Fan management'],
bugs_ja:['解約後も課金','コンテンツ漏洩','投げ銭未着金','ファン通知漏れ'],
bugs_en:['Billing after cancellation','Content leakage','Tip not received','Missing fan notifications'],
priority:'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:HIGH'
},
newsletter:{
focus_ja:['配信到達率','購読解除','スパムフィルタ回避','開封率追跡'],
focus_en:['Delivery rate','Unsubscribe handling','Spam filter avoidance','Open rate tracking'],
bugs_ja:['メール未到達','購読解除後も配信','スパム判定','開封トラッキング失敗'],
bugs_en:['Email not delivered','Sending after unsubscribe','Spam flagged','Open tracking failures'],
priority:'Security:MED|Performance:MED|DataIntegrity:MED|UX:HIGH|Compliance:HIGH'
}
};
// ── Cross-cutting QA Patterns ──
const QA_CROSS_CUTTING={
concurrency:{ja:'同時アクセス競合テスト',en:'Concurrent access race condition test',domains:['fintech','ec','booking','community','saas']},
idempotency:{ja:'二重処理防止(冪等性)',en:'Double-processing prevention (idempotency)',domains:['fintech','ec','booking']},
spike:{ja:'スパイクトラフィック耐性(通常の100倍)',en:'Spike traffic resilience (100x normal)',domains:['ec','content','community','booking']},
offline:{ja:'オフライン/劣化ネットワーク動作',en:'Offline/degraded network operation',domains:['iot','content','community']},
tenant:{ja:'マルチテナント分離(RLS)',en:'Multi-tenant isolation (RLS)',domains:['saas','analytics']},
api_resilience:{ja:'外部API耐障害性(タイムアウト/リトライ/フォールバック)',en:'External API resilience (timeout/retry/fallback)',domains:['booking','saas','ec','analytics']},
a11y:{ja:'アクセシビリティ(WCAG)',en:'Accessibility (WCAG)',domains:['education','content','hr']},
audit:{ja:'監査ログ完全性',en:'Audit log completeness',domains:['fintech','saas','hr','legal']},
rate_limiting:{ja:'レート制限(APIキー/IP単位)',en:'Rate limiting (per API key/IP)',domains:['saas','devtool','fintech','ai']},
data_export:{ja:'データエクスポート(CSV/JSON/Excel)',en:'Data export (CSV/JSON/Excel)',domains:['saas','analytics','hr']},
notification:{ja:'通知配信(Email/Push/SMS)',en:'Notification delivery (Email/Push/SMS)',domains:['saas','community','event','newsletter']},
realtime:{ja:'リアルタイム更新(WebSocket/SSE)',en:'Realtime updates (WebSocket/SSE)',domains:['collab','community','analytics','iot']}
};
// ── Industry Test Matrix (15 Industries) ──
const _tm=(cf_ja,cf_en,tf_ja,tf_en,tb_ja,tb_en,t_ja,t_en,p)=>({critical_functions_ja:cf_ja,critical_functions_en:cf_en,test_focus_ja:tf_ja,test_focus_en:tf_en,typical_bugs_ja:tb_ja,typical_bugs_en:tb_en,tools_ja:t_ja,tools_en:t_en,priority:p});
const INDUSTRY_TEST_MATRIX={
fintech:_tm(['決済処理','残高更新','取引履歴','KYC検証'],['Payment processing','Balance updates','Transaction history','KYC verification'],['金額計算精度','同時取引競合','不正検知','監査ログ完全性'],['Amount calculation accuracy','Concurrent transaction conflicts','Fraud detection','Audit log completeness'],['浮動小数点誤差','二重決済','トランザクション分離不足','ログ欠損'],['Floating point errors','Double payments','Transaction isolation failures','Missing logs'],['Jest(単体)','Playwright(E2E)','k6(負荷)','SonarQube(静的解析)'],['Jest (unit)','Playwright (E2E)','k6 (load)','SonarQube (static)'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'),
health:_tm(['患者情報管理','診療記録','処方箋','予約管理'],['Patient information','Medical records','Prescriptions','Appointment scheduling'],['PHI保護(HIPAA)','データ暗号化','アクセス制御','監査証跡'],['PHI protection (HIPAA)','Data encryption','Access control','Audit trail'],['暗号化漏れ','権限チェック不足','ログ改ざん','データ漏洩'],['Encryption gaps','Insufficient permission checks','Log tampering','Data leaks'],['Jest','Cypress','OWASP ZAP(セキュリティ)','Trivy(脆弱性)'],['Jest','Cypress','OWASP ZAP (security)','Trivy (vulnerabilities)'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'),
ec:_tm(['商品検索','カート操作','決済','在庫管理'],['Product search','Cart operations','Checkout','Inventory management'],['在庫同期','決済フロー','クーポン適用','配送計算'],['Inventory sync','Payment flow','Coupon application','Shipping calculation'],['在庫不整合','カート競合','クーポン二重適用','決済タイムアウト'],['Inventory mismatch','Cart conflicts','Double coupon usage','Payment timeout'],['Vitest','Playwright','Lighthouse(UX)','k6'],['Vitest','Playwright','Lighthouse (UX)','k6'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'),
saas:_tm(['認証','ユーザー管理','課金','プラン変更'],['Authentication','User management','Billing','Plan changes'],['マルチテナント分離','API制限','Webhook配信','データ移行'],['Multi-tenant isolation','API rate limits','Webhook delivery','Data migration'],['テナント間漏洩','レート制限抜け','Webhook失敗','移行データ欠損'],['Cross-tenant leakage','Rate limit bypass','Webhook failures','Migration data loss'],['Jest','Playwright','Postman(API)','Grafana k6'],['Jest','Playwright','Postman (API)','Grafana k6'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
social:_tm(['投稿','コメント','いいね','通知'],['Posts','Comments','Likes','Notifications'],['リアルタイム更新','スパム検知','モデレーション','通知配信'],['Realtime updates','Spam detection','Moderation','Notification delivery'],['通知遅延','スパム漏れ','モデレーション誤判定','N+1クエリ'],['Notification delays','Spam leakage','False moderation','N+1 queries'],['Vitest','Playwright','WebSocket Tester','Apache JMeter'],['Vitest','Playwright','WebSocket Tester','Apache JMeter'],'Security:MED|Performance:HIGH|DataIntegrity:MED|UX:HIGH|Compliance:MED'),
education:_tm(['学習進捗','クイズ','成績管理','証明書発行'],['Learning progress','Quizzes','Grade management','Certificate issuance'],['進捗同期','クイズ採点','WCAG準拠','FERPA遵守'],['Progress sync','Quiz grading','WCAG compliance','FERPA compliance'],['進捗消失','採点ミス','アクセシビリティ欠陥','未成年データ保護不足'],['Progress loss','Grading errors','Accessibility defects','Minor data protection gaps'],['Jest','Cypress','axe DevTools(a11y)','Lighthouse'],['Jest','Cypress','axe DevTools (a11y)','Lighthouse'],'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:HIGH'),
gaming:_tm(['ポイント付与','ランキング','実績解除','リーダーボード'],['Point rewards','Rankings','Achievement unlock','Leaderboard'],['ポイント整合性','ランキング更新','不正検知','同時アクセス'],['Point consistency','Ranking updates','Cheat detection','Concurrent access'],['ポイント二重付与','ランキング不整合','不正ポイント獲得','競合状態'],['Double point awards','Ranking inconsistency','Cheating','Race conditions'],['Vitest','Playwright','Redis (cache)','k6'],['Vitest','Playwright','Redis (cache)','k6'],'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:HIGH|Compliance:LOW'),
iot:_tm(['センサーデータ収集','デバイス制御','アラート','ダッシュボード'],['Sensor data collection','Device control','Alerts','Dashboard'],['データ精度','通信安定性','バッテリー効率','オフライン動作'],['Data accuracy','Communication stability','Battery efficiency','Offline operation'],['センサー誤差','通信断','バッテリー消耗','データ欠損'],['Sensor errors','Communication failures','Battery drain','Data loss'],['Pytest','Selenium','MQTT Explorer','Postman'],['Pytest','Selenium','MQTT Explorer','Postman'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
travel:_tm(['予約','空室検索','決済','キャンセル'],['Booking','Availability search','Payment','Cancellation'],['在庫同期','ダブルブッキング防止','キャンセルポリシー','多言語対応'],['Inventory sync','Double booking prevention','Cancellation policy','Multi-language support'],['ダブルブッキング','在庫不整合','キャンセル料計算ミス','決済失敗'],['Double bookings','Inventory mismatch','Cancellation fee errors','Payment failures'],['Jest','Playwright','k6','i18next (i18n)'],['Jest','Playwright','k6','i18next (i18n)'],'Security:HIGH|Performance:HIGH|DataIntegrity:HIGH|UX:HIGH|Compliance:MED'),
logistics:_tm(['配送追跡','在庫管理','ルート最適化','倉庫管理'],['Shipment tracking','Inventory management','Route optimization','Warehouse management'],['追跡精度','在庫同期','配送時間予測','GPS精度'],['Tracking accuracy','Inventory sync','Delivery time prediction','GPS accuracy'],['追跡更新遅延','在庫不整合','ルート計算ミス','GPS誤差'],['Tracking update delays','Inventory mismatch','Route calculation errors','GPS inaccuracy'],['Vitest','Playwright','Google Maps API','k6'],['Vitest','Playwright','Google Maps API','k6'],'Security:MED|Performance:HIGH|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
realestate:_tm(['物件検索','内見予約','契約管理','入居者管理'],['Property search','Viewing appointments','Contract management','Tenant management'],['検索精度','契約ステータス','家賃計算','期限管理'],['Search accuracy','Contract status','Rent calculation','Deadline management'],['検索漏れ','契約状態不整合','家賃計算ミス','期限通知漏れ'],['Missing search results','Contract state inconsistency','Rent calculation errors','Missing deadline notifications'],['Jest','Playwright','Mapbox (map)','Cron (schedule)'],['Jest','Playwright','Mapbox (map)','Cron (schedule)'],'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
media:_tm(['記事投稿','コメント','購読管理','アクセス分析'],['Article publishing','Comments','Subscription management','Analytics'],['SEO最適化','画像最適化','コメントモデレーション','アクセス解析'],['SEO optimization','Image optimization','Comment moderation','Access analytics'],['SEOメタ欠損','画像読込遅延','スパムコメント','アクセス集計ミス'],['Missing SEO meta','Slow image loading','Spam comments','Analytics errors'],['Vitest','Playwright','Lighthouse','Google Analytics'],['Vitest','Playwright','Lighthouse','Google Analytics'],'Security:MED|Performance:HIGH|DataIntegrity:MED|UX:HIGH|Compliance:MED'),
hr:_tm(['応募管理','面接スケジュール','評価記録','オファー発行'],['Application management','Interview scheduling','Evaluation records','Offer issuance'],['応募者データ保護','評価公平性','GDPR遵守','通知配信'],['Applicant data protection','Evaluation fairness','GDPR compliance','Notification delivery'],['データ漏洩','評価バイアス','GDPR違反','通知遅延'],['Data leaks','Evaluation bias','GDPR violations','Notification delays'],['Jest','Cypress','OWASP ZAP','Mailgun (email)'],['Jest','Cypress','OWASP ZAP','Mailgun (email)'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:HIGH'),
marketing:_tm(['キャンペーン管理','A/Bテスト','コンバージョン計測','セグメント配信'],['Campaign management','A/B testing','Conversion tracking','Segment delivery'],['コンバージョン精度','セグメント正確性','配信タイミング','ROI計算'],['Conversion accuracy','Segment accuracy','Delivery timing','ROI calculation'],['コンバージョン重複計測','セグメント漏れ','配信遅延','ROI計算ミス'],['Duplicate conversion tracking','Segment gaps','Delivery delays','ROI calculation errors'],['Vitest','Playwright','Google Tag Manager','Mixpanel'],['Vitest','Playwright','Google Tag Manager','Mixpanel'],'Security:MED|Performance:MED|DataIntegrity:HIGH|UX:MED|Compliance:MED'),
government:_tm(['申請受付','審査','承認','証明書発行'],['Application intake','Review','Approval','Certificate issuance'],['アクセシビリティ','セキュリティ','監査証跡','長期保管'],['Accessibility','Security','Audit trail','Long-term storage'],['a11y欠陥','権限エラー','監査ログ欠損','データ消失'],['a11y defects','Permission errors','Missing audit logs','Data loss'],['Jest','Cypress','axe DevTools','OWASP ZAP'],['Jest','Cypress','axe DevTools','OWASP ZAP'],'Security:HIGH|Performance:MED|DataIntegrity:HIGH|UX:HIGH|Compliance:HIGH'),
};
// ── Domain Intelligence Playbook (Implementation/Compliance/Prevention/Context/Skills) ──
const _CF='FERPA';const _CP='PCI DSS';const _CH='HIPAA';const _CG='GDPR';
const _dpb=(i_ja,i_en,c_ja,c_en,p_ja,p_en,ctx_ja,ctx_en,sk_ja,sk_en)=>({impl_ja:i_ja,impl_en:i_en,compliance_ja:c_ja,compliance_en:c_en,prevent_ja:p_ja,prevent_en:p_en,ctx_ja:ctx_ja,ctx_en:ctx_en,skill_ja:sk_ja,skill_en:sk_en});
const DOMAIN_PLAYBOOK={
education:_dpb(
['学習目標→知識体系→カリキュラム→評価基準(例:TOEIC 650→900=300h)','成績データ→パターン分析→弱点特定→個別最適化(正答率<60%優先)','理解度テスト→習熟判定→次単元解放(≥80%進む、<60%再履修)'],
['Goal→Knowledge map→Curriculum→Assessment (e.g. TOEIC 650→900=300hrs)','Grade data→Pattern analysis→Weakness ID→Personalization (prioritize <60%)','Test→Mastery→Unlock next (≥80% proceed, <60% retry)'],
[_CF+':学生データ暗号化、保護者同意、保持5年','WCAG 2.1 AA、スクリーンリーダー対応',_CG+':Right to be forgotten'],
[_CF+': student data encrypt, parental consent, 5yr retention','WCAG 2.1 AA, screen reader',_CG+': Right to be forgotten'],
['進捗消失|localStorage超過|対策:IndexedDB移行','カンニング検出漏れ|タブ監視のみ|対策:Proctorio+視線追跡','学習時間水増し|非アクティブカウント|対策:操作監視、5分で停止'],
['Progress loss|localStorage quota|Fix: IndexedDB','Cheating miss|Tab-only monitor|Fix: Proctorio+eye track','Time inflation|Counts inactive|Fix: Activity monitor, 5min pause'],
['新機能→requirements.md, design_system.md, error_logs.md','バグ→error_logs.md, test_cases/, architecture.md','分析→architecture.md(model), api_spec.md'],
['Feature→requirements.md, design_system.md, error_logs.md','Bug→error_logs.md, test_cases/, architecture.md','Analysis→architecture.md(model), api_spec.md'],
'学習効果測定|カリキュラム最適化|入力:学習履歴JSON、目標|判断:<60%復習、60-79%補助、≥80%解放|出力:優先リスト、推定時間',
'Learning Effectiveness|Optimize curriculum|Input: history JSON, target|Judgment: <60% review, 60-79% supplemental, ≥80% unlock|Output: priority list, estimate'
),
ec:_dpb(
['購買→カート→決済完了→リピート(初回割30%→LTV 3.2x、カゴ落ち60%→回収18%)','在庫→需要予測→発注→欠品防止(90日平均+季節係数)','客単価→レコメンド→クロスセル→向上(3点提示でCTR 12%)'],
['Intent→Cart→Checkout→Repeat (30% discount→3.2x LTV, 60% abandon→18% recovery)','Inventory→Forecast→Reorder→Prevention (90d avg+seasonal)','Spending→Recommend→Cross-sell→Increase (3 items→12% CTR)'],
[_CP+':トークン化、Stripe Radar、年次認証','特商法:運営者、返品、配送料','薬機法/景表法:誇大禁止'],
[_CP+': tokenization, Stripe Radar, annual cert','Commercial Act: operator, return, shipping','Pharma/Ad Law: no exaggeration'],
['二重決済|冪等性未実装|対策:Stripe key、ボタン無効化','在庫切れ購入|race condition|対策:SELECT FOR UPDATE、3フェーズ','カゴ落ち60%|決済離脱|対策:住所補完、Apple Pay、ゲスト許可'],
['Double charge|No idempotency|Fix: Stripe key, disable button','Stockout purchase|Race condition|Fix: SELECT FOR UPDATE, 3-phase','60% abandon|Checkout friction|Fix: Address autocomplete, Apple Pay, guest'],
['決済→architecture.md(Stripe), security.md, error_logs.md','在庫→architecture.md(inventory), api_spec.md(stock)','レコメンド→stakeholders.md(ML), api_spec.md'],
['Payment→architecture.md(Stripe), security.md, error_logs.md','Inventory→architecture.md(inventory), api_spec.md(stock)','Recommend→stakeholders.md(ML), api_spec.md'],
'カゴ落ち防止|決済完了率向上|入力:Analytics、Stripe、アンケート|判断:離脱>50%要改善、入力>3分補完、エラー>5%手段追加|出力:改善リスト、A/Bテスト、期待効果',
'Cart Abandon Prevention|Improve completion|Input: Analytics, Stripe, survey|Judgment: abandon>50% improve, fill>3min autocomplete, error>5% add methods|Output: improvement list, A/B test, impact'
),
saas:_dpb(
['MRR目標→顧客数→CAC→予算(MRR $50k、チャーン5%→+30顧客/月)','解約率→施策→改善→削減(オンボード<50%→ツアー+22%)','使用率→指標→アップセル→ARPU(週ログイン<2回リスク)'],
['MRR target→Customers→CAC→Budget (MRR $50k, 5% churn→+30/mo)','Churn→Tactics→Improve→Reduce (onboard<50%→tour+22%)','Usage→Metrics→Upsell→ARPU (weekly<2 risk)'],
['SOC 2 Type II:暗号化、検知、監査',_CG+':DPA、開示、ポータビリティ','利用規約:SLA 99.9%、削除30日'],
['SOC 2 Type II: encrypt, detect, audit',_CG+': DPA, disclose, portability','ToS: SLA 99.9%, delete 30d'],
['テナント分離漏れ|RLS未設定|対策:RLS必須、tenant_id必須','Rate limit突破|backoff未実装|対策:2^n待機、Circuit Breaker','オンボード離脱50%|設定複雑|対策:ツアー、プリセット、Aha!短縮'],
['Tenant isolation|Missing RLS|Fix: Enforce RLS, tenant_id required','Rate limit|No backoff|Fix: 2^n wait, Circuit Breaker','50% onboard drop|Complex setup|Fix: Tour, presets, shorten Aha!'],
['分離→architecture.md(RLS), security.md, test_cases/','解約→stakeholders.md(CS), progress.md, api_spec.md','機能→requirements.md, design_system.md'],
['Isolation→architecture.md(RLS), security.md, test_cases/','Churn→stakeholders.md(CS), progress.md, api_spec.md','Feature→requirements.md, design_system.md'],
'チャーン予測|解約リスク検知|入力:行動ログ、契約情報|判断:ログイン<2かつ問合せ≥3高リスク、使用率<30%中リスク|出力:スコア、予測日、アクション',
'Churn Prediction|Detect risk|Input: behavior logs, contract|Judgment: logins<2 AND tickets≥3 high risk, usage<30% medium|Output: score, date, actions'
),
fintech:_dpb(
['投資目標→リターン→リスク→配分(60歳5,000万円→年利6.8%)','信用→与信→金利→管理(FICO 650-699→50万円、15%)','取引→異常検知→判定→ブロック(深夜高額→ML 92%→凍結)'],
['Goal→Return→Risk→Allocation (60yo ¥50M→6.8% return)','Credit→Limit→Rate→Manage (FICO 650-699→¥500k, 15%)','Transaction→Detect→Judge→Block (3AM high→ML 92%→freeze)'],
['金融庁:第二種、資金移動業',_CP+':600万件超、四半期スキャン','収益移転防止:eKYC、届出、7年保存'],
['FSA: Type II, Funds Transfer',_CP+': >6M/yr, quarterly scan','AML/KYC: eKYC, report, 7yr retention'],
['二重送金|残高チェック不足|対策:SELECT FOR UPDATE、冪等性','不正検出漏れ|ルールのみ|対策:LightGBM、行動学習','金利ズレ|浮動小数点誤差|対策:Decimal、整数演算'],
['Double transfer|Insufficient check|Fix: SELECT FOR UPDATE, idempotency','Fraud miss|Rule-only|Fix: LightGBM, behavior learning','Interest error|Float rounding|Fix: Decimal, integer math'],
['送金→architecture.md(transaction), security.md(PCI DSS)','検知→architecture.md(ML), api_spec.md(fraud)','計算→architecture.md(interest), test_cases/, error_logs.md'],
['Transfer→architecture.md(transaction), security.md(PCI DSS)','Fraud→architecture.md(ML), api_spec.md(fraud)','Interest→architecture.md(interest), test_cases/, error_logs.md'],
'与信審査|融資判定|入力:スコア、年収、勤続、借入、延滞|判断:≥720承認30%8%、650-719承認20%15%、<650人間審査|出力:可否、限度額、金利、返済計画',
'Credit Underwriting|Loan decision|Input: score, income, tenure, debt, delinquency|Judgment: ≥720 approve 30% 8%, 650-719 approve 20% 15%, <650 manual|Output: decision, limit, rate, repayment'
),
health:_dpb(
['目標→リスク→改善プラン→予防(糖尿病35%→17.5%に体重-8kg)','症状→候補→検査→医療機関(頭痛+熱38.5℃+咳→インフルA 78%)','服薬→遵守率→効果→最適化(飲み忘れ30%→リマインダー85%)'],
['Goal→Risk→Plan→Prevention (diabetes 35%→17.5% via -8kg)','Symptom→Candidates→Tests→Facility (headache+fever 38.5℃+cough→Flu A 78%)','Medication→Adherence→Effect→Optimize (30% miss→reminder 85%)'],
[_CH+':PHI暗号化、監査、BAA','医療機器:診断=クラスII、記録=非該当、届出','個情保護:匿名加工、オプトアウト'],
[_CH+': PHI encrypt, audit, BAA','Medical device: diagnostic=Class II, records=non-device','Privacy: anonymize, opt-out'],
['診断ミス|データ不足|対策:必須入力増、禁忌チェック','通知されない|許可OFF|対策:ガイダンス、PWA、SMS','連携エラー|スコープ不足|対策:権限明示、再認証、リトライ'],
['Diagnostic error|Insufficient data|Fix: Increase inputs, contraindication check','No notification|Permission OFF|Fix: Guidance, PWA, SMS','Integration error|Scope insufficient|Fix: Specify permissions, re-auth, retry'],
['診断→architecture.md(ML), security.md(HIPAA), test_cases/','服薬→architecture.md(notification), api_spec.md, error_logs.md','連携→architecture.md(HealthKit), sequence_diagrams/'],
['Diagnostic→architecture.md(ML), security.md(HIPAA), test_cases/','Medication→architecture.md(notification), api_spec.md, error_logs.md','Integration→architecture.md(HealthKit), sequence_diagrams/'],
'健康リスク予測|発症リスク予測|入力:健診データ、生活習慣、家族歴|判断:10年>30%高リスク、BMI≥25かつ血糖≥110糖尿病予備群|出力:スコア、目標、削減率、根拠',
'Health Risk Prediction|Predict onset|Input: checkup data, lifestyle, family history|Judgment: 10yr>30% high risk, BMI≥25 AND sugar≥110 prediabetes|Output: scores, goals, reduction, evidence'
),
booking:_dpb(
['可能枠→予測→動的価格→稼働率(19-20時満席→18時割20%)','空室→判定→制限→収益(週末2泊以上、直前50%オフ)','キャンセル率→前払い→防止→保護(15%→カード登録で3%)'],
['Slots→Forecast→Dynamic price→Occupancy (7-8PM full→6PM 20% off)','Vacancy→Detect→Restriction→Revenue (weekend 2-night min, last-min 50% off)','Cancel rate→Prepay→Prevent→Protect (15%→card reg 3%)'],
['旅行業法:第三種登録、管理、掲示','景表法:二重価格規制、おとり禁止','キャンセル:返金明示、手数料上限'],
['Travel Act: Type III reg, mgmt, display','Gift Act: dual price reg, bait prohibit','Cancel: refund disclose, fee cap'],
['ダブルブッキング|競合状態|対策:Lock、3段階、5分同期+バッファ','待ち通知されない|接続切断|対策:SSE fallback、SMS/Email、30秒以内','価格急変クレーム|更新頻度高|対策:30分固定、理由表示'],
['Double booking|Race condition|Fix: Lock, 3-phase, 5min sync+buffer','Waitlist no notify|Connection loss|Fix: SSE fallback, SMS/Email, within 30sec','Price change complaint|Too frequent|Fix: 30min hold, show reason'],
['予約→architecture.md(inventory), sequence_diagrams/(flow), security.md','価格→architecture.md(pricing), api_spec.md, stakeholders.md','キャンセル→architecture.md(policy), api_spec.md, error_logs.md'],
['Booking→architecture.md(inventory), sequence_diagrams/(flow), security.md','Pricing→architecture.md(pricing), api_spec.md, stakeholders.md','Cancel→architecture.md(policy), api_spec.md, error_logs.md'],
'在庫最適化|稼働率収益最大化|入力:履歴、季節変動、イベント|判断:<60%割引、>90%値上げ、繁忙期制限、直前大幅割|出力:価格帯、制御ルール、期待値',
'Inventory Optimization|Maximize occupancy revenue|Input: history, seasonal, events|Judgment: <60% discount, >90% increase, peak restrict, last-min deep discount|Output: price range, rules, expected'
),
_default:_dpb(
['目標→KPI→機能→優先度(売上月100万円→CVR 2%→決済最優先)','ペイン→解決策→MVP→検証(情報過多→AIレコメンド→3パターン→A/B)','データ→ロジック→API→UI(User-Post-Comment→CRUD+検索→REST→画面)'],
['Goal→KPI→Features→Priority (sales ¥1M/mo→CVR 2%→payment first)','Pain→Solution→MVP→Validation (overload→AI recommend→3 patterns→A/B)','Data→Logic→API→UI (User-Post-Comment→CRUD+search→REST→screens)'],
[_CG+':処理合法性、権利(アクセス・削除)、Cookie同意','OWASP Top 10、SQLi/XSS防止、パスワードハッシュ(bcrypt)','規約:必須記載、保持期限、第三者提供'],
[_CG+': lawful processing, rights (access, delete), cookie consent','OWASP Top 10, SQLi/XSS prevent, password hash (bcrypt)','ToS: mandatory items, retention, third-party'],
['認証バイパス|JWT検証不足|対策:全ルートで検証、7日期限、リフレッシュ','N+1クエリ|個別取得|対策:JOIN、eager loading、監視>10アラート','遅延|全件取得、INDEX未設定|対策:ページネーション(limit 20)、INDEX、APM'],
['Auth bypass|Insufficient JWT validation|Fix: Enforce all routes, 7d expiry, refresh','N+1 query|Individual fetch|Fix: JOIN, eager loading, monitor>10 alert','Delay|Fetch all, no INDEX|Fix: Pagination (limit 20), INDEX, APM'],
['機能→requirements.md, architecture.md, design_system.md','バグ→error_logs.md, test_cases/, architecture.md','性能→architecture.md(optimize), sequence_diagrams/'],
['Feature→requirements.md, architecture.md, design_system.md','Bug→error_logs.md, test_cases/, architecture.md','Performance→architecture.md(optimize), sequence_diagrams/'],
'要件整理|曖昧→構造化|入力:議事録、ストーリー、目標|判断:Must/Should/Won'+"'"+'t、Mustは数値目標、依存明示|出力:要件定義書、ER図、遷移図、選定理由',
'Requirements Refinement|Ambiguous→Structured|Input: minutes, stories, goals|Judgment: Must/Should/Won'+"'"+'t, Must has numeric targets, dependencies explicit|Output: requirements doc, ER, transitions, rationale'
),
marketplace:_dpb(
['出品→審査→マッチング→取引(手数料10%、エスクロー48h保護)','評価→信頼→プレミアム販売者(評価4.8+、100件→優先表示)','トラブル→仲裁→解決(通常7日、エスクロー解放延長)'],
['Listing→Review→Match→Transaction (10% fee, 48h escrow protection)','Rating→Trust→Premium seller (4.8+, 100 items→priority)','Dispute→Arbitrate→Resolve (7d standard, escrow hold extended)'],
['特商法:販売者開示、エスクロー、解決支援','景表法:おとり広告禁止、二重価格規制',_CG+':販売者・購入者情報保護'],
[_CP+', Commercial Act: seller disclosure, escrow, dispute','Gift Act: prohibit bait ads, dual price reg',_CG+': seller/buyer info protection'],
['マッチング精度低|データ不足|ルール→100件でML','不正評価|サクラ|検知:短期間集中、IPクラスタ','手数料計算ミス|複雑割引|対策:事前見積、決済前確認'],
['Matching accuracy low|Insufficient data|Rules→ML after 100','Fake reviews|Shilling|Detect: burst period, IP cluster','Fee calc error|Complex discount|Fix: Pre-estimate, confirm before payment'],
['出品→requirements.md, api_spec.md(listing), test_cases/','評価→architecture.md(trust), api_spec.md, error_logs.md','仲裁→architecture.md(dispute), sequence_diagrams/, stakeholders.md'],
['Listing→requirements.md, api_spec.md(listing), test_cases/','Rating→architecture.md(trust), api_spec.md, error_logs.md','Arbitration→architecture.md(dispute), sequence_diagrams/, stakeholders.md'],
'マッチング最適化|需給最適化|入力:履歴、評価、在庫、需要|判断:評価≥4.5優先、過去取引>10優遇、需要>供給値上げ推奨|出力:ランキング、価格提案、需給バランス',
'Matching Optimization|Supply-demand optimization|Input: history, ratings, inventory, demand|Judgment: rating≥4.5 priority, past trades>10 favor, demand>supply suggest increase|Output: ranking, price suggestions, balance'
),
community:_dpb(
['投稿→モデレーション→配信→エンゲージメント(自動検知+人間審査)','ユーザー→フォロー→フィード生成→ランキング(友達→興味→トレンド)','通報→審査→対応→再発防止(24h以内対応、3回で自動BAN)'],
['Post→Moderate→Distribute→Engage (auto-detect+human review)','User→Follow→Feed generation→Ranking (friends→interests→trending)','Report→Review→Action→Prevention (respond within 24h, 3 strikes auto-ban)'],
['投稿ガイド:誹謗中傷禁止、モデレーション、通報',_CG+':ユーザー生成コンテンツ責任、削除権','利用規約:著作権侵害即削除、荒らし対策'],
[_CG+', Posting: prohibit defamation, moderation, report',_CG+': UGC liability, right to delete','ToS: copyright infringement immediate delete, anti-trolling'],
['スパム|reCAPTCHA未導入|対策:v3、5件/分制限','XSS脆弱性|サニタイズ不足|対策:DOMPurify、CSP','フィルターバブル|類似のみ|対策:多様性注入20%'],
['Spam|No reCAPTCHA|Fix: v3, 5/min limit','XSS vulnerability|Insufficient sanitize|Fix: DOMPurify, CSP','Filter bubble|Similarity only|Fix: Inject diversity 20%'],
['投稿→requirements.md, api_spec.md(post), security.md(XSS)','モデレーション→architecture.md(ML), stakeholders.md, error_logs.md','エンゲージメント→architecture.md(feed), api_spec.md, test_cases/'],
['Posting→requirements.md, api_spec.md(post), security.md(XSS)','Moderation→architecture.md(ML), stakeholders.md, error_logs.md','Engagement→architecture.md(feed), api_spec.md, test_cases/'],
'コンテンツモデレーション|不適切投稿検知|入力:投稿テキスト、画像、通報履歴|判断:NGワード→即削除、グレー→人間審査、通報≥3緊急、過去違反者厳格|出力:判定、理由、対応、学習データ',
'Content Moderation|Detect inappropriate posts|Input: post text, images, report history|Judgment: banned words→immediate delete, gray→human review, reports≥3 urgent, past violators strict|Output: decision, reason, action, training data'
),
content:_dpb(
['制作→公開→配信→分析(CDN、画像最適化、SEO)','SEO→キーワード→ランク→流入(タイトル60字、メタ160字、構造化データ)','著作権→ライセンス→保護→収益化(CC BY-SA、DMCA対応)'],
['Create→Publish→Distribute→Analyze (CDN, image optimization, SEO)','SEO→Keywords→Rank→Traffic (title 60 chars, meta 160, structured data)','Copyright→License→Protect→Monetize (CC BY-SA, DMCA response)'],
['著作権:DMCA対応、コンテンツID、ライセンス(CC BY-SA)','肖像権:モデルリリース、ぼかし処理',_CG+':Cookie同意、アクセス解析匿名化'],
[_CG+', Copyright: DMCA, content ID, license (CC BY-SA)','Portrait rights: model release, blur processing',_CG+': cookie consent, analytics anonymization'],
['再生エラー|非対応コーデック|HLS、複数解像度','画像遅延|最適化不足|WebP、srcset、CDN','SEO順位低|構造化データ不足|JSON-LD、sitemap、robots.txt'],
['Playback error|Unsupported codec|HLS, multiple resolutions','Image lag|Insufficient optimization|WebP, srcset, CDN','Low SEO rank|Missing structured data|JSON-LD, sitemap, robots.txt'],
['配信→architecture.md(CDN), api_spec.md, design_system.md','SEO→requirements.md, api_spec.md(sitemap), test_cases/','著作権→architecture.md(DMCA), stakeholders.md, error_logs.md'],
['Distribution→architecture.md(CDN), api_spec.md, design_system.md','SEO→requirements.md, api_spec.md(sitemap), test_cases/','Copyright→architecture.md(DMCA), stakeholders.md, error_logs.md'],
'SEO最適化|検索順位向上|入力:ページ、キーワード、競合|判断:タイトル≤60字、h1-h6階層、内部リンク≥3、表示速度≤2.5s|出力:最適化案、期待順位、修正箇所',
'SEO Optimization|Improve search rank|Input: pages, keywords, competitors|Judgment: title≤60 chars, h1-h6 hierarchy, internal links≥3, load time≤2.5s|Output: optimization plan, expected rank, fixes'
),
analytics:_dpb(
['データ収集→集計→可視化→洞察(イベント追跡、セッション分析)','異常検知→アラート→調査→対応(閾値監視、パターン学習)','レポート→ダッシュボード→共有→意思決定(KPI、トレンド、予測)'],
['Collect→Aggregate→Visualize→Insight (event tracking, session analysis)','Anomaly detect→Alert→Investigate→Respond (threshold monitor, pattern learning)','Report→Dashboard→Share→Decide (KPI, trends, forecasts)'],
[_CG+':匿名化、集計のみ、個人特定不可','アクセス解析:Cookie同意、オプトアウト','データ保持:分析用1年、ログ3ヶ月'],
[_CG+': anonymize, aggregated only, no personal ID','Analytics: cookie consent, opt-out','Data retention: analytics 1yr, logs 3mo'],
['表示遅延|リアルタイム集計重い|事前集計、Redis、materialized view','精度低|サンプリング不足|最低1000件、季節調整','ダッシュボード遅延|N+1クエリ|集計テーブル、キャッシュ5分'],
['Display delay|Heavy real-time aggregation|Pre-aggregate, Redis, materialized view','Low accuracy|Insufficient sampling|Minimum 1000 records, seasonal adjustment','Dashboard lag|N+1 queries|Aggregation tables, cache 5min'],
['収集→architecture.md(pipeline), api_spec.md, sequence_diagrams/','集計→architecture.md(aggregation), test_cases/, error_logs.md','可視化→design_system.md, api_spec.md(dashboard), requirements.md'],
['Collection→architecture.md(pipeline), api_spec.md, sequence_diagrams/','Aggregation→architecture.md(aggregation), test_cases/, error_logs.md','Visualization→design_system.md, api_spec.md(dashboard), requirements.md'],
'異常検知|パターン異常検出|入力:時系列データ、閾値、履歴|判断:3σ超→アラート、前日比>50%注意、週次トレンド乖離|出力:異常スコア、原因候補、推奨対応',
'Anomaly Detection|Pattern anomaly detection|Input: time-series, thresholds, history|Judgment: >3σ→alert, day-over-day>50% caution, weekly trend deviation|Output: anomaly score, cause candidates, recommended actions'
),
iot:_dpb(
['デバイス登録→認証→データ収集→制御(MQTT、CoAP、証明書認証)','センサーデータ→処理→アラート→対応(閾値監視、異常検知)','ファームウェア更新→配信→適用→確認(OTA、ロールバック)'],
['Device registration→Auth→Data collection→Control (MQTT, CoAP, cert auth)','Sensor data→Process→Alert→Respond (threshold monitor, anomaly detection)','Firmware update→Distribute→Apply→Verify (OTA, rollback)'],
['電波法:技適、周波数遵守','製造物責任法:欠陥損害賠償',_CG+':デバイスデータ収集同意、匿名化'],
[_CG+', Radio Act: tech conformity, frequency','Product Liability: defect liability',_CG+': device data collection consent, anonymization'],
['切断|不安定ネットワーク|オフライン動作、ローカルキュー、指数バックオフ','ファームウェア失敗|文鎮化|A/Bパーティション、ロールバック、チェックサム','バッテリー消耗|ポーリング頻度高|間引き、差分送信、スリープモード'],
['Disconnect|Unstable network|Offline operation, local queue, exponential backoff','Firmware failure|Bricked device|A/B partition, rollback, checksum','Battery drain|High polling frequency|Throttling, delta transmission, sleep mode'],
['デバイス→architecture.md(MQTT), security.md(auth), api_spec.md','データ→architecture.md(pipeline), sequence_diagrams/, test_cases/','更新→architecture.md(OTA), error_logs.md, stakeholders.md'],
['Device→architecture.md(MQTT), security.md(auth), api_spec.md','Data→architecture.md(pipeline), sequence_diagrams/, test_cases/','Update→architecture.md(OTA), error_logs.md, stakeholders.md'],
'デバイス管理|接続状態監視制御|入力:デバイスID、センサー値、接続履歴|判断:切断>5分アラート、異常値→再送要求、バッテリー<10%省電力|出力:ステータス、コマンド、予測寿命',
'Device Management|Monitor connection & control|Input: device ID, sensor values, connection history|Judgment: disconnect>5min alert, anomalous values→resend request, battery<10% power save|Output: status, commands, predicted lifespan'
),
realestate:_dpb(
['物件登録→審査→公開→検索(画像、間取り、地図連携)','内見予約→確認→実施→フィードバック(カレンダー、リマインダー)','契約→重要事項説明→署名→完了(電子契約、クーリングオフ8日)'],
['Property registration→Review→Publish→Search (images, floor plan, map integration)','Viewing→Confirm→Conduct→Feedback (calendar, reminders)','Contract→Important matters→Sign→Complete (e-contract, 8d cooling-off)'],
['宅建業法:重要事項説明、契約書交付、クーリングオフ','表示規約:徒歩80m/分、築年数、面積正確',_CG+':個人情報保護、物件情報管理'],
[_CG+', Real Estate Act: important matters, contract, cooling-off','Display Standards: walking 80m/min, age, area accurate',_CG+': personal info protection, property info mgmt'],
['情報不整合|外部連携遅延|1時間同期、差分検知、成約済み非表示','地図ずれ|ジオコーディング精度|Google Maps API、緯度経度検証','内見重複|空き枠管理不足|Lock、3段階確認、バッファ30分'],
['Info inconsistency|External sync delay|Hourly sync, detect diff, hide sold','Map misalignment|Geocoding accuracy|Google Maps API, lat/long validation','Viewing conflict|Insufficient slot mgmt|Lock, 3-phase confirm, 30min buffer'],
['物件→architecture.md(search), api_spec.md(property), design_system.md','内見→architecture.md(booking), sequence_diagrams/, test_cases/','契約→architecture.md(e-contract), security.md, stakeholders.md'],
['Property→architecture.md(search), api_spec.md(property), design_system.md','Viewing→architecture.md(booking), sequence_diagrams/, test_cases/','Contract→architecture.md(e-contract), security.md, stakeholders.md'],
'物件管理|検索最適化推奨|入力:物件DB、検索履歴、成約データ|判断:検索上位≤10件、成約率<3%価格見直し、問合せ≥5未成約要改善|出力:ランキング、価格提案、改善点',
'Property Management|Search optimization & recommendations|Input: property DB, search history, contract data|Judgment: top search results≤10, contract rate<3% revise price, inquiries≥5 without contract→improve|Output: ranking, price suggestions, improvements'
),
legal:_dpb(
['契約作成→レビュー→承認→署名(テンプレート、バージョン管理)','案件管理→期日→アラート→対応(タスク、カレンダー、通知)','ドキュメント管理→検索→共有→監査証跡(暗号化、アクセス制御)'],
['Contract creation→Review→Approve→Sign (templates, versioning)','Case management→Deadline→Alert→Respond (tasks, calendar, notifications)','Document mgmt→Search→Share→Audit trail (encryption, access control)'],
['弁護士法:非弁禁止、法律相談は有資格者','個情保護:守秘義務、報告義務','電子署名法:電子署名の有効性、タイムスタンプ'],
[_CG+', Attorney Act: prohibit unauthorized, licensed only','Privacy: confidentiality, reporting obligation','E-Signature Act: e-signature validity, timestamp'],
['契約生成ミス|変数置換漏れ|必須チェックリスト、プレビュー必須、レビューフロー','バージョン混在|履歴管理不足|Git-like管理、diff表示、ロック','期日漏れ|通知設定不足|3段階リマインダー(7日前、3日前、当日)'],
['Contract error|Missing variable substitution|Mandatory checklist, preview required, review flow','Version confusion|Insufficient history|Git-like management, diff display, locking','Deadline miss|Insufficient notifications|3-tier reminders (7d, 3d, same-day)'],
['契約→architecture.md(template), api_spec.md, sequence_diagrams/','レビュー→architecture.md(approval), stakeholders.md, test_cases/','監査→architecture.md(audit), security.md, error_logs.md'],
['Contract→architecture.md(template), api_spec.md, sequence_diagrams/','Review→architecture.md(approval), stakeholders.md, test_cases/','Audit→architecture.md(audit), security.md, error_logs.md'],
'契約レビュー|リスク条項検出|入力:契約書テキスト、テンプレート、チェックリスト|判断:必須条項欠落→警告、リスク用語検出(無制限責任、排他的)、期限≤7日注意|出力:検出リスト、重要度、修正案',
'Contract Review|Detect risk clauses|Input: contract text, templates, checklist|Judgment: missing mandatory clauses→warn, detect risk terms (unlimited liability, exclusive), deadline≤7d caution|Output: detected list, severity, revision suggestions'
),
hr:_dpb(
['求人作成→公開→応募→選考(ATS、スクリーニング、面接)','評価→フィードバック→育成→昇進(1on1、目標管理、360度評価)','勤怠→集計→給与→支払(打刻、残業、有休管理)'],
['Job posting→Publish→Apply→Screen (ATS, screening, interviews)','Evaluation→Feedback→Develop→Promote (1-on-1, goal mgmt, 360 review)','Attendance→Aggregate→Payroll→Pay (clock-in, overtime, leave mgmt)'],
['労働基準法:勤怠記録3年、残業45h上限','個情保護:不適切質問禁止、候補者情報管理','雇用機会均等法:差別禁止、公平な選考'],
[_CG+', Labor Standards: attendance 3yr, overtime 45h max','Privacy: prohibit inappropriate questions, candidate info mgmt','Equal Opportunity: prohibit discrimination, fair screening'],
['勤怠ミス|TZ未考慮、深夜日跨ぎ|UTC統一、深夜割増22-5時、月次突合','評価バイアス|主観のみ|360度評価、定量指標、校正会議','応募者漏れ|手動管理|ATS、自動ステータス更新、リマインダー'],
['Attendance error|TZ not considered, midnight crossing|Unify UTC, late-night premium 10PM-5AM, monthly reconcile','Evaluation bias|Subjective only|360 review, quantitative metrics, calibration meeting','Applicant miss|Manual mgmt|ATS, auto-status update, reminders'],
['勤怠→architecture.md(attendance), api_spec.md, test_cases/','評価→architecture.md(evaluation), stakeholders.md, requirements.md','採用→architecture.md(ATS), sequence_diagrams/, error_logs.md'],
['Attendance→architecture.md(attendance), api_spec.md, test_cases/','Evaluation→architecture.md(evaluation), stakeholders.md, requirements.md','Hiring→architecture.md(ATS), sequence_diagrams/, error_logs.md'],
'採用フロー|選考最適化|入力:応募者データ、履歴書、面接記録|判断:必須スキル不足→不合格、経験≥3年優遇、カルチャーフィット評価|出力:合否判定、スコア、次ステップ',
'Hiring Flow|Optimize screening|Input: applicant data, resumes, interview records|Judgment: missing required skills→reject, experience≥3yrs favor, culture fit assessment|Output: pass/fail, score, next steps'
),
portfolio:_dpb(
['制作→公開→SEO→集客(レスポンシブ、画像最適化、Core Web Vitals)','プロジェクト→カテゴリ→フィルタ→表示(ポートフォリオサイト)','問合せ→フォーム→通知→対応(スパム対策、自動返信)'],
['Create→Publish→SEO→Attract (responsive, image optimization, Core Web Vitals)','Project→Category→Filter→Display (portfolio site)','Contact→Form→Notify→Respond (spam protection, auto-reply)'],
[_CG+':Cookie同意、アクセス解析','著作権:作品ライセンス明示、転載禁止','肖像権:モデルリリース、ぼかし'],
[_CG+': cookie consent, analytics','Copyright: specify work license, prohibit repost','Portrait rights: model release, blur'],
['画像未最適化|元サイズ配信|WebP、srcset、lazy loading','モバイル崩れ|レスポンシブ不足|Tailwind、ブレークポイント検証','SEO低順位|メタ不足|OGP、構造化データ、sitemap'],
['Image unoptimized|Serve original size|WebP, srcset, lazy loading','Mobile layout breaks|Insufficient responsive|Tailwind, breakpoint validation','Low SEO rank|Missing meta|OGP, structured data, sitemap'],
['制作→design_system.md, requirements.md, api_spec.md','SEO→architecture.md(SEO), test_cases/, stakeholders.md','問合せ→architecture.md(contact), security.md, error_logs.md'],
['Creation→design_system.md, requirements.md, api_spec.md','SEO→architecture.md(SEO), test_cases/, stakeholders.md','Contact→architecture.md(contact), security.md, error_logs.md'],
'SEO最適化|表示速度改善|入力:ページHTML、画像、CSS|判断:LCP≤2.5s、FID≤100ms、CLS≤0.1、画像WebP化、CSS圧縮|出力:スコア、改善リスト、期待順位',
'SEO Optimization|Improve page speed|Input: page HTML, images, CSS|Judgment: LCP≤2.5s, FID≤100ms, CLS≤0.1, image→WebP, CSS minify|Output: score, improvement list, expected rank'
),
tool:_dpb(
['タスク→自動化→効率化→測定(ショートカット、マクロ、スクリプト)','データ→エクスポート→変換→活用(CSV、JSON、API連携)','設定→カスタマイズ→共有→同期(テーマ、プリセット、クラウド)'],
['Task→Automate→Streamline→Measure (shortcuts, macros, scripts)','Data→Export→Transform→Utilize (CSV, JSON, API integration)','Settings→Customize→Share→Sync (themes, presets, cloud)'],
[_CG+':データ処理同意、エクスポート権','利用規約:使用制限、データ保持期間','セキュリティ:API認証、暗号化通信'],
[_CG+': data processing consent, export rights','ToS: usage limits, data retention','Security: API auth, encrypted communication'],
['互換性|最新API(Safari未対応)|Polyfill、Can I Use、クロスブラウザテスト','エクスポート失敗|文字コード|UTF-8 BOM、CSV区切り文字検証','ショートカット競合|他ツール衝突|設定可能化、デフォルト変更、ガイド'],
['Compatibility|Latest API (Safari unsupported)|Polyfill, Can I Use, cross-browser test','Export failure|Character encoding|UTF-8 BOM, CSV delimiter validation','Shortcut conflict|Collision with other tools|Make configurable, change defaults, guide'],
['自動化→architecture.md(automation), api_spec.md, test_cases/','エクスポート→architecture.md(export), error_logs.md, stakeholders.md','設定→design_system.md, requirements.md, api_spec.md'],
['Automation→architecture.md(automation), api_spec.md, test_cases/','Export→architecture.md(export), error_logs.md, stakeholders.md','Settings→design_system.md, requirements.md, api_spec.md'],
'ワークフロー自動化|反復作業削減|入力:タスクログ、操作履歴、頻度|判断:週≥3回→自動化候補、手順≥5ステップ優先、エラー率>10%要改善|出力:自動化案、期待削減時間、実装難易度',
'Workflow Automation|Reduce repetitive tasks|Input: task logs, operation history, frequency|Judgment: weekly≥3 times→automation candidate, steps≥5 prioritize, error rate>10% improve|Output: automation plan, expected time savings, implementation difficulty'
),
ai:_dpb(['プロンプト→生成→評価→改善','会話履歴→コンテキスト→応答品質','トークン→コスト→最適化'],['Prompt→Generate→Evaluate→Improve','History→Context→Quality','Token→Cost→Optimize'],[_CG+':データ処理同意','OpenAI ToS準拠','プロンプト暗号化'],[_CG+': data consent','OpenAI ToS compliance','Prompt encryption'],['プロンプト漏洩|ログ保存|対策:暗号化、アクセス制御','トークン超過|無制限生成|対策:制限設定、アラート'],[' Prompt leak|Log storage|Fix: encrypt, access control','Token overuse|Unlimited|Fix: limits, alerts'],['生成→architecture.md(AI), api_spec.md','履歴→stakeholders.md, security.md'],['Generate→architecture.md(AI), api_spec.md','History→stakeholders.md, security.md'],'プロンプト最適化|コスト削減|入力:履歴、トークン数|判断:>1000トークン→要約、重複→キャッシュ|出力:最適化案','Prompt Optimization|Cost reduction|Input: history, tokens|Judgment: >1000 tokens→summarize, duplicate→cache|Output: optimization plan'),
automation:_dpb(['トリガー→実行→完了→通知','エラー→リトライ→成功→記録','ワークフロー→最適化→測定'],['Trigger→Execute→Complete→Notify','Error→Retry→Success→Log','Workflow→Optimize→Measure'],[_CG+':自動化同意','実行ログ保存','エラー通知'],[_CG+': automation consent','Execution logs','Error notification'],['無限ループ|終了条件なし|対策:最大実行回数、タイムアウト','リトライ過多|無制限|対策:指数バックオフ、上限設定'],['Infinite loop|No exit|Fix: max runs, timeout','Retry overuse|Unlimited|Fix: exponential backoff, limit'],['実行→architecture.md(workflow), api_spec.md','エラー→error_logs.md, stakeholders.md'],['Execute→architecture.md(workflow), api_spec.md','Error→error_logs.md, stakeholders.md'],'ワークフロー効率化|実行時間短縮|入力:実行ログ、ステップ時間|判断:>60s→並列化候補、失敗率>10%→要改善|出力:最適化案、期待時間削減','Workflow Efficiency|Reduce execution time|Input: logs, step duration|Judgment: >60s→parallel candidate, fail>10%→improve|Output: optimization, expected savings'),
event:_dpb(['企画→告知→販売→開催','チケット→購入→検証→入場','キャンセル→返金→再販売'],['Plan→Announce→Sell→Hold','Ticket→Purchase→Verify→Entry','Cancel→Refund→Resell'],['個人情報保護法:氏名、メール暗号化','特商法:返金規定明記','会場規約:安全管理'],[' Privacy Act: name, email encrypt','Commercial Act: refund policy','Venue: safety management'],['定員超過|競合販売|対策:SELECT FOR UPDATE、在庫ロック','QR重複|生成ミス|対策:UUID、検証チェック'],['Oversell|Race condition|Fix: SELECT FOR UPDATE, lock','QR duplicate|Generation error|Fix: UUID, validation'],['販売→architecture.md(ticket), security.md','検証→architecture.md(QR), api_spec.md'],['Sales→architecture.md(ticket), security.md','Verify→architecture.md(QR), api_spec.md'],'チケット販売最適化|売上最大化|入力:販売履歴、残席、需要|判断:残席<20%→値上げ候補、売行き悪い→割引検討|出力:価格戦略、期待売上','Ticket Sales Optimization|Maximize revenue|Input: sales history, remaining, demand|Judgment: remaining<20%→price up candidate, slow sales→discount|Output: pricing strategy, expected revenue'),
gamify:_dpb(['参加→達成→獲得→継続','ポイント→バッジ→ランキング→報酬','行動→測定→分析→最適化'],['Join→Achieve→Earn→Continue','Points→Badges→Ranking→Rewards','Behavior→Measure→Analyze→Optimize'],[_CG+':ポイント管理透明性','利用規約:ポイント有効期限','不正防止:行動監視'],[_CG+': point management transparency','ToS: point expiration','Fraud: behavior monitoring'],['ポイント重複付与|冪等性なし|対策:トランザクション、重複チェック','ランキング操作|不正行動|対策:異常検知、手動確認'],['Duplicate points|No idempotency|Fix: transaction, duplicate check','Ranking manipulation|Fraud|Fix: anomaly detection, manual review'],['達成→architecture.md(gamify), api_spec.md','不正→error_logs.md, security.md'],['Achievement→architecture.md(gamify), api_spec.md','Fraud→error_logs.md, security.md'],'エンゲージメント向上|継続率改善|入力:行動ログ、達成率|判断:完了<30%→難易度調整、離脱>50%→報酬見直し|出力:改善案、期待継続率','Engagement Improvement|Retention increase|Input: behavior logs, completion|Judgment: complete<30%→adjust difficulty, churn>50%→review rewards|Output: improvement plan, expected retention'),
collab:_dpb(['作成→編集→同期→保存','競合→解決→マージ→履歴','権限→承認→共有→通知'],['Create→Edit→Sync→Save','Conflict→Resolve→Merge→History','Permission→Approve→Share→Notify'],[_CG+':データ処理同意','利用規約:編集権限、削除30日','セキュリティ:暗号化通信、アクセスログ'],[_CG+': data processing consent','ToS: edit permission, delete 30d','Security: encrypted communication, access log'],['編集消失|競合解決失敗|対策:OT/CRDT、定期保存','権限漏れ|チェック不足|対策:RLS、middleware検証'],['Edit loss|Conflict resolution failure|Fix: OT/CRDT, periodic save','Permission bypass|Insufficient check|Fix: RLS, middleware validation'],['同期→architecture.md(realtime), api_spec.md','権限→security.md, test_cases/'],['Sync→architecture.md(realtime), api_spec.md','Permission→security.md, test_cases/'],'競合解決最適化|編集消失防止|入力:編集履歴、競合頻度|判断:競合>5/h→通知強化、消失>1%→保存頻度増|出力:最適化案','Conflict Resolution Optimization|Prevent edit loss|Input: edit history, conflict rate|Judgment: conflicts>5/h→enhance notification, loss>1%→increase save frequency|Output: optimization plan'),
devtool:_dpb(['登録→発行→使用→追跡','リクエスト→検証→実行→記録','エラー→通知→対応→改善'],['Register→Issue→Use→Track','Request→Verify→Execute→Log','Error→Notify→Respond→Improve'],[_CG+':データ処理同意','利用規約:レート制限、使用制限','セキュリティ:APIキー暗号化、IP制限'],[_CG+': data processing consent','ToS: rate limits, usage limits','Security: API key encryption, IP restriction'],['キー漏洩|平文保存|対策:暗号化、ハッシュ化、定期ローテーション','レート突破|制限なし|対策:Redis、sliding window'],['Key leakage|Plain text|Fix: encrypt, hash, regular rotation','Rate bypass|No limits|Fix: Redis, sliding window'],['認証→security.md, api_spec.md','使用→architecture.md(tracking), stakeholders.md'],['Auth→security.md, api_spec.md','Usage→architecture.md(tracking), stakeholders.md'],'API使用最適化|コスト削減|入力:リクエストログ、エラー率|判断:エラー>5%→要改善、重複>30%→キャッシュ候補|出力:最適化案、期待削減率','API Usage Optimization|Cost reduction|Input: request logs, error rate|Judgment: error>5%→improve, duplicate>30%→cache candidate|Output: optimization plan, expected reduction'),
creator:_dpb(['作成→公開→収益化→分析','サブスク→課金→継続→解約','ファン→交流→支援→成長'],['Create→Publish→Monetize→Analyze','Subscribe→Charge→Continue→Cancel','Fan→Engage→Support→Grow'],[_CG+':データ処理同意','資金決済法:前払式、第三者型','利用規約:手数料、返金規定'],[_CG+': data processing consent','Payment Services Act: prepaid, third-party','ToS: fees, refund policy'],['解約後課金|サブスク解約漏れ|対策:Webhook検証、定期確認','投げ銭未着|決済失敗|対策:リトライ、通知'],['Charge after cancel|Subscription cancel miss|Fix: webhook verification, periodic check','Tip not received|Payment failure|Fix: retry, notification'],['課金→architecture.md(subscription), security.md','支援→architecture.md(tip), api_spec.md'],['Billing→architecture.md(subscription), security.md','Support→architecture.md(tip), api_spec.md'],'収益最適化|ファン増加|入力:収益データ、ファン行動|判断:離脱>30%→ティア見直し、成長<10%→施策追加|出力:改善案、期待収益','Revenue Optimization|Fan growth|Input: revenue data, fan behavior|Judgment: churn>30%→review tiers, growth<10%→add tactics|Output: improvement plan, expected revenue'),
newsletter:_dpb(['作成→配信→開封→分析','購読→確認→受信→解除','セグメント→ターゲット→パーソナライズ'],['Create→Send→Open→Analyze','Subscribe→Confirm→Receive→Unsubscribe','Segment→Target→Personalize'],[_CG+':配信同意、オプトイン','特定電子メール法:配信者明記、解除リンク','個人情報保護法:購読者情報暗号化'],[_CG+': sending consent, opt-in','Anti-Spam Act: sender info, unsubscribe link','Privacy Act: subscriber info encryption'],['解除後配信|リスト更新漏れ|対策:即時反映、定期同期','スパム判定|SPF/DKIM未設定|対策:認証設定、レピュテーション管理'],['Send after unsubscribe|List update miss|Fix: immediate reflect, periodic sync','Spam flagged|No SPF/DKIM|Fix: auth setup, reputation management'],['配信→architecture.md(email), api_spec.md','分析→stakeholders.md, architecture.md(analytics)'],['Send→architecture.md(email), api_spec.md','Analytics→stakeholders.md, architecture.md(analytics)'],'配信最適化|開封率向上|入力:配信履歴、開封率、クリック率|判断:開封<20%→件名改善、クリック<5%→CTA最適化|出力:改善案、期待開封率','Delivery Optimization|Improve open rate|Input: send history, open rate, click rate|Judgment: open<20%→improve subject, click<5%→optimize CTA|Output: improvement plan, expected open rate')
};
// Growth Intelligence data
const _dg=(fj,fe,cvr,eq,lj,le,pj,pe)=>({fj,fe,cvr,eq,lj,le,pj,pe});
const DOMAIN_GROWTH={
ec:_dg(
['訪問','商品閲覧','カート追加','決済完了','リピート'],
['Visit','Browse','Add to Cart','Checkout','Repeat'],
[100,40,12,3,1.2],
'Revenue = Traffic × Browse_CVR × Cart_CVR × Checkout_CVR × AOV × Repeat',
['SEO/広告流入増','レコメンド精度','カート放棄防止','決済UX簡素化','ポイント/会員制度'],
['SEO/ad traffic','Recommendation accuracy','Cart abandon prevention','Checkout UX','Loyalty program'],
['単品:¥3,000-5,000','おすすめ:¥5,000-8,000','プレミアム:¥10,000+'],
['Basic:$30-50','Recommended:$50-80','Premium:$100+']
),
saas:_dg(
['LP訪問','サインアップ','Aha体験','有料転換','拡張/紹介'],
['LP Visit','Signup','Aha Moment','Paid Convert','Expand/Refer'],
[100,30,18,5.4,2.7],
'MRR = Signups × Activation × Paid_CVR × ARPU - Churn',
['LP CVR改善','オンボーディング最適化','フリーミアム導線','チャーン防止','紹介プログラム'],
['Optimize LP CVR','Improve onboarding','Free-to-paid path','Churn prevention','Referral program'],
['Free:¥0','Pro:¥980/月','Enterprise:¥9,800/月'],
['Free:$0','Pro:$10/mo','Enterprise:$100/mo']
),
education:_dg(
['認知','無料体験','受講開始','修了','上位コース'],
['Awareness','Free Trial','Enroll','Complete','Upsell'],
[100,25,10,6,2.4],
'Revenue = Students × Trial_CVR × Enroll_CVR × Price + Upsell',
['コンテンツSEO','体験レッスン品質','松竹梅価格','修了率(ゲーミフィケーション)','上位コース提案'],
['Content SEO','Trial quality','3-tier pricing','Completion rate (gamify)','Upsell suggestion'],
['入門:¥3,000','標準:¥9,800','プレミアム:¥29,800'],
['Intro:$30','Standard:$100','Premium:$300']
),
fintech:_dg(
['登録','KYC完了','初回取引','アクティブ利用','プレミアム転換'],
['Register','KYC Complete','First Txn','Active Use','Premium'],
[100,60,30,20,5],
'Revenue = Users × KYC_Rate × Active × Txn_Vol × Fee + Premium_MRR',
['広告/PR','KYC UX簡素化','初回ボーナス','定期利用促進','プレミアム訴求'],
['Ads/PR','Simplify KYC','First-time bonus','Regular use incentive','Premium pitch'],
['無料:基本取引','Pro:¥980/月','法人:¥29,800/月'],
['Free:basic','Pro:$10/mo','Business:$300/mo']
),
booking:_dg(
['検索','空き確認','予約','来店/利用','リピート'],
['Search','Availability','Book','Visit','Rebook'],
[100,60,20,17,7],
'Revenue = Searches × Book_CVR × Show_Rate × Price × Commission',
['SEO/口コミ','リアルタイム在庫','予約UX','リマインダー','リピート割引'],
['SEO/reviews','Real-time inventory','Booking UX','Reminders','Repeat discounts'],
['通常:¥3,000-5,000/回','人気:¥8,000/回','プレミアム:¥15,000/回'],
['Standard:$30-50','Popular:$80','Premium:$150']
),
community:_dg(
['訪問','登録','初投稿','アクティブ化','有料/寄付'],
['Visit','Register','First Post','Active','Paid/Donate'],
[100,20,8,3,0.6],
'Revenue = MAU × Active_Rate × Paid_CVR × ARPU + Ad_Revenue',
['口コミ/招待','ウェルカムガイド','投稿促進(バッジ)','文化醸成','プレミアム機能'],
['Word of mouth','Welcome guide','Post incentive (badges)','Culture building','Premium features'],
['無料:基本','Pro:¥500/月','サポーター:¥3,000/月'],
['Free:basic','Pro:$5/mo','Supporter:$30/mo']
),
marketplace:_dg(
['訪問','検索/閲覧','問合せ/入札','成約','リピート/評価'],
['Visit','Search','Inquiry/Bid','Deal','Repeat/Rate'],
[100,50,15,6,2.4],
'GMV = Listings × Bid_Rate × Close_Rate × Avg_Deal',
['出品者獲得','検索精度','マッチング最適化','エスクロー信頼性','評価制度'],
['Acquire sellers','Search accuracy','Matching optimization','Escrow trust','Rating system'],
['出品無料→成約手数料8%','プレミアム掲載:¥2,000/月','Featured:¥5,000/回'],
['Free list→8% commission','Premium:$20/mo','Featured:$50/time']
),
_default:_dg(
['認知','登録','利用開始','習慣化','課金/推薦'],
['Awareness','Register','First Use','Habit','Pay/Refer'],
[100,25,12,5,2],
'Revenue = Users × Activation × Retention × ARPU',
['認知拡大(SEO/SNS)','登録フロー簡素化','Aha体験短縮','通知/メール','価格最適化'],
['Awareness (SEO/SNS)','Simplify registration','Shorten Aha moment','Push/email','Optimize pricing'],
['Free:基本','Standard:¥980/月','Premium:¥4,980/月'],
['Free:basic','Standard:$10/mo','Premium:$50/mo']
)
};
// Get domain-specific QA strategy
function getDomainQA(domain,G){
const qa=DOMAIN_QA_MAP[domain];
if(!qa)return null;
const cross=Object.values(QA_CROSS_CUTTING).filter(c=>c.domains.includes(domain));
return {focus:G?qa.focus_ja:qa.focus_en,bugs:G?qa.bugs_ja:qa.bugs_en,priority:qa.priority,crossCutting:cross.map(c=>G?c.ja:c.en)};
}
/// ── B9: URL/Routing Table Generation ──
function genRoutes(a){
const G=S.genLang==='ja';
const routes=[
{path:'/',name:G?'ランディング':'Landing',auth:false},
{path:'/login',name:G?'ログイン':'Login',auth:false},
{path:'/register',name:G?'新規登録':'Register',auth:false},
];
// Screen name → URL mapping (Japanese & English)
const MAP=[
[/ランディング|landing|LP|トップ|top|ホーム|home/i,'/',false],
[/ログイン|login|サインイン|signin/i,'/login',false],
[/新規登録|register|signup|サインアップ/i,'/register',false],
[/ダッシュボード|dashboard/i,'/dashboard',true],
[/設定|setting/i,'/settings',true],
[/プロフィール|profile|マイページ/i,'/profile',true],
[/管理|admin/i,'/admin',true],
[/検索|search/i,'/search',false],
[/通知|notification/i,'/notifications',true],
[/メッセージ|message|チャット|chat/i,'/messages',true],
[/一覧|list|リスト/i,'/list',true],
[/詳細|detail/i,'/[id]',true],
[/作成|create|新規作成/i,'/create',true],
[/編集|edit/i,'/[id]/edit',true],
[/課金|billing|サブスク|subscription|料金|pricing/i,'/pricing',false],
[/お問い合わせ|contact/i,'/contact',false],
[/利用規約|terms/i,'/terms',false],
[/about|概要/i,'/about',false],
];
const screens=(a.screens||'').split(', ').filter(Boolean);
screens.forEach(s=>{
const raw=s.replace(/\(P[0-2]\)/gi,'').trim();
const matched=MAP.find(([rx])=>rx.test(raw));
if(matched){routes.push({path:matched[1],name:raw,auth:matched[2]});}
else{
const slug=raw.replace(/[ぁ-んァ-ヶ一-龥々〇〻\u3400-\u9FFF\uF900-\uFAFF]/g,'')
.toLowerCase().replace(/[^a-z0-9]/g,'-').replace(/-+/g,'-').replace(/^-|-$/g,'');
routes.push({path:'/'+(slug||'page'),name:raw,auth:true});
}
});
const seen=new Set();
return routes.filter(r=>{if(seen.has(r.path))return false;seen.add(r.path);return true;});
}
// ── C: Post-Generation Audit ──
function postGenerationAudit(files,a){
const findings=[];
const G=S.genLang==='ja';
const constitution=files['.spec/constitution.md']||'';
const spec=files['.spec/specification.md']||'';
const techPlan=files['.spec/technical-plan.md']||'';
const tasks=files['.spec/tasks.md']||'';
const verify=files['.spec/verification.md']||'';
// C1: Auth SoT consistency
const auth=resolveAuth(a);
const authInConst=constitution.includes(auth.sot);
const authInSpec=spec.includes(auth.sot);
const authInTP=techPlan.includes(auth.sot);
if(!authInConst||!authInSpec||!authInTP){
findings.push({level:'error',msg:G?'認証SoTが全文書で一致していません':'Auth SoT inconsistent across documents'});
}
// C2: Architecture pattern consistency
const arch=resolveArch(a);
if(arch.pattern==='baas'&&techPlan.includes('API Gateway')){
findings.push({level:'error',msg:G?'BaaS構成なのにAPI Gatewayが記載されています':'API Gateway present in BaaS architecture'});
}
if(arch.pattern==='bff'&&techPlan.includes('api/')){
// Only warn if separate api/ directory exists (should use app/api/)
if(techPlan.includes('├── api/')){
findings.push({level:'warn',msg:G?'BFF構成では api/ ディレクトリは不要です（app/api/ を使用）':'BFF pattern should not have separate api/ directory (use app/api/)'});
}
}
// C3: Scope vs features conflict
const scopeOut=(a.scope_out||'').toLowerCase();
if(scopeOut.includes('ネイティブ')&&spec.includes('Expo')&&!constitution.includes('Expo Web UI')){
findings.push({level:'error',msg:G?'スコープ外「ネイティブ」と仕様のExpo記述が矛盾':'Scope excludes native but spec includes Expo'});
}
// C4: Entity domain warnings
const er=inferER(a);
er.warnings.forEach(w=>findings.push({level:'warn',msg:w}));
// C5: Schedule date present
if(tasks&&!tasks.includes(new Date().toISOString().split('T')[0].slice(0,7))){
findings.push({level:'info',msg:G?'タスクの開始日が今月と異なります':'Task start date differs from current month'});
}
// C6: DevContainer matches backend
const compose=files['.devcontainer/docker-compose.yml']||'';
const be=a.backend||'';
if(be.includes('Supabase')&&compose.includes('postgres:16')){
findings.push({level:'error',msg:G?'Supabase構成なのにDevContainerが素PostgreSQLです':'Supabase stack but DevContainer uses raw PostgreSQL'});
}
if(be.includes('Firebase')&&compose.includes('postgres:16')){
findings.push({level:'error',msg:G?'Firebase構成なのにDevContainerにPostgreSQLがあります':'Firebase stack but DevContainer includes PostgreSQL'});
}
// C7: Package.json dependencies match stack
const pkg=files['package.json']?JSON.parse(files['package.json']):{};
const deps=pkg.dependencies||{};
if(be.includes('Supabase')&&!deps['@supabase/supabase-js']){
findings.push({level:'warn',msg:G?'Supabase使用なのにpackage.jsonに@supabase/supabase-jsがありません':'Supabase stack but @supabase/supabase-js missing from package.json'});
}
if(be.includes('Express')&&!deps['express']){
findings.push({level:'warn',msg:G?'Express使用なのにpackage.jsonにexpressがありません':'Express stack but express missing from package.json'});
}
// C8: .env prefix matches frontend
const envFile=files['.env.example']||'';
const feRaw=a.frontend||'';
if(feRaw.includes('Vite')&&envFile.includes('NEXT_PUBLIC_')){
findings.push({level:'error',msg:G?'Vite SPAなのに.envにNEXT_PUBLIC_があります':'Vite SPA but .env uses NEXT_PUBLIC_ prefix'});
}
if(feRaw.includes('Next')&&envFile.includes('VITE_')){
findings.push({level:'error',msg:G?'Next.jsなのに.envにVITE_があります':'Next.js but .env uses VITE_ prefix'});
}
// C9: Monitoring matches deploy target
const monDoc=files['docs/17_monitoring.md']||'';
const deploy=a.deploy||'';
if(!deploy.includes('Vercel')&&monDoc.includes('Vercel Analytics')){
findings.push({level:'warn',msg:G?'デプロイ先がVercelではないのにVercel Analyticsが記載されています':'Non-Vercel deploy but Vercel Analytics in monitoring doc'});
}
// C10: BaaS should not have Prisma deps
if(arch.isBaaS&&((pkg.devDependencies||{})['prisma']||deps['@prisma/client'])){
findings.push({level:'warn',msg:G?'BaaS構成なのにPrisma依存があります':'BaaS stack but Prisma dependencies present'});
}
return findings;
}
function genCommonFiles(a,pn){
const G=S.genLang==='ja';
S.files['README.md']=`# ${pn}
> Generated by [DevForge v9](https://github.com/) — ${G?'AI駆動開発統合プラットフォーム':'AI-driven Development Platform'}
## ${G?'概要':'Overview'}
${a.purpose||'N/A'}
## ${G?'技術スタック':'Tech Stack'}
- Frontend: ${a.frontend||'React + Next.js'}
- Backend: ${a.backend||'Node.js'}
- Database: ${a.database||'PostgreSQL'}
- Deploy: ${a.deploy||'Vercel'}
${!isNone(a.mobile)?`- Mobile: ${a.mobile}\n`:''}
## ${G?'セットアップ':'Setup'}
\`\`\`bash
git clone https://github.com/YOUR_USERNAME/${pn.toLowerCase().replace(/[^a-z0-9]/g,'-')}.git
cd ${pn.toLowerCase().replace(/[^a-z0-9]/g,'-')}
npm install
cp .env.example .env.local
npm run dev
\`\`\`
## ${G?'プロジェクト構造':'Project Structure'}
- \`.spec/\` — ${G?'SDD仕様書（柱①）':'SDD specs (Pillar 1)'}
- \`.devcontainer/\` — ${G?'開発環境（柱②）':'Dev environment (Pillar 2)'}
- \`.mcp/\` — ${G?'MCP設定（柱③）':'MCP config (Pillar 3)'}
- \`CLAUDE.md\` etc. — ${G?'AIルール（柱④）':'AI rules (Pillar 4)'}
- \`roadmap/\` — ${G?'学習ロードマップ（柱⑦）':'Learning roadmap (Pillar 7)'}
- \`docs/\` — ${G?'開発ドキュメント（21ファイル）':'Dev documents (21 files)'}
## ${G?'駆動開発手法':'Dev Methods'}
${(a.dev_methods||'TDD').split(', ').join(' / ')}
## ${G?'ライセンス':'License'}
MIT
---
${G?'© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん':'© 2026 Engineering no Tane Committee | by にしあん'}
`;
const isNextFE=(a.frontend||'').includes('Next');
const gitIgnoreLines=['node_modules/',isNextFE?'.next/':'dist/','build/','.env','.env.local','*.log','.DS_Store','coverage/','.turbo/'];
if((a.backend||'').includes('Supabase')) gitIgnoreLines.push('.supabase/');
S.files['.gitignore']=gitIgnoreLines.join('\n')+'\n';
const pkgDeps=buildDeps(a);
S.files['package.json']=JSON.stringify({
name:pn.toLowerCase().replace(/[^a-z0-9]/g,'-'),
version:'0.1.0',
private:true,
scripts:pkgDeps.scripts,
dependencies:pkgDeps.deps,devDependencies:pkgDeps.devDeps
},null,2);
S.files['LICENSE']=`MIT License\n\nCopyright (c) ${new Date().getFullYear()} ${pn}\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the "Software"), to deal\nin the Software without restriction, including without limitation the rights\n
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n
\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.`;
}
// ═══ Pillar 11: Implementation Intelligence Data Structures ═══
// ── App Type Detection ──
function detectAppType(a){
const fe=a.frontend||'';
const be=a.backend||'';
const mob=a.mobile||'none';
// Realtime apps
if((a.mvp_features||'').match(/(リアルタイム|realtime|チャット|chat|通知|notification|ライブ|live)/i)) return 'realtime';
// Mobile-first
if(mob!=='none'&&mob!=='なし') return 'mobile';
// API-only (no frontend)
if(isNone(fe)||fe==='API only') return 'api_only';
// PWA
if(fe.includes('PWA')||(a.mvp_features||'').includes('PWA')) return 'pwa';
// SSR frameworks
if(fe.includes('Next')||fe.includes('Nuxt')||fe.includes('Remix')||fe.includes('SvelteKit')) return 'ssr';
// SPA default
return 'spa';
}
// ── Domain-Specific Implementation Pattern Helper ──
function _dip(impl_ja,impl_en,pseudo,guard_ja,guard_en){
return {impl_ja:impl_ja,impl_en:impl_en,pseudo:pseudo,guard_ja:guard_ja,guard_en:guard_en};
}
// ── Domain Implementation Patterns (24 domains) ──
const DOMAIN_IMPL_PATTERN={
education:_dip(
['進捗トラッキングはイベントソーシングで実装','コース完了判定はサーバーサイドで検証','レッスン順序制御はFKと順序カラムで管理'],
['Implement progress tracking with event sourcing','Validate course completion server-side','Control lesson order with FK and sequence column'],
'function trackProgress(userId,lessonId,courseId){\n const event={type:"LESSON_COMPLETED",userId,lessonId,timestamp:Date.now()};\n emit(event);\n const progress=getLessonProgress(userId,courseId);\n if(progress.completed===progress.total) emit({type:"COURSE_COMPLETED",userId,courseId});\n}',
['未完了レッスンへのスキップを防止','進捗率の逆戻り禁止','修了証明書の改ざん防止'],
['Prevent skipping to incomplete lessons','Disallow progress regression','Prevent certificate tampering']
),
ec:_dip(
['在庫ロックは楽観的ロック(version列)で実装','決済は冪等性キー必須','カート→注文確定は2フェーズコミット'],
['Implement inventory locking with optimistic lock (version column)','Payment must use idempotency key','Cart to order confirmation uses 2-phase commit'],
'function reserveInventory(productId,qty){\n const row=db.query("SELECT stock,version FROM products WHERE id=? FOR UPDATE",[productId]);\n if(row.stock<qty) throw new Error("Out of stock");\n db.execute("UPDATE products SET stock=stock-?, version=version+1 WHERE id=? AND version=?",[qty,productId,row.version]);\n}',
['在庫数マイナス防止','同時購入による在庫過剰引当て','決済と在庫確保の不整合'],
['Prevent negative stock','Prevent over-allocation from concurrent purchases','Prevent payment-inventory inconsistency']
),
fintech:_dip(
['残高更新はトランザクション必須','二重送金防止は送金テーブルにユニーク制約','監査ログはイミュータブルテーブル'],
['Balance updates require transactions','Prevent double transfers with unique constraint on transfer table','Audit logs use immutable table'],
'function transfer(fromId,toId,amount,idempotencyKey){\n db.transaction(()=>{\n db.execute("INSERT INTO transfers (from_user,to_user,amount,idempotency_key) VALUES (?,?,?,?)",[fromId,toId,amount,idempotencyKey]);\n db.execute("UPDATE accounts SET balance=balance-? WHERE user_id=?",[amount,fromId]);\n db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[amount,toId]);\n db.execute("INSERT INTO audit_logs (action,user_id,details) VALUES (?,?,?)",["TRANSFER",fromId,JSON.stringify({toId,amount})]);\n });\n}',
['残高マイナス防止','送金の二重実行','監査ログの削除・改ざん'],
['Prevent negative balance','Prevent double execution of transfers','Prevent deletion/tampering of audit logs']
),
health:_dip(
['患者データは暗号化カラムで保存','アクセスログは全操作記録','同意管理は専用テーブルで管理'],
['Store patient data in encrypted columns','Record all operations in access logs','Manage consent with dedicated table'],
'function accessPatientRecord(doctorId,patientId,purpose){\n if(!hasConsent(patientId,purpose)) throw new Error("No consent");\n const record=db.query("SELECT decrypt(medical_data) FROM patients WHERE id=?",[patientId]);\n db.execute("INSERT INTO access_logs (doctor_id,patient_id,purpose,timestamp) VALUES (?,?,?,?)",[doctorId,patientId,purpose,Date.now()]);\n return record;\n}',
['同意なしアクセス防止','暗号化キー漏洩','アクセスログ削除'],
['Prevent access without consent','Prevent encryption key leakage','Prevent access log deletion']
),
marketplace:_dip(
['取引エスクローはステートマシンで管理','評価の相互投稿は取引完了後のみ許可','手数料計算はサーバーサイド'],
['Manage escrow transactions with state machine','Allow mutual reviews only after transaction completion','Calculate fees server-side'],
'function completeTransaction(txId){\n const tx=db.query("SELECT * FROM transactions WHERE id=? FOR UPDATE",[txId]);\n if(tx.status!=="escrow") throw new Error("Invalid state");\n const fee=tx.amount*0.05;\n db.transaction(()=>{\n db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[tx.amount-fee,tx.seller_id]);\n db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[fee,"platform"]);\n db.execute("UPDATE transactions SET status=\'completed\' WHERE id=?",[txId]);\n });\n}',
['エスクロー状態の不正遷移','手数料計算の改ざん','評価の不正投稿'],
['Prevent invalid escrow state transition','Prevent fee calculation tampering','Prevent fraudulent reviews']
),
community:_dip(
['投稿のモデレーションはキューで非同期処理','スパム検出はレート制限+コンテンツフィルタ','ユーザーブロックは双方向テーブル'],
['Process post moderation asynchronously with queue','Detect spam with rate limiting + content filter','Manage user blocks with bidirectional table'],
'function createPost(userId,content){\n if(isRateLimited(userId)) throw new Error("Rate limit exceeded");\n const postId=db.insert("INSERT INTO posts (user_id,content,status) VALUES (?,?,\'pending\')",[userId,content]);\n queue.push({task:"MODERATE_POST",postId:postId});\n return postId;\n}',
['スパム投稿の大量作成','モデレーション回避','ブロックユーザーの相互作用'],
['Prevent mass spam posting','Prevent moderation bypass','Prevent blocked user interaction']
),
content:_dip(
['コンテンツ公開はスケジューラで予約投稿','バージョン管理はdraft/publishedテーブル分離','メディアアップロードは署名付きURL'],
['Schedule content publishing with scheduler','Manage versions with separate draft/published tables','Use signed URLs for media uploads'],
'function schedulePublish(contentId,publishAt){\n db.execute("UPDATE contents SET status=\'scheduled\',publish_at=? WHERE id=?",[publishAt,contentId]);\n scheduler.add({task:"PUBLISH_CONTENT",contentId:contentId,runAt:publishAt});\n}',
['未公開コンテンツの漏洩','公開日時の改ざん','メディアファイルの不正アクセス'],
['Prevent unpublished content leakage','Prevent publish date tampering','Prevent unauthorized media access']
),
analytics:_dip(
['イベント収集はバッチ挿入で高速化','集計はマテリアライズドビュー','リアルタイム更新はWebSocket'],
['Speed up event collection with batch insert','Use materialized views for aggregation','Use WebSocket for realtime updates'],
'function trackEvent(userId,eventType,properties){\n eventBuffer.push({userId,eventType,properties,timestamp:Date.now()});\n if(eventBuffer.length>=100){\n db.batchInsert("INSERT INTO events (user_id,event_type,properties,timestamp) VALUES ?",eventBuffer);\n eventBuffer=[];\n }\n}',
['イベント欠損','集計の遅延','ダッシュボードの過負荷'],
['Prevent event loss','Prevent aggregation delays','Prevent dashboard overload']
),
booking:_dip(
['予約の排他制御は行ロック+タイムアウト','キャンセルポリシーはステータス遷移で管理','リマインダーはスケジューラで自動送信'],
['Control booking exclusivity with row lock + timeout','Manage cancellation policy with status transition','Auto-send reminders with scheduler'],
'function createBooking(userId,slotId,startTime){\n db.transaction(()=>{\n const slot=db.query("SELECT * FROM slots WHERE id=? FOR UPDATE",[slotId]);\n if(slot.status!=="available") throw new Error("Slot unavailable");\n db.execute("INSERT INTO bookings (user_id,slot_id,start_time,status) VALUES (?,?,?,\'confirmed\')",[userId,slotId,startTime]);\n db.execute("UPDATE slots SET status=\'booked\' WHERE id=?",[slotId]);\n scheduler.add({task:"SEND_REMINDER",bookingId:bookingId,runAt:startTime-3600000});\n });\n}',
['ダブルブッキング','キャンセル不可期間の無視','リマインダー送信漏れ'],
['Prevent double booking','Prevent ignoring non-cancellable period','Prevent missed reminder sending']
),
saas:_dip(
['プラン制限はミドルウェアでチェック','使用量メーターはカウンターテーブル','サブスク更新はWebhookで同期'],
['Check plan limits in middleware','Track usage with counter table','Sync subscription updates with webhook'],
'function checkLimit(userId,feature){\n const plan=db.query("SELECT plan FROM users WHERE id=?",[userId]);\n const usage=db.query("SELECT count FROM usage WHERE user_id=? AND feature=?",[userId,feature]);\n const limit=PLAN_LIMITS[plan.plan][feature];\n if(usage.count>=limit) throw new Error("Limit exceeded");\n}',
['プラン制限の回避','使用量カウントの不整合','サブスク状態のズレ'],
['Prevent plan limit bypass','Prevent usage count inconsistency','Prevent subscription state drift']
),
portfolio:_dip(
['作品公開はステータスフラグ','タグ検索はインデックス必須','アクセス解析はログテーブル'],
['Control work visibility with status flag','Tag search requires index','Track analytics with log table'],
'function publishWork(userId,workId){\n db.execute("UPDATE works SET status=\'published\',published_at=? WHERE id=? AND user_id=?",[Date.now(),workId,userId]);\n db.execute("INSERT INTO activity_logs (user_id,action,target_id) VALUES (?,\'PUBLISH\',?)",[userId,workId]);\n}',
['非公開作品の漏洩','タグスパム','統計の不正操作'],
['Prevent private work leakage','Prevent tag spam','Prevent stat manipulation']
),
tool:_dip(
['API呼び出しはレート制限必須','結果キャッシュはTTL付きRedis','エラーはリトライ+フォールバック'],
['Apply rate limiting to API calls','Cache results with TTL in Redis','Implement retry + fallback for errors'],
'function callAPI(userId,endpoint,params){\n const cacheKey=`api:${endpoint}:${JSON.stringify(params)}`;\n const cached=redis.get(cacheKey);\n if(cached) return cached;\n const result=fetch(endpoint,params);\n redis.set(cacheKey,result,{EX:300});\n return result;\n}',
['APIレート超過','キャッシュ汚染','エラー時のユーザー影響'],
['Prevent API rate excess','Prevent cache pollution','Prevent user impact on errors']
),
iot:_dip(
['デバイスデータはタイムシリーズDB','異常検知はしきい値+アラート','ファームウェア更新はバージョン管理'],
['Store device data in time-series DB','Detect anomalies with threshold + alert','Manage firmware updates with versioning'],
'function recordSensorData(deviceId,sensorType,value){\n influxDB.write({measurement:sensorType,tags:{deviceId},fields:{value},timestamp:Date.now()});\n if(value>THRESHOLD[sensorType]){\n alert.send({type:"ANOMALY",deviceId,sensorType,value});\n }\n}',
['データ欠損','異常検知の遅延','不正ファームウェア配信'],
['Prevent data loss','Prevent anomaly detection delay','Prevent malicious firmware distribution']
),
realestate:_dip(
['物件ステータスは排他制御','内見予約は重複チェック','契約書は電子署名'],
['Control property status with exclusive lock','Check duplicates for viewing appointments','Use e-signature for contracts'],
'function reserveViewing(userId,propertyId,datetime){\n db.transaction(()=>{\n const existing=db.query("SELECT * FROM viewings WHERE property_id=? AND datetime=?",[propertyId,datetime]);\n if(existing) throw new Error("Slot taken");\n db.execute("INSERT INTO viewings (user_id,property_id,datetime,status) VALUES (?,?,?,\'confirmed\')",[userId,propertyId,datetime]);\n });\n}',
['物件ステータスの不整合','内見ダブルブッキング','契約書の改ざん'],
['Prevent property status inconsistency','Prevent viewing double booking','Prevent contract tampering']
),
legal:_dip(
['契約文書はバージョン管理','アクセス権限は役割ベース','変更履歴はイミュータブル'],
['Manage contracts with versioning','Control access with role-based permissions','Track change history immutably'],
'function updateContract(userId,contractId,newContent){\n const current=db.query("SELECT version FROM contracts WHERE id=?",[contractId]);\n db.transaction(()=>{\n db.execute("INSERT INTO contract_versions (contract_id,version,content,updated_by) VALUES (?,?,?,?)",[contractId,current.version+1,newContent,userId]);\n db.execute("UPDATE contracts SET version=version+1 WHERE id=?",[contractId]);\n });\n}',
['契約内容の不正変更','アクセス権限の逸脱','変更履歴の削除'],
['Prevent unauthorized contract changes','Prevent access permission violation','Prevent change history deletion']
),
hr:_dip(
['応募者データは暗号化','選考ステータスはワークフロー','オファー承諾は電子署名'],
['Encrypt applicant data','Manage selection status with workflow','Use e-signature for offer acceptance'],
'function updateApplicantStatus(applicantId,newStatus){\n const current=db.query("SELECT status FROM applicants WHERE id=?",[applicantId]);\n if(!isValidTransition(current.status,newStatus)) throw new Error("Invalid transition");\n db.execute("UPDATE applicants SET status=?,updated_at=? WHERE id=?",[newStatus,Date.now(),applicantId]);\n db.execute("INSERT INTO status_history (applicant_id,from_status,to_status) VALUES (?,?,?)",[applicantId,current.status,newStatus]);\n}',
['個人情報漏洩','選考ステータスの不正遷移','オファー条件の改ざん'],
['Prevent personal info leakage','Prevent invalid status transition','Prevent offer condition tampering']
),
ai:_dip(
['プロンプトはテンプレート管理','API呼び出しはキュー+リトライ','生成結果はバージョン保存'],
['Manage prompts with templates','Use queue + retry for API calls','Save generation results with versioning'],
'function generateContent(userId,promptId,params){\n const template=db.query("SELECT template FROM prompts WHERE id=?",[promptId]);\n const prompt=renderTemplate(template,params);\n const job={userId,prompt,status:"pending"};\n queue.push(job);\n return job.id;\n}',
['プロンプトインジェクション','APIコスト暴走','生成結果の紛失'],
['Prevent prompt injection','Prevent API cost runaway','Prevent loss of generation results']
),
automation:_dip(
['ワークフローはDAGで定義','実行履歴は全ステップ記録','失敗時は自動リトライ'],
['Define workflows with DAG','Record all steps in execution history','Auto-retry on failure'],
'function executeWorkflow(workflowId,input){\n const steps=db.query("SELECT * FROM workflow_steps WHERE workflow_id=? ORDER BY sequence",[workflowId]);\n let context=input;\n for(const step of steps){\n try{\n context=executeStep(step,context);\n db.execute("INSERT INTO execution_logs (workflow_id,step_id,status,output) VALUES (?,?,\'success\',?)",[workflowId,step.id,context]);\n }catch(e){\n db.execute("INSERT INTO execution_logs (workflow_id,step_id,status,error) VALUES (?,?,\'failed\',?)",[workflowId,step.id,e.message]);\n if(step.retry) retry(step,context);\n }\n }\n}',
['循環依存の発生','ステップ実行順序の誤り','失敗時のデータ不整合'],
['Prevent circular dependencies','Prevent step execution order errors','Prevent data inconsistency on failure']
),
event:_dip(
['参加登録は定員チェック','チケット発行はユニークコード','入場管理はQRスキャン'],
['Check capacity for registration','Issue tickets with unique code','Manage entry with QR scan'],
'function registerEvent(userId,eventId){\n db.transaction(()=>{\n const event=db.query("SELECT capacity,(SELECT COUNT(*) FROM registrations WHERE event_id=?) as current FROM events WHERE id=? FOR UPDATE",[eventId,eventId]);\n if(event.current>=event.capacity) throw new Error("Event full");\n const ticketCode=generateUniqueCode();\n db.execute("INSERT INTO registrations (user_id,event_id,ticket_code,status) VALUES (?,?,?,\'confirmed\')",[userId,eventId,ticketCode]);\n });\n}',
['定員超過登録','チケットコード重複','不正入場'],
['Prevent over-capacity registration','Prevent ticket code duplication','Prevent unauthorized entry']
),
gamify:_dip(
['ポイント付与はトランザクション','ランキングは集計テーブル','実績解除はサーバー検証'],
['Award points with transaction','Use aggregation table for ranking','Verify achievement unlock server-side'],
'function awardPoints(userId,points,reason){\n db.transaction(()=>{\n db.execute("UPDATE users SET points=points+? WHERE id=?",[points,userId]);\n db.execute("INSERT INTO point_logs (user_id,points,reason,timestamp) VALUES (?,?,?,?)",[userId,points,reason,Date.now()]);\n checkAchievements(userId);\n });\n}',
['ポイント不正取得','ランキング操作','実績の不正解除'],
['Prevent point fraud','Prevent ranking manipulation','Prevent achievement unlock fraud']
),
collab:_dip(
['リアルタイム編集はOT/CRDT','競合解決は最終書込み優先','バージョン履歴は差分保存'],
['Implement realtime editing with OT/CRDT','Resolve conflicts with last-write-wins','Save version history as diffs'],
'function applyEdit(docId,userId,operation){\n const doc=getDocument(docId);\n const transformed=transformOperation(operation,doc.pendingOps);\n applyOperation(doc,transformed);\n broadcast({docId,userId,operation:transformed});\n saveVersion(docId,transformed);\n}',
['編集競合によるデータ破損','バージョン履歴の肥大化','同時編集の遅延'],
['Prevent data corruption from edit conflicts','Prevent version history bloat','Prevent concurrent edit latency']
),
devtool:_dip(
['コマンド実行はサンドボックス','ログ出力はストリーミング','ビルド成果物はキャッシュ'],
['Execute commands in sandbox','Stream log output','Cache build artifacts'],
'function executeCommand(cmd,env){\n const sandbox=createSandbox(env);\n const process=sandbox.exec(cmd);\n process.stdout.on("data",(chunk)=>{\n stream.write(chunk);\n });\n process.on("exit",(code)=>{\n if(code===0) cacheArtifacts(sandbox.output);\n });\n}',
['任意コード実行','ログの機密情報漏洩','キャッシュ汚染'],
['Prevent arbitrary code execution','Prevent sensitive info leakage in logs','Prevent cache pollution']
),
creator:_dip(
['コンテンツ収益化はサブスク+投げ銭','収益分配は自動計算','著作権は電子透かし'],
['Monetize content with subscription + tips','Auto-calculate revenue sharing','Protect copyright with watermark'],
'function tipCreator(userId,creatorId,amount){\n db.transaction(()=>{\n db.execute("UPDATE accounts SET balance=balance-? WHERE user_id=?",[amount,userId]);\n const platformFee=amount*0.1;\n db.execute("UPDATE accounts SET balance=balance+? WHERE user_id=?",[amount-platformFee,creatorId]);\n db.execute("INSERT INTO transactions (from_user,to_user,amount,type) VALUES (?,?,?,\'tip\')",[userId,creatorId,amount]);\n });\n}',
['収益計算の誤り','手数料の不正操作','コンテンツの無断転載'],
['Prevent revenue calculation errors','Prevent fee manipulation','Prevent unauthorized content reuse']
),
newsletter:_dip(
['配信リストは購読ステータス管理','メール送信はキュー+レート制限','開封率はピクセルトラッキング'],
['Manage distribution list with subscription status','Send emails with queue + rate limiting','Track open rate with pixel tracking'],
'function sendNewsletter(newsletterId,subscriberIds){\n subscriberIds.forEach(id=>{\n const trackingPixel=generateTrackingPixel(newsletterId,id);\n const email=renderEmail(newsletterId,{trackingPixel});\n queue.push({task:"SEND_EMAIL",to:id,content:email});\n });\n}',
['購読解除の無視','配信レート超過','開封率の不正操作'],
['Prevent ignoring unsubscription','Prevent sending rate excess','Prevent open rate manipulation']
),
_default:_dip(
['データ整合性はトランザクション','エラーハンドリングは必須','ログ記録は全操作'],
['Ensure data integrity with transactions','Error handling is mandatory','Log all operations'],
'function performOperation(data){\n try{\n db.transaction(()=>{\n validateInput(data);\n const result=processData(data);\n logOperation(result);\n return result;\n });\n }catch(e){\n logError(e);\n throw e;\n }\n}',
['データ不整合','エラーの握りつぶし','操作履歴の欠落'],
['Prevent data inconsistency','Prevent error suppression','Prevent operation history loss']
)
};
// ── App Type Implementation Patterns ──
const APP_TYPE_MAP={
spa:{
patterns_ja:['状態管理はRedux/Zustand','ルーティングはReact Router','認証はトークンベース','API呼び出しはaxios/fetch'],
patterns_en:['State management with Redux/Zustand','Routing with React Router','Token-based auth','API calls with axios/fetch'],
antipatterns_ja:['SEOが必要なのにSPA','初回ロードが遅い','認証トークンをlocalStorageに平文保存'],
antipatterns_en:['Using SPA when SEO is required','Slow initial load','Storing auth tokens in localStorage plaintext']
},
ssr:{
patterns_ja:['データフェッチはgetServerSideProps','SEOメタタグは動的生成','認証はサーバーセッション','静的ページはISR'],
patterns_en:['Data fetching with getServerSideProps','Dynamically generate SEO meta tags','Server-side session auth','Static pages with ISR'],
antipatterns_ja:['全ページSSR(不要なページまで)','サーバー負荷考慮なし','クライアント状態とサーバー状態の不一致'],
antipatterns_en:['SSR all pages (even unnecessary ones)','No server load consideration','Client-server state mismatch']
},
pwa:{
patterns_ja:['Service Workerでオフライン対応','マニフェストファイル必須','プッシュ通知はVAPID','キャッシュ戦略はCache First'],
patterns_en:['Offline support with Service Worker','Manifest file required','Push notifications with VAPID','Cache strategy: Cache First'],
antipatterns_ja:['キャッシュクリア手段なし','オフライン時のUX考慮不足','バックグラウンド同期なし'],
antipatterns_en:['No cache clearing mechanism','Poor offline UX consideration','No background sync']
},
mobile:{
patterns_ja:['ネイティブ機能はExpo Modules','状態管理はRedux Toolkit','ナビゲーションはReact Navigation','プッシュ通知はExpo Notifications'],
patterns_en:['Native features with Expo Modules','State management with Redux Toolkit','Navigation with React Navigation','Push notifications with Expo Notifications'],
antipatterns_ja:['Webビューだけでネイティブ未活用','Android/iOS差分の考慮なし','バッテリー消費の最適化なし'],
antipatterns_en:['Only WebView without native features','No Android/iOS difference consideration','No battery consumption optimization']
},
api_only:{
patterns_ja:['RESTはOpenAPI仕様書','GraphQLはスキーマファースト','認証はJWT+リフレッシュトークン','レート制限は必須'],
patterns_en:['REST with OpenAPI spec','GraphQL with schema-first','Auth with JWT + refresh token','Rate limiting required'],
antipatterns_ja:['エラーレスポンス統一なし','バージョニング戦略なし','ドキュメント未整備'],
antipatterns_en:['No unified error response','No versioning strategy','Poor documentation']
},
realtime:{
patterns_ja:['WebSocketはSocket.io','状態同期はFirebase/Supabase Realtime','再接続ロジック必須','メッセージキューはRedis Pub/Sub'],
patterns_en:['WebSocket with Socket.io','State sync with Firebase/Supabase Realtime','Reconnection logic required','Message queue with Redis Pub/Sub'],
antipatterns_ja:['再接続時の状態復元なし','メッセージ順序保証なし','スケーラビリティ考慮不足'],
antipatterns_en:['No state restoration on reconnect','No message order guarantee','Poor scalability consideration']
}
};
// ── Cross-Cutting Implementation Concerns ──
const CROSS_CUTTING_IMPL={
auth:{
ja:['パスワードはbcryptでハッシュ化(rounds=12)','セッショントークンはhttpOnly cookie','CSRF対策はトークン検証','MFAは2段階認証アプリ'],
en:['Hash passwords with bcrypt (rounds=12)','Session token in httpOnly cookie','CSRF protection with token verification','MFA with authenticator app']
},
error:{
ja:['エラーは集約ハンドラで統一処理','スタックトレースは本番環境で非表示','エラーログはSentry/Cloudwatch','ユーザーには安全なメッセージ表示'],
en:['Unified error handling with aggregated handler','Hide stack traces in production','Error logs with Sentry/Cloudwatch','Show safe messages to users']
},
cache:{
ja:['頻繁アクセスデータはRedisキャッシュ','キャッシュキーは名前空間付き','TTLは用途別に設定','キャッシュ削除はイベント駆動'],
en:['Cache frequently accessed data in Redis','Cache keys with namespace','Set TTL per use case','Cache invalidation event-driven']
},
i18n:{
ja:['翻訳ファイルはJSONで管理','言語切替はクッキー保存','日時フォーマットはIntl API','RTL言語対応はCSS論理プロパティ'],
en:['Manage translations with JSON files','Store language switch in cookie','Date format with Intl API','RTL support with CSS logical properties']
},
audit:{
ja:['重要操作は全て監査ログ記録','ログはイミュータブルテーブル','誰が・いつ・何を・なぜを記録','保存期間はコンプライアンス準拠'],
en:['Record all critical operations in audit log','Logs in immutable table','Record who/when/what/why','Retention period compliant with regulations']
},
upload:{
ja:['ファイルサイズ制限必須','MIMEタイプ検証(拡張子に頼らない)','アップロードは署名付きURL','マルウェアスキャンはClamAV'],
en:['File size limit required','MIME type validation (not relying on extension)','Upload with signed URL','Malware scan with ClamAV']
},
rate:{
ja:['APIはユーザー/IP別にレート制限','制限超過時は429ステータス','Retry-Afterヘッダー必須','管理者APIは別枠'],
en:['Rate limit API per user/IP','Return 429 on limit exceeded','Retry-After header required','Admin API separate limit']
},
validation:{
ja:['入力検証はクライアント+サーバー両方','サーバーサイド検証を信頼の境界','SQLインジェクション対策はORM/prepared statement','XSS対策はエスケープ+CSP'],
en:['Input validation on both client and server','Server-side validation as trust boundary','SQL injection prevention with ORM/prepared statement','XSS prevention with escaping + CSP']
}
};
/* ═══ INLINE EDITOR ═══ */
function openEditor(path){
const content=S.files[path];
if(!content)return;
const _ja=S.lang==='ja';
const isEdited=S.editedFiles&&S.editedFiles[path];
const prevBody=$('prevBody');
prevBody.innerHTML=`
<div class="editor-toolbar">
<div class="title">📝 ${esc(path)}</div>
<div class="actions">
<button class="btn btn-s" onclick="saveEdited('${esc(path)}')">💾 ${_ja?'保存':'Save'}</button>
<button class="btn btn-s" onclick="revertFile('${esc(path)}')"${isEdited?'':'disabled'}>↩️ ${_ja?'元に戻す':'Revert'}</button>
<button class="btn btn-s" onclick="previewFile('${esc(path)}')">👁 ${_ja?'プレビュー':'Preview'}</button>
</div>
</div>
<textarea id="editorArea" spellcheck="false" class="editor-area">${esc(content)}</textarea>`;
// Auto-resize
const ta=$('editorArea');
if(ta){
ta.addEventListener('keydown',e=>{
if(e.key==='Tab'){e.preventDefault();const s=ta.selectionStart,end=ta.selectionEnd;ta.value=ta.value.substring(0,s)+' '+ta.value.substring(end);ta.selectionStart=ta.selectionEnd=s+2;}
if(e.ctrlKey&&e.key==='s'){e.preventDefault();saveEdited(path);}
});
}
}
function saveEdited(path){
const _ja=S.lang==='ja';
const ta=$('editorArea');
if(!ta)return;
const newContent=ta.value;
if(newContent===S.files[path])return toast(_ja?'変更なし':'No changes');
// Store original if first edit
if(!S.editedFiles[path])S.editedFiles[path]=S.files[path];
S.files[path]=newContent;
save();
toast(_ja?'✅ 保存しました':'✅ Saved');
showFileTree();
}
function revertFile(path){
const _ja=S.lang==='ja';
if(!S.editedFiles||!S.editedFiles[path])return;
S.files[path]=S.editedFiles[path];
delete S.editedFiles[path];
save();
toast(_ja?'↩️ 元に戻しました':'↩️ Reverted');
openEditor(path);
}
/* ═══ DIFF VIEW ═══ */
function lineDiff(oldText,newText){
const oldL=oldText.split('\n'),newL=newText.split('\n');
const result=[];
// Simple LCS-based diff
const m=oldL.length,n=newL.length;
const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));
for(let i=1;i<=m;i++)for(let j=1;j<=n;j++){
dp[i][j]=oldL[i-1]===newL[j-1]?dp[i-1][j-1]+1:Math.max(dp[i-1][j],dp[i][j-1]);
}
// Backtrack
let i=m,j=n;
const ops=[];
while(i>0||j>0){
if(i>0&&j>0&&oldL[i-1]===newL[j-1]){ops.unshift({type:'same',line:oldL[i-1]});i--;j--;}
else if(j>0&&(i===0||dp[i][j-1]>=dp[i-1][j])){ops.unshift({type:'add',line:newL[j-1]});j--;}
else{ops.unshift({type:'del',line:oldL[i-1]});i--;}
}
return ops;
}
function showDiff(path){
const _ja=S.lang==='ja';
const oldContent=S.prevFiles[path]||S.editedFiles[path];
const newContent=S.files[path];
if(!oldContent||!newContent||oldContent===newContent){
toast(_ja?'差分なし':'No differences');return;
}
const diff=lineDiff(oldContent,newContent);
const adds=diff.filter(d=>d.type==='add').length;
const dels=diff.filter(d=>d.type==='del').length;
const same=diff.filter(d=>d.type==='same').length;
let h=`<div class="diff-header">
<div class="diff-title">🔀 ${esc(path)}</div>
<div class="diff-stats">
<span class="add">+${adds}</span>
<span class="del">-${dels}</span>
<span>~${same}</span>
<button class="btn btn-s" onclick="previewFile('${esc(path)}')">✕ ${_ja?'閉じる':'Close'}</button>
</div>
</div>`;
h+='<div class="diff-body">';
let lineNum=0;
diff.forEach(d=>{
if(d.type==='same'){lineNum++;h+=`<div class="diff-same"><span class="diff-ln">${lineNum}</span>${esc(d.line)}</div>`;}
else if(d.type==='add'){lineNum++;h+=`<div class="diff-add"><span class="diff-ln">+${lineNum}</span>${esc(d.line)}</div>`;}
else{h+=`<div class="diff-del"><span class="diff-ln">-</span>${esc(d.line)}</div>`;}
});
h+='</div>';
$('prevBody').innerHTML=h;
}
function snapshotFiles(){
S.prevFiles=JSON.parse(JSON.stringify(S.files));
}
/* ═══ EXPORT ═══ */
async function exportZIP(){
const _ja=S.lang==='ja';
if(window._noZip||typeof JSZip==='undefined'){toast(_ja?'⚠️ オフライン環境ではZIPエクスポートを利用できません':'⚠️ ZIP export unavailable offline');return;}
const zip=new JSZip();
const root=fileSlug(S.projectName);
Object.entries(S.files).forEach(([path,content])=>{
zip.file(root+'/'+path,content);
});
const blob=await zip.generateAsync({type:'blob'});
const url=URL.createObjectURL(blob);
const link=document.createElement('a');link.href=url;link.download=root+'.zip';link.click();
URL.revokeObjectURL(url);
addMsg('bot',_ja?`📦 ${root}.zip (${Object.keys(S.files).length}ファイル) をダウンロードしました！`:`📦 Downloaded ${root}.zip (${Object.keys(S.files).length} files)!`);
_lsSet('devforge-last-export',new Date().toISOString());
}
function exportPDF(){
const _ja=S.lang==='ja';
const G=S.genLang==='ja'||(!S.genLang&&_ja);
let content='';
Object.entries(S.files).forEach(([path,text])=>{
if(path.endsWith('.md')){
content+=`<h1 style="page-break-before:always;border-bottom:2px solid #3b82f6;padding-bottom:8px;margin-top:40px;">${escHtml(path)}</h1>`;
content+=safeMD(text);
}
});
const pdfCss='body{font-family:-apple-system,sans-serif;padding:40px;max-width:800px;margin:0 auto;color:#1e222d;}'
+'pre{background:#f5f5f5;padding:16px;border-radius:8px;overflow-x:auto;}'
+'h1{margin-top:40px;}h1:first-child{page-break-before:avoid;}'
+'table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background:#f0f0f0;}'
+'@media print{body{padding:20px;}h1{page-break-before:always;}h1:first-child{page-break-before:avoid;}}';
const _CSP_META='<meta http-equiv="Content-Security-Policy" content="default-src \'none\'; style-src \'unsafe-inline\'; img-src data: blob:;">';
const html=`<!DOCTYPE html><html><head>${_CSP_META}<title>${escHtml(S.projectName)} - DevForge v9</title><style>${pdfCss}
</style></head><body><div style="text-align:center;margin-bottom:40px;"><h1 style="page-break-before:avoid;border:none;font-size:24px;">${escHtml(S.projectName)}</h1><p style="color:#666;">Generated by DevForge v9 — ${new Date().toLocaleDateString(G?'ja-JP':'en-US')}</p><p style="color:#999;font-size:12px;">${G?'© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん':'© 2026 Engineering no Tane Committee | by にしあん'}</p></div>${content}</body></html>`;
const win=window.open('','_blank');
if(win){
win.document.write(html);
win.document.close();
addMsg('bot',_ja?'📄 PDFプレビューを新しいタブで開きました。Ctrl+P で印刷/PDF保存できます。':'📄 PDF preview opened in new tab. Use Ctrl+P to print/save as PDF.');
} else {
// Fallback: download as HTML file
const blob=new Blob([html],{type:'text/html'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download=fileSlug(S.projectName)+'-docs.html';a.click();URL.revokeObjectURL(a.href);
addMsg('bot',_ja?'📄 ポップアップがブロックされたため、HTMLファイルとしてダウンロードしました。ブラウザで開いてCtrl+Pで印刷できます。':'📄 Popup blocked. Downloaded as HTML. Open in browser and use Ctrl+P to print.');
}
}
function copyAllFiles(){
const _ja=S.lang==='ja';
const sep='\n\n'+'='.repeat(60)+'\n';
const all=Object.entries(S.files).map(([path,content])=>`${sep}📄 ${path}${sep}${content}`).join('\n');
const header=`# ${S.projectName} — ${_ja?'全ファイル結合':'All Files Combined'}\n# Generated by DevForge v9\n# Files: ${Object.keys(S.files).length}\n# Date: ${new Date().toISOString().split('T')[0]}`;
const fullText=header+'\n'+all;
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(fullText).then(()=>{
toast(_ja?`📋 全${Object.keys(S.files).length}ファイルをコピーしました`:`📋 Copied all ${Object.keys(S.files).length} files`);
addMsg('bot',_ja?`📋 全${Object.keys(S.files).length}ファイルをクリップボードにコピーしました。AIへの一括投入にご利用ください。`:`📋 Copied all ${Object.keys(S.files).length} files to clipboard.`);
}).catch(()=>{_fallbackCopy(fullText);toast(_ja?'📋 コピーしました':'📋 Copied');});
} else {_fallbackCopy(fullText);toast(_ja?'📋 コピーしました':'📋 Copied');}
}
function copyForAI(){
const _ja=S.lang==='ja';
const files=Object.entries(S.files);
const tokens=Math.round(files.reduce((s,[,c])=>s+c.length,0)/4);
let md=`# ${S.projectName}\n\n`;
md+=`> ${_ja?'DevForge v9 で生成':'Generated by DevForge v9'} | ${files.length} ${_ja?'ファイル':'files'} | ~${tokens.toLocaleString()} tokens\n\n`;
md+='## Table of Contents\n\n';
files.forEach(([p],i)=>{md+=`${i+1}. \`${p}\`\n`;});
md+='\n---\n\n';
files.forEach(([path,content])=>{
md+=`## ${path}\n\n\`\`\`${path.split('.').pop()}\n${content}\n\`\`\`\n\n`;
});
if(navigator.clipboard&&navigator.clipboard.writeText){
navigator.clipboard.writeText(md).then(()=>{
toast(_ja?`🤖 AI向けMarkdown (${files.length}ファイル) をコピー`:`🤖 Copied AI Markdown (${files.length} files)`);
}).catch(()=>{_fallbackCopy(md);toast(_ja?'📋 コピーしました':'📋 Copied');});
} else {_fallbackCopy(md);toast(_ja?'📋 コピーしました':'📋 Copied');}
}
/* ═══ UI HELPERS ═══ */
/* ── Pillar ⑤ Parallel Explorer (Enhanced with Recommendation) ── */
function showExplorer(){
pushView({pillar:4,type:'explorer',file:null});
const body=$('prevBody');const _ja=S.lang==='ja';
const stacks={
'Next.js + Supabase':{fe:'React + Next.js',be:'Supabase',db:'PostgreSQL',deploy:'Vercel',cost:'$0–$25',speed:5,scale:3,learn:4,eco:5,best:_ja?'MVP・SaaS':'MVP / SaaS',tags:['saas','mvp','stripe','auth']},
'Next.js + Express + PG':{fe:'React + Next.js',be:'Express',db:'PostgreSQL',deploy:'Vercel+Railway',cost:'$0–$20',speed:4,scale:4,learn:3,eco:5,best:_ja?'フルスタック学習':'Full-stack learning',tags:['fullstack','api','stripe']},
'Next.js + NestJS + PG':{fe:'React + Next.js',be:'NestJS',db:'PostgreSQL',deploy:'AWS',cost:'$10–$50',speed:3,scale:5,learn:2,eco:4,best:_ja?'エンタープライズ':'Enterprise',tags:['enterprise','rbac','team','ddd']},
'Nuxt + Supabase':{fe:'Vue 3 + Nuxt',be:'Supabase',db:'PostgreSQL',deploy:'Vercel',cost:'$0–$25',speed:5,scale:3,learn:5,eco:3,best:_ja?'Vue好き':'Vue fans',tags:['vue','mvp','saas']},
'SvelteKit + Supabase':{fe:'SvelteKit',be:'Supabase',db:'PostgreSQL',deploy:'Vercel',cost:'$0–$25',speed:5,scale:3,learn:4,eco:2,best:_ja?'軽量・高速':'Lightweight & fast',tags:['perf','mvp','lightweight']},
'Next.js + FastAPI + Mongo':{fe:'React + Next.js',be:'FastAPI',db:'MongoDB',deploy:'Vercel+Railway',cost:'$0–$30',speed:4,scale:4,learn:3,eco:4,best:_ja?'AI/ML統合':'AI/ML integration',tags:['ai','ml','python','data']},
'Expo + Supabase':{fe:'Expo (RN)',be:'Supabase',db:'PostgreSQL',deploy:'EAS Build',cost:'$0–$30',speed:4,scale:3,learn:3,eco:3,best:_ja?'モバイルアプリ':'Mobile app',tags:['mobile','expo','native']},
};
const names=Object.keys(stacks);const a=S.answers;
const bar=v=>'⚡'.repeat(v)+'<span class="exp-dim">'+'⚡'.repeat(5-v)+'</span>';
const metrics=_ja
?[['開発速度','speed'],['スケーラビリティ','scale'],['学習容易性','learn'],['エコシステム','eco']]
:[['Dev Speed','speed'],['Scalability','scale'],['Learnability','learn'],['Ecosystem','eco']];
/* ════ NEW: Answer-Based Scoring Engine ════ */
function scoreStack(name,stack){
let score=0;const reasons=[];
const skill=S.skill||'intermediate';
const feAns=(a.frontend||'').toLowerCase();
const beAns=(a.backend||'').toLowerCase();
const mob=(a.mobile||'').toLowerCase();
const pay=(a.payment||'').toLowerCase();
const aiAuto=(a.ai_auto||'').toLowerCase();
// 1. Skill match (0-25)
if(skill==='beginner'&&stack.learn>=4){score+=25;reasons.push(_ja?'初心者に学びやすい':'Beginner-friendly');}
else if(skill==='beginner'&&stack.learn>=3){score+=15;}
else if(skill==='intermediate'&&stack.learn>=3&&stack.eco>=4){score+=20;reasons.push(_ja?'中級者に最適なバランス':'Good balance for intermediates');}
else if(skill==='pro'&&stack.scale>=4){score+=20;reasons.push(_ja?'プロ向けスケーラビリティ':'Pro-grade scalability');}
// 2. Frontend match (0-20)
if(feAns.includes('react')&&stack.fe.includes('React')){score+=20;reasons.push(_ja?'フロントエンド一致':'Frontend match');}
else if(feAns.includes('vue')&&stack.fe.includes('Vue')){score+=20;reasons.push(_ja?'Vue選択に一致':'Vue selection match');}
else if(feAns.includes('svelte')&&stack.fe.includes('Svelte')){score+=20;reasons.push(_ja?'Svelte選択に一致':'Svelte selection match');}
// 3. Backend match (0-15)
if(beAns.includes('supabase')&&stack.be==='Supabase'){score+=15;reasons.push(_ja?'Supabase選択に一致':'Supabase match');}
else if(beAns.includes('express')&&stack.be==='Express'){score+=15;reasons.push(_ja?'Express選択に一致':'Express match');}
else if(beAns.includes('nest')&&stack.be==='NestJS'){score+=15;reasons.push(_ja?'NestJS選択に一致':'NestJS match');}
else if(beAns.includes('fastapi')&&stack.be==='FastAPI'){score+=15;reasons.push(_ja?'FastAPI選択に一致':'FastAPI match');}
// 4. Mobile (0-15)
if(mob&&mob!=='none'&&stack.tags.includes('mobile')){score+=15;reasons.push(_ja?'モバイル対応':'Mobile support');}
// 5. Payment (0-10)
if(pay&&pay!=='none'&&stack.tags.includes('stripe')){score+=10;reasons.push(_ja?'決済連携可能':'Payment integration');}
// 6. AI/Autonomous (0-10)
if(aiAuto&&aiAuto!=='none'&&stack.tags.includes('ai')){score+=10;reasons.push(_ja?'AI/ML統合に最適':'AI/ML integration fit');}
// 7. Speed bonus (always counted, 0-5)
score+=stack.speed;
return {name,score,reasons,stack};
}
/* ── Rank all stacks ── */
const ranked=names.map(n=>scoreStack(n,stacks[n])).sort((a,b)=>b.score-a.score);
const medals=['🥇','🥈','🥉'];
const hasAnswers=Object.keys(a).length>2;
/* ════ RENDER ════ */
let h=`<div class="exp-header"><h3>⚡ ${_ja?'並列実装探索 — スタック比較':'Parallel Explorer — Stack Comparison'}</h3>
<p>${_ja?'現在の選択':'Current'}: <strong class="exp-current">${esc(a.frontend||'React + Next.js')} + ${esc(a.backend||'Express')}</strong> — ${_ja?'2つのスタックを比較':'Compare 2 stacks'}</p></div>`;
/* ── Recommendation Ranking (NEW) ── */
if(hasAnswers){
h+=`<div class="exp-ranking"><h4>📊 ${_ja?'あなたへのおすすめ（回答に基づくスコア）':'Recommended for You (Score based on your answers)'}</h4>`;
ranked.forEach((r,i)=>{
const medal=i<3?medals[i]:'';
const isTop=i===0;
const w=Math.max(8,Math.round(r.score/ranked[0].score*100));
h+=`<div class="exp-rank-row${isTop?' exp-rank-top':''}" onclick="autoSelectStack('${r.name}')">
<div class="exp-rank-left">
<span class="exp-rank-medal">${medal||`#${i+1}`}</span>
<span class="exp-rank-name">${r.name}</span>
</div>
<div class="exp-rank-right">
<div class="exp-rank-bar"><div class="exp-rank-bar-fill" style="width:${w}%"></div></div>
<span class="exp-rank-score">${r.score}${_ja?'点':'pt'}</span>
</div>
</div>`;
if(r.reasons.length>0&&i<3){
h+=`<div class="exp-rank-reasons">${r.reasons.map(r=>`<span class="exp-rank-tag">${r}</span>`).join('')}</div>`;
}
});
h+=`</div>`;
}
/* ── Comparison selectors ── */
h+=`<div class="exp-select"><h4>${_ja?'🔀 比較':'🔀 Compare'}</h4><select id="expA" onchange="renderExpCompare()">${names.map((n,i)=>`<option value="${i}" ${n===ranked[0].name?'selected':''}>${n}</option>`).join('')}</select>`;
h+=`<select id="expB" onchange="renderExpCompare()">${names.map((n,i)=>`<option value="${i}" ${n===(ranked[1]||ranked[0]).name?'selected':''}>${n}</option>`).join('')}</select></div>`;
h+='<div id="expCompare"></div>';
body.innerHTML=h;
const rowLabels=_ja
?{fe:'フロント',be:'バック',db:'DB',deploy:'デプロイ',cost:'月額目安'}
:{fe:'Frontend',be:'Backend',db:'DB',deploy:'Deploy',cost:'Est. Cost'};
const renderComp=()=>{
const iA=parseInt($('expA').value);const iB=parseInt($('expB').value);
const sA=stacks[names[iA]];const sB=stacks[names[iB]];
let c='<div class="exp-compare">';
[['A',names[iA],sA],['B',names[iB],sB]].forEach(([label,name,s])=>{
c+=`<div class="exp-col"><h3>${label}: ${name}</h3>`;
['fe','be','db','deploy','cost'].forEach(k=>{
c+=`<div class="exp-row"><span class="label">${rowLabels[k]}</span><span class="val">${s[k]}</span></div>`;
});
c+='<div class="exp-metrics-sep">';
metrics.forEach(([label,key])=>{c+=`<div class="exp-row"><span class="label">${label}</span><span class="val">${bar(s[key])}</span></div>`;});
c+=`</div><div class="exp-verdict"><h4>${_ja?'最適用途':'Best For'}</h4><p>${s.best}</p></div></div>`;
});
c+='</div>';
const scoreA=metrics.reduce((s,m)=>s+sA[m[1]],0);const scoreB=metrics.reduce((s,m)=>s+sB[m[1]],0);
c+=`<div class="road-summary">
<strong>${_ja?'総合スコア':'Total Score'}:</strong> ${names[iA]} = ${scoreA}/20 vs ${names[iB]} = ${scoreB}/20
${scoreA>scoreB?`<br><span class="exp-win">→ ${names[iA]} ${_ja?'が総合的に優位':'wins overall'}</span>`:scoreB>scoreA?`<br><span class="exp-win">→ ${names[iB]} ${_ja?'が総合的に優位':'wins overall'}</span>`:`<br><span class="exp-tie">→ ${_ja?'ほぼ同等、用途で選択':'Nearly equal — choose by use case'}</span>`}
</div>`;
$('expCompare').innerHTML=c;
};
window.renderExpCompare=renderComp;
renderComp();
}
/* ── Auto-select stack from ranking click ── */
function autoSelectStack(name){
const sel=$('expA');if(!sel)return;
for(let i=0;i<sel.options.length;i++){
if(sel.options[i].text===name){sel.value=i;break;}
}
renderExpCompare();
$('expCompare').scrollIntoView({behavior:'smooth',block:'nearest'});
}
/* ── Pillar ⑧ AI Prompt Launcher ── */
function showAILauncher(){
pushView({pillar:7,type:'launcher',file:null});
const body=$('prevBody');const _ja=S.lang==='ja';
const files=S.files;const fKeys=Object.keys(files);
const hasFiles=fKeys.length>0;
/* ── Token estimation per folder ── */
const folders={};
fKeys.forEach(k=>{
const dir=k.includes('/')?k.split('/')[0]:'root';
if(!folders[dir])folders[dir]={files:[],chars:0,tokens:0};
folders[dir].files.push(k);
const c=files[k].length;
folders[dir].chars+=c;
folders[dir].tokens+=Math.round(c/4);
});
const totalTokens=Object.values(folders).reduce((s,f)=>s+f.tokens,0);
/* ── Prompt templates ── */
const PT=_ja?{
review:{icon:'🔍',label:'仕様レビュー',desc:'矛盾・不足・改善点を指摘',
sys:'あなたは経験豊富なテックリード兼SDDアーキテクトです。',
prompt:'以下の仕様書群を4ステップでレビューしてください:\n1. constitution.mdの使命とKPIを確認\n2. specification.mdの要件網羅性をチェック\n3. technical-plan.mdのアーキテクチャ妥当性を評価\n4. 全体の整合性と不足事項を指摘\n\n各指摘には優先度(P0=致命的/P1=重要/P2=推奨)を付与してください。',
fmt:'Markdown表:\n| # | ファイル | 指摘 | 優先度 | 推奨アクション |\n|---|---------|------|--------|----------------|\n| 1 | .spec/xxx.md | ... | P0 | ... |'},
implement:{icon:'🚀',label:'MVP実装',desc:'仕様書からMVP開発開始',
sys:'あなたはフルスタック開発者です。SDD仕様書に忠実に実装します。',
prompt:'docs/23_tasks.mdから最優先タスク(P0またはIssue #1)を1つ選んで実装してください。\n\n実装手順:\n1. 型定義を作成 (TypeScript interface/type)\n2. データアクセス層を実装 (ORM/SDK)\n3. ビジネスロジックを実装\n4. UIコンポーネントを実装\n5. Vitestユニットテストを作成\n\nconstitution.mdの設計原則に従い、technical-plan.mdのアーキテクチャに沿ってください。\n\ndocs/39_implementation_playbook.mdのドメイン別実装パターンを参照し、業種固有のベストプラクティスに従ってください。',
fmt:'ファイルパス付きコードブロック:\n```typescript:path/to/file.ts\n// code\n```\n必ずテストを含めてください。'},
test:{icon:'🧪',label:'テスト生成',desc:'テストケース自動作成',
sys:'あなたはQAエンジニアです。仕様書からテストケースを網羅的に作成します。',
prompt:'docs/07_test_cases.mdを参照し、以下の順序でテストケースを生成してください:\n1. 正常系(Happy Path): 基本的なCRUD操作\n2. 異常系(Error Cases): バリデーションエラー、権限エラー\n3. 境界値(Boundary): 空文字列、最大長、NULL\n4. docs/33_test_matrix.mdのテスト優先度マトリクスで実行順序を決定\n5. docs/36_test_strategy.mdの戦略に沿って非機能テストも追加\n\n各テストケースには期待結果を明記してください。',
fmt:'Vitestテストファイル:\n```typescript:tests/xxx.test.ts\nimport { describe, it, expect } from \'vitest\';\n// tests\n```'},
refactor:{icon:'♻️',label:'リファクタ提案',desc:'構造改善と技術的負債の解消',
sys:'あなたはコードレビュアーです。アーキテクチャの改善提案を行います。',
prompt:'以下の仕様書の技術設計を分析し、リファクタリング提案をしてください。各指摘に工数見積り(S=1-2h/M=3-8h/L=1-2日)を付与してください。\n\nチェック項目:\n- SOLID原則の違反\n- 責務の分離不足(Fat Controller等)\n- スケーラビリティの問題\n- パフォーマンスボトルネック\n- 技術的負債',
fmt:'Markdown表:\n| 問題 | 違反している原則 | 改善案 | 工数 | 優先度 |\n|------|------------------|--------|------|--------|\n| ... | SRP | ... | M | P1 |'},
security:{icon:'🔒',label:'セキュリティ監査',desc:'脆弱性とベストプラクティス',
sys:'あなたはセキュリティエンジニアです。OWASP Top 10 2025を基準に監査します。',
prompt:'以下のセキュリティドキュメントを事前に確認してください:\n'+
'- docs/43_security_intelligence.md (スタック適応型チェックリスト)\n'+
'- docs/44_threat_model.md (STRIDE脅威分析)\n'+
'- docs/45_compliance_matrix.md (コンプライアンス要件)\n'+
'- docs/46_ai_security.md (AI/LLMセキュリティ)\n'+
'- docs/47_security_testing.md (テストテンプレート)\n\n'+
'仕様書のセキュリティ面をOWASP Top 10 2025の各項目別にチェックしてください:\n'+
'1. A01 – アクセス制御の不備\n2. A02 – セキュリティ設定ミス\n'+
'3. A03 – ソフトウェアサプライチェーン\n4. A04 – SSRF（入力検証・URL制限）\n'+
'5. A05 – 安全でない設計\n6. A06 – 脆弱で古いコンポーネント\n'+
'7. A07 – 識別と認証の失敗\n8. A08 – ソフトウェアとデータの整合性の不備\n'+
'9. A09 – セキュリティログと監視の不備\n10. A10 – インフラ保護（DNS Rebinding・Egress制限）\n\n'+
'docs/08_security.mdの設計と実装の乖離もチェックしてください。\n'+
'各項目の状態を✅(OK)/⚠️(注意)/❌(脆弱)で評価してください。',
fmt:'Markdown表:\n| OWASP# | 項目 | 状態 | 詳細 | 推奨対策 |\n|--------|------|------|------|----------|\n| A01 | Access Control | ⚠️ | ... | ... |'},
docs:{icon:'📝',label:'ドキュメント補完',desc:'不足文書の特定と生成',
sys:'あなたはテクニカルライターです。開発ドキュメントの品質を高めます。',
prompt:'以下の仕様書群を分析し、2パート構成で出力してください:\n\n**Part 1: ギャップ分析**\n既存ドキュメントと理想状態の差分を表形式で列挙\n\n**Part 2: 最重要ドキュメント生成**\nギャップ分析で最も優先度が高いドキュメント1つを全文生成してください。\n\n候補:\n- API仕様の詳細化(OpenAPI YAML)\n- シーケンス図(Mermaid)\n- デプロイ手順書(Step-by-step)\n- エラーハンドリング設計',
fmt:'Part 1: Markdown表\nPart 2: 完全なドキュメント(Markdown)'},
debug:{icon:'🔧',label:'デバッグ支援',desc:'エラー原因分析と修正提案',
sys:'あなたは経験豊富なデバッグスペシャリストです。エラーログとスタックトレースから根本原因を特定します。',
prompt:'以下の手順でデバッグ分析を実行:\n1. docs/25_error_logs.mdの既存パターンと照合（再発or新規を判定）\n2. エラー/スタックトレースの根本原因を特定（5 Whys分析）\n3. docs/37_bug_prevention.mdのチェックリストから該当バグカテゴリを特定\n4. 修正コードと再発防止策を提案\n5. docs/25_error_logs.mdに追記するエントリをドラフト\n6. 重大度が高い場合、docs/34_incident_response.mdのインシデント対応フローに従う',
fmt:'## 診断結果\n| 項目 | 内容 |\n|------|------|\n| エラー種別 | ... |\n| 根本原因 | ... |\n| 影響範囲 | ... |\n\n## 修正コード\n```typescript:path/to/file.ts\n// fix\n```\n\n## error_logsエントリ\n- 症状/原因/解決策/防止策'},
arch:{icon:'📐',label:'アーキテクチャ整合性',desc:'設計と実装の乖離を検出',
sys:'あなたはソフトウェアアーキテクトです。仕様書のアーキテクチャと実装の整合性を検証します。',
prompt:'アーキテクチャ整合性チェック:\n1. docs/03_architecture.mdのレイヤー構造・パターン定義を確認\n2. .spec/technical-plan.mdの技術方針との一致を検証\n3. コードが定義済みレイヤー境界を違反していないか検査\n4. docs/27_sequence_diagrams.mdのシーケンスフローとの整合性を確認\n5. docs/26_design_system.mdのコンポーネント規約との整合性を確認\n6. 違反箇所に修正案とリファクタリング手順を提示',
fmt:'Markdown表:\n| # | 違反箇所 | 定義元 | 違反内容 | 深刻度 | 修正案 |\n|---|---------|--------|---------|--------|--------|\n\n## アーキテクチャ適合スコア: X/10'},
perf:{icon:'⚡',label:'パフォーマンス最適化',desc:'ボトルネック特定と改善提案',
sys:'あなたはパフォーマンスエンジニアです。非機能要件に基づきボトルネックを特定します。',
prompt:'パフォーマンス分析:\n1. .spec/constitution.mdの非機能要件（NFR）からパフォーマンス目標値を抽出\n2. docs/41_growth_intelligence.mdのパフォーマンスバジェットとCore Web Vitals目標値を確認\n3. N+1クエリ、不要な再レンダリング、バンドルサイズ問題を検出\n4. 各問題に改善前/改善後の推定値を付与\n5. 優先度順の改善ロードマップを作成',
fmt:'## ボトルネック一覧\n| # | 箇所 | 種別 | 現状推定 | 目標値 | 改善策 | 効果 |\n|---|------|------|---------|--------|--------|------|\n\n## 改善コード例\n```typescript:path/to/file.ts\n// optimized\n```'},
api:{icon:'🔌',label:'API統合コード生成',desc:'外部API連携コードの自動生成',
sys:'あなたはインテグレーションエンジニアです。型安全なAPI統合コードを生成します。',
prompt:'API統合コード生成:\n1. docs/05_api_design.mdのエンドポイント定義と認証方式を確認\n2. docs/04_er_diagram.mdのエンティティスキーマからリクエスト/レスポンス型を定義\n3. エラーハンドリング（リトライ・タイムアウト・レート制限）を含む統合コードを生成\n4. docs/08_security.mdのセキュリティ要件に準拠した実装にする\n5. 統合テストのスケルトンを作成',
fmt:'```typescript:lib/api/client.ts\n// API client with types\n```\n```typescript:lib/api/types.ts\n// Request/Response types\n```\n```typescript:tests/api/integration.test.ts\n// Integration tests\n```'},
a11y:{icon:'♿',label:'アクセシビリティ監査',desc:'WCAG 2.1準拠チェックと修正',
sys:'あなたはアクセシビリティ専門家です。WCAG 2.1 AA基準でUIを監査します。',
prompt:'アクセシビリティ監査:\n1. docs/26_design_system.mdのデザイントークン（色コントラスト・フォントサイズ）を確認\n2. docs/06_screen_design.mdの画面一覧から主要画面のUI要素を特定\n3. WCAG 2.1 AA 4原則（知覚可能・操作可能・理解可能・堅牢）で評価\n4. 各違反に具体的なHTML/ARIA修正コードを提示\n5. axe-coreによる自動テストコードを生成',
fmt:'## WCAG 2.1 AA 監査結果\n| # | 基準 | 画面 | 要素 | 状態 | 修正コード |\n|---|------|------|------|------|------------|\n\n## 自動テスト\n```typescript:tests/a11y.test.ts\n// axe-core tests\n```'},
migrate:{icon:'🔄',label:'マイグレーション支援',desc:'技術スタック移行計画の策定',
sys:'あなたはマイグレーションアーキテクトです。データ整合性を保ちながら段階的移行を計画します。',
prompt:'マイグレーション計画策定:\n1. .spec/technical-plan.mdから現行スタック構成を確認\n2. docs/04_er_diagram.mdからデータスキーマとリレーションを把握\n3. 移行先に合わせたスキーマ変換スクリプトとデータ検証クエリを生成\n4. ブルーグリーンまたはカナリアデプロイによるリスク最小化計画を作成\n5. ロールバック手順を各フェーズに明記',
fmt:'## マイグレーション計画\n| フェーズ | 作業内容 | 期間 | ロールバック | リスク |\n|---------|---------|------|------------|--------|\n\n## スキーマ変換\n```sql\n-- migration script\n```\n\n## データ検証\n```sql\n-- validation queries\n```'},
metrics:{icon:'📊',label:'コードメトリクス分析',desc:'複雑度・保守性の定量評価',
sys:'あなたはソフトウェアメトリクスアナリストです。コード品質を定量的に評価します。',
prompt:'コードメトリクス分析:\n1. 循環的複雑度（Cyclomatic Complexity）を関数単位で計測\n2. 認知的複雑度（Cognitive Complexity）で理解しにくい箇所を特定\n3. 結合度と凝集度を分析（依存関係の多いモジュールを検出）\n4. 重複コード率とDRY違反箇所を特定\n5. 改善ROI（効果/工数）の高い順に改善計画を提示',
fmt:'## メトリクスサマリー\n| メトリクス | 値 | 基準 | 判定 |\n|-----------|-----|------|------|\n| 平均循環的複雑度 | X | <10 | ✅/⚠️/❌ |\n\n## ホットスポット\n| ファイル | 関数 | 複雑度 | 改善案 | 工数 |\n|---------|------|--------|--------|------|'},
i18n:{icon:'🌍',label:'国際化実装',desc:'i18n対応コードの生成',
sys:'あなたは国際化エンジニアです。既存コードに最小限の変更でi18n対応を追加します。',
prompt:'国際化実装:\n1. コードからハードコードされた文字列を全て抽出\n2. 翻訳キーの命名規則を定義（scope.component.element形式）\n3. 翻訳ファイル（JSON）を日本語・英語で生成\n4. コードを翻訳関数（t()）呼び出しに置換\n5. 日付・数値・通貨のロケール対応フォーマッターを追加',
fmt:'## 抽出された文字列\n| キー | 日本語 | English |\n|------|--------|----------|\n\n```json:locales/ja.json\n{}\n```\n```json:locales/en.json\n{}\n```\n\n## 変換後コード\n```typescript:path/to/file.ts\n// i18n-ready code\n```'},
growth:{icon:'📈',label:'グロース戦略',desc:'成長ファネル・KPI・価格戦略の最適化',
sys:'あなたはグロースエンジニアです。データドリブンな成長戦略を設計します。',
prompt:'グロース分析:\n1. docs/41_growth_intelligence.mdの成長ファネルとCVRベンチマークを確認\n2. 現在のスタック構成のシナジースコアを評価\n3. ドメイン別グロース方程式に基づきボトルネックを特定\n4. 5つの成長レバーを優先度順に提案\n5. 松竹梅の3段階価格戦略を設計（行動経済学: 妥協効果・アンカリング）',
fmt:'## ファネル分析\n| ステージ | 現状CVR | 目標CVR | 改善施策 |\n\n## 成長レバー\n| # | レバー | 期待効果 | 工数 | 優先度 |\n\n## 価格戦略\n| プラン | 価格 | 機能 | ターゲット |'},
reverse:{icon:'🎯',label:'ゴール逆算設計',desc:'目標からの逆算計画とギャップ分析',
sys:'あなたはプロジェクトストラテジストです。ゴールから逆算して計画を策定します。',
prompt:'ゴール逆算分析:\n1. docs/29_reverse_engineering.mdのゴール定義とリバースフローを確認\n2. docs/30_goal_decomposition.mdのゴールツリーとサブゴールを分析\n3. 現状と目標のギャップを定量的に評価\n4. 優先度マトリクスでマイルストーンを再編成\n5. 依存関係チェーンを検証し、クリティカルパスを特定',
fmt:'## ギャップ分析\n| 目標 | 現状 | ギャップ | 対策 | 期限 |\n\n## クリティカルパス\n```mermaid\ngantt\n```\n\n## マイルストーン\n| MS | 完了基準 | 依存 | リスク |'},
incident:{icon:'🚨',label:'インシデント対応',desc:'障害対応ランブック・ポストモーテム作成',
sys:'あなたはSREエンジニアです。インシデント対応と再発防止を専門とします。',
prompt:'インシデント対応:\n1. docs/34_incident_response.mdのインシデント対応フローを確認\n2. docs/25_error_logs.mdから関連する過去のエラーパターンを特定\n3. 影響範囲（ユーザー数・機能・データ）を評価\n4. 緊急対応手順（ロールバック・フェイルオーバー）を策定\n5. ポストモーテム（タイムライン・根本原因・改善アクション）をドラフト',
fmt:'## 影響評価\n| 項目 | 内容 |\n| 影響範囲 | ... |\n| 深刻度 | SEV1/2/3 |\n\n## 対応手順\n1. 検知 → 2. トリアージ → 3. 対応 → 4. 復旧 → 5. 振り返り\n\n## ポストモーテム\n| タイムライン | アクション | 担当 |'},
onboard:{icon:'🎓',label:'オンボーディング',desc:'新メンバー・AIエージェント向け引き継ぎ資料',
sys:'あなたはテクニカルオンボーディングスペシャリストです。新しい開発者が最速で戦力化する資料を作成します。',
prompt:'オンボーディング資料作成:\n1. CLAUDE.mdとAI_BRIEF.mdからプロジェクト概要を要約\n2. .spec/constitution.mdの設計原則とdocs/03_architecture.mdのアーキテクチャを図解\n3. docs/42_skill_guide.mdのスキルレベル別ワークフローを整理\n4. 最初の1週間のタスクリストを.spec/tasks.mdから抽出\n5. よくある落とし穴をdocs/37_bug_prevention.mdから抽出しFAQ化',
fmt:'## プロジェクト概要（5分で理解）\n\n## アーキテクチャ図\n```mermaid\n```\n\n## 最初の1週間\n| 日 | タスク | 参照ファイル |\n\n## FAQ\n| 質問 | 回答 |'},
cicd:{icon:'⚙️',label:'CI/CD設計',desc:'デプロイパイプラインと品質ゲートの設計',
sys:'あなたはDevOpsエンジニアです。CI/CDパイプラインと品質ゲートを設計します。',
prompt:'CI/CD設計:\n1. .github/workflows/ci.ymlの現行パイプラインを分析\n2. docs/09_release_checklist.mdのリリースチェックリストを品質ゲートに変換\n3. docs/36_test_strategy.mdのテスト戦略をパイプラインステージに統合\n4. .spec/verification.mdの検証基準を自動化可能な形式に変換\n5. ブルーグリーン/カナリアデプロイ戦略を提案',
fmt:'## パイプライン設計\n```mermaid\nflowchart LR\n```\n\n## 品質ゲート\n| ステージ | チェック項目 | 閾値 | 失敗時 |\n\n## GitHub Actions\n```yaml\n# .github/workflows/ci.yml\n```'},
}:{
review:{icon:'🔍',label:'Spec Review',desc:'Find contradictions, gaps & improvements',
sys:'You are an experienced tech lead and SDD architect.',
prompt:'Review the following specs in 4 steps:\n1. Verify mission and KPIs in constitution.md\n2. Check requirement coverage in specification.md\n3. Evaluate architecture validity in technical-plan.md\n4. Identify overall consistency and gaps\n\nAssign priority to each finding (P0=critical/P1=important/P2=recommended).',
fmt:'Markdown table:\n| # | File | Finding | Priority | Recommended Action |\n|---|------|---------|----------|--------------------|\n| 1 | .spec/xxx.md | ... | P0 | ... |'},
implement:{icon:'🚀',label:'MVP Build',desc:'Start implementation from specs',
sys:'You are a full-stack developer. You implement faithfully according to SDD specs.',
prompt:'Select the highest priority task (P0 or Issue #1) from docs/23_tasks.md and implement it.\n\nImplementation steps:\n1. Create type definitions (TypeScript interface/type)\n2. Implement data access layer (ORM/SDK)\n3. Implement business logic\n4. Implement UI components\n5. Create Vitest unit tests\n\nFollow design principles in constitution.md and architecture in technical-plan.md.\n\nReference docs/39_implementation_playbook.md for domain-specific implementation patterns and industry best practices.',
fmt:'Code blocks with file paths:\n```typescript:path/to/file.ts\n// code\n```\nMust include tests.'},
test:{icon:'🧪',label:'Test Generation',desc:'Auto-generate test cases',
sys:'You are a QA engineer. You create comprehensive test cases from specifications.',
prompt:'Reference docs/07_test_cases.md and generate test cases in this order:\n1. Happy Path: Basic CRUD operations\n2. Error Cases: Validation errors, permission errors\n3. Boundary: Empty strings, max length, NULL\n4. Use docs/33_test_matrix.md priority matrix to determine execution order\n5. Add non-functional tests following docs/36_test_strategy.md strategy\n\nSpecify expected results for each test case.',
fmt:'Vitest test file:\n```typescript:tests/xxx.test.ts\nimport { describe, it, expect } from \'vitest\';\n// tests\n```'},
refactor:{icon:'♻️',label:'Refactor Proposal',desc:'Architecture improvements & tech debt',
sys:'You are a code reviewer focused on architecture improvements.',
prompt:'Analyze the technical design in these specs and propose refactoring. Assign effort estimates (S=1-2h/M=3-8h/L=1-2d) to each finding.\n\nCheck items:\n- SOLID principle violations\n- Separation of concerns issues (Fat Controllers, etc.)\n- Scalability problems\n- Performance bottlenecks\n- Technical debt',
fmt:'Markdown table:\n| Issue | Violated Principle | Improvement | Effort | Priority |\n|-------|-------------------|-------------|--------|----------|\n| ... | SRP | ... | M | P1 |'},
security:{icon:'🔒',label:'Security Audit',desc:'Vulnerabilities & best practices',
sys:'You are a security engineer. You audit against OWASP Top 10 2025.',
prompt:'Reference these security documents first:\n'+
'- docs/43_security_intelligence.md (Stack-adaptive checklist)\n'+
'- docs/44_threat_model.md (STRIDE threat analysis)\n'+
'- docs/45_compliance_matrix.md (Compliance requirements)\n'+
'- docs/46_ai_security.md (AI/LLM security)\n'+
'- docs/47_security_testing.md (Test templates)\n\n'+
'Check security aspects against OWASP Top 10 2025:\n'+
'1. A01 – Broken Access Control\n2. A02 – Security Misconfiguration\n'+
'3. A03 – Software Supply Chain\n4. A04 – SSRF (Input Validation & URL Restrictions)\n'+
'5. A05 – Insecure Design\n6. A06 – Vulnerable and Outdated Components\n'+
'7. A07 – Identification and Authentication Failures\n8. A08 – Software and Data Integrity Failures\n'+
'9. A09 – Security Logging and Monitoring Failures\n10. A10 – Infrastructure Protection (DNS Rebinding & Egress)\n\n'+
'Also check for drift between docs/08_security.md design and implementation.\n'+
'Evaluate each item as ✅(OK)/⚠️(Warning)/❌(Vulnerable).',
fmt:'Markdown table:\n| OWASP# | Item | Status | Details | Recommended Fix |\n|--------|------|--------|---------|------------------|\n| A01 | Access Control | ⚠️ | ... | ... |'},
docs:{icon:'📝',label:'Doc Completion',desc:'Identify missing docs & generate them',
sys:'You are a technical writer focused on development documentation quality.',
prompt:'Analyze these specs and output in 2 parts:\n\n**Part 1: Gap Analysis**\nList gaps between existing docs and ideal state in table format\n\n**Part 2: Generate Critical Document**\nGenerate ONE highest-priority document from gap analysis in full.\n\nCandidates:\n- API spec details (OpenAPI YAML)\n- Sequence diagrams (Mermaid)\n- Deployment guide (step-by-step)\n- Error handling design',
fmt:'Part 1: Markdown table\nPart 2: Complete document (Markdown)'},
debug:{icon:'🔧',label:'Debug Assistant',desc:'Root cause analysis & fix suggestions',
sys:'You are an experienced debugging specialist. You identify root causes from error logs and stack traces.',
prompt:'Debug analysis:\n1. Cross-reference docs/25_error_logs.md patterns (recurrence vs new issue)\n2. Identify root cause of the error/stack trace (5 Whys analysis)\n3. Match against bug categories in docs/37_bug_prevention.md checklist\n4. Propose fix code and prevention measures\n5. Draft an entry for docs/25_error_logs.md',
fmt:'## Diagnosis\n| Item | Detail |\n|------|--------|\n| Error Type | ... |\n| Root Cause | ... |\n| Impact Scope | ... |\n\n## Fix Code\n```typescript:path/to/file.ts\n// fix\n```\n\n## error_logs.md Entry\n- Symptom/Cause/Fix/Prevention'},
arch:{icon:'📐',label:'Architecture Compliance',desc:'Detect spec-implementation drift',
sys:'You are a software architect. You verify alignment between specs and implementation.',
prompt:'Architecture compliance check:\n1. Review layer structure and patterns in docs/03_architecture.md\n2. Verify alignment with .spec/technical-plan.md technical decisions\n3. Inspect code for layer boundary violations\n4. Check consistency with docs/27_sequence_diagrams.md sequence flows\n5. Check consistency with docs/26_design_system.md component conventions\n6. Propose fixes and refactoring steps for each violation',
fmt:'Markdown table:\n| # | Location | Source | Violation | Severity | Fix |\n|---|----------|--------|-----------|----------|-----|\n\n## Architecture Compliance Score: X/10'},
perf:{icon:'⚡',label:'Performance Optimization',desc:'Identify bottlenecks & suggest fixes',
sys:'You are a performance engineer. You identify bottlenecks against NFR targets and propose improvements.',
prompt:'Performance analysis:\n1. Extract performance targets from NFR section in .spec/constitution.md\n2. Review docs/41_growth_intelligence.md performance budgets and Core Web Vitals targets (LCP<2.5s, FID<100ms, CLS<0.1)\n3. Detect N+1 queries, unnecessary re-renders, bundle size issues\n4. Provide before/after estimates for each issue\n5. Create a prioritized improvement roadmap',
fmt:'## Bottleneck List\n| # | Location | Type | Current Est. | Target | Fix | Impact |\n|---|----------|------|-------------|--------|-----|--------|\n\n## Optimized Code\n```typescript:path/to/file.ts\n// optimized\n```'},
api:{icon:'🔌',label:'API Integration Generator',desc:'Generate type-safe API integration code',
sys:'You are an integration engineer. You generate type-safe API integration code.',
prompt:'Generate API integration code:\n1. Review endpoints and auth in docs/05_api_design.md\n2. Define request/response types from docs/04_er_diagram.md entity schemas\n3. Generate integration code with error handling (retry, timeout, rate limiting)\n4. Ensure compliance with docs/08_security.md security requirements\n5. Create integration test skeletons',
fmt:'```typescript:lib/api/client.ts\n// API client with types\n```\n```typescript:lib/api/types.ts\n// Request/Response types\n```\n```typescript:tests/api/integration.test.ts\n// Integration tests\n```'},
a11y:{icon:'♿',label:'Accessibility Audit',desc:'WCAG 2.1 compliance check & fixes',
sys:'You are an accessibility expert. You audit UI components against WCAG 2.1 AA.',
prompt:'Accessibility audit:\n1. Review design tokens (color contrast, font sizes) in docs/26_design_system.md\n2. Identify key UI elements from docs/06_screen_design.md screen list\n3. Evaluate against WCAG 2.1 AA 4 principles (Perceivable, Operable, Understandable, Robust)\n4. Provide specific HTML/ARIA fix code for each violation\n5. Generate axe-core automated tests',
fmt:'## WCAG 2.1 AA Audit Results\n| # | Criterion | Screen | Element | Status | Fix Code |\n|---|-----------|--------|---------|--------|----------|\n\n## Automated Tests\n```typescript:tests/a11y.test.ts\n// axe-core tests\n```'},
migrate:{icon:'🔄',label:'Migration Assistant',desc:'Tech stack migration planning',
sys:'You are a migration architect. You plan phased migrations while guaranteeing data integrity.',
prompt:'Create migration plan:\n1. Review current stack from .spec/technical-plan.md\n2. Understand data schemas and relationships from docs/04_er_diagram.md\n3. Generate schema conversion scripts and data validation queries\n4. Create risk-minimized deployment plan (blue-green or canary)\n5. Document rollback steps for each phase',
fmt:'## Migration Plan\n| Phase | Tasks | Duration | Rollback | Risk |\n|-------|-------|----------|----------|------|\n\n## Schema Conversion\n```sql\n-- migration script\n```\n\n## Data Validation\n```sql\n-- validation queries\n```'},
metrics:{icon:'📊',label:'Code Metrics Analysis',desc:'Quantitative quality evaluation',
sys:'You are a software metrics analyst. You quantitatively evaluate code quality.',
prompt:'Code metrics analysis:\n1. Measure Cyclomatic Complexity per function\n2. Evaluate Cognitive Complexity and identify hard-to-understand sections\n3. Analyze coupling and cohesion (detect high-dependency modules)\n4. Identify code duplication and DRY violations\n5. Present improvement plan ordered by ROI (impact/effort)',
fmt:'## Metrics Summary\n| Metric | Value | Threshold | Status |\n|--------|-------|-----------|--------|\n| Avg Cyclomatic Complexity | X | <10 | ✅/⚠️/❌ |\n\n## Hotspots (Priority Order)\n| File | Function | Complexity | Improvement | Effort |\n|------|----------|------------|-------------|--------|'},
i18n:{icon:'🌍',label:'i18n Generator',desc:'Add internationalization to existing code',
sys:'You are an internationalization engineer. You add i18n support with minimal changes.',
prompt:'Implement internationalization:\n1. Extract all hardcoded strings from the code\n2. Define translation key naming convention (scope.component.element)\n3. Generate translation files (JSON) for Japanese and English\n4. Replace strings with translation function (t()) calls\n5. Add locale-aware formatters for dates, numbers, currencies',
fmt:'## Extracted Strings\n| Key | Japanese | English |\n|-----|----------|----------|\n\n```json:locales/ja.json\n{}\n```\n```json:locales/en.json\n{}\n```\n\n## Converted Code\n```typescript:path/to/file.ts\n// i18n-ready code\n```'},
growth:{icon:'📈',label:'Growth Strategy',desc:'Optimize growth funnels, KPIs & pricing',
sys:'You are a growth engineer. You design data-driven growth strategies.',
prompt:'Growth analysis:\n1. Review growth funnel and CVR benchmarks in docs/41_growth_intelligence.md\n2. Evaluate stack synergy score for current configuration\n3. Identify bottlenecks using domain-specific growth equation\n4. Propose 5 growth levers in priority order\n5. Design 3-tier pricing strategy (behavioral economics: compromise effect, anchoring)',
fmt:'## Funnel Analysis\n| Stage | Current CVR | Target CVR | Improvement |\n\n## Growth Levers\n| # | Lever | Expected Impact | Effort | Priority |\n\n## Pricing Strategy\n| Plan | Price | Features | Target |'},
reverse:{icon:'🎯',label:'Goal Reverse Design',desc:'Reverse-plan from goals with gap analysis',
sys:'You are a project strategist. You reverse-engineer plans from goals.',
prompt:'Goal reverse analysis:\n1. Review goal definition and reverse flow in docs/29_reverse_engineering.md\n2. Analyze goal tree and sub-goals in docs/30_goal_decomposition.md\n3. Quantitatively evaluate gap between current state and targets\n4. Reorganize milestones using priority matrix\n5. Verify dependency chain and identify critical path',
fmt:'## Gap Analysis\n| Goal | Current | Gap | Action | Deadline |\n\n## Critical Path\n```mermaid\ngantt\n```\n\n## Milestones\n| MS | Criteria | Dependencies | Risk |'},
incident:{icon:'🚨',label:'Incident Response',desc:'Create runbooks & post-mortems',
sys:'You are an SRE engineer specializing in incident response and prevention.',
prompt:'Incident response:\n1. Review incident response flow in docs/34_incident_response.md\n2. Identify related past error patterns from docs/25_error_logs.md\n3. Assess impact scope (users, features, data)\n4. Create emergency procedures (rollback, failover)\n5. Draft post-mortem (timeline, root cause, improvement actions)',
fmt:'## Impact Assessment\n| Item | Detail |\n| Scope | ... |\n| Severity | SEV1/2/3 |\n\n## Response Steps\n1. Detect → 2. Triage → 3. Respond → 4. Recover → 5. Review\n\n## Post-Mortem\n| Timeline | Action | Owner |'},
onboard:{icon:'🎓',label:'Onboarding',desc:'Handoff docs for new members & AI agents',
sys:'You are a technical onboarding specialist. You create materials for fastest developer ramp-up.',
prompt:'Create onboarding materials:\n1. Summarize project from CLAUDE.md and AI_BRIEF.md\n2. Diagram design principles from .spec/constitution.md and architecture from docs/03_architecture.md\n3. Organize skill-level workflows from docs/42_skill_guide.md\n4. Extract first-week task list from .spec/tasks.md\n5. Create FAQ from common pitfalls in docs/37_bug_prevention.md',
fmt:'## Project Overview (5-min read)\n\n## Architecture Diagram\n```mermaid\n```\n\n## First Week\n| Day | Task | Reference File |\n\n## FAQ\n| Question | Answer |'},
cicd:{icon:'⚙️',label:'CI/CD Design',desc:'Design deploy pipelines & quality gates',
sys:'You are a DevOps engineer. You design CI/CD pipelines and quality gates.',
prompt:'CI/CD design:\n1. Analyze current pipeline in .github/workflows/ci.yml\n2. Convert docs/09_release_checklist.md checklist into quality gates\n3. Integrate docs/36_test_strategy.md test strategy into pipeline stages\n4. Convert .spec/verification.md criteria into automatable format\n5. Propose blue-green/canary deployment strategy',
fmt:'## Pipeline Design\n```mermaid\nflowchart LR\n```\n\n## Quality Gates\n| Stage | Check | Threshold | On Failure |\n\n## GitHub Actions\n```yaml\n# .github/workflows/ci.yml\n```'},
qa:{icon:'🐛',label:_ja?'QA・バグ検出':'QA & Bug Detection',desc:_ja?'ドメイン別バグパターンとQA戦略を基にテスト計画を生成':'Generate test plan based on domain-specific bug patterns and QA strategy',
sys:_ja?'あなたはQAエンジニアです。docs/28_qa_strategy.mdのドメイン別バグパターンを参照し、具体的なテストシナリオを設計してください。':'You are a QA engineer. Reference docs/28_qa_strategy.md domain-specific bug patterns to design concrete test scenarios.',
prompt:_ja?'以下の手順で実行:\n1. docs/28_qa_strategy.mdの重点領域を確認\n2. 各重点領域に対し具体的テストケースを3つ以上作成\n3. docs/32_qa_blueprint.mdの品質ゲートチェックリストと照合\n4. docs/33_test_matrix.mdのマトリクスに基づきカバレッジを検証\n5. よくあるバグパターンに対する回帰テストを設計\n6. 業界横断チェックリストの該当項目を検証\n7. 優先度マトリクスに基づきテスト実行順序を決定':'Follow these steps:\n1. Review focus areas from docs/28_qa_strategy.md\n2. Create 3+ concrete test cases per focus area\n3. Cross-reference with docs/32_qa_blueprint.md quality gate checklist\n4. Verify coverage against docs/33_test_matrix.md matrix\n5. Design regression tests for common bug patterns\n6. Verify applicable cross-cutting checklist items\n7. Determine test execution order based on priority matrix',
fmt:_ja?'Markdown表形式: テストID|カテゴリ|シナリオ|期待結果|優先度(CRITICAL/HIGH/MED/LOW)':'Markdown table: TestID|Category|Scenario|Expected Result|Priority(CRITICAL/HIGH/MED/LOW)'},
};
/* ── Header ── */
let h=`<div class="exp-header"><h3>🤖 ${_ja?'AI プロンプトランチャー':'AI Prompt Launcher'} <button class="btn btn-xs" onclick="showManual('launcher-guide')">📖 ${_ja?'使い方':'Manual'}</button></h3>
<p>${_ja
?'生成した仕様書をAIツールに一括投入。テンプレートを選んでコピー'
:'Feed generated specs to AI tools. Pick a template and copy'}</p></div>`;
/* ── Token overview ── */
if(hasFiles){
h+=`<div class="launch-stats">
<div class="launch-stat"><span class="launch-num">${fKeys.length}</span><span class="launch-lbl">${_ja?'ファイル':'Files'}</span></div>
<div class="launch-stat"><span class="launch-num">${totalTokens.toLocaleString()}</span><span class="launch-lbl">${_ja?'推定トークン':'Est. Tokens'}</span></div>
<div class="launch-stat"><span class="launch-num">${Object.keys(folders).length}</span><span class="launch-lbl">${_ja?'フォルダ':'Folders'}</span></div>
</div>`;
/* ── Folder breakdown ── */
h+=`<div class="launch-folders"><h4>${_ja?'📂 フォルダ別トークン':'📂 Tokens by Folder'}</h4>`;
const sortedDirs=Object.entries(folders).sort((a,b)=>b[1].tokens-a[1].tokens);
sortedDirs.forEach(([dir,info])=>{
const pct=Math.round(info.tokens/totalTokens*100);
h+=`<div class="launch-folder-row">
<label><input type="checkbox" checked data-dir="${dir}" onchange="updateLaunchPreview()"> <strong>${dir}/</strong></label>
<span>${info.files.length} ${_ja?'ファイル':'files'} · ${info.tokens.toLocaleString()} tok (${pct}%)</span>
<div class="launch-bar"><div class="launch-bar-fill" style="width:${pct}%"></div></div>
</div>`;
});
h+=`</div>`;
/* ── Model fit indicator ── */
const models=[
{name:'Claude Opus 4.6',ctx:1000000,icon:'🟣'},
{name:'Claude Sonnet 4.5',ctx:200000,icon:'🔵'},
{name:'GPT-5.2',ctx:400000,icon:'🟢'},
{name:'Gemini 2.5 Pro',ctx:1000000,icon:'🟡'},
{name:'Claude Haiku 4.5',ctx:200000,icon:'🟣'},
{name:'Gemini 3 Flash',ctx:200000,icon:'🟡'},
];
h+=`<div class="launch-models"><h4>${_ja?'🤖 モデル適合':'🤖 Model Fit'}</h4>`;
models.forEach(m=>{
const pct=Math.min(100,Math.round(totalTokens/m.ctx*100));
const ok=pct<80;
h+=`<div class="launch-model-row">${m.icon} ${m.name} <span class="launch-model-pct ${ok?'launch-ok':'launch-warn'}">${pct}% ${ok?(_ja?'余裕':'OK'):(pct<100?(_ja?'注意':'tight'):(_ja?'超過':'over'))}</span></div>`;
});
h+=`</div>`;
} else {
h+=`<div class="empty-preview-sm">${_ja?'⚠️ まず質問に回答してファイルを生成してください':'⚠️ Answer questions first to generate files'}</div>`;
}
/* ── Prompt templates (ordered by dev lifecycle) ── */
const templateOrder=['review','arch','reverse','implement','api','i18n','test','qa','security','a11y','perf','metrics','refactor','debug','incident','docs','migrate','cicd','growth','onboard'];
h+=`<div class="launch-templates"><h4>${_ja?'📋 プロンプトテンプレート':'📋 Prompt Templates'}</h4>`;
templateOrder.forEach(key=>{
const t=PT[key];
if(!t)return;
h+=`<div class="launch-tpl" onclick="selectLaunchTemplate('${key}')">
<div class="launch-tpl-icon">${t.icon}</div>
<div class="launch-tpl-info"><strong>${t.label}</strong><span>${t.desc}</span></div>
</div>`;
});
h+=`</div>`;
/* ── Output area ── */
h+=`<div class="launch-output" id="launchOutput">
<div class="launch-output-head">
<h4 id="launchOutputTitle"></h4>
<div class="prev-toolbar-r">
<button class="btn btn-xs btn-p" onclick="copyLaunchPrompt()">📋 ${_ja?'コピー':'Copy'}</button>
<button class="btn btn-xs btn-g" onclick="$('launchOutput').style.display='none'">✕</button>
</div>
</div>
<div class="launch-output-meta" id="launchOutputMeta"></div>
<pre class="launch-output-pre" id="launchOutputPre"></pre>
</div>`;
body.innerHTML=h;
/* ── State: store prompt templates for later use ── */
window._launchPT=PT;
window._launchFolders=folders;
window._launchFiles=files;
}
/* ── Select prompt template ── */
function selectLaunchTemplate(key){
const _ja=S.lang==='ja';
const PT=window._launchPT;
const t=PT[key];if(!t)return;
const selectedFiles=getSelectedLaunchFiles();
const content=selectedFiles.map(([k,v])=>`--- ${k} ---\n${v}`).join('\n\n');
const selTokens=Math.round(content.length/4);
const a=S.answers;const pn=S.projectName||'Project';
const ctx='Project: '+pn+'\nStack: '+(a.frontend||'N/A')+' + '+(a.backend||'N/A')+' + '+(a.database||'N/A')+'\nAuth: '+(a.auth||'N/A')+'\nEntities: '+(a.data_entities||'N/A');
const full='# System\n'+t.sys+'\n\n# Context\n'+ctx+'\n\n# Task\n'+t.prompt+'\n\n# Output Format\n'+t.fmt+'\n\n---\n\n'+content;
const out=$('launchOutput');out.style.display='block';
$('launchOutputTitle').textContent=`${t.icon} ${t.label}`;
$('launchOutputMeta').textContent=`${selectedFiles.length} ${_ja?'ファイル':'files'} · ~${selTokens.toLocaleString()} tokens`;
$('launchOutputPre').textContent=full.slice(0,2000)+(full.length>2000?`\n\n... (${_ja?'残り':'remaining'} ${(full.length-2000).toLocaleString()} chars)`:'');
window._launchFullPrompt=full;
out.scrollIntoView({behavior:'smooth',block:'nearest'});
}
/* ── Get selected files from checkboxes ── */
function getSelectedLaunchFiles(){
const checks=document.querySelectorAll('.launch-folder-row input[type=checkbox]');
const selectedDirs=new Set();
checks.forEach(c=>{if(c.checked)selectedDirs.add(c.dataset.dir);});
const files=window._launchFiles||S.files;
return Object.entries(files).filter(([k])=>{
const dir=k.includes('/')?k.split('/')[0]:'root';
return selectedDirs.has(dir);
});
}
/* ── Update preview when checkbox changes ── */
function updateLaunchPreview(){
const sel=getSelectedLaunchFiles();
const tokens=sel.reduce((s,e)=>s+Math.round(e[1].length/4),0);
// Update stats if output is showing
const meta=$('launchOutputMeta');
if(meta&&$('launchOutput').style.display!=='none'){
const _ja=S.lang==='ja';
meta.textContent=`${sel.length} ${_ja?'ファイル':'files'} · ~${tokens.toLocaleString()} tokens`;
}
}
/* ── Copy to clipboard ── */
function copyLaunchPrompt(){
const _ja=S.lang==='ja';
const text=window._launchFullPrompt;
if(!text)return;
navigator.clipboard.writeText(text).then(()=>{
toast(_ja?'📋 プロンプトをコピーしました':'📋 Prompt copied to clipboard');
}).catch(()=>{
// Fallback
const ta=document.createElement('textarea');ta.value=text;
document.body.appendChild(ta);ta.select();document.execCommand('copy');ta.remove();
toast(_ja?'📋 コピー完了':'📋 Copied');
});
}
/* ── Pillar ⑥ Context Dashboard (Enhanced) ── */
function showDashboard(){
pushView({pillar:5,type:'dashboard',file:null});
const body=$('prevBody');
const _ja=S.lang==='ja';
const a=S.answers;
const fileCount=Object.keys(S.files).length||0;
const totalChars=Object.values(S.files).reduce((s,f)=>s+f.length,0);
const tokens=Math.round(totalChars/4);
const answered=Object.keys(a).length;
let h=`<div class="dash-head"><h3>📊 Context Dashboard</h3><p>${_ja?'プロジェクトのコンテキスト情報を一覧':'Project context overview'}</p></div>`;
// Backup reminder banner
const lastExp=_lsGet('devforge-last-export');
const daysSince=lastExp?Math.floor((Date.now()-new Date(lastExp).getTime())/86400000):-1;
if(daysSince<0){
h+=`<div class="dash-backup dash-backup-red"><span>⚠️ ${_ja?'まだエクスポートしていません — データはブラウザのみに保存されています':'No exports yet — data only exists in this browser'}</span><button class="btn btn-xs btn-p" onclick="exportProject();_lsSet('devforge-last-export',new Date().toISOString());">📤 ${_ja?'今すぐ保存':'Export Now'}</button></div>`;
} else if(daysSince>=3){
h+=`<div class="dash-backup dash-backup-yellow"><span>💾 ${_ja?'最終エクスポート: '+daysSince+'日前':'Last export: '+daysSince+' days ago'}</span><button class="btn btn-xs btn-s" onclick="exportProject();_lsSet('devforge-last-export',new Date().toISOString());">📤 ${_ja?'バックアップ':'Backup'}</button></div>`;
}

// Usage guide card
if(!_lsGet('devforge-guide-dismiss')){
h+=`<div class="dash-backup dash-guide"><span>🚀 ${_ja?'生成ファイルの活用ガイドを確認しましょう':'Check the generated files usage guide'}</span><button class="btn btn-xs btn-p" onclick="showPostGenGuide(true)">${_ja?'ガイドを見る':'View Guide'}</button><button class="btn btn-xs btn-s" onclick="showManual('workflow')">${_ja?'📘 手順':'📘 Workflow'}</button><button class="btn btn-xs btn-g" onclick="this.closest('.dash-backup').remove();_lsSet('devforge-guide-dismiss','1')">✕</button></div>`;
}

// Summary stats
h+=`<div class="ctx-summary">
<div class="ctx-stat"><div class="num">${fileCount}</div><div class="lbl">${_ja?'生成ファイル':'Files'}</div></div>
<div class="ctx-stat"><div class="num">${Math.round(tokens).toLocaleString()}</div><div class="lbl">${_ja?'推定トークン':'Est. Tokens'}</div></div>
<div class="ctx-stat"><div class="num">${answered}</div><div class="lbl">${_ja?'回答済み質問':'Answered'}</div></div>
<div class="ctx-stat"><div class="num">${TECH_DB.length}</div><div class="lbl">${_ja?'技術DB':'Tech DB'}</div></div>
</div>`;
// Model fit analysis
const models=[
{name:'Claude Opus 4.6',ctx:1000000,color:'var(--accent)'},
{name:'Claude Sonnet 4.5',ctx:200000,color:'var(--accent-2)'},
{name:'GPT-5.2',ctx:400000,color:'var(--success)'},
{name:'Gemini 2.5 Pro',ctx:1000000,color:'var(--warn)'},
{name:'Claude Haiku 4.5',ctx:200000,color:'var(--accent)'},
{name:'Gemini 3 Flash',ctx:200000,color:'var(--warn)'},
];
h+='<h4 class="dash-h4">🤖 '+(_ja?'モデル適合度':'Model Fit')+'</h4><div class="model-grid">';
models.forEach(m=>{
const pct=Math.min(100,Math.round(tokens/m.ctx*100));
const fit=pct<80?'high':pct<95?'mid':'low';
const fitClass=fit==='high'?'fit-high':fit==='mid'?'fit-mid':'fit-low';
h+=`<div class="model-card"><h4>${m.name}</h4><div class="fit ${fitClass}">${fit==='high'?(_ja?'\u2705 適合':'\u2705 Fit'):fit==='mid'?(_ja?'\u26A0\uFE0F 注意':'\u26A0\uFE0F Caution'):(_ja?'\u274C 超過':'\u274C Over')}</div>
<div class="dash-model-ctx">${_ja?'コンテキスト':'Context'}: ${(m.ctx/1000).toFixed(0)}K tokens</div>
<div class="ctx-bar"><div class="ctx-bar-fill" style="width:${pct}%;background:${m.color}"></div></div>
<div class="dash-model-pct">${pct}% ${_ja?'使用':'used'}</div></div>`;
});
h+='</div>';
// File size breakdown by pillar
if(fileCount>0){
h+='<h4 class="dash-h4-mt">📂 '+(_ja?'ファイルサイズ分布':'File Size Distribution')+'</h4>';
const cats=_ja?{'SDD (.spec/)':0,'DevContainer':0,'MCP':0,'AIルール':0,'Roadmap':0,'Docs':0,'Common':0}:{'SDD (.spec/)':0,'DevContainer':0,'MCP':0,'AI Rules':0,'Roadmap':0,'Docs':0,'Common':0};
Object.entries(S.files).forEach(([p,c])=>{
const len=c.length;
if(p.startsWith('.spec/'))cats['SDD (.spec/)']+=len;
else if(p.startsWith('.devcontainer/'))cats['DevContainer']+=len;
else if(p.includes('mcp'))cats['MCP']+=len;
else if(p.startsWith('roadmap/'))cats['Roadmap']+=len;
else if(p.startsWith('docs/'))cats['Docs']+=len;
else if(['.cursor/rules','.windsurfrules','.clinerules','CLAUDE.md','AGENTS.md'].some(x=>p.includes(x)))cats[_ja?'AIルール':'AI Rules']+=len;
else cats['Common']+=len;
});
const maxLen=Math.max(...Object.values(cats),1);
Object.entries(cats).forEach(([name,len])=>{
const pct=Math.round(len/maxLen*100);
h+=`<div class="dash-fbar-row">
<span class="dash-fbar-name">${name}</span>
<div class="dash-fbar"><div class="dash-fbar-fill" style="width:${pct}%"></div></div>
<span class="dash-fbar-size">${(len/1024).toFixed(1)}KB</span>
</div>`;
});
}
// Tech DB category breakdown — grouped bar chart
h+='<h4 class="dash-h4-mt">📊 '+(_ja?'技術マスターテーブル統計':'Tech DB Statistics')+'</h4>';
const catLabels=_ja?{lang:'言語',front:'FE',mobile:'モバイル',back:'BE',baas:'BaaS',payment:'決済/CMS',devops:'DevOps',ai:'AIツール',ai_auto:'AI自律',method:'手法',test:'テスト',api:'API',build:'ビルド',data:'データ',security:'セキュリティ'}:{lang:'Lang',front:'FE',mobile:'Mobile',back:'BE',baas:'BaaS',payment:'Payment/CMS',devops:'DevOps',ai:'AI Tools',ai_auto:'AI Auto',method:'Methods',test:'Testing',api:'API',build:'Build',data:'Data',security:'Security'};
const catCounts=TECH_DB.reduce((acc,t)=>{acc[t.cat]=(acc[t.cat]||0)+1;return acc;},{});
const dbMax=Math.max(...Object.values(catCounts));
const domGrps=_ja?[
{n:'🖥 コア開発',c:['lang','front','back','mobile'],cl:'dg-core'},
{n:'🤖 AI & 自動化',c:['ai','ai_auto'],cl:'dg-ai'},
{n:'☁️ インフラ & サービス',c:['baas','devops','payment'],cl:'dg-infra'},
{n:'🛡 品質 & 設計',c:['method','test','api','build','data','security'],cl:'dg-qa'}
]:[
{n:'🖥 Core Dev',c:['lang','front','back','mobile'],cl:'dg-core'},
{n:'🤖 AI & Automation',c:['ai','ai_auto'],cl:'dg-ai'},
{n:'☁️ Infra & Services',c:['baas','devops','payment'],cl:'dg-infra'},
{n:'🛡 Quality & Design',c:['method','test','api','build','data','security'],cl:'dg-qa'}
];
domGrps.forEach(g=>{
const items=g.c.filter(c=>catCounts[c]).map(c=>({l:catLabels[c]||c,v:catCounts[c]})).sort((a,b)=>b.v-a.v);
const sub=items.reduce((s,i)=>s+i.v,0);
h+=`<div class="dg ${g.cl}"><div class="dg-hd"><span class="dg-nm">${g.n}</span><span class="dg-sub">${sub}</span></div>`;
items.forEach(i=>{
const pct=Math.round(i.v/dbMax*100);
h+=`<div class="dg-bar"><span class="dg-lbl">${i.l}</span><div class="dg-track"><div class="dg-fill" style="width:${pct}%"></div></div><span class="dg-cnt">${i.v}</span></div>`;
});
h+='</div>';
});
h+=`<div class="dg-total"><span>📊 ${_ja?'技術マスターテーブル':'Tech Master Table'}</span><strong>${TECH_DB.length}</strong></div>`;
// Project info
h+=`<h4 class="dash-h4-mt">📋 ${_ja?'プロジェクト情報':'Project Info'}</h4><div class="dash-info">`;
const info=_ja?[['プロジェクト名',S.projectName],['フロント',a.frontend],['バック',a.backend],['DB',a.database],['デプロイ',a.deploy],['モバイル',a.mobile],['AI自律',a.ai_auto],['決済/CMS',a.payment],['駆動開発',a.dev_methods],['スキル',a.skill_level]]:[['Project',S.projectName],['Frontend',a.frontend],['Backend',a.backend],['DB',a.database],['Deploy',a.deploy],['Mobile',a.mobile],['AI Auto',a.ai_auto],['Payment/CMS',a.payment],['Dev Methods',a.dev_methods],['Skill',a.skill_level]];
info.forEach(([k,v])=>{if(v&&v!==(_ja?'（未指定）':'(Unset)')&&v!=='(Unset)')h+=`<div class="exp-row"><span class="label">${k}</span><span class="val">${esc(v)}</span></div>`;});
h+='</div>';
// Stack Synergy Score
const syn=calcSynergy(a);
const synColor=syn.overall>=75?'var(--success)':syn.overall>=50?'var(--warn)':'var(--danger)';
const synLabel=syn.overall>=75?(_ja?'High Synergy':'High Synergy'):syn.overall>=50?(_ja?'Medium Synergy':'Medium Synergy'):(_ja?'Low Synergy':'Low Synergy');
h+=`<h4 class="dash-h4-mt">⚡ ${_ja?'スタック相乗効果スコア':'Stack Synergy Score'}</h4>`;
h+=`<div class="synergy-card">`;
h+=`<div class="synergy-header"><div class="synergy-label">${synLabel}</div><div class="synergy-score" style="background:${synColor}20;color:${synColor};">${syn.overall}</div></div>`;
h+=`<div class="synergy-bar"><div class="synergy-bar-fill" style="width:${syn.overall}%;background:${synColor};"></div></div>`;
h+=`<div class="synergy-dims">`;
const dims=[
{l:_ja?'FE↔BE親和度':'FE↔BE Affinity',v:syn.d1},
{l:_ja?'エコ統一度':'Ecosystem Unity',v:syn.d2},
{l:_ja?'ドメイン適合':'Domain Fit',v:syn.d3},
{l:_ja?'デプロイ整合':'Deploy Alignment',v:syn.d4},
{l:_ja?'複雑度バランス':'Complexity Balance',v:syn.d5}
];
dims.forEach(d=>{
const c=d.v>=75?'var(--success)':d.v>=50?'var(--warn)':'var(--danger)';
h+=`<div class="synergy-dim"><span class="synergy-dim-lbl">${d.l}</span><div class="synergy-dim-bar"><div class="synergy-dim-fill" style="width:${d.v}%;background:${c};"></div></div><span class="synergy-dim-val">${d.v}</span></div>`;
});
h+=`</div>`;
if(syn.domain)h+=`<div class="synergy-domain">${_ja?'検出ドメイン':'Detected Domain'}: <strong>${syn.domain}</strong></div>`;
h+=`</div>`;
// Stack compatibility report
const compat=checkCompat(a);
const errs=compat.filter(c=>c.level==='error');
const warns=compat.filter(c=>c.level==='warn');
const infos=compat.filter(c=>c.level==='info');
const ok=8-(errs.length>0?1:0)-(warns.length>0?1:0);
h+=`<h4 class="dash-h4-mt">🔍 ${_ja?'スタック相性 & 整合性チェック':'Stack Compatibility & Consistency'}</h4>`;
if(compat.length===0){
h+=`<div class="compat-ok">✅ ${_ja?`スタック相性・意味的整合ともに問題なし（${COMPAT_RULES.length}ルール検証済）`:`No issues found (${COMPAT_RULES.length} rules verified)`}</div>`;
} else {
h+=`<div class="compat-summary"><span class="compat-s-ok">✅ ${_ja?'問題なし':'OK'}: ${COMPAT_RULES.length-compat.length}</span>`;
const fixWarns=compat.filter(c=>c.fix&&c.level==='warn');
if(warns.length)h+=`<span class="compat-s-warn">⚠️ ${_ja?'注意':'Warn'}: ${warns.length}</span>`;
if(fixWarns.length>1)h+=`<button class="btn btn-xs btn-s compat-fixlv" onclick="fixAllCompat('warn')">🔧 ${fixWarns.length}</button>`;
const fixErrs=compat.filter(c=>c.fix&&c.level==='error');
if(errs.length)h+=`<span class="compat-s-err">❌ ${_ja?'要修正':'Fix'}: ${errs.length}</span>`;
if(fixErrs.length>1)h+=`<button class="btn btn-xs btn-s compat-fixlv" onclick="fixAllCompat('error')">🔧 ${fixErrs.length}</button>`;
const fixInfos=compat.filter(c=>c.fix&&c.level==='info');
if(infos.length)h+=`<span class="compat-s-info">ℹ️ ${_ja?'参考':'Info'}: ${infos.length}</span>`;
if(fixInfos.length>1)h+=`<button class="btn btn-xs btn-s compat-fixlv" onclick="fixAllCompat('info')">🔧 ${fixInfos.length}</button>`;
const fixable=compat.filter(c=>c.fix);
if(fixable.length>1)h+=`<button class="btn btn-xs btn-p compat-fixall" onclick="fixAllCompat()">🔧 ${_ja?'一括修正 ('+fixable.length+'件)':'Fix All ('+fixable.length+')'}</button>`;
h+='</div>';
compat.forEach(c=>{
const icon=c.level==='error'?'❌':c.level==='warn'?'⚠️':'ℹ️';
const cls=c.level==='error'?'compat-error':c.level==='warn'?'compat-warn':'compat-info';
const pair=c.pair.map(p=>{const n={frontend:'FE',backend:'BE',database:'DB',deploy:'Deploy',mobile:'Mobile',orm:'ORM',ai_auto:'AI',skill_level:'Skill',payment:'Pay',dev_methods:'DevMethod',auth:'Auth',scope_out:'Scope',data_entities:'Entity',purpose:'Purpose',mvp_features:'MVP'};return n[p]||p;}).join(' ↔ ');
h+=`<div class="${cls}"><span class="compat-pair">${pair}</span><span class="compat-msg">${esc(c.msg)}</span>`;
if(c.fix)h+=`<button class="btn btn-xs btn-s compat-fix" onclick="S.answers['${escAttr(c.fix.f)}']='${escAttr(c.fix.s)}';save();showDashboard();">→ ${esc(c.fix.s)}</button>`;
h+='</div>';
});
}
h+='<h4 class="dash-h4-mt">'+(_ja?'📐 プロジェクト複雑度':'📐 Project Complexity')+'</h4>';
h+=getComplexityHTML();
// Project health score
h+=getHealthHTML(_ja,fileCount,answered);
// File Dependency Tree
if(fileCount>0){
h+=`<h4 class="dash-h4-mt">🔗 ${_ja?'ファイル依存関係':'File Dependencies'}</h4>`;
const groups=[
{id:'spec',icon:'📋',title:_ja?'仕様理解フロー':'Spec Flow',files:[
{p:'.spec/constitution.md',l:_ja?'原則(最初に読む)':'Principles (read first)',d:0},
{p:'.spec/specification.md',l:_ja?'要件定義':'Requirements',d:1},
{p:'.spec/technical-plan.md',l:_ja?'技術計画':'Technical Plan',d:1},
{p:'.spec/tasks.md',l:_ja?'タスク分解':'Tasks',d:2},
{p:'.spec/verification.md',l:_ja?'完了基準':'Acceptance',d:2}
]},
{id:'ai',icon:'🤖',title:_ja?'AI開発フロー':'AI Dev Flow',files:[
{p:'CLAUDE.md',l:_ja?'AI設定(自動読込)':'AI config (auto-loaded)',d:0},
{p:'AI_BRIEF.md',l:_ja?'要約(最初の投入)':'Brief (first input)',d:1},
{p:'AGENTS.md',l:_ja?'Agent役割定義':'Agent roles',d:1},
{p:'.cursor/rules',l:_ja?'Cursorルール':'Cursor rules',d:1},
{p:'skills/project.md',l:_ja?'スキル定義':'Skills',d:2}
]},
{id:'qa',icon:'🧪',title:_ja?'品質・テストフロー':'QA & Test Flow',files:[
{p:'docs/28_qa_strategy.md',l:_ja?'QA戦略':'QA Strategy',d:0},
{p:'docs/32_qa_blueprint.md',l:_ja?'QA設計図':'QA Blueprint',d:1},
{p:'docs/33_test_matrix.md',l:_ja?'テストマトリクス':'Test Matrix',d:1},
{p:'docs/36_test_strategy.md',l:_ja?'テスト戦略':'Test Strategy',d:1},
{p:'docs/37_bug_prevention.md',l:_ja?'バグ防止':'Bug Prevention',d:2}
]},
{id:'rev',icon:'🔄',title:_ja?'ゴール逆算フロー':'Reverse Flow',files:[
{p:'docs/29_reverse_engineering.md',l:_ja?'ゴール定義':'Goal Definition',d:0},
{p:'docs/30_goal_decomposition.md',l:_ja?'ゴール分解':'Goal Breakdown',d:1},
{p:'docs/39_implementation_playbook.md',l:_ja?'実装パターン':'Impl Patterns',d:2},
{p:'docs/40_ai_dev_runbook.md',l:_ja?'AI運用手順':'AI Runbook',d:2}
]}
];
groups.forEach(g=>{
const count=g.files.filter(f=>S.files[f.p]).length;
h+=`<div class="fdep-group"><div class="fdep-header" onclick="toggleFdep('${g.id}')"><span class="fdep-icon">▶</span><span class="fdep-title">${g.icon} ${g.title}</span><span class="fdep-count">${count}/${g.files.length}</span></div>`;
h+=`<div class="fdep-body" id="fdep-${g.id}">`;
g.files.forEach(f=>{
const exists=!!S.files[f.p];
const ind='fdep-ind-'+f.d;
h+=`<div class="fdep-item ${ind} ${exists?'fdep-exists':'fdep-missing'}">`;
if(exists)h+=`<a href="#" onclick="event.preventDefault();previewFile('${f.p}')">● ${f.l}</a>`;
else h+=`<span>○ ${f.l}</span>`;
h+=`</div>`;
});
h+=`</div></div>`;
});
}
// File size distribution by Pillar
if(Object.keys(S.files).length>0){
const pillarMap={'.spec/':'P1 SDD','.devcontainer/':'P2 DevContainer','mcp-config':'P3 MCP','.cursor/':'P4 AI Rules','.clinerules':'P4','.windsurfrules':'P4','.gemini/':'P4','.github/':'P4','CLAUDE.md':'P4','AGENTS.md':'P4','codex-instructions':'P4','.kiro/':'P4','skills/':'P4','roadmap/':'P7 Roadmap','docs/43_security':'P12 Security','docs/44_threat':'P12 Security','docs/45_compliance':'P12 Security','docs/46_ai_security':'P12 Security','docs/47_security_testing':'P12 Security','docs/48_industry':'P13 Strategy','docs/49_tech_radar':'P13 Strategy','docs/50_stakeholder':'P13 Strategy','docs/51_operational':'P13 Strategy','docs/52_advanced':'P13 Strategy','docs/':'Docs','README.md':'Common','.gitignore':'Common','LICENSE':'Common','package.json':'Common','.ai/':'Common','.mcp/':'P3 MCP'};
const pillarSizes={};
Object.entries(S.files).forEach(([p,c])=>{
let pil='Other';
for(const[k,v]of Object.entries(pillarMap)){if(p.startsWith(k)||p.includes(k)){pil=v;break;}}
pillarSizes[pil]=(pillarSizes[pil]||0)+c.length;
});
const sorted=Object.entries(pillarSizes).sort((a,b)=>b[1]-a[1]);
const max=sorted[0]?sorted[0][1]:1;
const pillarColors={'P1 SDD':'var(--accent)','P2 DevContainer':'var(--accent-2)','P3 MCP':'var(--success)','P4 AI Rules':'var(--warn)','P5 Quality':'var(--danger)','P7 Roadmap':'var(--danger)','P9 Design System':'var(--accent)','P10 Reverse Eng':'var(--success)','P11 Impl Intelligence':'var(--accent-2)','P12 Security':'var(--danger)','P13 Strategy':'var(--warn)','Docs':'var(--layer-5)','Common':'var(--text-3)'};
h+='<h4 class="dash-h4-mt">'+(_ja?'📦 ファイルサイズ分布':'📦 File Size Distribution')+'</h4>';
h+='<div class="fsize-chart">';
sorted.forEach(([pil,sz])=>{
const pct=Math.round(sz/max*100);
const kb=(sz/1024).toFixed(1);
const col=pillarColors[pil]||'var(--text-3)';
h+=`<div class="fsize-row"><span class="fsize-lbl">${pil}</span><div class="fsize-bar-wrap"><div class="fsize-bar" style="width:${pct}%;background:${col}"></div></div><span class="fsize-val">${kb}KB</span></div>`;
});
h+='</div>';
}

// Tech DB button
h+=`<div class="dash-center"><button class="btn btn-s" onclick="renderTechDB()">📊 ${_ja?'技術マスターテーブル':'Tech Master Table'} (${TECH_DB.length} ${_ja?'エントリ':'entries'})</button></div>`;
body.innerHTML=h;
}
function getHealthHTML(_ja,fileCount,answered){
const qs=getQ();
let totalQ=0;
for(let p=1;p<=3;p++){
if(qs[p])qs[p].questions.forEach(q=>{
if(!isQActive(q))return;
totalQ++;
});
}
const answerPct=totalQ?Math.round(answered/totalQ*100):0;
// Pillar coverage
const pillarChecks=[
{key:'.spec/',label:_ja?'①SDD':'①SDD'},
{key:'.devcontainer/',label:_ja?'②DevContainer':'②DevContainer'},
{key:'mcp',label:_ja?'③MCP':'③MCP'},
{key:'CLAUDE.md',label:_ja?'④AIルール':'④AI Rules'},
{key:'docs/32_',label:_ja?'⑤品質インテリジェンス':'⑤Quality Intelligence'},
{key:'roadmap/',label:_ja?'⑦ロードマップ':'⑦Roadmap'},
{key:'docs/26_',label:_ja?'⑨デザインシステム':'⑨Design System'},
{key:'docs/29_',label:_ja?'⑩リバースEng':'⑩Reverse Eng'},
{key:'docs/39_',label:_ja?'⑪実装ガイド':'⑪Impl Guide'},
{key:'docs/43_',label:_ja?'⑫セキュリティ':'⑫Security'},
{key:'docs/48_',label:_ja?'⑬戦略インテリジェンス':'⑬Strategic Intelligence'},
];
const fileKeys=Object.keys(S.files);
let pillarOK=0;
const pillarResults=pillarChecks.map(pc=>{
const ok=fileKeys.some(f=>f.includes(pc.key));
if(ok)pillarOK++;
return {label:pc.label,ok};
});
const pillarPct=pillarChecks.length?Math.round(pillarOK/pillarChecks.length*100):0;
// Required files
const requiredFiles=['constitution.md','tasks.md','CLAUDE.md'];
let reqOK=0;
const reqResults=requiredFiles.map(rf=>{
const ok=fileKeys.some(f=>f.endsWith(rf));
if(ok)reqOK++;
return {name:rf,ok};
});
const reqPct=requiredFiles.length?Math.round(reqOK/requiredFiles.length*100):0;
// Overall score
const score=Math.round(answerPct*0.3+pillarPct*0.4+reqPct*0.3);
const color=score>=80?'var(--success)':score>=50?'var(--warn)':'var(--danger)';
const label=score>=80?(_ja?'✅ 良好':'✅ Healthy'):score>=50?(_ja?'⚠️ 部分的':'⚠️ Partial'):(_ja?'🔴 不完全':'🔴 Incomplete');
let h=`<h4 class="dash-h4-mt">🏥 ${_ja?'プロジェクト健全性':'Project Health'}</h4>`;
h+=`<div class="complexity-card"><div class="complexity-header"><div><div class="dash-total complexity-label">${label}</div></div><div class="complexity-score" style="background:${color}20;color:${color};">${score}</div></div>`;
h+=`<div class="complexity-bar"><div class="complexity-fill" style="width:${score}%;background:${color};"></div></div>`;
h+=`<div class="complexity-grid">`;
h+=`<div class="complexity-item"><span>${_ja?'回答完了率':'Answers'}</span><span>${answerPct}%</span></div>`;
h+=`<div class="complexity-item"><span>${_ja?'Pillarカバー':'Pillar Coverage'}</span><span>${pillarOK}/${pillarChecks.length}</span></div>`;
h+=`<div class="complexity-item"><span>${_ja?'必須ファイル':'Required Files'}</span><span>${reqOK}/${requiredFiles.length}</span></div>`;
h+=`<div class="complexity-item"><span>${_ja?'生成ファイル数':'Total Files'}</span><span>${fileCount}</span></div>`;
h+=`</div>`;
// Detail items
if(score<100){
h+=`<div class="dash-total dash-total-mt">`;
pillarResults.filter(r=>!r.ok).forEach(r=>{h+=`<span>❌ ${r.label} </span>`;});
reqResults.filter(r=>!r.ok).forEach(r=>{h+=`<span>❌ ${r.name} </span>`;});
if(answerPct<100)h+=`<span>⚠️ ${totalQ-answered} ${_ja?'件未回答':'unanswered'}</span>`;
h+=`</div>`;
}
h+=`</div>`;
return h;
}
/* ── Tech Master Table ── */
function renderTechDB(){
pushView({pillar:5,type:'techdb',file:null});
const body=$('prevBody');
const _ja=S.lang==='ja';const cats=_ja?{lang:'言語',front:'フロント',mobile:'モバイル',back:'バックエンド',baas:'BaaS',payment:'決済/CMS/EC',devops:'DevOps',ai:'AIツール',ai_auto:'AI自律',method:'手法',test:'テスト',api:'API',build:'ビルド',data:'データ',security:'セキュリティ'}:{lang:'Language',front:'Frontend',mobile:'Mobile',back:'Backend',baas:'BaaS',payment:'Payment/CMS/EC',devops:'DevOps',ai:'AI Tools',ai_auto:'AI Autonomous',method:'Methods',test:'Testing',api:'API',build:'Build',data:'Data',security:'Security'};
let h=`<div class="dash-head"><h3>📊 ${_ja?'技術マスターテーブル':'Tech Master Table'}</h3><p>${TECH_DB.length}${_ja?'エントリ — フィルタで絞り込み':'entries — use filters to narrow down'}</p></div>`;
h+=`<div class="tech-filter">
<select id="tfCat" onchange="filterTechDB()"><option value="">${_ja?'全カテゴリ':'All Categories'}</option>${Object.entries(cats).map(([k,v])=>`<option value="${k}">${v}</option>`).join('')}</select>
<select id="tfReq" onchange="filterTechDB()"><option value="">${_ja?'全必須度':'All Levels'}</option><option value="required">${_ja?'必須':'Required'}</option><option value="recommended">${_ja?'推奨':'Recommended'}</option><option value="optional">${_ja?'選択':'Optional'}</option></select>
<input id="tfSearch" placeholder="${_ja?'検索...':'Search...'}" oninput="filterTechDB()">
<span id="tfCount" class="dash-tfcount">${TECH_DB.length}${_ja?'件':' items'}</span>
</div>`;
h+=`<div class="dash-tbl-wrap"><table class="tech-table"><thead><tr><th>${_ja?'技術名':'Tech'}</th><th>${_ja?'カテゴリ':'Category'}</th><th>${_ja?'種別':'Type'}</th><th>${_ja?'必須度':'Required'}</th><th>${_ja?'レベル':'Level'}</th></tr></thead><tbody id="techTbody">`;
TECH_DB.forEach(t=>{
const reqClass='req-'+t.req.replace(/\d$/,'');
h+=`<tr data-cat="${t.cat}" data-req="${t.req}" data-name="${t.name.toLowerCase()}"><td><strong>${t.name}</strong>${t.price?' <span class="dash-price">'+priceLabel(t.price)+'</span>':''}</td><td>${cats[t.cat]||t.cat}</td><td>${t.sub}</td><td><span class="req-badge ${reqClass}">${reqLabel(t.req)}</span></td><td>${t.level}</td></tr>`;
});
h+='</tbody></table></div>';
h+=`<div class="dash-back"><button class="btn btn-s" onclick="showDashboard()">← ${_ja?'ダッシュボード':'Dashboard'}</button></div>`;
body.innerHTML=h;
}
function filterTechDB(){
const _ja=S.lang==='ja';
const cat=$('tfCat').value;const req=$('tfReq').value;const search=$('tfSearch').value.toLowerCase();
const rows=document.querySelectorAll('#techTbody tr');let count=0;
rows.forEach(r=>{
const show=(!cat||r.dataset.cat===cat)&&(!req||r.dataset.req.includes(req))&&(!search||r.dataset.name.includes(search));
r.style.display=show?'':'none';if(show)count++;
});
$('tfCount').textContent=count+(_ja?'件':' items');
}
function fixAllCompat(level){
const _ja=S.lang==='ja';
const compat=checkCompat(S.answers);
const fixable=compat.filter(c=>c.fix&&(!level||c.level===level));
if(fixable.length===0)return;
fixable.forEach(c=>{S.answers[c.fix.f]=c.fix.s;});
save();
toast(_ja?'🔧 '+fixable.length+'件の問題を修正しました':'🔧 Fixed '+fixable.length+' issue(s)');
showDashboard();
}
function toggleFdep(id){
const body=$('fdep-'+id);
if(!body)return;
const header=body.previousElementSibling;
const icon=header.querySelector('.fdep-icon');
const isOpen=body.classList.contains('fdep-open');
body.classList.toggle('fdep-open');
if(icon)icon.textContent=isOpen?'▶':'▼';
}
/* ── Interactive Roadmap UI (Enhanced) ── */
function showRoadmapUI(){
pushView({pillar:6,type:'roadmap',file:null});
const _ja=S.lang==='ja';
const body=$('prevBody');
if(!S.files['roadmap/LEARNING_PATH.md']){
body.innerHTML='<p class="dash-empty">'+(_ja?'ファイル生成後に利用可能です':'Available after file generation')+'</p>';return;
}
const a=S.answers;
const level=a.skill_level||'Intermediate';
const isB=level.includes('Beginner');const isP=level.includes('Professional');
const timeMul=isB?2.0:isP?0.5:1.0;
const mob=a.mobile||(_ja?'なし':'None');const ai=a.ai_auto||(_ja?'なし':'None');const pay=a.payment||(_ja?'なし':'None');const noMob=mob==='なし'||mob==='None';const noAI=ai==='なし'||ai==='None';const noPay=pay==='なし'||pay==='None';
const fe=a.frontend||'React + Next.js';const be=a.backend||'Node.js + Express';const dep=a.deploy||'Vercel';
/* ── Resource lookups ── */
function res(key){return RESOURCES[key]||null;}
function feRes(){if(fe.includes('Vue'))return res('vue');if(fe.includes('Svelte'))return res('svelte');if(fe.includes('Astro'))return res('astro');if(fe.includes('Vite'))return res('react');return res('nextjs');}
function beRes(){if(be.includes('Fastify'))return res('fastify');if(be.includes('NestJS'))return res('nestjs');if(be.includes('FastAPI'))return res('fastapi');if(be.includes('Django'))return res('django');if(be.includes('Spring'))return res('spring');if(be.includes('Go'))return res('go');if(be.includes('Hono'))return res('hono');if(be.includes('Firebase'))return res('firebase');if(be.includes('Supabase'))return res('supabase');return res('express');}
function depRes(){if(dep.includes('Cloudflare'))return res('cloudflare');if(dep.includes('Railway'))return res('railway');return res('vercel');}
function authRes(){const au=a.auth||'';if(au.includes('Clerk'))return res('clerk');if(au.includes('Supabase'))return res('supabase');return res('nextauth');}
function methRes(m){if(m.includes('BDD'))return res('bdd');if(m.includes('DDD'))return res('ddd');return res('tdd');}
/* ── Build layers with hrs + res ── */
const layers=[
{name:_ja?'Layer 1: Web基盤':'Layer 1: Web Fundamentals',color:'var(--layer-1)',items:[
{text:_ja?'HTML5 / CSS3基礎':'HTML5 / CSS3 Basics',wk:isB?'Week 1-4':'Week 1',hrs:isB?40:8,res:res('html')},
{text:'Tailwind CSS',wk:isB?'Week 3-8':'Week 1-2',hrs:isB?20:6,res:res('tailwind')},
{text:'JavaScript ES6+ / TypeScript',wk:isB?'Week 5-12':'Week 1-2',hrs:isB?60:8,res:res('js')},
]},
{name:_ja?'Layer 2: フロントエンド':'Layer 2: Frontend',color:'var(--layer-2)',items:[
{text:fe+(_ja?' セットアップ':' Setup'),hrs:8,res:feRes()},
{text:_ja?'shadcn/ui + コンポーネント設計':'shadcn/ui + Component Design',hrs:12,res:res('shadcn')},
{text:_ja?'状態管理 (Zustand/Redux)':'State Management (Zustand/Redux)',hrs:10,res:res('zustand')},
{text:'React Query / SWR',hrs:6,res:res('rquery')},
{text:_ja?'テスト (Vitest + Playwright)':'Testing (Vitest + Playwright)',hrs:12,res:res('vitest')},
]},
{name:_ja?'Layer 3: バックエンド':'Layer 3: Backend',color:'var(--layer-3)',items:[
{text:be+(_ja?' セットアップ':' Setup'),hrs:8,res:beRes()},
{text:_ja?'データベース設計 + ORM':'Database Design + ORM',hrs:16,res:res('prisma')},
{text:_ja?'REST API / tRPC 実装':'REST API / tRPC Implementation',hrs:16,res:beRes()},
{text:(_ja?'認証・認可':'Auth & Authorization')+' ('+(a.auth||'NextAuth')+')',hrs:12,res:authRes()},
]},
];
if(!noMob) layers.push({name:_ja?'Layer 3.5: モバイル':'Layer 3.5: Mobile',color:'var(--layer-3h)',items:[
{text:mob+(_ja?' 環境構築':' Setup'),hrs:10,res:mob.includes('Flutter')?res('flutter'):mob.includes('bare')?res('rn'):res('expo')},
{text:_ja?'ナビゲーション・画面設計':'Navigation & Screen Design',hrs:12,res:mob.includes('Flutter')?res('flutter'):res('expo')},
{text:_ja?'ネイティブ機能':'Native Features',hrs:10,res:mob.includes('Flutter')?res('flutter'):res('expo')},
{text:_ja?'EASビルド・ストア提出':'EAS Build & Store Submit',hrs:8,res:res('expo')},
]});
layers.push({name:'Layer 4: DevOps',color:'var(--layer-4)',items:[
{text:'Docker + DevContainer',hrs:8,res:res('docker')},
{text:'GitHub Actions CI/CD',hrs:8,res:res('ghactions')},
{text:dep+(_ja?' デプロイ':' Deploy'),hrs:4,res:depRes()},
]});
layers.push({name:_ja?'Layer 5: AI駆動開発':'Layer 5: AI-Driven Dev',color:'var(--layer-5)',items:[
{text:_ja?'AI IDEセットアップ ('+((a.ai_tools||'Cursor').split(', ').slice(0,3).join(' / '))+')':'AI IDE Setup ('+((a.ai_tools||'Cursor').split(', ').slice(0,3).join(' / '))+')',hrs:4,res:res((a.ai_tools||'').includes('Antigravity')?'antigravity':'cursor')},
{text:_ja?'MCP設定・活用':'MCP Configuration',hrs:6,res:res('mcp')},
{text:_ja?'AI Agent Rules最適化':'AI Agent Rules Optimization',hrs:4,res:res('claudecode')},
...(!noAI?[{text:ai+(_ja?' 実践':' Practice'),hrs:8,res:res('cursor')}]:[]),
]});
if(!noPay) layers.push({name:_ja?'Layer 6: 収益化':'Layer 6: Monetization',color:'var(--layer-6)',items:[
{text:pay+(_ja?' 実装':' Implementation'),hrs:12,res:res('stripe')},
{text:_ja?'課金フロー構築':'Billing Flow',hrs:10,res:res('stripe')},
]});
layers.push({name:_ja?'Layer 7: 駆動開発手法':'Layer 7: Dev Methodologies',color:'var(--layer-7)',items:(a.dev_methods||'TDD').split(', ').map(m=>({text:m+(_ja?' 実践':' Practice'),hrs:8,res:methRes(m)}))});
/* Apply time multiplier */
layers.forEach(l=>l.items.forEach(it=>{if(!it.wk)it.hrs=Math.round((it.hrs||8)*timeMul);}));
/* ── Load saved progress ── */
const roadState=_jp(_lsGet('devforge-road-'+S.projectName),{});
const collapseState=_jp(_lsGet('devforge-road-col-'+S.projectName),{});
layers.forEach((l,li)=>l.items.forEach((item,ii)=>{item.done=!!roadState[li+'_'+ii];}));
const totalItems=layers.reduce((s,l)=>s+l.items.length,0);
const doneItems=layers.reduce((s,l)=>s+l.items.filter(i=>i.done).length,0);
const pct=totalItems?Math.round(doneItems/totalItems*100):0;
const totalHrs=layers.reduce((s,l)=>s+l.items.reduce((a,i)=>a+(i.hrs||0),0),0);
const doneHrs=layers.reduce((s,l)=>s+l.items.filter(i=>i.done).reduce((a,i)=>a+(i.hrs||0),0),0);
const remainHrs=totalHrs-doneHrs;
/* ── Milestones ── */
const milestones=[
{at:25,icon:'🌱',ja:'学習開始！基盤を構築中',en:'Journey started! Building foundations'},
{at:50,icon:'🔥',ja:'半分達成！勢いに乗っています',en:'Halfway there! Great momentum'},
{at:75,icon:'⚡',ja:'あと少し！ゴールが見えてきました',en:'Almost there! The finish line is in sight'},
{at:100,icon:'🏆',ja:'全完了！おめでとうございます！',en:'All complete! Congratulations!'},
];
const activeMilestone=milestones.filter(m=>pct>=m.at).pop();
/* ── Render ── */
let h=`<div class="dash-head"><h3>${_ja?'🗺️ インタラクティブロードマップ':'🗺️ Interactive Roadmap'}</h3><p>${_ja?'チェックして進捗管理':'Track progress by checking items'} — ${level}</p></div>`;
/* Progress + Time */
h+=`<div class="road-progress"><h4>${_ja?'📈 全体進捗':'📈 Overall Progress'}</h4>
<div class="road-progress-bar"><div class="road-progress-fill" style="width:${pct}%"></div></div>
<div class="road-pct">${pct}% <span class="road-pct-sub">(${doneItems}/${totalItems})</span></div>
<div class="road-time">⏱️ ${_ja?'残り推定':'Est. remaining'}: <strong>${remainHrs}h</strong> / ${totalHrs}h ${_ja?'(×'+timeMul+' '+level+')':''}</div>
${activeMilestone?`<div class="road-milestone">${activeMilestone.icon} ${_ja?activeMilestone.ja:activeMilestone.en}</div>`:''}
</div>`;
/* Layers */
layers.forEach((l,li)=>{
const layerDone=l.items.filter(i=>i.done).length;
const layerPct=l.items.length?Math.round(layerDone/l.items.length*100):0;
const layerHrsLeft=l.items.filter(i=>!i.done).reduce((a,i)=>a+(i.hrs||0),0);
/* C. Dependency: previous layer must be >=80% */
const prevPct=li>0?(()=>{const pl=layers[li-1];const pd=pl.items.filter(i=>i.done).length;return pl.items.length?Math.round(pd/pl.items.length*100):100;})():100;
const locked=prevPct<80;
/* A. Collapse */
const collapsed=!!collapseState[li]||(layerPct===100&&!collapseState['_open_'+li]);
h+=`<div class="road-layer${locked?' road-locked':''}" data-li="${li}">`;
h+=`<h3 style="background:${l.color}20;color:${l.color};" class="road-layer-head" onclick="toggleRoadCollapse(${li})">`;
h+=`<span class="road-collapse-icon">${collapsed?'▶':'▼'}</span> `;
h+=locked?'🔒 ':'';
h+=`${l.name} <span class="road-layer-pct">${layerPct}%</span>`;
if(layerPct===100)h+=' 🏆';
h+=`<span class="road-layer-hrs">${layerHrsLeft>0?(layerHrsLeft+'h'):(_ja?'完了':'Done')}</span>`;
h+=`</h3>`;
if(locked){
h+=`<div class="road-lock-msg">${_ja?'🔒 前レイヤーを80%以上完了すると解放されます':'🔒 Complete previous layer to 80%+ to unlock'} (${prevPct}%)</div>`;
}
h+=`<div class="road-items${collapsed?' road-collapsed':''}" id="roadItems${li}">`;
l.items.forEach((item,ii)=>{
const id=li+'_'+ii;
const disabled=locked?' disabled':'';
h+=`<div class="road-task ${item.done?'checked':''}${locked?' road-task-locked':''}" ${locked?'':'onclick="toggleRoadItem2(\''+id+'\',this)"'}>`;
h+=`<input type="checkbox" ${item.done?'checked':''}${disabled} ${locked?'':'onclick="event.stopPropagation();toggleRoadItem2(\''+id+'\',this.parentElement)"'}>`;
h+=`<span>${esc(item.text)}</span>`;
if(item.hrs)h+=`<span class="road-hrs-badge">${item.hrs}h</span>`;
if(item.wk)h+=`<span class="road-week-badge">${item.wk}</span>`;
if(item.res)h+=`<a class="road-res-btn" href="${item.res.u}" target="_blank" rel="noopener" onclick="event.stopPropagation()" title="${item.res.n}">📖</a>`;
h+=`</div>`;
});
h+=`</div></div>`;
});
h+=`<div class="road-actions">
<button class="btn btn-s" onclick="resetRoadmap2()">${_ja?'🔄 リセット':'🔄 Reset'}</button>
<button class="btn btn-s" onclick="expandAllRoadLayers()">${_ja?'📂 全展開':'📂 Expand All'}</button>
<button class="btn btn-s" onclick="exportRoadmapMD()">${_ja?'📋 Markdownコピー':'📋 Copy Markdown'}</button>
</div>`;
body.innerHTML=h;
/* Store layers for export */
window._roadLayers=layers;
}
function toggleRoadItem2(id,el){
el.classList.toggle('checked');
const cb=el.querySelector('input[type="checkbox"]');
if(cb)cb.checked=el.classList.contains('checked');
const roadState=_jp(_lsGet('devforge-road-'+S.projectName),{});
roadState[id]=el.classList.contains('checked');
_lsSet('devforge-road-'+S.projectName,JSON.stringify(roadState));
/* Update progress bar */
const tasks=document.querySelectorAll('.road-task:not(.road-task-locked)');
const done=document.querySelectorAll('.road-task.checked:not(.road-task-locked)');
const pct=tasks.length?Math.round(done.length/tasks.length*100):0;
const bar=document.querySelector('.road-progress-fill');if(bar)bar.style.width=pct+'%';
const pctEl=document.querySelector('.road-pct');if(pctEl)pctEl.innerHTML=`${pct}% <span class="road-pct-sub">(${done.length}/${tasks.length})</span>`;
/* Check layer completion & milestone */
const li=id.split('_')[0];
const layer=document.querySelector('.road-layer[data-li="'+li+'"]');
if(layer){
const lt=layer.querySelectorAll('.road-task');const ld=layer.querySelectorAll('.road-task.checked');
const lp=lt.length?Math.round(ld.length/lt.length*100):0;
const hdr=layer.querySelector('.road-layer-pct');if(hdr)hdr.textContent=lp+'%';
/* Badge animation on layer 100% */
if(lp===100&&!layer.querySelector('.road-badge-anim')){
const badge=document.createElement('span');badge.className='road-badge-anim';badge.textContent='🏆';
const h3=layer.querySelector('h3');if(h3)h3.appendChild(badge);
}
}
/* Check milestone */
const _ja=S.lang==='ja';
const ms=[{at:25,icon:'🌱',t:_ja?'25% 達成！':'25% reached!'},{at:50,icon:'🔥',t:_ja?'50% 達成！':'50% reached!'},{at:75,icon:'⚡',t:_ja?'75% 達成！':'75% reached!'},{at:100,icon:'🏆',t:_ja?'全完了！🎉':'All complete! 🎉'}];
const prev=parseInt(roadState._lastPct||'0');
ms.forEach(m=>{if(pct>=m.at&&prev<m.at)toast(m.icon+' '+m.t);});
roadState._lastPct=pct;
_lsSet('devforge-road-'+S.projectName,JSON.stringify(roadState));
/* Re-check dependency locks (full re-render for simplicity) */
clearTimeout(window._roadDebounce);
window._roadDebounce=setTimeout(()=>showRoadmapUI(),300);
}
function toggleRoadCollapse(li){
const colState=_jp(_lsGet('devforge-road-col-'+S.projectName),{});
const items=$('roadItems'+li);
if(!items)return;
const isCollapsed=items.classList.contains('road-collapsed');
items.classList.toggle('road-collapsed');
const icon=items.parentElement.querySelector('.road-collapse-icon');
if(icon)icon.textContent=isCollapsed?'▼':'▶';
if(isCollapsed){colState['_open_'+li]=true;delete colState[li];}
else{colState[li]=true;delete colState['_open_'+li];}
_lsSet('devforge-road-col-'+S.projectName,JSON.stringify(colState));
}
function expandAllRoadLayers(){
_lsRm('devforge-road-col-'+S.projectName);
showRoadmapUI();
}
function exportRoadmapMD(){
const _ja=S.lang==='ja';
const layers=window._roadLayers;if(!layers)return;
let md='# '+(_ja?'ロードマップ':'Roadmap')+' — '+S.projectName+'\n\n';
layers.forEach(l=>{
const done=l.items.filter(i=>i.done).length;
md+='## '+l.name+' ('+done+'/'+l.items.length+')\n';
l.items.forEach(it=>{
md+='- ['+(it.done?'x':' ')+'] '+it.text+(it.hrs?' ('+it.hrs+'h)':'')+(it.wk?' — '+it.wk:'')+'\n';
});
md+='\n';
});
navigator.clipboard.writeText(md).then(()=>toast(_ja?'✅ Markdownをコピーしました':'✅ Markdown copied')).catch(()=>toast(_ja?'❌ コピー失敗':'❌ Copy failed'));
}
function resetRoadmap2(){
_lsRm('devforge-road-'+S.projectName);
_lsRm('devforge-road-col-'+S.projectName);
showRoadmapUI();
}
/* ── Template Save/Load ── */
function saveTemplate(){
const _ja=S.lang==='ja';
const templates=JSON.parse(_lsGet('devforge-templates')||'[]');
const tpl={name:S.projectName,answers:{...S.answers},preset:S.preset,date:new Date().toISOString()};
templates.push(tpl);
_lsSet('devforge-templates',JSON.stringify(templates));
addMsg('bot',_ja?`💾 テンプレート「${S.projectName}」を保存しました。次回起動時に読み込めます。`:`💾 Template "${S.projectName}" saved. Load it next time.`);
}
function loadTemplateList(){
const templates=JSON.parse(_lsGet('devforge-templates')||'[]');
if(templates.length===0)return;
const row=$('presetRow');
templates.forEach((tpl,i)=>{
const c=document.createElement('div');c.className='prchip';
c.textContent='💾 '+tpl.name;
c.onclick=()=>{
S.preset='custom';S.answers={...tpl.answers};
$('nameIn').value=tpl.name;
document.querySelectorAll('.prchip').forEach(x=>x.classList.remove('on'));c.classList.add('on');
};
row.appendChild(c);
});
}
/* ── URL State Sharing ── */
function shareURL(){
const _ja=S.lang==='ja';
const data={p:S.projectName,a:S.answers,pr:S.preset};
const encoded=btoa(unescape(encodeURIComponent(JSON.stringify(data))));
const url=location.origin+location.pathname+'#df='+encoded;
navigator.clipboard.writeText(url).then(()=>{
addMsg('bot',_ja?`🔗 URLをクリップボードにコピーしました。このURLを共有すると同じ設定で開けます。`:`🔗 URL copied to clipboard. Share it to open with the same settings.`);
}).catch(()=>{
addMsg('bot',`🔗 ${_ja?'共有URL':'Share URL'}:\n${url}`);
});
}
// ── Context-Aware Guide Data ──
const DOMAIN_FIRST_STEPS={
fintech:{ja:['security.md確認 (PCI DSS/KYC)','認証+MFA設定','決済フロー実装'],en:['Review security.md (PCI DSS/KYC)','Setup Auth+MFA','Implement payment flow']},
health:{ja:['security.md→HIPAA対応','Auth+RBAC設定','ERスキーマ検証'],en:['Review security.md→HIPAA','Auth+RBAC setup','Verify ER schema']},
education:{ja:['specification.mdで学習フロー確認','CLAUDE.md→AI投入','reverse_engineering.mdで逆算'],en:['Review specification.md learning flow','Feed CLAUDE.md→AI','Use reverse_engineering.md']},
ec:{ja:['security.md+決済フロー','ER.mdでProduct/Order確認','test_cases.mdで決済テスト'],en:['Review security.md+payment','Check ER.md Product/Order','Test payment via test_cases.md']},
saas:{ja:['security.md→テナント分離','specification.md→課金設計','CLAUDE.md→AI開発'],en:['Review security.md→multi-tenancy','Spec.md→billing design','CLAUDE.md→AI dev']},
_default:{ja:['CLAUDE.md→AI投入','specification.md要件確認','tasks.mdタスク計画'],en:['Feed CLAUDE.md→AI','Review specification.md','Plan with tasks.md']}
};
const AI_TOOL_RECIPES={
Cursor:{ja:['Step 1: .cursor/rules配置','Step 2: Ctrl+Shift+I Agent起動','Step 3: tasks.mdから指示'],en:['Step 1: Place .cursor/rules','Step 2: Ctrl+Shift+I Agent','Step 3: Instruct from tasks.md']},
'Claude Code':{ja:['Step 1: CLAUDE.md自動読込','Step 2: /init初期化','Step 3: AI_BRIEF.md→仕様順投入'],en:['Step 1: CLAUDE.md auto-loaded','Step 2: /init','Step 3: Feed AI_BRIEF.md→specs']},
Copilot:{ja:['Step 1: copilot-instructions.md配置','Step 2: Tab補完+Chat','Step 3: #fileでコンテキスト指定'],en:['Step 1: Place copilot-instructions.md','Step 2: Tab+Chat','Step 3: Use #file context']},
Windsurf:{ja:['Step 1: .windsurfrules自動読込','Step 2: Cascadeモード起動','Step 3: MCP設定で拡張'],en:['Step 1: .windsurfrules auto-loaded','Step 2: Launch Cascade','Step 3: Extend with MCP']},
_default:{ja:['Step 1: CLAUDE.md貼り付け','Step 2: Ctrl+Shift+C全コピー','Step 3: tasks.md順に指示'],en:['Step 1: Paste CLAUDE.md','Step 2: Ctrl+Shift+C copy all','Step 3: Instruct via tasks.md']}
};
function getADRs(a,_ja){
const adrs=[];
if(inc(a.backend,'Supabase'))adrs.push({icon:'🔐',t:_ja?'Auth: Supabase Auth (RLS)':'Auth: Supabase Auth (RLS)',d:_ja?'PostgreSQL行レベルセキュリティ':'PostgreSQL row-level security'});
if(inc(a.backend,'Firebase'))adrs.push({icon:'🔐',t:_ja?'Auth: Firebase Auth':'Auth: Firebase Auth',d:_ja?'Firestoreルールで制御':'Controlled via Firestore rules'});
if(inc(a.frontend,'Next'))adrs.push({icon:'🖥',t:_ja?'Rendering: SSR/ISR':'Rendering: SSR/ISR',d:_ja?'SEO→SSR, 動的→ISR, 管理→CSR':'SEO→SSR, dynamic→ISR, admin→CSR'});
if(inc(a.frontend,'Vite')||inc(a.frontend,'SPA'))adrs.push({icon:'🖥',t:_ja?'Rendering: SPA (CSR)':'Rendering: SPA (CSR)',d:_ja?'クライアントサイドレンダリング':'Client-side rendering'});
if(inc(a.deploy,'Railway'))adrs.push({icon:'☁',t:_ja?'Deploy: 分離型':'Deploy: Decoupled',d:_ja?'FE/BE独立スケーリング':'Independent FE/BE scaling'});
if(inc(a.database,'PostgreSQL'))adrs.push({icon:'🗃',t:_ja?'DB: PostgreSQL':'DB: PostgreSQL',d:_ja?'ACID準拠、JSON対応':'ACID compliant, JSON support'});
if(inc(a.payment,'Stripe'))adrs.push({icon:'💳',t:_ja?'Payment: Stripe':'Payment: Stripe',d:_ja?'Checkout→Webhook→非同期確定':'Checkout→Webhook→async confirm'});
return adrs;
}
function showManual(sec){
const o=$('helpOverlay');o.classList.add('show');
pushModal(o,()=>{o.classList.remove('show');releaseFocus(o);});
const _ja=S.lang==='ja';
const MANUAL=[
{id:'overview',title:_ja?'概要':'Overview',body:_ja?'<h2>DevForge v9.0 とは</h2><p>質問に答えるだけで、プロジェクトに必要な93+ファイルを自動生成するAI駆動開発プラットフォームです。'+_TECH_COUNT+'テクノロジー対応。</p>'+
'<h3>13の柱</h3><table><tr><th>柱</th><th>内容</th><th>ファイル数</th></tr><tr><td>①SDD統合</td><td>Spec Kit互換の仕様書</td><td>5</td></tr><tr><td>②DevContainer</td><td>Docker開発環境</td><td>4</td></tr><tr><td>③MCP設定</td><td>Model Context Protocol</td><td>3</td></tr><tr><td>④AIルール</td><td>10+ツール設定+スキル</td><td>10+</td></tr>'+
'<tr><td>⑤並列探索</td><td>スタック比較+おすすめランキング</td><td>UI</td></tr><tr><td>⑥Dashboard</td><td>コンテキスト可視化+技術DB</td><td>UI</td></tr><tr><td>⑦ロードマップ</td><td>学習パス（インタラクティブ）</td><td>9+UI</td></tr><tr><td>⑧AIランチャー</td><td>プロンプトテンプレート+トークン推定</td><td>UI</td></tr><tr><td>⑨デザインシステム</td><td>デザイントークン+シーケンス図</td><td>2</td></tr><tr><td>⑩リバースEng</td><td>ゴール逆算型プランニング</td><td>2</td></tr><tr><td>⑪実装ガイド</td><td>業種別実装パターン+AI運用手順</td><td>3</td></tr><tr><td>⑫セキュリティ</td><td>OWASP・STRIDE・コンプライアンス</td><td>5</td></tr><tr><td>⑬戦略インテリジェンス</td><td>業種別設計図・技術レーダー・ステークホルダー戦略・先端シナリオ</td><td>5</td></tr></table>'+
'<p>+ docs（40仕様書）+ 共通ファイル（4）= <strong>93+ファイル</strong></p>':'<h2>What is DevForge v9.0?</h2><p>An AI-driven dev platform that auto-generates 93+ project files just by answering questions. Supports '+_TECH_COUNT+' technologies.</p>'+
'<h3>13 Pillars</h3><table><tr><th>Pillar</th><th>Content</th><th>Files</th></tr><tr><td>①SDD</td><td>Spec Kit compatible specs</td><td>5</td></tr><tr><td>②DevContainer</td><td>Docker dev environment</td><td>4</td></tr><tr><td>③MCP</td><td>Model Context Protocol</td><td>3</td></tr><tr><td>④AI Rules</td><td>10+ tool configs + skills</td><td>10+</td></tr>'+
''+
'<tr><td>⑤Explorer</td><td>Stack comparison + recommendation</td><td>UI</td></tr><tr><td>⑥Dashboard</td><td>Context visualization + Tech DB</td><td>UI</td></tr><tr><td>⑦Roadmap</td><td>Learning path (interactive)</td><td>9+UI</td></tr><tr><td>⑧AI Launcher</td><td>Prompt templates + token estimation</td><td>UI</td></tr><tr><td>⑨Design System</td><td>Design tokens + Sequence diagrams</td><td>2</td></tr><tr><td>⑩Reverse Eng</td><td>Goal-driven reverse planning</td><td>2</td></tr><tr><td>⑪Impl Guide</td><td>Domain-specific impl patterns + AI runbook</td><td>3</td></tr><tr><td>⑫Security</td><td>OWASP, STRIDE, Compliance</td><td>5</td></tr><tr><td>⑬Strategic Intelligence</td><td>Industry blueprint, Tech radar, Stakeholder strategy, Advanced scenarios</td><td>5</td></tr></table>'+
'<p>+ docs (40 specs) + common (4) = <strong>93+ files</strong></p>'},
{id:'start',title:_ja?'はじめ方':'Getting Started',body:_ja?
'<h2>はじめ方</h2><p>1. スキルレベルを選択（Beginner/Intermediate/Pro）<br>2. プロジェクト名を入力<br>3. テンプレート選択（任意・41種類）<br>4. Phase 1-3の質問に回答（スキップ＆後で回答可）<br>5. 生成ボタンで93+ファイル作成<br>6. ZIPダウンロードまたはPDF印刷</p>'+
'<h3>UX機能</h3>'+
'<p>• 🌱⚡🔥 スキルレベルで質問の選択肢が動的変化<br>• 🎯 41プリセットテンプレート<br>• ✎ 回答の編集（✎ボタン）<br>• ⏭️ スキップ＆後で回答<br>• 📊 複雑度分析（0-100スコア）<br>• 📁 プロジェクト管理（Ctrl+M）<br>• 🎙️ 音声入力<br>• ? 質問ごとのヘルプアイコン<br>• 🔀 ドラッグ&ドロップ優先度ソート</p>'+
'<h3>V8 新機能</h3>'+
'<p>• 📱 モバイル開発パス (Expo/React Native)<br>• 🤖 AI自律開発ガイド (Vibe Coding/マルチAgent)<br>• 💳 決済・CMS・EC統合ガイド<br>• ⚡ 並列スタック比較 (7パターン)<br>• 📊 技術マスターテーブル / Tech Master Table ('+_TECH_COUNT+' entries)<br>• 🗺️ インタラクティブロードマップ (進捗管理)</p>'+
'<h3>V8.3 新機能</h3>'+
'<p>• 📊 Mermaid図ライブレンダリング (ER図・画面遷移・ガント)<br>• 📝 OpenAPI準拠API仕様書<br>• ✅ テストケースマトリクス (機能×正常/異常)<br>• 📋 リリースチェックリスト (デプロイ先別動的生成)<br>• 🔨 WBS 3階層+工数見積り<br>• 🎯 プロンプトプレイブック (フェーズ別AI投入プロンプト集)<br>• 📎 GitHub Issues風タスク分解<br>• 📋 全ファイル結合コピー (AI一括投入用)</p>'+
'<h3>V9 新機能</h3>'+
'<p>• 🧪 品質インテリジェンスエンジン (業種別QA戦略・テストマトリクス・インシデント対応)<br>• 🎨 デザインシステム自動生成 (デザイントークン・シーケンス図)<br>• 🔄 リバースエンジニアリング (ゴール逆算型プランニング・24ドメイン対応)<br>• 🏗️ 実装インテリジェンス (業種別実装パターン・AI運用手順書・擬似コード)<br>• 🧠 AI開発OS (コンテキスト圧縮・ファイル選択マトリクス・サブエージェント分離)<br>• 🌐 24ドメイン対応 (AI, IoT, 不動産, 法務, 人事, 金融 等を追加)<br>• 📦 93+ファイル生成 (docs 40種, AIルール12+, スキル8+)<br>• 🎯 41プリセット (CRM, SNS, 物流, アンケート, 求人 追加)</p>'+
'<p class="workflow-ref">📘 <strong>生成後の手順は <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">生成後ワークフローガイド</a> を参照</strong></p>'
:
'<h2>Getting Started</h2><p>1. Select your skill level (Beginner/Intermediate/Pro)<br>2. Enter project name<br>3. Choose a template (optional, 41 types)<br>4. Answer Phase 1-3 questions (skip & answer later OK)<br>5. Click Generate for 93+ files<br>6. Download ZIP or print PDF</p>'+
'<h3>UX Features</h3>'+
'<p>• 🌱⚡🔥 Dynamic options by skill level<br>• 🎯 41 preset templates<br>• ✎ Edit answers (✎ button)<br>• ⏭️ Skip & answer later<br>• 📊 Complexity analysis (0-100 score)<br>• 📁 Project manager (Ctrl+M)<br>• 🎙️ Voice input<br>• ? Help icon per question<br>• 🔀 Drag & drop priority sort</p>'+
'<h3>V8 Features</h3>'+
'<p>• 📱 Mobile dev path (Expo/React Native)<br>• 🤖 AI autonomous guide (Vibe Coding/Multi-Agent)<br>• 💳 Payment/CMS/EC integration<br>• ⚡ Parallel stack comparison (7 patterns)<br>• 📊 Tech Master Table ('+_TECH_COUNT+' entries)<br>• 🗺️ Interactive roadmap (progress tracking)</p>'+
'<h3>V8.3 Features</h3>'+
'<p>• 📊 Mermaid diagram live rendering (ER/screen flow/Gantt)<br>• 📝 OpenAPI-compliant API specs<br>• ✅ Test case matrix (feature × normal/abnormal)<br>• 📋 Release checklist (per deploy target)<br>• 🔨 WBS 3-level + effort estimation<br>• 🎯 Prompt playbook (phase-specific AI prompts)<br>• 📎 GitHub Issues-style task breakdown<br>• 📋 Copy all files combined (for bulk AI input)</p>'+
'<h3>V9 Features</h3>'+
'<p>• 🧪 Quality Intelligence Engine (industry-specific QA strategies, test matrix, incident response)<br>• 🎨 Design System generation (design tokens, sequence diagrams)<br>• 🔄 Reverse Engineering (goal-driven reverse planning, 24 domains)<br>• 🏗️ Implementation Intelligence (domain-specific impl patterns, AI runbook, pseudo-code)<br>• 🧠 AI Development OS (context compression, file selection matrix, sub-agent isolation)<br>• 🌐 24 domain support (AI, IoT, Real Estate, Legal, HR, FinTech added)<br>• 📦 93+ file generation (40 docs, 12+ AI rules, 8+ skills)<br>• 🎯 41 presets (CRM, Social, Logistics, Survey, Job Board added)</p>'+
'<p class="workflow-ref">📘 <strong>For post-generation workflow, see <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">Post-Gen Workflow Guide</a></strong></p>'
},
{id:'pillars',title:_ja?'13の柱':'13 Pillars',body:_ja?
'<h2>13の柱の詳細</h2><h3>① SDD統合 (5ファイル)</h3>'+
'<p>constitution.md / specification.md / technical-plan.md / tasks.md / verification.md</p>'+
'<h3>② DevContainer (4ファイル)</h3>'+
'<p>devcontainer.json / Dockerfile / docker-compose.yml / post-create.sh — VSCode/Cursorで開くだけ。</p>'+
'<h3>③ MCP設定 (3ファイル)</h3>'+
'<p>project-context.md / tools-manifest.json / mcp-config.json</p>'+
'<h3>④ AIルール (12+ファイル)</h3>'+
'<p>Cursor / Antigravity / Claude Code (CLAUDE.md, AGENTS.md) / Copilot / Windsurf / Cline / Kiro / Codex / Skills (project/catalog/pipelines) / Hooks</p>'+
'<h3>⑤ 並列実装探索 (UI)</h3>'+
'<p>7パターンのスタックを2つ選んで比較。開発速度・スケーラビリティ・学習容易性・エコシステムで評価。</p>'+
'<h3>⑥ Context Dashboard (UI)</h3>'+
'<p>トークン数・モデル適合度・ファイルサイズ分布・技術マスターテーブル('+_TECH_COUNT+')を一覧表示。</p>'+
'<h3>⑦ ロードマップ (9ファイル+UI)</h3>'+
'<p>LEARNING_PATH / TECH_STACK_GUIDE / MOBILE_GUIDE / TOOLS_SETUP / RESOURCES / MILESTONES / AI_WORKFLOW / AI_AUTONOMOUS / SAAS_COMMERCE_GUIDE — インタラクティブUIで進捗管理可能。</p>'+
'<h3>⑧ AIプロンプトランチャー (UI)</h3>'+
'<p>生成した仕様書をAIツールに一括投入。20のプロンプトテンプレート（レビュー・実装・テスト・リファクタ・セキュリティ・ドキュメント・QA・デバッグ・アーキテクチャ・パフォーマンス・API統合・アクセシビリティ・マイグレーション・メトリクス・i18n・グロース・リバースエンジニアリング・インシデント対応・オンボーディング・CI/CD設計）。フォルダ別トークン推定・モデル適合度表示。<strong>詳細は「📋 プロンプトマニュアル」参照</strong>。</p>'+
'<h3>⑨ デザインシステム (2ファイル)</h3>'+
'<p>design_system.md (デザイントークン・色・タイポ・コンポーネントカタログ) / sequence_diagrams.md (認証・CRUD・決済フローのMermaidシーケンス図) — フレームワーク別実装ガイド。</p>'+
'<h3>⑩ リバースエンジニアリング (2ファイル)</h3>'+
'<p>reverse_engineering.md (ゴール定義→逆算フロー・マイルストーンGantt・リスク分析) / goal_decomposition.md (ゴールツリー・サブゴール分解・ギャップ分析・優先度マトリクス・依存関係チェーン) — 24ドメイン対応の逆算型プランニング。</p>'+
'<h3>⑪ 実装インテリジェンス (4ファイル)</h3>'+
'<p>implementation_playbook.md (業種別実装パターン・擬似コード・スタック固有ガイダンス・横断的関心事チェックリスト) / ai_dev_runbook.md (AI運用ワークフロー・コンテキスト管理・エラー復旧プロトコル) / skill_guide.md (スキルレベル別使用ガイド・注意事項・チェックリスト) / impl-patterns.md (Manus Skills形式の実装スキルカタログ、ai_auto≠noneの場合) — 24ドメイン対応の実装ガイド。</p>'+
'<h3>⑫ セキュリティインテリジェンス (5ファイル)</h3>'+
'<p>security_intelligence.md (OWASP Top 10 2025監査・セキュリティヘッダー・責任分界・シークレット管理・認証セキュリティ) / threat_model.md (STRIDEエンティティ別脅威分析・攻撃対象領域・対策マトリクス) / compliance_matrix.md (PCI DSS・HIPAA・GDPR・ISMAP・SOC 2・FERPAドメイン別チェックリスト) / ai_security.md (AI生成コードレビュー・パッケージ幻覚検知・敵対的AIプロンプト・Agent Security) / security_testing.md (RLSテスト・Zodスキーマ・IDORテスト・OWASP ZAP設定・ペネトレーションテストチェックリスト) — スタック適応型セキュリティ自動生成エンジン。</p>'+
'<h3>⑬ 戦略インテリジェンス (4ファイル)</h3>'+
'<p>industry_blueprint.md (業種別規制・推奨アーキテクチャ・失敗要因・ビジネスモデル比較) / tech_radar.md (2026-2030技術トレンドレーダー・Adopt/Trial/Assess/Hold分類・スタック進化ロードマップ) / stakeholder_strategy.md (ステークホルダー別開発戦略・技術的負債管理・チーム構成・予算配分ガイド) / operational_excellence.md (技術的負債管理フレームワーク・DR/BCP・Green IT・Conway\'s Law対応チーム設計) — 24ドメイン対応の業種別戦略インテリジェンス。世界唯一の戦略ドキュメント自動生成エンジン。</p>'
:
'<h2>13 Pillars in Detail</h2><h3>① SDD Integration (5 files)</h3>'+
'<p>constitution.md / specification.md / technical-plan.md / tasks.md / verification.md</p>'+
'<h3>② DevContainer (4 files)</h3>'+
'<p>devcontainer.json / Dockerfile / docker-compose.yml / post-create.sh — Just open in VS Code/Cursor.</p>'+
'<h3>③ MCP Config (3 files)</h3>'+
'<p>project-context.md / tools-manifest.json / mcp-config.json</p>'+
'<h3>④ AI Rules (12+ files)</h3>'+
'<p>Cursor / Antigravity / Claude Code (CLAUDE.md, AGENTS.md) / Copilot / Windsurf / Cline / Kiro / Codex / Skills (project/catalog/pipelines) / Hooks</p>'+
'<h3>⑤ Parallel Explorer (UI)</h3>'+
'<p>Compare 2 of 7 stack patterns. Scored by dev speed, scalability, learning curve, and ecosystem.</p>'+
'<h3>⑥ Context Dashboard (UI)</h3>'+
'<p>Token counts, model fit, file size distribution, and Tech Master Table ('+_TECH_COUNT+') at a glance.</p>'+
'<h3>⑦ Roadmap (9 files + UI)</h3>'+
'<p>LEARNING_PATH / TECH_STACK_GUIDE / MOBILE_GUIDE / TOOLS_SETUP / RESOURCES / MILESTONES / AI_WORKFLOW / AI_AUTONOMOUS / SAAS_COMMERCE_GUIDE — Interactive UI for progress tracking.</p>'+
'<h3>⑧ AI Prompt Launcher (UI)</h3>'+
'<p>Bulk-feed generated specs to AI tools. 20 prompt templates (Review, Implement, Test, Refactor, Security, Docs, QA, Debug, Architecture, Performance, API, Accessibility, Migration, Metrics, i18n, Growth, Reverse Engineering, Incident Response, Onboarding, CI/CD Design). Per-folder token estimation and model fit display. <strong>See "📋 Prompt Manual" for details</strong>.</p>'+
'<h3>⑨ Design System (2 files)</h3>'+
'<p>design_system.md (design tokens, colors, typography, component catalog) / sequence_diagrams.md (auth, CRUD, payment Mermaid sequence diagrams) — Framework-specific guides.</p>'+
'<h3>⑩ Reverse Engineering (2 files)</h3>'+
'<p>reverse_engineering.md (goal definition → reverse flow, milestone Gantt, risk analysis) / goal_decomposition.md (goal tree, sub-goal breakdown, gap analysis, priority matrix, dependency chain) — 24 domain-specific reverse planning.</p>'+
'<h3>⑪ Implementation Intelligence (4 files)</h3>'+
'<p>implementation_playbook.md (domain-specific impl patterns, pseudo-code, stack guidance, cross-cutting concerns checklist) / ai_dev_runbook.md (AI operation workflow, context management, error recovery protocol) / skill_guide.md (skill-level usage guide, cautions, checklists) / impl-patterns.md (implementation skills in Manus Skills format, if ai_auto≠none) — 24 domain-specific implementation guide.</p>'+
'<h3>⑫ Security Intelligence (5 files)</h3>'+
'<p>security_intelligence.md (OWASP Top 10 2025 audit, security headers, shared responsibility model, secrets management, auth security) / threat_model.md (STRIDE entity threat analysis, attack surface, mitigation matrix) / compliance_matrix.md (PCI DSS, HIPAA, GDPR, ISMAP, SOC 2, FERPA domain-specific checklists) / ai_security.md (AI-generated code review, package hallucination detection, adversarial AI prompts, agent security) / security_testing.md (RLS tests, Zod schemas, IDOR tests, OWASP ZAP config, penetration testing checklist) — Stack-adaptive security auto-generation engine.</p>'+
'<h3>⑬ Strategic Intelligence (4 files)</h3>'+
'<p>industry_blueprint.md (industry regulations, recommended architecture, failure factors, business model comparison) / tech_radar.md (2026-2030 tech trend radar, Adopt/Trial/Assess/Hold classification, stack evolution roadmap) / stakeholder_strategy.md (stakeholder-specific dev strategy, tech debt management, team composition, budget allocation guide) / operational_excellence.md (tech debt management framework, DR/BCP, Green IT, Conway\'s Law team design) — 24 domain-specific industry strategic intelligence. World\'s only strategic document auto-generation engine.</p>'
},
{id:'export',title:_ja?'エクスポート':'Export',body:_ja?
'<h2>エクスポート方法</h2><p><strong>ZIP</strong>: 全93+ファイルをフォルダ構造付きでZIP圧縮ダウンロード。<br><strong>PDF</strong>: Markdownファイルを整形してブラウザのPDF印刷で出力。<br><strong>URL共有</strong>: プロジェクト設定をBase64エンコードしてURL共有。<br><strong>全ファイルコピー</strong>: 全ドキュメントを1テキストに結合してクリップボードにコピー（Ctrl+Shift+C）。AIへの一括投入に最適。</p><h3>テンプレート保存</h3><p>プロジェクト設定をlocalStorageに保存し、次回起動時に読み込み可能。</p>'+
'<p class="workflow-ref">📘 <strong>エクスポート後の開発手順は <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">生成後ワークフローガイド</a> を参照</strong></p>'
:
'<h2>Export Methods</h2><p><strong>ZIP</strong>: Download all 93+ files as a ZIP with folder structure.<br><strong>PDF</strong>: Format Markdown files and print via browser PDF.<br><strong>URL Sharing</strong>: Base64-encode project settings and share via URL.<br><strong>Copy All Files</strong>: Combine all documents into one text and copy to clipboard (Ctrl+Shift+C). Ideal for bulk AI input.</p><h3>Template Save</h3><p>Save project settings to localStorage and load them on next launch.</p>'+
'<p class="workflow-ref">📘 <strong>For development workflow after export, see <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">Post-Gen Workflow Guide</a></strong></p>'
},
{id:'guide',title:_ja?'🚀 活用ガイド':'🚀 Usage Guide',body:function(){
const baseBody=_ja?
'<h2>🚀 生成ファイル活用ガイド</h2>'+
'<p>DevForge v9 は世界で唯一の<strong>仕様駆動AIプロジェクトジェネレーター</strong>です。他のツールが「コード」を生成するのに対し、DevForge は「開発の知性」── 設計・環境・ルール・学習計画を93+ファイルで生成します。</p>'+
'<h3>🌱 Beginner — まず動かす</h3>'+
'<p><strong>Step 1: ロードマップに従う</strong><br>ダッシュボード（柱⑦）のロードマップUIがそのまま学習計画。Layer 1から順にチェック。📖ボタンで公式ドキュメントに直接ジャンプ。</p>'+
'<p><strong>Step 2: 3つだけ覚える</strong><br>• <code>README.md</code> — GitHubにそのまま公開OK<br>• <code>.devcontainer/</code> — VS Code/Cursorで開くだけで環境完成<br>• <code>CLAUDE.md</code> — AIに「これ読んで」で全仕様を理解</p>'+
'<p><strong>Step 3: AIに丸ごと渡す</strong><br>「全ファイルコピー」(Ctrl+Shift+C) → AI に貼り付け → 仕様を把握した状態で開発スタート。</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>生成</span><span class="hg-a">→</span><span class="hg-n hg-c">Ctrl+Shift+C<br>コピー</span><span class="hg-a">→</span><span class="hg-n hg-p">AI貼付<br>Cursor等</span><span class="hg-a">→</span><span class="hg-n hg-g">開発<br>スタート</span></div>'+
'<h3>🔥 Intermediate — 効率を極める</h3>'+
'<p><strong>SDD仕様駆動開発:</strong> <code>.spec/</code> がプロジェクトのSSoT（信頼できる唯一の情報源）。constitution.md(憲法) → specification.md(要件) → tasks.md(タスク) → verification.md(完了基準)。AIへの指示は「tasks.mdの○○を実装して」の一文で完結。</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">constitution<br>原則</span><span class="hg-a">→</span><span class="hg-n hg-c">specification<br>要件</span><span class="hg-a">→</span><span class="hg-n hg-p">tasks<br>タスク</span><span class="hg-a">→</span><span class="hg-n hg-g">verification<br>完了基準</span></div>'+
'<p><strong>マルチAIツール統一:</strong> 柱④で生成される10ファイルがCursor/.cursor/rules、Claude Code/CLAUDE.md、Copilot/.github/copilot-instructions.md、Windsurf/.windsurfrules、Cline/.clinerules、Gemini/.gemini/settings.json等を同時カバー。どのツールに乗り換えても同じルール。</p>'+
'<p><strong>MCP拡張:</strong> mcp-config.jsonをプロジェクトルートに配置 → context7(最新ドキュメント)、filesystem(構造把握)、playwright(E2Eテスト)等をAIが即利用。</p>'+
'<h3>⚡ Professional — 自動化を支配する</h3>'+
'<p><strong>Agent Teams並列開発:</strong> AGENTS.mdでエージェント役割を定義 → Claude Code Subagents / Antigravity Manager View で並列実行。tasks.mdがタスクキューとして機能。</p>'+
'<p><strong>CI/CDゲート化:</strong> .ai/hooks.yml → GitHub Actions変換。docs/09_release_checklist.mdをデプロイゲートに。verification.mdを品質基準に。</p>'+
'<p><strong>開発パイプライン:</strong> 柱⑧の20テンプレートを活用 → 📋仕様レビュー → 🔨実装 → 🧪テスト → ♻️リファクタ → 🔒セキュリティ → 📝ドキュメント更新。+ 🔧デバッグ・📐アーキテクチャ・⚡パフォーマンス等の専門テンプレートも利用可能。仕様書が全工程の入力。<strong>（📖 詳細はプロンプトマニュアル参照）</strong></p>'+
'<h3>⚔️ 他ツールとの比較</h3>'+
'<table><tr><th>機能</th><th>DevForge v9</th><th>create-next-app</th><th>AI直接依頼</th></tr>'+
'<tr><td>SDD仕様書5点</td><td>✅ 自動</td><td>✗</td><td>△ 手動</td></tr>'+
'<tr><td>10ツールAIルール</td><td>✅ 自動</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>互換性チェック</td><td>✅ 自動</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>ロードマップ</td><td>✅ 自動</td><td>✗</td><td>△ 手動</td></tr>'+
'<tr><td>DevContainer</td><td>✅ 自動</td><td>✗</td><td>△ 手動</td></tr>'+
'<tr><td>MCP+Agent設定</td><td>✅ 自動</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>'+_TECH_COUNT+' Tech DB</td><td>✅ 内蔵</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>オフライン動作</td><td>✅</td><td>✅</td><td>✗</td></tr></table>'+
'<h3>📋 ファイル活用マップ</h3>'+
'<table><tr><th>ファイル</th><th>🌱初心者</th><th>🔥中級者</th><th>⚡上級者</th></tr>'+
'<tr><td><code>CLAUDE.md</code></td><td>そのまま</td><td>カスタマイズ</td><td>Agent共有設定</td></tr>'+
'<tr><td><code>.spec/</code></td><td>読むだけ</td><td>AIに1つずつ</td><td>タスクキュー化</td></tr>'+
'<tr><td><code>.devcontainer/</code></td><td>そのまま</td><td>カスタマイズ</td><td>チーム標準化</td></tr>'+
'<tr><td><code>roadmap/</code></td><td>学習ガイド</td><td>進捗管理</td><td>オンボーディング</td></tr>'+
'<tr><td><code>docs/</code> 40ファイル</td><td>後で参照</td><td>レビュー素材</td><td>CI/CDゲート</td></tr>'+
'<tr><td><code>docs/29_reverse_engineering</code></td><td>読むだけ</td><td>逆算計画</td><td>マイルストーン管理</td></tr>'+
'<tr><td><code>docs/30_goal_decomposition</code></td><td>後で参照</td><td>優先順位付け</td><td>タスク依存分析</td></tr>'+
'<tr><td>柱④ AIルール</td><td>触らない</td><td>ルール追加</td><td>全ツール統一</td></tr>'+
'<tr><td>柱⑧ ランチャー</td><td>使わない</td><td>部分利用</td><td>全工程自動化</td></tr>'+
'<tr><td><code>.mcp/ + config</code></td><td>後で</td><td>そのまま</td><td>カスタムMCP</td></tr>'+
'<tr><td><code>AGENTS.md</code></td><td>不要</td><td>参照</td><td>並列Agent</td></tr>'+
'<tr><td><code>.ai/hooks.yml</code></td><td>不要</td><td>参照</td><td>CI/CD統合</td></tr></table>'+
'<p class="guide-action-p"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 レベル別ガイドを表示</button> <button class="btn btn-s btn-sm" onclick="showManual(\'workflow\')">📘 生成後ワークフロー</button></p>':
'<h2>🚀 Generated Files Usage Guide</h2>'+
'<p>DevForge v9 is the world\'s only <strong>spec-driven AI project generator</strong>. While other tools generate code, DevForge generates "development intelligence" — design, environment, rules, and learning plans through 93+ files.</p>'+
'<h3>🌱 Beginner — Get Started</h3>'+
'<p><strong>Step 1: Follow the Roadmap</strong><br>The Dashboard (Pillar ⑦) roadmap UI is your learning plan. Check off from Layer 1. Hit 📖 to jump to official docs.</p>'+
'<p><strong>Step 2: Remember Just 3 Files</strong><br>• <code>README.md</code> — Publish directly to GitHub<br>• <code>.devcontainer/</code> — Open in VS Code/Cursor and dev env is ready<br>• <code>CLAUDE.md</code> — Tell AI "read this" and it understands your entire project</p>'+
'<p><strong>Step 3: Feed Everything to AI</strong><br>"Copy All Files" (Ctrl+Shift+C) → Paste into AI → Start coding with full project context.</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>Generate</span><span class="hg-a">→</span><span class="hg-n hg-c">Ctrl+Shift+C<br>Copy</span><span class="hg-a">→</span><span class="hg-n hg-p">Paste to<br>AI Tool</span><span class="hg-a">→</span><span class="hg-n hg-g">Start<br>Coding</span></div>'+
'<h3>🔥 Intermediate — Maximize Efficiency</h3>'+
'<p><strong>SDD Workflow:</strong> <code>.spec/</code> is your SSoT. constitution.md(principles) → specification.md(requirements) → tasks.md(tasks) → verification.md(acceptance criteria). Tell AI: "implement task X from tasks.md following specification.md".</p>'+
'<p><strong>Multi-AI Tool Unity:</strong> Pillar ④ generates 10 files covering Cursor, Claude Code, Copilot, Windsurf, Cline, Gemini etc. Same rules regardless of which tool you use.</p>'+
'<p><strong>MCP Extension:</strong> Place mcp-config.json in project root → AI instantly uses context7, filesystem, playwright MCPs.</p>'+
'<h3>⚡ Professional — Master Automation</h3>'+
'<p><strong>Agent Teams:</strong> AGENTS.md defines agent roles → Run with Claude Code Subagents / Antigravity Manager View. tasks.md serves as task queue.</p>'+
'<p><strong>CI/CD Gates:</strong> .ai/hooks.yml → GitHub Actions. docs/09_release_checklist.md as deploy gate. verification.md as quality baseline.</p>'+
'<p><strong>Dev Pipeline:</strong> 20 templates in Pillar ⑧ → 📋Review → 🔨Implement → 🧪Test → ♻️Refactor → 🔒Security → 📝Docs. Plus 🔧Debug, 📐Architecture, ⚡Performance and more specialized templates. <strong>(📖 See Prompt Manual for details)</strong></p>'+
'<h3>⚔️ Comparison with Other Tools</h3>'+
'<table><tr><th>Feature</th><th>DevForge v9</th><th>create-next-app</th><th>AI Direct</th></tr>'+
'<tr><td>SDD 5 Spec Docs</td><td>✅ Auto</td><td>✗</td><td>△ Manual</td></tr>'+
'<tr><td>10-Tool AI Rules</td><td>✅ Auto</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>Compat Check</td><td>✅ Auto</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>Roadmap</td><td>✅ Auto</td><td>✗</td><td>△ Manual</td></tr>'+
'<tr><td>DevContainer</td><td>✅ Auto</td><td>✗</td><td>△ Manual</td></tr>'+
'<tr><td>MCP+Agent Setup</td><td>✅ Auto</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>'+_TECH_COUNT+' Tech DB</td><td>✅ Built-in</td><td>✗</td><td>✗</td></tr>'+
'<tr><td>Offline</td><td>✅</td><td>✅</td><td>✗</td></tr></table>'+
'<h3>📋 File Usage Map</h3>'+
'<table><tr><th>File</th><th>🌱Beginner</th><th>🔥Intermediate</th><th>⚡Pro</th></tr>'+
'<tr><td><code>CLAUDE.md</code></td><td>As-is</td><td>Customize</td><td>Agent config</td></tr>'+
'<tr><td><code>.spec/</code></td><td>Read only</td><td>Feed AI one by one</td><td>Task queue</td></tr>'+
'<tr><td><code>.devcontainer/</code></td><td>As-is</td><td>Customize</td><td>Team standard</td></tr>'+
'<tr><td><code>roadmap/</code></td><td>Learning</td><td>Progress</td><td>Onboarding</td></tr>'+
'<tr><td><code>docs/</code> 40 files</td><td>Later</td><td>Review material</td><td>CI/CD gates</td></tr>'+
'<tr><td>Pillar ④ AI Rules</td><td>Don\'t touch</td><td>Add rules</td><td>Unified ops</td></tr>'+
'<tr><td>Pillar ⑧ Launcher</td><td>Skip</td><td>Partial use</td><td>Full pipeline</td></tr>'+
'<tr><td><code>.mcp/ + config</code></td><td>Later</td><td>As-is</td><td>Custom MCP</td></tr>'+
'<tr><td><code>AGENTS.md</code></td><td>Skip</td><td>Reference</td><td>Multi-Agent</td></tr>'+
'<tr><td><code>.ai/hooks.yml</code></td><td>Skip</td><td>Reference</td><td>CI/CD Integration</td></tr></table>'+
'<p class="guide-action-p"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 Show Level Guide</button> <button class="btn btn-s btn-sm" onclick="showManual(\'workflow\')">📘 Post-Gen Workflow</button></p>';
let h=baseBody;
// Add domain-specific first steps
const a=S.answers||{};
const dom=detectDomain(a.purpose||'')||'_default';
const steps=DOMAIN_FIRST_STEPS[dom]||DOMAIN_FIRST_STEPS._default;
h+=_ja?'<h3>🎯 ドメイン別 初手ステップ</h3>':'<h3>🎯 Domain-Specific First Steps</h3>';
h+='<div class="guide-domain-steps">';
((_ja?steps.ja:steps.en)||[]).forEach((s,i)=>{h+=`<div class="guide-step-mini"><span class="guide-step-num-mini">${i+1}</span><span>${s}</span></div>`;});
h+='</div>';
// Add AI tool recipe
const tools=(a.ai_tools||'').split(',').map(t=>t.trim()).filter(t=>t);
const tool=tools.find(t=>AI_TOOL_RECIPES[t])||'_default';
const recipe=AI_TOOL_RECIPES[tool]||AI_TOOL_RECIPES._default;
h+=_ja?'<h3>🤖 AIツール別ワークフロー</h3>':'<h3>🤖 AI Tool Workflow</h3>';
h+=`<div class="guide-ai-recipe"><h4>${tool==='_default'?(_ja?'汎用ワークフロー':'Generic Workflow'):tool}</h4>`;
((_ja?recipe.ja:recipe.en)||[]).forEach(s=>{h+=`<div class="guide-recipe-step">${s}</div>`;});
h+='</div>';
// Add ADRs
const adrs=getADRs(a,_ja);
if(adrs.length>0){
h+=_ja?'<h3>📐 Architecture Decision Records (ADR)</h3>':'<h3>📐 Architecture Decision Records (ADR)</h3>';
h+=_ja?'<p class="guide-adr-intro">ユーザーの選択から自動抽出された設計判断:</p>':'<p class="guide-adr-intro">Auto-extracted design decisions from your choices:</p>';
h+='<div class="guide-adrs">';
adrs.forEach(adr=>{h+=`<div class="guide-adr"><span class="guide-adr-icon">${adr.icon}</span><div><strong>${adr.t}</strong><p>${adr.d}</p></div></div>`;});
h+='</div>';
}
return h;
}},
{id:'workflow',title:_ja?'📘 生成後ワークフロー':'📘 Post-Gen Workflow',body:_ja?
'<h2>📘 生成後ワークフロー完全ガイド</h2>'+
'<p class="guide-workflow-intro">DevForge v9で93+ファイルを生成した後、<strong>実際に動くアプリを作るまでの一気通貫の手順</strong>を5フェーズで解説します。</p>'+
'<h3>① 基礎概念 — DevForgeの生成物を理解する</h3>'+
'<div class="workflow-concept"><p><strong>重要:</strong> DevForgeが生成するのは<strong class="workflow-highlight">設計ドキュメント</strong>であり、実行可能なアプリケーションコードではありません。</p>'+
'<p><strong>SDD（仕様駆動開発）の思想:</strong> <code>.spec/</code>がSSoT（信頼できる唯一の情報源）として機能します。</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>生成</span><span class="hg-a">→</span><span class="hg-n hg-c">AIツールに<br>投入</span><span class="hg-a">→</span><span class="hg-n hg-p">実コード<br>生成</span><span class="hg-a">→</span><span class="hg-n hg-g">動くアプリ<br>完成</span></div></div>'+
'<h4>93+ファイルの全体像</h4>'+
'<table class="workflow-files"><tr><th>カテゴリ</th><th>内容</th><th>ファイル数</th></tr>'+
'<tr><td>.spec/</td><td>仕様駆動開発の5点セット</td><td>5</td></tr>'+
'<tr><td>.devcontainer/</td><td>Docker開発環境</td><td>4</td></tr>'+
'<tr><td>.mcp/</td><td>Model Context Protocol設定</td><td>3</td></tr>'+
'<tr><td>AIルール</td><td>10+ツール対応（Cursor, Claude Code等）</td><td>12+</td></tr>'+
'<tr><td>docs/</td><td>40種類の仕様書・設計書</td><td>40</td></tr>'+
'<tr><td>roadmap/</td><td>学習パス</td><td>9</td></tr>'+
'<tr><td>共通</td><td>README, LICENSE等</td><td>4</td></tr></table>'+
'<h3>② 準備 — 生成直後にやること</h3>'+
'<ol class="workflow-steps">'+
'<li><strong>監査結果の確認</strong><br>生成後のチャットパネルに表示される<code>❌ エラー</code> / <code>⚠️ 警告</code>をチェック。互換性問題や設定ミスがないか確認します。</li>'+
'<li><strong>バックアップ（重要！）</strong><br><code>📦 ZIPダウンロード</code> + <code>📤 JSONエクスポート</code>の2段構え。<span class="workflow-warn">localStorageのみなのでデータ消失リスクあり</span>。</li>'+
'<li><strong>開発環境構築</strong><br>'+
'<strong>Option A（推奨）:</strong> ZIP解凍 → VS Code/Cursorで開く → DevContainerが自動構築<br>'+
'<strong>Option B:</strong> 既存プロジェクトにファイルをコピー</li>'+
'<li><strong>AIツール設定</strong><br>以下の表を参考に設定:</li></ol>'+
'<table class="workflow-ai-tools"><tr><th>AIツール</th><th>自動読込ファイル</th><th>追加設定</th></tr>'+
'<tr><td>Cursor</td><td>.cursor/rules</td><td>なし</td></tr>'+
'<tr><td>Claude Code</td><td>CLAUDE.md</td><td>なし</td></tr>'+
'<tr><td>Windsurf</td><td>.windsurfrules</td><td>なし</td></tr>'+
'<tr><td>Cline</td><td>.clinerules</td><td>なし</td></tr>'+
'<tr><td>Copilot</td><td>copilot-instructions.md</td><td>.github/に配置</td></tr>'+
'<tr><td>その他</td><td>AI_BRIEF.md</td><td>手動貼付</td></tr></table>'+
'<p class="workflow-note">💡 MCP設定: <code>mcp-config.json</code>をプロジェクトルートに配置</p>'+
'<h3>③ 手順 — 5フェーズ開発ワークフロー</h3>'+
'<div class="workflow-phases">'+
'<div class="workflow-phase"><h4>Phase A: プロジェクト理解（Day 1）</h4>'+
'<ul><li><strong>ファイル読み順:</strong> <code>constitution.md</code> → <code>specification.md</code> → <code>technical-plan.md</code></li>'+
'<li><strong>Dashboardチェック:</strong> シナジースコア / モデル適合 / ヘルススコアを確認</li>'+
'<li><strong>設計確認:</strong> ER図（docs/04）+ API設計（docs/05）を把握</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase B: 環境構築（Day 1-2）</h4>'+
'<ul><li><strong>DevContainerパス:</strong> フォルダを開く → "Reopen in Container"</li>'+
'<li><strong>手動パス:</strong> package.json scripts + .env.exampleを参考に構築</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase C: AIと一緒に開発（Day 2+）</h4>'+
'<p><strong>アプローチ1: シンプル</strong></p>'+
'<div class="hg-flow"><span class="hg-n hg-c">Ctrl+Shift+C<br>全コピー</span><span class="hg-a">→</span><span class="hg-n hg-p">AIに貼付</span><span class="hg-a">→</span><span class="hg-n hg-g">"Issue #1を<br>実装して"</span></div>'+
'<p><strong>アプローチ2: 構造化</strong></p>'+
'<ul><li>ランチャーの🔍レビュー → 🚀MVP実装テンプレートを活用</li>'+
'<li><code>tasks.md</code>のIssue番号順に進める</li>'+
'<li>タスクループ: <code>タスク読む → 実装 → テスト → 完了マーク</code></li>'+
'<li><code>verification.md</code>で受入基準チェック</li></ul>'+
'<h5>推奨テンプレート順序</h5>'+
'<ol class="workflow-template-order"><li>🔍 仕様レビュー</li><li>🚀 MVP実装</li><li>🧪 テスト生成</li><li>🔒 セキュリティ監査</li><li>📝 ドキュメント更新</li></ol></div>'+
'<div class="workflow-phase"><h4>Phase D: 品質保証</h4>'+
'<ul><li>ランチャーテンプレート: 🧪テスト → 🔒セキュリティ → ♿a11y</li>'+
'<li>参照先: docs/07, docs/28, docs/33</li>'+
'<li>エラーログ: docs/25_error_logs.mdに記録</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase E: リリース</h4>'+
'<ul><li>docs/24_progress.mdで進捗更新</li>'+
'<li>docs/09_release_checklist.mdに従う</li>'+
'<li>CI/CD: .github/workflows/ci.ymlが事前設定済み</li></ul>'+
'<div class="hg-flow"><span class="hg-n hg-b">Build</span><span class="hg-a">→</span><span class="hg-n hg-c">Test</span><span class="hg-a">→</span><span class="hg-n hg-p">Fix</span><span class="hg-a">→</span><span class="hg-n hg-g">Release</span><span class="hg-a">→</span><span class="hg-n">Monitor</span></div></div></div>'+
'<h3>④ 応用 — 上級テクニック</h3>'+
'<ul class="workflow-advanced"><li><strong>テンプレートチェーン:</strong> ランチャーで複数テンプレートを順次実行（→ 📋プロンプトマニュアル参照）</li>'+
'<li><strong>マルチエージェント開発:</strong> AGENTS.md + Claude Code Subagents</li>'+
'<li><strong>再生成:</strong> スコープ変更後、再生成ボタン（回答は保持）</li>'+
'<li><strong>チームオンボーディング:</strong> ロードマップ（柱⑦）で新メンバー育成</li>'+
'<li><strong>グロース戦略:</strong> docs/41_growth_intelligence.md活用</li>'+
'<li><strong>ゴール再検証:</strong> docs/29-30でピボット時の方向性確認</li></ul>'+
'<h3>⑤ よくある失敗と回避策</h3>'+
'<table class="workflow-pitfalls"><tr><th>失敗</th><th>原因</th><th>対策</th></tr>'+
'<tr><td>ファイルを直接実行しようとする</td><td>DevForgeの出力を誤解</td><td>設計ドキュメントをAIに投入してコード生成</td></tr>'+
'<tr><td>バックアップしない</td><td>localStorageに依存</td><td>毎回ZIP+JSONエクスポート</td></tr>'+
'<tr><td>互換性警告を無視</td><td>ダッシュボード未確認</td><td>⚠️警告に対処してから開発開始</td></tr>'+
'<tr><td>全ファイルを一度にAIに投入</td><td>コンテキストウィンドウ超過</td><td>ランチャーのフォルダ選択でトークン管理</td></tr>'+
'<tr><td>tasks.mdを使わない</td><td>非構造的なAI指示</td><td>Issue番号順に実装</td></tr>'+
'<tr><td>verification.mdをスキップ</td><td>受入基準なし</td><td>機能ごとにverification.mdで確認</td></tr>'+
'<tr><td>途中でスキルレベル変更</td><td>質問選択肢の不整合</td><td>最初に正しく設定</td></tr>'+
'<tr><td>MCP未設定</td><td>AIツール連携が不完全</td><td>mcp-config.jsonを配置</td></tr></table>'+
'<h3>⑥ まとめ — クイックリファレンス</h3>'+
'<div class="workflow-summary"><h4>10項目チェックリスト</h4>'+
'<ol class="workflow-checklist"><li>✅ 監査結果確認（❌ / ⚠️ なし）</li><li>✅ ZIP + JSONバックアップ済み</li>'+
'<li>✅ DevContainer起動 or 手動環境構築完了</li><li>✅ AIツールにルールファイル認識済み</li>'+
'<li>✅ constitution.md → specification.md 読了</li><li>✅ tasks.mdを開いてタスク把握</li>'+
'<li>✅ Issue #1から順次実装開始</li><li>✅ verification.mdで受入基準確認</li>'+
'<li>✅ テスト・セキュリティ監査実施</li><li>✅ リリースチェックリストで最終確認</li></ol>'+
'<h4>全体フロー図</h4>'+
'<div class="hg-flow"><span class="hg-n hg-b">生成</span><span class="hg-a">→</span><span class="hg-n hg-c">バックアップ</span><span class="hg-a">→</span><span class="hg-n hg-p">環境構築</span><span class="hg-a">→</span><span class="hg-n">仕様理解</span><span class="hg-a">→</span><span class="hg-n">AI開発</span><span class="hg-a">→</span><span class="hg-n">QA</span><span class="hg-a">→</span><span class="hg-n hg-g">リリース</span></div>'+
'<p class="workflow-footer"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 レベル別ガイドを表示</button></p></div>'
:
'<h2>📘 Complete Post-Generation Workflow Guide</h2>'+
'<p class="guide-workflow-intro">After generating 93+ files with DevForge v9, follow this <strong>end-to-end workflow</strong> in 5 phases to build a working app.</p>'+
'<h3>① Fundamentals — Understanding DevForge Output</h3>'+
'<div class="workflow-concept"><p><strong>Important:</strong> DevForge generates <strong class="workflow-highlight">design documents</strong>, not runnable application code.</p>'+
'<p><strong>SDD (Spec-Driven Development) Philosophy:</strong> <code>.spec/</code> serves as your SSoT (Single Source of Truth).</p>'+
'<div class="hg-flow"><span class="hg-n hg-b">DevForge<br>Generate</span><span class="hg-a">→</span><span class="hg-n hg-c">Feed to<br>AI Tool</span><span class="hg-a">→</span><span class="hg-n hg-p">Generate<br>Real Code</span><span class="hg-a">→</span><span class="hg-n hg-g">Working<br>App</span></div></div>'+
'<h4>93+ Files Overview</h4>'+
'<table class="workflow-files"><tr><th>Category</th><th>Content</th><th>Files</th></tr>'+
'<tr><td>.spec/</td><td>SDD 5-point set</td><td>5</td></tr>'+
'<tr><td>.devcontainer/</td><td>Docker dev environment</td><td>4</td></tr>'+
'<tr><td>.mcp/</td><td>Model Context Protocol config</td><td>3</td></tr>'+
'<tr><td>AI Rules</td><td>10+ tool support (Cursor, Claude Code, etc.)</td><td>12+</td></tr>'+
'<tr><td>docs/</td><td>40 spec/design documents</td><td>40</td></tr>'+
'<tr><td>roadmap/</td><td>Learning paths</td><td>9</td></tr>'+
'<tr><td>Common</td><td>README, LICENSE, etc.</td><td>4</td></tr></table>'+
'<h3>② Preparation — What to Do Right After Generation</h3>'+
'<ol class="workflow-steps">'+
'<li><strong>Check Audit Results</strong><br>Review <code>❌ Errors</code> / <code>⚠️ Warnings</code> in the chat panel after generation. Fix compatibility issues or config errors.</li>'+
'<li><strong>Backup (Critical!)</strong><br><code>📦 Download ZIP</code> + <code>📤 Export JSON</code> in tandem. <span class="workflow-warn">Data only exists in localStorage = loss risk</span>.</li>'+
'<li><strong>Set Up Dev Environment</strong><br>'+
'<strong>Option A (Recommended):</strong> Extract ZIP → Open in VS Code/Cursor → DevContainer auto-builds<br>'+
'<strong>Option B:</strong> Copy files to existing project</li>'+
'<li><strong>Configure AI Tools</strong><br>Refer to the table below:</li></ol>'+
'<table class="workflow-ai-tools"><tr><th>AI Tool</th><th>Auto-Loaded File</th><th>Additional Setup</th></tr>'+
'<tr><td>Cursor</td><td>.cursor/rules</td><td>None</td></tr>'+
'<tr><td>Claude Code</td><td>CLAUDE.md</td><td>None</td></tr>'+
'<tr><td>Windsurf</td><td>.windsurfrules</td><td>None</td></tr>'+
'<tr><td>Cline</td><td>.clinerules</td><td>None</td></tr>'+
'<tr><td>Copilot</td><td>copilot-instructions.md</td><td>Place in .github/</td></tr>'+
'<tr><td>Others</td><td>AI_BRIEF.md</td><td>Paste manually</td></tr></table>'+
'<p class="workflow-note">💡 MCP Setup: Place <code>mcp-config.json</code> in project root</p>'+
'<h3>③ Workflow — 5-Phase Development Process</h3>'+
'<div class="workflow-phases">'+
'<div class="workflow-phase"><h4>Phase A: Project Understanding (Day 1)</h4>'+
'<ul><li><strong>Reading Order:</strong> <code>constitution.md</code> → <code>specification.md</code> → <code>technical-plan.md</code></li>'+
'<li><strong>Dashboard Check:</strong> Synergy Score / Model Fit / Health Score</li>'+
'<li><strong>Design Review:</strong> ER diagram (docs/04) + API design (docs/05)</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase B: Environment Setup (Day 1-2)</h4>'+
'<ul><li><strong>DevContainer Path:</strong> Open folder → "Reopen in Container"</li>'+
'<li><strong>Manual Path:</strong> Follow package.json scripts + .env.example</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase C: AI-Assisted Development (Day 2+)</h4>'+
'<p><strong>Approach 1: Simple</strong></p>'+
'<div class="hg-flow"><span class="hg-n hg-c">Ctrl+Shift+C<br>Copy All</span><span class="hg-a">→</span><span class="hg-n hg-p">Paste to<br>AI</span><span class="hg-a">→</span><span class="hg-n hg-g">"Implement<br>Issue #1"</span></div>'+
'<p><strong>Approach 2: Structured</strong></p>'+
'<ul><li>Use Launcher\'s 🔍 Review → 🚀 MVP Build templates</li>'+
'<li>Work through <code>tasks.md</code> in Issue# order</li>'+
'<li>Task Loop: <code>Read Task → Implement → Test → Mark Complete</code></li>'+
'<li>Check acceptance criteria in <code>verification.md</code></li></ul>'+
'<h5>Recommended Template Order</h5>'+
'<ol class="workflow-template-order"><li>🔍 Spec Review</li><li>🚀 MVP Build</li><li>🧪 Test Generation</li><li>🔒 Security Audit</li><li>📝 Doc Update</li></ol></div>'+
'<div class="workflow-phase"><h4>Phase D: Quality Assurance</h4>'+
'<ul><li>Launcher templates: 🧪 Test → 🔒 Security → ♿ a11y</li>'+
'<li>Reference: docs/07, docs/28, docs/33</li>'+
'<li>Error Log: Record in docs/25_error_logs.md</li></ul></div>'+
'<div class="workflow-phase"><h4>Phase E: Release</h4>'+
'<ul><li>Update progress in docs/24_progress.md</li>'+
'<li>Follow docs/09_release_checklist.md</li>'+
'<li>CI/CD: Pre-configured in .github/workflows/ci.yml</li></ul>'+
'<div class="hg-flow"><span class="hg-n hg-b">Build</span><span class="hg-a">→</span><span class="hg-n hg-c">Test</span><span class="hg-a">→</span><span class="hg-n hg-p">Fix</span><span class="hg-a">→</span><span class="hg-n hg-g">Release</span><span class="hg-a">→</span><span class="hg-n">Monitor</span></div></div></div>'+
'<h3>④ Advanced — Expert Techniques</h3>'+
'<ul class="workflow-advanced"><li><strong>Template Chaining:</strong> Execute multiple templates sequentially in Launcher (→ See 📋 Prompt Manual)</li>'+
'<li><strong>Multi-Agent Development:</strong> AGENTS.md + Claude Code Subagents</li>'+
'<li><strong>Regeneration:</strong> After scope changes, regenerate (answers preserved)</li>'+
'<li><strong>Team Onboarding:</strong> Use Roadmap (Pillar ⑦) for new members</li>'+
'<li><strong>Growth Strategy:</strong> Leverage docs/41_growth_intelligence.md</li>'+
'<li><strong>Goal Re-validation:</strong> Use docs/29-30 for pivot direction</li></ul>'+
'<h3>⑤ Common Pitfalls & Solutions</h3>'+
'<table class="workflow-pitfalls"><tr><th>Pitfall</th><th>Cause</th><th>Solution</th></tr>'+
'<tr><td>Trying to run files directly</td><td>Misunderstanding DevForge output</td><td>Feed design docs to AI to generate code</td></tr>'+
'<tr><td>Not backing up</td><td>Relying only on localStorage</td><td>ZIP + JSON export every time</td></tr>'+
'<tr><td>Ignoring compatibility warnings</td><td>Skipping Dashboard check</td><td>Address ⚠️ warnings before dev</td></tr>'+
'<tr><td>Feeding all files to AI at once</td><td>Context window overflow</td><td>Use Launcher folder selection for token mgmt</td></tr>'+
'<tr><td>Not using tasks.md</td><td>Unstructured AI instructions</td><td>Implement in Issue# order</td></tr>'+
'<tr><td>Skipping verification.md</td><td>No acceptance criteria</td><td>Check verification.md per feature</td></tr>'+
'<tr><td>Changing skill level mid-project</td><td>Question option inconsistency</td><td>Set correctly at start</td></tr>'+
'<tr><td>MCP not configured</td><td>Incomplete AI tool integration</td><td>Place mcp-config.json</td></tr></table>'+
'<h3>⑥ Summary — Quick Reference</h3>'+
'<div class="workflow-summary"><h4>10-Item Checklist</h4>'+
'<ol class="workflow-checklist"><li>✅ Audit results reviewed (no ❌ / ⚠️)</li><li>✅ ZIP + JSON backup done</li>'+
'<li>✅ DevContainer running or manual env setup complete</li><li>✅ AI tool recognizes rule files</li>'+
'<li>✅ Read constitution.md → specification.md</li><li>✅ Opened tasks.md and identified tasks</li>'+
'<li>✅ Started implementing from Issue #1</li><li>✅ Checked acceptance criteria in verification.md</li>'+
'<li>✅ Ran tests & security audit</li><li>✅ Final check with release checklist</li></ol>'+
'<h4>Overall Flow Diagram</h4>'+
'<div class="hg-flow"><span class="hg-n hg-b">Generate</span><span class="hg-a">→</span><span class="hg-n hg-c">Backup</span><span class="hg-a">→</span><span class="hg-n hg-p">Setup Env</span><span class="hg-a">→</span><span class="hg-n">Understand<br>Specs</span><span class="hg-a">→</span><span class="hg-n">AI Dev</span><span class="hg-a">→</span><span class="hg-n">QA</span><span class="hg-a">→</span><span class="hg-n hg-g">Release</span></div>'+
'<p class="workflow-footer"><button class="btn btn-p btn-sm" onclick="closeManual();showPostGenGuide(true)">🚀 Show Level Guide</button></p></div>'
},
{id:'launcher-guide',title:_ja?'📋 プロンプトマニュアル':'📋 Prompt Manual',body:_ja?
'<h2>🤖 AIプロンプトランチャー 使い方マニュアル</h2>'+
'<h3>🔧 仕組み (How It Works)</h3>'+
'<div class="hg-flow"><span class="hg-n hg-b">📂<br>フォルダ選択</span><span class="hg-a">→</span><span class="hg-n hg-c">📋<br>テンプレート選択</span><span class="hg-a">→</span><span class="hg-n hg-p">⚙️<br>プロンプト自動合成</span><span class="hg-a">→</span><span class="hg-n hg-g">📋<br>コピー→AI投入</span></div>'+
'<p><strong>5パート自動合成:</strong></p>'+
'<table><tr><th>パート</th><th>内容</th></tr>'+
'<tr><td>① System</td><td>AIの役割定義（テックリード、QAエンジニア、セキュリティ専門家 等）</td></tr>'+
'<tr><td>② Context</td><td>プロジェクト情報（スタック構成、認証方式、エンティティ）</td></tr>'+
'<tr><td>③ Task</td><td>具体的な指示（レビュー手順、実装ステップ、テスト戦略）</td></tr>'+
'<tr><td>④ Format</td><td>出力形式（Markdown表、コードブロック、Mermaid図）</td></tr>'+
'<tr><td>⑤ Files</td><td>選択したフォルダの全ファイル内容</td></tr></table>'+
'<h3>📊 開発ライフサイクルフロー</h3>'+
'<table><tr><th>フェーズ</th><th>テンプレート</th></tr>'+
'<tr><td><strong>設計</strong></td><td>🔍仕様レビュー / 📐アーキテクチャ / 🎯ゴール逆算</td></tr>'+
'<tr><td><strong>開発</strong></td><td>🚀MVP実装 / 🔌API統合 / 🌍i18n</td></tr>'+
'<tr><td><strong>QA</strong></td><td>🧪テスト / 🐛QA / 🔒セキュリティ / ♿a11y / ⚡パフォーマンス / 📊メトリクス</td></tr>'+
'<tr><td><strong>運用</strong></td><td>♻️リファクタ / 🔧デバッグ / 🚨インシデント / 📝ドキュメント / 🔄マイグレーション / 🔄CI/CD</td></tr>'+
'<tr><td><strong>ビジネス</strong></td><td>📈グロース</td></tr>'+
'<tr><td><strong>チーム</strong></td><td>🎓オンボーディング</td></tr></table>'+
'<h3>🌱🔥⚡ スキルレベル別ベストプラクティス</h3>'+
'<p><strong>🌱 Beginner — まず動かす</strong></p>'+
'<ul><li>🔍仕様レビュー + 🚀MVP実装 の2つから始める</li>'+
'<li><code>.spec/</code> フォルダだけを選択してトークン節約</li>'+
'<li>生成されたプロンプトをそのままコピペでOK</li></ul>'+
'<p><strong>🔥 Intermediate — チェーン活用</strong></p>'+
'<ul><li>レビュー → 実装 → テスト → リファクタ の順にチェーン実行</li>'+
'<li><code>.spec/</code> + <code>docs/</code> を含めて包括的なコンテキストを提供</li>'+
'<li>モデル適合度を確認し、80%以内に収める</li></ul>'+
'<p><strong>⚡ Professional — パイプライン化</strong></p>'+
'<ul><li>全20テンプレートをパイプラインとして順次実行</li>'+
'<li>フォルダ選択を最適化（デバッグ時は<code>docs/25</code>+<code>docs/37</code>のみ等）</li>'+
'<li><code>docs/39_implementation_playbook.md</code> と <code>docs/40_ai_dev_runbook.md</code> も活用</li></ul>'+
'<h3>📋 全20テンプレート早見表</h3>'+
'<table><tr><th>Icon</th><th>名前</th><th>フェーズ</th><th>主要参照ドキュメント</th></tr>'+
'<tr><td>🔍</td><td>仕様レビュー</td><td>設計</td><td>.spec/*</td></tr>'+
'<tr><td>📐</td><td>アーキテクチャ</td><td>設計</td><td>docs/03, docs/27, docs/26</td></tr>'+
'<tr><td>🎯</td><td>ゴール逆算</td><td>設計</td><td>docs/29, docs/30</td></tr>'+
'<tr><td>🚀</td><td>MVP実装</td><td>開発</td><td>docs/23, docs/39</td></tr>'+
'<tr><td>🔌</td><td>API統合</td><td>開発</td><td>docs/05, docs/04, docs/08</td></tr>'+
'<tr><td>🌍</td><td>i18n</td><td>開発</td><td>(コード分析)</td></tr>'+
'<tr><td>🧪</td><td>テスト生成</td><td>QA</td><td>docs/07, docs/33, docs/36</td></tr>'+
'<tr><td>🐛</td><td>QA・バグ検出</td><td>QA</td><td>docs/28, docs/32, docs/33</td></tr>'+
'<tr><td>🔒</td><td>セキュリティ</td><td>QA</td><td>docs/08</td></tr>'+
'<tr><td>♿</td><td>a11y監査</td><td>QA</td><td>docs/26, docs/06</td></tr>'+
'<tr><td>⚡</td><td>パフォーマンス</td><td>QA</td><td>docs/41</td></tr>'+
'<tr><td>📊</td><td>メトリクス</td><td>QA</td><td>(コード分析)</td></tr>'+
'<tr><td>♻️</td><td>リファクタ</td><td>運用</td><td>.spec/*</td></tr>'+
'<tr><td>🔧</td><td>デバッグ</td><td>運用</td><td>docs/25, docs/37, docs/34</td></tr>'+
'<tr><td>🚨</td><td>インシデント</td><td>運用</td><td>docs/34, docs/25</td></tr>'+
'<tr><td>📝</td><td>ドキュメント</td><td>運用</td><td>(全体)</td></tr>'+
'<tr><td>🔄</td><td>マイグレーション</td><td>運用</td><td>docs/04</td></tr>'+
'<tr><td>🔄</td><td>CI/CD</td><td>運用</td><td>docs/09, docs/36</td></tr>'+
'<tr><td>📈</td><td>グロース</td><td>ビジネス</td><td>docs/41</td></tr>'+
'<tr><td>🎓</td><td>オンボーディング</td><td>チーム</td><td>docs/42, docs/37</td></tr></table>'+
'<h3>💡 Tips</h3>'+
'<p><strong>フォルダ選択のコツ:</strong> 不要なフォルダのチェックを外してトークン節約。例: デバッグ時は<code>docs/</code>の大半は不要。</p>'+
'<p><strong>モデル適合度の見方:</strong> 80%以下が理想。超過する場合はフォルダを絞る。</p>'+
'<p><strong>テンプレートのチェーン例:</strong></p>'+
'<ul><li>新機能追加: 🔍レビュー → 🚀実装 → 🧪テスト → 📝ドキュメント</li>'+
'<li>バグ修正: 🔧デバッグ → ♻️リファクタ → 🧪テスト → 🚨インシデント対応</li>'+
'<li>パフォーマンス改善: ⚡パフォーマンス → 📊メトリクス → ♻️リファクタ → 🧪テスト</li></ul>':
'<h2>🤖 AI Prompt Launcher User Manual</h2>'+
'<h3>🔧 How It Works</h3>'+
'<div class="hg-flow"><span class="hg-n hg-b">📂<br>Select Folders</span><span class="hg-a">→</span><span class="hg-n hg-c">📋<br>Pick Template</span><span class="hg-a">→</span><span class="hg-n hg-p">⚙️<br>Auto-compose</span><span class="hg-a">→</span><span class="hg-n hg-g">📋<br>Copy→Feed AI</span></div>'+
'<p><strong>5-Part Auto-Composition:</strong></p>'+
'<table><tr><th>Part</th><th>Content</th></tr>'+
'<tr><td>① System</td><td>AI role definition (Tech Lead, QA Engineer, Security Expert, etc.)</td></tr>'+
'<tr><td>② Context</td><td>Project info (stack, auth, entities)</td></tr>'+
'<tr><td>③ Task</td><td>Specific instructions (review steps, implementation flow, test strategy)</td></tr>'+
'<tr><td>④ Format</td><td>Output format (Markdown table, code blocks, Mermaid diagrams)</td></tr>'+
'<tr><td>⑤ Files</td><td>All file contents from selected folders</td></tr></table>'+
'<h3>📊 Development Lifecycle Flow</h3>'+
'<table><tr><th>Phase</th><th>Templates</th></tr>'+
'<tr><td><strong>Design</strong></td><td>🔍Spec Review / 📐Architecture / 🎯Goal Reverse</td></tr>'+
'<tr><td><strong>Development</strong></td><td>🚀MVP Build / 🔌API Integration / 🌍i18n</td></tr>'+
'<tr><td><strong>QA</strong></td><td>🧪Test Gen / 🐛QA / 🔒Security / ♿a11y / ⚡Performance / 📊Metrics</td></tr>'+
'<tr><td><strong>Operations</strong></td><td>♻️Refactor / 🔧Debug / 🚨Incident / 📝Docs / 🔄Migration / 🔄CI/CD</td></tr>'+
'<tr><td><strong>Business</strong></td><td>📈Growth</td></tr>'+
'<tr><td><strong>Team</strong></td><td>🎓Onboarding</td></tr></table>'+
'<h3>🌱🔥⚡ Best Practices by Skill Level</h3>'+
'<p><strong>🌱 Beginner — Get Started</strong></p>'+
'<ul><li>Start with 🔍Spec Review + 🚀MVP Build</li>'+
'<li>Select only <code>.spec/</code> folder to save tokens</li>'+
'<li>Copy-paste generated prompts as-is</li></ul>'+
'<p><strong>🔥 Intermediate — Chain Execution</strong></p>'+
'<ul><li>Execute in sequence: Review → Implement → Test → Refactor</li>'+
'<li>Include <code>.spec/</code> + <code>docs/</code> for comprehensive context</li>'+
'<li>Keep model fit under 80%</li></ul>'+
'<p><strong>⚡ Professional — Full Pipeline</strong></p>'+
'<ul><li>Execute all 20 templates as a pipeline</li>'+
'<li>Optimize folder selection (e.g., for debugging: only <code>docs/25</code>+<code>docs/37</code>)</li>'+
'<li>Leverage <code>docs/39_implementation_playbook.md</code> and <code>docs/40_ai_dev_runbook.md</code></li></ul>'+
'<h3>📋 All 20 Templates Quick Reference</h3>'+
'<table><tr><th>Icon</th><th>Name</th><th>Phase</th><th>Key Docs</th></tr>'+
'<tr><td>🔍</td><td>Spec Review</td><td>Design</td><td>.spec/*</td></tr>'+
'<tr><td>📐</td><td>Architecture</td><td>Design</td><td>docs/03, docs/27, docs/26</td></tr>'+
'<tr><td>🎯</td><td>Goal Reverse</td><td>Design</td><td>docs/29, docs/30</td></tr>'+
'<tr><td>🚀</td><td>MVP Build</td><td>Dev</td><td>docs/23, docs/39</td></tr>'+
'<tr><td>🔌</td><td>API Integration</td><td>Dev</td><td>docs/05, docs/04, docs/08</td></tr>'+
'<tr><td>🌍</td><td>i18n</td><td>Dev</td><td>(code analysis)</td></tr>'+
'<tr><td>🧪</td><td>Test Generation</td><td>QA</td><td>docs/07, docs/33, docs/36</td></tr>'+
'<tr><td>🐛</td><td>QA & Bug Detection</td><td>QA</td><td>docs/28, docs/32, docs/33</td></tr>'+
'<tr><td>🔒</td><td>Security</td><td>QA</td><td>docs/08</td></tr>'+
'<tr><td>♿</td><td>a11y Audit</td><td>QA</td><td>docs/26, docs/06</td></tr>'+
'<tr><td>⚡</td><td>Performance</td><td>QA</td><td>docs/41</td></tr>'+
'<tr><td>📊</td><td>Metrics</td><td>QA</td><td>(code analysis)</td></tr>'+
'<tr><td>♻️</td><td>Refactor</td><td>Ops</td><td>.spec/*</td></tr>'+
'<tr><td>🔧</td><td>Debug</td><td>Ops</td><td>docs/25, docs/37, docs/34</td></tr>'+
'<tr><td>🚨</td><td>Incident</td><td>Ops</td><td>docs/34, docs/25</td></tr>'+
'<tr><td>📝</td><td>Documentation</td><td>Ops</td><td>(all)</td></tr>'+
'<tr><td>🔄</td><td>Migration</td><td>Ops</td><td>docs/04</td></tr>'+
'<tr><td>🔄</td><td>CI/CD</td><td>Ops</td><td>docs/09, docs/36</td></tr>'+
'<tr><td>📈</td><td>Growth</td><td>Business</td><td>docs/41</td></tr>'+
'<tr><td>🎓</td><td>Onboarding</td><td>Team</td><td>docs/42, docs/37</td></tr></table>'+
'<h3>💡 Tips</h3>'+
'<p><strong>Folder Selection:</strong> Uncheck unnecessary folders to save tokens. Example: for debugging, most of <code>docs/</code> is unnecessary.</p>'+
'<p><strong>Model Fit Indicator:</strong> 80% or below is ideal. If exceeded, reduce folder selection.</p>'+
'<p><strong>Template Chaining Examples:</strong></p>'+
'<ul><li>New feature: 🔍Review → 🚀Implement → 🧪Test → 📝Docs</li>'+
'<li>Bug fix: 🔧Debug → ♻️Refactor → 🧪Test → 🚨Incident</li>'+
'<li>Performance: ⚡Performance → 📊Metrics → ♻️Refactor → 🧪Test</li></ul>'
},
{id:'techdb',title:_ja?'技術DB':'Tech DB',body:_ja?
'<h2>技術マスターテーブル</h2><p>'+_TECH_COUNT+'テクノロジーを15カテゴリに分類。Context Dashboardから閲覧可能。</p><h3>カテゴリ一覧</h3><p>言語 / フロントエンド / モバイル / バックエンド / BaaS / 決済・CMS・EC / DevOps / AIツール / AI自律 / 手法 / テスト / API / ビルド / データ / セキュリティ</p><h3>フィルタ機能</h3><p>カテゴリ / 必須度 / キーワード検索で絞り込み可能。</p>'
:
'<h2>Tech Master Table</h2><p>'+_TECH_COUNT+' technologies classified into 15 categories. Browse from Context Dashboard.</p><h3>Categories</h3><p>Languages / Frontend / Mobile / Backend / BaaS / Payment・CMS・EC / DevOps / AI Tools / AI Autonomous / Methodologies / Testing / API / Build / Data / Security</p><h3>Filter</h3><p>Filter by category, requirement level, or keyword search.</p>'
},
{id:'keys',title:_ja?'ショートカット':'Shortcuts',body:_ja?
'<h2>キーボードショートカット</h2><table><tr><td><code>F1</code> / <code>Ctrl+H</code></td><td>ヘルプ表示</td></tr><tr><td><code>Ctrl+K</code></td><td>ショートカット一覧</td></tr><tr><td><code>Ctrl+T</code></td><td>テーマ切替</td></tr><tr><td><code>Ctrl+L</code></td><td>言語切替</td></tr><tr><td><code>Ctrl+E</code></td><td>エクスポート</td></tr><tr><td><code>Ctrl+Shift+C</code></td><td>全ファイルコピー</td></tr><tr><td><code>Ctrl+M</code></td><td>プロジェクト管理</td></tr><tr><td><code>Escape</code></td><td>モーダルを閉じる</td></tr></table>'
:
'<h2>Keyboard Shortcuts</h2><table><tr><td><code>F1</code> / <code>Ctrl+H</code></td><td>Open help</td></tr><tr><td><code>Ctrl+K</code></td><td>Shortcut list</td></tr><tr><td><code>Ctrl+T</code></td><td>Toggle theme</td></tr><tr><td><code>Ctrl+L</code></td><td>Toggle language</td></tr><tr><td><code>Ctrl+E</code></td><td>Export</td></tr><tr><td><code>Ctrl+Shift+C</code></td><td>Copy all files</td></tr><tr><td><code>Ctrl+M</code></td><td>Project manager</td></tr><tr><td><code>Escape</code></td><td>Close modal</td></tr></table>'
},
{id:'caution',title:_ja?'⚠️ 注意事項':'⚠️ Cautions',body:_ja?
'<h2>使用上の注意・留意点</h2>'+
'<h3>🔴 データ保存について</h3>'+
'<p>全データはブラウザの<strong>localStorage</strong>に保存されます。以下の操作で<strong>全データが消失</strong>します:</p>'+
'<p>・ブラウザの「閲覧履歴を消去」→「Cookieとサイトデータ」を削除<br>・シークレット/プライベートモードでの使用<br>・ブラウザや端末の変更</p>'+
'<p>→ 対策: 作業後は必ず<strong>📤 JSONエクスポート</strong>と<strong>📦 ZIPダウンロード</strong>で保存してください。</p>'+
'<h3>🔴 ストレージ上限</h3>'+
'<p>localStorageの上限は約5MBです。20〜30プロジェクトで上限に達する可能性があります。古いプロジェクトはエクスポート後に削除してください。</p>'+
'<h3>🟡 生成ファイルについて</h3>'+
'<p>生成される93+ファイルは<strong>設計ドキュメント</strong>（SDD仕様書・DevContainer設定・AIルール等）です。npm installで即座に動くアプリケーションコードではありません。Claude Code / Cursor等のAIツールに入力して実コードを生成する運用が前提です。</p>'+
'<p class="workflow-ref">📘 <strong>詳しい手順は <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">生成後ワークフローガイド</a> を参照</strong></p>'+
'<h3>🟡 スキルレベル</h3>'+
'<p>スキルレベルにより表示される選択肢が変わります。途中変更すると既回答との不整合が起きうるため、<strong>最初に正しく設定</strong>してください。</p>'+
'<h3>🟡 言語切り替え</h3>'+
'<p>UIの日英切り替えは即座に反映されますが、<strong>生成済みファイルの内容は切り替わりません</strong>。英語ドキュメントが必要な場合は生成時の言語選択で明示的に選んでください。</p>'+
'<h3>🔵 その他</h3>'+
'<p>・ZIPエクスポートはCDN経由のJSZipに依存します（オフライン時は「全ファイルコピー」Ctrl+Shift+Cで代替）<br>・PDF出力時はライトモード推奨（ダーク背景がそのまま印刷されます）<br>・URL共有は回答が多いとURLが長くなりSNS等で切れる場合があります</p>'
:
'<h2>Usage Cautions & Notes</h2>'+
'<h3>🔴 Data Storage</h3>'+
'<p>All data is stored in <strong>localStorage</strong>. Data will be <strong>lost</strong> if you:</p>'+
'<p>・Clear browser data (cookies & site data)<br>・Use incognito/private mode<br>・Switch browsers or devices</p>'+
'<p>→ Always <strong>📤 Export JSON</strong> and <strong>📦 Download ZIP</strong> after work.</p>'+
'<h3>🔴 Storage Limit</h3>'+
'<p>localStorage limit is ~5MB. You may reach the limit with 20-30 projects. Export and delete old projects.</p>'+
'<h3>🟡 Generated Files</h3>'+
'<p>93+ generated files are <strong>design documents</strong> (SDD specs, DevContainer configs, AI rules). They are not runnable app code. Feed them to AI tools like Claude Code / Cursor to generate actual code.</p>'+
'<p class="workflow-ref">📘 <strong>For detailed workflow, see <a href="#" onclick="event.preventDefault();showManual(\'workflow\')">Post-Gen Workflow Guide</a></strong></p>'+
'<h3>🟡 Skill Level</h3>'+
'<p>Changing skill level mid-project may cause inconsistencies with existing answers. <strong>Set it correctly at the start.</strong></p>'+
'<h3>🟡 Language Switch</h3>'+
'<p>UI language switches instantly, but <strong>generated file contents do not change</strong>. Choose the language explicitly during generation.</p>'+
'<h3>🔵 Other</h3>'+
'<p>・ZIP export requires JSZip via CDN (use "Copy All" Ctrl+Shift+C offline)<br>・Switch to light mode before PDF export<br>・URL sharing may truncate on SNS for complex projects</p>'
},
{id:'about',title:'About',body:'<h2>DevForge v9.0</h2><p>'+(_ja?'AI駆動開発 統合プラットフォーム':'AI-Driven Dev Platform')+'</p><p>Version 9.0.0 — 2026 Edition (Modular Architecture)</p><p>'+(_ja?''+_TECH_COUNT+'テクノロジー ・ 93+ファイル ・ 11の柱 ・ 41テンプレート ・ Mermaid図 ・ プロンプトプレイブック':''+_TECH_COUNT+' technologies ・ 93+ files ・ 11 pillars ・ 41 templates ・ Mermaid diagrams ・ Prompt playbook')+'</p><p>© 2026 エンジニアリングのタネ制作委員会<br>by にしあん</p>'},
];
const nav=$('helpNav');
// Keep search input, clear nav links after it
const searchEl=$('helpSearch');
while(nav.lastChild&&nav.lastChild!==searchEl)nav.removeChild(nav.lastChild);
if(searchEl)searchEl.value='';
window._manual=MANUAL;
MANUAL.forEach(s=>{
const a=document.createElement('a');a.textContent=s.title;a.href='#';a.dataset.id=s.id;
a.onclick=e=>{e.preventDefault();$('helpBody').innerHTML=typeof s.body==='function'?s.body():s.body;document.querySelectorAll('.help-nav a').forEach(x=>x.classList.remove('on'));a.classList.add('on');};
if(s.id===(sec||'overview'))a.classList.add('on');
nav.appendChild(a);
});
const initSec=MANUAL.find(s=>s.id===(sec||'overview'));
$('helpBody').innerHTML=typeof initSec.body==='function'?initSec.body():initSec.body;
trapFocus(o);
}
function filterManual(q){
if(!window._manual)return;
const links=document.querySelectorAll('#helpNav a');
const term=q.toLowerCase().trim();
if(!term){
links.forEach(a=>a.classList.remove('dim'));
const active=document.querySelector('#helpNav a.on');
if(active){const s=window._manual.find(m=>m.id===active.dataset.id);if(s)$('helpBody').innerHTML=typeof s.body==='function'?s.body():s.body;}
return;
}
let firstMatch=null;
links.forEach(a=>{
const s=window._manual.find(m=>m.id===a.dataset.id);
if(!s)return;
const bodyText=typeof s.body==='function'?s.body():s.body;
const text=(s.title+' '+bodyText.replace(/<[^>]*>/g,'')).toLowerCase();
const match=text.includes(term);
a.classList.toggle('dim',!match);
if(match&&!firstMatch)firstMatch=s;
});
if(firstMatch){
const re=new RegExp('('+term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')+')','gi');
const bodyText=typeof firstMatch.body==='function'?firstMatch.body():firstMatch.body;
const highlighted=bodyText.replace(/>([^<]+)</g,(m,txt)=>'>'+txt.replace(re,'<mark>$1</mark>')+'<');
$('helpBody').innerHTML=highlighted;
links.forEach(a=>{a.classList.remove('on');if(a.dataset.id===firstMatch.id)a.classList.add('on');});
}
}
function closeManual(){const o=$('helpOverlay');o.classList.remove('show');releaseFocus(o);removeModal(o);}
function showKB(){const el=$('kbOverlay');el.classList.add('show');trapFocus(el);pushModal(el,()=>{el.classList.remove('show');releaseFocus(el);});}
function closeKB(){const el=$('kbOverlay');el.classList.remove('show');releaseFocus(el);removeModal(el);}
function mobSw(t){
const tabs=document.querySelectorAll('.mobtab');
tabs.forEach(m=>{m.classList.remove('on');m.setAttribute('aria-selected','false');});
if(t==='c'){$('panC').classList.remove('hide');$('panP').classList.remove('show');tabs[0].classList.add('on');tabs[0].setAttribute('aria-selected','true');}
else{$('panC').classList.add('hide');$('panP').classList.add('show');tabs[1].classList.add('on');tabs[1].setAttribute('aria-selected','true');}
}
/* ═══ KEYBOARD & ACCESSIBILITY ═══ */
/* Focus trap for modals */
function trapFocus(modalEl){
const focusable=modalEl.querySelectorAll('button,input,select,textarea,a[href],[tabindex]:not([tabindex="-1"])');
if(!focusable.length)return;
const first=focusable[0];const last=focusable[focusable.length-1];
function handler(e){
if(e.key!=='Tab')return;
if(e.shiftKey){if(document.activeElement===first){e.preventDefault();last.focus();}}
else{if(document.activeElement===last){e.preventDefault();first.focus();}}
}
modalEl._trapHandler=handler;
modalEl.addEventListener('keydown',handler);
first.focus();
}
function releaseFocus(modalEl){
if(modalEl._trapHandler){modalEl.removeEventListener('keydown',modalEl._trapHandler);delete modalEl._trapHandler;}
}
/* Announce to screen readers */
function announce(msg){
let el=$('srAnnounce');
if(!el){el=document.createElement('div');el.id='srAnnounce';el.setAttribute('role','status');el.setAttribute('aria-live','assertive');el.className='sr-only';document.body.appendChild(el);}
el.textContent='';setTimeout(()=>{el.textContent=msg;},50);
}
/* Modal stack for Escape handling */
const _modalStack=[];
function pushModal(el,closeFn){_modalStack.push({el,closeFn});}
function popModal(){
const top=_modalStack.pop();
if(top&&top.closeFn)top.closeFn();
return !!top;
}
function removeModal(el){
const idx=_modalStack.findIndex(m=>m.el===el);
if(idx>=0)_modalStack.splice(idx,1);
}
document.addEventListener('keydown',e=>{
const k=e.key.toLowerCase();
if(k==='f1'||(e.ctrlKey&&k==='h')){e.preventDefault();showManual();}
if(e.ctrlKey&&k==='k'){e.preventDefault();showKB();}
if(e.ctrlKey&&k==='t'){e.preventDefault();toggleTheme();}
if(e.ctrlKey&&k==='l'){e.preventDefault();toggleLang();}
if(e.ctrlKey&&k==='e'){e.preventDefault();exportZIP();}
if(e.ctrlKey&&e.shiftKey&&k==='c'){e.preventDefault();copyAllFiles();}
if(e.altKey&&k==='arrowleft'){e.preventDefault();viewBack();}
if(e.altKey&&k==='arrowright'){e.preventDefault();viewForward();}
if(e.ctrlKey&&k==='m'){e.preventDefault();showPM();}
if(e.key==='Escape'){
if(!popModal()){
// Fallback: close any visible modal
closeManual();closeHelpPopup();
const co=$('confirmOverlay');if(co)co.style.display='none';
const pm=$('pmOverlay');if(pm){pm.style.display='none';releaseFocus(pm);}
const kb=$('kbOverlay');if(kb){kb.classList.remove('show');releaseFocus(kb);}
}
}
});
/* ═══ TOUR ═══ */
function _getTourSteps(){
const _ja=S.lang==='ja';
return [
{title:_ja?'🌱 スキルレベル':'🌱 Skill Level',desc:_ja?'Beginner / Intermediate / Pro を選ぶと、質問の選択肢が自動調整されます。':'Choose Beginner / Intermediate / Pro to auto-adjust question options.'},
{title:_ja?'📝 テンプレート':'📝 Templates',desc:_ja?'41種類のプリセットから選ぶと、回答が自動入力されます。':'Pick from 41 presets to auto-fill answers.'},
{title:_ja?'💬 質問フロー':'💬 Q&A Flow',desc:_ja?'Phase 1-3 の質問に答えるだけ。スキップも後で回答も可能です。':'Just answer Phase 1-3 questions. Skip and answer later anytime.'},
{title:_ja?'✎ 回答編集':'✎ Edit Answers',desc:_ja?'送信済みの回答に表示される ✎ ボタンで修正できます。':'Click the ✎ button on submitted answers to edit them.'},
{title:_ja?'📦 88+ファイル生成':'📦 88+ File Generation',desc:_ja?'全質問回答後、11の柱で88+ファイルが自動生成されます。':'After all questions, 88+ files auto-generate across 11 pillars.'},
{title:_ja?'⚡ 並列探索':'⚡ Parallel Explorer',desc:_ja?'Pillar ⑤ で7スタックを比較。回答に基づくおすすめランキング付き。':'Compare 7 stacks in Pillar ⑤ with recommendation ranking based on your answers.'},
{title:'📊 Dashboard',desc:_ja?'Pillar ⑥ でコンテキスト可視化＋'+_TECH_COUNT+'技術DBを閲覧。':'Visualize context + browse '+_TECH_COUNT+' tech DB in Pillar ⑥.'},
{title:_ja?'🤖 AIランチャー':'🤖 AI Launcher',desc:_ja?'Pillar ⑧ で仕様書をAIツールにワンクリック投入。15テンプレート＋トークン推定。':'Feed specs to AI tools in one click from Pillar ⑧. 15 templates + token estimation.'},
{title:_ja?'💾 データ保存の注意':'💾 Save Your Work',desc:_ja?'全データはブラウザのlocalStorageに保存されます。閲覧履歴の消去やブラウザ変更でデータが消失します。作業後は必ず📤 JSONエクスポートと📦 ZIPダウンロードで保存してください。':'All data is stored in browser localStorage. Clearing browser data or switching browsers will erase everything. Always export JSON 📤 and download ZIP 📦 after work.'},
{title:_ja?'⚠️ 注意事項を確認':'⚠️ Read Cautions',desc:_ja?'ヘルプ（F1）の「⚠️ 注意事項」タブにスキルレベル設定・言語切替・ストレージ上限などの重要な注意点をまとめています。':'Check the "⚠️ Cautions" tab in Help (F1) for important notes on skill level, language switching, storage limits, and more.'},
];
}
let tourStep=-1;
function startTour(){
const steps=_getTourSteps();
if(steps.length===0)return;
tourStep=0;showTourStep();
}
function showTourStep(){
const tc=$('tourContainer');
const steps=_getTourSteps();
if(tourStep<0||tourStep>=steps.length){closeTour();return;}
const step=steps[tourStep];
const dots=steps.map((_,i)=>'<div class="tour-dot'+(i===tourStep?' on':'')+'"></div>').join('');
tc.innerHTML='<div class="tour-card"><h4 class="tour-title">'+step.title+'</h4><p class="tour-desc">'+step.desc+'</p><div class="tour-dots">'+dots+'</div><div class="tour-acts" id="tourActs"></div></div>';
const acts=$('tourActs');
if(tourStep>0){const pb=document.createElement('button');pb.className='btn btn-g btn-xs';pb.textContent=t('tourPrev');pb.onclick=()=>{tourStep--;showTourStep();};acts.appendChild(pb);}
const nb=document.createElement('button');nb.className='btn btn-p btn-xs';nb.textContent=tourStep===steps.length-1?t('tourDone'):t('tourNext');
nb.onclick=()=>{tourStep++;showTourStep();};acts.appendChild(nb);
}
function closeTour(){tourStep=-1;$('tourContainer').innerHTML='';_lsSet('devforge-tour-done','1');}
/* ═══ INIT ═══ */
/* Global error handler */
window.onerror=(msg,src,line)=>{console.error('DevForge error:',{msg,src,line});toast('⚠️ '+msg);};
window.onunhandledrejection=e=>{console.error('Unhandled:',e.reason);toast('⚠️ '+(e.reason?.message||e.reason));};
let _mermaidReady=false;let _mermaidLoading=false;
let theme=_lsGet('devforge-theme')||'dark';
function _initMermaidTheme(){try{mermaid.initialize({startOnLoad:false,theme:theme==='light'?'default':'dark',securityLevel:'strict'});}catch(e){}}
function loadMermaid(cb){
if(_mermaidReady){cb();return;}
if(_mermaidLoading){setTimeout(()=>loadMermaid(cb),200);return;}
_mermaidLoading=true;
const s=document.createElement('script');
s.src='https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js';
s.integrity='sha384-WmdflGW9aGfoBdHc4rRyWzYuAjEmDwMdGdiPNacbwfGKxBW/SO6guzuQ76qjnSlr';
s.crossOrigin='anonymous';
s.onload=()=>{
_initMermaidTheme();
_mermaidReady=true;_mermaidLoading=false;cb();
};
s.onerror=()=>{_mermaidLoading=false;console.warn('Mermaid CDN load failed');cb();};
document.head.appendChild(s);
}
function applyTheme(){document.documentElement.setAttribute('data-theme',theme);const btn=$('themeBtn');if(btn)btn.textContent=theme==='light'?'☀️':'🌙';if(_mermaidReady)_initMermaidTheme();}
function toggleTheme(){theme=theme==='light'?'dark':'light';_lsSet('devforge-theme',theme);applyTheme();}
function toggleLang(){S.lang=S.lang==='ja'?'en':'ja';save();applyLang();if(voiceRec)voiceRec.lang=S.lang==='ja'?'ja-JP':'en-US';}
function applyLang(){
const l=S.lang;
const ja=l==='ja';
// Hero section
if($('heroTitle'))$('heroTitle').textContent=t('heroTitle');
if($('heroDesc'))$('heroDesc').textContent=t('heroDesc');
if($('startBtn'))$('startBtn').textContent=t('startBtn');
['statFiles','statTech','statPillars','statAI'].forEach(k=>{if($(k))$(k).textContent=t(k);});
if($('statTechNum'))$('statTechNum').textContent=_TECH_COUNT;
if($('skillAsk'))$('skillAsk').textContent=t('skillAsk');
document.querySelectorAll('.sk-title').forEach((el,i)=>{el.textContent=t(['skBeginner','skIntermediate','skPro'][i]);});
document.querySelectorAll('.sk-desc').forEach((el,i)=>{el.textContent=t(['skBeginnerDesc','skIntermediateDesc','skProDesc'][i]);});
// Topbar buttons
const lb=$('langBtn');if(lb)lb.textContent=ja?'🌐 EN':'🌐 JA';
if($('helpBtn'))$('helpBtn').title=ja?'ヘルプ':'Help';
if($('kbBtn'))$('kbBtn').title=ja?'ショートカット':'Shortcuts';
if($('pmBtn'))$('pmBtn').title=ja?'プロジェクト管理':'Projects';
// Landing stat labels
const statLbls=document.querySelectorAll('.stat-item .lbl');
const slJa=['生成ファイル','技術エントリ','柱 (Pillars)','AIツール対応'];
const slEn=['Generated Files','Tech Entries','Pillars','AI Tools'];
statLbls.forEach((el,i)=>{if(i<4)el.textContent=ja?slJa[i]:slEn[i];});
// Info cards
const icards=document.querySelectorAll('.icard');
const icJa=[['📝 92+ファイル生成','SDD仕様書・Docker・MCP・AIルール10種・ロードマップ9種・仕様書40種・戦略インテリジェンス'],['🧪 13の柱','SDD・DevContainer・MCP・AIルール・並列探索・Dashboard・ロードマップ・AIランチャー・デザインシステム・リバースEng・実装ガイド・セキュリティ・戦略'],['📱 モバイル対応','Expo / React Native 開発パス・EAS Build・OTA更新'],['🤖 AI自律開発','Vibe Coding・マルチAgent・Claude Code Subagents'],['💳 決済・CMS・EC','Stripe・microCMS・Medusa・Shopify Hydrogen'],['📦 フルエクスポート','ZIP・PDF・全ファイル結合コピー・URLシェア']];
const icEn=[['📝 92+ File Generation','SDD specs, Docker, MCP, 10 AI rules, 9 roadmaps, 40 specs, Strategic Intelligence'],['🧪 13 Pillars','SDD, DevContainer, MCP, AI Rules, Explorer, Dashboard, Roadmap, AI Launcher, Design System, Reverse Eng, Impl Guide, Security, Strategy'],['📱 Mobile Support','Expo / React Native dev path, EAS Build, OTA updates'],['🤖 AI Autonomous Dev','Vibe Coding, Multi-Agent, Claude Code Subagents'],['💳 Payment/CMS/EC','Stripe, microCMS, Medusa, Shopify Hydrogen'],['📦 Full Export','ZIP, PDF, Copy All Files, URL Share']];
icards.forEach((el,i)=>{if(i<6){const d=ja?icJa[i]:icEn[i];const h4=el.querySelector('h4');const p=el.querySelector('p');if(h4)h4.textContent=d[0];if(p)p.textContent=d[1];}});
// Pillar badges
const pbadges=document.querySelectorAll('.pbadge');
const pbJa=['①SDD統合','②DevContainer','③MCP設定','④AIルール','⑤並列探索','⑥Dashboard','⑦ロードマップ','⑧AIランチャー','⑨デザインシステム','⑩リバースEng','⑪実装ガイド','⑫セキュリティ','⑬戦略インテリジェンス'];
const pbEn=['①SDD','②DevContainer','③MCP','④AI Rules','⑤Explorer','⑥Dashboard','⑦Roadmap','⑧AI Launcher','⑨Design System','⑩Reverse Eng','⑪Impl Guide','⑫Security','⑬Strategic Intelligence'];
pbadges.forEach((el,i)=>{if(i<13)el.textContent=ja?pbJa[i]:pbEn[i];});
// Keyboard shortcuts overlay
const kbT=$('kbTitle');if(kbT)kbT.textContent=t('kbTitle');
const kbLabels=document.querySelectorAll('.kblbl');
const kbArr=t('kb');
kbLabels.forEach((el,i)=>{if(i<kbArr.length)el.textContent=kbArr[i];});
// Input placeholder
const ni=$('nameIn');if(ni)ni.placeholder=ja?'プロジェクト名を入力...':'Enter project name...';
// Preview panel header
const panPT=$('panPTitle');if(panPT)panPT.textContent=ja?'📁 生成ファイル':'📁 Generated Files';
// Preview tabs
if($('prevTabs')&&$('prevTabs').children.length>0){
const tabs=$('prevTabs').children;
if(tabs[0])tabs[0].textContent=ja?'ツリー':'Tree';
if(tabs[1])tabs[1].textContent=ja?'プレビュー':'Preview';
}
// Pillar tabs
if($('pillarTabs')&&$('pillarTabs').children.length>0){
const names=t('pillar');
if(Array.isArray(names)){Array.from($('pillarTabs').children).forEach((b,i)=>{if(names[i])b.textContent=names[i];});}
}
// Keyboard shortcuts overlay
const kbRows=document.querySelectorAll('.kb-row span:first-child');
const kbJa=['ヘルプ・マニュアル','ショートカット一覧','テーマ切替','言語切替','エクスポート','全ファイルコピー','プロジェクト管理'];
const kbEn=['Help / Manual','Shortcut List','Toggle Theme','Toggle Language','Export','Copy All Files','Project Manager'];
kbRows.forEach((el,i)=>{if(i<7)el.textContent=ja?kbJa[i]:kbEn[i];});
// Mobile tabs
const mobtabs=document.querySelectorAll('.mobtab');
if(mobtabs.length>=2){mobtabs[0].textContent=ja?'💬 チャット':'💬 Chat';mobtabs[1].textContent=ja?'📄 プレビュー':'📄 Preview';}
// Footer
const footer=document.querySelector('.app-footer');if(footer)footer.textContent=ja?'© 2026 エンジニアリングのタネ制作委員会 ｜ 作成者：にしあん':'© 2026 Engineering no Tane Committee | Created by にしあん';
// Placeholder in prevBody
const prevP=$('prevBody');if(prevP&&prevP.querySelector('p')&&!Object.keys(S.files||{}).length){
const p=prevP.querySelector('p');if(p&&!S.previewFile)p.textContent=ja?'質問に回答するとリアルタイムでプレビューが更新されます':'Preview updates in real-time as you answer questions';
}
// Phase pills
initPills();
// Refresh presets for lang
if($('presetRow'))initPresets();
// Update html lang attribute and document title (D3)
document.documentElement.lang=S.lang;
document.title=ja?'DevForge v9.0 — AI駆動開発 統合プラットフォーム':'DevForge v9.0 — AI-Driven Development Platform';
// Compare button translation (D4)
const cl=$('compareLbl');if(cl)cl.textContent=ja?'テンプレート比較':'Compare Templates';
}
// Initialize
load();
applyTheme();
initPresets();
initVoice();
applyLang();
_initLinkInterceptor();
// D-2: Add keyboard support for skill cards
document.querySelectorAll('.skcard').forEach(el=>{
el.onkeydown=(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();el.click();}};
});
// Load from URL if shared
(function loadFromURL(){
try{
const h=location.hash;if(!h||!h.startsWith('#df='))return;
const data=JSON.parse(atob(h.slice(4)));
if(data.projectName){
S.projectName=sanitizeName(data.projectName);
if(data.answers){
const safeAnswers={};
Object.keys(data.answers).forEach(k=>{
if(['__proto__','constructor','prototype'].includes(k))return;
if(typeof data.answers[k]==='string'){
safeAnswers[k]=sanitize(data.answers[k]);
}
});
S.answers=safeAnswers;
}
if(data.preset&&typeof data.preset==='string')S.preset=data.preset;
if(data.skill&&['beginner','intermediate','pro'].includes(data.skill))S.skill=data.skill;
if(data.lang&&['ja','en'].includes(data.lang))S.lang=data.lang;
save();location.hash='';location.reload();
}
}catch(e){}
})();
// Restore session
if(S.projectName&&S.phase>0){
$('onboard').style.display='none';
$('ws').style.display='flex';
initPills();updProgress();
if(Object.keys(S.files).length>0){initPrevTabs();initPillarTabs();showFileTree();}
findNext();
}
// Tour
if(!_lsGet('devforge-tour-done')){setTimeout(()=>startTour(),1000);}
</script>
</body>
</html>